advisory_id: GHSA-rj7p-xjv7-7229
datasource_id: github_osv_importer_v2/GHSA-rj7p-xjv7-7229
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/01/GHSA-rj7p-xjv7-7229/GHSA-rj7p-xjv7-7229.json
aliases:
  - CVE-2024-21650
summary: |
  XWiki Remote Code Execution Vulnerability via User Registration
  ### Impact
  XWiki is vulnerable to a remote code execution (RCE) attack through its user registration feature. This issue allows an attacker to execute arbitrary code by crafting malicious payloads in the "first name" or "last name" fields during user registration. This impacts all installations that have user registration enabled for guests.

  To reproduce, register with any username and password and the following payload as "first name": `]]{{/html}}{{async}}{{groovy}}services.logging.getLogger("attacker").error("Attack succeeded){{/groovy}}{{/async}}`. In the following page that confirms the success of the registration, the full first name should be displayed, linking to the created user. If the formatting is broken and a log message with content "ERROR attacker - Attack succeeded!" is logged, the attack succeeded.

  ### Patches
  This vulnerability has been patched in XWiki 14.10.17, 15.5.3 and 15.8 RC1.

  ### Workarounds

  In the administration of your wiki, under "Users & Rights" > "Registration" set the "Registration Successful Message" to the following code:

  ```velocity
  #set($message = $services.localization.render('core.register.successful', 'xwiki/2.1', ['USERLINK', $userName]))
  #set($userLink = $xwiki.getUserName("$userSpace$userName"))
  {{info}}$message.replace('USERLINK', "{{html clean=false}}$userLink{{/html}}"){{/info}}
  ```

  ### References
  * https://jira.xwiki.org/browse/XWIKI-21173
  * https://github.com/xwiki/xwiki-platform/commit/b290bfd573c6f7db6cc15a88dd4111d9fcad0d31
impacted_packages:
  - purl: pkg:maven/org.xwiki.platform/xwiki-platform-administration-ui
    affected_versions: vers:maven/>=2.2|<14.10.17
    fixed_versions: vers:maven/14.10.17
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.xwiki.platform/xwiki-platform-administration-ui
    affected_versions: vers:maven/>=15.0-rc-1|<15.5.3
    fixed_versions: vers:maven/15.5.3
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.xwiki.platform/xwiki-platform-administration-ui
    affected_versions: vers:maven/>=15.6-rc-1|<15.8-rc-1
    fixed_versions: vers:maven/15.8-rc-1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '10.0'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/01/GHSA-rj7p-xjv7-7229/GHSA-rj7p-xjv7-7229.json
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-95
  - CWE-94
references:
  - url: https://github.com/xwiki/xwiki-platform
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-platform/commit/b290bfd573c6f7db6cc15a88dd4111d9fcad0d31
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-platform/commit/cdf5be8c20b6b6fe6b9b56a6557561007859655f
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-platform/commit/ec608f303913f5e8af061f2a98506f49d69be60f
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-rj7p-xjv7-7229
    reference_type:
    reference_id:
  - url: https://jira.xwiki.org/browse/XWIKI-21173
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-21650
    reference_type:
    reference_id: CVE-2024-21650
