advisory_id: GHSA-qm2q-9f3q-2vcv
datasource_id: github_osv_importer_v2/GHSA-qm2q-9f3q-2vcv
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/08/GHSA-qm2q-9f3q-2vcv/GHSA-qm2q-9f3q-2vcv.json
aliases:
  - CVE-2024-43368
summary: |
  Trix has a cross-site Scripting vulnerability on copy & paste
  The Trix editor, versions prior to 2.1.4, is vulnerable to XSS when pasting malicious code. This vulnerability is a bypass of the fix put in place for https://github.com/basecamp/trix/security/advisories/GHSA-qjqp-xr96-cj99. In https://github.com/basecamp/trix/pull/1149, we added sanitation for Trix attachments with a `text/html` content type. However, Trix only checks the content type on the paste event's `dataTransfer` object. As long as the `dataTransfer` has a content type of `text/html`, Trix parses its contents and creates an `Attachment` with them, even if the attachment itself doesn't have a `text/html` content type. Trix then uses the attachment content to set the attachment element's `innerHTML`.

  ### Impact
  An attacker could trick a user to copy and paste malicious code that would execute arbitrary JavaScript code within the context of the user's session, potentially leading to unauthorized actions being performed or sensitive information being disclosed.

  ### Patches
  **Update Recommendation:** Users should upgrade to Trix editor version 2.1.4 or later, which incorporates proper sanitization of input from copied content.

  ### Workarounds
  This is not really a workaround but something that should be considered in addition to upgrading to the patched version. If affected users can disallow browsers that don't support a Content Security Policy, then this would be an effective workaround for this and all XSS vulnerabilities. Set CSP policies such as `script-src 'self'` to ensure that only scripts hosted on the same origin are executed, and explicitly prohibit inline scripts using `script-src-elem`.

  ### References
  * https://github.com/basecamp/trix/pull/1156
  * https://github.com/basecamp/trix/releases/tag/v2.1.4
  * https://github.com/basecamp/trix/pull/1149
  * https://github.com/basecamp/trix/security/advisories/GHSA-qjqp-xr96-cj99
  * [MDN docs for `DataTransfer`](https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer)

  ### Credits

  This vulnerability was reported by HackerOne researcher [thwin_htet](https://hackerone.com/thwin_htet?type=user).
impacted_packages:
  - purl: pkg:npm/trix
    affected_versions: vers:npm/<2.1.4
    fixed_versions: vers:npm/2.1.4
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '6.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:N/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/08/GHSA-qm2q-9f3q-2vcv/GHSA-qm2q-9f3q-2vcv.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-79
references:
  - url: https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer
    reference_type:
    reference_id:
  - url: https://github.com/basecamp/trix
    reference_type:
    reference_id:
  - url: https://github.com/basecamp/trix/commit/7656f578af0d03141a72a9d27cb3692e6947dae6
    reference_type:
    reference_id:
  - url: https://github.com/basecamp/trix/pull/1149
    reference_type:
    reference_id:
  - url: https://github.com/basecamp/trix/pull/1156
    reference_type:
    reference_id:
  - url: https://github.com/basecamp/trix/releases/tag/v2.1.4
    reference_type:
    reference_id:
  - url: https://github.com/basecamp/trix/security/advisories/GHSA-qjqp-xr96-cj99
    reference_type:
    reference_id:
  - url: https://github.com/basecamp/trix/security/advisories/GHSA-qm2q-9f3q-2vcv
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-43368
    reference_type:
    reference_id: CVE-2024-43368
