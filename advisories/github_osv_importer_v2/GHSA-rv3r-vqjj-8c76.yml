advisory_id: GHSA-rv3r-vqjj-8c76
datasource_id: github_osv_importer_v2/GHSA-rv3r-vqjj-8c76
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/08/GHSA-rv3r-vqjj-8c76/GHSA-rv3r-vqjj-8c76.json
aliases: []
summary: |
  Cross-site scripting from content entered in the tags and multiselect fields
  ### Introduction

  Cross-site scripting (XSS) is a type of vulnerability that allows to execute any kind of JavaScript code inside the Panel session of the same or other users. In the Panel, a harmful script can for example trigger requests to Kirby's API with the permissions of the victim.

  Such vulnerabilities are critical if you might have potential attackers in your group of authenticated Panel users. They can escalate their privileges if they get access to the Panel session of an admin user. Depending on your site, other JavaScript-powered attacks are possible.

  ### Impact

  The tags and multiselect fields allow to select tags from an autocompleted list. The tags field also allows to enter new tags or edit existing tags. Kirby already handled escaping of the autocompleted tags, but unfortunately the Panel used HTML rendering for new or edited tags as well as for custom tags from the content file.

  This allowed **attackers with Panel access** to store malicious HTML code in a tag. The browser of the victim who visited the modified page in the Panel will then have rendered this malicious HTML code.

  It also allowed **self-inflicted XSS attacks** in the tags field (meaning that malicious code is executed in the browser of the user who entered it). This could be used in social engineering attacks where a victim is convinced by an attacker to enter malicious code into a tags field.

  **Visitors without Panel access** could *only* use this attack vector if your site allows changing the content of a tags or multiselect field from a frontend form (for example user self-registration or the creation of pages from a contact or other frontend form). If you validate or sanitize the provided form data, you are already protected against such attacks by external visitors.

  You are also *not* affected by these vulnerabilities if your site doesn't have untrustworthy users with Panel access or a way to modify field values from the frontend or if you don't use the tags or multiselect fields.

  ### Patches

  The problems have been patched in [Kirby 3.5.8.1](https://github.com/getkirby/kirby/releases/tag/3.5.8.1), [Kirby 3.6.6.1](https://github.com/getkirby/kirby/releases/tag/3.6.6.1) and [Kirby 3.7.4](https://github.com/getkirby/kirby/releases/tag/3.7.4). Please update to one of these or a [later version](https://github.com/getkirby/kirby/releases) to fix the vulnerabilities.

  **Note:** The fixes for these vulnerabilities have the side effect that values in the tags and multiselect fields that come from dynamic options are displayed with double escaping (e.g. the `&` character is displayed as `&amp;`). In the fix for Kirby 3.5, every value in the tags field is displayed with double escaping when dynamic options are enabled, while dynamic options themselves are displayed with triple escaping. We will fix the double/triple escaping issues with a refactoring of the options fields (tags, multiselect, checkboxes, radio, select and toggles) in Kirby 3.8.

  ### Workarounds

  We recommend to update to one of the patch releases. If you cannot update immediately, you can work around the issue by disabling the tags and multiselect fields. This can be done by uncommenting these fields from all your blueprints.
impacted_packages:
  - purl: pkg:composer/getkirby/cms
    affected_versions: vers:composer/>=3.5.7|<3.5.8+1
    fixed_versions: vers:composer/3.5.8+1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:composer/getkirby/cms
    affected_versions: vers:composer/>=3.6.0|<3.6.6+1
    fixed_versions: vers:composer/3.6.6+1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:composer/getkirby/cms
    affected_versions: vers:composer/>=3.7.0|<3.7.4
    fixed_versions: vers:composer/3.7.4
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:L/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/08/GHSA-rv3r-vqjj-8c76/GHSA-rv3r-vqjj-8c76.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-79
references:
  - url: https://github.com/getkirby/kirby
    reference_type:
    reference_id:
  - url: https://github.com/getkirby/kirby/security/advisories/GHSA-rv3r-vqjj-8c76
    reference_type:
    reference_id:
