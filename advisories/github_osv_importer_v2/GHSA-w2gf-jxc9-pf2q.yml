advisory_id: GHSA-w2gf-jxc9-pf2q
datasource_id: github_osv_importer_v2/GHSA-w2gf-jxc9-pf2q
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/01/GHSA-w2gf-jxc9-pf2q/GHSA-w2gf-jxc9-pf2q.json
aliases:
  - CVE-2024-41672
summary: "sniff_csv provides filesystem access even when enable_external_access is disabled\
  \ in duckdb\n### Summary\nContent in filesystem is accessible for reading using `sniff_csv`,\
  \ even with `enable_external_access=false`. \n\n### Details\nDuring a pentest, a security\
  \ researcher was able to access environment variable data and other system data by using the\
  \ `sniff_csv` function, even though we set `enable_external_access` to false. \n\n### PoC\n\
  ```SQL\nSET enable_external_access=false;\nSET lock_configuration=true;\n\nSELECT Columns\
  \ FROM sniff_csv('/proc/self/environ');\n```\n\n### Impact\nProvides an attacker with access\
  \ to filesystem even when access is expected to be disabled and other similar functions do\
  \ NOT provide access. \n\nFor example `select * from read_csv('/proc/self/environ')` fails\
  \ with a permission error. \n\nThere seems to be two vectors to this vulnerability: \n1. Access\
  \ to files that should otherwise not be allowed. (We expect `Permission Error: Scanning CSV\
  \ files is disabled through configuration` and not to provide any access to the file or even\
  \ acknowledge that it exists). \n2. The content from a (non-csv?) file can be read (e.g. `/etc/hosts`,\
  \ `proc/self/environ`, etc) even though that doesn't seem to be the intent of the sniff_csv\
  \ function (my understanding is it's intending to provide information about the shape of the\
  \ data, but not provide the data itself). \n\n### Workaround\nIt is possible to work around\
  \ the issue by disabling the local file system using the `disabled_filesystems` setting:\n\
  ```SQL\nSET disabled_filesystems='LocalFileSystem';\nSET lock_configuration=true;\n\nSELECT\
  \ Columns FROM sniff_csv('/proc/self/environ');\n```\n\nwill result in `Permission Error:\
  \ File system LocalFileSystem has been disabled by configuration`.\n\n### Fix\nA fix has been\
  \ merged into the `main` branch (https://github.com/duckdb/duckdb/pull/13133), and will be\
  \ released with the next DuckDB release."
impacted_packages:
  - purl: pkg:pypi/duckdb
    affected_versions: vers:pypi/>=1.0.0|<1.1.0
    fixed_versions: vers:pypi/1.1.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/01/GHSA-w2gf-jxc9-pf2q/GHSA-w2gf-jxc9-pf2q.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-200
references:
  - url: https://github.com/duckdb/duckdb
    reference_type:
    reference_id:
  - url: https://github.com/duckdb/duckdb/commit/c9b7c98aa0e1cd7363fe8bb8543a95f38e980d8a
    reference_type:
    reference_id:
  - url: https://github.com/duckdb/duckdb/pull/13133
    reference_type:
    reference_id:
  - url: https://github.com/duckdb/duckdb/security/advisories/GHSA-w2gf-jxc9-pf2q
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/duckdb/PYSEC-2024-203.yaml
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-41672
    reference_type:
    reference_id: CVE-2024-41672
