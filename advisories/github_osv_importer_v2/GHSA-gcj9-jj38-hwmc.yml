advisory_id: GHSA-gcj9-jj38-hwmc
datasource_id: github_osv_importer_v2/GHSA-gcj9-jj38-hwmc
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/06/GHSA-gcj9-jj38-hwmc/GHSA-gcj9-jj38-hwmc.json
aliases:
  - CVE-2021-21328
summary: |
  Vapor's Metrics integration could cause a system drain
  ### Impact
  This is a DoS attack against anyone who Bootstraps a metrics backend for their Vapor app with the following attack vector:

  1. send unlimited requests against a vapor instance with different paths. this will create “unlimited” counters and timers, which will eventually drain the system.
  2. downstream services might suffer from this attack as well by being spammed with error paths

  ### Patches
  This has been patched in 4.40.1. The `DefaultResponder` will rewrite any undefined route paths for to `vapor_route_undefined` to avoid unlimited counters.

  ### Workarounds
  Don't bootstrap a metrics system or upgrade to 4.40.1

  ### For more information
  If you have any questions or comments about this advisory:
  * Open an issue in [Vapor](https://github.com/vapor/vapor)
  * Ask in [Discord](http://vapor.team)
impacted_packages: []
severities:
  - score: '5.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/06/GHSA-gcj9-jj38-hwmc/GHSA-gcj9-jj38-hwmc.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-400
references:
  - url: https://github.com/vapor/vapor
    reference_type:
    reference_id:
  - url: https://github.com/vapor/vapor/commit/e3aa712508db2854ac0ab905696c65fd88fa7e23
    reference_type:
    reference_id:
  - url: https://github.com/vapor/vapor/releases/tag/4.40.1
    reference_type:
    reference_id:
  - url: https://github.com/vapor/vapor/security/advisories/GHSA-gcj9-jj38-hwmc
    reference_type:
    reference_id:
  - url: https://vapor.codes
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-21328
    reference_type:
    reference_id: CVE-2021-21328
