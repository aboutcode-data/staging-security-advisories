advisory_id: GHSA-pwqm-x5x6-5586
datasource_id: github_osv_importer_v2/GHSA-pwqm-x5x6-5586
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/03/GHSA-pwqm-x5x6-5586/GHSA-pwqm-x5x6-5586.json
aliases:
  - CVE-2024-28860
summary: |
  Cilium has insecure IPsec transport encryption
  ### Impact

  Users of [IPsec transparent encryption](https://docs.cilium.io/en/stable/security/network/encryption-ipsec/) in Cilium may be vulnerable to cryptographic attacks that render the transparent encryption ineffective.

  In particular, Cilium is vulnerable to the following attacks by a man-in-the-middle attacker:

  - Chosen plaintext attacks
  - Key recovery attacks
  - Replay attacks

  These attacks are possible due to an ESP sequence number collision when multiple nodes are configured with the same key. Fixed versions of Cilium use unique keys for each IPsec tunnel established between nodes, resolving all of the above attacks.

  **Important:** After upgrading, users must perform a key rotation using the instructions [here](https://docs.cilium.io/en/latest/security/network/encryption-ipsec/#key-rotation) to ensure that they are no longer vulnerable to this issue. Please note that the key rotation instructions have recently been updated, and users must use the new instructions to properly establish secure IPsec tunnels. To validate that the new instructions have been followed properly, ensure that the IPsec Kubernetes secret contains a "+" sign.

  ### Patches

  All prior versions of Cilium that support IPsec transparent encryption (Cilium 1.4 onwards) are affected by this issue.

  Patched versions:

  - Cilium 1.15.3
  - Cilium 1.14.9
  - Cilium 1.13.14

  ### Workarounds

  There is no workaround to this issue. IPsec transparent encryption users are strongly encouraged to upgrade.

  ### Acknowledgements

  The Cilium community has worked together with members of Cure53 and Isovalent to prepare these mitigations. Special thanks to @NikAleksandrov and @pchaigno for their work on remediating the issue. Thanks to Marsh Ray, Senior Software Developer at Microsoft, for input and guidance on the fix.

  ### For more information
  If you have any questions or comments about this advisory, please reach out on [Slack](https://docs.cilium.io/en/latest/community/community/#slack).

  As usual, if you think you found a related vulnerability, we strongly encourage you to report security vulnerabilities to our private security mailing list: [security@cilium.io](mailto:security@cilium.io) - first, before disclosing them in any public forums. This is a private mailing list where only members of the Cilium internal security team are subscribed to, and is treated as top priority.
impacted_packages: []
severities:
  - score: '8.0'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:A/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/03/GHSA-pwqm-x5x6-5586/GHSA-pwqm-x5x6-5586.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-326
references:
  - url: https://docs.cilium.io/en/stable/security/network/encryption-ipsec
    reference_type:
    reference_id:
  - url: https://github.com/cilium/cilium
    reference_type:
    reference_id:
  - url: https://github.com/cilium/cilium/commit/311fbce5280491cddceab178d83b06fa23688c72
    reference_type:
    reference_id:
  - url: https://github.com/cilium/cilium/commit/a1742b478306fa256cd27df1039dfae0537b4149
    reference_type:
    reference_id:
  - url: https://github.com/cilium/cilium/commit/a652c123331852cca90c74202f993d4170fd37fa
    reference_type:
    reference_id:
  - url: https://github.com/cilium/cilium/security/advisories/GHSA-pwqm-x5x6-5586
    reference_type:
    reference_id:
  - url: https://pkg.go.dev/vuln/GO-2024-2666
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-28860
    reference_type:
    reference_id: CVE-2024-28860
