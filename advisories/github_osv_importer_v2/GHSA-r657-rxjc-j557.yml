advisory_id: GHSA-r657-rxjc-j557
datasource_id: github_osv_importer_v2/GHSA-r657-rxjc-j557
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/10/GHSA-r657-rxjc-j557/GHSA-r657-rxjc-j557.json
aliases:
  - CVE-2025-61780
summary: |
  Rack has a Possible Information Disclosure Vulnerability
  ## Summary

  A possible information disclosure vulnerability existed in `Rack::Sendfile` when running behind a proxy that supports `x-sendfile` headers (such as Nginx). Specially crafted headers could cause `Rack::Sendfile` to miscommunicate with the proxy and trigger unintended internal requests, potentially bypassing proxy-level access restrictions.

  ## Details

  When `Rack::Sendfile` received untrusted `x-sendfile-type` or `x-accel-mapping` headers from a client, it would interpret them as proxy configuration directives. This could cause the middleware to send a "redirect" response to the proxy, prompting it to reissue a new internal request that was **not subject to the proxy's access controls**.

  An attacker could exploit this by:
  1. Setting a crafted `x-sendfile-type: x-accel-redirect` header.
  2. Setting a crafted `x-accel-mapping` header.
  3. Requesting a path that qualifies for proxy-based acceleration.

  ## Impact

  Attackers could bypass proxy-enforced restrictions and access internal endpoints intended to be protected (such as administrative pages). The vulnerability did not allow arbitrary file reads but could expose sensitive application routes.

  This issue only affected systems meeting all of the following conditions:

  * The application used `Rack::Sendfile` with a proxy that supports `x-accel-redirect` (e.g., Nginx).
  * The proxy did **not** always set or remove the `x-sendfile-type` and `x-accel-mapping` headers.
  * The application exposed an endpoint that returned a body responding to `.to_path`.

  ## Mitigation

  * Upgrade to a fixed version of Rack which requires explicit configuration to enable `x-accel-redirect`:

    ```ruby
    use Rack::Sendfile, "x-accel-redirect"
    ```

  * Alternatively, configure the proxy to always set or strip the headers (you should be doing this!):

    ```nginx
    proxy_set_header x-sendfile-type x-accel-redirect;
    proxy_set_header x-accel-mapping /var/www/=/files/;
    ```

  * Or in Rails applications, disable sendfile completely:

    ```ruby
    config.action_dispatch.x_sendfile_header = nil
    ```
impacted_packages:
  - purl: pkg:gem/rack
    affected_versions: vers:gem/<2.2.20
    fixed_versions: vers:gem/2.2.20
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/rack
    affected_versions: vers:gem/>=3.0|<3.1.18
    fixed_versions: vers:gem/3.1.18
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/rack
    affected_versions: vers:gem/>=3.2|<3.2.3
    fixed_versions: vers:gem/3.2.3
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '5.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:N/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/10/GHSA-r657-rxjc-j557/GHSA-r657-rxjc-j557.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-441
  - CWE-200
  - CWE-913
references:
  - url: https://github.com/rack/rack
    reference_type:
    reference_id:
  - url: https://github.com/rack/rack/commit/57277b7741581fa827472c5c666f6e6a33abd784
    reference_type:
    reference_id:
  - url: https://github.com/rack/rack/commit/7e69f65eefe9cd2868df9f9f3b0977b86f93523a
    reference_type:
    reference_id:
  - url: https://github.com/rack/rack/commit/fba2c8bc63eb787ff4b19bc612d315fda6126d85
    reference_type:
    reference_id:
  - url: https://github.com/rack/rack/security/advisories/GHSA-r657-rxjc-j557
    reference_type:
    reference_id:
  - url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/rack/CVE-2025-61780.yml
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-61780
    reference_type:
    reference_id:
