advisory_id: GHSA-c5f8-35qr-q4fm
datasource_id: github_osv_importer_v2/GHSA-c5f8-35qr-q4fm
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/03/GHSA-c5f8-35qr-q4fm/GHSA-c5f8-35qr-q4fm.json
aliases:
  - CVE-2021-21333
summary: |
  HTML injection in email and account expiry notifications
  ### Impact
  The notification emails sent for notifications for missed messages or for an expiring account are subject to HTML injection. In the case of the notification for missed messages, this could allow an attacker to insert forged content into the email.

  The account expiry feature is not enabled by default and the HTML injection is not controllable by an attacker.

  ### Patches
  This issue is fixed in #9200.

  ### Workarounds
  For the missed messages notifications:

  The `notif.html`, `notif_mail.html`, and `room.html` templates can be overridden with custom templates that manually escapes the variables using [JInja2's `escape` filter](https://jinja.palletsprojects.com/en/2.11.x/templates/#escape). See the `email.template_dir` setting.

  For the account expiry notifications:

  1. Account expiry can be disabled via the `account_validity.enabled` setting.

  2. The `notice_expiry.html` template can be overridden with a custom template that manually escapes the variables using [JInja2's `escape` filter](https://jinja.palletsprojects.com/en/2.11.x/templates/#escape). See the `email.template_dir` setting.
impacted_packages:
  - purl: pkg:pypi/matrix-synapse
    affected_versions: vers:pypi/<1.27.0
    fixed_versions: vers:pypi/1.27.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '6.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:C/C:N/I:H/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/03/GHSA-c5f8-35qr-q4fm/GHSA-c5f8-35qr-q4fm.json
  - score: '4.9'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:P/PR:N/UI:P/VC:N/VI:N/VA:N/SC:N/SI:H/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/03/GHSA-c5f8-35qr-q4fm/GHSA-c5f8-35qr-q4fm.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-79
  - CWE-74
references:
  - url: https://github.com/matrix-org/synapse
    reference_type:
    reference_id:
  - url: https://github.com/matrix-org/synapse/commit/e54746bdf7d5c831eabe4dcea76a7626f1de73df
    reference_type:
    reference_id:
  - url: https://github.com/matrix-org/synapse/pull/9200
    reference_type:
    reference_id:
  - url: https://github.com/matrix-org/synapse/releases/tag/v1.27.0
    reference_type:
    reference_id:
  - url: https://github.com/matrix-org/synapse/security/advisories/GHSA-c5f8-35qr-q4fm
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/matrix-synapse/PYSEC-2021-134.yaml
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-21333
    reference_type:
    reference_id: CVE-2021-21333
