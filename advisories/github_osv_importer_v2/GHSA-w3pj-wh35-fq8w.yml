advisory_id: GHSA-w3pj-wh35-fq8w
datasource_id: github_osv_importer_v2/GHSA-w3pj-wh35-fq8w
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/02/GHSA-w3pj-wh35-fq8w/GHSA-w3pj-wh35-fq8w.json
aliases:
  - CVE-2024-36404
summary: |
  GeoTools Remote Code Execution (RCE) vulnerability in evaluating XPath expressions
  ### Summary
  Remote Code Execution (RCE) is possible if an application uses certain GeoTools functionality to evaluate XPath expressions supplied by user input.

  ### Details
  The following methods pass XPath expressions to the `commons-jxpath` library which can execute arbitrary code and would be a security issue if the XPath expressions are provided by user input.

  * `org.geotools.appschema.util.XmlXpathUtilites.getXPathValues(NamespaceSupport, String, Document)`
  * `org.geotools.appschema.util.XmlXpathUtilites.countXPathNodes(NamespaceSupport, String, Document)`
  * `org.geotools.appschema.util.XmlXpathUtilites.getSingleXPathValue(NamespaceSupport, String, Document)`
  * `org.geotools.data.complex.expression.FeaturePropertyAccessorFactory.FeaturePropertyAccessor.get(Object, String, Class<T>)`
  * `org.geotools.data.complex.expression.FeaturePropertyAccessorFactory.FeaturePropertyAccessor.set(Object, String, Object, Class)`
  * `org.geotools.data.complex.expression.MapPropertyAccessorFactory.new PropertyAccessor() {...}.get(Object, String, Class<T>)`
  * `org.geotools.xsd.StreamingParser.StreamingParser(Configuration, InputStream, String)`

  ### PoC
  The following inputs to StreamingParser will delay the response by five seconds:
  ```
          new org.geotools.xsd.StreamingParser(
                          new org.geotools.filter.v1_0.OGCConfiguration(),
                          new java.io.ByteArrayInputStream("<Filter></Filter>".getBytes()),
                          "java.lang.Thread.sleep(5000)")
                  .parse();
  ```

  ### Impact

  This vulnerability can lead to executing arbitrary code.

  ### Mitigation

  GeoTools can operate with reduced functionality by removing the `gt-complex` jar from your application.  As an example of the impact application schema datastore would not function without the ability to use XPath expressions to query complex content.

  The SourceForge download page lists drop-in-replacement jars for GeoTools: [31.1](https://sourceforge.net/projects/geotools/files/GeoTools%2031%20Releases/31.1/), [30.3](https://sourceforge.net/projects/geotools/files/GeoTools%2030%20Releases/30.3/geotools-30.3-patches.zip/download), [30.2](https://sourceforge.net/projects/geotools/files/GeoTools%2030%20Releases/30.2/geotools-30.2-patches.zip/download), [29.2](https://sourceforge.net/projects/geotools/files/GeoTools%2029%20Releases/29.2/geotools-29.2-patches.zip/download), [28.2](https://sourceforge.net/projects/geotools/files/GeoTools%2028%20Releases/28.2/geotools-28.2-patches.zip/download), [27.5](https://sourceforge.net/projects/geotools/files/GeoTools%2027%20Releases/27.5/geotools-27.5-patches.zip/download), [27.4](https://sourceforge.net/projects/geotools/files/GeoTools%2027%20Releases/27.4/geotools-27.4-patches.zip/download), [26.7](https://sourceforge.net/projects/geotools/files/GeoTools%2026%20Releases/26.7/geotools-26.7-patches.zip/download), [26.4](https://sourceforge.net/projects/geotools/files/GeoTools%2026%20Releases/26.4/), [25.2](https://sourceforge.net/projects/geotools/files/GeoTools%2025%20Releases/25.2/geotools-25.2-patches.zip/download), [24.0](https://sourceforge.net/projects/geotools/files/GeoTools%2024%20Releases/24.0/geotools-24.0-patches.zip/download). These jars are for download only and are not available from maven central, intended to quickly provide a fix to affected applications.

  ### References
  https://github.com/geoserver/geoserver/security/advisories/GHSA-6jj6-gm7p-fcvv
  https://osgeo-org.atlassian.net/browse/GEOT-7587
  https://github.com/geotools/geotools/pull/4797
  https://github.com/Warxim/CVE-2022-41852?tab=readme-ov-file#workaround-for-cve-2022-41852
impacted_packages:
  - purl: pkg:maven/org.geotools/gt-app-schema
    affected_versions: vers:maven/>=30.0|<30.4
    fixed_versions: vers:maven/30.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geotools/gt-complex
    affected_versions: vers:maven/>=30.0|<30.4
    fixed_versions: vers:maven/30.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geotools.xsd/gt-xsd-core
    affected_versions: vers:maven/>=30.0|<30.4
    fixed_versions: vers:maven/30.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geotools/gt-app-schema
    affected_versions: vers:maven/>=31.0|<31.2
    fixed_versions: vers:maven/31.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geotools/gt-complex
    affected_versions: vers:maven/>=31.0|<31.2
    fixed_versions: vers:maven/31.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geotools.xsd/gt-xsd-core
    affected_versions: vers:maven/>=31.0|<31.2
    fixed_versions: vers:maven/31.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geotools/gt-app-schema
    affected_versions: vers:maven/>=29.0|<29.6
    fixed_versions: vers:maven/29.6
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geotools/gt-complex
    affected_versions: vers:maven/>=29.0|<29.6
    fixed_versions: vers:maven/29.6
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geotools.xsd/gt-xsd-core
    affected_versions: vers:maven/>=29.0|<29.6
    fixed_versions: vers:maven/29.6
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geotools/gt-app-schema
    affected_versions: vers:maven/<28.6
    fixed_versions: vers:maven/28.6
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geotools/gt-complex
    affected_versions: vers:maven/<28.6
    fixed_versions: vers:maven/28.6
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geotools.xsd/gt-xsd-core
    affected_versions: vers:maven/<28.6
    fixed_versions: vers:maven/28.6
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '9.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/02/GHSA-w3pj-wh35-fq8w/GHSA-w3pj-wh35-fq8w.json
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-95
references:
  - url: https://github.com/geotools/geotools
    reference_type:
    reference_id:
  - url: https://github.com/geotools/geotools/commit/f0c9961dc4d40c5acfce2169fab92805738de5ea
    reference_type:
    reference_id:
  - url: https://github.com/geotools/geotools/pull/4797
    reference_type:
    reference_id:
  - url: https://github.com/geotools/geotools/security/advisories/GHSA-w3pj-wh35-fq8w
    reference_type:
    reference_id:
  - url: https://github.com/Warxim/CVE-2022-41852?tab=readme-ov-file#workaround-for-cve-2022-41852
    reference_type:
    reference_id:
  - url: https://osgeo-org.atlassian.net/browse/GEOT-7587
    reference_type:
    reference_id:
  - url: https://sourceforge.net/projects/geotools/files/GeoTools%2024%20Releases/24.0/geotools-24.0-patches.zip/download
    reference_type:
    reference_id:
  - url: https://sourceforge.net/projects/geotools/files/GeoTools%2025%20Releases/25.2/geotools-25.2-patches.zip/download
    reference_type:
    reference_id:
  - url: https://sourceforge.net/projects/geotools/files/GeoTools%2026%20Releases/26.4
    reference_type:
    reference_id:
  - url: https://sourceforge.net/projects/geotools/files/GeoTools%2026%20Releases/26.7/geotools-26.7-patches.zip/download
    reference_type:
    reference_id:
  - url: https://sourceforge.net/projects/geotools/files/GeoTools%2027%20Releases/27.4/geotools-27.4-patches.zip/download
    reference_type:
    reference_id:
  - url: https://sourceforge.net/projects/geotools/files/GeoTools%2027%20Releases/27.5/geotools-27.5-patches.zip/download
    reference_type:
    reference_id:
  - url: https://sourceforge.net/projects/geotools/files/GeoTools%2028%20Releases/28.2/geotools-28.2-patches.zip/download
    reference_type:
    reference_id:
  - url: https://sourceforge.net/projects/geotools/files/GeoTools%2029%20Releases/29.2/geotools-29.2-patches.zip/download
    reference_type:
    reference_id:
  - url: https://sourceforge.net/projects/geotools/files/GeoTools%2030%20Releases/30.2/geotools-30.2-patches.zip/download
    reference_type:
    reference_id:
  - url: https://sourceforge.net/projects/geotools/files/GeoTools%2030%20Releases/30.3/geotools-30.3-patches.zip/download
    reference_type:
    reference_id:
  - url: https://sourceforge.net/projects/geotools/files/GeoTools%2031%20Releases/31.1
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-36404
    reference_type:
    reference_id: CVE-2024-36404
