advisory_id: GHSA-p543-xpfm-54cp
datasource_id: github_osv_importer_v2/GHSA-p543-xpfm-54cp
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/10/GHSA-p543-xpfm-54cp/GHSA-p543-xpfm-54cp.json
aliases:
  - CVE-2025-61770
summary: |
  Rack's unbounded multipart preamble buffering enables DoS (memory exhaustion)
  ## Summary

  `Rack::Multipart::Parser` buffers the entire multipart **preamble** (bytes before the first boundary) in memory without any size limit. A client can send a large preamble followed by a valid boundary, causing significant memory use and potential process termination due to out-of-memory (OOM) conditions.

  ## Details

  While searching for the first boundary, the parser appends incoming data into a shared buffer (`@sbuf.concat(content)`) and scans for the boundary pattern:

  ```ruby
  @sbuf.scan_until(@body_regex)
  ```

  If the boundary is not yet found, the parser continues buffering data indefinitely. There is no trimming or size cap on the preamble, allowing attackers to send arbitrary amounts of data before the first boundary.

  ## Impact

  Remote attackers can trigger large transient memory spikes by including a long preamble in multipart/form-data requests. The impact scales with allowed request sizes and concurrency, potentially causing worker crashes or severe slowdown due to garbage collection.

  ## Mitigation

  * **Upgrade:** Use a patched version of Rack that enforces a preamble size limit (e.g., 16 KiB) or discards preamble data entirely per [RFC 2046 ยง 5.1.1](https://www.rfc-editor.org/rfc/rfc2046.html#section-5.1.1).
  * **Workarounds:**
    * Limit total request body size at the proxy or web server level.
    * Monitor memory and set per-process limits to prevent OOM conditions.
impacted_packages:
  - purl: pkg:gem/rack
    affected_versions: vers:gem/<2.2.19
    fixed_versions: vers:gem/2.2.19
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/rack
    affected_versions: vers:gem/>=3.1|<3.1.17
    fixed_versions: vers:gem/3.1.17
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/rack
    affected_versions: vers:gem/>=3.2|<3.2.2
    fixed_versions: vers:gem/3.2.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/10/GHSA-p543-xpfm-54cp/GHSA-p543-xpfm-54cp.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-400
references:
  - url: https://github.com/rack/rack
    reference_type:
    reference_id:
  - url: https://github.com/rack/rack/commit/589127f4ac8b5cf11cf88fb0cd116ffed4d2181e
    reference_type:
    reference_id:
  - url: https://github.com/rack/rack/commit/d869fed663b113b95a74ad53e1b5cae6ab31f29e
    reference_type:
    reference_id:
  - url: https://github.com/rack/rack/commit/e08f78c656c9394d6737c022bde087e0f33336fd
    reference_type:
    reference_id:
  - url: https://github.com/rack/rack/security/advisories/GHSA-p543-xpfm-54cp
    reference_type:
    reference_id:
  - url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/rack/CVE-2025-61770.yml
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-61770
    reference_type:
    reference_id:
