advisory_id: GHSA-6w8h-26xx-cf8q
datasource_id: github_osv_importer_v2/GHSA-6w8h-26xx-cf8q
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/11/GHSA-6w8h-26xx-cf8q/GHSA-6w8h-26xx-cf8q.json
aliases:
  - CVE-2022-41934
summary: |
  Improper Neutralization of Directives in Dynamically Evaluated Code ('Eval Injection') in org.xwiki.platform:xwiki-platform-menu-ui
  ### Impact
  Any user with view rights on commonly accessible documents including the menu macro can execute arbitrary Groovy, Python or Velocity code in XWiki leading to full access to the XWiki installation due to improper escaping of the macro content and parameters of the menu macro.

  The issue can be demonstrated by opening `<server>/xwiki/bin/view/Main?sheet=CKEditor.HTMLConverter&language=en&sourceSyntax=xwiki%2F2.1&stripHTMLEnvelope=true&fromHTML=false&toHTML=true&text=%7B%7Bmenu%7D%7D%7B%7Bcache+id%3D%22menuMacro%22%7D%7D%7B%7Bgroovy%7D%7Dprintln%28%22Hello+from+Groovy%21%22%29%7B%7B%2Fgroovy%7D%7D%7B%7B%2Fcache%7D%7D%7B%7B%2Fmenu%7D%7D` where `<server>` is the URL of the XWiki installation. If this displays "Hello from Groovy!", the installation is vulnerable.

  ### Patches
  The problem has been patched in XWiki 14.6RC1, 13.10.8 and 14.4.3.

  ### Workarounds
  The [patch](https://github.com/xwiki/xwiki-platform/commit/2fc20891e6c6b0ca05ee07e315e7f435e8919f8d) for the document `Menu.MenuMacro` can be manually applied or a XAR archive of a patched version can be [imported](https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/Imports#HImportingXWikipages). The menu macro was basically unchanged since XWiki 11.6 so on XWiki 11.6 or later the [patch for version of 13.10.8](https://github.com/xwiki/xwiki-platform/commit/59ccca24a8465a19f40c51d65fcc2c09c1edea16) can most likely be applied, on XWiki version 14.0 and later the versions in XWiki 14.6 and 14.4.3 should be appropriate.

  ### References
  * https://github.com/xwiki/xwiki-platform/commit/2fc20891e6c6b0ca05ee07e315e7f435e8919f8d
  * https://jira.xwiki.org/browse/XWIKI-19857

  ### For more information
  If you have any questions or comments about this advisory:
  * Open an issue in [Jira XWiki.org](https://jira.xwiki.org/)
  * Email us at [Security Mailing List](mailto:security@xwiki.org)
impacted_packages:
  - purl: pkg:maven/org.xwiki.platform/xwiki-platform-menu-ui
    affected_versions: vers:maven/<13.10.8
    fixed_versions: vers:maven/13.10.8
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.xwiki.platform/xwiki-platform-menu-ui
    affected_versions: vers:maven/>=14.0.0|<14.4.3
    fixed_versions: vers:maven/14.4.3
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '9.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/11/GHSA-6w8h-26xx-cf8q/GHSA-6w8h-26xx-cf8q.json
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-116
  - CWE-74
references:
  - url: https://github.com/xwiki/xwiki-platform
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-platform/commit/2fc20891e6c6b0ca05ee07e315e7f435e8919f8d
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-platform/commit/59ccca24a8465a19f40c51d65fcc2c09c1edea16
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-6w8h-26xx-cf8q
    reference_type:
    reference_id:
  - url: https://jira.xwiki.org/browse/XWIKI-19857
    reference_type:
    reference_id:
  - url: https://www.xwiki.org/xwiki/bin/view/Documentation/UserGuide/Features/Imports#HImportingXWikipages
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-41934
    reference_type:
    reference_id: CVE-2022-41934
