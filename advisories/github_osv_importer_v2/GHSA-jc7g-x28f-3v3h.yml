advisory_id: GHSA-jc7g-x28f-3v3h
datasource_id: github_osv_importer_v2/GHSA-jc7g-x28f-3v3h
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/06/GHSA-jc7g-x28f-3v3h/GHSA-jc7g-x28f-3v3h.json
aliases:
  - CVE-2025-49136
summary: |
  listmonk's Sprig template Injection vulnerability leads to reading of Environment Variable for low privilege user
  ### Summary
  The `env` and `expandenv` template functions which is enabled by default in [Sprig](https://masterminds.github.io/sprig/) enables capturing of env variables on the host. While this may not be a problem on single-user (super admin) installations, on multi-user installations, this allows non-super-admin users with campaign or template permissions to use the `{{ env }}` template expression to capture sensitive environment variables.

  **Upgrade to [v5.0.2](https://github.com/knadh/listmonk/releases/tag/v5.0.2)** to mitigate.

  ---------

  # Demonstration

  ### Description
  A critical template injection vulnerability exists in Listmonk's campaign preview functionality that allows authenticated users with minimal privileges (campaigns:get & campaigns:get_all) to extract sensitive system data, including database credentials, SMTP passwords, and admin credentials due to some dangerous function being allowed.

  ### Proof of Concept

  - Create a user and give him `campaigns:get` and `campaigns:get_all` privileges

  ![image](https://github.com/user-attachments/assets/05333695-14d9-498e-9f73-2137d6eca55b)

  - Now login with that user, go to any campaign, go the Content section and here lies the vulnerability, we're able to execute template content which allows us to get environment variables, execute Sprig functions...

  - Now in the text field you can input the following and press Preview:
  ```
  {{ env "AWS_KEY" }}
  {{ env "LISTMONK_db__user" }}
  {{ env "LISTMONK_db__password" }}
  ````

  ![image](https://github.com/user-attachments/assets/ac963f54-5982-47d4-99d0-59030917f548)

  # Preview:

  ![image](https://github.com/user-attachments/assets/99558ca4-81c6-4e1a-bd0d-6bc57830f4d0)

  I had the AWS_KEY variable set like that to confirm the vulnerability:

  ![image](https://github.com/user-attachments/assets/16382998-2402-436a-9bb0-db09fb13dd79)

  ### Impact

  - Through these environment variables the attacker can access, they can fully compromise the database, cloud accounts, admin credentials, and more depending on what was setup leading to total system takeover and data breach.

  ### Suggested Fix

  - Blacklist some function for templates like env, expandEnv and fail as they can be used to leak environment variables which leads to a full takeover.
impacted_packages: []
severities:
  - score: '9.0'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/06/GHSA-jc7g-x28f-3v3h/GHSA-jc7g-x28f-3v3h.json
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-1336
references:
  - url: https://github.com/knadh/listmonk
    reference_type:
    reference_id:
  - url: https://github.com/knadh/listmonk/commit/d27d2c32cf3af2d0b24e29ea5a686ba149b49b3e
    reference_type:
    reference_id:
  - url: https://github.com/knadh/listmonk/releases/tag/v5.0.2
    reference_type:
    reference_id:
  - url: https://github.com/knadh/listmonk/security/advisories/GHSA-jc7g-x28f-3v3h
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-49136
    reference_type:
    reference_id: CVE-2025-49136
