advisory_id: GHSA-5r27-rw8r-7967
datasource_id: github_osv_importer_v2/GHSA-5r27-rw8r-7967
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/08/GHSA-5r27-rw8r-7967/GHSA-5r27-rw8r-7967.json
aliases:
  - CVE-2023-38704
summary: |
  import-in-the-middle has unsanitized user controlled input in module generation
  ### Impact
  The `import-in-the-middle` loader works by generating a wrapper module on the fly. The wrapper uses the module specifier to load the original module and add some wrapping code. It allows for remote code execution in cases where an application passes user-supplied input directly to an import() function.

  ### Patches
  This vulnerability has been patched in `import-in-the-middle` version 1.4.2

  ### Workarounds
  * Do not pass any user-supplied input to `import()`. Instead, verify it against a set of allowed values.
  * If using `import-in-the-middle` and support for EcmaScript Modules is not needed, ensure that none of the following options are set (either via command-line or the `NODE_OPTIONS` environment variable):
  ```
  --loader=import-in-the-middle/hook.mjs
  --loader import-in-the-middle/hook.mjs
  ```

  ### References
  If you have any questions or comments about this advisory, email us at [security@datadoghq.com](mailto:security@datadoghq.com)
impacted_packages:
  - purl: pkg:npm/import-in-the-middle
    affected_versions: vers:npm/<=1.4.1
    fixed_versions: vers:npm/1.4.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '8.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:L/A:L
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/08/GHSA-5r27-rw8r-7967/GHSA-5r27-rw8r-7967.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-20
references:
  - url: https://github.com/DataDog/import-in-the-middle
    reference_type:
    reference_id:
  - url: https://github.com/DataDog/import-in-the-middle/commit/2531cdd9d1d73f9eaa87c16967f60cb276c1971b
    reference_type:
    reference_id:
  - url: https://github.com/DataDog/import-in-the-middle/security/advisories/GHSA-5r27-rw8r-7967
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-38704
    reference_type:
    reference_id: CVE-2023-38704
