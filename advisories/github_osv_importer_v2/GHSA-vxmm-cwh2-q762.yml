advisory_id: GHSA-vxmm-cwh2-q762
datasource_id: github_osv_importer_v2/GHSA-vxmm-cwh2-q762
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/05/GHSA-vxmm-cwh2-q762/GHSA-vxmm-cwh2-q762.json
aliases:
  - CVE-2023-32675
summary: |
  Vyper's nonpayable default functions are sometimes payable
  ### Impact
  in contracts with at least one regular nonpayable function, due to the callvalue check being inside of the selector section, it is possible to send funds to the default function by using less than 4 bytes of calldata, even if the default function is marked `nonpayable`. this applies to contracts compiled with vyper<=0.3.7.
  ```vyper
  # @version 0.3.7

  # implicitly nonpayable
  @external
  def foo() -> uint256:
      return 1

  # implicitly nonpayable
  @external
  def __default__():
      # could receive ether here
      pass
  ```

  ### Patches
  this was fixed by the removal of the global calldatasize check in https://github.com/vyperlang/vyper/commit/02339dfda0f3caabad142060d511d10bfe93c520.

  ### Workarounds
  don't use nonpayable default functions
impacted_packages:
  - purl: pkg:pypi/vyper
    affected_versions: vers:pypi/<0.3.8
    fixed_versions: vers:pypi/0.3.8
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '3.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:L/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/05/GHSA-vxmm-cwh2-q762/GHSA-vxmm-cwh2-q762.json
  - score: '6.3'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:P/PR:N/UI:N/VC:N/VI:L/VA:N/SC:N/SI:N/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/05/GHSA-vxmm-cwh2-q762/GHSA-vxmm-cwh2-q762.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-670
references:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/vyper/PYSEC-2023-80.yaml
    reference_type:
    reference_id:
  - url: https://github.com/vyperlang/vyper
    reference_type:
    reference_id:
  - url: https://github.com/vyperlang/vyper/commit/02339dfda0f3caabad142060d511d10bfe93c520
    reference_type:
    reference_id:
  - url: https://github.com/vyperlang/vyper/commit/02339dfda0f3caabad142060d511d10bfe93c520.
    reference_type:
    reference_id:
  - url: https://github.com/vyperlang/vyper/commit/903727006c1e5ebef99fa9fd5d51d62bd33d72a9
    reference_type:
    reference_id:
  - url: https://github.com/vyperlang/vyper/security/advisories/GHSA-vxmm-cwh2-q762
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-32675
    reference_type:
    reference_id: CVE-2023-32675
