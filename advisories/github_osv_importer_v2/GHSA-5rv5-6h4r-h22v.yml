advisory_id: GHSA-5rv5-6h4r-h22v
datasource_id: github_osv_importer_v2/GHSA-5rv5-6h4r-h22v
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/10/GHSA-5rv5-6h4r-h22v/GHSA-5rv5-6h4r-h22v.json
aliases:
  - CVE-2023-43810
summary: |
  opentelemetry-instrumentation Denial of Service vulnerability due to unbound cardinality metrics
  ### Summary
  Autoinstrumentation out of the box adds the label `http_method` that has unbound cardinality. It leads to the server's potential memory exhaustion when many malicious requests are sent.

  ### Details
  HTTP method for requests can be easily set by an attacker to be random and long.

  ### PoC
  Send many requests with long randomly generated HTTP methods and observe how memory consumption increases during it. The app can be like [this example from the official docs](https://opentelemetry-python-contrib.readthedocs.io/en/latest/instrumentation/flask/flask.html#id1).

  ### Impact
  In order to be affected program has to be instrumented for HTTP handlers and does not filter any unknown HTTP methods on the level of CDN, LB, previous middleware, etc.

  ### Proposed solution
  For convenience and safe usage of this library, it should by default mark with the label `UNKNOWN` non-standard HTTP methods to show that such requests were made (and this way does not increase cardinality). In case someone wants to stay with the current behavior, library API should allow it. The mechanism with environment variables can be reused - introduce the variable `OTEL_INSTRUMENTATION_HTTP_CAPTURE_ALL_METHODS` that will allow enabling current behavior when someone really wants it.
impacted_packages:
  - purl: pkg:pypi/opentelemetry-instrumentation
    affected_versions: vers:pypi/<0.41b0
    fixed_versions: vers:pypi/0.41b0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/10/GHSA-5rv5-6h4r-h22v/GHSA-5rv5-6h4r-h22v.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-400
references:
  - url: https://github.com/open-telemetry/opentelemetry-python-contrib
    reference_type:
    reference_id:
  - url: https://github.com/open-telemetry/opentelemetry-python-contrib/commit/6007e0c013071e7f8b9612d3bc68aeb9d600d74e
    reference_type:
    reference_id:
  - url: https://github.com/open-telemetry/opentelemetry-python-contrib/releases/tag/v0.41b0
    reference_type:
    reference_id:
  - url: https://github.com/open-telemetry/opentelemetry-python-contrib/security/advisories/GHSA-5rv5-6h4r-h22v
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-43810
    reference_type:
    reference_id: CVE-2023-43810
