advisory_id: GHSA-j8hp-f2mj-586g
datasource_id: github_osv_importer_v2/GHSA-j8hp-f2mj-586g
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/10/GHSA-j8hp-f2mj-586g/GHSA-j8hp-f2mj-586g.json
aliases:
  - CVE-2024-47882
summary: |
  OpenRefine's error page lacks escaping, leading to potential Cross-site Scripting on import of malicious project
  ### Summary

  The built-in "Something went wrong!" error page includes the exception message and exception traceback without escaping HTML tags, enabling injection into the page if an attacker can reliably produce an error with an attacker-influenced message.

  It appears that the only way to reach this code in OpenRefine itself is for an attacker to somehow convince a victim to import a malicious file, as in GHSA-m88m-crr9-jvqq, which may be difficult.  However, out-of-tree extensions may add their own calls to `respondWithErrorPage`.

  ### Details

  The `Command.respondWithErrorPage` (through `HttpUtilities.respondWithErrorPage`) function renders the Velocity template `error.vt`, which contains the `$message` and `$stack` variables, which are included in the response as-is:

  https://github.com/OpenRefine/OpenRefine/blob/master/main/webapp/modules/core/error.vt#L52-L53

  However, the message can contain HTML tags, which would then be interpreted by the browser. A mitigation would be to escape both the message and stack trace, perhaps using Guava's HTML escaper.

  Flows that report errors as `application/json` responses are not interpreted by the browser and so not affected by this issue.

  ### PoC

  In OpenRefine, use the "Import project" feature to import the following URL (or upload it as a file): https://wandernauta.nl/oa/example.tar.gz

  A JavaScript alert appears.

  ### Impact

  Execution of arbitrary JavaScript in the victim's browser, provided the victim can be convinced to import a malicious project. The script can do anything the user can do.
impacted_packages:
  - purl: pkg:maven/org.openrefine/openrefine
    affected_versions: vers:maven/<3.8.3
    fixed_versions: vers:maven/3.8.3
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '5.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:L/I:H/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/10/GHSA-j8hp-f2mj-586g/GHSA-j8hp-f2mj-586g.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-81
  - CWE-79
references:
  - url: https://github.com/OpenRefine/OpenRefine
    reference_type:
    reference_id:
  - url: https://github.com/OpenRefine/OpenRefine/blob/master/main/webapp/modules/core/error.vt#L52-L53
    reference_type:
    reference_id:
  - url: https://github.com/OpenRefine/OpenRefine/commit/85594e75e7b36025f7b6a67dcd3ec253c5dff8c2
    reference_type:
    reference_id:
  - url: https://github.com/OpenRefine/OpenRefine/security/advisories/GHSA-j8hp-f2mj-586g
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-47882
    reference_type:
    reference_id: CVE-2024-47882
