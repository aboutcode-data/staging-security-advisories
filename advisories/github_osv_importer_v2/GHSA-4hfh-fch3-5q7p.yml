advisory_id: GHSA-4hfh-fch3-5q7p
datasource_id: github_osv_importer_v2/GHSA-4hfh-fch3-5q7p
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2026/02/GHSA-4hfh-fch3-5q7p/GHSA-4hfh-fch3-5q7p.json
aliases:
  - CVE-2026-27120
summary: "Leaf-kit html escaping does not work on characters that are part of extended grapheme\
  \ cluster\n### Summary\n\n`htmlEscaped` in leaf-kit will only escape html  special characters\
  \ if the extended grapheme clusters match, which allows bypassing escaping by using an extended\
  \ grapheme cluster containing both the special html character and some additional characters.\
  \ In the case of html attributes, this can lead to XSS if there is a leaf variable in the\
  \ attribute that is user controlled.\n\n### Details\n\nRelevant code:\nhttps://github.com/vapor/leaf-kit/blob/main/Sources/LeafKit/String%2BHTMLEscape.swift#L14\n\
  \nStrings in Swift are based on extended grapheme clusters. HTML on the other hand is based\
  \ on unicode characters. \n\nFor example if you have the sequence \"́  (U+0022 Quotation mark\
  \ followed by U+0301 Combining Acute Accent). To HTML this is just a quote mark followed by\
  \ some other random character. To swift this is one extended grapheme cluster that does not\
  \ equal a quotation mark by itself which is a different extended grapheme cluster.\n\nThus\
  \ `\"\\\"́\".replacingOccurrences(of: \"\\\"\", with: \"&quot;\")` does not replace the quote\
  \ mark. This allows you to break out of html attributes.\n\nI believe replacingOccurences\
  \ takes an optional third parameter that allows you to specify options to make it work on\
  \ UTF-8 characters instead of grapheme clusters, which would be a good fix for this issue.\n\
  \nI see depending on version, leafkit might use `replacing` instead of `replacingOccurences`.\
  \ I don't know swift that well and couldn't find docs on what replacing does, so I don't know\
  \ if both versions of the function are affected. The version of swift i was testing on I believe\
  \ was using replacingOccurences\n\nIt seems like replacingOccurences will skip past prefix\
  \ characters of extended grapheme clusters, which is what would be needed in order to meaningfully\
  \ bypass esaping of <. Thus i think this is mostly limited to attributes and not general text.\n\
  \n### PoC\n\nAn example vapor application that is vulnerable might look like\n\nroutes.swift\n\
  ```swift\nimport Vapor\n\nstruct Hello: Content {\n    var msg: String?\n}\n\nfunc routes(_\
  \ app: Application) throws {\n    app.post { req throws in\n\tlet Hello = try req.content.decode(Hello.self)\n\
  \        return req.view.render(\"hello\", [\n            \"msg\": Hello.msg ?? \"Hello World!\"\
  \n        ])\n    }\n}\n```\n\nWith a hello.leaf that looks like\n```\n<div title=\"#(msg)\"\
  >Hover to see message</div>\n```\n\nAnd then you POST something like `msg=%22%cc%81=1%20autofocus%20tabindex=0%20onfocus=alert(1)%20`\n\
  \n### Impact\nIf a website uses leaf to escape an attribute value based on user input, the\
  \ attacker may be able to insert a malicious attribute. If a site is not using a secure CSP\
  \ policy, then this can be used to execute malicious javascript (XSS). Impact is context dependent\
  \ if a site is using a secure CSP policy."
impacted_packages: []
severities:
  - score: '6.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2026/02/GHSA-4hfh-fch3-5q7p/GHSA-4hfh-fch3-5q7p.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-75
  - CWE-87
  - CWE-79
references:
  - url: https://github.com/vapor/leaf-kit
    reference_type:
    reference_id:
  - url: https://github.com/vapor/leaf-kit/commit/8919e39476c3a4ba05c28b71546bb9195f87ef34
    reference_type:
    reference_id:
  - url: https://github.com/vapor/leaf-kit/security/advisories/GHSA-4hfh-fch3-5q7p
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2026-27120
    reference_type:
    reference_id: CVE-2026-27120
