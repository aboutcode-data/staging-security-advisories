advisory_id: GHSA-7cc2-r658-7xpf
datasource_id: github_osv_importer_v2/GHSA-7cc2-r658-7xpf
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/03/GHSA-7cc2-r658-7xpf/GHSA-7cc2-r658-7xpf.json
aliases:
  - CVE-2024-27918
summary: |
  Coder's OIDC authentication allows email with partially matching domain to register
  ### Summary
  A vulnerability in Coder's OIDC authentication could allow an attacker to bypass the `CODER_OIDC_EMAIL_DOMAIN` verification and create an account with an email not in the allowlist. Deployments are only affected if the OIDC provider allows users to create accounts on the provider (such as public providers like `google.com`).

  ### Details
  During OIDC registration, the user's email was improperly validated against the allowed `CODER_OIDC_EMAIL_DOMAIN`s. This could allow a user with a domain that only partially matched an allowed domain to successfully login or register (e.g. `user@exploitcorp.com` would match the allowed domain `corp.com`).

  An attacker could register a domain name that exploited this vulnerability and register on a Coder instance with a public OIDC provider.

  ### Impact
  Coder instances with OIDC enabled and protected by the `CODER_OIDC_EMAIL_DOMAIN` configuration.

  Coder instances using a private OIDC provider are not affected, as arbitrary users cannot register through a private OIDC provider without first having an account on the provider.

  Public OIDC providers (such as `google.com` without permitted domains set on the OAuth2 App) are impacted.

  GitHub authentication and external authentication are not impacted.

  ### Was my deployment impacted?
  To check if your deployment was exploited:
  - View the audit log on your deployment for unexpected registered users (using the `action:register` filter)
  - Check the users list for unexpected users
      - Users created via this exploit will have a domain that ends with one of the allowed domains but doesnâ€™t fully match (e.g. `@exploitcorp.com` instead of `@corp.com`)

  ### Patched Versions
  This vulnerability is remedied in
  - v2.8.4
  - v2.7.3
  - v2.6.1

  All versions prior to these patches are affected by the vulnerability. **It is recommended that customers upgrade their deployments as soon as possible if they are utilizing OIDC authentication with the `CODER_OIDC_EMAIL_DOMAIN` setting.**

  ### Thanks
  - https://github.com/arcz
  - https://www.trailofbits.com

  ### References
  https://github.com/coder/coder/security/advisories/GHSA-7cc2-r658-7xpf
  https://github.com/coder/coder/commit/4439a920e454a82565e445e4376c669e3b89591c
  https://nvd.nist.gov/vuln/detail/CVE-2024-27918
impacted_packages: []
severities:
  - score: '8.2'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/03/GHSA-7cc2-r658-7xpf/GHSA-7cc2-r658-7xpf.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-20
references:
  - url: https://github.com/coder/coder
    reference_type:
    reference_id:
  - url: https://github.com/coder/coder/commit/1171ce7add017481d28441575024209ac160ecb0
    reference_type:
    reference_id:
  - url: https://github.com/coder/coder/commit/2ba84911f8b02605e5958d5e4a2fe3979ec50b31
    reference_type:
    reference_id:
  - url: https://github.com/coder/coder/commit/2d37eb42e7db656e343fe1f36de5ab1a1a62f4fb
    reference_type:
    reference_id:
  - url: https://github.com/coder/coder/commit/4439a920e454a82565e445e4376c669e3b89591c
    reference_type:
    reference_id:
  - url: https://github.com/coder/coder/security/advisories/GHSA-7cc2-r658-7xpf
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-27918
    reference_type:
    reference_id: CVE-2024-27918
