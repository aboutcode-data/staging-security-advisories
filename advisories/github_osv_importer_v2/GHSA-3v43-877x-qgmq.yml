advisory_id: GHSA-3v43-877x-qgmq
datasource_id: github_osv_importer_v2/GHSA-3v43-877x-qgmq
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2019/09/GHSA-3v43-877x-qgmq/GHSA-3v43-877x-qgmq.json
aliases:
  - CVE-2019-10010
summary: |
  Moderate severity vulnerability that affects league/commonmark
  ## CVE-2019-10010

  ### Impact

  In `league/commonmark` 0.18.2 and below, malicious users can insert double-encoded HTML entities into their Markdown like this:

  ```md
  [XSS](javascript&amp;colon;alert%28&#039;XSS&#039;%29)
  ```

  This library would (correctly) unescape the `&amp;` entity to `&` during the parsing step.  However, **the renderer step would fail to properly re-escape the resulting `&colon;` string**, thus producing the following malicious HTML output:

  ```html
  <p><a href="javascript&colon;alert('XSS')">XSS</a></p>
  ```

  Browsers would interpret `&colon;` as a `:` character and allow the JS to be executed when the link is clicked.

  This vulnerability was present in the upstream library this project was forked from and therefore exists in all prior versions of `league/commonmark`.

  ### Solution

  The new [0.18.3](https://github.com/thephpleague/commonmark/releases/tag/0.18.3) release mirrors [the fix made upstream](https://github.com/commonmark/commonmark.js/commit/c89b35c5fc99bdf1d2181f7f0c9fcb8a1abc27c8) - we no longer attempt to preserve entities when rendering HTML attributes like `href`, `src`, `title`, etc.

  The `$preserveEntities` parameter of `Xml::escape()` is therefore no longer used internally, so it has been deprecated and marked for removal in the next major release (0.19.0).

  ### Credits

   - Mohit Fawaz for identifying the issue
   - Sebastiaan Knijnenburg and Ross Tuck for responsibly disclosing/relaying the issue
   - John MacFarlane for investigating it and implementing the upstream fix we mirrored here

  ### References

   - https://nvd.nist.gov/vuln/detail/CVE-2019-10010
   - https://github.com/thephpleague/commonmark/releases/tag/0.18.3
   - https://github.com/thephpleague/commonmark/issues/353
  - https://github.com/FriendsOfPHP/security-advisories/blob/master/league/commonmark/CVE-2019-10010.yaml
impacted_packages:
  - purl: pkg:composer/league/commonmark
    affected_versions: vers:composer/<0.18.3
    fixed_versions: vers:composer/0.18.3
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '6.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.0/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2019/09/GHSA-3v43-877x-qgmq/GHSA-3v43-877x-qgmq.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-79
references:
  - url: https://github.com/advisories/GHSA-3v43-877x-qgmq
    reference_type:
    reference_id:
  - url: https://github.com/FriendsOfPHP/security-advisories/blob/master/league/commonmark/CVE-2019-10010.yaml
    reference_type:
    reference_id:
  - url: https://github.com/thephpleague/commonmark
    reference_type:
    reference_id:
  - url: https://github.com/thephpleague/commonmark/issues/353
    reference_type:
    reference_id:
  - url: https://github.com/thephpleague/commonmark/releases/tag/0.18.3
    reference_type:
    reference_id:
  - url: https://github.com/thephpleague/commonmark/security/advisories/GHSA-3v43-877x-qgmq
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2019-10010
    reference_type:
    reference_id: CVE-2019-10010
