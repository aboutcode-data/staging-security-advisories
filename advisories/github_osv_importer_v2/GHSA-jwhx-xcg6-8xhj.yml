advisory_id: GHSA-jwhx-xcg6-8xhj
datasource_id: github_osv_importer_v2/GHSA-jwhx-xcg6-8xhj
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/08/GHSA-jwhx-xcg6-8xhj/GHSA-jwhx-xcg6-8xhj.json
aliases:
  - CVE-2024-42367
summary: |
  In aiohttp, compressed files as symlinks are not protected from path traversal
  ### Summary
  Static routes which contain files with compressed variants (`.gz` or `.br` extension) were vulnerable to path traversal outside the root directory if those variants are symbolic links.

  ### Details
  The server protects static routes from path traversal outside the root directory when `follow_symlinks=False` (default).  It does this by resolving the requested URL to an absolute path and then checking that path relative to the root.  However, these checks are not performed when looking for compressed variants in the `FileResponse` class, and symbolic links are then automatically followed when performing `Path.stat()` and `Path.open()` to send the file.

  ### Impact
  Servers with static routes that contain compressed variants as symbolic links, pointing outside the root directory, or that permit users to upload or create such links, are impacted.

  ----

  Patch: https://github.com/aio-libs/aiohttp/pull/8653/files
impacted_packages:
  - purl: pkg:pypi/aiohttp
    affected_versions: vers:pypi/>=3.10.0b1|<3.10.2
    fixed_versions: vers:pypi/3.10.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '4.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:L/I:L/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/08/GHSA-jwhx-xcg6-8xhj/GHSA-jwhx-xcg6-8xhj.json
  - score: '6.3'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:H/AT:P/PR:N/UI:N/VC:L/VI:L/VA:N/SC:N/SI:N/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/08/GHSA-jwhx-xcg6-8xhj/GHSA-jwhx-xcg6-8xhj.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-61
references:
  - url: https://github.com/aio-libs/aiohttp
    reference_type:
    reference_id:
  - url: https://github.com/aio-libs/aiohttp/blob/e0ff5246e1d29b7710ab1a2bbc972b48169f1c05/aiohttp/web_fileresponse.py#L177
    reference_type:
    reference_id:
  - url: https://github.com/aio-libs/aiohttp/blob/e0ff5246e1d29b7710ab1a2bbc972b48169f1c05/aiohttp/web_urldispatcher.py#L674
    reference_type:
    reference_id:
  - url: https://github.com/aio-libs/aiohttp/commit/ce2e9758814527589b10759a20783fb03b98339f
    reference_type:
    reference_id:
  - url: https://github.com/aio-libs/aiohttp/pull/8653
    reference_type:
    reference_id:
  - url: https://github.com/aio-libs/aiohttp/security/advisories/GHSA-jwhx-xcg6-8xhj
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-42367
    reference_type:
    reference_id: CVE-2024-42367
