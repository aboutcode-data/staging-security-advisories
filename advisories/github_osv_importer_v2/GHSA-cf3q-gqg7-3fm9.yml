advisory_id: GHSA-cf3q-gqg7-3fm9
datasource_id: github_osv_importer_v2/GHSA-cf3q-gqg7-3fm9
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/03/GHSA-cf3q-gqg7-3fm9/GHSA-cf3q-gqg7-3fm9.json
aliases:
  - CVE-2025-30157
summary: |
  Envoy crashes when HTTP ext_proc processes local replies
  ### Summary
  Envoy's ext_proc HTTP filter is at risk of crashing if a local reply is sent to the external server due to the filter's life time issue. A known situation is the fail of a websocket handshake will trigger a local reply leading to the crash of Envoy.

  ### PoC
  If both websocket and ext_proc are enabled, a failed handshake will trigger a local reply, thus ext_proc will crash.

  ### Mitigation
  1. Disable websocket traffic
  2. Change the websocket response from backend to always return `101 Switch protocol` based on RFC.
  3. Apply the patch and the ext_proc filter will not send the local reply that is generated by Envoy to the ext_proc server for processing.
  4. Apply the patch that the router will cancel the upstream requests when sending a local reply.

  ### Impact
  Denial of service

  ### Reporter
  Vasilios Syrakis
  Fernando Cainelli
impacted_packages: []
severities:
  - score: '6.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/03/GHSA-cf3q-gqg7-3fm9/GHSA-cf3q-gqg7-3fm9.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-460
references:
  - url: https://github.com/envoyproxy/envoy
    reference_type:
    reference_id:
  - url: https://github.com/envoyproxy/envoy/commit/8eda1b8ef5ba8663d16a737ab99458c039a9b53c
    reference_type:
    reference_id:
  - url: https://github.com/envoyproxy/envoy/security/advisories/GHSA-cf3q-gqg7-3fm9
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-30157
    reference_type:
    reference_id: CVE-2025-30157
