advisory_id: GHSA-f54q-j679-p9hh
datasource_id: github_osv_importer_v2/GHSA-f54q-j679-p9hh
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/07/GHSA-f54q-j679-p9hh/GHSA-f54q-j679-p9hh.json
aliases:
  - CVE-2023-38501
summary: |
  copyparty vulnerable to reflected cross-site scripting via k304 parameter
  ### Summary
  The application contains a reflected cross-site scripting via URL-parameter `?k304=...` and `?setck=...`

  ### Details
  A reflected cross-site scripting (XSS) vulnerability exists in the web interface of the application that could allow an attacker to execute malicious javascript code by tricking users into accessing a malicious link.

  The worst-case outcome of this is being able to move or delete existing files on the server, or upload new files, using the account of the person who clicks the malicious link.

  It is recommended to change the passwords of your copyparty accounts, unless you have inspected your logs and found no trace of attacks.

  ### Checking for exposure
  if copyparty is running behind a reverse proxy, you can check the access-logs for traces of attacks, by grepping for URLs containing `?hc=` with `<` somewhere in its value, for example using the following command:
  * nginx:
    ```bash
    (gzip -dc access.log*.gz; cat access.log) | sed -r 's/" [0-9]+ .*//' | grep -iE '%0[da]%0[da]%0[da]%0[da]|[?&](hc|pw)=.*[<>]'
    ```
  the above commands also check for attacks against GHSA-cw7j-v52w-fp5r

  ### PoC
  `https://localhost:3923/?k304=y%0D%0A%0D%0A%3Cimg+src%3Dcopyparty+onerror%3Dalert(1)%3E`
impacted_packages:
  - purl: pkg:pypi/copyparty
    affected_versions: vers:pypi/<=1.8.6
    fixed_versions: vers:pypi/1.8.7
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '6.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:L
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/07/GHSA-f54q-j679-p9hh/GHSA-f54q-j679-p9hh.json
  - score: '4.8'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:L/AC:L/AT:N/PR:N/UI:P/VC:L/VI:L/VA:L/SC:N/SI:N/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/07/GHSA-f54q-j679-p9hh/GHSA-f54q-j679-p9hh.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-79
references:
  - url: http://packetstormsecurity.com/files/173821/Copyparty-1.8.6-Cross-Site-Scripting.html
    reference_type:
    reference_id:
  - url: https://github.com/9001/copyparty
    reference_type:
    reference_id:
  - url: https://github.com/9001/copyparty/commit/007d948cb982daa05bc6619cd20ee55b7e834c38
    reference_type:
    reference_id:
  - url: https://github.com/9001/copyparty/releases/tag/v1.8.7
    reference_type:
    reference_id:
  - url: https://github.com/9001/copyparty/security/advisories/GHSA-f54q-j679-p9hh
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/copyparty/PYSEC-2023-132.yaml
    reference_type:
    reference_id:
  - url: https://gitlab.com/exploit-database/exploitdb/-/blob/main/exploits/python/webapps/51635.txt
    reference_type: exploit
    reference_id: CVE-2023-38501
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-38501
    reference_type:
    reference_id: CVE-2023-38501
