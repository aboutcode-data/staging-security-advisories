advisory_id: GHSA-w354-2f3c-qvg9
datasource_id: github_osv_importer_v2/GHSA-w354-2f3c-qvg9
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/03/GHSA-w354-2f3c-qvg9/GHSA-w354-2f3c-qvg9.json
aliases:
  - CVE-2022-1438
summary: |
  Keycloak vulnerable to Cross-site Scripting
  A flaw was found in Keycloak. Under specific circumstances, HTML entities are not sanitized during user impersonation, resulting in a Cross-site scripting (XSS) vulnerability.

  ## Details

  This issue is the result of code found in the exception here: [https://github.com/keycloak/keycloak/blob/48835576daa158443f69917ac309e1a7c951bc87/services/src/main/java/org/keycloak/authentication/AuthenticationProcessor.java#L1045](https://github.com/keycloak/keycloak/blob/48835576daa158443f69917ac309e1a7c951bc87/services/src/main/java/org/keycloak/authentication/AuthenticationProcessor.java#L1045)

  ## Steps to reproduce

  When using the legacy admin console:

  1. Sign in as Admin user in first tab.
  2. In that tab create new user in keycloak admin section > intercept user creation request and modify it by including malicious js script there (in username field).
  3. Sign in as newly created user in second tab (same browser window but second tab).
  4. Navigate back to first tab where you are signed in as admin, navigate to admin console which lists all application users.
  5. Choose any user (except newly created malicious one) – modify anything for that user in his settings. E.g. navigate to credentials tab and set new credentials for him. Also set new password as temporary.
  6. After update for that user is made, use impersonate option on that modified user.
  7. You should see window with form which requires providing new credentials – fill it and submit request.
  8. Just after submiting request user will get notified that “You are already authenticated as different user ‘[user + payload]’ in this session. Please sign out first.”  And malicious payload will be executed instantly.
impacted_packages:
  - purl: pkg:maven/org.keycloak/keycloak-services
    affected_versions: vers:maven/<=21.0.0
    fixed_versions:
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '6.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:H/UI:R/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/03/GHSA-w354-2f3c-qvg9/GHSA-w354-2f3c-qvg9.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-79
references:
  - url: https://access.redhat.com/security/cve/cve-2022-1438
    reference_type:
    reference_id:
  - url: https://github.com/keycloak/keycloak
    reference_type:
    reference_id:
  - url: https://github.com/keycloak/keycloak/blob/48835576daa158443f69917ac309e1a7c951bc87/services/src/main/java/org/keycloak/authentication/AuthenticationProcessor.java#L1045
    reference_type:
    reference_id:
  - url: https://github.com/keycloak/keycloak/security/advisories/GHSA-w354-2f3c-qvg9
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=2031904
    reference_type: bug
    reference_id: 2031904
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-1438
    reference_type:
    reference_id: CVE-2022-1438
  - url: https://access.redhat.com/errata/RHSA-2023:1043
    reference_type:
    reference_id: RHSA-2023:1043
  - url: https://access.redhat.com/errata/RHSA-2023:1044
    reference_type:
    reference_id: RHSA-2023:1044
  - url: https://access.redhat.com/errata/RHSA-2023:1045
    reference_type:
    reference_id: RHSA-2023:1045
  - url: https://access.redhat.com/errata/RHSA-2023:1047
    reference_type:
    reference_id: RHSA-2023:1047
  - url: https://access.redhat.com/errata/RHSA-2023:1049
    reference_type:
    reference_id: RHSA-2023:1049
