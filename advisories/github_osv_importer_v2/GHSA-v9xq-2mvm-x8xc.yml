advisory_id: GHSA-v9xq-2mvm-x8xc
datasource_id: github_osv_importer_v2/GHSA-v9xq-2mvm-x8xc
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/10/GHSA-v9xq-2mvm-x8xc/GHSA-v9xq-2mvm-x8xc.json
aliases:
  - CVE-2024-49755
summary: "Duende IdentityServer has insufficient validation of DPoP cnf claim in Local APIs\n\
  ### Impact\nIdentityServer's local API authentication handler performs insufficient validation\
  \ of the `cnf` claim in DPoP access tokens. This allows an attacker to use leaked DPoP access\
  \ tokens at local api endpoints even without possessing the private key for signing proof\
  \ tokens.\n\nNote that this only impacts custom endpoints within an IdentityServer implementation\
  \ that have explicitly used the `LocalApiAuthenticationHandler` for authentication. It does\
  \ not impact:\n- OAuth or OIDC protocol endpoints defined by IdentityServer, such as the authorize\
  \ and token endpoints.\n- Typical UI pages within an IdentityServer implementation, which\
  \ are not normally authorized with the local API authentication handler.\n- The use of DPoP\
  \ to create sender-constrained tokens in IdentityServer that are consumed by external API\
  \ resources.\n- The use of DPoP to sender-constrain refresh tokens issued to public clients.\n\
  \n## Are you affected?\n\nThis vulnerability only affects IdentityServer implementations that\
  \ are using the local APIs feature of IdentityServer and have explicitly enabled DPoP for\
  \ local APIs. The local api authentication handler is configured with a call to either `AddLocalApi`\
  \ or `AddLocalApiAuthentication`, and the opt-in to DPoP for local APIs is enabled via the\
  \ `TokenMode` option. \n\nVulnerable implementations of IdentityServer would have configuration\
  \ code similar to the following:\n\n```cs\nservices.AddAuthentication()\n    .AddLocalApi(\"\
  local\", options => \n    {\n        options.TokenMode = LocalApiTokenMode.DPoPAndBearer;\
  \ // or LocalApiTokenMode.DPoPOnly\n    });\n```\n\n### Patches\nThis vulnerability is patched\
  \ in IdentityServer 7.0.8. Version 6.3 and below are unaffected, as they do not support DPoP\
  \ in Local APIs."
impacted_packages:
  - purl: pkg:nuget/Duende.IdentityServer
    affected_versions: vers:nuget/>=7.0.0|<7.0.8
    fixed_versions: vers:nuget/7.0.8
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '3.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:L/I:N/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/10/GHSA-v9xq-2mvm-x8xc/GHSA-v9xq-2mvm-x8xc.json
  - score: '2.1'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:A/AC:L/AT:P/PR:N/UI:P/VC:L/VI:N/VA:N/SC:N/SI:N/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/10/GHSA-v9xq-2mvm-x8xc/GHSA-v9xq-2mvm-x8xc.json
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-287
references:
  - url: https://github.com/DuendeSoftware/IdentityServer
    reference_type:
    reference_id:
  - url: https://github.com/DuendeSoftware/IdentityServer/commit/f28cac921c1f545afe65af71a9327224755b6dac
    reference_type:
    reference_id:
  - url: https://github.com/DuendeSoftware/IdentityServer/security/advisories/GHSA-v9xq-2mvm-x8xc
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-49755
    reference_type:
    reference_id: CVE-2024-49755
