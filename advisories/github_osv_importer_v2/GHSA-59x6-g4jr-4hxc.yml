advisory_id: GHSA-59x6-g4jr-4hxc
datasource_id: github_osv_importer_v2/GHSA-59x6-g4jr-4hxc
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/06/GHSA-59x6-g4jr-4hxc/GHSA-59x6-g4jr-4hxc.json
aliases:
  - CVE-2023-35042
summary: |
  GeoServer RCE due to improper control of generation of code in jai-ext`Jiffle` map algebra language
  GeoServer 2, in some configurations, allows remote attackers to execute arbitrary code via `java.lang.Runtime.getRuntime().exec` in `wps:LiteralData` within a `wps:Execute` request, as exploited in the wild in June 2023.

  ## RCE in Jiffle

  The Jiffle map algebra language, provided by jai-ext, allows efficiently execute map algebra over large images. A vulnerability [CVE-2022-24816](https://nvd.nist.gov/vuln/detail/CVE-2022-24816) has been recently found in Jiffle, that allows a Code Injection to be performed by properly crafting a Jiffle invocation.

  In the case of GeoServer, the injection can be performed from a remote request.

  ## Assessment

  GeoTools includes the Jiffle language as part of the `gt-process-raster-<version>` module, applications using it should check whether itâ€™s possible to provide a Jiffle script from remote, and if so, upgrade or remove the functionality (see also the GeoServer mitigation, below).

  The issue is of particular interest for GeoServer users, as GeoServer embeds Jiffle in the base WAR package. Jiffle is available as a OGC function, for usage in SLD rendering transformations.

  This allows for a Remote Code Execution in properly crafted OGC requests, as well as from the administration console, when editing SLD files.

  ## Mitigations

  In case you cannot upgrade at once, then the following mitigation is strongly recommended:

  1. Stop GeoServer
  2. Open the war file, get into `WEB-INF/lib` and remove the `janino-<version>.jar`
  3. Restart GeoServer.

  This effectively removes the Jiffle ability to compile scripts in Java code, from any of the potential attack vectors (Janino is the library used to turn the Java code generated from the Jiffle script, into executable bytecode).

  GeoServer should still work properly after the removal, but any attempt to use Jiffle will result in an exception.
impacted_packages:
  - purl: pkg:maven/org.geoserver/gs-wms
    affected_versions: vers:maven/<2.18.6
    fixed_versions: vers:maven/2.18.6
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geoserver/gs-wfs
    affected_versions: vers:maven/<2.18.6
    fixed_versions: vers:maven/2.18.6
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geoserver/gs-wms
    affected_versions: vers:maven/>=2.19.0|<2.19.6
    fixed_versions: vers:maven/2.19.6
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geoserver/gs-wfs
    affected_versions: vers:maven/>=2.19.0|<2.19.6
    fixed_versions: vers:maven/2.19.6
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geoserver/gs-wms
    affected_versions: vers:maven/>=2.20.0|<2.20.4
    fixed_versions: vers:maven/2.20.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geoserver/gs-wfs
    affected_versions: vers:maven/>=2.20.0|<2.20.4
    fixed_versions: vers:maven/2.20.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geoserver/gs-wps
    affected_versions: vers:maven/<2.18.6
    fixed_versions: vers:maven/2.18.6
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geoserver/gs-wps
    affected_versions: vers:maven/>=2.19.0|<2.19.6
    fixed_versions: vers:maven/2.19.6
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.geoserver/gs-wps
    affected_versions: vers:maven/>=2.20.0|<2.20.4
    fixed_versions: vers:maven/2.20.4
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '9.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/06/GHSA-59x6-g4jr-4hxc/GHSA-59x6-g4jr-4hxc.json
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://docs.geoserver.org/stable/en/user/services/wps/operations.html#execute
    reference_type:
    reference_id:
  - url: https://geoserver.org/vulnerability/2022/04/11/geoserver-2-jiffle-jndi-rce.html
    reference_type:
    reference_id:
  - url: https://github.com/geoserver/geoserver
    reference_type:
    reference_id:
  - url: https://isc.sans.edu/diary/29936
    reference_type:
    reference_id:
  - url: https://osgeo-org.atlassian.net/browse/GEOS-10458
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-35042
    reference_type:
    reference_id: CVE-2023-35042
