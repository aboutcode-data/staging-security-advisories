advisory_id: GHSA-8639-qx56-r428
datasource_id: github_osv_importer_v2/GHSA-8639-qx56-r428
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/06/GHSA-8639-qx56-r428/GHSA-8639-qx56-r428.json
aliases:
  - CVE-2022-31000
summary: |
  CSRF allows attacker to finalize/unfinalize order adjustments in solidus_backend
  ### Impact
  CSRF vulnerability allowing attackers to change the state of an order's adjustments if they hold its number, and the execution happens on a store administrator's computer.

  Reproduction steps:
  - Take an order's number.
  - Log in as an administrator.
  - Visit that order's adjustments section (_Orders -> {Click on number} -> Adjustments_) and check that its adjustments are finalized (closed padlock under the **State** column).
  - On another tab, visit `{your_site_url}/admin/orders/{order_number}/adjustments/unfinalize`.
  - Notice how the adjustments are unfinalized (open padlock), even if the previous was a `GET` request which could have been linked from any other site.
  - Visit `{your_site_url}/admin/orders/{order_number}/adjustments/finalize`.
  - Notice how the adjustments are again finalized.

  That happened because both routes were handled as `GET` requests, which are skipped by Rails anti-forgery protection.

  ### Patches
  Users should upgrade to solidus_backend v3.1.6, v3.0.6, or v2.11.16, depending on the major and minor versions in use.

  ### References
  - [Rails CSRF protection](https://api.rubyonrails.org/classes/ActionController/RequestForgeryProtection.html).

  ### For more information
  If you have any questions or comments about this advisory:

  - Open an [issue](https://github.com/solidusio/solidus/issues) or a [discussion](https://github.com/solidusio/solidus/discussions) in Solidus.
  - Email us at [security@solidus.io](mailto:security@soliidus.io)
  - Contact the core team on [Slack](http://slack.solidus.io/)
impacted_packages:
  - purl: pkg:gem/solidus_backend
    affected_versions: vers:gem/<2.11.16
    fixed_versions: vers:gem/2.11.16
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/solidus_backend
    affected_versions: vers:gem/>=3.0.0|<3.0.6
    fixed_versions: vers:gem/3.0.6
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/solidus_backend
    affected_versions: vers:gem/>=3.1.0|<3.1.6
    fixed_versions: vers:gem/3.1.6
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '2.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:L/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/06/GHSA-8639-qx56-r428/GHSA-8639-qx56-r428.json
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-352
references:
  - url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/solidus_backend/CVE-2022-31000.yml
    reference_type:
    reference_id:
  - url: https://github.com/solidusio/solidus
    reference_type:
    reference_id:
  - url: https://github.com/solidusio/solidus/commit/de796a2e0be7f154cae48b46e267501559d9716c
    reference_type:
    reference_id:
  - url: https://github.com/solidusio/solidus/security/advisories/GHSA-8639-qx56-r428
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-31000
    reference_type:
    reference_id: CVE-2022-31000
