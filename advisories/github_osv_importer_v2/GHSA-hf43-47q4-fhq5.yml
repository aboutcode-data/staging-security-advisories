advisory_id: GHSA-hf43-47q4-fhq5
datasource_id: github_osv_importer_v2/GHSA-hf43-47q4-fhq5
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/04/GHSA-hf43-47q4-fhq5/GHSA-hf43-47q4-fhq5.json
aliases:
  - CVE-2024-31996
summary: |
  XWiki Commons missing escaping of `{` in Velocity escapetool allows remote code execution
  ### Impact
  The HTML escaping of escaping tool that is used in XWiki doesn't escape `{`, which, when used in certain places, allows XWiki syntax injection and thereby remote code execution.

  To reproduce in an XWiki installation, open `<xwiki-host>/xwiki/bin/view/Panels/PanelLayoutUpdate?place=%7B%7B%2Fhtml%7D%7D%7B%7Basync%20async%3Dfalse%7D%7D%7B%7Bvelocity%7D%7D%23evaluate(%24request.eval)%7B%7B%2Fvelocity%7D%7D%7B%7B%2Fasync%7D%7D&eval=Hello%20from%20URL%20Parameter!%20I%20got%20programming%3A%20%24services.security.authorization.hasAccess(%27programming%27)` where `<xwiki-host>` is the URL of your XWiki installation. If this displays `You are not admin on this place Hello from URL Parameter! I got programming: true`, the installation is vulnerable.

  ### Patches
  The vulnerability has been fixed on XWiki 14.10.19, 15.5.5, and 15.9 RC1.

  ### Workarounds
  Apart from upgrading, there is no generic workaround. However, replacing `$escapetool.html` by `$escapetool.xml` in XWiki documents fixes the vulnerability. In a standard XWiki installation, we're only aware of the document `Panels.PanelLayoutUpdate` that exposes this vulnerability, patching this document is thus a workaround. Any extension could expose this vulnerability and might thus require patching, too.

  ### References
  - https://github.com/xwiki/xwiki-commons/commit/b94142e2a66ec32e89eacab67c3da8d91f5ef93a
  - https://jira.xwiki.org/browse/XCOMMONS-2828
  - https://jira.xwiki.org/browse/XWIKI-21438
impacted_packages:
  - purl: pkg:maven/org.xwiki.commons/xwiki-commons-velocity
    affected_versions: vers:maven/>=3.0.1|<14.10.19
    fixed_versions: vers:maven/14.10.19
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.xwiki.commons/xwiki-commons-velocity
    affected_versions: vers:maven/>=15.0-rc-1|<15.5.4
    fixed_versions: vers:maven/15.5.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.xwiki.commons/xwiki-commons-velocity
    affected_versions: vers:maven/>=15.6-rc-1|<15.9-rc-1
    fixed_versions: vers:maven/15.9-rc-1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '10.0'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/04/GHSA-hf43-47q4-fhq5/GHSA-hf43-47q4-fhq5.json
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-95
  - CWE-94
references:
  - url: https://github.com/xwiki/xwiki-commons
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-commons/commit/b0805160ec7b01ee12417e79cb384e60ae4817aa
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-commons/commit/b94142e2a66ec32e89eacab67c3da8d91f5ef93a
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-commons/commit/ed7ff515a2436a1c6dcbd0c6ca0c41e434d58915
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-commons/security/advisories/GHSA-hf43-47q4-fhq5
    reference_type:
    reference_id:
  - url: https://jira.xwiki.org/browse/XCOMMONS-2828
    reference_type:
    reference_id:
  - url: https://jira.xwiki.org/browse/XWIKI-21438
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-31996
    reference_type:
    reference_id: CVE-2024-31996
