advisory_id: GHSA-pqhp-25j4-6hq9
datasource_id: github_osv_importer_v2/GHSA-pqhp-25j4-6hq9
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/11/GHSA-pqhp-25j4-6hq9/GHSA-pqhp-25j4-6hq9.json
aliases: []
summary: |
  smol-toml has a Denial of Service via malicious TOML document using deeply nested inline tables
  ### Summary
  An attacker can send a maliciously crafted TOML to cause the parser to crash because of a stack overflow caused by a deeply nested inline structure. A similar problem occurs when attempting to stringify deeply nested objects.

  The library does not limit the maximum exploration depth while parsing or producing TOML documents, nor does it offer a way to do so.

  ### Proof of concept
  ```js
  require("smol-toml").parse("e=" + "{e=".repeat(9999) + "{}" + "}".repeat(9999))
  ```

  ### Impact
  Applications which parse arbitrary TOML documents may suffer availability issues if they receive malicious input. If uncaught, the crash may cause the application itself to crash. The impact is deemed minor, as the function is already likely to throw errors on invalid input and therefore to properly handle errors.

  Due to the design of most JavaScript runtimes, the uncontrolled recursion does not lead to excessive memory usage and the execution is quickly aborted.

  As a reminder, it is **strongly** advised when working with untrusted user input to expect errors to occur and to appropriately catch them.

  ### Patches
  Version 1.3.1 offers a mechanism to limit the exploration depth before halting with a `TomlError` when parsing, with a default cap of 1000. A same mechanism has been implemented for stringifying objects.

  **Please note that the parser will *still* throw an error upon such cases.** It is, however, a now-controlled and documented behavior of the library.

  ### Workarounds
  Wrap all invocations of `parse` and `stringify` in a try/catch block.
impacted_packages:
  - purl: pkg:npm/smol-toml
    affected_versions: vers:npm/<=1.3.0
    fixed_versions: vers:npm/1.3.1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '5.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/11/GHSA-pqhp-25j4-6hq9/GHSA-pqhp-25j4-6hq9.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-674
references:
  - url: https://github.com/squirrelchat/smol-toml
    reference_type:
    reference_id:
  - url: https://github.com/squirrelchat/smol-toml/commit/405108ba090f0fc78f99aa2f0d6721e499b0ff27
    reference_type:
    reference_id:
  - url: https://github.com/squirrelchat/smol-toml/security/advisories/GHSA-pqhp-25j4-6hq9
    reference_type:
    reference_id:
