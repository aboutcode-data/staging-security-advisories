advisory_id: GHSA-65cv-r6x7-79hv
datasource_id: github_osv_importer_v2/GHSA-65cv-r6x7-79hv
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2020/03/GHSA-65cv-r6x7-79hv/GHSA-65cv-r6x7-79hv.json
aliases:
  - CVE-2020-5267
summary: |
  Cross site scripting vulnerability in ActionView
  There is a possible cross site scripting (XSS) vulnerability in ActionView's JavaScript literal escape helpers.  Views that use the `j` or `escape_javascript` methods may be susceptible to XSS attacks.

  ### Impact

  There is a possible XSS vulnerability in the `j` and `escape_javascript` methods in ActionView.  These methods are used for escaping JavaScript string literals.  Impacted code will look something like this:

  ```erb
  <script>let a = `<%= j unknown_input %>`</script>
  ```

  or

  ```erb
  <script>let a = `<%= escape_javascript unknown_input %>`</script>
  ```

  ### Releases

  The 6.0.2.2 and 5.2.4.2 releases are available at the normal locations.

  ### Workarounds

  For those that can't upgrade, the following monkey patch may be used:

  ```ruby
  ActionView::Helpers::JavaScriptHelper::JS_ESCAPE_MAP.merge!(
    {
      "`" => "\\`",
      "$" => "\\$"
    }
  )

  module ActionView::Helpers::JavaScriptHelper
    alias :old_ej :escape_javascript
    alias :old_j :j

    def escape_javascript(javascript)
      javascript = javascript.to_s
      if javascript.empty?
        result = ""
      else
        result = javascript.gsub(/(\\|<\/|\r\n|\342\200\250|\342\200\251|[\n\r"']|[`]|[$])/u, JS_ESCAPE_MAP)
      end
      javascript.html_safe? ? result.html_safe : result
    end

    alias :j :escape_javascript
  end
  ```

  ### Patches

  To aid users who aren't able to upgrade immediately we have provided patches for
  the two supported release series. They are in git-am format and consist of a
  single changeset.

  * [5-2-js-helper-xss.patch](https://gist.github.com/tenderlove/c042ff49f0347c37e99183a6502accc6#file-5-2-js-helper-xss-patch) - Patch for 5.2 series
  * [6-0-js-helper-xss.patch](https://gist.github.com/tenderlove/c042ff49f0347c37e99183a6502accc6#file-6-0-js-helper-xss-patch) - Patch for 6.0 series

  Please note that only the 5.2 and 6.0 series are supported at present. Users
  of earlier unsupported releases are advised to upgrade as soon as possible as we
  cannot guarantee the continued availability of security fixes for unsupported
  releases.

  ### Credits

  Thanks to Jesse Campos from Chef Secure
impacted_packages:
  - purl: pkg:gem/actionview
    affected_versions: vers:gem/<=5.2.4.1
    fixed_versions: vers:gem/5.2.4.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/actionview
    affected_versions: vers:gem/<=6.0.2.1
    fixed_versions: vers:gem/6.0.2.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '4.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:L/I:L/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2020/03/GHSA-65cv-r6x7-79hv/GHSA-65cv-r6x7-79hv.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-80
references:
  - url: http://lists.opensuse.org/opensuse-security-announce/2020-05/msg00019.html
    reference_type:
    reference_id:
  - url: https://github.com/rails/rails/commit/033a738817abd6e446e1b320cb7d1a5c15224e9a
    reference_type:
    reference_id:
  - url: https://github.com/rails/rails/security/advisories/GHSA-65cv-r6x7-79hv
    reference_type:
    reference_id:
  - url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/actionview/CVE-2020-5267.yml
    reference_type:
    reference_id:
  - url: https://groups.google.com/forum/#!topic/rubyonrails-security/55reWMM_Pg8
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2020/03/msg00022.html
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/XJ7NUWXAEVRQCROIIBV4C6WXO6IR3KSB
    reference_type:
    reference_id:
  - url: http://www.openwall.com/lists/oss-security/2020/03/19/1
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2020-5267
    reference_type:
    reference_id: CVE-2020-5267
