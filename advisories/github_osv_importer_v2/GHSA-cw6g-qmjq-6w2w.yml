advisory_id: GHSA-cw6g-qmjq-6w2w
datasource_id: github_osv_importer_v2/GHSA-cw6g-qmjq-6w2w
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/11/GHSA-cw6g-qmjq-6w2w/GHSA-cw6g-qmjq-6w2w.json
aliases:
  - CVE-2024-52292
summary: "Craft CMS Arbitrary System File Read\n### Summary\nBy abusing the mail notification\
  \ template it is possible to read arbitrary operating system files. \n\n### Details\nThe [dataUrl](https://craftcms.com/docs/3.x/dev/functions.html#dataurl)\
  \ function can be exploited if an attacker has write permissions on system notification templates.\
  \ This function accepts an absolute file path, reads the file's content, and converts it into\
  \ a Base64-encoded string. By embedding this function within a system notification template,\
  \ the attacker can exfiltrate the Base64-encoded file content through a triggered system email\
  \ notification. Once the email is received, the Base64 payload can be decoded, allowing the\
  \ attacker to read arbitrary files on the server.\n\nRequirements:\n* write permissions to\
  \ system notification templates\n* ability to trigger a corresponding system email\n\n###\
  \ PoC\n1) Modify a template to contain the following twig template string:\n```twig\n{{ dataUrl('/var/www/web/.env')\
  \ }}\n```\n2) Trigger the corresponding notification email (e.g. by resetting a password)\n\
  3) Receive the email and decode the base64 string\n\nMail received:\n![Bildschirmfoto 2024-09-05\
  \ um 16 20 41](https://github.com/user-attachments/assets/24dc5196-6847-4006-b7ef-8cd10d659c30)\n\
  \nDecoded string:\n![Bildschirmfoto 2024-09-05 um 16 28 24](https://github.com/user-attachments/assets/1913a475-5277-49b9-9210-2f3fcd3b9bf1)\n\
  \n\n### Impact\n1) Exposure of Sensitive Information: Arbitrary file read can lead to the\
  \ exposure of sensitive data such as configuration files (e.g., /etc/passwd, .env, config.php),\
  \ which may contain credentials, API keys, or database passwords. This can provide the attacker\
  \ with further access to the system or connected services.\n\n2) Privilege Escalation: If\
  \ the attacker is able to read files that contain privileged information, such as credentials\
  \ for other systems or applications, they may be able to escalate their privileges beyond\
  \ what the web admin role originally allowed, potentially gaining full control over the server\
  \ or other related systems.\n\n3) Server Compromise: Access to files like SSH keys, private\
  \ certificates, or system configuration files can lead to the complete compromise of the underlying\
  \ server. With this information, an attacker could remotely log in to the server or impersonate\
  \ it in secure communications.\n\n4) Exfiltration of User Data: The ability to read arbitrary\
  \ files may allow an attacker to access user data, such as stored passwords, session tokens,\
  \ or private information (like uploaded files or logs), leading to a breach of confidentiality\
  \ and violating privacy regulations (e.g., GDPR)."
impacted_packages:
  - purl: pkg:composer/craftcms/cms
    affected_versions: vers:composer/<=5.4.7+1
    fixed_versions: vers:composer/5.4.9
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:composer/craftcms/cms
    affected_versions: vers:composer/<=4.12.6+1
    fixed_versions: vers:composer/4.12.8
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:N/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/11/GHSA-cw6g-qmjq-6w2w/GHSA-cw6g-qmjq-6w2w.json
  - score: '7.0'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:N/PR:L/UI:N/VC:H/VI:N/VA:N/SC:H/SI:N/SA:N/E:P
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/11/GHSA-cw6g-qmjq-6w2w/GHSA-cw6g-qmjq-6w2w.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-552
  - CWE-22
references:
  - url: https://github.com/craftcms/cms
    reference_type:
    reference_id:
  - url: https://github.com/craftcms/cms/security/advisories/GHSA-cw6g-qmjq-6w2w
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-52292
    reference_type:
    reference_id: CVE-2024-52292
