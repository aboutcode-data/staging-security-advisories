advisory_id: GHSA-53v4-42fg-g287
datasource_id: github_osv_importer_v2/GHSA-53v4-42fg-g287
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/11/GHSA-53v4-42fg-g287/GHSA-53v4-42fg-g287.json
aliases:
  - CVE-2022-41678
summary: |
  Apache ActiveMQ Deserialization of Untrusted Data vulnerability
  Once an user is authenticated on Jolokia, he can potentially trigger arbitrary code execution.Â 

  In details, in ActiveMQ configurations, jetty allows org.jolokia.http.AgentServlet to handler request to /api/jolokia

  org.jolokia.http.HttpRequestHandler#handlePostRequest is able to create JmxRequest through JSONObject. And calls to org.jolokia.http.HttpRequestHandler#executeRequest.

  Into deeper calling stacks, org.jolokia.handler.ExecHandler#doHandleRequest is able to invoke through refection.

  And then, RCE is able to be achieved via jdk.management.jfr.FlightRecorderMXBeanImpl which exists on Java version above 11.

  1 Call newRecording.

  2 Call setConfiguration. And a webshell data hides in it.

  3 Call startRecording.

  4 Call copyTo method. The webshell will be written to a .jsp file.

  The mitigation is to restrict (by default) the actions authorized on Jolokia, or disable Jolokia.
  A more restrictive Jolokia configuration has been defined in default ActiveMQ distribution. We encourage users to upgrade to ActiveMQ distributions version including updated Jolokia configuration: 5.16.6, 5.17.4, 5.18.0, 6.0.0.
impacted_packages:
  - purl: pkg:maven/org.apache.activemq/apache-activemq
    affected_versions: vers:maven/<5.16.6
    fixed_versions: vers:maven/5.16.6
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.apache.activemq/apache-activemq
    affected_versions: vers:maven/>=5.17.0|<5.17.4
    fixed_versions: vers:maven/5.17.4
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '8.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/11/GHSA-53v4-42fg-g287/GHSA-53v4-42fg-g287.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-502
  - CWE-287
references:
  - url: https://activemq.apache.org/security-advisories.data/CVE-2022-41678-announcement.txt
    reference_type:
    reference_id:
  - url: https://github.com/apache/activemq
    reference_type:
    reference_id:
  - url: https://github.com/apache/activemq/commit/5c8d457d9
    reference_type:
    reference_id:
  - url: https://github.com/apache/activemq/commit/6120169e563b55323352431dfe9ac67a8b4de6c2
    reference_type:
    reference_id:
  - url: https://github.com/apache/activemq/commit/bf65929fd
    reference_type:
    reference_id:
  - url: https://github.com/apache/activemq/commit/d8ce1d9ff
    reference_type:
    reference_id:
  - url: https://github.com/apache/activemq/pull/958
    reference_type:
    reference_id:
  - url: https://lists.apache.org/thread/7g17kwbtjl011mm4tr8bn1vnoq9wh4sl
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2024/10/msg00027.html
    reference_type:
    reference_id:
  - url: https://security.netapp.com/advisory/ntap-20240216-0004
    reference_type:
    reference_id:
  - url: https://www.openwall.com/lists/oss-security/2023/11/28/1
    reference_type:
    reference_id:
  - url: http://www.openwall.com/lists/oss-security/2023/11/28/1
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-41678
    reference_type:
    reference_id: CVE-2022-41678
