advisory_id: GHSA-5rwj-j5m3-3chj
datasource_id: github_osv_importer_v2/GHSA-5rwj-j5m3-3chj
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/09/GHSA-5rwj-j5m3-3chj/GHSA-5rwj-j5m3-3chj.json
aliases:
  - CVE-2021-39176
summary: |
  Missing Release of Memory after Effective Lifetime in detect-character-encoding
  ### Impact

  In detect-character-encoding v0.3.0 and earlier, allocated memory is not released.

  ### Patches

  The problem has been patched in [detect-character-encoding v0.3.1](https://github.com/sonicdoe/detect-character-encoding/releases/tag/v0.3.1).

  ### CVSS score

  [CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H/RL:O/RC:C](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H/RL:O/RC:C)

  Base Score: 7.5 (High)
  Temporal Score: 7.2 (High)

  Since detect-character-encoding is a library, the scoring is based on the “[reasonable worst-case implementation scenario](https://www.first.org/cvss/v3.1/user-guide#3-7-Scoring-Vulnerabilities-in-Software-Libraries-and-Similar)”, namely, using detect-character-encoding in a program accessible over the internet which becomes unavailable when running out of memory. Depending on your specific implementation, the vulnerability’s severity in your program may be different.

  ### Proof of concept

  ```js
  const express = require("express");
  const detectCharacterEncoding = require("detect-character-encoding");

  const app = express();

  app.get("/", (req, res) => {
    detectCharacterEncoding(Buffer.from("foo"));

    res.end();
  });

  app.listen(3000);
  ```

  `hey -n 1000000 http://localhost:3000` ([`hey`](https://github.com/rakyll/hey)) causes the Node.js process to consume more and more memory.

  ### References

  - https://github.com/sonicdoe/detect-character-encoding/commit/d44356927b92e3b13e178071bf6d7c671766f588
  - https://github.com/sonicdoe/detect-character-encoding/pull/6
impacted_packages:
  - purl: pkg:npm/detect-character-encoding
    affected_versions: vers:npm/<0.3.1
    fixed_versions: vers:npm/0.3.1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/09/GHSA-5rwj-j5m3-3chj/GHSA-5rwj-j5m3-3chj.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-401
references:
  - url: https://github.com/sonicdoe/detect-character-encoding
    reference_type:
    reference_id:
  - url: https://github.com/sonicdoe/detect-character-encoding/commit/d44356927b92e3b13e178071bf6d7c671766f588
    reference_type:
    reference_id:
  - url: https://github.com/sonicdoe/detect-character-encoding/pull/6
    reference_type:
    reference_id:
  - url: https://github.com/sonicdoe/detect-character-encoding/releases/tag/v0.3.1
    reference_type:
    reference_id:
  - url: https://github.com/sonicdoe/detect-character-encoding/security/advisories/GHSA-5rwj-j5m3-3chj
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-39176
    reference_type:
    reference_id: CVE-2021-39176
