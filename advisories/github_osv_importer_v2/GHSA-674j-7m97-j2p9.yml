advisory_id: GHSA-674j-7m97-j2p9
datasource_id: github_osv_importer_v2/GHSA-674j-7m97-j2p9
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/05/GHSA-674j-7m97-j2p9/GHSA-674j-7m97-j2p9.json
aliases:
  - CVE-2018-1000120
summary: |
  curl FTP path confusion leads to NIL byte out of bounds write
  curl can be coerced into writing a zero byte out of bounds.

  This bug can trigger when curl is told to work on an FTP URL, with the setting to only issue a single CWD command (--ftp-method singlecwd or the libcurl alternative [CURLOPT_FTP_FILEMETHOD](https://curl.se/libcurl/c/CURLOPT_FTP_FILEMETHOD.html)).

  curl then URL-decodes the given path, calls strlen() on the result and deducts the length of the file name part to find the end of the directory within the buffer. It then writes a zero byte on that index, in a buffer allocated on the heap.

  If the directory part of the URL contains a `%00` sequence, the directory length might end up shorter than the file name path, making the calculation `size_t index = directory_len - filepart_len` end up with a huge index variable for where the zero byte gets stored: `heap_buffer[index] = 0`. On several architectures that huge index will wrap and work as a negative value, thus overwriting memory before the intended heap buffer.

  By using different file part lengths and putting the string `%00` in different places in the URL, an attacker that can control what paths a curl-using application uses can write that zero byte on different indexes.
impacted_packages:
  - purl: pkg:nuget/curl
    affected_versions: vers:nuget/<7.59.0
    fixed_versions:
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '9.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/05/GHSA-674j-7m97-j2p9/GHSA-674j-7m97-j2p9.json
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-787
references:
  - url: https://access.redhat.com/errata/RHBA-2019:0327
    reference_type:
    reference_id:
  - url: https://access.redhat.com/errata/RHSA-2018:3157
    reference_type:
    reference_id:
  - url: https://access.redhat.com/errata/RHSA-2018:3558
    reference_type:
    reference_id:
  - url: https://access.redhat.com/errata/RHSA-2019:1543
    reference_type:
    reference_id:
  - url: https://access.redhat.com/errata/RHSA-2020:0544
    reference_type:
    reference_id:
  - url: https://access.redhat.com/errata/RHSA-2020:0594
    reference_type:
    reference_id:
  - url: https://curl.haxx.se/docs/adv_2018-9cd6.html
    reference_type:
    reference_id:
  - url: https://curl.se/docs/CVE-2018-1000120.html
    reference_type:
    reference_id:
  - url: https://github.com/coapp-packages/curl
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2018/03/msg00012.html
    reference_type:
    reference_id:
  - url: https://usn.ubuntu.com/3598-1
    reference_type:
    reference_id:
  - url: https://usn.ubuntu.com/3598-2
    reference_type:
    reference_id:
  - url: https://web.archive.org/web/20201220134105/http://www.securitytracker.com/id/1040531
    reference_type:
    reference_id:
  - url: https://web.archive.org/web/20201220134609/http://www.securityfocus.com/bid/103414
    reference_type:
    reference_id:
  - url: https://www.debian.org/security/2018/dsa-4136
    reference_type:
    reference_id:
  - url: https://www.oracle.com/technetwork/security-advisory/cpujan2019-5072801.html
    reference_type:
    reference_id:
  - url: https://www.oracle.com/technetwork/security-advisory/cpujul2019-5072835.html
    reference_type:
    reference_id:
  - url: https://www.oracle.com/technetwork/security-advisory/cpuoct2019-5072832.html
    reference_type:
    reference_id:
  - url: http://www.oracle.com/technetwork/security-advisory/cpujul2018-4258247.html
    reference_type:
    reference_id:
  - url: http://www.oracle.com/technetwork/security-advisory/cpuoct2018-4428296.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2018-1000120
    reference_type:
    reference_id: CVE-2018-1000120
