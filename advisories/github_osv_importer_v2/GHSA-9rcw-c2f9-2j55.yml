advisory_id: GHSA-9rcw-c2f9-2j55
datasource_id: github_osv_importer_v2/GHSA-9rcw-c2f9-2j55
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/07/GHSA-9rcw-c2f9-2j55/GHSA-9rcw-c2f9-2j55.json
aliases:
  - CVE-2025-54070
summary: |
  OpenZeppelin Contracts Bytes's lastIndexOf function with position argument performs out-of-bound memory access on empty buffers
  ### Impact

  The `lastIndexOf(bytes,byte,uint256)` function of the `Bytes.sol` library may access uninitialized memory when the following two conditions hold: 1) the provided buffer length is empty (i.e. `buffer.length == 0`) and position is not `2**256 - 1` (i.e. `pos != type(uint256).max`).

  The `pos` argument could be used to access arbitrary data outside of the buffer bounds. This could lead to the operation running out of gas, or returning an invalid index (outside of the empty buffer). Processing this invalid result for accessing the `buffer` would cause a revert under normal conditions.

  When triggered, the function reads memory at offset `buffer + 0x20 + pos`. If memory at that location (outside theÂ `buffer`) matches the search pattern, the function would return an out of bound index instead of the expected `type(uint256).max`. This creates unexpected behavior where callers receive a valid-looking index pointing outside buffer bounds.

  Subsequent memory accesses that don't check bounds and use the returned index must carefully review the potential impact depending on their setup. Code relying on this function returning `type(uint256).max` for empty buffers or using the returned index without bounds checking could exhibit undefined behavior.

  ### Patches

  Upgrade to 5.4.0
impacted_packages:
  - purl: pkg:npm/%40openzeppelin/contracts
    affected_versions: vers:npm/>=5.2.0|<5.4.0
    fixed_versions: vers:npm/5.4.0
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:npm/%40openzeppelin/contracts-upgradeable
    affected_versions: vers:npm/>=5.2.0|<5.4.0
    fixed_versions: vers:npm/5.4.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '0.0'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/07/GHSA-9rcw-c2f9-2j55/GHSA-9rcw-c2f9-2j55.json
  - score: '6.9'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:N/VI:L/VA:L/SC:N/SI:N/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/07/GHSA-9rcw-c2f9-2j55/GHSA-9rcw-c2f9-2j55.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-125
references:
  - url: https://github.com/OpenZeppelin/openzeppelin-contracts
    reference_type:
    reference_id:
  - url: https://github.com/OpenZeppelin/openzeppelin-contracts/pull/5797
    reference_type:
    reference_id:
  - url: https://github.com/OpenZeppelin/openzeppelin-contracts/releases/tag/v5.4.0
    reference_type:
    reference_id:
  - url: https://github.com/OpenZeppelin/openzeppelin-contracts/security/advisories/GHSA-9rcw-c2f9-2j55
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-54070
    reference_type:
    reference_id: CVE-2025-54070
