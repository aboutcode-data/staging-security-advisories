advisory_id: GHSA-xfrw-hxr5-ghqf
datasource_id: github_osv_importer_v2/GHSA-xfrw-hxr5-ghqf
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/06/GHSA-xfrw-hxr5-ghqf/GHSA-xfrw-hxr5-ghqf.json
aliases:
  - CVE-2021-32681
summary: |
  Cross-site Scripting in wagtail
  ### Impact
  When the `{% include_block %}` template tag is used to output the value of a plain-text StreamField block (`CharBlock`, `TextBlock` or a similar user-defined block derived from `FieldBlock`), and that block does not specify a template for rendering, the tag output is not properly escaped as HTML. This could allow users to insert arbitrary HTML or scripting. This vulnerability is only exploitable by users with the ability to author StreamField content (i.e. users with 'editor' access to the Wagtail admin).

  ### Patches
  Patched versions have been released as Wagtail 2.11.8 (for the LTS 2.11 branch), Wagtail 2.12.5, and Wagtail 2.13.2 (for the current 2.13 branch).

  Site implementors who wish to retain the existing behaviour of allowing editors to insert HTML content in these blocks (and are willing to accept the risk of untrusted editors inserting arbitrary code) may disable the escaping by surrounding the relevant `{% include_block %}` tag in `{% autoescape off %}...{% endautoescape %}`.

  ### Workarounds
  Site implementors who are unable to upgrade to a current supported version should audit their use of `{% include_block %}` to ensure it is not used to output `CharBlock` / `TextBlock` values with no associated template. Note that this only applies where `{% include_block %}` is used directly on that block (uses of `include_block` on a block _containing_ a CharBlock / TextBlock, such as a StructBlock, are unaffected). In these cases, the tag can be replaced with Django's `{{ ... }}` syntax - e.g. `{% include_block my_title_block %}` becomes `{{ my_title_block }}`.

  ### Acknowledgements
  Many thanks to Karen Tracey for reporting this issue.

  ### For more information
  If you have any questions or comments about this advisory:

  * Visit Wagtail's [support channels](https://docs.wagtail.io/en/stable/support.html)
  * Email us at security@wagtail.io (if you wish to send encrypted email, the public key ID is `0x6ba1e1a86e0f8ce8`)
impacted_packages:
  - purl: pkg:pypi/wagtail
    affected_versions: vers:pypi/<2.11.8
    fixed_versions: vers:pypi/2.11.8
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/wagtail
    affected_versions: vers:pypi/>=2.12|<2.12.5
    fixed_versions: vers:pypi/2.12.5
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/wagtail
    affected_versions: vers:pypi/>=2.13|<2.13.2
    fixed_versions: vers:pypi/2.13.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '5.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/06/GHSA-xfrw-hxr5-ghqf/GHSA-xfrw-hxr5-ghqf.json
  - score: '5.1'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:N/PR:L/UI:P/VC:N/VI:N/VA:N/SC:L/SI:L/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/06/GHSA-xfrw-hxr5-ghqf/GHSA-xfrw-hxr5-ghqf.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-79
references:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/wagtail/PYSEC-2021-103.yaml
    reference_type:
    reference_id:
  - url: https://github.com/wagtail/wagtail
    reference_type:
    reference_id:
  - url: https://github.com/wagtail/wagtail/releases/tag/v2.11.8
    reference_type:
    reference_id:
  - url: https://github.com/wagtail/wagtail/releases/tag/v2.12.5
    reference_type:
    reference_id:
  - url: https://github.com/wagtail/wagtail/releases/tag/v2.13.2
    reference_type:
    reference_id:
  - url: https://github.com/wagtail/wagtail/security/advisories/GHSA-xfrw-hxr5-ghqf
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-32681
    reference_type:
    reference_id: CVE-2021-32681
