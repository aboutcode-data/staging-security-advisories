advisory_id: GHSA-6qmf-fj6m-686c
datasource_id: github_osv_importer_v2/GHSA-6qmf-fj6m-686c
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/05/GHSA-6qmf-fj6m-686c/GHSA-6qmf-fj6m-686c.json
aliases:
  - CVE-2021-32618
summary: |
  Open Redirect in Flask-Security-Too
  ### Impact
  Flask-Security allows redirects after many successful views (e.g. /login) by honoring the ?next query param. There is code in FS to validate that the url specified in the next parameter is either relative OR has the same netloc (network location) as the requesting  URL.

  This check utilizes Pythons urlsplit library. However many browsers are very lenient on the kind of URL they accept and 'fill in the blanks' when presented with a possibly incomplete URL. As a concrete example - setting http://login?next=\\\github.com
  will pass FS's relative URL check however many browsers will gladly convert this to http://github.com. Thus an attacker could send such a link to an unwitting user, using a legitimate site and have it redirect to whatever site they want.

  This is considered a low severity due to the fact that if Werkzeug by default ALWAYS ensures that the Location header is absolute - thus making this attack vector mute. It is possible for application writers to modify this default behavior by setting the 'autocorrect_location_header=False` which would then open up their application to this attack.

  ### Patches
  No patches as this time

  ### Workarounds
  If using Werkzeug, make sure to use the default Location header setting. If you can't - then use@app.after_request and write your own validation of the Location header if it is set.

  ### References
  No.

  ### For more information
  If you have any questions or comments about this advisory follow: https://github.com/Flask-Middleware/flask-security/issues/486

  Thanks to Claroty (2021-0141) and @snoopysecurity for providing details and proof of concept.
impacted_packages:
  - purl: pkg:pypi/flask-security-too
    affected_versions: vers:pypi/<4.1.0
    fixed_versions: vers:pypi/4.1.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '3.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:N/I:L/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/05/GHSA-6qmf-fj6m-686c/GHSA-6qmf-fj6m-686c.json
  - score: '2.1'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:P/PR:N/UI:A/VC:N/VI:L/VA:N/SC:N/SI:N/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/05/GHSA-6qmf-fj6m-686c/GHSA-6qmf-fj6m-686c.json
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-601
references:
  - url: https://github.com/Flask-Middleware/flask-security
    reference_type:
    reference_id:
  - url: https://github.com/Flask-Middleware/flask-security/commit/e39bb04615050448c1b8ba4caa7dacc0edd3e405
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/flask-security-too/PYSEC-2021-123.yaml
    reference_type:
    reference_id:
  - url: https://web.archive.org/web/20210517211717/https://github.com/Flask-Middleware/flask-security/issues/486
    reference_type:
    reference_id:
  - url: https://web.archive.org/web/20211207121851/https://github.com/Flask-Middleware/flask-security/security/advisories/GHSA-6qmf-fj6m-686c
    reference_type:
    reference_id:
  - url: https://web.archive.org/web/20220410062740/https://github.com/Flask-Middleware/flask-security/pull/489
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-32618
    reference_type:
    reference_id: CVE-2021-32618
