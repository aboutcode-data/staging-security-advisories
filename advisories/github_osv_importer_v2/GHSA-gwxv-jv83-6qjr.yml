advisory_id: GHSA-gwxv-jv83-6qjr
datasource_id: github_osv_importer_v2/GHSA-gwxv-jv83-6qjr
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/06/GHSA-gwxv-jv83-6qjr/GHSA-gwxv-jv83-6qjr.json
aliases:
  - CVE-2023-33962
summary: |
  JStachio XSS vulnerability: Unescaped single quotes
  ### Impact

  #### Description:
  JStachio fails to escape single quotes `'` in HTML, allowing an attacker to inject malicious code.

  #### Reproduction Steps:
  Use the following template code:
  ```html
  <div attr='{{value}}'></div>
  ```

  Set the value variable to `' onblur='alert(1)`.

  ```java
  public class Escaping {

      public static void main(String[] args) {
          Model model = new Model("' onblur='alert(1)");
          String result = AttributeTemplate.of().execute(model);
          System.out.println(result);
      }

      @JStache(template = "<div attr='{{value}}'></div>",
              name="AttributeTemplate")
      @JStacheConfig(contentType= Html.class)
      public static class Model {

          public final String value;

          public Model(String value) {
              this.value = value;
          }

          public String getValue() {
              return value;
          }
      }
  }
  ```

  Expected Result:
  The resulting output should have properly escaped the single quotes and not execute the injected JavaScript code.

  Actual Result:
  The resulting output is vulnerable and renders as follows:
  ```html
  <div attr='' onblur='alert(1)'></div>
  ```

  #### Impact and Risk:
  This vulnerability can be exploited by an attacker to execute arbitrary JavaScript code in the context of other users visiting pages that use this template engine. This can lead to various consequences, including session hijacking, defacement of web pages, theft of sensitive information, or even the propagation of malware.

  #### Proposed Solution:
  To mitigate this vulnerability, the template engine should properly escape special characters, including single quotes. Common practice is to escape `'` as `&#39`.

  ### Patches
  -

  ### Workarounds
  As long as users stick with double quotes `"` for HTML attributes, they should not be affected.

  ### References
  For instance, [Rocker's general purpose HTML escaping](https://github.com/fizzed/rocker/blob/d749fbf68179b31a64d541f5e18e0e25bc5c2d1b/rocker-runtime/src/main/java/com/fizzed/rocker/runtime/DefaultHtmlStringify.java#L64)
impacted_packages:
  - purl: pkg:maven/io.jstach/jstachio
    affected_versions: vers:maven/<1.0.1
    fixed_versions: vers:maven/1.0.1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '5.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:C/C:L/I:L/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/06/GHSA-gwxv-jv83-6qjr/GHSA-gwxv-jv83-6qjr.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-79
references:
  - url: https://github.com/jstachio/jstachio
    reference_type:
    reference_id:
  - url: https://github.com/jstachio/jstachio/commit/7b2f78377d1284df14c580be762a25af5f8dcd66
    reference_type:
    reference_id:
  - url: https://github.com/jstachio/jstachio/issues/157
    reference_type:
    reference_id:
  - url: https://github.com/jstachio/jstachio/pull/158
    reference_type:
    reference_id:
  - url: https://github.com/jstachio/jstachio/releases/tag/v1.0.1
    reference_type:
    reference_id:
  - url: https://github.com/jstachio/jstachio/security/advisories/GHSA-gwxv-jv83-6qjr
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-33962
    reference_type:
    reference_id: CVE-2023-33962
