advisory_id: GHSA-4685-2x5r-65pj
datasource_id: github_osv_importer_v2/GHSA-4685-2x5r-65pj
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/04/GHSA-4685-2x5r-65pj/GHSA-4685-2x5r-65pj.json
aliases:
  - CVE-2024-3250
summary: |
  Pebble service manager's file pull API allows access by any user
  ### Impact

  Note: "Pebble" here refers to [Canonical's service manager](https://github.com/canonical/pebble), not the [Let's Encrypt ACME test server](https://github.com/letsencrypt/pebble).

  The API behind `pebble pull`, used to read files from the workload container by Juju charms, allows access from any user, instead of just admin. In Juju Kubernetes sidecar charms, Pebble and the charm run as root, so they have full access. But if another restricted unix user gains local access to the container host, they could hit the Pebble `GET /v1/files?action=read` API and would be allowed to read any file in the workload container, for example an ssh key or database password or other sensitive information. If there are ssh keys they could then potentially ssh into the workload, or if something like a database password they could log into the database.

  Note that this requires local user access to the host machine. It seems unlikely that an attacker could gain this level of access in a Juju Kubernetes context, but if someone did and there's sensitive information in files accessible to Pebble, the consequences are bad.

  To reproduce the issue, go back to the Pebble version in Juju 2.9 (5842ea68c9c7), do `pebble run` as root in one terminal window, then in another terminal window, as a regular user, use the `pebble pull` CLI. You will be able to pull any file as a regular user.

  ### Patches

  The original patch is commit https://github.com/canonical/pebble/commit/cd326225b9b0be067da7d8858e2c912078cbbbd5. There's also https://github.com/canonical/pebble/pull/406, which fixes this issue in more recent Pebble versions (that PR also fixes a separate issue we introduced more recently, but hasn't been released in Juju yet).

  We released the fix in the following Pebble versions:

  - https://github.com/canonical/pebble/releases/tag/v1.1.1
  - https://github.com/canonical/pebble/releases/tag/v1.4.2
  - https://github.com/canonical/pebble/releases/tag/v1.7.4
  - https://github.com/canonical/pebble/releases/tag/v1.10.2

  Juju will be releasing patch versions with this fix shortly:

  - Juju 2.9.49 (Pebble v1.1.1)
  - Juju 3.1.8 (Pebble v1.4.2)
  - Juju 3.3.4 (Pebble v1.4.2)
  - Juju 3.4.2 (Pebble v1.7.4)
  - Juju 3.5.0 (Pebble v1.10.2)

  ### References

  * https://www.cve.org/CVERecord?id=CVE-2024-3250
impacted_packages: []
severities:
  - score: '6.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:N/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/04/GHSA-4685-2x5r-65pj/GHSA-4685-2x5r-65pj.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-862
references:
  - url: https://github.com/canonical/pebble
    reference_type:
    reference_id:
  - url: https://github.com/canonical/pebble/commit/4ca343d3889533143477e21c63867f2f3c3b5645
    reference_type:
    reference_id:
  - url: https://github.com/canonical/pebble/commit/a5f6f062a11ea156697b854264385ff7e1985fd8
    reference_type:
    reference_id:
  - url: https://github.com/canonical/pebble/commit/b8abd1ff0090f3e0749e81eb1fc3ea16ba95f514
    reference_type:
    reference_id:
  - url: https://github.com/canonical/pebble/commit/cd326225b9b0be067da7d8858e2c912078cbbbd5
    reference_type:
    reference_id:
  - url: https://github.com/canonical/pebble/pull/406
    reference_type:
    reference_id:
  - url: https://github.com/canonical/pebble/security/advisories/GHSA-4685-2x5r-65pj
    reference_type:
    reference_id:
  - url: https://www.cve.org/CVERecord?id=CVE-2024-3250
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-3250
    reference_type:
    reference_id: CVE-2024-3250
