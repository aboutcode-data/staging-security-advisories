advisory_id: GHSA-47m2-4cr7-mhcw
datasource_id: github_osv_importer_v2/GHSA-47m2-4cr7-mhcw
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/10/GHSA-47m2-4cr7-mhcw/GHSA-47m2-4cr7-mhcw.json
aliases:
  - CVE-2025-59530
summary: |
  quic-go: Panic occurs when queuing undecryptable packets after handshake completion
  ## Summary

  A misbehaving or malicious server can trigger an assertion in a quic-go client (and crash the process) by sending a premature HANDSHAKE_DONE frame during the handshake.

  ## Impact

  A misbehaving or malicious server can cause a denial-of-service (DoS) attack on the quic-go client by triggering an assertion failure, leading to a process crash. This requires no authentication and can be exploited during the handshake phase. Observed in the wild with certain server implementations (e.g. Solana's Firedancer QUIC).

  ## Affected Versions

  - All versions prior to v0.49.1 (for the 0.49 branch)
  - Versions v0.50.0 to v0.54.0 (inclusive)
  - Fixed in v0.49.1, v0.54.1, and v0.55.0 onward

  Users are recommended to upgrade to the latest patched version in their respective maintenance branch or to v0.55.0 or later.

  ## Details

  For a regular 1-RTT handshake, QUIC uses three sets of keys to encrypt / decrypt QUIC packets:

  - Initial keys (derived from a static key and the connection ID)
  - Handshake keys (derived from the client's and server's key shares in the TLS handshake)
  - 1-RTT keys (derived when the TLS handshake finishes)

  On the client side, Initial keys are discarded when the first Handshake packet is sent. Handshake keys are discarded when the server's HANDSHAKE_DONE frame is received, as specified in section 4.9.2 of RFC 9001. Crucially, Initial keys are always dropped before Handshake keys in a standard handshake.

  Due to packet reordering, it is possible to receive a packet with a higher encryption level before the key for that encryption level has been derived. For example, the server's Handshake packets (containing, among others, the TLS certificate) might arrive before the server's Initial packet (which contains the TLS ServerHello). In that case, the client queues the Handshake packets and decrypts them as soon as it has processed the ServerHello and derived Handshake keys.

  After completion of the handshake, Initial and Handshake packets are not needed anymore and will be dropped. quic-go implements an [assertion](https://github.com/quic-go/quic-go/blob/v0.55.0/connection.go#L2682-L2685) that no packets are queued after completion of the handshake.

  A misbehaving or malicious server can trigger this assertion, and thereby cause a panic, by sending a HANDSHAKE_DONE frame before actually completing the handshake. In that case, Handshake keys would be dropped before Initial keys.

  This can only happen if the server implementation is misbehaving: the server can only complete the handshake after receiving the client's TLS Finished message (which is sent in Handshake packets).

  ## The Fix

  quic-go needs to be able to handle misbehaving server implementations, including those that prematurely send a HANDSHAKE_DONE frame. We now discard Initial keys when receiving a HANDSHAKE_DONE frame, thereby correctly handling premature HANDSHAKE_DONE frames. The fix was implemented in https://github.com/quic-go/quic-go/pull/5354.
impacted_packages: []
severities:
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/10/GHSA-47m2-4cr7-mhcw/GHSA-47m2-4cr7-mhcw.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-755
  - CWE-617
references:
  - url: https://github.com/quic-go/quic-go
    reference_type:
    reference_id:
  - url: https://github.com/quic-go/quic-go/blob/v0.55.0/connection.go#L2682-L2685
    reference_type:
    reference_id:
  - url: https://github.com/quic-go/quic-go/commit/bc5bccf10fd02728eef150683eb4dfaa5c0e749c
    reference_type:
    reference_id:
  - url: https://github.com/quic-go/quic-go/commit/ce7c9ea8834b9d2ed79efa9269467f02c0895d42
    reference_type:
    reference_id:
  - url: https://github.com/quic-go/quic-go/pull/5354
    reference_type:
    reference_id:
  - url: https://github.com/quic-go/quic-go/security/advisories/GHSA-47m2-4cr7-mhcw
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-59530
    reference_type:
    reference_id:
  - url: https://pkg.go.dev/vuln/GO-2025-4017
    reference_type:
    reference_id:
