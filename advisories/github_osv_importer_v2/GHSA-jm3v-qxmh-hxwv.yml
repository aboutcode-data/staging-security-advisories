advisory_id: GHSA-jm3v-qxmh-hxwv
datasource_id: github_osv_importer_v2/GHSA-jm3v-qxmh-hxwv
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/05/GHSA-jm3v-qxmh-hxwv/GHSA-jm3v-qxmh-hxwv.json
aliases: []
summary: |
  Scrapy's redirects ignoring scheme-specific proxy settings
  ### Impact

  When using system proxy settings, which are scheme-specific (i.e. specific to `http://` or `https://` URLs), Scrapy was not accounting for scheme changes during redirects.

  For example, an HTTP request would use the proxy configured for HTTP and, when redirected to an HTTPS URL, the new HTTPS request would still use the proxy configured for HTTP instead of switching to the proxy configured for HTTPS. Same the other way around.

  If you have different proxy configurations for HTTP and HTTPS in your system for security reasons (e.g., maybe you donâ€™t want one of your proxy providers to be aware of the URLs that you visit with the other one), this would be a security issue.

  ### Patches

  Upgrade to Scrapy 2.11.2.

  ### Workarounds

  Replace the built-in retry middlewares (`RedirectMiddleware` and `MetaRefreshMiddleware`) and the `HttpProxyMiddleware` middleware with custom ones that implement the fix from Scrapy 2.11.2, and verify that they work as intended.

  ### References

  This security issue was reported by @redapple at https://github.com/scrapy/scrapy/issues/767.
impacted_packages:
  - purl: pkg:pypi/scrapy
    affected_versions: vers:pypi/<2.11.2
    fixed_versions: vers:pypi/2.11.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '4.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/05/GHSA-jm3v-qxmh-hxwv/GHSA-jm3v-qxmh-hxwv.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://github.com/scrapy/scrapy
    reference_type:
    reference_id:
  - url: https://github.com/scrapy/scrapy/commit/1d0502f25bbe55a22899af915623fda1aaeb9dd8
    reference_type:
    reference_id:
  - url: https://github.com/scrapy/scrapy/issues/767
    reference_type:
    reference_id:
  - url: https://github.com/scrapy/scrapy/security/advisories/GHSA-jm3v-qxmh-hxwv
    reference_type:
    reference_id:
