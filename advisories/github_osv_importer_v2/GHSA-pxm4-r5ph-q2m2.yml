advisory_id: GHSA-pxm4-r5ph-q2m2
datasource_id: github_osv_importer_v2/GHSA-pxm4-r5ph-q2m2
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/12/GHSA-pxm4-r5ph-q2m2/GHSA-pxm4-r5ph-q2m2.json
aliases:
  - CVE-2024-52806
summary: |
  SimpleSAMLphp SAML2 has an XXE in parsing SAML messages
  Summary

  When loading an (untrusted) XML document, for example the SAMLResponse, it's possible to induce an XXE.

  $options is defined as: https://github.com/simplesamlphp/saml2/blob/717c0adc4877ebd58428637e5626345e59fa0109/src/SAML2/DOMDocumentFactory.php#L41
  including the DTDLoad option, which allows an attacker to read file contents from local file system OR internal network.

  While there is the NONET option, an attacker can simply bypass if by using PHP filters:
  php://filter/convert.base64-encode/resource=http://URL OR FILE

  From there an attacker can induce network connections and steal the targeted file OOB (haven't fully tested this).

  RCE may be possible with the php://expect or php://phar wrappers, but this hasn't been tested.

  Note:
  The mitigation here:
  https://github.com/simplesamlphp/saml2/blob/717c0adc4877ebd58428637e5626345e59fa0109/src/SAML2/DOMDocumentFactory.php#L63-L69
  Comes too late, as the XML has already been loaded into a document.
  Mitigation:

  Remove the LIBXML_DTDLOAD | LIBXML_DTDATTR options.
  Additionally, as a defense in depth measure, check if there is the string: <!DOCTYPE inside the XML before parsing it. (This is not a complete fix because someone may be able to exploit some parser differentials, to load a DOCTYPE, maybe through spacing like: <! DOCTYPE)
impacted_packages:
  - purl: pkg:composer/simplesamlphp/saml2
    affected_versions: vers:composer/<4.6.14
    fixed_versions: vers:composer/4.6.14
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:composer/simplesamlphp/saml2-legacy
    affected_versions: vers:composer/<4.6.14
    fixed_versions: vers:composer/4.6.14
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '8.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:L
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/12/GHSA-pxm4-r5ph-q2m2/GHSA-pxm4-r5ph-q2m2.json
  - score: '6.9'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:N/VI:N/VA:N/SC:L/SI:L/SA:L
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/12/GHSA-pxm4-r5ph-q2m2/GHSA-pxm4-r5ph-q2m2.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-611
references:
  - url: https://github.com/simplesamlphp/saml2
    reference_type:
    reference_id:
  - url: https://github.com/simplesamlphp/saml2/commit/5fd4ce4596656fb0c1278f15b8305825412e89f7
    reference_type:
    reference_id:
  - url: https://github.com/simplesamlphp/saml2/security/advisories/GHSA-pxm4-r5ph-q2m2
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-52806
    reference_type:
    reference_id: CVE-2024-52806
