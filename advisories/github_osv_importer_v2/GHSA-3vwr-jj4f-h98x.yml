advisory_id: GHSA-3vwr-jj4f-h98x
datasource_id: github_osv_importer_v2/GHSA-3vwr-jj4f-h98x
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/05/GHSA-3vwr-jj4f-h98x/GHSA-3vwr-jj4f-h98x.json
aliases: []
summary: |
  eZ Publish Remote code execution in file uploads
  This Security Advisory is about a vulnerability in the way eZ Platform and eZ Publish Legacy handles file uploads, which can in the worst case lead to remote code execution (RCE), a very serious threat. An attacker would need access to uploading files to be able to exploit the vulnerability, so if you have strict controls on this and trust all who have this permission, you're not affected. On the basis of the tests we have made, we also believe the vulnerability cannot be exploited as long as our recommended vhost configuration is used. Here is the v2.5 recommendation for Nginx, as an example:

  https://github.com/ezsystems/ezplatform/blob/2.5/doc/nginx/vhost.template#L31

  This vhost template specifies that only the file app.php in the web root is executed, while vulnerable configurations allow execution of any php file. Apache is affected in the same way as Nginx, and is also protected by using the recommended configuration. The build-in webserver in PHP stays vulnerable, as it doesn't use this type of configuration (this webserver should only be used for development, never for production). We cannot be 100% certain our configuration is not vulnerable. We also do not know if all our users use the recommended configuration, so we send out this fix to be on the safe side.

  The fix includes a blacklist feature for uploaded filenames, such as ".php". The file types on the blacklist cannot be uploaded. The blacklist is configurable. In eZ Platform you will find it as ezsettings.default.io.file_storage.file_type_blacklist in eZ/Bundle/EzPublishCoreBundle/Resources/config/default_settings.yml in vendors/ezsystems/ezpublish-kernel. In eZ Publish Legacy you will find it as FileExtensionBlackList in settings/file.ini. By default it blocks these file types: php, php3, phar, phpt, pht, phtml, pgif. The fix also inclues a new block against path traversal attacks, though this kind of attack was not reproducible in our tests.
impacted_packages:
  - purl: pkg:composer/ezsystems/ezpublish-kernel
    affected_versions: vers:composer/>=7.5.0|<7.5.6+2
    fixed_versions: vers:composer/7.5.6+2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:composer/ezsystems/ezpublish-kernel
    affected_versions: vers:composer/>=6.13.0|<6.13.6+2
    fixed_versions: vers:composer/6.13.6+2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:composer/ezsystems/ezpublish-kernel
    affected_versions: vers:composer/>=5.4.0|<5.4.14+1
    fixed_versions: vers:composer/5.4.14+1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-94
references:
  - url: https://ezplatform.com/security-advisories/ezsa-2020-001-remote-code-execution-in-file-uploads
    reference_type:
    reference_id:
  - url: https://github.com/ezsystems/ezpublish-kernel
    reference_type:
    reference_id:
  - url: https://github.com/FriendsOfPHP/security-advisories/blob/master/ezsystems/ezpublish-kernel/2020-03-03-1.yaml
    reference_type:
    reference_id:
  - url: https://web.archive.org/web/20210304031629/https://developers.ibexa.co/security-advisories/ezsa-2020-001-remote-code-execution-in-file-uploads
    reference_type:
    reference_id:
