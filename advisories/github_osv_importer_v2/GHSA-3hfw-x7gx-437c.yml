advisory_id: GHSA-3hfw-x7gx-437c
datasource_id: github_osv_importer_v2/GHSA-3hfw-x7gx-437c
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/11/GHSA-3hfw-x7gx-437c/GHSA-3hfw-x7gx-437c.json
aliases:
  - CVE-2021-41281
summary: |
  Path traversal in Matrix Synapse
  ### Impact

  Synapse instances with the media repository enabled can be tricked into downloading a file from a remote server into an arbitrary directory, potentially outside the media store directory.

  The last two directories and file name of the path are chosen randomly by Synapse and cannot be controlled by an attacker, which limits the impact.

  Homeservers with the media repository disabled are unaffected. Homeservers configured with a federation whitelist are also unaffected.

  ### Patches
  Server administrators should upgrade to 1.47.1 or later.

  ### Workarounds
  Server administrators using a reverse proxy could, at the expense of losing media functionality, block the following endpoints:

  * `/_matrix/media/r0/download/{serverName}/{mediaId}`
  * `/_matrix/media/r0/download/{serverName}/{mediaId}/{fileName}`
  * `/_matrix/media/r0/thumbnail/{serverName}/{mediaId}`

  Alternatively, non-containerized deployments can be adapted to use the hardened systemd config, located at `contrib/systemd/override-hardened.conf`.

  ### References
  n/a

  ### For more information

  If you have any questions or comments about this advisory, e-mail us at security@matrix.org.
impacted_packages:
  - purl: pkg:pypi/matrix-synapse
    affected_versions: vers:pypi/<1.47.1
    fixed_versions: vers:pypi/1.47.1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/11/GHSA-3hfw-x7gx-437c/GHSA-3hfw-x7gx-437c.json
  - score: '8.7'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:N/VI:H/VA:N/SC:N/SI:N/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/11/GHSA-3hfw-x7gx-437c/GHSA-3hfw-x7gx-437c.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-22
references:
  - url: https://github.com/matrix-org/synapse
    reference_type:
    reference_id:
  - url: https://github.com/matrix-org/synapse/commit/91f2bd090
    reference_type:
    reference_id:
  - url: https://github.com/matrix-org/synapse/releases/tag/v1.47.1
    reference_type:
    reference_id:
  - url: https://github.com/matrix-org/synapse/security/advisories/GHSA-3hfw-x7gx-437c
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/matrix-synapse/PYSEC-2021-436.yaml
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/EU7QRE55U4IUEDLKT5IYPWL3UXMELFAS
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/N3WY56LCEZ4ZECLWV5KMAXF2PSMUB4F2
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-41281
    reference_type:
    reference_id: CVE-2021-41281
