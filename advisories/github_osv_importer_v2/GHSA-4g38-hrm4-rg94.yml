advisory_id: GHSA-4g38-hrm4-rg94
datasource_id: github_osv_importer_v2/GHSA-4g38-hrm4-rg94
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/05/GHSA-4g38-hrm4-rg94/GHSA-4g38-hrm4-rg94.json
aliases:
  - CVE-2021-21686
summary: |
  Multiple vulnerabilities allow bypassing path filtering of agent-to-controller access control in Jenkins
  The agent-to-controller security subsystem limits which files on the Jenkins controller can be accessed by agent processes.

  Multiple vulnerabilities in the file path filtering implementation of Jenkins 2.318 and earlier, LTS 2.303.2 and earlier allow agent processes to read and write arbitrary files on the Jenkins controller file system, and obtain some information about Jenkins controller file systems.

  SECURITY-2444 / CVE-2021-21686: File path filters do not canonicalize paths, allowing operations to follow symbolic links to outside allowed directories.

  We expect that most of these vulnerabilities have been present since [SECURITY-144 was addressed in the 2014-10-30 security advisory](https://www.jenkins.io/security/advisory/2014-10-30/).

  Jenkins 2.319, LTS 2.303.3 addresses these security vulnerabilities.

  SECURITY-2444 / CVE-2021-21686: File path filters canonicalize paths, preventing operations from following symbolic links to outside allowed directories.

  As some common operations are now newly subject to access control, it is expected that plugins sending commands from agents to the controller may start failing. Additionally, the newly introduced path canonicalization means that instances using a custom builds directory ([Java system property jenkins.model.Jenkins.buildsDir](https://www.jenkins.io/doc/book/managing/system-properties/#jenkins-model-jenkins-buildsdir)) or partitioning `JENKINS_HOME` using symbolic links may fail access control checks. See [the documentation](https://www.jenkins.io/doc/book/security/controller-isolation/agent-to-controller/#file-access-rules) for how to customize the configuration in case of problems.

  If you are unable to immediately upgrade to Jenkins 2.319, LTS 2.303.3, you can install the [Remoting Security Workaround Plugin](https://www.jenkins.io/redirect/remoting-security-workaround/). It will prevent all agent-to-controller file access using `FilePath` APIs. Because it is more restrictive than Jenkins 2.319, LTS 2.303.3, more plugins are incompatible with it. Make sure to read the plugin documentation before installing it.
impacted_packages:
  - purl: pkg:maven/org.jenkins-ci.main/jenkins-core
    affected_versions: vers:maven/<2.303.2
    fixed_versions: vers:maven/2.303.3
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.jenkins-ci.main/jenkins-core
    affected_versions: vers:maven/<=2.318
    fixed_versions: vers:maven/2.319
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '9.0'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/05/GHSA-4g38-hrm4-rg94/GHSA-4g38-hrm4-rg94.json
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-59
  - CWE-22
references:
  - url: https://github.com/jenkinsci/jenkins
    reference_type:
    reference_id:
  - url: https://github.com/jenkinsci/jenkins/commit/104c751d907919dd53f5090f84d53c671a66457b
    reference_type:
    reference_id:
  - url: https://github.com/jenkinsci/jenkins/commit/5a245e42979abe4a26d41727c839521e36cedd74
    reference_type:
    reference_id:
  - url: https://github.com/jenkinsci/jenkins/commit/63cde2daadc705edf086f2213b48c8c547f98358
    reference_type:
    reference_id:
  - url: https://www.jenkins.io/security/advisory/2021-11-04/#SECURITY-2455
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-21686
    reference_type:
    reference_id: CVE-2021-21686
