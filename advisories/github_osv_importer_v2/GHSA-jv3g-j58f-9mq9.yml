advisory_id: GHSA-jv3g-j58f-9mq9
datasource_id: github_osv_importer_v2/GHSA-jv3g-j58f-9mq9
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/09/GHSA-jv3g-j58f-9mq9/GHSA-jv3g-j58f-9mq9.json
aliases:
  - CVE-2022-36083
summary: |
  JOSE vulnerable to resource exhaustion via specifically crafted JWE
  The PBKDF2-based JWE key management algorithms expect a JOSE Header Parameter named `p2c` ([PBES2 Count](https://www.rfc-editor.org/rfc/rfc7518.html#section-4.8.1.2)), which determines how many PBKDF2 iterations must be executed in order to derive a CEK wrapping key. The purpose of this parameter is to intentionally slow down the key derivation function in order to make password brute-force and dictionary attacks more expensive.

  This makes the PBES2 algorithms unsuitable for situations where the JWE is coming from an untrusted source: an adversary can intentionally pick an extremely high PBES2 Count value, that will initiate a CPU-bound computation that may take an unreasonable amount of time to finish.

  ### Impact

  Under certain conditions (see below) it is possible to have the user's environment consume unreasonable amount of CPU time.

  ### Affected users

  The impact is limited only to users utilizing the JWE decryption APIs with symmetric secrets to decrypt JWEs from untrusted parties who do not limit the accepted JWE Key Management Algorithms (`alg` Header Parameter) using the `keyManagementAlgorithms` (or `algorithms` in v1.x) decryption option or through other means.

  The PBKDF2-based JWE Key Management Algorithm Identifiers are

  - `PBES2-HS256+A128KW`
  - `PBES2-HS384+A192KW`
  - `PBES2-HS512+A256KW`

  e.g.

  ```js
  const secret = new Uint8Array(16)
  const jwe = '...' // JWE from an untrusted party

  await jose.compactDecrypt(jwe, secret)
  ```

  You are NOT affected if any of the following applies to you

  - Your code does not use the JWE APIs
  - Your code only produces JWE tokens
  - Your code only decrypts JWEs using an asymmetric JWE Key Management Algorithm (this means you're providing an asymmetric key object to the JWE decryption API)
  - Your code only accepts JWEs produced by trusted sources
  - Your code limits the accepted JWE Key Management Algorithms using the `keyManagementAlgorithms` decryption option not including any of the PBKDF2-based JWE key management algorithms

  ### Patches

  `v1.28.2`, `v2.0.6`, `v3.20.4`, and `v4.9.2` releases limit the maximum PBKDF2 iteration count to `10000` by default. It is possible to adjust this limit with a newly introduced `maxPBES2Count` decryption option.

  ### Workarounds

  All users should be able to upgrade given all stable semver major release lines have had new a patch release introduced which limits the PBKDF2 iteration count to `10000` by default. This removes the ability to craft JWEs that would consume unreasonable amount of CPU time.

  If users are unable to upgrade their required library version they have two options depending on whether they expect to receive JWEs using any of the three PBKDF2-based JWE key management algorithms.

  - they can use the `keyManagementAlgorithms` decryption option to disable accepting PBKDF2 altogether
  - they can inspect the JOSE Header prior to using the decryption API and limit the PBKDF2 iteration count (`p2c` Header Parameter)

  ### For more information
  If you have any questions or comments about this advisory:
  * Open an discussion in the project's [repository](https://github.com/panva/jose/discussions/new?category=q-a&title=GHSA-jv3g-j58f-9mq9%20advisory%20question)
  * Email me at [panva.ip@gmail.com](mailto:panva.ip@gmail.com)
impacted_packages:
  - purl: pkg:npm/jose
    affected_versions: vers:npm/<=1.28.1
    fixed_versions: vers:npm/1.28.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:npm/jose-browser-runtime
    affected_versions: vers:npm/<=3.20.3
    fixed_versions: vers:npm/3.20.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:npm/jose-node-cjs-runtime
    affected_versions: vers:npm/<=3.20.3
    fixed_versions: vers:npm/3.20.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:npm/jose-node-esm-runtime
    affected_versions: vers:npm/<=3.20.3
    fixed_versions: vers:npm/3.20.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:npm/jose
    affected_versions: vers:npm/<=2.0.5
    fixed_versions: vers:npm/2.0.6
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:npm/jose
    affected_versions: vers:npm/<=3.20.3
    fixed_versions: vers:npm/3.20.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:npm/jose
    affected_versions: vers:npm/<=4.9.1
    fixed_versions: vers:npm/4.9.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:npm/jose-browser-runtime
    affected_versions: vers:npm/<=4.9.1
    fixed_versions: vers:npm/4.9.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:npm/jose-node-cjs-runtime
    affected_versions: vers:npm/<=4.9.1
    fixed_versions: vers:npm/4.9.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:npm/jose-node-esm-runtime
    affected_versions: vers:npm/<=4.9.1
    fixed_versions: vers:npm/4.9.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '5.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/09/GHSA-jv3g-j58f-9mq9/GHSA-jv3g-j58f-9mq9.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-834
  - CWE-400
references:
  - url: https://github.com/panva/jose
    reference_type:
    reference_id:
  - url: https://github.com/panva/jose/commit/03d6d013bf6e070e85adfe5731f526978e3e8e4d
    reference_type:
    reference_id:
  - url: https://github.com/panva/jose/releases/tag/v4.9.2
    reference_type:
    reference_id:
  - url: https://github.com/panva/jose/security/advisories/GHSA-jv3g-j58f-9mq9
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-36083
    reference_type:
    reference_id: CVE-2022-36083
