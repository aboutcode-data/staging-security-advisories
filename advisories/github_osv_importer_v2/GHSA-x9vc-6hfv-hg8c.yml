advisory_id: GHSA-x9vc-6hfv-hg8c
datasource_id: github_osv_importer_v2/GHSA-x9vc-6hfv-hg8c
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/05/GHSA-x9vc-6hfv-hg8c/GHSA-x9vc-6hfv-hg8c.json
aliases:
  - CVE-2024-32655
summary: |
  Npgsql vulnerable to SQL Injection via Protocol Message Size Overflow
  ### Summary
  The `WriteBind()` method in `src/Npgsql/Internal/NpgsqlConnector.FrontendMessages.cs` uses `int` variables to store the message length and the sum of parameter lengths. Both variables overflow when the sum of parameter lengths becomes too large.

  This causes Npgsql to write a message size that is too small when constructing a Postgres protocol message to send it over the network to the database. When parsing the message, the database will only read a small number of bytes and treat any following bytes as new messages while they belong to the old message.

  Attackers can abuse this to inject arbitrary Postgres protocol messages into the connection, leading to the execution of arbitrary SQL statements on the application's behalf.

  ### Impact
  Attackers can issue arbitrary SQL statements to the database on behalf of the application. The final impact depends on the application that uses Npgsql, the data it stores in Postgres, etc.
impacted_packages:
  - purl: pkg:nuget/Npgsql
    affected_versions: vers:nuget/>=8.0.0|<8.0.3
    fixed_versions: vers:nuget/8.0.3
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:nuget/Npgsql
    affected_versions: vers:nuget/<=4.0.13
    fixed_versions: vers:nuget/4.0.14
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:nuget/Npgsql
    affected_versions: vers:nuget/>=4.1.0|<4.1.13
    fixed_versions: vers:nuget/4.1.13
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:nuget/Npgsql
    affected_versions: vers:nuget/>=5.0.0|<5.0.18
    fixed_versions: vers:nuget/5.0.18
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:nuget/Npgsql
    affected_versions: vers:nuget/>=6.0.0|<6.0.11
    fixed_versions: vers:nuget/6.0.11
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:nuget/Npgsql
    affected_versions: vers:nuget/>=7.0.0|<7.0.7
    fixed_versions: vers:nuget/7.0.7
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '8.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/05/GHSA-x9vc-6hfv-hg8c/GHSA-x9vc-6hfv-hg8c.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-190
  - CWE-89
references:
  - url: https://github.com/npgsql/npgsql
    reference_type:
    reference_id:
  - url: https://github.com/npgsql/npgsql/commit/091655eed0c84e502ab424950c930339d17c1928
    reference_type:
    reference_id:
  - url: https://github.com/npgsql/npgsql/commit/3183efb2bdcca159c8c2e22af57e18ea8f853cf0
    reference_type:
    reference_id:
  - url: https://github.com/npgsql/npgsql/commit/67acbe027e28477ac2199e15cfb554bb2ffaf169
    reference_type:
    reference_id:
  - url: https://github.com/npgsql/npgsql/commit/703d9af8fa48dfe8c0180e36edb8278f34342d7b
    reference_type:
    reference_id:
  - url: https://github.com/npgsql/npgsql/commit/a22a42d8141d7a3528f43c02c095a409507cf1af
    reference_type:
    reference_id:
  - url: https://github.com/npgsql/npgsql/commit/e34e2ba8042e666d9af54a1b255fba4d5b11df56
    reference_type:
    reference_id:
  - url: https://github.com/npgsql/npgsql/commit/f7e7ead0702d776a8f551f5786c4cac2d65c4bc6
    reference_type:
    reference_id:
  - url: https://github.com/npgsql/npgsql/files/14309386/Npgsql.Security.Advisory.pdf
    reference_type:
    reference_id:
  - url: https://github.com/npgsql/npgsql/files/14309397/npgsql-protocol-overflow-poc.zip
    reference_type:
    reference_id:
  - url: https://github.com/npgsql/npgsql/releases/tag/v4.0.14
    reference_type:
    reference_id:
  - url: https://github.com/npgsql/npgsql/releases/tag/v4.1.13
    reference_type:
    reference_id:
  - url: https://github.com/npgsql/npgsql/releases/tag/v5.0.18
    reference_type:
    reference_id:
  - url: https://github.com/npgsql/npgsql/releases/tag/v6.0.11
    reference_type:
    reference_id:
  - url: https://github.com/npgsql/npgsql/releases/tag/v7.0.7
    reference_type:
    reference_id:
  - url: https://github.com/npgsql/npgsql/releases/tag/v8.0.3
    reference_type:
    reference_id:
  - url: https://github.com/npgsql/npgsql/security/advisories/GHSA-x9vc-6hfv-hg8c
    reference_type:
    reference_id:
  - url: https://www.youtube.com/watch?v=Tfg1B8u1yvE
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-32655
    reference_type:
    reference_id: CVE-2024-32655
