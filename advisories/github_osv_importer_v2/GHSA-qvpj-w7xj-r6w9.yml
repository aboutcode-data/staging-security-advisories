advisory_id: GHSA-qvpj-w7xj-r6w9
datasource_id: github_osv_importer_v2/GHSA-qvpj-w7xj-r6w9
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/06/GHSA-qvpj-w7xj-r6w9/GHSA-qvpj-w7xj-r6w9.json
aliases:
  - CVE-2024-36119
summary: |
  Password confirmation stored in plain text via registration form in statamic/cms
  Users registering via the `user:register_form` tag will have their password confirmation stored in plain text in their user file.

  ### Impact
  This only affects sites matching **all** of the following conditions:
  - Running Statamic versions between 5.3.0 and 5.6.1. (This version range represents only one calendar week)
  - Using the `user:register_form` tag.
  - Using file-based user accounts. (Does not affect users stored in a database.)
  - Has users that have registered during that time period. (Existing users are not affected.)

  The password is only visible to users that have access to read user yaml files, typically developers of the application itself.

  ### Patches
  The issue has been patched in 5.6.2, however any users registered during that time period and using the affected version range will still have the the `password_confirmation` value in their yaml files.

  We recommend that affected users have their password reset. The following query can be entered into `php artisan tinker` and will output a list of affected emails:

  ```php
  Statamic\Facades\User::query()->whereNotNull('password_confirmation')->get()->map->email
  ```

  The following can be entered into `tinker` and will clear both password_confirmation as well as their existing password. They will be required to reset their password before their next login attempt.

  ```php
  Statamic\Facades\User::query()
    ->whereNotNull('password_confirmation')->get()
    ->each(fn ($user) => $user->remove('password_confirmation')->passwordHash(null)->save());
  ```

  ### References
  If you are committing user files to a public git repo, you may consider clearing the sensitive data from the git history. You can use the following links for details.
  - https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/removing-sensitive-data-from-a-repository
  - https://dev.to/balogh08/cleaning-your-git-history-safely-removing-sensitive-data-10i5
impacted_packages:
  - purl: pkg:composer/statamic/cms
    affected_versions: vers:composer/>=5.3.0|<5.6.2
    fixed_versions: vers:composer/5.6.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '1.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:H/UI:R/S:U/C:L/I:N/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/06/GHSA-qvpj-w7xj-r6w9/GHSA-qvpj-w7xj-r6w9.json
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-312
references:
  - url: https://dev.to/balogh08/cleaning-your-git-history-safely-removing-sensitive-data-10i5
    reference_type:
    reference_id:
  - url: https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/removing-sensitive-data-from-a-repository
    reference_type:
    reference_id:
  - url: https://github.com/statamic/cms
    reference_type:
    reference_id:
  - url: https://github.com/statamic/cms/commit/0b804306c96c99b81755d5bd02df87ddf392853e
    reference_type:
    reference_id:
  - url: https://github.com/statamic/cms/security/advisories/GHSA-qvpj-w7xj-r6w9
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-36119
    reference_type:
    reference_id: CVE-2024-36119
