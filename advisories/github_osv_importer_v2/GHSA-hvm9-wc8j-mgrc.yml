advisory_id: GHSA-hvm9-wc8j-mgrc
datasource_id: github_osv_importer_v2/GHSA-hvm9-wc8j-mgrc
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/12/GHSA-hvm9-wc8j-mgrc/GHSA-hvm9-wc8j-mgrc.json
aliases: []
summary: "TShock Security Escalation Exploit\n### Impact\nAn issue with the way OTAPI manages\
  \ client connections results in stale UUIDs remaining on `RemoteClient` instances after a\
  \ player disconnects.\n\nBecause of this, if the following conditions are met a player may\
  \ assume the login state of a previously connected player:\n1. The server has UUID login enabled\n\
  2. An authenticated player disconnects\n3. A subsequent player connects with a modified client\
  \ that does not send the `ClientUUID#68` packet during connection\n4. The server assigns the\
  \ same `RemoteClient` object that belonged to the originally authenticated player to the newly\
  \ connected player\n\n\n### Patches\nTShock 5.2.1 hotfixes this issue. A more robust fix will\
  \ be made to OTAPI itself.\n\n### Workarounds\nImplement a RemoteClient reset event handler\
  \ in a plugin like so:\n```csharp\npublic override void Initialize()\n{\n        On.Terraria.RemoteClient.Reset\
  \ += RemoteClient_Reset;\n}\n\nprivate static void RemoteClient_Reset(On.Terraria.RemoteClient.orig_Reset\
  \ orig, RemoteClient client)\n{\n\tclient.ClientUUID = null;\n        orig(client);\n}\n```"
impacted_packages:
  - purl: pkg:nuget/TShock
    affected_versions: vers:nuget/>=4.3.21|<5.2.1
    fixed_versions: vers:nuget/5.2.1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '8.9'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:P/PR:N/UI:P/VC:H/VI:H/VA:H/SC:L/SI:H/SA:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/12/GHSA-hvm9-wc8j-mgrc/GHSA-hvm9-wc8j-mgrc.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-863
  - CWE-613
  - CWE-305
references:
  - url: https://github.com/Pryaxis/TShock
    reference_type:
    reference_id:
  - url: https://github.com/Pryaxis/TShock/commit/5075997264b48e27960e3446a948ecb0ea0f5a03
    reference_type:
    reference_id:
  - url: https://github.com/Pryaxis/TShock/security/advisories/GHSA-hvm9-wc8j-mgrc
    reference_type:
    reference_id:
