advisory_id: GHSA-6jqm-3c9g-pch7
datasource_id: github_osv_importer_v2/GHSA-6jqm-3c9g-pch7
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/12/GHSA-6jqm-3c9g-pch7/GHSA-6jqm-3c9g-pch7.json
aliases:
  - CVE-2022-23510
summary: |
  @cubejs-backend/api-gateway row level security bypass
  ### Impact
  All authenticated Cube clients could bypass row-level security and run arbitrary SQL via the newly introduced /v1/sql-runner endpoint.

  ### Patches
  The change has been reverted in 0.31.24

  ### Workarounds
  Upgrade to >=0.31.24 or downgrade to <=0.31.22

  ### Post mortem
  As part of implementing the Cube Cloud SQL runner functionality, we’ve added a new endpoint to the Cube Core so that we could add arbitrary queries directly to the queue, bypassing the modeling layer.

  The endpoint was added in this commit: https://github.com/cube-js/cube.js/commit/f1e25bb50323c0b99f3891d349467e7b637baeea

  It went through the code review; however, it slipped everyone’s attention that this endpoint completely bypasses any row-level security logic implemented in the modeling layer. Now anyone with a valid Cube JWT token could fetch any data, even if they were not allowed to do so by their security context.

  The issue was noticed by the Core team on Dec 12 and immediately reverted.

  The just-released 0.31.23 version of the Cube has been pulled out of all the registries, and a CVE was published on Github.
  Another change (https://github.com/cube-js/cube.js/commit/2c5db32f2ded074ebe5e83668eee8c024101240b) was also rolled back along with the SQL runner endpoint. It didn't pose a significant security threat, but it increased the attacker’s ability to enumerate cube schema, and it should be revisited.

  The 0.31.24 was released to replace the revoked version with a change completely reverted. All customers are urged to upgrade to the newest Cube version.
impacted_packages:
  - purl: pkg:npm/%40cubejs-backend/api-gateway
    affected_versions: vers:npm/0.31.23
    fixed_versions: vers:npm/0.31.24
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:N/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/12/GHSA-6jqm-3c9g-pch7/GHSA-6jqm-3c9g-pch7.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-89
references:
  - url: https://github.com/cube-js/cube.js
    reference_type:
    reference_id:
  - url: https://github.com/cube-js/cube.js/commit/3c614674fed6ca17df08bbba8c835ef110167570
    reference_type:
    reference_id:
  - url: https://github.com/cube-js/cube.js/commit/f1140de508e359970ac82b50bae1c4bf152f6041
    reference_type:
    reference_id:
  - url: https://github.com/cube-js/cube.js/security/advisories/GHSA-6jqm-3c9g-pch7
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-23510
    reference_type:
    reference_id: CVE-2022-23510
