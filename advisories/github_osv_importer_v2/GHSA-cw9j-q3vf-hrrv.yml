advisory_id: GHSA-cw9j-q3vf-hrrv
datasource_id: github_osv_importer_v2/GHSA-cw9j-q3vf-hrrv
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/02/GHSA-cw9j-q3vf-hrrv/GHSA-cw9j-q3vf-hrrv.json
aliases:
  - CVE-2024-3574
summary: |
  Scrapy authorization header leakage on cross-domain redirect
  ### Impact

  When you send a request with the `Authorization` header to one domain, and the response asks to redirect to a different domain, Scrapyâ€™s built-in redirect middleware creates a follow-up redirect request that keeps the original `Authorization` header, leaking its content to that second domain.

  The [right behavior](https://fetch.spec.whatwg.org/#ref-for-cors-non-wildcard-request-header-name) would be to drop the `Authorization` header instead, in this scenario.

  ### Patches

  Upgrade to Scrapy 2.11.1.

  If you are using Scrapy 1.8 or a lower version, and upgrading to Scrapy 2.11.1 is not an option, you may upgrade to Scrapy 1.8.4 instead.

  ### Workarounds

  If you cannot upgrade, make sure that you are not using the `Authentication` header, either directly or through some third-party plugin.

  If you need to use that header in some requests, add `"dont_redirect": True` to the `request.meta` dictionary of those requests to disable following redirects for them.

  If you need to keep (same domain) redirect support on those requests, make sure you trust the target website not to redirect your requests to a different domain.

  ### Acknowledgements

  This security issue was reported by @ranjit-git  [through huntr.com](https://huntr.com/bounties/49974321-2718-43e3-a152-62b16eed72a9/).
impacted_packages:
  - purl: pkg:pypi/scrapy
    affected_versions: vers:pypi/>=2|<2.11.1
    fixed_versions: vers:pypi/2.11.1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/scrapy
    affected_versions: vers:pypi/<1.8.4
    fixed_versions: vers:pypi/1.8.4
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/02/GHSA-cw9j-q3vf-hrrv/GHSA-cw9j-q3vf-hrrv.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-200
references:
  - url: https://github.com/scrapy/scrapy
    reference_type:
    reference_id:
  - url: https://github.com/scrapy/scrapy/commit/ee7bd9d217fc126063575d5649f00bdeeca2faae
    reference_type:
    reference_id:
  - url: https://github.com/scrapy/scrapy/security/advisories/GHSA-cw9j-q3vf-hrrv
    reference_type:
    reference_id:
  - url: https://huntr.com/bounties/49974321-2718-43e3-a152-62b16eed72a9
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-3574
    reference_type:
    reference_id: CVE-2024-3574
