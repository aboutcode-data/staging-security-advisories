advisory_id: GHSA-7r96-8g3x-g36m
datasource_id: github_osv_importer_v2/GHSA-7r96-8g3x-g36m
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/06/GHSA-7r96-8g3x-g36m/GHSA-7r96-8g3x-g36m.json
aliases:
  - CVE-2021-32685
summary: |
  Improper Verification of Cryptographic Signature
  ### Impact
  The `verifyWithMessage` method of `tEnvoyNaClSigningKey` always returns `true` for any signature of a SHA-512 hash matching the SHA-512 hash of the message even if the signature is invalid.

  ### Patches
  Upgrade to `v7.0.3` immediately to resolve this issue. Since the vulnerability lies within the verification method, the previous signatures are still valid. We highly recommend reverifying any signatures that were previously verified with the vulnerable `verifyWithMessage` method.

  ### Workarounds
  In `tenvoy.js` under the `verifyWithMessage` method definition within the `tEnvoyNaClSigningKey` class, ensure that the return statement call to `this.verify` ends in `.verified`. For example, the return statement should start with `return this.verify(signed, password).verified && ` instead of `return this.verify(signed, password) && `.

  ### For more information
  If you have any questions or comments about this advisory:
  * Open an issue in [github.com/TogaTech/tEnvoy](https://github.com/TogaTech/tEnvoy)
impacted_packages:
  - purl: pkg:npm/tenvoy
    affected_versions: vers:npm/<7.0.3
    fixed_versions: vers:npm/7.0.3
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '9.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/06/GHSA-7r96-8g3x-g36m/GHSA-7r96-8g3x-g36m.json
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-347
references:
  - url: https://github.com/TogaTech/tEnvoy
    reference_type:
    reference_id:
  - url: https://github.com/TogaTech/tEnvoy/commit/a121b34a45e289d775c62e58841522891dee686b
    reference_type:
    reference_id:
  - url: https://github.com/TogaTech/tEnvoy/releases/tag/v7.0.3
    reference_type:
    reference_id:
  - url: https://github.com/TogaTech/tEnvoy/security/advisories/GHSA-7r96-8g3x-g36m
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-32685
    reference_type:
    reference_id: CVE-2021-32685
