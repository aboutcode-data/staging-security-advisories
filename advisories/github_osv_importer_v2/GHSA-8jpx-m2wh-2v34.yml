advisory_id: GHSA-8jpx-m2wh-2v34
datasource_id: github_osv_importer_v2/GHSA-8jpx-m2wh-2v34
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2020/04/GHSA-8jpx-m2wh-2v34/GHSA-8jpx-m2wh-2v34.json
aliases:
  - CVE-2020-11002
summary: |
  Remote Code Execution (RCE) vulnerability in dropwizard-validation
  ### Summary

  A server-side template injection was identified in the self-validating ([`@SelfValidating`](https://javadoc.io/static/io.dropwizard/dropwizard-project/2.0.3/io/dropwizard/validation/selfvalidating/SelfValidating.html)) feature of **dropwizard-validation** enabling attackers to inject arbitrary Java EL expressions, leading to Remote Code Execution (RCE) vulnerability.

  If you're using a self-validating bean (via [`@SelfValidating`](https://javadoc.io/static/io.dropwizard/dropwizard-project/2.0.3/io/dropwizard/validation/selfvalidating/SelfValidating.html)), an upgrade to Dropwizard 1.3.21/2.0.3 or later is strongly recommended.

  The changes introduced in Dropwizard 1.3.19 and 2.0.2 (see [GHSA-3mcp-9wr4-cjqf](https://github.com/dropwizard/dropwizard/security/advisories/GHSA-3mcp-9wr4-cjqf)/[CVE-2020-5245](https://github.com/advisories/GHSA-3mcp-9wr4-cjqf)) unfortunately didn't fix the underlying issue completely.

  ### Impact

  This issue may allow Remote Code Execution (RCE), allowing to run arbitrary code on the host system (with the privileges of the Dropwizard service account privileges) by injecting arbitrary [Java Expression Language (EL)](https://docs.jboss.org/hibernate/validator/6.1/reference/en-US/html_single/#section-interpolation-with-message-expressions) expressions when using the self-validating feature ([`@SelfValidating`](https://javadoc.io/static/io.dropwizard/dropwizard-project/2.0.3/io/dropwizard/validation/selfvalidating/SelfValidating.html), [`@SelfValidation`](https://javadoc.io/static/io.dropwizard/dropwizard-project/2.0.3/io/dropwizard/validation/selfvalidating/SelfValidation.html)) in **dropwizard-validation**.

  ### Patches

  The issue has been fixed in **dropwizard-validation** **1.3.21** and **2.0.3** or later. We strongly recommend upgrading to one of these versions.

  The evaluation of EL expressions has been disabled by default now.

  In order to use some interpolation in the violation messages added to [`ViolationCollector`](https://javadoc.io/static/io.dropwizard/dropwizard-project/2.0.3/io/dropwizard/validation/selfvalidating/ViolationCollector.html), it has to be explicitly allowed by setting [`SelfValidating#escapeExpressions()`](https://javadoc.io/static/io.dropwizard/dropwizard-project/2.0.3/io/dropwizard/validation/selfvalidating/SelfValidating.html#escapeExpressions--) to `false`.

  It is also recommended to use the `addViolation` methods supporting message parameters instead of EL expressions introduced in Dropwizard 1.3.21 and 2.0.3:
  * [`ViolationCollector#addViolation(String, Map<String, Object>`](https://javadoc.io/static/io.dropwizard/dropwizard-project/2.0.3/io/dropwizard/validation/selfvalidating/ViolationCollector.html#addViolation-java.lang.String-java.util.Map-)
  * [`ViolationCollector#addViolation(String, String, Map<String, Object>`](https://javadoc.io/static/io.dropwizard/dropwizard-project/2.0.3/io/dropwizard/validation/selfvalidating/ViolationCollector.html#addViolation-java.lang.String-java.lang.String-java.util.Map-)
  * [`ViolationCollector#addViolation(String, String, Integer, Map<String, Object>`](https://javadoc.io/static/io.dropwizard/dropwizard-project/2.0.3/io/dropwizard/validation/selfvalidating/ViolationCollector.html#addViolation-java.lang.String-java.lang.Integer-java.lang.String-java.util.Map-)
  * [`ViolationCollector#addViolation(String, String, String, Map<String, Object>`](https://javadoc.io/static/io.dropwizard/dropwizard-project/2.0.3/io/dropwizard/validation/selfvalidating/ViolationCollector.html#addViolation-java.lang.String-java.lang.String-java.lang.String-java.util.Map-)


  ### Workarounds

  If you are not able to upgrade to one of the aforementioned versions of **dropwizard-validation** but still want to use the [`@SelfValidating`](https://javadoc.io/static/io.dropwizard/dropwizard-project/2.0.2/io/dropwizard/validation/selfvalidating/SelfValidating.html) feature, make sure to properly sanitize any message you're adding to the [`ViolationCollector`](https://javadoc.io/static/io.dropwizard/dropwizard-project/2.0.3/io/dropwizard/validation/selfvalidating/ViolationCollector.html) in the method annotated with [`@SelfValidation`](https://javadoc.io/static/io.dropwizard/dropwizard-project/2.0.3/io/dropwizard/validation/selfvalidating/SelfValidation.html).

  Example:
  ```java
  @SelfValidation
  public void validateFullName(ViolationCollector col) {
      if (fullName.contains("_")) {
          // Sanitize fullName variable by escaping relevant characters such as "$"
          col.addViolation("Full name contains invalid characters:  " + sanitizeJavaEl(fullName));
      }
  }
  ```

  See also:
  https://github.com/dropwizard/dropwizard/blob/v2.0.3/dropwizard-validation/src/main/java/io/dropwizard/validation/InterpolationHelper.java

  ### References

  * https://github.com/dropwizard/dropwizard/security/advisories/GHSA-3mcp-9wr4-cjqf
  * https://github.com/dropwizard/dropwizard/pull/3208
  * https://github.com/dropwizard/dropwizard/pull/3209
  * https://docs.jboss.org/hibernate/validator/6.1/reference/en-US/html_single/#section-hibernateconstraintvalidatorcontext

  ### For more information

  If you have any questions or comments about this advisory:
  * Open an issue in [dropwizard/dropwizard](https://github.com/dropwizard/dropwizard/issues/new)
  * Start a discussion on the [dropwizard-dev mailing list](https://groups.google.com/forum/#!forum/dropwizard-dev)

  ### Security contact

  If you want to responsibly disclose a security issue in Dropwizard or one of its official modules, please contact us via the published channels in our [security policy](https://github.com/dropwizard/dropwizard/security/policy):

  https://github.com/dropwizard/dropwizard/security/policy#reporting-a-vulnerability
impacted_packages:
  - purl: pkg:maven/io.dropwizard/dropwizard-validation
    affected_versions: vers:maven/<1.3.21
    fixed_versions: vers:maven/1.3.21
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/io.dropwizard/dropwizard-validation
    affected_versions: vers:maven/>=2.0.0|<2.0.3
    fixed_versions: vers:maven/2.0.3
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '8.0'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:L/UI:R/S:C/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2020/04/GHSA-8jpx-m2wh-2v34/GHSA-8jpx-m2wh-2v34.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-74
references:
  - url: https://docs.jboss.org/hibernate/validator/6.1/reference/en-US/html_single/#section-hibernateconstraintvalidatorcontext
    reference_type:
    reference_id:
  - url: https://github.com/dropwizard/dropwizard/commit/d5a512f7abf965275f2a6b913ac4fe778e424242
    reference_type:
    reference_id:
  - url: https://github.com/dropwizard/dropwizard/pull/3208
    reference_type:
    reference_id:
  - url: https://github.com/dropwizard/dropwizard/pull/3209
    reference_type:
    reference_id:
  - url: https://github.com/dropwizard/dropwizard/security/advisories/GHSA-3mcp-9wr4-cjqf
    reference_type:
    reference_id:
  - url: https://github.com/dropwizard/dropwizard/security/advisories/GHSA-8jpx-m2wh-2v34
    reference_type:
    reference_id:
  - url: https://github.com/dropwizard/dropwizard/security/policy#reporting-a-vulnerability
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2020-11002
    reference_type:
    reference_id: CVE-2020-11002
