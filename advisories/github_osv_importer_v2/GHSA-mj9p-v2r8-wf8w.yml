advisory_id: GHSA-mj9p-v2r8-wf8w
datasource_id: github_osv_importer_v2/GHSA-mj9p-v2r8-wf8w
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2020/01/GHSA-mj9p-v2r8-wf8w/GHSA-mj9p-v2r8-wf8w.json
aliases:
  - CVE-2020-5226
summary: |
  Cross-site scripting in SimpleSAMLphp
  ### Background

  SimpleSAMLphp allows users to report errors and failures to the system administrators via a web form. This web form gathers some contextual information automatically, but it also allows the user to provide their email address for follow-ups and a free-text explanation of what happened. Once submitted, the report is sent as an email to the administrative email address configured in the software.

  ### Description

  The `www/erroreport.php` script allows error reports to be submitted and sent to the system administrator. Starting with SimpleSAMLphp  1.18.0, a new `SimpleSAML\Utils\EMail` class was introduced to handle sending emails, implemented as a wrapper of an external dependency.

  This new wrapper allows us to use Twig templates in order to create the email sent with an error report. Since Twig provides automatic escaping of variables, manual escaping of the free-text field in `www/errorreport.php` was removed to avoid double escaping. However, for those not using the new user interface yet, an email template is hardcoded into the class itself in plain PHP. Since no escaping is provided in this template, it is then possible to inject HTML inside the template by manually crafting the contents of the free-text field.

  ### Affected versions

  SimpleSAMLphp versions 1.18.0 to 1.18.3, both inclusive.

  ### Impact

  An attacker may take advantage of this issue to manually craft a modified email sent via the error reporting mechanism, such as this email might trick a system administrator into performing an action, such as introducing their credentials into a phishing web site that resembles the original.

  Remote execution of javascript code is considered unfeasible since email clients do not run javascript present in emails, although there might be email clients which don't follow this rule, making the attack surface grow.

  ### Resolution

  Upgrade the SimpleSAMLphp installation to version 1.18.4.

  ### Credit

  This vulnerability was discovered and reported by Frederic Vleminckx.
impacted_packages:
  - purl: pkg:composer/simplesamlphp/simplesamlphp
    affected_versions: vers:composer/>=1.18.0|<1.18.4
    fixed_versions: vers:composer/1.18.4
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '4.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:L/UI:R/S:C/C:L/I:L/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2020/01/GHSA-mj9p-v2r8-wf8w/GHSA-mj9p-v2r8-wf8w.json
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-79
references:
  - url: https://github.com/simplesamlphp/simplesamlphp/security/advisories/GHSA-mj9p-v2r8-wf8w
    reference_type:
    reference_id:
  - url: https://simplesamlphp.org/security/202001-01
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2020-5226
    reference_type:
    reference_id: CVE-2020-5226
