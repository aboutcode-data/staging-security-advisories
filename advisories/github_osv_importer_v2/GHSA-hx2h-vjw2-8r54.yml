advisory_id: GHSA-hx2h-vjw2-8r54
datasource_id: github_osv_importer_v2/GHSA-hx2h-vjw2-8r54
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/09/GHSA-hx2h-vjw2-8r54/GHSA-hx2h-vjw2-8r54.json
aliases:
  - CVE-2025-59354
summary: |
  DragonFly has weak integrity checks for downloaded files
  ### Impact
  The DragonFly2 uses a variety of hash functions, including the MD5 hash. This algorithm does not provide collision resistance; it is secure only against preimage attacks. While these security guarantees may be enough for the DragonFly2 system, it is not completely clear if there are any scenarios where lack of the collision resistance would compromise the system. There are no clear benefits to keeping the MD5 hash function in the system.

  ```golang
  var pieceDigests []string
  for i := int32(0); i < t.TotalPieces; i++ {
         pieceDigests = append(pieceDigests, t.Pieces[i].Md5)
  }
  digest := digest.SHA256FromStrings(pieceDigests...)
  if digest != t.PieceMd5Sign {
         t.Errorf("invalid digest, desired: %s, actual: %s", t.PieceMd5Sign, digest)
         t.invalid.Store(true)
         return ErrInvalidDigest
  }
  ```

  Alice, a peer in the DragonFly2 system, creates two images: an innocent one, and one with malicious code. Both images consist of two pieces, and Alice generates the pieces so that their respective MD5 hashes collide (are the same). Therefore, the PieceMd5Sign metadata of both images are equal. Alice shares the innocent image with other peers, who attest to their validity (i.e., that it works as expected and is not malicious). Bob wants to download the image and requests it from the peer-to-peer network. After downloading the image, Bob checks its integrity with a SHA256 hash that is known to him. Alice, who is participating in the network, had already provided Bob the other image, the malicious one. Bob unintentionally uses the malicious image.

  ### Patches

  - Dragonfy v2.1.0 and above.

  ### Workarounds

  There are no effective workarounds, beyond upgrading.

  ### References

  A third party security audit was performed by Trail of Bits, you can see the [full report](https://github.com/dragonflyoss/dragonfly/blob/main/docs/security/dragonfly-comprehensive-report-2023.pdf).

  If you have any questions or comments about this advisory, please email us at [dragonfly-maintainers@googlegroups.com](mailto:dragonfly-maintainers@googlegroups.com).
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:N/VI:L/VA:N/SC:N/SI:N/SA:N/E:P
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/09/GHSA-hx2h-vjw2-8r54/GHSA-hx2h-vjw2-8r54.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-328
references:
  - url: https://github.com/dragonflyoss/dragonfly
    reference_type:
    reference_id:
  - url: https://github.com/dragonflyoss/dragonfly/blob/main/docs/security/dragonfly-comprehensive-report-2023.pdf
    reference_type:
    reference_id:
  - url: https://github.com/dragonflyoss/dragonfly/security/advisories/GHSA-hx2h-vjw2-8r54
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-59354
    reference_type:
    reference_id:
  - url: https://pkg.go.dev/vuln/GO-2025-3973
    reference_type:
    reference_id:
