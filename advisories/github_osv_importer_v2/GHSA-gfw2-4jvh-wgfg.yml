advisory_id: GHSA-gfw2-4jvh-wgfg
datasource_id: github_osv_importer_v2/GHSA-gfw2-4jvh-wgfg
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/11/GHSA-gfw2-4jvh-wgfg/GHSA-gfw2-4jvh-wgfg.json
aliases:
  - CVE-2023-47627
summary: "AIOHTTP has problems in HTTP parser (the python one, not llhttp)\n# Summary\nThe HTTP\
  \ parser in AIOHTTP has numerous problems with header parsing, which could lead to request\
  \ smuggling.\nThis parser is only used when `AIOHTTP_NO_EXTENSIONS` is enabled (or not using\
  \ a prebuilt wheel).\n \n# Details\n\n## Bug 1: Bad parsing of `Content-Length` values\n\n\
  ### Description\nRFC 9110 says this:\n> `Content-Length = 1*DIGIT`\n\nAIOHTTP does not enforce\
  \ this rule, presumably because of an incorrect usage of the builtin `int` constructor. Because\
  \ the `int` constructor accepts `+` and `-` prefixes, and digit-separating underscores, using\
  \ `int` to parse CL values leads AIOHTTP to significant misinterpretation.\n\n### Examples\n\
  ```\nGET / HTTP/1.1\\r\\n\nContent-Length: -0\\r\\n\n\\r\\n\nX\n```\n```\nGET / HTTP/1.1\\\
  r\\n\nContent-Length: +0_1\\r\\n\n\\r\\n\nX\n```\n\n### Suggested action\nVerify that a `Content-Length`\
  \ value consists only of ASCII digits before parsing, as the standard requires.\n\n## Bug\
  \ 2: Improper handling of NUL, CR, and LF in header values\n\n### Description\nRFC 9110 says\
  \ this:\n> Field values containing CR, LF, or NUL characters are invalid and dangerous, due\
  \ to the varying ways that implementations might parse and interpret those characters; a recipient\
  \ of CR, LF, or NUL within a field value MUST either reject the message or replace each of\
  \ those characters with SP before further processing or forwarding of that message.\n\nAIOHTTP's\
  \ HTTP parser does not enforce this rule, and will happily process header values containing\
  \ these three forbidden characters without replacing them with SP.\n### Examples\n```\nGET\
  \ / HTTP/1.1\\r\\n\nHeader: v\\x00alue\\r\\n\n\\r\\n\n```\n```\nGET / HTTP/1.1\\r\\n\nHeader:\
  \ v\\ralue\\r\\n\n\\r\\n\n```\n```\nGET / HTTP/1.1\\r\\n\nHeader: v\\nalue\\r\\n\n\\r\\n\n\
  ```\n### Suggested action\nReject all messages with NUL, CR, or LF in a header value. The\
  \ translation to space thing, while technically allowed, does not seem like a good idea to\
  \ me.\n\n## Bug 3: Improper stripping of whitespace before colon in HTTP headers\n\n### Description\n\
  RFC 9112 says this:\n> No whitespace is allowed between the field name and colon. In the past,\
  \ differences in the handling of such whitespace have led to security vulnerabilities in request\
  \ routing and response handling. A server MUST reject, with a response status code of 400\
  \ (Bad Request), any received request message that contains whitespace between a header field\
  \ name and colon.\n\nAIOHTTP does not enforce this rule, and will simply strip any whitespace\
  \ before the colon in an HTTP header.\n\n### Example\n```\nGET / HTTP/1.1\\r\\n\nContent-Length\
  \ : 1\\r\\n\n\\r\\n\nX\n```\n\n### Suggested action\nReject all messages with whitespace before\
  \ a colon in a header field, as the standard requires.\n\n# PoC\nExample requests are embedded\
  \ in the previous section. To reproduce these bugs, start an AIOHTTP server without llhttp\
  \ (i.e. `AIOHTTP_NO_EXTENSIONS=1`) and send the requests given in the previous section. (e.g.\
  \ by `printf`ing into `nc`)\n\n# Impact\nEach of these bugs can be used for request smuggling."
impacted_packages:
  - purl: pkg:pypi/aiohttp
    affected_versions: vers:pypi/<3.8.6
    fixed_versions: vers:pypi/3.8.6
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '5.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/11/GHSA-gfw2-4jvh-wgfg/GHSA-gfw2-4jvh-wgfg.json
  - score: '6.9'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:N/VI:L/VA:N/SC:N/SI:N/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/11/GHSA-gfw2-4jvh-wgfg/GHSA-gfw2-4jvh-wgfg.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-444
references:
  - url: https://github.com/aio-libs/aiohttp
    reference_type:
    reference_id:
  - url: https://github.com/aio-libs/aiohttp/commit/d5c12ba890557a575c313bb3017910d7616fce3d
    reference_type:
    reference_id:
  - url: https://github.com/aio-libs/aiohttp/releases/tag/v3.8.6
    reference_type:
    reference_id:
  - url: https://github.com/aio-libs/aiohttp/security/advisories/GHSA-gfw2-4jvh-wgfg
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/aiohttp/PYSEC-2023-246.yaml
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/02/msg00002.html
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/FUSJVQ7OQ55RWL4XAX2F5EZ73N4ZSH6U
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/VDKQ6HM3KNDU4OQI476ZWT4O7DMSIT35
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/WQYQL6WV535EEKSNH7KRARLLMOW5WXDM
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-47627
    reference_type:
    reference_id: CVE-2023-47627
