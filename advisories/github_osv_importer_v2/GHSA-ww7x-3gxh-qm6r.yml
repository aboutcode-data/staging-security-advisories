advisory_id: GHSA-ww7x-3gxh-qm6r
datasource_id: github_osv_importer_v2/GHSA-ww7x-3gxh-qm6r
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/11/GHSA-ww7x-3gxh-qm6r/GHSA-ww7x-3gxh-qm6r.json
aliases:
  - CVE-2023-49087
summary: |
  Validation of SignedInfo
  Validation of an XML Signature requires verification that the hash value of the related XML-document (after any optional transformations and/or normalizations) matches a specific DigestValue-value, but also that the cryptografic signature on the SignedInfo-tree (the one that contains the DigestValue) verifies and matches a trusted public key.

  Within the simpleSAMLphp/xml-security library (https://github.com/simplesamlphp/xml-security), the hash is being validated using SignedElementTrait::validateReference, and the signature is being verified in SignedElementTrait::verifyInternal

  https://github.com/simplesamlphp/xml-security/blob/master/src/XML/SignedElementTrait.php:

  ![afbeelding](https://user-images.githubusercontent.com/841045/285817284-a7b7b3b4-768a-46e8-a34b-61790b6e23a5.png)

  What stands out is that the signature is being calculated over the canonical version of the SignedInfo-tree. The validateReference method, however, uses the original non-canonicalized version of SignedInfo.

  ### Impact
  If an attacker somehow (i.e. by exploiting a bug in PHP's canonicalization function) manages to manipulate the canonicalized version's DigestValue, it would be potentially be possible to forge the signature. No possibilities to exploit this were found during the investigation.
impacted_packages:
  - purl: pkg:composer/simplesamlphp/xml-security
    affected_versions: vers:composer/1.6.11
    fixed_versions: vers:composer/1.6.12
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:composer/simplesamlphp/saml2
    affected_versions: vers:composer/5.0.0-alpha.12
    fixed_versions: vers:composer/5.0.0-alpha.13
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/11/GHSA-ww7x-3gxh-qm6r/GHSA-ww7x-3gxh-qm6r.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-345
references:
  - url: https://github.com/simplesamlphp/xml-security
    reference_type:
    reference_id:
  - url: https://github.com/simplesamlphp/xml-security/blob/master/src/XML/SignedElementTrait.php
    reference_type:
    reference_id:
  - url: https://github.com/simplesamlphp/xml-security/commit/f509e3083dd7870cce5880c804b5122317287581
    reference_type:
    reference_id:
  - url: https://github.com/simplesamlphp/xml-security/security/advisories/GHSA-ww7x-3gxh-qm6r
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-49087
    reference_type:
    reference_id: CVE-2023-49087
