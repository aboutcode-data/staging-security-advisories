advisory_id: GHSA-3v33-3wmw-3785
datasource_id: github_osv_importer_v2/GHSA-3v33-3wmw-3785
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/07/GHSA-3v33-3wmw-3785/GHSA-3v33-3wmw-3785.json
aliases: []
summary: |
  yt-dlp has dependency on potentially malicious third-party code in Douyu extractors
  ### Impact
  yt-dlp's DouyuTV and DouyuShow extractors used a `cdn.bootcdn.net` URL as a fallback for fetching a component of the crypto-js JavaScript library. When the Douyu extractor is used, yt-dlp extracts this JavaScript code and attempts to execute it externally using [PhantomJS](https://github.com/ariya/phantomjs). `bootcdn.net` is owned by the bad actor responsible for the [Polyfill JS supply chain attack](https://sansec.io/research/polyfill-supply-chain-attack) that has been ongoing since at least June 2023. While there is no evidence that PhantomJS has been targeted by or is vulnerable to any attacks carried out by the Polyfill JS actor, there is the possibility that malicious JavaScript code may have been downloaded/cached by yt-dlp or executed by PhantomJS.

  In order for this potential vulnerability to be exploited by any hypothetical attack, all 3 of the following conditions must be met:
  1. The user has PhantomJS installed on their system.
  2. The user passes a `douyu.com` or `douyutv.com` URL to yt-dlp as input, or passes a URL that redirects to one of these domains.
  3. `cdnjs.cloudflare.com` is unavailable or blocked at the time of extraction, necessitating the usage of the `cdn.bootcdn.net` fallback; or it had been unavailable during a previous run of the Douyu extractor and JavaScript code from `cdn.bootcdn.net` had been cached to disk.

  ### Patches
  yt-dlp version 2024.07.07 fixes this issue by removing the URL pointing to the malicious CDN and by invalidating any Douyu extractor cache data created by unpatched versions of yt-dlp.

  ### Workarounds
  It is recommended to upgrade yt-dlp to version 2024.07.07 as soon as possible.

  For users not able to upgrade:
  - Avoid using the Douyu extractors (`--ies default,-douyutv,-douyushow`)
  - Uninstall (or do not install) PhantomJS

  ### Acknowledgement
  Thanks to @LeSuisse for [reporting this](https://github.com/yt-dlp/yt-dlp/pull/10347) promptly after `bootcdn.net` was discovered to be under control of the same bad actor behind the `polyfill.io` supply chain attack.

  ### References
  - https://github.com/yt-dlp/yt-dlp/commit/6075a029dba70a89675ae1250e7cdfd91f0eba41
  - https://sansec.io/research/polyfill-supply-chain-attack
impacted_packages:
  - purl: pkg:pypi/yt-dlp
    affected_versions: vers:pypi/>=2023.9.24|<2024.7.7
    fixed_versions: vers:pypi/2024.7.7
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://github.com/yt-dlp/yt-dlp
    reference_type:
    reference_id:
  - url: https://github.com/yt-dlp/yt-dlp/commit/6075a029dba70a89675ae1250e7cdfd91f0eba41
    reference_type:
    reference_id:
  - url: https://github.com/yt-dlp/yt-dlp/security/advisories/GHSA-3v33-3wmw-3785
    reference_type:
    reference_id:
  - url: https://sansec.io/research/polyfill-supply-chain-attack
    reference_type:
    reference_id:
