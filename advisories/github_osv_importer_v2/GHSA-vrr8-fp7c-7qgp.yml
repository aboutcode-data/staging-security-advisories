advisory_id: GHSA-vrr8-fp7c-7qgp
datasource_id: github_osv_importer_v2/GHSA-vrr8-fp7c-7qgp
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/04/GHSA-vrr8-fp7c-7qgp/GHSA-vrr8-fp7c-7qgp.json
aliases:
  - CVE-2023-30537
summary: |
  org.xwiki.platform:xwiki-platform-flamingo-theme-ui vulnerable to privilege escalation
  ### Impact

  Any user with the right to add an object on a page can execute arbitrary Groovy, Python or Velocity code in XWiki leading to full access to the XWiki installation. The root cause is improper escaping of the styles properties `FlamingoThemesCode.WebHome`. This page is installed by default.

  #### Reproduction Steps

  **Steps to reproduce**:

  - As a user without script or programming rights, edit your user profile with the object editor (enable advanced mode if necessary to get access) and add an object of type "Theme Class" of "FlamingoThemesCode". In the field "body-bg" (all other fields should work, too) add the following text:

  `{{/html}} {{async async="true" cached="false" context="doc.reference"}}{{groovy}}println("Hello " + "from groovy!"){{/groovy}}{{/async}}`

  - Click "Save & View"
  - Open <xwiki-host>/xwiki/bin/view/FlamingoThemesCode/WebHomeSheet where <xwiki-host> is the URL of your XWiki installation

  **Expected result**:

  The list of color themes either doesn't include the user's profile or displays a regular preview.

  **Actual result**:

  The user's profile is listed as color theme but instead of the little preview the message

  ```
  Failed to execute the [html] macro. Cause: [When using HTML content inline, you can only use inline HTML content. Block HTML content (such as tables) cannot be displayed. Try leaving an empty line before and after the macro.]. Click on this message for details.
  Hello from groovy!">
  ```

  is displayed. This shows that a Groovy macro with content created by the user has been executed and thus demonstrates a privilege escalation from simple user account to programming rights.


  ### Patches
  The vulnerability has been patched in XWiki 13.10.11, 14.4.7 and 14.10.

  ### Workarounds
  The issue can be fixed by applying this [patch](https://github.com/xwiki/xwiki-platform/commit/df596f15368342236f8899ca122af8f3df0fe2e8#diff-e2153fa59f9d92ef67b0afbf27984bd17170921a3b558fac227160003d0dfd2a) on `FlamingoThemesCode.WebHomeSheet`.

  ### References
  - patch: https://github.com/xwiki/xwiki-platform/commit/df596f15368342236f8899ca122af8f3df0fe2e8
  - Jira: https://jira.xwiki.org/browse/XWIKI-20280

  ### For more information
  If you have any questions or comments about this advisory:

  *    Open an issue in [Jira XWiki.org](https://jira.xwiki.org/)
  *    Email us at [Security Mailing List](mailto:security@xwiki.org)
impacted_packages:
  - purl: pkg:maven/org.xwiki.platform/xwiki-platform-flamingo-theme-ui
    affected_versions: vers:maven/>=12.6.6|<13.10.11
    fixed_versions: vers:maven/13.10.11
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.xwiki.platform/xwiki-platform-flamingo-theme-ui
    affected_versions: vers:maven/>=14.0-rc-1|<14.4.7
    fixed_versions: vers:maven/14.4.7
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.xwiki.platform/xwiki-platform-flamingo-theme-ui
    affected_versions: vers:maven/>=14.5|<14.10
    fixed_versions: vers:maven/14.10
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '9.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:L
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/04/GHSA-vrr8-fp7c-7qgp/GHSA-vrr8-fp7c-7qgp.json
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-95
  - CWE-94
references:
  - url: https://github.com/xwiki/xwiki-platform
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-platform/commit/df596f15368342236f8899ca122af8f3df0fe2e8
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-vrr8-fp7c-7qgp
    reference_type:
    reference_id:
  - url: https://jira.xwiki.org/browse/XWIKI-20280
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-30537
    reference_type:
    reference_id: CVE-2023-30537
