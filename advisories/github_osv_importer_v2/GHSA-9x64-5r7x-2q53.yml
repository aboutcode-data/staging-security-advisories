advisory_id: GHSA-9x64-5r7x-2q53
datasource_id: github_osv_importer_v2/GHSA-9x64-5r7x-2q53
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2020/09/GHSA-9x64-5r7x-2q53/GHSA-9x64-5r7x-2q53.json
aliases: []
summary: "Malicious Package in flatmap-stream\nVersion 0.1.1 of `flatmap-stream` is considered\
  \ malicious.\n\nThis module runs an encrypted payload targeting a very specific application,\
  \ `copay` and because they shared the same description it would have likely worked for `copay-dash`.\n\
  \nThe injected code:\n\n- Read in AES encrypted data from a file disguised as a test fixture\n\
  - Grabbed the npm package description of the module that imported it, using an automatically\
  \ set environment variable\n- Used the package description as a key to decrypt a chunk of\
  \ data pulled in from the disguised file\n\nThe decrypted data was part of a module, which\
  \ was then compiled in memory and executed.\n\nThis module performed the following actions:\n\
  \n- Decrypted another chunk of data from the disguised file\n- Concatenated a small, commented\
  \ prefix from the first decrypted chunk to the end of the second decrypted chunk\n- Performed\
  \ minor decoding tasks to transform the concatenated block of code from invalid JS to valid\
  \ JS (we believe this was done to evade detection by dynamic analysis tools)\n- Wrote this\
  \ processed block of JS out to a file stored in a dependency that would be packaged by the\
  \ build scripts: \n\nThe chunk of code that was written out was the actual malicious code,\
  \ intended to be run on devices owned by the end users of Copay.\n\nThis code would do the\
  \ following:\n\n- Detect the current environment: Mobile/Cordova/Electron\n- Check the Bitcoin\
  \ and Bitcoin Cash balances on the victim's copay account\n- If the current balance was greater\
  \ than 100 Bitcoin, or 1000 Bitcoin Cash:\n  - Harvest the victim's account data in full\n\
  \  - Harvest the victim's copay private keys\n  - Send the victim's account data/private keys\
  \ off to a collection\n\n\n## Recommendation\n\nIf you find this module in your environment\
  \ it's best to remove it. The malicious version of event-stream and flatmap-stream have been\
  \ removed from the npm Registry."
impacted_packages:
  - purl: pkg:npm/flatmap-stream
    affected_versions: vers:npm/0.1.1
    fixed_versions:
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '9.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2020/09/GHSA-9x64-5r7x-2q53/GHSA-9x64-5r7x-2q53.json
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-506
references:
  - url: https://github.com/dominictarr/event-stream/issues/116
    reference_type:
    reference_id:
  - url: https://www.npmjs.com/advisories/737
    reference_type:
    reference_id:
