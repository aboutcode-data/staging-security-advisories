advisory_id: GHSA-jq4p-mq33-w375
datasource_id: github_osv_importer_v2/GHSA-jq4p-mq33-w375
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/01/GHSA-jq4p-mq33-w375/GHSA-jq4p-mq33-w375.json
aliases:
  - CVE-2022-23598
summary: |
  Cross-site Scripting when rendering error messages in laminas-form
  ### Impact

  When rendering validation error messages via the `formElementErrors()` view helper shipped with laminas-form, many messages will contain the submitted value. However, in vulnerable versions of laminas-form, the value was not being escaped for HTML contexts, which can potentially lead to a Reflected Cross-Site Scripting (XSS) attack.

  ### Patches

  The following versions were issued to mitigate the vulnerability:

  - 2.17.1
  - 3.0.2
  - 3.1.1

  ### Workarounds

  At the top of a view script where you call the `formElementErrors()` view helper, place the following code:

  ```php
  use Laminas\Form\ElementInterface;
  use Laminas\View\PhpRenderer;

  $escapeMessages = function (ElementInterface $formOrElement, PhpRenderer $renderer): void {
      $messages = $element->getMessages();
      if (! $messages) {
          return;
      }

      $escaped  = [];
      array_walk_recursive(
          $messages,
          static function (string $item) use (&$escaped, $renderer): void {
              $escaped[] = $renderer->escapeHtml($item);
          }
      };

      $element->setMessages($escaped);
  };
  ```

  Before calling `formElementErrors()` with a form, fieldset, or element, call the above closure as follows

  ```php
  // Usage with a form
  // $this is the view renderer
  $escapeMessages($form, $this);

  // Usage with a fieldset
  // $this is the view renderer
  $escapeMessages($fieldset, $this);

  // Usage with a form element
  // $this is the view renderer
  $escapeMessages($element, $this);
  ```

  ### For more information

  If you have any questions or comments about this advisory:

  * [Open an issue](https://github.com/laminas/laminas-form/issues/new)
  * Email us at [security@getlaminas.org](mailto:security@getlaminas.org)
impacted_packages:
  - purl: pkg:composer/laminas/laminas-form
    affected_versions: vers:composer/>=3.1.0|<3.1.1
    fixed_versions: vers:composer/3.1.1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:composer/laminas/laminas-form
    affected_versions: vers:composer/>=3.0.0|<3.0.2
    fixed_versions: vers:composer/3.0.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:composer/laminas/laminas-form
    affected_versions: vers:composer/<2.17.1
    fixed_versions: vers:composer/2.17.1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '6.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/01/GHSA-jq4p-mq33-w375/GHSA-jq4p-mq33-w375.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-79
references:
  - url: https://getlaminas.org/security/advisory/LP-2022-01
    reference_type:
    reference_id:
  - url: https://github.com/laminas/laminas-form
    reference_type:
    reference_id:
  - url: https://github.com/laminas/laminas-form/commit/43005a3ec4c2292d4f825273768d9b884acbca37
    reference_type:
    reference_id:
  - url: https://github.com/laminas/laminas-form/releases/tag/2.17.1
    reference_type:
    reference_id:
  - url: https://github.com/laminas/laminas-form/security/advisories/GHSA-jq4p-mq33-w375
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/CFF6WJ5I7PSEBRF6I753WKE2BXFBGQXE
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/SLNABVK26CE4PFL57VLY242FW3QY4CPC
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-23598
    reference_type:
    reference_id: CVE-2022-23598
