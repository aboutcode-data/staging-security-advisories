advisory_id: GHSA-c7w4-9wv8-7x7c
datasource_id: github_osv_importer_v2/GHSA-c7w4-9wv8-7x7c
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/02/GHSA-c7w4-9wv8-7x7c/GHSA-c7w4-9wv8-7x7c.json
aliases:
  - CVE-2025-24787
summary: |
  WhoDB allows parameter injection in DB connection URIs leading to local file inclusion
  ### Summary

  The application is vulnerable to parameter injection in database connection strings, which allows an attacker to read local files on the machine the application is running on.

  ### Details

  The application uses string concatenation to build database connection URIs which are then passed to corresponding libraries responsible for setting up the database connections.

  This string concatenation is done unsafely and without escaping or encoding the user input. This allows an user, in many cases, to inject arbitrary parameters into the URI string. These parameters can be potentially dangerous depending on the libraries used.

  One of these dangerous parameters is `allowAllFiles` in the library `github.com/go-sql-driver/mysql`. Should this be set to `true`, the library enables running the `LOAD DATA LOCAL INFILE` query on any file on the host machine (in this case, the machine that WhoDB is running on). Source: https://github.com/go-sql-driver/mysql/blob/7403860363ca112af503b4612568c3096fecb466/infile.go#L128

  By injecting `&allowAllFiles=true` into the connection URI and connecting to any MySQL server (such as an attacker-controlled one), the attacker is able to read local files.

  ### PoC

  As this vulnerability does not require sending requests manually and can all be done using the WhoDB UI, screenshots are provided instead of HTTP requests.

  For this proof-of-concept, a clean instance of WhoDB and MySQL were set up using podman (docker is a suitable alternative):

  ```
  podman network create whodb-poc
  podman run -d -p 8080:8080 --network whodb-poc docker.io/clidey/whodb
  podman run -d --name mysql -e MYSQL_ROOT_PASSWORD=password --network whodb-poc docker.io/mysql:9
  ```

  The attacker connects to the database via WhoDB. Note that in the `Loc` field, the string `&allowAllFiles=true` is inserted:

  ![2025-01-21-13-28-08](https://github.com/user-attachments/assets/28709707-97e4-4d26-b61c-5462db6dd43f)

  After connecting, the attacker navigates to the scratchpad in `/scratchpad`.

  The attacker first creates a demo table:
  ```sql
  CREATE TABLE poc (
      line TEXT
  );
  ```

  The attacker then enables loading files from the server side. For the sake of clarity, do note that while this is required, the file is not being read from the remote server where MySQL is running, but the local machine that WhoDB is running on.
  ```sql
  SET GLOBAL local_infile=1;
  ```

  The attacker then uses the `LOAD DATA LOCAL INFILE` statement to read the contents of `/etc/passwd` (in this case from inside the container where WhoDB is running) into the previously created table:
  ```sql
  LOAD DATA LOCAL INFILE '/etc/passwd'
  INTO TABLE poc
  FIELDS TERMINATED BY '\0'
  LINES TERMINATED BY '\n';
  ```

  The attacker then navigates to the `poc` table in the _Tables_ view and observes that the file has been read successfully:

  ![2025-01-21-14-04-47](https://github.com/user-attachments/assets/c8f499ce-0d40-49ba-a2c6-fe2d12c677c5)

  ### Impact

  While this proof-of-concept demonstrates local file inclusion, the root cause of the issue is the unsafe construction of database connection URIs from user input. Not all database connector libraries used in WhoDB were inspected; there may be libraries which allow for even more impactful parameters.

  The attack requires no user authentication to WhoDB (only authentication to any database server, such as an attacker-controlled one) and no special configuration - the default configuration of the application is vulnerable.
impacted_packages: []
severities:
  - score: '8.6'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:N/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/02/GHSA-c7w4-9wv8-7x7c/GHSA-c7w4-9wv8-7x7c.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-943
references:
  - url: https://github.com/clidey/whodb
    reference_type:
    reference_id:
  - url: https://github.com/clidey/whodb/commit/8d67b767e00552e5eba2b1537179b74bfa662ee1
    reference_type:
    reference_id:
  - url: https://github.com/clidey/whodb/security/advisories/GHSA-c7w4-9wv8-7x7c
    reference_type:
    reference_id:
  - url: https://github.com/go-sql-driver/mysql/blob/7403860363ca112af503b4612568c3096fecb466/infile.go#L128
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-24787
    reference_type:
    reference_id: CVE-2025-24787
