advisory_id: GHSA-jq87-2wxp-8349
datasource_id: github_osv_importer_v2/GHSA-jq87-2wxp-8349
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/06/GHSA-jq87-2wxp-8349/GHSA-jq87-2wxp-8349.json
aliases: []
summary: |
  ZendFramework Route Parameter Injection Via Query String in `Zend\Mvc`
  In Zend Framework 2, `Zend\Mvc\Router\Http\Query` is used primarily to allow appending query strings to URLs when assembled. However, due to the fact that it captures any query parameters into the RouteMatch, and the fact that RouteMatch parameters are merged with any parent routes, this can lead to overriding already captured routing parameters, bypassing constraints defined in the parents.

  As an example, consider the following route definition:
  ```
  array(
      'user' => array(
          'type' => 'segment',
          'options' => array(
              'route' => '/user/:key',
              'defaults' => array(
                  'controller' => 'UserController',
                  'action'     => 'show-action',
              ),
              'constraints' => array(
                  'key' => '[a-z0-9]+',
              ),
          ),
          'child_routes' => array(
              'query' => array('type' => 'query'),
          ),
      ),
  )
  ```
  If the request URI was /user/foo/?controller=SecretController&key=invalid_value, the RouteMatch returned after routing would contain the following:
  ```
  array(
      'controller' => 'SecretController',
      'action'     => 'show-action',
      'key'        => 'invalid_value',
  )
  ```
  This would lead to execution of a different controller than intended, with a value for the key parameter that bypassed the constraints outlined in the parent route.
impacted_packages:
  - purl: pkg:composer/zendframework/zendframework
    affected_versions: vers:composer/>=2.0.0|<2.0.8
    fixed_versions: vers:composer/2.0.8
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:composer/zendframework/zendframework
    affected_versions: vers:composer/>=2.1.0|<2.1.4
    fixed_versions: vers:composer/2.1.4
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/06/GHSA-jq87-2wxp-8349/GHSA-jq87-2wxp-8349.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-74
references:
  - url: https://framework.zend.com/security/advisory/ZF2013-01
    reference_type:
    reference_id:
  - url: https://github.com/FriendsOfPHP/security-advisories/blob/master/zendframework/zendframework/ZF2013-01.yaml
    reference_type:
    reference_id:
  - url: https://github.com/zendframework/zendframework
    reference_type:
    reference_id:
  - url: https://github.com/zendframework/zendframework/commit/0a7ec3407f02db29ea2ffd6daa71ead6fd151cfe
    reference_type:
    reference_id:
  - url: https://github.com/zendframework/zendframework/commit/7fcb88ebc2d56f74aa943909f2b6b53f5c86b081
    reference_type:
    reference_id:
