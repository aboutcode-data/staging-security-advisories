advisory_id: GHSA-9298-4cf8-g4wj
datasource_id: github_osv_importer_v2/GHSA-9298-4cf8-g4wj
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/10/GHSA-9298-4cf8-g4wj/GHSA-9298-4cf8-g4wj.json
aliases:
  - CVE-2024-49768
summary: |
  Waitress has request processing race condition in HTTP pipelining with invalid first request
  ### Impact

  A remote client may send a request that is exactly `recv_bytes` (defaults to 8192) long, followed by a secondary request using HTTP pipelining.

  When request lookahead is disabled (default) we won't read any more requests, and when the first request fails due to a parsing error, we simply close the connection.

  However when request lookahead is enabled, it is possible to process and receive the first request, start sending the error message back to the client while we read the next request and queue it. This will allow the secondary request to be serviced by the worker thread while the connection should be closed.

  ### Patches

  Waitress 3.0.1 fixes the race condition.

  ### Workarounds

  Disable  `channel_request_lookahead`, this is set to `0` by default disabling this feature. For this vulnerability this value is required to be changed from the default.

  ### For more information

  If you have any questions or comments about this advisory:
  * Open an issue in https://github.com/Pylons/waitress/issues (if not sensitive or security related)
  * email the Pylons Security mailing list: [pylons-project-security@googlegroups.com](mailto:pylons-project-security@googlegroups.com) (if security related)

  ### Thanks

  - m4yfly and urn1ce From TianGong Team of Legendsec at Qi'anxin Group.
impacted_packages:
  - purl: pkg:pypi/waitress
    affected_versions: vers:pypi/>=2.0.0|<3.0.1
    fixed_versions: vers:pypi/3.0.1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '9.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/10/GHSA-9298-4cf8-g4wj/GHSA-9298-4cf8-g4wj.json
  - score: '9.3'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:N/SC:N/SI:N/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/10/GHSA-9298-4cf8-g4wj/GHSA-9298-4cf8-g4wj.json
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-444
  - CWE-367
references:
  - url: https://github.com/Pylons/waitress
    reference_type:
    reference_id:
  - url: https://github.com/Pylons/waitress/commit/e4359018537af376cf24bd13616d861e2fb76f65
    reference_type:
    reference_id:
  - url: https://github.com/Pylons/waitress/security/advisories/GHSA-9298-4cf8-g4wj
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/waitress/PYSEC-2024-210.yaml
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-49768
    reference_type:
    reference_id: CVE-2024-49768
