advisory_id: GHSA-3cw5-7cxw-v5qg
datasource_id: github_osv_importer_v2/GHSA-3cw5-7cxw-v5qg
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/02/GHSA-3cw5-7cxw-v5qg/GHSA-3cw5-7cxw-v5qg.json
aliases:
  - CVE-2023-23924
summary: "Dompdf vulnerable to URI validation failure on SVG parsing\n### Summary\nThe URI validation\
  \ on dompdf 2.0.1 can be bypassed on SVG parsing by passing `<image>` tags with uppercase\
  \ letters. This might leads to arbitrary object unserialize on PHP < 8, through the `phar`\
  \ URL wrapper.\n\n### Details\nThe bug occurs during SVG parsing of `<image>` tags, in src/Image/Cache.php\
  \ : \n\n```\nif ($type === \"svg\") {\n    $parser = xml_parser_create(\"utf-8\");\n    xml_parser_set_option($parser,\
  \ XML_OPTION_CASE_FOLDING, false);\n    xml_set_element_handler(\n        $parser,\n     \
  \   function ($parser, $name, $attributes) use ($options, $parsed_url, $full_url) {\n    \
  \        if ($name === \"image\") {\n                $attributes = array_change_key_case($attributes,\
  \ CASE_LOWER);\n```\nThis part will try to detect `<image>` tags in SVG, and will take the\
  \ href to validate it against the protocolAllowed whitelist. However, the `$name comparison\
  \ with \"image\" is case sensitive, which means that such a tag in the SVG will pass : \n\n\
  ```\n<svg>\n    <Image xlink:href=\"phar:///foo\"></Image>\n</svg>\n```\n\nAs the tag is named\
  \ \"Image\" and not \"image\", it will not pass the condition to trigger the check.\n\nA correct\
  \ solution would be to strtolower the `$name` before the check : \n\n```\nif (strtolower($name)\
  \ === \"image\") {\n```\n\n### PoC\nParsing the following SVG file is sufficient to reproduce\
  \ the vulnerability :\n\n```\n<svg>\n    <Image xlink:href=\"phar:///foo\"></Image>\n</svg>\n\
  ```\n\n### Impact\nAn attacker might be able to exploit the vulnerability to call arbitrary\
  \ URL with arbitrary protocols, if they can provide a SVG file to dompdf. In PHP versions\
  \ before 8.0.0, it leads to arbitrary unserialize, that will leads at the very least to an\
  \ arbitrary file deletion, and might leads to remote code execution, depending on classes\
  \ that are available."
impacted_packages:
  - purl: pkg:composer/dompdf/dompdf
    affected_versions: vers:composer/<2.0.2
    fixed_versions: vers:composer/2.0.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '10.0'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:L/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/02/GHSA-3cw5-7cxw-v5qg/GHSA-3cw5-7cxw-v5qg.json
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-863
  - CWE-551
references:
  - url: https://github.com/advisories/GHSA-3cw5-7cxw-v5qg
    reference_type:
    reference_id:
  - url: https://github.com/dompdf/dompdf
    reference_type:
    reference_id:
  - url: https://github.com/dompdf/dompdf/commit/7558f07f693b2ac3266089f21051e6b78c6a0c85
    reference_type:
    reference_id:
  - url: https://github.com/dompdf/dompdf/releases/tag/v2.0.2
    reference_type:
    reference_id:
  - url: https://github.com/dompdf/dompdf/security/advisories/GHSA-3cw5-7cxw-v5qg
    reference_type:
    reference_id:
  - url: https://github.com/FriendsOfPHP/security-advisories/blob/master/dompdf/dompdf/CVE-2023-23924.yaml
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-23924
    reference_type:
    reference_id: CVE-2023-23924
