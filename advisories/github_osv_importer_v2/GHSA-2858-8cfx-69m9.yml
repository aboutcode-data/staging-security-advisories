advisory_id: GHSA-2858-8cfx-69m9
datasource_id: github_osv_importer_v2/GHSA-2858-8cfx-69m9
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/04/GHSA-2858-8cfx-69m9/GHSA-2858-8cfx-69m9.json
aliases:
  - CVE-2024-31982
summary: |
  XWiki Platform: Remote code execution as guest via DatabaseSearch
  ### Impact
  XWiki's database search allows remote code execution through the search text. This allows remote code execution for any visitor of a public wiki or user of a closed wiki as the database search is by default accessible for all users. This impacts the confidentiality, integrity and availability of the whole XWiki installation.

  To reproduce on an instance, without being logged in, go to `<hostname>/xwiki/bin/get/Main/DatabaseSearch?outputSyntax=plain&text=%7D%7D%7D%7B%7Basync%20async%3Dfalse%7D%7D%7B%7Bgroovy%7D%7Dprintln%28%22Hello%20from%22%20%2B%20%22%20search%20text%3A%22%20%2B%20%2823%20%2B%2019%29%29%7B%7B%2Fgroovy%7D%7D%7B%7B%2Fasync%7D%7D%20`. If the title of the RSS channel contains `Hello from search text:42`, the instance is vulnerable.

  ### Patches
  This vulnerability has been patched in XWiki 14.10.20, 15.5.4 and 15.10RC1.

  ### Workarounds
  It is possible to manually apply [this patch](https://github.com/xwiki/xwiki-platform/commit/95bdd6cc6298acdf7f8f21298d40eeb8390a8565#diff-ef3314b8bb489e5368618ea1940c59098b18ec2246cc65fe337ae636de87e404) to the page `Main.DatabaseSearch`. Alternatively, unless database search is explicitly used by users, this page can be deleted as this is not the default search interface of XWiki.

  ### References
  * https://jira.xwiki.org/browse/XWIKI-21472
  * https://github.com/xwiki/xwiki-platform/commit/95bdd6cc6298acdf7f8f21298d40eeb8390a8565
impacted_packages:
  - purl: pkg:maven/org.xwiki.platform/xwiki-platform-search-ui
    affected_versions: vers:maven/>=2.4-milestone-1|<14.10.20
    fixed_versions: vers:maven/14.10.20
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.xwiki.platform/xwiki-platform-search-ui
    affected_versions: vers:maven/>=15.0-rc-1|<15.5.4
    fixed_versions: vers:maven/15.5.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.xwiki.platform/xwiki-platform-search-ui
    affected_versions: vers:maven/>=15.6-rc-1|<15.10-rc-1
    fixed_versions: vers:maven/15.10-rc-1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '10.0'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/04/GHSA-2858-8cfx-69m9/GHSA-2858-8cfx-69m9.json
  - score: '10.0'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:H/VA:H/SC:H/SI:H/SA:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/04/GHSA-2858-8cfx-69m9/GHSA-2858-8cfx-69m9.json
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-95
  - CWE-94
references:
  - url: https://github.com/xwiki/xwiki-platform
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-platform/commit/3c9e4bb04286de94ad24854026a09fa967538e31
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-platform/commit/459e968be8740c8abc2a168196ce21e5ba93cfb8
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-platform/commit/95bdd6cc6298acdf7f8f21298d40eeb8390a8565
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-2858-8cfx-69m9
    reference_type:
    reference_id:
  - url: https://jira.xwiki.org/browse/XWIKI-21472
    reference_type:
    reference_id:
  - url: https://www.vicarius.io/vsociety/posts/cve-2024-31982-detect-xwiki-vulnerability
    reference_type:
    reference_id:
  - url: https://www.vicarius.io/vsociety/posts/cve-2024-31982-xwiki-mitigation-vulnerability
    reference_type:
    reference_id:
  - url: https://www.vicarius.io/vsociety/posts/xwiki-rce-cve-2024-31982
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-31982
    reference_type:
    reference_id: CVE-2024-31982
