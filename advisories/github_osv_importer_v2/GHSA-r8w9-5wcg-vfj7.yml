advisory_id: GHSA-r8w9-5wcg-vfj7
datasource_id: github_osv_importer_v2/GHSA-r8w9-5wcg-vfj7
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/03/GHSA-r8w9-5wcg-vfj7/GHSA-r8w9-5wcg-vfj7.json
aliases:
  - CVE-2024-27308
summary: |
  Mio's tokens for named pipes may be delivered after deregistration
  ### Impact

  When using named pipes on Windows, mio will under some circumstances return invalid tokens that correspond to named pipes that have already been deregistered from the mio registry. The impact of this vulnerability depends on how mio is used. For some applications, invalid tokens may be ignored or cause a warning or a crash. On the other hand, for applications that store pointers in the tokens, this vulnerability may result in a use-after-free.

  For users of Tokio, this vulnerability is serious and can result in a use-after-free in Tokio.

  The vulnerability is Windows-specific, and can only happen if you are using named pipes. Other IO resources are not affected.

  ### Affected versions
  This vulnerability has been fixed in mio v0.8.11.

  All versions of mio between v0.7.2 and v0.8.10 are vulnerable.

  Tokio is vulnerable when you are using a vulnerable version of mio AND you are using at least Tokio v1.30.0. Versions of Tokio prior to v1.30.0 will ignore invalid tokens, so they are not vulnerable.

  ### Workarounds
  Vulnerable libraries that use mio can work around this issue by detecting and ignoring invalid tokens.

  ### Technical details

  When an IO resource registered with mio has a readiness event, mio delivers that readiness event to the user using a user-specified token. Mio guarantees that when an IO resource is [deregistered](https://docs.rs/mio/latest/mio/struct.Registry.html#method.deregister), then it will never return the token for that IO resource again. However, for named pipes on windows, mio may sometimes deliver the token for a named pipe even though the named pipe has been previously deregistered.

  This vulnerability was originally reported in the Tokio issue tracker: [tokio-rs/tokio#6369](https://github.com/tokio-rs/tokio/issues/6369)
  This vulnerability was fixed in: [tokio-rs/mio#1760](https://github.com/tokio-rs/mio/pull/1760)
  This vulnerability is also known as [RUSTSEC-2024-0019](https://rustsec.org/advisories/RUSTSEC-2024-0019.html).

  Thank you to @rofoun and @radekvit for discovering and reporting this issue.
impacted_packages: []
severities:
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/03/GHSA-r8w9-5wcg-vfj7/GHSA-r8w9-5wcg-vfj7.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-416
  - CWE-672
references:
  - url: https://github.com/tokio-rs/mio
    reference_type:
    reference_id:
  - url: https://github.com/tokio-rs/mio/commit/90d4fe00df870acd3d38f3dc4face9aacab8fbb9
    reference_type:
    reference_id:
  - url: https://github.com/tokio-rs/mio/pull/1760
    reference_type:
    reference_id:
  - url: https://github.com/tokio-rs/mio/security/advisories/GHSA-r8w9-5wcg-vfj7
    reference_type:
    reference_id:
  - url: https://github.com/tokio-rs/tokio/issues/6369
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-27308
    reference_type:
    reference_id: CVE-2024-27308
