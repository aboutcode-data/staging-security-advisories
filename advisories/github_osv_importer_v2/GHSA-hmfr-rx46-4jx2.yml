advisory_id: GHSA-hmfr-rx46-4jx2
datasource_id: github_osv_importer_v2/GHSA-hmfr-rx46-4jx2
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/08/GHSA-hmfr-rx46-4jx2/GHSA-hmfr-rx46-4jx2.json
aliases: []
summary: |
  GraphQL Armor Max-Depth Plugin Bypass via Introspection Query Obfuscation
  ### Summary
  A query depth restriction using the `max-depth` property can be bypassed if `ignoreIntrospection` is enabled (which is the default configuration) by naming your query/fragment `__schema`.

  ### Details
  At the start of the `countDepth` function, we have the following check for the `ignoreIntrospection` option:

  ```typescript
      if (this.config.ignoreIntrospection && 'name' in node && node.name?.value === '__schema') {
          return 0;
      }
  ```

  However, the `node` can be one of: `FieldNode`, `FragmentDefinitionNode`, `InlineFragmentNode`, `OperationDefinitionNode`, `FragmentSpreadNode`.

  For example, consider sending the following query:

  ```graphql
  query hello {
    books {
      title
    }
  }
  ```

  This would create an `OperationDefinitionNode` where `node.name.value == 'hello'`

  The proper way to handle this is to check explicitly for the `__schema` field, which corresponds to a `FieldNode`.

  The fix is

  ```typescript
      if (
        this.config.ignoreIntrospection &&
        'name' in node &&
        node.name?.value === '__schema' &&
        node.kind === Kind.FIELD
      ) {
        return 0;
      }
  ```

  This ensures that the node is explicitly a `FieldNode`.

  ### PoC

  Max depth: `6`

  ```graphql
  query {
    books {
      author {
        books {
          author {
            ...__schema
          }
        }
      }
    }
  }
  fragment __schema on Author {
    books {
      title
    }
  }
  ```

  ### Impact

  This issue affects applications using the GraphQL Armor Depth Limit plugin with `ignoreIntrospection` enabled.

  ### Fix

  This is fixed in [PR#823](https://github.com/Escape-Technologies/graphql-armor/pull/823)
impacted_packages:
  - purl: pkg:npm/%40escape.tech/graphql-armor-max-depth
    affected_versions: vers:npm/<=2.4.1
    fixed_versions: vers:npm/2.4.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '5.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/08/GHSA-hmfr-rx46-4jx2/GHSA-hmfr-rx46-4jx2.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-400
references:
  - url: https://github.com/Escape-Technologies/graphql-armor
    reference_type:
    reference_id:
  - url: https://github.com/Escape-Technologies/graphql-armor/commit/1f923bc09f5f053f60b6ba2bd419d4b94cbe1db3
    reference_type:
    reference_id:
  - url: https://github.com/Escape-Technologies/graphql-armor/pull/823
    reference_type:
    reference_id:
  - url: https://github.com/Escape-Technologies/graphql-armor/security/advisories/GHSA-hmfr-rx46-4jx2
    reference_type:
    reference_id:
