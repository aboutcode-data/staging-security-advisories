advisory_id: GHSA-5hq2-xf89-9jxq
datasource_id: github_osv_importer_v2/GHSA-5hq2-xf89-9jxq
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/05/GHSA-5hq2-xf89-9jxq/GHSA-5hq2-xf89-9jxq.json
aliases:
  - CVE-2021-22903
summary: |
  Possible Open Redirect Vulnerability in Action Pack
  There is a possible Open Redirect Vulnerability in Action Pack.

  Versions Affected:  >= v6.1.0.rc2
  Not affected:       < v6.1.0.rc2
  Fixed Versions:     6.1.3.2

  Impact
  ------
  This is similar to CVE-2021-22881. Specially crafted Host headers in combination with certain "allowed host" formats can cause the Host Authorization middleware in Action Pack to redirect users to a malicious
  website.

  Since rails/rails@9bc7ea5, strings in config.hosts that do not have a leading dot are converted to regular expressions without proper escaping. This causes, for example, config.hosts << "sub.example.com" to permit a request with a Host header value of sub-example.com.


  Releases
  --------
  The fixed releases are available at the normal locations.

  Workarounds
  -----------
  The following monkey patch put in an initializer can be used as a workaround.

  ```ruby
  class ActionDispatch::HostAuthorization::Permissions
    def sanitize_string(host)
      if host.start_with?(".")
        /\A(.+\.)?#{Regexp.escape(host[1..-1])}\z/i
      else
        /\A#{Regexp.escape host}\z/i
      end
    end
  end
  ```

  Patches
  -------
  To aid users who aren't able to upgrade immediately we have provided patches for the two supported release series. They are in git-am format and consist of a single changeset.

  * 6-1-open-redirect.patch - Patch for 6.1 series

  Please note that only the 6.1.Z, 6.0.Z, and 5.2.Z series are supported at present. Users of earlier unsupported releases are advised to upgrade as soon as possible as we cannot guarantee the continued availability of security fixes for unsupported releases.

  Credits
  -------

  Thanks Jonathan Hefner (https://hackerone.com/jonathanhefner) for reporting this bug!
impacted_packages:
  - purl: pkg:gem/actionpack
    affected_versions: vers:gem/>=6.1.0.rc2|<6.1.3.2
    fixed_versions: vers:gem/6.1.3.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '6.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/05/GHSA-5hq2-xf89-9jxq/GHSA-5hq2-xf89-9jxq.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-601
references:
  - url: https://discuss.rubyonrails.org/t/cve-2021-22903-possible-open-redirect-vulnerability-in-action-pack/77867
    reference_type:
    reference_id:
  - url: https://github.com/rails/rails/releases/tag/v6.1.3.2
    reference_type:
    reference_id:
  - url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/actionpack/CVE-2021-22903.yml
    reference_type:
    reference_id:
  - url: https://groups.google.com/g/rubyonrails-security/c/8TxqXEtgSF0
    reference_type:
    reference_id:
  - url: https://hackerone.com/reports/1148025
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-22903
    reference_type:
    reference_id: CVE-2021-22903
