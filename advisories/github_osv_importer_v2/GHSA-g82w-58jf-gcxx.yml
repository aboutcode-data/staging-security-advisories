advisory_id: GHSA-g82w-58jf-gcxx
datasource_id: github_osv_importer_v2/GHSA-g82w-58jf-gcxx
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/05/GHSA-g82w-58jf-gcxx/GHSA-g82w-58jf-gcxx.json
aliases:
  - CVE-2023-2878
summary: |
  secrets-store-csi-driver discloses service account tokens in logs
  A security issue was discovered in secrets-store-csi-driver where an actor with access to the driver logs could observe service account tokens.  These tokens could then potentially be exchanged with external cloud providers to access secrets stored in cloud vault solutions.  Tokens are only logged when [TokenRequests is configured in the CSIDriver object](https://kubernetes-csi.github.io/docs/token-requests.html) and the driver is set to run at log level 2 or greater via the -v flag.


  This issue has been rated MEDIUM [CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:N/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:N/A:N) (6.5), and assigned CVE-2023-2878


  ### Am I vulnerable?

  You may be vulnerable if [TokenRequests is configured in the CSIDriver object](https://kubernetes-csi.github.io/docs/token-requests.html) and the driver is set to run at log level 2 or greater via the -v flag.


  To check if token requests are configured, run the following command:

  ```bash
  kubectl get csidriver secrets-store.csi.k8s.io -o jsonpath="{.spec.tokenRequests}"
  ```

  To check if tokens are being logged, examine the secrets-store container log:

  ```bash
  kubectl logs -l app=secrets-store-csi-driver -c secrets-store -f | grep --line-buffered "csi.storage.k8s.io/serviceAccount.tokens"
  ```

  ### Affected Versions

  - secrets-store-csi-driver < 1.3.3


  ### How do I mitigate this vulnerability?

  Prior to upgrading, this vulnerability can be mitigated by running secrets-store-csi-driver at log level 0 or 1 via the -v flag.


  ### Fixed Versions


  - secrets-store-csi-driver >= 1.3.3


  To upgrade, refer to the documentation: https://secrets-store-csi-driver.sigs.k8s.io/getting-started/upgrades.html#upgrades


  ### Detection


  Examine cloud provider logs for unexpected token exchanges, as well as unexpected access to cloud vault secrets.


  If you find evidence that this vulnerability has been exploited, please contact [security@kubernetes.io](https://groups.google.com/)
impacted_packages: []
severities:
  - score: '6.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:H/I:N/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/05/GHSA-g82w-58jf-gcxx/GHSA-g82w-58jf-gcxx.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-532
references:
  - url: https://github.com/kubernetes/kubernetes/issues/118419
    reference_type:
    reference_id:
  - url: https://github.com/kubernetes-sigs/secrets-store-csi-driver
    reference_type:
    reference_id:
  - url: https://github.com/kubernetes-sigs/secrets-store-csi-driver/releases/tag/v1.3.3
    reference_type:
    reference_id:
  - url: https://github.com/kubernetes-sigs/secrets-store-csi-driver/security/advisories/GHSA-g82w-58jf-gcxx
    reference_type:
    reference_id:
  - url: https://groups.google.com/g/kubernetes-security-announce/c/5K8ghQHBDdQ/m/Udee6YUgAAAJ
    reference_type:
    reference_id:
  - url: https://security.netapp.com/advisory/ntap-20230814-0003
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-2878
    reference_type:
    reference_id: CVE-2023-2878
