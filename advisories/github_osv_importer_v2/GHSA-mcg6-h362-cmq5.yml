advisory_id: GHSA-mcg6-h362-cmq5
datasource_id: github_osv_importer_v2/GHSA-mcg6-h362-cmq5
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/03/GHSA-mcg6-h362-cmq5/GHSA-mcg6-h362-cmq5.json
aliases:
  - CVE-2022-0860
summary: |
  Improper Authorization in cobbler
  ### Impact

  If PAM is correctly configured and a user account is set to expired, the expired user-account is still able to successfully log into Cobbler in all places (Web UI, CLI & XMLRPC-API).

  The same applies to user accounts with passwords set to be expired.

  ### Patches

  There is a patch for the latest Cobbler `3.3.2` available, however a backport will be done for `3.2.x`.

  ### Workarounds

  - Delete expired accounts which are able to access Cobbler via PAM.
  - Use `chage -l <username>` to lock the account. If the account has SSH-Keys attached then remove them completely.

  ### References

  - Originally discovered by @ysf at https://www.huntr.dev/bounties/c458b868-63df-414e-af10-47e3745caa1d/

  ### How to test if my Cobbler instance is affected?

  The following `pytest` test assumes that your PAM setup is correct. In case the added user is not able to login, this test does not make sense to be executed.

  ```python
  def test_pam_login_with_expired_user():
      # Arrange
      # create pam testuser
      test_username = "expired_user"
      test_password = "password"
      test_api = CobblerAPI()
      subprocess_1 = subprocess.run(
          ["perl", "-e", "'print crypt(\"%s\", \"%s\")'" % (test_username, test_password)],
          stdout=subprocess.PIPE
      )
      subprocess.run(["useradd", "-p", subprocess_1.stdout, test_username])
      # change user to be expired
      subprocess.run(["chage", "-E0", test_username])

      # Act
      result = pam.authenticate(test_api, test_username, test_password)

      # Assert - login should fail
      assert not result
  ```

  ### For more information
  If you have any questions or comments about this advisory:
  * Open an issue in [the Cobbler repository](https://github.com/cobbler/cobbler/issues/new/choose)
  * Ask in the [Gitter/Matrix Chat](https://gitter.im/cobbler/community)
  * Email us at [cobbler.project@gmail.com](mailto:cobbler.project@gmail.com)
impacted_packages:
  - purl: pkg:pypi/cobbler
    affected_versions: vers:pypi/<3.3.2
    fixed_versions: vers:pypi/3.3.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '8.2'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:L/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/03/GHSA-mcg6-h362-cmq5/GHSA-mcg6-h362-cmq5.json
  - score: '6.7'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:L/VA:N/SC:N/SI:N/SA:N/E:U
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/03/GHSA-mcg6-h362-cmq5/GHSA-mcg6-h362-cmq5.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-285
  - CWE-863
references:
  - url: https://github.com/advisories/GHSA-mcg6-h362-cmq5
    reference_type:
    reference_id:
  - url: https://github.com/cobbler/cobbler
    reference_type:
    reference_id:
  - url: https://github.com/cobbler/cobbler/commit/9044aa990a94752fa5bd5a24051adde099280bfa
    reference_type:
    reference_id:
  - url: https://github.com/cobbler/cobbler/security/advisories/GHSA-mcg6-h362-cmq5
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/cobbler/PYSEC-2022-177.yaml
    reference_type:
    reference_id:
  - url: https://huntr.dev/bounties/c458b868-63df-414e-af10-47e3745caa1d
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/D4KCNZYBQC2FM5SEEDRQZO4LRZ4ZECMG
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/DYWYHWVVRUSPCV5SWBOSAMQJQLTSBTKY
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/IYSHMF6MEIITFAG7EJ3IQKVUN7MDV2XM
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-0860
    reference_type:
    reference_id: CVE-2022-0860
