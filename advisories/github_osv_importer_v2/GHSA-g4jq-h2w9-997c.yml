advisory_id: GHSA-g4jq-h2w9-997c
datasource_id: github_osv_importer_v2/GHSA-g4jq-h2w9-997c
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/09/GHSA-g4jq-h2w9-997c/GHSA-g4jq-h2w9-997c.json
aliases:
  - CVE-2025-58751
summary: |
  Vite middleware may serve files starting with the same name with the public directory
  ### Summary
  Files starting with the same name with the public directory were served bypassing the `server.fs` settings.

  ### Impact
  Only apps that match the following conditions are affected:

  - explicitly exposes the Vite dev server to the network (using --host or [`server.host` config option](https://vitejs.dev/config/server-options.html#server-host))
  - uses [the public directory feature](https://vite.dev/guide/assets.html#the-public-directory) (enabled by default)
  - a symlink exists in the public directory

  ### Details
  The [servePublicMiddleware](https://github.com/vitejs/vite/blob/9719497adec4ad5ead21cafa19a324bb1d480194/packages/vite/src/node/server/middlewares/static.ts#L79) function is in charge of serving public files from the server. It returns the [viteServePublicMiddleware](https://github.com/vitejs/vite/blob/9719497adec4ad5ead21cafa19a324bb1d480194/packages/vite/src/node/server/middlewares/static.ts#L106) function which runs the needed tests and serves the page. The viteServePublicMiddleware function [checks if the publicFiles variable is defined](https://github.com/vitejs/vite/blob/9719497adec4ad5ead21cafa19a324bb1d480194/packages/vite/src/node/server/middlewares/static.ts#L111), and then uses it to determine if the requested page is public. In the case that the publicFiles is undefined, the code will treat the requested page as a public page, and go on with the serving function. [publicFiles may be undefined if there is a symbolic link anywhere inside the public directory](https://github.com/vitejs/vite/blob/9719497adec4ad5ead21cafa19a324bb1d480194/packages/vite/src/node/publicDir.ts#L21). In that case, every requested page will be passed to the public serving function. The serving function is based on the [sirv](https://github.com/lukeed/sirv) library. Vite patches the library to add the possibility to test loading access to pages, but when the public page middleware [disables this functionality](https://github.com/vitejs/vite/blob/9719497adec4ad5ead21cafa19a324bb1d480194/packages/vite/src/node/server/middlewares/static.ts#L89) since public pages are meant to be available always, regardless of whether they are in the allow or deny list.

  In the case of public pages, the serving function is [provided with the path to the public directory](https://github.com/vitejs/vite/blob/9719497adec4ad5ead21cafa19a324bb1d480194/packages/vite/src/node/server/middlewares/static.ts#L85) as a root directory. The code of the sirv library [uses the join function to get the full path to the requested file](https://github.com/lukeed/sirv/blob/d061616827dd32d53b61ec9530c9445c8f592620/packages/sirv/index.mjs#L42). For example, if the public directory is "/www/public", and the requested file is "myfile", the code will join them to the string "/www/public/myfile". The code will then pass this string to the normalize function. Afterwards, the code will [use the string's startsWith function](https://github.com/lukeed/sirv/blob/d061616827dd32d53b61ec9530c9445c8f592620/packages/sirv/index.mjs#L43) to determine whether the created path is within the given directory or not. Only if it is, it will be served.

  Since [sirv trims the trailing slash of the public directory](https://github.com/lukeed/sirv/blob/d061616827dd32d53b61ec9530c9445c8f592620/packages/sirv/index.mjs#L119), the string's startsWith function may return true even if the created path is not within the public directory. For example, if the server's root is at "/www", and the public directory is at "/www/p", if the created path will be "/www/private.txt", the startsWith function will still return true, because the string "/www/private.txt" starts with  "/www/p". To achieve this, the attacker will use ".." to ask for the file "../private.txt". The code will then join it to the "/www/p" string, and will receive "/www/p/../private.txt". Then, the normalize function will return "/www/private.txt", which will then be passed to the startsWith function, which will return true, and the processing of the page will continue without checking the deny list (since this is the public directory middleware which doesn't check that).

  ### PoC
  Execute the following shell commands:

  ```
  npm  create  vite@latest
  cd vite-project/
  mkdir p
  cd p
  ln -s a b
  cd ..
  echo  'import path from "node:path"; import { defineConfig } from "vite"; export default defineConfig({publicDir: path.resolve(__dirname, "p/"), server: {fs: {deny: [path.resolve(__dirname, "private.txt")]}}})' > vite.config.js
  echo  "secret" > private.txt
  npm install
  npm run dev
  ```

  Then, in a different shell, run the following command:

  `curl -v --path-as-is 'http://localhost:5173/private.txt'`

  You will receive a 403 HTTP Response,  because private.txt is denied.

  Now in the same shell run the following command:

  `curl -v --path-as-is 'http://localhost:5173/../private.txt'`

  You will receive the contents of private.txt.

  ### Related links
  - https://github.com/lukeed/sirv/commit/f0113f3f8266328d804ee808f763a3c11f8997eb
impacted_packages:
  - purl: pkg:npm/vite
    affected_versions: vers:npm/<=7.1.4
    fixed_versions: vers:npm/7.1.5
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:npm/vite
    affected_versions: vers:npm/<=7.0.6
    fixed_versions: vers:npm/7.0.7
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:npm/vite
    affected_versions: vers:npm/<=6.3.5
    fixed_versions: vers:npm/6.3.6
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:npm/vite
    affected_versions: vers:npm/<=5.4.19
    fixed_versions: vers:npm/5.4.20
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '2.3'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:P/PR:N/UI:P/VC:L/VI:N/VA:N/SC:N/SI:N/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/09/GHSA-g4jq-h2w9-997c/GHSA-g4jq-h2w9-997c.json
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-200
  - CWE-284
  - CWE-22
references:
  - url: https://github.com/lukeed/sirv/commit/f0113f3f8266328d804ee808f763a3c11f8997eb
    reference_type:
    reference_id:
  - url: https://github.com/vitejs/vite
    reference_type:
    reference_id:
  - url: https://github.com/vitejs/vite/commit/09f2b52e8d5907f26602653caf41b3a56692600d
    reference_type:
    reference_id:
  - url: https://github.com/vitejs/vite/commit/4f1c35bcbb5830290c694aa14b6789e07450f069
    reference_type:
    reference_id:
  - url: https://github.com/vitejs/vite/commit/63e2a5d232218f3f8d852056751e609a5367aaec
    reference_type:
    reference_id:
  - url: https://github.com/vitejs/vite/commit/e11d24008b97d4ca731ecc1a3b95260a6d12e7e0
    reference_type:
    reference_id:
  - url: https://github.com/vitejs/vite/security/advisories/GHSA-g4jq-h2w9-997c
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-58751
    reference_type:
    reference_id:
