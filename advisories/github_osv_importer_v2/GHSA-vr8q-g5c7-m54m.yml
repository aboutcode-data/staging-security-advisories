advisory_id: GHSA-vr8q-g5c7-m54m
datasource_id: github_osv_importer_v2/GHSA-vr8q-g5c7-m54m
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2020/12/GHSA-vr8q-g5c7-m54m/GHSA-vr8q-g5c7-m54m.json
aliases:
  - CVE-2020-26247
summary: "Nokogiri::XML::Schema trusts input by default, exposing risk of XXE vulnerability\n\
  ### Severity\n\nNokogiri maintainers have evaluated this as [__Low Severity__ (CVSS3 2.6)](https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:H/PR:L/UI:R/S:U/C:L/I:N/A:N).\n\
  \n\n### Description\n\nIn Nokogiri versions <= 1.11.0.rc3, XML Schemas parsed by `Nokogiri::XML::Schema`\
  \ are **trusted** by default, allowing external resources to be accessed over the network,\
  \ potentially enabling XXE or SSRF attacks.\n\nThis behavior is counter to the security policy\
  \ followed by Nokogiri maintainers, which is to treat all input as **untrusted** by default\
  \ whenever possible.\n\nPlease note that this security fix was pushed into a new minor version,\
  \ 1.11.x, rather than a patch release to the 1.10.x branch, because it is a breaking change\
  \ for some schemas and the risk was assessed to be \"Low Severity\".\n\n\n### Affected Versions\n\
  \nNokogiri `<= 1.10.10` as well as prereleases `1.11.0.rc1`, `1.11.0.rc2`, and `1.11.0.rc3`\n\
  \n\n### Mitigation\n\nThere are no known workarounds for affected versions. Upgrade to Nokogiri\
  \ `1.11.0.rc4` or later.\n\nIf, after upgrading to `1.11.0.rc4` or later, you wish to re-enable\
  \ network access for resolution of external resources (i.e., return to the previous behavior):\n\
  \n1. Ensure the input is trusted. Do not enable this option for untrusted input.\n2. When\
  \ invoking the `Nokogiri::XML::Schema` constructor, pass as the second parameter an instance\
  \ of `Nokogiri::XML::ParseOptions` with the `NONET` flag turned off.\n\nSo if your previous\
  \ code was:\n\n``` ruby\n# in v1.11.0.rc3 and earlier, this call allows resources to be accessed\
  \ over the network\n# but in v1.11.0.rc4 and later, this call will disallow network access\
  \ for external resources\nschema = Nokogiri::XML::Schema.new(schema)\n\n# in v1.11.0.rc4 and\
  \ later, the following is equivalent to the code above\n# (the second parameter is optional,\
  \ and this demonstrates its default value)\nschema = Nokogiri::XML::Schema.new(schema, Nokogiri::XML::ParseOptions::DEFAULT_SCHEMA)\n\
  ```\n\nThen you can add the second parameter to indicate that the input is trusted by changing\
  \ it to:\n\n``` ruby\n# in v1.11.0.rc3 and earlier, this would raise an ArgumentError \n#\
  \ but in v1.11.0.rc4 and later, this allows resources to be accessed over the network\nschema\
  \ = Nokogiri::XML::Schema.new(trusted_schema, Nokogiri::XML::ParseOptions.new.nononet)\n```\n\
  \n\n### References\n\n- [This issue's public advisory](https://github.com/sparklemotion/nokogiri/security/advisories/GHSA-vr8q-g5c7-m54m)\n\
  - [Original Hackerone report (private)](https://hackerone.com/reports/747489)\n- [OWASP description\
  \ of XXE attack](https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Processing)\n-\
  \ [OWASP description of SSRF attack](https://www.owasp.org/index.php/Server_Side_Request_Forgery)\n\
  \n\n### Credit \n\nThis vulnerability was independently reported by @eric-therond and @gucki.\n\
  \nThe Nokogiri maintainers would like to thank [HackerOne](https://hackerone.com/nokogiri)\
  \ for providing a secure, responsible mechanism for reporting, and for providing their fantastic\
  \ service to us."
impacted_packages:
  - purl: pkg:gem/nokogiri
    affected_versions: vers:gem/<=1.10.10
    fixed_versions: vers:gem/1.11.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '4.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2020/12/GHSA-vr8q-g5c7-m54m/GHSA-vr8q-g5c7-m54m.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-611
references:
  - url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/nokogiri/CVE-2020-26247.yml
    reference_type:
    reference_id:
  - url: https://github.com/sparklemotion/nokogiri
    reference_type:
    reference_id:
  - url: https://github.com/sparklemotion/nokogiri/blob/main/CHANGELOG.md#v1110--2021-01-03
    reference_type:
    reference_id:
  - url: https://github.com/sparklemotion/nokogiri/commit/9c87439d9afa14a365ff13e73adc809cb2c3d97b
    reference_type:
    reference_id:
  - url: https://github.com/sparklemotion/nokogiri/releases/tag/v1.11.0.rc4
    reference_type:
    reference_id:
  - url: https://github.com/sparklemotion/nokogiri/security/advisories/GHSA-vr8q-g5c7-m54m
    reference_type:
    reference_id:
  - url: https://hackerone.com/reports/747489
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2021/06/msg00007.html
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2022/10/msg00018.html
    reference_type:
    reference_id:
  - url: https://rubygems.org/gems/nokogiri
    reference_type:
    reference_id:
  - url: https://security.gentoo.org/glsa/202208-29
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2020-26247
    reference_type:
    reference_id: CVE-2020-26247
