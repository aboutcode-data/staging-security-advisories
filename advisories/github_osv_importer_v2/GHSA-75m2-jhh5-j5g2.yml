advisory_id: GHSA-75m2-jhh5-j5g2
datasource_id: github_osv_importer_v2/GHSA-75m2-jhh5-j5g2
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/04/GHSA-75m2-jhh5-j5g2/GHSA-75m2-jhh5-j5g2.json
aliases:
  - CVE-2025-32034
summary: |
  Apollo Router Query Planner Vulnerable to Excessive Resource Consumption via Named Fragment Expansion
  # Impact

  ## Summary

  A vulnerability in Apollo Router allowed queries with deeply nested and reused named fragments to be prohibitively expensive to query plan, specifically during named fragment expansion. This could lead to excessive resource consumption and denial of service.

  ## Details

  Named fragments were being expanded once per fragment spread during query planning, leading to exponential resource usage when deeply nested and reused fragments were involved.

  ## Fix/Mitigation

  A new **Query Fragment Expansion Limit** metric has been introduced:
    - This metric computes the number of selections a query would have if its fragment spreads were fully expanded.
    - The metric is checked against a limit to prevent excessive computation.

  # Patches

  This has been remediated in `apollo-router` versions 1.61.2 and 2.1.1.

  # Workarounds

  The only known workaround is "Safelisting" or "Safelisting with IDs only" per [Safelisting with Persisted Queries - Apollo GraphQL Docs](https://www.apollographql.com/docs/graphos/routing/security/persisted-queries#router-security-levels).

  # References

  [Query Planning Documentation](https://www.apollographql.com/docs/graphos/reference/federation/query-plans)

  ## Acknowledgements

  We appreciate the efforts of the security community in identifying and improving the performance and security of query planning mechanisms.
impacted_packages: []
severities:
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/04/GHSA-75m2-jhh5-j5g2/GHSA-75m2-jhh5-j5g2.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-770
references:
  - url: https://github.com/apollographql/router
    reference_type:
    reference_id:
  - url: https://github.com/apollographql/router/commit/ab6675a63174715ea6ff50881fc957831d4e9564
    reference_type:
    reference_id:
  - url: https://github.com/apollographql/router/commit/bba032e183b861348a466d3123c7137a1ae18952
    reference_type:
    reference_id:
  - url: https://github.com/apollographql/router/security/advisories/GHSA-75m2-jhh5-j5g2
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-32034
    reference_type:
    reference_id: CVE-2025-32034
