advisory_id: GHSA-68jh-rf6x-836f
datasource_id: github_osv_importer_v2/GHSA-68jh-rf6x-836f
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/06/GHSA-68jh-rf6x-836f/GHSA-68jh-rf6x-836f.json
aliases: []
summary: |
  @apollo/server vulnerable to unsafe application of Content Security Policy via reused nonces
  ### Context
  Content Security Policies (CSP) are a defense-in-depth strategy against XSS attacks. Improper application of CSP isn't itself a vulnerability, but it does fail to prevent XSS in the event that there is a viable attack vector for an XSS attack.

  ### Impact
  There aren't any XSS attack vectors via the Apollo Server landing pages _known to Apollo_, so to our knowledge there is no impact. However, if there are existing XSS vectors that haven't been reported and patched, then all users of Apollo Server's landing pages have a vulnerability which won't be prevented by the current CSP implemented by the landing pages.

  Prior to version 4.7.1, there was no CSP implemented at all. However, the initial CSP implementation (4.7.1+) reused nonces. While this sufficiently resolved the issue w.r.t. scripts not running in Safari, it did not implement CSP in a safe or conventional way.

  ### Patches
  The issue is patched in the latest version of Apollo Server, v4.7.4. The changes can be reviewed in [the merge commit](https://github.com/apollographql/apollo-server/commit/0adaf80d1ee51d8c7e5fd863c04478536d15eb8c).

  ### Workarounds
  The landing page can be disabled completely until the patch can be upgraded to.
  https://www.apollographql.com/docs/apollo-server/api/plugin/landing-pages/#disabling-the-landing-page

  ### References
  https://content-security-policy.com/nonce/
impacted_packages:
  - purl: pkg:npm/%40apollo/server
    affected_versions: vers:npm/>=4.7.1|<4.7.4
    fixed_versions: vers:npm/4.7.4
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://github.com/apollographql/apollo-server
    reference_type:
    reference_id:
  - url: https://github.com/apollographql/apollo-server/commit/0adaf80d1ee51d8c7e5fd863c04478536d15eb8c
    reference_type:
    reference_id:
  - url: https://github.com/apollographql/apollo-server/security/advisories/GHSA-68jh-rf6x-836f
    reference_type:
    reference_id:
