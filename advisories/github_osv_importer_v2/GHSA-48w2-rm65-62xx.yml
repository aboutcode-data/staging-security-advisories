advisory_id: GHSA-48w2-rm65-62xx
datasource_id: github_osv_importer_v2/GHSA-48w2-rm65-62xx
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/10/GHSA-48w2-rm65-62xx/GHSA-48w2-rm65-62xx.json
aliases:
  - CVE-2021-41136
summary: |
  Puma with proxy which forwards LF characters as line endings could allow HTTP request smuggling
  ### Impact

  Prior to `puma` version 5.5.0, using `puma` with a proxy which forwards LF characters as line endings could allow HTTP request smuggling. A client could smuggle a request through a proxy, causing the proxy to send a response back to another unknown client.

  This behavior (forwarding LF characters as line endings) is very uncommon amongst proxy servers, so we have graded the impact here as "low". Puma is only aware of a single proxy server which has this behavior.

  If the proxy uses persistent connections and the client adds another request in via HTTP pipelining, the proxy may mistake it as the first request's body. Puma, however, would see it as two requests, and when processing the second request, send back a response that the proxy does not expect. If the proxy has reused the persistent connection to Puma to send another request for a different client, the second response from the first client will be sent to the second client.

  ### Patches

  This vulnerability was patched in Puma 5.5.1 and 4.3.9.

  ### Workarounds

  This vulnerability only affects Puma installations without any proxy in front.

  Use a proxy which does not forward LF characters as line endings.

  Proxies which do not forward LF characters as line endings:

  * Nginx
  * Apache (>2.4.25)
  * Haproxy
  * Caddy
  * Traefik

  ### Possible Breakage

  If you are [dealing with legacy clients that want to send `LF` as a line ending](https://stackoverflow.com/questions/43574428/have-apache-accept-lf-vs-crlf-in-request-headers) in an HTTP header, this will cause those clients to receive a `400` error.

  ### References

  * [HTTP Request Smuggling](https://portswigger.net/web-security/request-smuggling)

  ### For more information

  If you have any questions or comments about this advisory:

  * Open an issue in [Puma](https://github.com/puma/puma)
  * See our [security policy](https://github.com/puma/puma/security/policy)
impacted_packages:
  - purl: pkg:gem/puma
    affected_versions: vers:gem/>=5.0.0|<5.5.1
    fixed_versions: vers:gem/5.5.1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/puma
    affected_versions: vers:gem/<4.3.9
    fixed_versions: vers:gem/4.3.9
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '3.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:L/UI:R/S:U/C:L/I:L/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/10/GHSA-48w2-rm65-62xx/GHSA-48w2-rm65-62xx.json
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-444
references:
  - url: https://github.com/puma/puma
    reference_type:
    reference_id:
  - url: https://github.com/puma/puma/commit/436c71807f00e07070902a03f79fd3e130eb6b18
    reference_type:
    reference_id:
  - url: https://github.com/puma/puma/commit/acdc3ae571dfae0e045cf09a295280127db65c7f
    reference_type:
    reference_id:
  - url: https://github.com/puma/puma/commit/fb6ad8f8013ab5cdbb2f444cbfabd0b4fde71139
    reference_type:
    reference_id:
  - url: https://github.com/puma/puma/releases/tag/v4.3.9
    reference_type:
    reference_id:
  - url: https://github.com/puma/puma/releases/tag/v5.5.1
    reference_type:
    reference_id:
  - url: https://github.com/puma/puma/security/advisories/GHSA-48w2-rm65-62xx
    reference_type:
    reference_id:
  - url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/puma/CVE-2021-41136.yml
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2022/08/msg00015.html
    reference_type:
    reference_id:
  - url: https://security.gentoo.org/glsa/202208-28
    reference_type:
    reference_id:
  - url: https://www.debian.org/security/2022/dsa-5146
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-41136
    reference_type:
    reference_id: CVE-2021-41136
