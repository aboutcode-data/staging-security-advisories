advisory_id: GHSA-hgxw-5xg3-69jx
datasource_id: github_osv_importer_v2/GHSA-hgxw-5xg3-69jx
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/04/GHSA-hgxw-5xg3-69jx/GHSA-hgxw-5xg3-69jx.json
aliases:
  - CVE-2024-32652
summary: |
  @hono/node-server has Denial of Service risk when receiving Host header that cannot be parsed
  ### Impact

  The application hangs when receiving a Host header with a value that `@hono/node-server` can't handle well. Invalid values are those that cannot be parsed by the `URL` as a hostname such as an empty string, slashes `/`, and other strings.

  For example, if you have a simple application:

  ```ts
  import { serve } from '@hono/node-server'
  import { Hono } from 'hono'

  const app = new Hono()

  app.get('/', (c) => c.text('Hello'))

  serve(app)
  ```

  Sending a request with a Host header with an empty value to it:

  ```
  curl localhost:3000/ -H "Host: "
  ```

  The results:

  ```
  node:internal/url:775
      this.#updateContext(bindingUrl.parse(input, base));
                                     ^

  TypeError: Invalid URL
      at new URL (node:internal/url:775:36)
      at newRequest (/Users/yusuke/work/h/159/node_modules/@hono/node-server/dist/index.js:137:17)
      at Server.<anonymous> (/Users/yusuke/work/h/159/node_modules/@hono/node-server/dist/index.js:399:17)
      at Server.emit (node:events:514:28)
      at Server.emit (node:domain:488:12)
      at parserOnIncoming (node:_http_server:1143:12)
      at HTTPParser.parserOnHeadersComplete (node:_http_common:119:17) {
    code: 'ERR_INVALID_URL',
    input: 'http:///'
  }
  ```

  ### Patches

  The version `1.10.1` includes the fix for this issue. But, you should use `1.11.0`, which has other fixes related to this issue. https://github.com/honojs/node-server/issues/160 https://github.com/honojs/node-server/issues/161

  ### Workarounds

  Nothing. Upgrade your `@hono/node-server`.

  ### References

  https://github.com/honojs/node-server/issues/159
impacted_packages:
  - purl: pkg:npm/%40hono/node-server
    affected_versions: vers:npm/>=1.3.0|<1.10.1
    fixed_versions: vers:npm/1.10.1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/04/GHSA-hgxw-5xg3-69jx/GHSA-hgxw-5xg3-69jx.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-755
references:
  - url: https://github.com/honojs/node-server
    reference_type:
    reference_id:
  - url: https://github.com/honojs/node-server/commit/306d98f02a8671a0a1fb91ac8fe7e281690c05af
    reference_type:
    reference_id:
  - url: https://github.com/honojs/node-server/commit/d847e60249fd8183ba0998bc379ba20505643204
    reference_type:
    reference_id:
  - url: https://github.com/honojs/node-server/issues/159
    reference_type:
    reference_id:
  - url: https://github.com/honojs/node-server/issues/161
    reference_type:
    reference_id:
  - url: https://github.com/honojs/node-server/security/advisories/GHSA-hgxw-5xg3-69jx
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-32652
    reference_type:
    reference_id: CVE-2024-32652
