advisory_id: GHSA-8rr6-2qw5-pc7r
datasource_id: github_osv_importer_v2/GHSA-8rr6-2qw5-pc7r
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2026/02/GHSA-8rr6-2qw5-pc7r/GHSA-8rr6-2qw5-pc7r.json
aliases:
  - CVE-2026-28338
summary: |
  PMD Designer has Stored XSS in VBHTMLRenderer and YAHTMLRenderer via unescaped violation messages
  ### Summary
  PMD's `vbhtml` and `yahtml` report formats insert rule violation messages into HTML output without escaping. When PMD analyzes untrusted source code containing crafted string literals, the generated HTML report contains executable JavaScript that runs when opened in a browser.

  While the default `html` format is not affected via rule violation messages (it correctly uses `StringEscapeUtils.escapeHtml4()`), it has a similar problem when rendering suppressed violations. The user supplied message (the reason for the suppression) was not escaped.

  ### Details
  `VBHTMLRenderer.java` line 71 appends `rv.getDescription()` directly into HTML:

  ```java
  sb.append("<td><font class=body>").append(rv.getDescription()).append("</font></td>");
  ```

  `YAHTMLRenderer.java` lines 196–203 does the same via `renderViolationRow()`:

  ```java
  private String renderViolationRow(String name, String value) {
      return "<tr><td><b>" + name + "</b></td>" + "<td>" + value + "</td></tr>";
  }
  ```

  Called at line 172:

  ```java
  out.print(renderViolationRow("Description:", violation.getDescription()));
  ```

  The violation message originates from `AvoidDuplicateLiteralsRule.java` line 91, which embeds raw string literal values via `first.toPrintableString()`. This calls `StringUtil.escapeJava()` (line 476–480), which is a Java source escaper — it passes `<`, `>`, and `&` through unchanged because they are printable ASCII (0x20–0x7e).

  By contrast, `HTMLRenderer.java` line 143 properly escapes:

  ```java
  String d = StringEscapeUtils.escapeHtml4(rv.getDescription());
  ```
  ### PoC

  1. Create a Java file with 4+ duplicate string literals containing an HTML payload:

  ```java
  public class Exploit {
      String a = "<img src=x onerror=alert(document.domain)>";
      String b = "<img src=x onerror=alert(document.domain)>";
      String c = "<img src=x onerror=alert(document.domain)>";
      String d = "<img src=x onerror=alert(document.domain)>";
  }
  ```

  2. Run PMD with the `vbhtml` format:

  ```bash
  pmd check -R category/java/errorprone.xml -f vbhtml -d Exploit.java -r report.html
  ```

  3. Open `report.html` in a browser. A JavaScript alert executes showing `document.domain`.

  The generated HTML contains the unescaped tag:

  ```html
  <td><font class=body>The String literal "<img src=x onerror=alert(document.domain)>" appears 4 times in this file</font></td>
  ```

  Tested and confirmed on PMD 7.22.0-SNAPSHOT (commit bcc646c53d).

  ### Impact
  Stored cross-site scripting (XSS). Affects CI/CD pipelines that run PMD with `--format vbhtml` or `--format yahtml` on untrusted source code (e.g., pull requests from external contributors) and expose the HTML report as a build artifact. JavaScript executes in the browser context of anyone who opens the report.

  Practical impact is limited because `vbhtml` and `yahtml` are legacy formats rarely used in practice. The default `html` format has a similar issue with user messages from suppressed violations.

  ### Fixes
  * See [#6475](https://github.com/pmd/pmd/issues/6475): \[core] Fix stored XSS in VBHTMLRenderer and YAHTMLRenderer
impacted_packages:
  - purl: pkg:maven/net.sourceforge.pmd/pmd-core
    affected_versions: vers:maven/<=7.21.0
    fixed_versions: vers:maven/7.22.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '6.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2026/02/GHSA-8rr6-2qw5-pc7r/GHSA-8rr6-2qw5-pc7r.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-79
references:
  - url: https://github.com/pmd/pmd
    reference_type:
    reference_id:
  - url: https://github.com/pmd/pmd/commit/c140c0e1de5853a08efb84c9f91dfeb015882442
    reference_type:
    reference_id:
  - url: https://github.com/pmd/pmd/pull/6475
    reference_type:
    reference_id:
  - url: https://github.com/pmd/pmd/security/advisories/GHSA-8rr6-2qw5-pc7r
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2026-28338
    reference_type:
    reference_id:
