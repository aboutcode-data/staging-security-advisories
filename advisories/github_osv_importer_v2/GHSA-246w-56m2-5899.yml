advisory_id: GHSA-246w-56m2-5899
datasource_id: github_osv_importer_v2/GHSA-246w-56m2-5899
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/03/GHSA-246w-56m2-5899/GHSA-246w-56m2-5899.json
aliases:
  - CVE-2021-21332
summary: |
  Cross-site scripting (XSS) vulnerability in the password reset endpoint
  ### Impact
  The password reset endpoint served via Synapse was vulnerable to cross-site scripting (XSS) attacks. The impact depends on the configuration of the domain that Synapse is deployed on, but may allow access to cookies and other browser data, CSRF vulnerabilities, and access to other resources served on the same domain or parent domains.

  ### Patches
  This is fixed in #9200.

  ### Workarounds
  Depending on the needs and configuration of the homeserver a few options are available:

  1. Password resets can be disabled by delegating email to a third-party service (via the `account_threepid_delegates.email` setting) or disabling email (by not configuring the `email` setting).

  2. If the homeserver is not configured to use passwords (via the `password_config.enabled` setting) then the affected endpoint can be blocked at a reverse proxy:

      * `/_synapse/client/password_reset/email/submit_token`

  3. The `password_reset_confirmation.html` template can be overridden with a custom template that manually escapes the variables using [JInja2's `escape` filter](https://jinja.palletsprojects.com/en/2.11.x/templates/#escape). See the `email.template_dir` setting.
impacted_packages:
  - purl: pkg:pypi/matrix-synapse
    affected_versions: vers:pypi/<1.27.0
    fixed_versions: vers:pypi/1.27.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '6.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:C/C:H/I:L/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/03/GHSA-246w-56m2-5899/GHSA-246w-56m2-5899.json
  - score: '5.1'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:P/PR:N/UI:P/VC:N/VI:N/VA:N/SC:H/SI:L/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/03/GHSA-246w-56m2-5899/GHSA-246w-56m2-5899.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-79
references:
  - url: https://github.com/matrix-org/synapse
    reference_type:
    reference_id:
  - url: https://github.com/matrix-org/synapse/commit/e54746bdf7d5c831eabe4dcea76a7626f1de73df
    reference_type:
    reference_id:
  - url: https://github.com/matrix-org/synapse/pull/9200
    reference_type:
    reference_id:
  - url: https://github.com/matrix-org/synapse/releases/tag/v1.27.0
    reference_type:
    reference_id:
  - url: https://github.com/matrix-org/synapse/security/advisories/GHSA-246w-56m2-5899
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/matrix-synapse/PYSEC-2021-133.yaml
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/TNNAJOZNMVMXM6AS7RFFKB4QLUJ4IFEY
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-21332
    reference_type:
    reference_id: CVE-2021-21332
