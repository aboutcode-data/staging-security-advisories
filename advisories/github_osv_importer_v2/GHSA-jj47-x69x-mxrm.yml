advisory_id: GHSA-jj47-x69x-mxrm
datasource_id: github_osv_importer_v2/GHSA-jj47-x69x-mxrm
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/04/GHSA-jj47-x69x-mxrm/GHSA-jj47-x69x-mxrm.json
aliases:
  - CVE-2022-24795
summary: |
  Buffer Overflow in yajl-ruby
  _NOTE: A previous patch, 1.4.2, fixed the heap memory issue, but could still lead to a DoS infinite loop. Please update to version 1.4.3_

  The 1.x branch and the 2.x branch of [yajl](https://github.com/lloyd/yajl) contain an integer overflow which leads to subsequent heap memory corruption when dealing with large (~2GB) inputs.

  ### Details

  The [reallocation logic at yajl_buf.c#L64](https://github.com/brianmario/yajl-ruby/blob/7168bd79b888900aa94523301126f968a93eb3a6/ext/yajl/yajl_buf.c#L64) may result in the `need` 32bit integer wrapping to 0 when `need` approaches a value of 0x80000000 (i.e. ~2GB of data), which results in a reallocation of buf->alloc into a small heap chunk.

  These integers are declared as `size_t` in the 2.x branch of `yajl`, which practically prevents the issue from triggering on 64bit platforms, however this does not preclude this issue triggering on 32bit builds on which `size_t` is a 32bit integer.

  Subsequent population of this under-allocated heap chunk is based on the original buffer size, leading to heap memory corruption.

  ### Impact

  We rate this as a moderate severity vulnerability which mostly impacts process availability as we believe exploitation for arbitrary code execution to be unlikely.

  ### Patches

  Patched in yajl-ruby 1.4.3

  ### Workarounds

  Avoid passing large inputs to YAJL

  ### References
  https://github.com/brianmario/yajl-ruby/blob/7168bd79b888900aa94523301126f968a93eb3a6/ext/yajl/yajl_buf.c#L64

  ### For more information
  If you have any questions or comments about this advisory:
  * Open an issue in [yajl-ruby](https://github.com/brianmario/yajl-ruby/issues)
impacted_packages:
  - purl: pkg:gem/yajl-ruby
    affected_versions: vers:gem/<=1.4.2
    fixed_versions: vers:gem/1.4.3
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '5.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/04/GHSA-jj47-x69x-mxrm/GHSA-jj47-x69x-mxrm.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-190
  - CWE-122
references:
  - url: https://github.com/brianmario/yajl-ruby
    reference_type:
    reference_id:
  - url: https://github.com/brianmario/yajl-ruby/blob/7168bd79b888900aa94523301126f968a93eb3a6/ext/yajl/yajl_buf.c#L64
    reference_type:
    reference_id:
  - url: https://github.com/brianmario/yajl-ruby/commit/7168bd79b888900aa94523301126f968a93eb3a6
    reference_type:
    reference_id:
  - url: https://github.com/brianmario/yajl-ruby/security/advisories/GHSA-jj47-x69x-mxrm
    reference_type:
    reference_id:
  - url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/yajl-ruby/CVE-2022-24795.yml
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2023/07/msg00013.html
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2023/08/msg00003.html
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/KLE3C4CECEJ4EUYI56KXI6OWACWXX7WN
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/YO32YDJ74DADC7CMJNLSLBVWN5EXGF5J
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-24795
    reference_type:
    reference_id: CVE-2022-24795
