advisory_id: GHSA-wmx7-pw49-88jx
datasource_id: github_osv_importer_v2/GHSA-wmx7-pw49-88jx
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/07/GHSA-wmx7-pw49-88jx/GHSA-wmx7-pw49-88jx.json
aliases:
  - CVE-2024-41800
summary: |
  Craft CMS Allows TOTP Token To Stay Valid After Use
  Craft CMS 5 allows reuse of TOTP tokens multiple times within the validity period.

  ### Impact

  An attacker is able to re-submit a valid TOTP token to establish an authenticated session. This requires that the attacker has knowledge of the victim's credentials.

  A TOTP token can be used multiple times to establish an authenticated session.
  [RFC 6238](https://www.rfc-editor.org/rfc/rfc6238) insists that an OTP must not be used more than once.

  > The verifier MUST NOT accept the second attempt of the OTP after the successful validation has been issued for the first OTP, which ensures one-time only use of an OTP.

  The OWASP Application Security Verification Standard v4.0.3 (ASVS) [reiterates
  this property with requirement 2.8.4](https://github.com/OWASP/ASVS/blob/v4.0.3/4.0/en/0x11-V2-Authentication.md#v28-one-time-verifier).

  > Verify that time-based OTP can be used only once within the validity period.

  It should also be noted that the validity period of an TOTP token is 2 minutes. This makes a successful brute force attack more likely, since the four tokens are valid at the same time.

  ### Patches

  This has been patched in Craft 5.2.3.

  References:

  https://github.com/sbaresearch/advisories/tree/public/2024/SBA-ADV 2024061701_CraftCMS_TOTP_Valid_After_Use

  https://github.com/craftcms/cms/releases/tag/5.2.3
impacted_packages:
  - purl: pkg:composer/craftcms/cms
    affected_versions: vers:composer/<=5.2.2
    fixed_versions: vers:composer/5.2.3
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '4.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:L/UI:R/S:U/C:N/I:H/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/07/GHSA-wmx7-pw49-88jx/GHSA-wmx7-pw49-88jx.json
  - score: '6.0'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:H/AT:N/PR:N/UI:P/VC:N/VI:H/VA:N/SC:N/SI:N/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/07/GHSA-wmx7-pw49-88jx/GHSA-wmx7-pw49-88jx.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-287
references:
  - url: https://github.com/craftcms/cms
    reference_type:
    reference_id:
  - url: https://github.com/craftcms/cms/commit/7c790fa5ad5a8cb8016cb6793ec3554c4c079e38
    reference_type:
    reference_id:
  - url: https://github.com/craftcms/cms/releases/tag/5.2.3
    reference_type:
    reference_id:
  - url: https://github.com/craftcms/cms/security/advisories/GHSA-wmx7-pw49-88jx
    reference_type:
    reference_id:
  - url: https://github.com/sbaresearch/advisories/tree/public/2024/SBA-ADV-20240617-01_CraftCMS_TOTP_Valid_After_Use
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-41800
    reference_type:
    reference_id: CVE-2024-41800
