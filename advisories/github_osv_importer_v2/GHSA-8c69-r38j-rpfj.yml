advisory_id: GHSA-8c69-r38j-rpfj
datasource_id: github_osv_importer_v2/GHSA-8c69-r38j-rpfj
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/01/GHSA-8c69-r38j-rpfj/GHSA-8c69-r38j-rpfj.json
aliases:
  - CVE-2022-43755
summary: |
  Rancher cattle-token is predictable
  ### Impact

  An issue was discovered in Rancher versions up to and including 2.6.9 and 2.7.0, where the `cattle-token` secret, used by the `cattle-cluster-agent`, is predictable. Even after the token is regenerated, it will have the same value. This issue is not present in Rancher 2.5 releases.

  The `cattle-token` is used by Rancher's `cattle-cluster-agent` to connect to the Kubernetes API of Rancher provisioned downstream clusters. The problem occurs because the `cattle-token` secret does not use any random value in its composition, which causes it to always be regenerated with the same value. This can pose a serious problem if the token is compromised and needs to be recreated for security purposes.

  The usage of the `cattle-token` by an unauthorized user allows to escalate privileges to the cluster owner of the affected downstream cluster. It does not allow access to Rancher's own local cluster (the cluster where Rancher is provisioned).

  ### Workarounds

  In case it is not possible to promptly update to a patched version, a workaround is to use the [rotate script](https://github.com/rancherlabs/support-tools/tree/master/rotate-tokens) provided in the public security advisory [CVE-2021-36782 / GHSA-g7j7-h4q8-8w2f](https://github.com/rancher/rancher/security/advisories/GHSA-g7j7-h4q8-8w2f), which facilitates the rotation and creation of a new unique downstream cluster token.

  ### Patches

  Patched versions include releases 2.6.10, 2.7.1 and later versions.

  After upgrading to one of the patched versions, it is highly recommended to rotate the `cattle-token` in downstream clusters to guarantee that a new random token will be safely regenerated.

  The procedure below can rotate the `cattle-token` and should be executed in each downstream cluster provisioned by Rancher. It is recommended to first test this process in an appropriate development/testing environment.

  ```shell
  # Verify the current secret before rotating it
  $ kubectl describe secrets cattle-token -n cattle-system

  # Delete the secret
  $ kubectl delete secrets cattle-token -n cattle-system

  # Restart the cattle-cluster-agent deployment
  $ kubectl rollout restart deployment/cattle-cluster-agent -n cattle-system

  # Confirm that a new and different secret was generated
  $ kubectl describe secrets cattle-token -n cattle-system
  ```

  ### For more information

  If you have any questions or comments about this advisory:

  * Reach out to [SUSE Rancher Security team](https://github.com/rancher/rancher/security/policy) for security related inquiries.
  * Open an issue in [Rancher](https://github.com/rancher/rancher/issues/new/choose) repository.
  * Verify our [support matrix](https://www.suse.com/suse-rancher/support-matrix/all-supported-versions/) and [product support lifecycle](https://www.suse.com/lifecycle/).
impacted_packages: []
severities:
  - score: '7.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:H/I:L/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/01/GHSA-8c69-r38j-rpfj/GHSA-8c69-r38j-rpfj.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-330
  - CWE-331
references:
  - url: https://bugzilla.suse.com/show_bug.cgi?id=1205297
    reference_type:
    reference_id:
  - url: https://github.com/rancher/rancher
    reference_type:
    reference_id:
  - url: https://github.com/rancher/rancher/security/advisories/GHSA-8c69-r38j-rpfj
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-43755
    reference_type:
    reference_id: CVE-2022-43755
