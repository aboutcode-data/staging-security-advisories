advisory_id: GHSA-5fqv-mpj8-h7gm
datasource_id: github_osv_importer_v2/GHSA-5fqv-mpj8-h7gm
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/03/GHSA-5fqv-mpj8-h7gm/GHSA-5fqv-mpj8-h7gm.json
aliases:
  - CVE-2023-30797
summary: |
  Lemur subject to insecure random generation
  ### Overview
  Lemur was using insecure random generation for its example configuration file, as well as for some utilities.

  ### Impact
  The potentially affected generated items include:

  | Configuration item      | Config option name (if applicable) | Documentation link (if applicable) | Rotation option | Code reference(s) |
  | ----------- | ----------- | ----------- | ----------- |----------- |
  | Flask session secret      | `SECRET_KEY`       | [Flask documentation](https://flask.palletsprojects.com/en/2.2.x/config/#SECRET_KEY) | Generate a new secret and place in config; all existing sessions will be invalidated | N/A, internal to Flask |
  | Lemur token secret | `LEMUR_TOKEN_SECRET` | [Lemur's configuration documentation](https://lemur.readthedocs.io/en/latest/administration.html#configuration) | Generate a new secret and place in config; all existing JWTs will be invalidated and must be regenerated (including API keys) | [1](https://github.com/Netflix/lemur/blob/1b61194a936240103f3c23299f9512c2b7e0fd36/lemur/auth/service.py#L79), [2](https://github.com/Netflix/lemur/blob/1b61194a936240103f3c23299f9512c2b7e0fd36/lemur/auth/service.py#L105) |
  | Lemur database encryption key | `LEMUR_ENCRYPTION_KEYS` | [Lemur's configuration documentation](https://lemur.readthedocs.io/en/latest/administration.html#configuration) | A new key can be generated and added to this list, but existing data encrypted with prior keys cannot be re-encrypted unless you write a custom re-encryption process | [1](https://github.com/Netflix/lemur/blob/3783fbeaa1645bbee022827f4f53ffb12dd65a61/lemur/utils.py#L58) |
  | OAuth2 state token secret key | `OAUTH_STATE_TOKEN_SECRET` | [Lemur's configuration documentation](https://lemur.readthedocs.io/en/latest/administration.html#configuration) | Generate a new secret and place in config | [1](https://github.com/Netflix/lemur/blob/4b03baaf5544f167e78055bab15a903b1badf22b/lemur/auth/views.py#L267) |
  | Randomly generated passphrases for openssl keystores | N/A, generated at runtime but persisted |N/A | Re-export all openssl keystores and replace them wherever they're in use | [1](https://github.com/Netflix/lemur/blob/2603776e5c0ac25fa0103ff1357dea391d880160/lemur/plugins/lemur_openssl/plugin.py#L129) |
  | Initial password for LDAP users | N/A, generated at runtime but persisted | N/A | N/A, cannot be rotated* | [1](https://github.com/Netflix/lemur/blob/3783fbeaa1645bbee022827f4f53ffb12dd65a61/lemur/auth/ldap.py#L66) |
  | Initial password for Ping/OAuth2 users | N/A, generated at runtime but persisted |N/A | N/A, cannot be rotated* | [1](https://github.com/Netflix/lemur/blob/4b03baaf5544f167e78055bab15a903b1badf22b/lemur/auth/views.py#L234) |
  | Oauth2 nonce | N/A, short-lived runtime secret |N/A | N/A, rotation is not required (these are short-lived) | [1](https://github.com/Netflix/lemur/blob/4b03baaf5544f167e78055bab15a903b1badf22b/lemur/auth/views.py#L668) |
  | Verisign certificate enrollment challenges | N/A, short-lived runtime secret | N/A | N/A, rotation is not required (these are short-lived) | [1](https://github.com/Netflix/lemur/blob/d4af5af99cd51016579f015d79df649c68a6ad15/lemur/plugins/lemur_verisign/plugin.py#L107) |

  If your deployment of Lemur is using any of the above config secrets that were _generated by Lemur's example config_ (i.e., generated using insecure randomness), you should rotate those config secrets. If you generated your config secrets in a more secure way, they are not known to be compromised, but you should still upgrade Lemur to ensure that you receive code fixes for the runtime-generated secrets.

  For general information and guidance on Lemur secret configuration, see [Lemur's configuration documentation](https://lemur.readthedocs.io/en/latest/administration.html#configuration), which includes information on many of the configuration options listed above.

  *For the user passwords: Even though these users are configured to use SSO, they do get generated with valid database passwords that can be used to log in. Since Lemur doesn't have an option to change passwords (#3888), one option for rotating them would be to directly modify the value in the database to some other unguessable string (you do not need to know the plaintext password since it won't be used).

  ### Patches
  The patch is available in v1.3.2.

  ### Workarounds
  No workarounds are available.

  ### References
  N/A
impacted_packages:
  - purl: pkg:pypi/lemur
    affected_versions: vers:pypi/<1.3.2
    fixed_versions: vers:pypi/1.3.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/03/GHSA-5fqv-mpj8-h7gm/GHSA-5fqv-mpj8-h7gm.json
  - score: '8.7'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:H/VI:N/VA:N/SC:N/SI:N/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/03/GHSA-5fqv-mpj8-h7gm/GHSA-5fqv-mpj8-h7gm.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-330
references:
  - url: https://github.com/Netflix/lemur
    reference_type:
    reference_id:
  - url: https://github.com/Netflix/lemur/commit/666d853212174ee7f4e6f8b3b4b389ede1872238
    reference_type:
    reference_id:
  - url: https://github.com/Netflix/lemur/issues/3888
    reference_type:
    reference_id:
  - url: https://github.com/Netflix/lemur/security/advisories/GHSA-5fqv-mpj8-h7gm
    reference_type:
    reference_id:
  - url: https://github.com/Netflix/security-bulletins/blob/master/advisories/nflx-2023-001.md
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/lemur/PYSEC-2023-20.yaml
    reference_type:
    reference_id:
  - url: https://vulncheck.com/advisories/netflix-lemur-weak-rng
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-30797
    reference_type:
    reference_id: CVE-2023-30797
