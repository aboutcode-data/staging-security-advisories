advisory_id: GHSA-cp96-jpmq-xrr2
datasource_id: github_osv_importer_v2/GHSA-cp96-jpmq-xrr2
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/03/GHSA-cp96-jpmq-xrr2/GHSA-cp96-jpmq-xrr2.json
aliases:
  - CVE-2023-26484
summary: "On a compromised node, the virt-handler service account can be used to modify all\
  \ node specs\n### Impact\n\nIf a malicious user has taken over a Kubernetes node where virt-handler\
  \ (the KubeVirt node-daemon) is running, the virt-handler service account can be used to modify\
  \ all node specs.\n\nThis can be misused to lure-in system-level-privileged components (which\
  \ can for instance read all secrets on the cluster, or can exec into pods on other nodes).\
  \ This way a compromised node can be used to elevate privileges beyond the node until potentially\
  \ having full privileged access to the whole cluster.\n\nThe simplest way to exploit this,\
  \ once a user could compromise a specific node, is to set with the virt-handler service account\
  \ all other nodes to unschedulable and simply wait until system-critical components with high\
  \ privileges appear on its node.\n\nSince this requires a node to be compromised first, the\
  \ severity of this finding is considered Medium.\n\n### Patches\n\nNot yet available.\n\n\
  ### Workarounds\nGatekeeper users can add a webhook which will block the `virt-handler` service\
  \ account to modify the spec of a node.\n\nAn example policy, preventing virt-handler from\
  \ changing the node spec may look like this:\n\n```yaml\napiVersion: templates.gatekeeper.sh/v1\n\
  kind: ConstraintTemplate\nmetadata:\n  name: virthandlerrestrictions\nspec:\n[...]\n  targets:\n\
  \    - libs:\n        - |         \n[...]          \n          is_virt_handler(username) {\n\
  \              username == \"system:serviceaccount:kubevirt:virt-handler\"\n          }\n\
  \          mutates_node_in_unintended_way {\n            # TODO\n            # only allow\
  \ kubevirt.io/ prefixed metadata node changes\n          }\n      rego: |\n[...]\n       \
  \ \n        violation[{\"msg\": msg}] {\n          is_virt_handler(username)\n          mutates_node_in_unintended_way(input.review.object,\
  \ input.review.oldObject)\n          msg := sprintf(\"virt-handler tries to modify node <%v>\
  \ in an unintended way.\", [input.review.object.name])\n        }\n```\n\nand applying this\
  \ template to node modifications.\n\n\n### Credits\n\nSpecial thanks to the discoverers of\
  \ this issue:\n\nNanzi Yang (nzyang@stu.xidian.edu.cn)\nXin Guo (guox@stu.xidian.edu.cn)\n\
  Jietao Xiao (jietaoXiao@stu.xidian.edu.cn)\nWenbo Shen (shenwenbo@zju.edu.cn)\nJinku Li (jkli@xidian.edu.cn)\n\
  \n### References\n\nhttps://github.com/kubevirt/kubevirt/issues/9109"
impacted_packages: []
severities:
  - score: '8.2'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:C/C:H/I:H/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/03/GHSA-cp96-jpmq-xrr2/GHSA-cp96-jpmq-xrr2.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-863
references:
  - url: https://github.com/kubevirt/kubevirt
    reference_type:
    reference_id:
  - url: https://github.com/kubevirt/kubevirt/issues/9109
    reference_type:
    reference_id:
  - url: https://github.com/kubevirt/kubevirt/security/advisories/GHSA-cp96-jpmq-xrr2
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-26484
    reference_type:
    reference_id: CVE-2023-26484
