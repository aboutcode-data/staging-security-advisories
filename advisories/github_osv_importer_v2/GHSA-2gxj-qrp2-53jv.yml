advisory_id: GHSA-2gxj-qrp2-53jv
datasource_id: github_osv_importer_v2/GHSA-2gxj-qrp2-53jv
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/01/GHSA-2gxj-qrp2-53jv/GHSA-2gxj-qrp2-53jv.json
aliases:
  - CVE-2021-45695
summary: |
  Incorrect reliance on Trait memory layout in mopa
  The mopa crate redefines the deprecated TraitObject struct from core::raw. This is done to then transmute a reference to a trait object (&dyn Trait for any trait Trait) into this struct and retrieve the data field for the purpose of downcasting. This is used to implement downcast_ref_unchecked(), in terms of which downcast_ref() is also implemented. Same goes for mutable reference downcasting and Box downcasting.

  The Rust compiler explicitly reserves the right to change the memory layout of &dyn Trait for any trait Trait. The worst case scenario is that it swaps data and vtable, making an executable location breach and compromisation of ASLR possible, since reads from data would read vtable instead. Likewise, arbitrary code execution is also theoretically possible if reads of vtable generated by the compiler read data instead.
impacted_packages: []
severities:
  - score: '9.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/01/GHSA-2gxj-qrp2-53jv/GHSA-2gxj-qrp2-53jv.json
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://github.com/chris-morgan/mopa
    reference_type:
    reference_id:
  - url: https://github.com/chris-morgan/mopa/issues/13
    reference_type:
    reference_id:
  - url: https://raw.githubusercontent.com/rustsec/advisory-db/main/crates/mopa/RUSTSEC-2021-0095.md
    reference_type:
    reference_id:
  - url: https://rustsec.org/advisories/RUSTSEC-2021-0095.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-45695
    reference_type:
    reference_id: CVE-2021-45695
