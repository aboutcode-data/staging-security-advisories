advisory_id: GHSA-6whj-7qmg-86qj
datasource_id: github_osv_importer_v2/GHSA-6whj-7qmg-86qj
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2026/02/GHSA-6whj-7qmg-86qj/GHSA-6whj-7qmg-86qj.json
aliases:
  - CVE-2025-69207
summary: "Khoj has an IDOR in Notion OAuth Flow that Enables Index Poisoning\n### Summary\n\
  An IDOR in the Notion OAuth callback allows an attacker to hijack any user's Notion integration\
  \ by manipulating the state parameter. The callback endpoint accepts any user UUID without\
  \ verifying the OAuth flow was initiated by that user, allowing attackers to replace victims'\
  \ Notion configurations with their own, resulting in data poisoning and unauthorized access\
  \ to the victim's Khoj search index.\n\nThis attack requires knowing the user's UUID which\
  \ can be leaked through shared conversations where an AI generated image is present.\n\n###\
  \ Details\nWhen users share conversations which contain AI generated images, the file path\
  \ for the image is constructed using the user's UUID. Knowing this UUID, an attacker is able\
  \ to intercept the OAuth callback for Notion and replace the `state` parameter with the other\
  \ user's UUID and sync notion onto their account.\n\n### PoC\n\nThe vulnerable line of code\
  \ exists in `src/khoj/routers/notion.py` on the callback endpoint.\n```python\n@notion_router.get(\"\
  /auth/callback\")\nasync def notion_auth_callback(request: Request, background_tasks: BackgroundTasks):\n\
  \    code = request.query_params.get(\"code\")\n    state = request.query_params.get(\"state\"\
  )  # <-- Attacker controlled\n    if not code or not state:\n        return Response(\"Missing\
  \ code or state\", status_code=400)\n\n    user: KhojUser = await aget_user_by_uuid(state)\
  \  # <-- No verification!\n\n    await NotionConfig.objects.filter(user=user).adelete()  #\
  \ <-- Deletes victim's config\n    \n    # ... OAuth token exchange ...\n    \n    access_token\
  \ = final_response.get(\"access_token\")\n    await NotionConfig.objects.acreate(token=access_token,\
  \ user=user)  # <-- Stores attacker's token\n```\n\nTo exploit is relatively easy. Once we\
  \ know the victim's UUID, we simply initiate the Notion sync process on our own account and\
  \ intercept the callback, replacing the `state` parameter with the victim's UUID.\n\n### Impact\n\
  Deletes user's existing Notion sync and replaces it with attacker-controlled Notion. Could\
  \ allow for index poisoning. I'm not entirely sure what Khoj does with synced files but if\
  \ it's being passed as context to an LLM then I can imagine there's potential here."
impacted_packages:
  - purl: pkg:pypi/khoj
    affected_versions: vers:pypi/<=2.0.0b25.dev3
    fixed_versions:
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '5.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:L
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2026/02/GHSA-6whj-7qmg-86qj/GHSA-6whj-7qmg-86qj.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-862
  - CWE-639
references:
  - url: https://github.com/khoj-ai/khoj
    reference_type:
    reference_id:
  - url: https://github.com/khoj-ai/khoj/commit/1b7ccd141d47f365edeccc57d7316cb0913d748b
    reference_type:
    reference_id:
  - url: https://github.com/khoj-ai/khoj/releases/tag/2.0.0-beta.23
    reference_type:
    reference_id:
  - url: https://github.com/khoj-ai/khoj/security/advisories/GHSA-6whj-7qmg-86qj
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-69207
    reference_type:
    reference_id:
