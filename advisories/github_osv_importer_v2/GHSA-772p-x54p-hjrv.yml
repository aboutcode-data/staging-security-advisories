advisory_id: GHSA-772p-x54p-hjrv
datasource_id: github_osv_importer_v2/GHSA-772p-x54p-hjrv
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/05/GHSA-772p-x54p-hjrv/GHSA-772p-x54p-hjrv.json
aliases:
  - CVE-2021-29517
summary: |
  Division by zero in `Conv3D`
  ### Impact
  A malicious user could trigger a division by 0 in `Conv3D` implementation:

  ```python
  import tensorflow as tf

  input_tensor = tf.constant([], shape=[0, 0, 0, 0, 0], dtype=tf.float32)
  filter_tensor = tf.constant([], shape=[0, 0, 0, 0, 0], dtype=tf.float32)

  tf.raw_ops.Conv3D(input=input_tensor, filter=filter_tensor, strides=[1, 56, 56, 56, 1], padding='VALID', data_format='NDHWC', dilations=[1, 1, 1, 23, 1])
  ```

  The [implementation](https://github.com/tensorflow/tensorflow/blob/42033603003965bffac51ae171b51801565e002d/tensorflow/core/kernels/conv_ops_3d.cc#L143-L145) does a modulo operation based on user controlled input:

  ```cc
    const int64 out_depth = filter.dim_size(4);
    OP_REQUIRES(context, in_depth % filter_depth == 0, ...);
  ```

  Thus, when `filter` has a 0 as the fifth element, this results in a division by 0.

  Additionally, if the shape of the two tensors is not valid, an Eigen assertion can be triggered, resulting in a program crash:

  ```python
  import tensorflow as tf

  input_tensor = tf.constant([], shape=[2, 2, 2, 2, 0], dtype=tf.float32)
  filter_tensor = tf.constant([], shape=[0, 0, 2, 6, 2], dtype=tf.float32)

  tf.raw_ops.Conv3D(input=input_tensor, filter=filter_tensor, strides=[1, 56, 39, 34, 1], padding='VALID', data_format='NDHWC', dilations=[1, 1, 1, 1, 1])
  ```

  The shape of the two tensors must follow the constraints specified in the [op description](https://www.tensorflow.org/api_docs/python/tf/raw_ops/Conv3D).

  ### Patches
  We have patched the issue in GitHub commit [799f835a3dfa00a4d852defa29b15841eea9d64f](https://github.com/tensorflow/tensorflow/commit/799f835a3dfa00a4d852defa29b15841eea9d64f).

  The fix will be included in TensorFlow 2.5.0. We will also cherrypick this commit on TensorFlow 2.4.2, TensorFlow 2.3.3, TensorFlow 2.2.3 and TensorFlow 2.1.4, as these are also affected and still in supported range.

  ### For more information
  Please consult [our security guide](https://github.com/tensorflow/tensorflow/blob/master/SECURITY.md) for more information regarding the security model and how to contact us with issues and questions.

  ### Attribution
  This vulnerability has been reported by Yakun Zhang and Ying Wang of Baidu X-Team.
impacted_packages:
  - purl: pkg:pypi/tensorflow
    affected_versions: vers:pypi/<2.1.4
    fixed_versions: vers:pypi/2.1.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow
    affected_versions: vers:pypi/>=2.2.0|<2.2.3
    fixed_versions: vers:pypi/2.2.3
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow
    affected_versions: vers:pypi/>=2.3.0|<2.3.3
    fixed_versions: vers:pypi/2.3.3
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow
    affected_versions: vers:pypi/>=2.4.0|<2.4.2
    fixed_versions: vers:pypi/2.4.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow-cpu
    affected_versions: vers:pypi/<2.1.4
    fixed_versions: vers:pypi/2.1.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow-cpu
    affected_versions: vers:pypi/>=2.2.0|<2.2.3
    fixed_versions: vers:pypi/2.2.3
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow-cpu
    affected_versions: vers:pypi/>=2.3.0|<2.3.3
    fixed_versions: vers:pypi/2.3.3
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow-cpu
    affected_versions: vers:pypi/>=2.4.0|<2.4.2
    fixed_versions: vers:pypi/2.4.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow-gpu
    affected_versions: vers:pypi/<2.1.4
    fixed_versions: vers:pypi/2.1.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow-gpu
    affected_versions: vers:pypi/>=2.2.0|<2.2.3
    fixed_versions: vers:pypi/2.2.3
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow-gpu
    affected_versions: vers:pypi/>=2.3.0|<2.3.3
    fixed_versions: vers:pypi/2.3.3
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/tensorflow-gpu
    affected_versions: vers:pypi/>=2.4.0|<2.4.2
    fixed_versions: vers:pypi/2.4.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '2.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:L
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/05/GHSA-772p-x54p-hjrv/GHSA-772p-x54p-hjrv.json
  - score: '2.0'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:L/AC:L/AT:P/PR:L/UI:N/VC:N/VI:N/VA:L/SC:N/SI:N/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2021/05/GHSA-772p-x54p-hjrv/GHSA-772p-x54p-hjrv.json
  - score: LOW
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-369
references:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/tensorflow-cpu/PYSEC-2021-445.yaml
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/tensorflow-gpu/PYSEC-2021-643.yaml
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/tensorflow/PYSEC-2021-154.yaml
    reference_type:
    reference_id:
  - url: https://github.com/tensorflow/tensorflow/commit/799f835a3dfa00a4d852defa29b15841eea9d64f
    reference_type:
    reference_id:
  - url: https://github.com/tensorflow/tensorflow/security/advisories/GHSA-772p-x54p-hjrv
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-29517
    reference_type:
    reference_id: CVE-2021-29517
