advisory_id: GHSA-74m5-2c7w-9w3x
datasource_id: github_osv_importer_v2/GHSA-74m5-2c7w-9w3x
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/02/GHSA-74m5-2c7w-9w3x/GHSA-74m5-2c7w-9w3x.json
aliases:
  - CVE-2023-30798
summary: "MultipartParser denial of service with too many fields or files\n### Impact\n\nThe\
  \ `MultipartParser` using the package `python-multipart` accepts an unlimited number of multipart\
  \ parts (form fields or files).\n\nProcessing too many parts results in high CPU usage and\
  \ high memory usage, eventually leading to an <abbr title=\"out of memory\">OOM</abbr> process\
  \ kill.\n\nThis can be triggered by sending too many small form fields with no content, or\
  \ too many empty files.\n\nFor this to take effect application code has to:\n\n* Have `python-multipart`\
  \ installed and\n* call `request.form()`\n  * or via another framework like FastAPI, using\
  \ form field parameters or `UploadFile` parameters, which in turn calls `request.form()`.\n\
  \n### Patches\n\nThe vulnerability is solved in Starlette 0.25.0 by making the maximum fields\
  \ and files customizable and with a sensible default (1000). \n\nApplications will be secure\
  \ by just upgrading their Starlette version to 0.25.0 (or FastAPI to 0.92.0).\n\nIf application\
  \ code needs to customize the new max field and file number, there are new `request.form()`\
  \ parameters (with the default values):\n\n* `max_files=1000`\n* `max_fields=1000`\n\n###\
  \ Workarounds\n\nApplications that don't install `python-multipart` or that don't use form\
  \ fields are safe.\n\nIn older versions, it's also possible to instead of calling `request.form()`\
  \ call `request.stream()` and parse the form data in internal code.\n\nIn most cases, the\
  \ best solution is to upgrade the Starlette version.\n\n### References\n\nThis was reported\
  \ in private by @das7pad via internal email. He also coordinated the fix across multiple frameworks\
  \ and parsers.\n\nThe details about how `multipart/form-data` is structured and parsed are\
  \ in the [RFC 7578](https://www.rfc-editor.org/rfc/rfc7578)."
impacted_packages:
  - purl: pkg:pypi/starlette
    affected_versions: vers:pypi/<0.25.0
    fixed_versions: vers:pypi/0.25.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/02/GHSA-74m5-2c7w-9w3x/GHSA-74m5-2c7w-9w3x.json
  - score: '8.7'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:N/VC:N/VI:N/VA:H/SC:N/SI:N/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/02/GHSA-74m5-2c7w-9w3x/GHSA-74m5-2c7w-9w3x.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-400
references:
  - url: https://github.com/encode/starlette
    reference_type:
    reference_id:
  - url: https://github.com/encode/starlette/commit/8c74c2c8dba7030154f8af18e016136bea1938fa
    reference_type:
    reference_id:
  - url: https://github.com/encode/starlette/security/advisories/GHSA-74m5-2c7w-9w3x
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/starlette/PYSEC-2023-48.yaml
    reference_type:
    reference_id:
  - url: https://vulncheck.com/advisories/starlette-multipartparser-dos
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-30798
    reference_type:
    reference_id: CVE-2023-30798
