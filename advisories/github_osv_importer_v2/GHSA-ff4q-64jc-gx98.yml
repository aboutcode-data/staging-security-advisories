advisory_id: GHSA-ff4q-64jc-gx98
datasource_id: github_osv_importer_v2/GHSA-ff4q-64jc-gx98
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/07/GHSA-ff4q-64jc-gx98/GHSA-ff4q-64jc-gx98.json
aliases:
  - CVE-2024-39694
summary: "IdentityServer Open Redirect vulnerability\n### Impact\nIt is possible for an attacker\
  \ to craft malicious Urls that certain functions in IdentityServer will incorrectly treat\
  \ as local and trusted. If such a Url is returned as a redirect, some browsers will follow\
  \ it to a third-party, untrusted site.\n\n_Note: by itself, this vulnerability does **not**\
  \ allow an attacker to obtain user credentials, authorization codes, access tokens, refresh\
  \ tokens, or identity tokens. An attacker could however exploit this vulnerability as part\
  \ of a phishing attack designed to steal user credentials._\n\n### Affected Methods\n- In\
  \ the `DefaultIdentityServerInteractionService`, the `GetAuthorizationContextAsync` method\
  \ may return non-null and the `IsValidReturnUrl` method may return true for malicious Urls,\
  \ indicating incorrectly that they can be safely redirected to.\n\n   _UI code calling these\
  \ two methods is the most commonly used code path that will expose the vulnerability. The\
  \ default UI templates rely on this behavior in the Login, Challenge, Consent, and Account\
  \ Creation pages. Customized user interface code might also rely on this behavior. The following\
  \ uncommonly used APIs are also vulnerable:_\n\n- The `ServerUrlExtensions.GetIdentityServerRelativeUrl`,\
  \ `ReturnUrlParser.ParseAsync` and `OidcReturnUrlParser.ParseAsync`  methods may incorrectly\
  \ return non-null, and the `ReturnUrlParser.IsValidReturnUrl` and `OidcReturnUrlParser.IsValidReturnUrl`\
  \ methods may incorrectly return true for malicious Urls.\n\n### Patches\nThis vulnerability\
  \ is fixed in the following versions of Duende.IdentityServer:\n- 7.0.6\n- 6.3.10\n- 6.2.5\n\
  - 6.1.8\n- 6.0.5\n\nDuende.IdentityServer 5.1 and earlier and all versions of IdentityServer4\
  \ are no longer supported and will not be receiving updates. \n\n### Workarounds\n\nIf upgrading\
  \ is not possible, use `IUrlHelper.IsLocalUrl` from ASP.NET Core 5.0 or later to validate\
  \ return Urls in user interface code in the IdentityServer host."
impacted_packages:
  - purl: pkg:nuget/Duende.IdentityServer
    affected_versions: vers:nuget/<=7.0.5
    fixed_versions: vers:nuget/7.0.6
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:nuget/Duende.IdentityServer
    affected_versions: vers:nuget/<=6.3.9
    fixed_versions: vers:nuget/6.3.10
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:nuget/Duende.IdentityServer
    affected_versions: vers:nuget/<=6.2.4
    fixed_versions: vers:nuget/6.2.5
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:nuget/Duende.IdentityServer
    affected_versions: vers:nuget/<=6.1.7
    fixed_versions: vers:nuget/6.1.8
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:nuget/Duende.IdentityServer
    affected_versions: vers:nuget/<=6.0.4
    fixed_versions: vers:nuget/6.0.5
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:nuget/IdentityServer4
    affected_versions: vers:nuget/<=4.1.2
    fixed_versions:
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '4.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:N/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/07/GHSA-ff4q-64jc-gx98/GHSA-ff4q-64jc-gx98.json
  - score: '5.1'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:N/PR:N/UI:A/VC:L/VI:N/VA:N/SC:L/SI:N/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/07/GHSA-ff4q-64jc-gx98/GHSA-ff4q-64jc-gx98.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-601
references:
  - url: https://github.com/DuendeSoftware/IdentityServer
    reference_type:
    reference_id:
  - url: https://github.com/DuendeSoftware/IdentityServer/commit/269ca2171fe1e901c87f2f0797bbc7c230db87c6
    reference_type:
    reference_id:
  - url: https://github.com/DuendeSoftware/IdentityServer/commit/765116a2d4fb0671b6eba015e698533900c61c8e
    reference_type:
    reference_id:
  - url: https://github.com/DuendeSoftware/IdentityServer/commit/d0d8eab35ad9183b14925496803ed8b36658d0a1
    reference_type:
    reference_id:
  - url: https://github.com/DuendeSoftware/IdentityServer/commit/f04cf0be859b93f43563f8f812eb92206ad94011
    reference_type:
    reference_id:
  - url: https://github.com/DuendeSoftware/IdentityServer/commit/fe817b499933d6ed6141b153492d7335c28b184a
    reference_type:
    reference_id:
  - url: https://github.com/DuendeSoftware/IdentityServer/security/advisories/GHSA-ff4q-64jc-gx98
    reference_type:
    reference_id:
  - url: https://github.com/IdentityServer/IdentityServer4/security/advisories/GHSA-55p7-v223-x366
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-39694
    reference_type:
    reference_id: CVE-2024-39694
