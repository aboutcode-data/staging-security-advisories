advisory_id: GHSA-m5ff-3wj3-8ph4
datasource_id: github_osv_importer_v2/GHSA-m5ff-3wj3-8ph4
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2019/12/GHSA-m5ff-3wj3-8ph4/GHSA-m5ff-3wj3-8ph4.json
aliases: []
summary: |
  HTTP Request Smuggling: Invalid whitespace characters in headers in Waitress
  ### Impact

  If a proxy server is used in front of waitress, an invalid request may be sent by an attacker that bypasses the front-end and is parsed differently by waitress leading to a potential for HTTP request smuggling.

  ```
  Content-Length: 10
  Transfer-Encoding: [\x0b]chunked
  ```

  For clarity:

  ```
  0x0b == vertical tab
  ```

  Would get parsed by Waitress as being a `chunked` request, but a front-end server would use the `Content-Length` instead as the `Transfer-Encoding` header is considered invalid due to containing invalid characters.

  If a front-end server does HTTP pipelining to a backend Waitress server this could lead to HTTP request splitting which may lead to potential cache poisoning or unexpected information disclosure.

  ### Patches

  Please upgrade to Waitress 1.4.1 which fixes this issue with stricter HTTP field validation.

  Waitress 1.4.1 due to this change has become much more strict in what is allowed in header values, while the maintainers don't believe that these changes will cause any issues, it may cause failures with non-conformist reverse proxies or clients, and it is highly recommend that users validate the changes in their environment and make sure it won't cause any unacceptable failures.

  ### Workarounds

  You may enable additional protections on front-end servers, those that follow RFC7230 correctly would drop the request with a 400 Bad Request.

  Waitress will now correctly responds to the request with a 400 Bad Request, and will drop the connection to avoid any potential HTTP pipelining issues.

  ### References

  This was mentioned in https://portswigger.net/research/http-desync-attacks-what-happened-next and was specifically mentioned as being an issue in HAProxy which did not properly filter it in this article: https://nathandavison.com/blog/haproxy-http-request-smuggling

  ### Thanks

  The Pylons Project would like to thank ZeddYu Lu for doing extended testing against Waitress 1.4.0 and bringing this to our attention!

  ### For more information

  If you have any questions or comments about this advisory:

  * open an issue at https://github.com/Pylons/waitress/issues (if not sensitive or security related)
  * email the Pylons Security mailing list: pylons-project-security@googlegroups.com (if security related)
impacted_packages:
  - purl: pkg:pypi/waitress
    affected_versions: vers:pypi/<1.4.1
    fixed_versions: vers:pypi/1.4.1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-444
references:
  - url: https://github.com/Pylons/waitress/commit/11d9e138125ad46e951027184b13242a3c1de017
    reference_type:
    reference_id:
  - url: https://github.com/Pylons/waitress/security/advisories/GHSA-m5ff-3wj3-8ph4
    reference_type:
    reference_id:
