advisory_id: GHSA-7654-vfh6-rw6x
datasource_id: github_osv_importer_v2/GHSA-7654-vfh6-rw6x
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/12/GHSA-7654-vfh6-rw6x/GHSA-7654-vfh6-rw6x.json
aliases:
  - CVE-2023-50721
summary: |
  Remote code execution from account through SearchAdmin
  ### Impact
  The search administration interface doesn't properly escape the id and label of search user interface extensions, allowing the injection of XWiki syntax containing script macros including Groovy macros that allow remote code execution, impacting the confidentiality, integrity and availability of the whole XWiki instance. This attack can be executed by any user who can edit some wiki page like the user's profile (editable by default) as user interface extensions that will be displayed in the search administration can be added on any document by any user.

  To reproduce, edit any document with the object editor, add an object of type `XWiki.UIExtensionClass`, set "Extension Point Id" to `org.xwiki.platform.search`, set "Extension ID" to `{{async}}{{groovy}}services.logging.getLogger("attacker").error("Attack from extension id succeeded!"){{/groovy}}{{/async}}`, set "Extension Parameters" to `label={{async}}{{groovy}}services.logging.getLogger("attacker").error("Attack from label succeeded!"){{/groovy}}{{/async}}` and "Extension Scope" to "Current User". Then open the page `XWiki.SearchAdmin`, e.g., on http://localhost:8080/xwiki/bin/view/XWiki/SearchAdmin. If there are error log messages in XWiki's log that announce that attacks succeeded, the instance is vulnerable.


  ### Patches
  The necessary escaping has been added in XWiki 14.10.15, 15.5.2 and 15.7RC1.

  ### Workarounds
  The [patch](https://github.com/xwiki/xwiki-platform/commit/62863736d78ffd60d822279c5fb7fb9593042766#diff-2272c913e5ca43813e52f8fa748c9b043bf0f01561908d7eba6ca3601d8475c4) can be manually applied to the page `XWiki.SearchAdmin`.

  ### References
  * https://github.com/xwiki/xwiki-platform/commit/62863736d78ffd60d822279c5fb7fb9593042766
  * https://jira.xwiki.org/browse/XWIKI-21200
impacted_packages:
  - purl: pkg:maven/org.xwiki.platform/xwiki-platform-search-ui
    affected_versions: vers:maven/>=4.5-rc-1|<14.10.15
    fixed_versions: vers:maven/14.10.15
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.xwiki.platform/xwiki-platform-search-ui
    affected_versions: vers:maven/>=15.0-rc-1|<15.5.2
    fixed_versions: vers:maven/15.5.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:maven/org.xwiki.platform/xwiki-platform-search-ui
    affected_versions: vers:maven/>=15.6-rc-1|<15.7-rc-1
    fixed_versions: vers:maven/15.7-rc-1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '9.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/12/GHSA-7654-vfh6-rw6x/GHSA-7654-vfh6-rw6x.json
  - score: CRITICAL
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-94
references:
  - url: https://github.com/xwiki/xwiki-platform
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-platform/commit/62863736d78ffd60d822279c5fb7fb9593042766
    reference_type:
    reference_id:
  - url: https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-7654-vfh6-rw6x
    reference_type:
    reference_id:
  - url: https://jira.xwiki.org/browse/XWIKI-21200
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-50721
    reference_type:
    reference_id: CVE-2023-50721
