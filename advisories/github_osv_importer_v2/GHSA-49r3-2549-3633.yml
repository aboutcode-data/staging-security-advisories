advisory_id: GHSA-49r3-2549-3633
datasource_id: github_osv_importer_v2/GHSA-49r3-2549-3633
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2020/12/GHSA-49r3-2549-3633/GHSA-49r3-2549-3633.json
aliases:
  - CVE-2020-26254
summary: |
  omniauth-apple allows attacker to fake their email address during authentication
  ### Impact

  This vulnerability impacts applications using the [omniauth-apple](https://github.com/nhosoya/omniauth-apple) strategy of OmniAuth and using the `info.email` field of OmniAuth's [Auth Hash Schema](https://github.com/omniauth/omniauth/wiki/Auth-Hash-Schema) for any kind of identification.  The value of this field may be set to any value of the attacker's choice including email addresses of other users.

  For example, an application using omniauth-apple with the following code will be impacted:
  ```ruby
  def omniauth_callback
      auth_hash = request.env['omniauth.auth']
      @authenticated_user = User.find_by(email: auth_hash.info.email)
  end
  ```

  Applications not using `info.email` for identification but are instead using the `uid` field are not impacted in the same manner.  Note, these applications may still be negatively affected if the value of `info.email` is being used for other purposes.

  ### Patches

  Applications using affected versions of omniauth-apple are advised to upgrade to omniauth-apple version 1.0.1 or later.

  ### Workarounds

  If unable to upgrade to a patched version, monkey patching `OmniAuth::Strategies::Apple#email` as follows is advised as a workaround:

  ```ruby
  module OmniAuth
    module Strategies
      class Apple
        def email
          id_info['email']
        end
      end
    end
  end
  ```
impacted_packages:
  - purl: pkg:gem/omniauth-apple
    affected_versions: vers:gem/<1.0.1
    fixed_versions: vers:gem/1.0.1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:N/I:H/A:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2020/12/GHSA-49r3-2549-3633/GHSA-49r3-2549-3633.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-290
references:
  - url: https://github.com/nhosoya/omniauth-apple
    reference_type:
    reference_id:
  - url: https://github.com/nhosoya/omniauth-apple/blob/master/CHANGELOG.md#101---2020-12-03
    reference_type:
    reference_id:
  - url: https://github.com/nhosoya/omniauth-apple/commit/b37d5409213adae2ca06a67fec14c8d3d07d9016
    reference_type:
    reference_id:
  - url: https://github.com/nhosoya/omniauth-apple/security/advisories/GHSA-49r3-2549-3633
    reference_type:
    reference_id:
  - url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/omniauth-apple/CVE-2020-26254.yml
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2020-26254
    reference_type:
    reference_id: CVE-2020-26254
