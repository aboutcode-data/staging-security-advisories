advisory_id: GHSA-cxf7-m5g2-v594
datasource_id: github_osv_importer_v2/GHSA-cxf7-m5g2-v594
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/06/GHSA-cxf7-m5g2-v594/GHSA-cxf7-m5g2-v594.json
aliases: []
summary: |
  Zend-Mail remote code execution in zend-mail via Sendmail adapter
  When using the zend-mail component to send email via the `Zend\Mail\Transport\Sendmail` transport, a malicious user may be able to inject arbitrary parameters to the system sendmail program. The attack is performed by providing additional quote characters within an address; when unsanitized, they can be interpreted as additional command line arguments, leading to the vulnerability.

  The following example demonstrates injecting additional parameters to the sendmail binary via the From address:
  ```
  use Zend\Mail;

  $mail = new Mail\Message();
  $mail->setBody('This is the text of the email.');

  // inject additional parameters to sendmail command line
  $mail->setFrom('"AAA\" params injection"@domain', 'Sender\'s name');

  $mail->addTo('hacker@localhost', 'Name of recipient');
  $mail->setSubject('TestSubject');

  $transport = new Mail\Transport\Sendmail();
  $transport->send($mail);
  ```
  The attack works because zend-mail filters the email addresses using the RFC 3696 specification, where the string "AAA\" params injection"@domain is considered a valid address. This validation is provided using the zend-validator component with the following parameters:
  ```
  Zend\Validator\EmailAddress(
      Zend\Validator\Hostname::ALLOW_DNS | Zend\Validator\Hostname::ALLOW_LOCAL
  )
  ```
  The above accepts local domain with any string specified by double quotes as the local part. While this is valid per RFC 3696, due to the fact that sender email addresses are provided to the sendmail binary via the command line, they create the vulnerability described above.
impacted_packages:
  - purl: pkg:composer/zendframework/zend-mail
    affected_versions: vers:composer/>=2.0.0|<2.4.11
    fixed_versions: vers:composer/2.4.11
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:composer/zendframework/zend-mail
    affected_versions: vers:composer/>=2.5.0|<2.7.2
    fixed_versions: vers:composer/2.7.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '8.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/06/GHSA-cxf7-m5g2-v594/GHSA-cxf7-m5g2-v594.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-74
references:
  - url: https://framework.zend.com/security/advisory/ZF2016-04
    reference_type:
    reference_id:
  - url: https://github.com/FriendsOfPHP/security-advisories/blob/master/zendframework/zend-mail/ZF2016-04.yaml
    reference_type:
    reference_id:
  - url: https://github.com/zendframework/zend-mail
    reference_type:
    reference_id:
  - url: https://github.com/zendframework/zend-mail/commit/0a92d0b3a8b7d7c7659aa569f1a66a23d4ad51af
    reference_type:
    reference_id:
  - url: https://github.com/zendframework/zend-mail/commit/7260c9768bf27c84f994c48698493fd1fa62fca3
    reference_type:
    reference_id:
  - url: https://github.com/zendframework/zend-mail/commit/8d18478b40fdeef7239fb7ea203e072edcadbe54
    reference_type:
    reference_id:
