advisory_id: GHSA-33pv-vcgh-jfg9
datasource_id: github_osv_importer_v2/GHSA-33pv-vcgh-jfg9
datasource_url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/04/GHSA-33pv-vcgh-jfg9/GHSA-33pv-vcgh-jfg9.json
aliases:
  - CVE-2023-28837
summary: "Wagtail vulnerable to denial-of-service via memory exhaustion when uploading large\
  \ files\n### Impact\n\nA memory exhaustion bug exists in Wagtail's handling of uploaded images\
  \ and documents. For both images and documents, files are loaded into memory during upload\
  \ for additional processing. A user with access to upload images or documents through the\
  \ Wagtail admin interface could upload a file so large that it results in a crash or denial\
  \ of service.\n\nThe vulnerability is not exploitable by an ordinary site visitor without\
  \ access to the Wagtail admin. It can only be exploited by admin users with permission to\
  \ upload images or documents.\n\nImage uploads are [restricted to 10MB by default](https://docs.wagtail.org/en/stable/reference/settings.html#wagtailimages-max-upload-size),\
  \ however this validation only happens on the frontend and on the backend after the vulnerable\
  \ code. \n\n### Patches\n\nPatched versions have been released as Wagtail 4.1.4 (for the LTS\
  \ 4.1 branch) and Wagtail 4.2.2 (for the current 4.2 branch).\n\n### Workarounds\n\nSite owners\
  \ who are unable to upgrade to the new versions are encouraged to add extra protections outside\
  \ of Wagtail to limit the size of uploaded files. Exactly how this is done will vary based\
  \ on your hosting environment, but here are a few references for common setups:\n\n- Nginx:\
  \ [`client_max_body_size`](https://nginx.org/en/docs/http/ngx_http_core_module.html#client_max_body_size)\n\
  - Apache: [`LimitRequestBody`](https://httpd.apache.org/docs/2.4/mod/core.html#limitrequestbody)\n\
  - Cloudflare: Already [imposes a limit of 100MB - 500MB](https://developers.cloudflare.com/cache/about/default-cache-behavior#customization-options-and-limitations)\
  \ depending on plan\n- CloudFront: [`SizeConstraint`](https://docs.aws.amazon.com/waf/latest/APIReference/API_SizeConstraintStatement.html)\n\
  - Traefik: [`traefik.http.middlewares.limit.buffering.maxRequestBodyBytes`](https://doc.traefik.io/traefik/middlewares/http/buffering/#maxrequestbodybytes)\n\
  \nThe changes themselves are deep inside Wagtail, making patching incredibly difficult."
impacted_packages:
  - purl: pkg:pypi/wagtail
    affected_versions: vers:pypi/>=4.2|<4.2.2
    fixed_versions: vers:pypi/4.2.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:pypi/wagtail
    affected_versions: vers:pypi/<4.1.4
    fixed_versions: vers:pypi/4.1.4
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '4.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:H/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/04/GHSA-33pv-vcgh-jfg9/GHSA-33pv-vcgh-jfg9.json
  - score: '5.9'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:P/PR:H/UI:N/VC:N/VI:N/VA:H/SC:N/SI:N/SA:N
    published_at: None
    url: https://github.com/github/advisory-database/blob/main/advisories/github-reviewed/2023/04/GHSA-33pv-vcgh-jfg9/GHSA-33pv-vcgh-jfg9.json
  - score: MODERATE
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url:
weaknesses:
  - CWE-770
  - CWE-400
references:
  - url: https://docs.wagtail.org/en/stable/reference/settings.html#wagtailimages-max-upload-size
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/wagtail/PYSEC-2023-56.yaml
    reference_type:
    reference_id:
  - url: https://github.com/wagtail/wagtail
    reference_type:
    reference_id:
  - url: https://github.com/wagtail/wagtail/commit/3c0c64642b9e5b8d28b111263c7f4bddad6c3880
    reference_type:
    reference_id:
  - url: https://github.com/wagtail/wagtail/commit/c9d2fcd650a88d76ae122646142245e5927a9165
    reference_type:
    reference_id:
  - url: https://github.com/wagtail/wagtail/commit/cfa11bbe00dbe7ce8cd4c0bbfe2a898a690df2bf
    reference_type:
    reference_id:
  - url: https://github.com/wagtail/wagtail/commit/d4022310cbe497993459c3136311467c7ac6329a
    reference_type:
    reference_id:
  - url: https://github.com/wagtail/wagtail/releases/tag/v4.1.4
    reference_type:
    reference_id:
  - url: https://github.com/wagtail/wagtail/releases/tag/v4.2.2
    reference_type:
    reference_id:
  - url: https://github.com/wagtail/wagtail/security/advisories/GHSA-33pv-vcgh-jfg9
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-28837
    reference_type:
    reference_id: CVE-2023-28837
