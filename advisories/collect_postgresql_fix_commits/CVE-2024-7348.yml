advisory_id: CVE-2024-7348
datasource_id: collect_postgresql_fix_commits/CVE-2024-7348
datasource_url: https://github.com/postgres/postgres
aliases: []
summary: |
  0cd69b3d7ef357f2b43258de5831c4de0bd51dec:Restrict virtual columns to use built-in functions and types

  Just like selecting from a view is exploitable (CVE-2024-7348),
  selecting from a table with virtual generated columns is exploitable.
  Users who are concerned about this can avoid selecting from views, but
  telling them to avoid selecting from tables is less practical.

  To address this, this changes it so that generation expressions for
  virtual generated columns are restricted to using built-in functions
  and types, and the columns are restricted to having a built-in type.
  We assume that built-in functions and types cannot be exploited for
  this purpose.

  In the future, this could be expanded by some new mechanism to declare
  other functions and types as safe or trusted for this purpose, but
  that is to be designed.

  (An alternative approach might have been to expand the
  restrict_nonsystem_relation_kind GUC to handle this, like the fix for
  CVE-2024-7348.  But that is kind of an ugly approach.  That fix had to
  fit in the constraints of fixing an ancient vulnerability in all
  branches.  Since virtual generated columns are new, we're free from
  the constraints of the past, and we can and should use cleaner
  options.)

  Reported-by: Feike Steenbergen <feikesteenbergen@gmail.com>
  Reviewed-by: jian he <jian.universality@gmail.com>
  Discussion: https://www.postgresql.org/message-id/flat/CAK_s-G2Q7de8Q0qOYUR%3D_CTB5FzzVBm5iZjOp%2BmeVWpMpmfO0w%40mail.gmail.com
  0cd69b3d7ef357f2b43258de5831c4de0bd51dec:Restrict virtual columns to use built-in functions and types

  Just like selecting from a view is exploitable (CVE-2024-7348),
  selecting from a table with virtual generated columns is exploitable.
  Users who are concerned about this can avoid selecting from views, but
  telling them to avoid selecting from tables is less practical.

  To address this, this changes it so that generation expressions for
  virtual generated columns are restricted to using built-in functions
  and types, and the columns are restricted to having a built-in type.
  We assume that built-in functions and types cannot be exploited for
  this purpose.

  In the future, this could be expanded by some new mechanism to declare
  other functions and types as safe or trusted for this purpose, but
  that is to be designed.

  (An alternative approach might have been to expand the
  restrict_nonsystem_relation_kind GUC to handle this, like the fix for
  CVE-2024-7348.  But that is kind of an ugly approach.  That fix had to
  fit in the constraints of fixing an ancient vulnerability in all
  branches.  Since virtual generated columns are new, we're free from
  the constraints of the past, and we can and should use cleaner
  options.)

  Reported-by: Feike Steenbergen <feikesteenbergen@gmail.com>
  Reviewed-by: jian he <jian.universality@gmail.com>
  Discussion: https://www.postgresql.org/message-id/flat/CAK_s-G2Q7de8Q0qOYUR%3D_CTB5FzzVBm5iZjOp%2BmeVWpMpmfO0w%40mail.gmail.com
  1b85e65846aa16ede7aeddd67a9bd16ec73a18ae:Last-minute updates for release notes.

  Security: CVE-2024-7348
  429560193282f2c29a1bb9f28a055c87b7605253:Last-minute updates for release notes.

  Security: CVE-2024-7348
  b942cc42b7c659da70c205151bde5e1f9af2ece0:Last-minute updates for release notes.

  Security: CVE-2024-7348
  6eca8a5673307ce52f892f083df0b958d35f09e1:Last-minute updates for release notes.

  Security: CVE-2024-7348
  c04778592d6db6197819f95028347af135709e4b:Last-minute updates for release notes.

  Security: CVE-2024-7348
  66e94448abec3aad04faf0a79cab4881ae08e08a:Restrict accesses to non-system views and foreign tables during pg_dump.

  When pg_dump retrieves the list of database objects and performs the
  data dump, there was possibility that objects are replaced with others
  of the same name, such as views, and access them. This vulnerability
  could result in code execution with superuser privileges during the
  pg_dump process.

  This issue can arise when dumping data of sequences, foreign
  tables (only 13 or later), or tables registered with a WHERE clause in
  the extension configuration table.

  To address this, pg_dump now utilizes the newly introduced
  restrict_nonsystem_relation_kind GUC parameter to restrict the
  accesses to non-system views and foreign tables during the dump
  process. This new GUC parameter is added to back branches too, but
  these changes do not require cluster recreation.

  Back-patch to all supported branches.

  Reviewed-by: Noah Misch
  Security: CVE-2024-7348
  Backpatch-through: 12
  fdf218f1d52b2c93145f16b28b8374703ae4ef19:Restrict accesses to non-system views and foreign tables during pg_dump.

  When pg_dump retrieves the list of database objects and performs the
  data dump, there was possibility that objects are replaced with others
  of the same name, such as views, and access them. This vulnerability
  could result in code execution with superuser privileges during the
  pg_dump process.

  This issue can arise when dumping data of sequences, foreign
  tables (only 13 or later), or tables registered with a WHERE clause in
  the extension configuration table.

  To address this, pg_dump now utilizes the newly introduced
  restrict_nonsystem_relation_kind GUC parameter to restrict the
  accesses to non-system views and foreign tables during the dump
  process. This new GUC parameter is added to back branches too, but
  these changes do not require cluster recreation.

  Back-patch to all supported branches.

  Reviewed-by: Noah Misch
  Security: CVE-2024-7348
  Backpatch-through: 12
  6aba85a4b0a0e60126cc7c598b3e010e272516ec:Restrict accesses to non-system views and foreign tables during pg_dump.

  When pg_dump retrieves the list of database objects and performs the
  data dump, there was possibility that objects are replaced with others
  of the same name, such as views, and access them. This vulnerability
  could result in code execution with superuser privileges during the
  pg_dump process.

  This issue can arise when dumping data of sequences, foreign
  tables (only 13 or later), or tables registered with a WHERE clause in
  the extension configuration table.

  To address this, pg_dump now utilizes the newly introduced
  restrict_nonsystem_relation_kind GUC parameter to restrict the
  accesses to non-system views and foreign tables during the dump
  process. This new GUC parameter is added to back branches too, but
  these changes do not require cluster recreation.

  Back-patch to all supported branches.

  Reviewed-by: Noah Misch
  Security: CVE-2024-7348
  Backpatch-through: 12
  e81e53a0c1faf2b8f5fe8822d7218c91aeebea52:Restrict accesses to non-system views and foreign tables during pg_dump.

  When pg_dump retrieves the list of database objects and performs the
  data dump, there was possibility that objects are replaced with others
  of the same name, such as views, and access them. This vulnerability
  could result in code execution with superuser privileges during the
  pg_dump process.

  This issue can arise when dumping data of sequences, foreign
  tables (only 13 or later), or tables registered with a WHERE clause in
  the extension configuration table.

  To address this, pg_dump now utilizes the newly introduced
  restrict_nonsystem_relation_kind GUC parameter to restrict the
  accesses to non-system views and foreign tables during the dump
  process. This new GUC parameter is added to back branches too, but
  these changes do not require cluster recreation.

  Back-patch to all supported branches.

  Reviewed-by: Noah Misch
  Security: CVE-2024-7348
  Backpatch-through: 12
  72ef1675e2bc502b31854b1c31ccf22fde7cde47:Restrict accesses to non-system views and foreign tables during pg_dump.

  When pg_dump retrieves the list of database objects and performs the
  data dump, there was possibility that objects are replaced with others
  of the same name, such as views, and access them. This vulnerability
  could result in code execution with superuser privileges during the
  pg_dump process.

  This issue can arise when dumping data of sequences, foreign
  tables (only 13 or later), or tables registered with a WHERE clause in
  the extension configuration table.

  To address this, pg_dump now utilizes the newly introduced
  restrict_nonsystem_relation_kind GUC parameter to restrict the
  accesses to non-system views and foreign tables during the dump
  process. This new GUC parameter is added to back branches too, but
  these changes do not require cluster recreation.

  Back-patch to all supported branches.

  Reviewed-by: Noah Misch
  Security: CVE-2024-7348
  Backpatch-through: 12
  bbc94abf66407ebfe14d186812674896f85375d9:Restrict accesses to non-system views and foreign tables during pg_dump.

  When pg_dump retrieves the list of database objects and performs the
  data dump, there was possibility that objects are replaced with others
  of the same name, such as views, and access them. This vulnerability
  could result in code execution with superuser privileges during the
  pg_dump process.

  This issue can arise when dumping data of sequences, foreign
  tables (only 13 or later), or tables registered with a WHERE clause in
  the extension configuration table.

  To address this, pg_dump now utilizes the newly introduced
  restrict_nonsystem_relation_kind GUC parameter to restrict the
  accesses to non-system views and foreign tables during the dump
  process. This new GUC parameter is added to back branches too, but
  these changes do not require cluster recreation.

  Back-patch to all supported branches.

  Reviewed-by: Noah Misch
  Security: CVE-2024-7348
  Backpatch-through: 12
  79c7a7e29695a32fef2e65682be224b8d61ec972:Restrict accesses to non-system views and foreign tables during pg_dump.

  When pg_dump retrieves the list of database objects and performs the
  data dump, there was possibility that objects are replaced with others
  of the same name, such as views, and access them. This vulnerability
  could result in code execution with superuser privileges during the
  pg_dump process.

  This issue can arise when dumping data of sequences, foreign
  tables (only 13 or later), or tables registered with a WHERE clause in
  the extension configuration table.

  To address this, pg_dump now utilizes the newly introduced
  restrict_nonsystem_relation_kind GUC parameter to restrict the
  accesses to non-system views and foreign tables during the dump
  process. This new GUC parameter is added to back branches too, but
  these changes do not require cluster recreation.

  Back-patch to all supported branches.

  Reviewed-by: Noah Misch
  Security: CVE-2024-7348
  Backpatch-through: 12
impacted_packages:
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 72ef1675e2bc502b31854b1c31ccf22fde7cde47
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 6aba85a4b0a0e60126cc7c598b3e010e272516ec
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: b942cc42b7c659da70c205151bde5e1f9af2ece0
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 79c7a7e29695a32fef2e65682be224b8d61ec972
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 429560193282f2c29a1bb9f28a055c87b7605253
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 0cd69b3d7ef357f2b43258de5831c4de0bd51dec
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 6eca8a5673307ce52f892f083df0b958d35f09e1
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: fdf218f1d52b2c93145f16b28b8374703ae4ef19
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 66e94448abec3aad04faf0a79cab4881ae08e08a
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 1b85e65846aa16ede7aeddd67a9bd16ec73a18ae
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: bbc94abf66407ebfe14d186812674896f85375d9
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: c04778592d6db6197819f95028347af135709e4b
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: e81e53a0c1faf2b8f5fe8822d7218c91aeebea52
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/postgres/postgres/tree/0cd69b3d7ef357f2b43258de5831c4de0bd51dec
    reference_type: commit
    reference_id: 0cd69b3d7ef357f2b43258de5831c4de0bd51dec
  - url: https://github.com/postgres/postgres/tree/1b85e65846aa16ede7aeddd67a9bd16ec73a18ae
    reference_type: commit
    reference_id: 1b85e65846aa16ede7aeddd67a9bd16ec73a18ae
  - url: https://github.com/postgres/postgres/tree/429560193282f2c29a1bb9f28a055c87b7605253
    reference_type: commit
    reference_id: 429560193282f2c29a1bb9f28a055c87b7605253
  - url: https://github.com/postgres/postgres/tree/66e94448abec3aad04faf0a79cab4881ae08e08a
    reference_type: commit
    reference_id: 66e94448abec3aad04faf0a79cab4881ae08e08a
  - url: https://github.com/postgres/postgres/tree/6aba85a4b0a0e60126cc7c598b3e010e272516ec
    reference_type: commit
    reference_id: 6aba85a4b0a0e60126cc7c598b3e010e272516ec
  - url: https://github.com/postgres/postgres/tree/6eca8a5673307ce52f892f083df0b958d35f09e1
    reference_type: commit
    reference_id: 6eca8a5673307ce52f892f083df0b958d35f09e1
  - url: https://github.com/postgres/postgres/tree/72ef1675e2bc502b31854b1c31ccf22fde7cde47
    reference_type: commit
    reference_id: 72ef1675e2bc502b31854b1c31ccf22fde7cde47
  - url: https://github.com/postgres/postgres/tree/79c7a7e29695a32fef2e65682be224b8d61ec972
    reference_type: commit
    reference_id: 79c7a7e29695a32fef2e65682be224b8d61ec972
  - url: https://github.com/postgres/postgres/tree/b942cc42b7c659da70c205151bde5e1f9af2ece0
    reference_type: commit
    reference_id: b942cc42b7c659da70c205151bde5e1f9af2ece0
  - url: https://github.com/postgres/postgres/tree/bbc94abf66407ebfe14d186812674896f85375d9
    reference_type: commit
    reference_id: bbc94abf66407ebfe14d186812674896f85375d9
  - url: https://github.com/postgres/postgres/tree/c04778592d6db6197819f95028347af135709e4b
    reference_type: commit
    reference_id: c04778592d6db6197819f95028347af135709e4b
  - url: https://github.com/postgres/postgres/tree/e81e53a0c1faf2b8f5fe8822d7218c91aeebea52
    reference_type: commit
    reference_id: e81e53a0c1faf2b8f5fe8822d7218c91aeebea52
  - url: https://github.com/postgres/postgres/tree/fdf218f1d52b2c93145f16b28b8374703ae4ef19
    reference_type: commit
    reference_id: fdf218f1d52b2c93145f16b28b8374703ae4ef19
