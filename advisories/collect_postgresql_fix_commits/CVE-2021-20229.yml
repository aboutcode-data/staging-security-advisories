advisory_id: CVE-2021-20229
datasource_id: collect_postgresql_fix_commits/CVE-2021-20229
datasource_url: https://github.com/postgres/postgres
aliases: []
summary: |
  934b8508472a6b7175fd49bb2a8e719cb5560be8:Last-minute updates for release notes.

  Security: CVE-2021-3393, CVE-2021-20229
  392c530d10352978bb3701b7eb425626dc9a4d3e:Last-minute updates for release notes.

  Security: CVE-2021-3393, CVE-2021-20229
  cd82d75a9861c871b95683afdb12df6374fa8435:Last-minute updates for release notes.

  Security: CVE-2021-3393, CVE-2021-20229
  c028faf2a62ce476c8d689a33b12471dc98b80f2:Fix mishandling of column-level SELECT privileges for join aliases.

  scanNSItemForColumn, expandNSItemAttrs, and ExpandSingleTable would
  pass the wrong RTE to markVarForSelectPriv when dealing with a join
  ParseNamespaceItem: they'd pass the join RTE, when what we need to
  mark is the base table that the join column came from.  The end
  result was to not fill the base table's selectedCols bitmap correctly,
  resulting in an understatement of the set of columns that are read
  by the query.  The executor would still insist on there being at
  least one selectable column; but with a correctly crafted query,
  a user having SELECT privilege on just one column of a table would
  nonetheless be allowed to read all its columns.

  To fix, make markRTEForSelectPriv fetch the correct RTE for itself,
  ignoring the possibly-mismatched RTE passed by the caller.  Later,
  we'll get rid of some now-unused RTE arguments, but that risks
  API breaks so we won't do it in released branches.

  This problem was introduced by commit 9ce77d75c, so back-patch
  to v13 where that came in.  Thanks to Sven Klemm for reporting
  the problem.

  Security: CVE-2021-20229
  d525fbcfd167b28818301d0a2d3548ae6a744588:Fix mishandling of column-level SELECT privileges for join aliases.

  scanNSItemForColumn, expandNSItemAttrs, and ExpandSingleTable would
  pass the wrong RTE to markVarForSelectPriv when dealing with a join
  ParseNamespaceItem: they'd pass the join RTE, when what we need to
  mark is the base table that the join column came from.  The end
  result was to not fill the base table's selectedCols bitmap correctly,
  resulting in an understatement of the set of columns that are read
  by the query.  The executor would still insist on there being at
  least one selectable column; but with a correctly crafted query,
  a user having SELECT privilege on just one column of a table would
  nonetheless be allowed to read all its columns.

  To fix, make markRTEForSelectPriv fetch the correct RTE for itself,
  ignoring the possibly-mismatched RTE passed by the caller.  Later,
  we'll get rid of some now-unused RTE arguments, but that risks
  API breaks so we won't do it in released branches.

  This problem was introduced by commit 9ce77d75c, so back-patch
  to v13 where that came in.  Thanks to Sven Klemm for reporting
  the problem.

  Security: CVE-2021-20229
impacted_packages:
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: d525fbcfd167b28818301d0a2d3548ae6a744588
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: cd82d75a9861c871b95683afdb12df6374fa8435
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 934b8508472a6b7175fd49bb2a8e719cb5560be8
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: c028faf2a62ce476c8d689a33b12471dc98b80f2
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 392c530d10352978bb3701b7eb425626dc9a4d3e
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/postgres/postgres/tree/392c530d10352978bb3701b7eb425626dc9a4d3e
    reference_type: commit
    reference_id: 392c530d10352978bb3701b7eb425626dc9a4d3e
  - url: https://github.com/postgres/postgres/tree/934b8508472a6b7175fd49bb2a8e719cb5560be8
    reference_type: commit
    reference_id: 934b8508472a6b7175fd49bb2a8e719cb5560be8
  - url: https://github.com/postgres/postgres/tree/c028faf2a62ce476c8d689a33b12471dc98b80f2
    reference_type: commit
    reference_id: c028faf2a62ce476c8d689a33b12471dc98b80f2
  - url: https://github.com/postgres/postgres/tree/cd82d75a9861c871b95683afdb12df6374fa8435
    reference_type: commit
    reference_id: cd82d75a9861c871b95683afdb12df6374fa8435
  - url: https://github.com/postgres/postgres/tree/d525fbcfd167b28818301d0a2d3548ae6a744588
    reference_type: commit
    reference_id: d525fbcfd167b28818301d0a2d3548ae6a744588
