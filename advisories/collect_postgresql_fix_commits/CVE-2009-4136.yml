advisory_id: CVE-2009-4136
datasource_id: collect_postgresql_fix_commits/CVE-2009-4136
datasource_url: https://github.com/postgres/postgres
aliases: []
summary: |
  9d97bb7f2712a1348cca0503ce606e73d14c9a43:Prevent indirect security attacks via changing session-local state within
  an allegedly immutable index function.  It was previously recognized that
  we had to prevent such a function from executing SET/RESET ROLE/SESSION
  AUTHORIZATION, or it could trivially obtain the privileges of the session
  user.  However, since there is in general no privilege checking for changes
  of session-local state, it is also possible for such a function to change
  settings in a way that might subvert later operations in the same session.
  Examples include changing search_path to cause an unexpected function to
  be called, or replacing an existing prepared statement with another one
  that will execute a function of the attacker's choosing.

  The present patch secures VACUUM, ANALYZE, and CREATE INDEX/REINDEX against
  these threats, which are the same places previously deemed to need protection
  against the SET ROLE issue.  GUC changes are still allowed, since there are
  many useful cases for that, but we prevent security problems by forcing a
  rollback of any GUC change after completing the operation.  Other cases are
  handled by throwing an error if any change is attempted; these include temp
  table creation, closing a cursor, and creating or deleting a prepared
  statement.  (In 7.4, the infrastructure to roll back GUC changes doesn't
  exist, so we settle for rejecting changes of "search_path" in these contexts.)

  Original report and patch by Gurjeet Singh, additional analysis by
  Tom Lane.

  Security: CVE-2009-4136
  a3a262679e94641e848e3c04cbc18a3be0572c02:Prevent indirect security attacks via changing session-local state within
  an allegedly immutable index function.  It was previously recognized that
  we had to prevent such a function from executing SET/RESET ROLE/SESSION
  AUTHORIZATION, or it could trivially obtain the privileges of the session
  user.  However, since there is in general no privilege checking for changes
  of session-local state, it is also possible for such a function to change
  settings in a way that might subvert later operations in the same session.
  Examples include changing search_path to cause an unexpected function to
  be called, or replacing an existing prepared statement with another one
  that will execute a function of the attacker's choosing.

  The present patch secures VACUUM, ANALYZE, and CREATE INDEX/REINDEX against
  these threats, which are the same places previously deemed to need protection
  against the SET ROLE issue.  GUC changes are still allowed, since there are
  many useful cases for that, but we prevent security problems by forcing a
  rollback of any GUC change after completing the operation.  Other cases are
  handled by throwing an error if any change is attempted; these include temp
  table creation, closing a cursor, and creating or deleting a prepared
  statement.  (In 7.4, the infrastructure to roll back GUC changes doesn't
  exist, so we settle for rejecting changes of "search_path" in these contexts.)

  Original report and patch by Gurjeet Singh, additional analysis by
  Tom Lane.

  Security: CVE-2009-4136
  613981be04d59ccac56ee578bee1bd01c3ce68bd:Prevent indirect security attacks via changing session-local state within
  an allegedly immutable index function.  It was previously recognized that
  we had to prevent such a function from executing SET/RESET ROLE/SESSION
  AUTHORIZATION, or it could trivially obtain the privileges of the session
  user.  However, since there is in general no privilege checking for changes
  of session-local state, it is also possible for such a function to change
  settings in a way that might subvert later operations in the same session.
  Examples include changing search_path to cause an unexpected function to
  be called, or replacing an existing prepared statement with another one
  that will execute a function of the attacker's choosing.

  The present patch secures VACUUM, ANALYZE, and CREATE INDEX/REINDEX against
  these threats, which are the same places previously deemed to need protection
  against the SET ROLE issue.  GUC changes are still allowed, since there are
  many useful cases for that, but we prevent security problems by forcing a
  rollback of any GUC change after completing the operation.  Other cases are
  handled by throwing an error if any change is attempted; these include temp
  table creation, closing a cursor, and creating or deleting a prepared
  statement.  (In 7.4, the infrastructure to roll back GUC changes doesn't
  exist, so we settle for rejecting changes of "search_path" in these contexts.)

  Original report and patch by Gurjeet Singh, additional analysis by
  Tom Lane.

  Security: CVE-2009-4136
  ab4bbf941f0cf5e8fc1b2395ea75be98dd385794:Prevent indirect security attacks via changing session-local state within
  an allegedly immutable index function.  It was previously recognized that
  we had to prevent such a function from executing SET/RESET ROLE/SESSION
  AUTHORIZATION, or it could trivially obtain the privileges of the session
  user.  However, since there is in general no privilege checking for changes
  of session-local state, it is also possible for such a function to change
  settings in a way that might subvert later operations in the same session.
  Examples include changing search_path to cause an unexpected function to
  be called, or replacing an existing prepared statement with another one
  that will execute a function of the attacker's choosing.

  The present patch secures VACUUM, ANALYZE, and CREATE INDEX/REINDEX against
  these threats, which are the same places previously deemed to need protection
  against the SET ROLE issue.  GUC changes are still allowed, since there are
  many useful cases for that, but we prevent security problems by forcing a
  rollback of any GUC change after completing the operation.  Other cases are
  handled by throwing an error if any change is attempted; these include temp
  table creation, closing a cursor, and creating or deleting a prepared
  statement.  (In 7.4, the infrastructure to roll back GUC changes doesn't
  exist, so we settle for rejecting changes of "search_path" in these contexts.)

  Original report and patch by Gurjeet Singh, additional analysis by
  Tom Lane.

  Security: CVE-2009-4136
  e3b01bc1e15a8a2959b85a8a3a3b24587f526b74:Prevent indirect security attacks via changing session-local state within
  an allegedly immutable index function.  It was previously recognized that
  we had to prevent such a function from executing SET/RESET ROLE/SESSION
  AUTHORIZATION, or it could trivially obtain the privileges of the session
  user.  However, since there is in general no privilege checking for changes
  of session-local state, it is also possible for such a function to change
  settings in a way that might subvert later operations in the same session.
  Examples include changing search_path to cause an unexpected function to
  be called, or replacing an existing prepared statement with another one
  that will execute a function of the attacker's choosing.

  The present patch secures VACUUM, ANALYZE, and CREATE INDEX/REINDEX against
  these threats, which are the same places previously deemed to need protection
  against the SET ROLE issue.  GUC changes are still allowed, since there are
  many useful cases for that, but we prevent security problems by forcing a
  rollback of any GUC change after completing the operation.  Other cases are
  handled by throwing an error if any change is attempted; these include temp
  table creation, closing a cursor, and creating or deleting a prepared
  statement.  (In 7.4, the infrastructure to roll back GUC changes doesn't
  exist, so we settle for rejecting changes of "search_path" in these contexts.)

  Original report and patch by Gurjeet Singh, additional analysis by
  Tom Lane.

  Security: CVE-2009-4136
  42ba393b5971192efd1627a38b39ddf9ea3c4b2e:Prevent indirect security attacks via changing session-local state within
  an allegedly immutable index function.  It was previously recognized that
  we had to prevent such a function from executing SET/RESET ROLE/SESSION
  AUTHORIZATION, or it could trivially obtain the privileges of the session
  user.  However, since there is in general no privilege checking for changes
  of session-local state, it is also possible for such a function to change
  settings in a way that might subvert later operations in the same session.
  Examples include changing search_path to cause an unexpected function to
  be called, or replacing an existing prepared statement with another one
  that will execute a function of the attacker's choosing.

  The present patch secures VACUUM, ANALYZE, and CREATE INDEX/REINDEX against
  these threats, which are the same places previously deemed to need protection
  against the SET ROLE issue.  GUC changes are still allowed, since there are
  many useful cases for that, but we prevent security problems by forcing a
  rollback of any GUC change after completing the operation.  Other cases are
  handled by throwing an error if any change is attempted; these include temp
  table creation, closing a cursor, and creating or deleting a prepared
  statement.  (In 7.4, the infrastructure to roll back GUC changes doesn't
  exist, so we settle for rejecting changes of "search_path" in these contexts.)

  Original report and patch by Gurjeet Singh, additional analysis by
  Tom Lane.

  Security: CVE-2009-4136
  62aba76568e58698ad5eaa6153bc45186aacbde2:Prevent indirect security attacks via changing session-local state within
  an allegedly immutable index function.  It was previously recognized that
  we had to prevent such a function from executing SET/RESET ROLE/SESSION
  AUTHORIZATION, or it could trivially obtain the privileges of the session
  user.  However, since there is in general no privilege checking for changes
  of session-local state, it is also possible for such a function to change
  settings in a way that might subvert later operations in the same session.
  Examples include changing search_path to cause an unexpected function to
  be called, or replacing an existing prepared statement with another one
  that will execute a function of the attacker's choosing.

  The present patch secures VACUUM, ANALYZE, and CREATE INDEX/REINDEX against
  these threats, which are the same places previously deemed to need protection
  against the SET ROLE issue.  GUC changes are still allowed, since there are
  many useful cases for that, but we prevent security problems by forcing a
  rollback of any GUC change after completing the operation.  Other cases are
  handled by throwing an error if any change is attempted; these include temp
  table creation, closing a cursor, and creating or deleting a prepared
  statement.  (In 7.4, the infrastructure to roll back GUC changes doesn't
  exist, so we settle for rejecting changes of "search_path" in these contexts.)

  Original report and patch by Gurjeet Singh, additional analysis by
  Tom Lane.

  Security: CVE-2009-4136
impacted_packages:
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 9d97bb7f2712a1348cca0503ce606e73d14c9a43
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: ab4bbf941f0cf5e8fc1b2395ea75be98dd385794
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: a3a262679e94641e848e3c04cbc18a3be0572c02
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 62aba76568e58698ad5eaa6153bc45186aacbde2
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 613981be04d59ccac56ee578bee1bd01c3ce68bd
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: e3b01bc1e15a8a2959b85a8a3a3b24587f526b74
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 42ba393b5971192efd1627a38b39ddf9ea3c4b2e
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/postgres/postgres/tree/42ba393b5971192efd1627a38b39ddf9ea3c4b2e
    reference_type: commit
    reference_id: 42ba393b5971192efd1627a38b39ddf9ea3c4b2e
  - url: https://github.com/postgres/postgres/tree/613981be04d59ccac56ee578bee1bd01c3ce68bd
    reference_type: commit
    reference_id: 613981be04d59ccac56ee578bee1bd01c3ce68bd
  - url: https://github.com/postgres/postgres/tree/62aba76568e58698ad5eaa6153bc45186aacbde2
    reference_type: commit
    reference_id: 62aba76568e58698ad5eaa6153bc45186aacbde2
  - url: https://github.com/postgres/postgres/tree/9d97bb7f2712a1348cca0503ce606e73d14c9a43
    reference_type: commit
    reference_id: 9d97bb7f2712a1348cca0503ce606e73d14c9a43
  - url: https://github.com/postgres/postgres/tree/a3a262679e94641e848e3c04cbc18a3be0572c02
    reference_type: commit
    reference_id: a3a262679e94641e848e3c04cbc18a3be0572c02
  - url: https://github.com/postgres/postgres/tree/ab4bbf941f0cf5e8fc1b2395ea75be98dd385794
    reference_type: commit
    reference_id: ab4bbf941f0cf5e8fc1b2395ea75be98dd385794
  - url: https://github.com/postgres/postgres/tree/e3b01bc1e15a8a2959b85a8a3a3b24587f526b74
    reference_type: commit
    reference_id: e3b01bc1e15a8a2959b85a8a3a3b24587f526b74
