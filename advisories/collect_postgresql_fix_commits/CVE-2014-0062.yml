advisory_id: CVE-2014-0062
datasource_id: collect_postgresql_fix_commits/CVE-2014-0062
datasource_url: https://github.com/postgres/postgres
aliases: []
summary: |
  84f594da358861cceeaeb7a97bb58f3765eeb284:Revert support for ALTER TABLE ... MERGE/SPLIT PARTITION(S) commands

  This commit reverts 1adf16b8fb, 87c21bb941, and subsequent fixes and
  improvements including df64c81ca9, c99ef1811a, 9dfcac8e15, 885742b9f8,
  842c9b2705, fcf80c5d5f, 96c7381c4c, f4fc7cb54b, 60ae37a8bc, 259c96fa8f,
  449cdcd486, 3ca43dbbb6, 2a679ae94e, 3a82c689fd, fbd4321fd5, d53a4286d7,
  c086896625, 4e5d6c4091, 04158e7fa3.

  The reason for reverting is security issues related to repeatable name lookups
  (CVE-2014-0062).  Even though 04158e7fa3 solved part of the problem, there
  are still remaining issues, which aren't feasible to even carefully analyze
  before the RC deadline.

  Reported-by: Noah Misch, Robert Haas
  Discussion: https://postgr.es/m/20240808171351.a9.nmisch%40google.com
  Backpatch-through: 17
  3890d90c1508125729ed20038d90513694fc3a7b:Revert support for ALTER TABLE ... MERGE/SPLIT PARTITION(S) commands

  This commit reverts 1adf16b8fb, 87c21bb941, and subsequent fixes and
  improvements including df64c81ca9, c99ef1811a, 9dfcac8e15, 885742b9f8,
  842c9b2705, fcf80c5d5f, 96c7381c4c, f4fc7cb54b, 60ae37a8bc, 259c96fa8f,
  449cdcd486, 3ca43dbbb6, 2a679ae94e, 3a82c689fd, fbd4321fd5, d53a4286d7,
  c086896625, 4e5d6c4091, 04158e7fa3.

  The reason for reverting is security issues related to repeatable name lookups
  (CVE-2014-0062).  Even though 04158e7fa3 solved part of the problem, there
  are still remaining issues, which aren't feasible to even carefully analyze
  before the RC deadline.

  Reported-by: Noah Misch, Robert Haas
  Discussion: https://postgr.es/m/20240808171351.a9.nmisch%40google.com
  Backpatch-through: 17
  f636ab41aba215eaa3303e21a10f12d81357f1f6:Avoid repeated table name lookups in createPartitionTable()

  Currently, createPartitionTable() opens newly created table using its name.
  This approach is prone to privilege escalation attack, because we might end
  up opening another table than we just created.

  This commit address the issue above by opening newly created table by its
  OID.  It appears to be tricky to get a relation OID out of ProcessUtility().
  We have to extend TableLikeClause with new newRelationOid field, which is
  filled within ProcessUtility() to be further accessed by caller.

  Security: CVE-2014-0062
  Reported-by: Noah Misch
  Discussion: https://postgr.es/m/20240808171351.a9.nmisch%40google.com
  Reviewed-by: Pavel Borisov, Dmitry Koval
  04158e7fa37c2dda9c3421ca922d02807b86df19:Avoid repeated table name lookups in createPartitionTable()

  Currently, createPartitionTable() opens newly created table using its name.
  This approach is prone to privilege escalation attack, because we might end
  up opening another table than we just created.

  This commit address the issue above by opening newly created table by its
  OID.  It appears to be tricky to get a relation OID out of ProcessUtility().
  We have to extend TableLikeClause with new newRelationOid field, which is
  filled within ProcessUtility() to be further accessed by caller.

  Security: CVE-2014-0062
  Reported-by: Noah Misch
  Discussion: https://postgr.es/m/20240808171351.a9.nmisch%40google.com
  Reviewed-by: Pavel Borisov, Dmitry Koval
  e464761333024d2c63f6b1d04af4ea7ca317003b:Avoid repeated name lookups during table and index DDL.

  If the name lookups come to different conclusions due to concurrent
  activity, we might perform some parts of the DDL on a different table
  than other parts.  At least in the case of CREATE INDEX, this can be
  used to cause the permissions checks to be performed against a
  different table than the index creation, allowing for a privilege
  escalation attack.

  This changes the calling convention for DefineIndex, CreateTrigger,
  transformIndexStmt, transformAlterTableStmt, CheckIndexCompatible
  (in 9.2 and newer), and AlterTable (in 9.1 and older).  In addition,
  CheckRelationOwnership is removed in 9.2 and newer and the calling
  convention is changed in older branches.  A field has also been added
  to the Constraint node (FkConstraint in 8.4).  Third-party code calling
  these functions or using the Constraint node will require updating.

  Report by Andres Freund.  Patch by Robert Haas and Andres Freund,
  reviewed by Tom Lane.

  Security: CVE-2014-0062
  43d4e965edf119b4f12df3e1488c82f32bfa9fe0:Avoid repeated name lookups during table and index DDL.

  If the name lookups come to different conclusions due to concurrent
  activity, we might perform some parts of the DDL on a different table
  than other parts.  At least in the case of CREATE INDEX, this can be
  used to cause the permissions checks to be performed against a
  different table than the index creation, allowing for a privilege
  escalation attack.

  This changes the calling convention for DefineIndex, CreateTrigger,
  transformIndexStmt, transformAlterTableStmt, CheckIndexCompatible
  (in 9.2 and newer), and AlterTable (in 9.1 and older).  In addition,
  CheckRelationOwnership is removed in 9.2 and newer and the calling
  convention is changed in older branches.  A field has also been added
  to the Constraint node (FkConstraint in 8.4).  Third-party code calling
  these functions or using the Constraint node will require updating.

  Report by Andres Freund.  Patch by Robert Haas and Andres Freund,
  reviewed by Tom Lane.

  Security: CVE-2014-0062
  b5c574399ee7306bee3650f0907a07e42be82b33:Avoid repeated name lookups during table and index DDL.

  If the name lookups come to different conclusions due to concurrent
  activity, we might perform some parts of the DDL on a different table
  than other parts.  At least in the case of CREATE INDEX, this can be
  used to cause the permissions checks to be performed against a
  different table than the index creation, allowing for a privilege
  escalation attack.

  This changes the calling convention for DefineIndex, CreateTrigger,
  transformIndexStmt, transformAlterTableStmt, CheckIndexCompatible
  (in 9.2 and newer), and AlterTable (in 9.1 and older).  In addition,
  CheckRelationOwnership is removed in 9.2 and newer and the calling
  convention is changed in older branches.  A field has also been added
  to the Constraint node (FkConstraint in 8.4).  Third-party code calling
  these functions or using the Constraint node will require updating.

  Report by Andres Freund.  Patch by Robert Haas and Andres Freund,
  reviewed by Tom Lane.

  Security: CVE-2014-0062
  820ab11fbfd508fc75a39c43ad2c1b3e79c4982b:Avoid repeated name lookups during table and index DDL.

  If the name lookups come to different conclusions due to concurrent
  activity, we might perform some parts of the DDL on a different table
  than other parts.  At least in the case of CREATE INDEX, this can be
  used to cause the permissions checks to be performed against a
  different table than the index creation, allowing for a privilege
  escalation attack.

  This changes the calling convention for DefineIndex, CreateTrigger,
  transformIndexStmt, transformAlterTableStmt, CheckIndexCompatible
  (in 9.2 and newer), and AlterTable (in 9.1 and older).  In addition,
  CheckRelationOwnership is removed in 9.2 and newer and the calling
  convention is changed in older branches.  A field has also been added
  to the Constraint node (FkConstraint in 8.4).  Third-party code calling
  these functions or using the Constraint node will require updating.

  Report by Andres Freund.  Patch by Robert Haas and Andres Freund,
  reviewed by Tom Lane.

  Security: CVE-2014-0062
  e1e0a4d791292ebe9572451a6cf49fb0ccb320c7:Avoid repeated name lookups during table and index DDL.

  If the name lookups come to different conclusions due to concurrent
  activity, we might perform some parts of the DDL on a different table
  than other parts.  At least in the case of CREATE INDEX, this can be
  used to cause the permissions checks to be performed against a
  different table than the index creation, allowing for a privilege
  escalation attack.

  This changes the calling convention for DefineIndex, CreateTrigger,
  transformIndexStmt, transformAlterTableStmt, CheckIndexCompatible
  (in 9.2 and newer), and AlterTable (in 9.1 and older).  In addition,
  CheckRelationOwnership is removed in 9.2 and newer and the calling
  convention is changed in older branches.  A field has also been added
  to the Constraint node (FkConstraint in 8.4).  Third-party code calling
  these functions or using the Constraint node will require updating.

  Report by Andres Freund.  Patch by Robert Haas and Andres Freund,
  reviewed by Tom Lane.

  Security: CVE-2014-0062
  5f173040e324f6c2eebb90d86cf1b0cdb5890f0a:Avoid repeated name lookups during table and index DDL.

  If the name lookups come to different conclusions due to concurrent
  activity, we might perform some parts of the DDL on a different table
  than other parts.  At least in the case of CREATE INDEX, this can be
  used to cause the permissions checks to be performed against a
  different table than the index creation, allowing for a privilege
  escalation attack.

  This changes the calling convention for DefineIndex, CreateTrigger,
  transformIndexStmt, transformAlterTableStmt, CheckIndexCompatible
  (in 9.2 and newer), and AlterTable (in 9.1 and older).  In addition,
  CheckRelationOwnership is removed in 9.2 and newer and the calling
  convention is changed in older branches.  A field has also been added
  to the Constraint node (FkConstraint in 8.4).  Third-party code calling
  these functions or using the Constraint node will require updating.

  Report by Andres Freund.  Patch by Robert Haas and Andres Freund,
  reviewed by Tom Lane.

  Security: CVE-2014-0062
impacted_packages:
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: e464761333024d2c63f6b1d04af4ea7ca317003b
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 820ab11fbfd508fc75a39c43ad2c1b3e79c4982b
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 43d4e965edf119b4f12df3e1488c82f32bfa9fe0
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: b5c574399ee7306bee3650f0907a07e42be82b33
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 5f173040e324f6c2eebb90d86cf1b0cdb5890f0a
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: e1e0a4d791292ebe9572451a6cf49fb0ccb320c7
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 84f594da358861cceeaeb7a97bb58f3765eeb284
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 3890d90c1508125729ed20038d90513694fc3a7b
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 04158e7fa37c2dda9c3421ca922d02807b86df19
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: f636ab41aba215eaa3303e21a10f12d81357f1f6
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/postgres/postgres/tree/04158e7fa37c2dda9c3421ca922d02807b86df19
    reference_type: commit
    reference_id: 04158e7fa37c2dda9c3421ca922d02807b86df19
  - url: https://github.com/postgres/postgres/tree/3890d90c1508125729ed20038d90513694fc3a7b
    reference_type: commit
    reference_id: 3890d90c1508125729ed20038d90513694fc3a7b
  - url: https://github.com/postgres/postgres/tree/43d4e965edf119b4f12df3e1488c82f32bfa9fe0
    reference_type: commit
    reference_id: 43d4e965edf119b4f12df3e1488c82f32bfa9fe0
  - url: https://github.com/postgres/postgres/tree/5f173040e324f6c2eebb90d86cf1b0cdb5890f0a
    reference_type: commit
    reference_id: 5f173040e324f6c2eebb90d86cf1b0cdb5890f0a
  - url: https://github.com/postgres/postgres/tree/820ab11fbfd508fc75a39c43ad2c1b3e79c4982b
    reference_type: commit
    reference_id: 820ab11fbfd508fc75a39c43ad2c1b3e79c4982b
  - url: https://github.com/postgres/postgres/tree/84f594da358861cceeaeb7a97bb58f3765eeb284
    reference_type: commit
    reference_id: 84f594da358861cceeaeb7a97bb58f3765eeb284
  - url: https://github.com/postgres/postgres/tree/b5c574399ee7306bee3650f0907a07e42be82b33
    reference_type: commit
    reference_id: b5c574399ee7306bee3650f0907a07e42be82b33
  - url: https://github.com/postgres/postgres/tree/e1e0a4d791292ebe9572451a6cf49fb0ccb320c7
    reference_type: commit
    reference_id: e1e0a4d791292ebe9572451a6cf49fb0ccb320c7
  - url: https://github.com/postgres/postgres/tree/e464761333024d2c63f6b1d04af4ea7ca317003b
    reference_type: commit
    reference_id: e464761333024d2c63f6b1d04af4ea7ca317003b
  - url: https://github.com/postgres/postgres/tree/f636ab41aba215eaa3303e21a10f12d81357f1f6
    reference_type: commit
    reference_id: f636ab41aba215eaa3303e21a10f12d81357f1f6
