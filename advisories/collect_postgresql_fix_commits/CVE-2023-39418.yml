advisory_id: CVE-2023-39418
datasource_id: collect_postgresql_fix_commits/CVE-2023-39418
datasource_url: https://github.com/postgres/postgres
aliases: []
summary: |
  023fa8f326dad5e0f841fcc4247b449881215cb7:Last-minute updates for release notes.

  Security: CVE-2023-39417, CVE-2023-39418
  c79434d7fcabdf2a5b27b235c0fb85912e686087:Last-minute updates for release notes.

  Security: CVE-2023-39417, CVE-2023-39418
  5d81700859adc9462b9663789f4491611c3d11b8:Last-minute updates for release notes.

  Security: CVE-2023-39417, CVE-2023-39418
  93eb661713338b2b51f36ec397e42397b5e441e2:Last-minute updates for release notes.

  Security: CVE-2023-39417, CVE-2023-39418
  948757fe493c1031d43bb082b6466db9a08f34a3:Last-minute updates for release notes.

  Security: CVE-2023-39417, CVE-2023-39418
  c2e08b04c9e71ac6aabdc7d9b3f8e785e164d770:Fix RLS policy usage in MERGE.

  If MERGE executes an UPDATE action on a table with row-level security,
  the code incorrectly applied the WITH CHECK clauses from the target
  table's INSERT policies to new rows, instead of the clauses from the
  table's UPDATE policies. In addition, it failed to check new rows
  against the target table's SELECT policies, if SELECT permissions were
  required (likely to always be the case).

  In addition, if MERGE executes a DO NOTHING action for matched rows,
  the code incorrectly applied the USING clauses from the target table's
  DELETE policies to existing target tuples. These policies were applied
  as checks that would throw an error, if they did not pass.

  Fix this, so that a MERGE UPDATE action applies the same RLS policies
  as a plain UPDATE query with a WHERE clause, and a DO NOTHING action
  does not apply any RLS checks (other than adding clauses from SELECT
  policies to the join).

  Back-patch to v15, where MERGE was introduced.

  Dean Rasheed, reviewed by Stephen Frost.

  Security: CVE-2023-39418
  67a007dc0cdb8578726c2000a7abc513109cb4a2:Fix RLS policy usage in MERGE.

  If MERGE executes an UPDATE action on a table with row-level security,
  the code incorrectly applied the WITH CHECK clauses from the target
  table's INSERT policies to new rows, instead of the clauses from the
  table's UPDATE policies. In addition, it failed to check new rows
  against the target table's SELECT policies, if SELECT permissions were
  required (likely to always be the case).

  In addition, if MERGE executes a DO NOTHING action for matched rows,
  the code incorrectly applied the USING clauses from the target table's
  DELETE policies to existing target tuples. These policies were applied
  as checks that would throw an error, if they did not pass.

  Fix this, so that a MERGE UPDATE action applies the same RLS policies
  as a plain UPDATE query with a WHERE clause, and a DO NOTHING action
  does not apply any RLS checks (other than adding clauses from SELECT
  policies to the join).

  Back-patch to v15, where MERGE was introduced.

  Dean Rasheed, reviewed by Stephen Frost.

  Security: CVE-2023-39418
  cb2ae5741f2458a474ed3c31458d242e678ff229:Fix RLS policy usage in MERGE.

  If MERGE executes an UPDATE action on a table with row-level security,
  the code incorrectly applied the WITH CHECK clauses from the target
  table's INSERT policies to new rows, instead of the clauses from the
  table's UPDATE policies. In addition, it failed to check new rows
  against the target table's SELECT policies, if SELECT permissions were
  required (likely to always be the case).

  In addition, if MERGE executes a DO NOTHING action for matched rows,
  the code incorrectly applied the USING clauses from the target table's
  DELETE policies to existing target tuples. These policies were applied
  as checks that would throw an error, if they did not pass.

  Fix this, so that a MERGE UPDATE action applies the same RLS policies
  as a plain UPDATE query with a WHERE clause, and a DO NOTHING action
  does not apply any RLS checks (other than adding clauses from SELECT
  policies to the join).

  Back-patch to v15, where MERGE was introduced.

  Dean Rasheed, reviewed by Stephen Frost.

  Security: CVE-2023-39418
impacted_packages:
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: c2e08b04c9e71ac6aabdc7d9b3f8e785e164d770
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: cb2ae5741f2458a474ed3c31458d242e678ff229
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: c79434d7fcabdf2a5b27b235c0fb85912e686087
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 023fa8f326dad5e0f841fcc4247b449881215cb7
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 948757fe493c1031d43bb082b6466db9a08f34a3
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 67a007dc0cdb8578726c2000a7abc513109cb4a2
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 5d81700859adc9462b9663789f4491611c3d11b8
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 93eb661713338b2b51f36ec397e42397b5e441e2
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/postgres/postgres/tree/023fa8f326dad5e0f841fcc4247b449881215cb7
    reference_type: commit
    reference_id: 023fa8f326dad5e0f841fcc4247b449881215cb7
  - url: https://github.com/postgres/postgres/tree/5d81700859adc9462b9663789f4491611c3d11b8
    reference_type: commit
    reference_id: 5d81700859adc9462b9663789f4491611c3d11b8
  - url: https://github.com/postgres/postgres/tree/67a007dc0cdb8578726c2000a7abc513109cb4a2
    reference_type: commit
    reference_id: 67a007dc0cdb8578726c2000a7abc513109cb4a2
  - url: https://github.com/postgres/postgres/tree/93eb661713338b2b51f36ec397e42397b5e441e2
    reference_type: commit
    reference_id: 93eb661713338b2b51f36ec397e42397b5e441e2
  - url: https://github.com/postgres/postgres/tree/948757fe493c1031d43bb082b6466db9a08f34a3
    reference_type: commit
    reference_id: 948757fe493c1031d43bb082b6466db9a08f34a3
  - url: https://github.com/postgres/postgres/tree/c2e08b04c9e71ac6aabdc7d9b3f8e785e164d770
    reference_type: commit
    reference_id: c2e08b04c9e71ac6aabdc7d9b3f8e785e164d770
  - url: https://github.com/postgres/postgres/tree/c79434d7fcabdf2a5b27b235c0fb85912e686087
    reference_type: commit
    reference_id: c79434d7fcabdf2a5b27b235c0fb85912e686087
  - url: https://github.com/postgres/postgres/tree/cb2ae5741f2458a474ed3c31458d242e678ff229
    reference_type: commit
    reference_id: cb2ae5741f2458a474ed3c31458d242e678ff229
