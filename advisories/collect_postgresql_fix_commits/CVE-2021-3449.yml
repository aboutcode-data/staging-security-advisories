advisory_id: CVE-2021-3449
datasource_id: collect_postgresql_fix_commits/CVE-2021-3449
datasource_url: https://github.com/postgres/postgres
aliases: []
summary: |
  7777df34d7a37c40bba6e93da34bb78af48134e1:Disallow SSL renegotiation

  SSL renegotiation is already disabled as of 48d23c72, however this does
  not prevent the server to comply with a client willing to use
  renegotiation.  In the last couple of years, renegotiation had its set
  of security issues and flaws (like the recent CVE-2021-3449), and it
  could be possible to crash the backend with a client attempting
  renegotiation.

  This commit takes one extra step by disabling renegotiation in the
  backend in the same way as SSL compression (f9264d15) or tickets
  (97d3a0b0).  OpenSSL 1.1.0h has added an option named
  SSL_OP_NO_RENEGOTIATION able to achieve that.  In older versions
  there is an option called SSL3_FLAGS_NO_RENEGOTIATE_CIPHERS that
  was undocumented, and could be set within the SSL object created when
  the TLS connection opens, but I have decided not to use it, as it feels
  trickier to rely on, and it is not official.  Note that this option is
  not usable in OpenSSL < 1.1.0h as the internal contents of the *SSL
  object are hidden to applications.

  SSL renegotiation concerns protocols up to TLSv1.2.

  Per original report from Robert Haas, with a patch based on a suggestion
  by Andres Freund.

  Author: Michael Paquier
  Reviewed-by: Daniel Gustafsson
  Discussion: https://postgr.es/m/YKZBXx7RhU74FlTE@paquier.xyz
  Backpatch-through: 9.6
  c64b5d10d69556635d0ee8096b5ba0bdc49e0e35:Disallow SSL renegotiation

  SSL renegotiation is already disabled as of 48d23c72, however this does
  not prevent the server to comply with a client willing to use
  renegotiation.  In the last couple of years, renegotiation had its set
  of security issues and flaws (like the recent CVE-2021-3449), and it
  could be possible to crash the backend with a client attempting
  renegotiation.

  This commit takes one extra step by disabling renegotiation in the
  backend in the same way as SSL compression (f9264d15) or tickets
  (97d3a0b0).  OpenSSL 1.1.0h has added an option named
  SSL_OP_NO_RENEGOTIATION able to achieve that.  In older versions
  there is an option called SSL3_FLAGS_NO_RENEGOTIATE_CIPHERS that
  was undocumented, and could be set within the SSL object created when
  the TLS connection opens, but I have decided not to use it, as it feels
  trickier to rely on, and it is not official.  Note that this option is
  not usable in OpenSSL < 1.1.0h as the internal contents of the *SSL
  object are hidden to applications.

  SSL renegotiation concerns protocols up to TLSv1.2.

  Per original report from Robert Haas, with a patch based on a suggestion
  by Andres Freund.

  Author: Michael Paquier
  Reviewed-by: Daniel Gustafsson
  Discussion: https://postgr.es/m/YKZBXx7RhU74FlTE@paquier.xyz
  Backpatch-through: 9.6
  96918b76fb059126f55f3099f4bcc50de1ed6150:Disallow SSL renegotiation

  SSL renegotiation is already disabled as of 48d23c72, however this does
  not prevent the server to comply with a client willing to use
  renegotiation.  In the last couple of years, renegotiation had its set
  of security issues and flaws (like the recent CVE-2021-3449), and it
  could be possible to crash the backend with a client attempting
  renegotiation.

  This commit takes one extra step by disabling renegotiation in the
  backend in the same way as SSL compression (f9264d15) or tickets
  (97d3a0b0).  OpenSSL 1.1.0h has added an option named
  SSL_OP_NO_RENEGOTIATION able to achieve that.  In older versions
  there is an option called SSL3_FLAGS_NO_RENEGOTIATE_CIPHERS that
  was undocumented, and could be set within the SSL object created when
  the TLS connection opens, but I have decided not to use it, as it feels
  trickier to rely on, and it is not official.  Note that this option is
  not usable in OpenSSL < 1.1.0h as the internal contents of the *SSL
  object are hidden to applications.

  SSL renegotiation concerns protocols up to TLSv1.2.

  Per original report from Robert Haas, with a patch based on a suggestion
  by Andres Freund.

  Author: Michael Paquier
  Reviewed-by: Daniel Gustafsson
  Discussion: https://postgr.es/m/YKZBXx7RhU74FlTE@paquier.xyz
  Backpatch-through: 9.6
  3f8072be8a71b5bd3dc838a4ba03ccdaff2d975e:Disallow SSL renegotiation

  SSL renegotiation is already disabled as of 48d23c72, however this does
  not prevent the server to comply with a client willing to use
  renegotiation.  In the last couple of years, renegotiation had its set
  of security issues and flaws (like the recent CVE-2021-3449), and it
  could be possible to crash the backend with a client attempting
  renegotiation.

  This commit takes one extra step by disabling renegotiation in the
  backend in the same way as SSL compression (f9264d15) or tickets
  (97d3a0b0).  OpenSSL 1.1.0h has added an option named
  SSL_OP_NO_RENEGOTIATION able to achieve that.  In older versions
  there is an option called SSL3_FLAGS_NO_RENEGOTIATE_CIPHERS that
  was undocumented, and could be set within the SSL object created when
  the TLS connection opens, but I have decided not to use it, as it feels
  trickier to rely on, and it is not official.  Note that this option is
  not usable in OpenSSL < 1.1.0h as the internal contents of the *SSL
  object are hidden to applications.

  SSL renegotiation concerns protocols up to TLSv1.2.

  Per original report from Robert Haas, with a patch based on a suggestion
  by Andres Freund.

  Author: Michael Paquier
  Reviewed-by: Daniel Gustafsson
  Discussion: https://postgr.es/m/YKZBXx7RhU74FlTE@paquier.xyz
  Backpatch-through: 9.6
  a23c0b00f08a983216faf16c5d2e94fe963fa0d1:Disallow SSL renegotiation

  SSL renegotiation is already disabled as of 48d23c72, however this does
  not prevent the server to comply with a client willing to use
  renegotiation.  In the last couple of years, renegotiation had its set
  of security issues and flaws (like the recent CVE-2021-3449), and it
  could be possible to crash the backend with a client attempting
  renegotiation.

  This commit takes one extra step by disabling renegotiation in the
  backend in the same way as SSL compression (f9264d15) or tickets
  (97d3a0b0).  OpenSSL 1.1.0h has added an option named
  SSL_OP_NO_RENEGOTIATION able to achieve that.  In older versions
  there is an option called SSL3_FLAGS_NO_RENEGOTIATE_CIPHERS that
  was undocumented, and could be set within the SSL object created when
  the TLS connection opens, but I have decided not to use it, as it feels
  trickier to rely on, and it is not official.  Note that this option is
  not usable in OpenSSL < 1.1.0h as the internal contents of the *SSL
  object are hidden to applications.

  SSL renegotiation concerns protocols up to TLSv1.2.

  Per original report from Robert Haas, with a patch based on a suggestion
  by Andres Freund.

  Author: Michael Paquier
  Reviewed-by: Daniel Gustafsson
  Discussion: https://postgr.es/m/YKZBXx7RhU74FlTE@paquier.xyz
  Backpatch-through: 9.6
  01e6f1a842f406170e5f717305e4a6cf0e84b3ee:Disallow SSL renegotiation

  SSL renegotiation is already disabled as of 48d23c72, however this does
  not prevent the server to comply with a client willing to use
  renegotiation.  In the last couple of years, renegotiation had its set
  of security issues and flaws (like the recent CVE-2021-3449), and it
  could be possible to crash the backend with a client attempting
  renegotiation.

  This commit takes one extra step by disabling renegotiation in the
  backend in the same way as SSL compression (f9264d15) or tickets
  (97d3a0b0).  OpenSSL 1.1.0h has added an option named
  SSL_OP_NO_RENEGOTIATION able to achieve that.  In older versions
  there is an option called SSL3_FLAGS_NO_RENEGOTIATE_CIPHERS that
  was undocumented, and could be set within the SSL object created when
  the TLS connection opens, but I have decided not to use it, as it feels
  trickier to rely on, and it is not official.  Note that this option is
  not usable in OpenSSL < 1.1.0h as the internal contents of the *SSL
  object are hidden to applications.

  SSL renegotiation concerns protocols up to TLSv1.2.

  Per original report from Robert Haas, with a patch based on a suggestion
  by Andres Freund.

  Author: Michael Paquier
  Reviewed-by: Daniel Gustafsson
  Discussion: https://postgr.es/m/YKZBXx7RhU74FlTE@paquier.xyz
  Backpatch-through: 9.6
impacted_packages:
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 7777df34d7a37c40bba6e93da34bb78af48134e1
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 01e6f1a842f406170e5f717305e4a6cf0e84b3ee
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 3f8072be8a71b5bd3dc838a4ba03ccdaff2d975e
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: c64b5d10d69556635d0ee8096b5ba0bdc49e0e35
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: 96918b76fb059126f55f3099f4bcc50de1ed6150
    introduced_in_commits: []
  - purl: pkg:github/postgres/postgres
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/postgres/postgres
        commit: a23c0b00f08a983216faf16c5d2e94fe963fa0d1
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/postgres/postgres/tree/01e6f1a842f406170e5f717305e4a6cf0e84b3ee
    reference_type: commit
    reference_id: 01e6f1a842f406170e5f717305e4a6cf0e84b3ee
  - url: https://github.com/postgres/postgres/tree/3f8072be8a71b5bd3dc838a4ba03ccdaff2d975e
    reference_type: commit
    reference_id: 3f8072be8a71b5bd3dc838a4ba03ccdaff2d975e
  - url: https://github.com/postgres/postgres/tree/7777df34d7a37c40bba6e93da34bb78af48134e1
    reference_type: commit
    reference_id: 7777df34d7a37c40bba6e93da34bb78af48134e1
  - url: https://github.com/postgres/postgres/tree/96918b76fb059126f55f3099f4bcc50de1ed6150
    reference_type: commit
    reference_id: 96918b76fb059126f55f3099f4bcc50de1ed6150
  - url: https://github.com/postgres/postgres/tree/a23c0b00f08a983216faf16c5d2e94fe963fa0d1
    reference_type: commit
    reference_id: a23c0b00f08a983216faf16c5d2e94fe963fa0d1
  - url: https://github.com/postgres/postgres/tree/c64b5d10d69556635d0ee8096b5ba0bdc49e0e35
    reference_type: commit
    reference_id: c64b5d10d69556635d0ee8096b5ba0bdc49e0e35
