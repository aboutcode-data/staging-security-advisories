advisory_id: npm/@fastify/passport/CVE-2023-29020
datasource_id: gitlab_importer_v2/npm/@fastify/passport/CVE-2023-29020
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/npm/@fastify/passport/CVE-2023-29020.yml
aliases:
  - CVE-2023-29020
  - GHSA-2ccf-ffrj-m4qw
summary: |
  Session Fixation
  @fastify/passport is a port of passport authentication library for the Fastify ecosystem. The CSRF (Cross-Site Request Forger) protection enforced by the `@fastify/csrf-protection` library, when combined with `@fastify/passport` in affected versions, can be bypassed by network and same-site attackers. `fastify/csrf-protection` implements the synchronizer token pattern (using plugins `@fastify/session` and `@fastify/secure-session`) by storing a random value used for CSRF token generation in the `_csrf` attribute of a user's session. The `@fastify/passport` library does not clear the session object upon authentication, preserving the `_csrf` attribute between pre-login and authenticated sessions. Consequently, CSRF tokens generated before authentication are still valid. Network and same-site attackers can thus obtain a CSRF token for their pre-session, fixate that pre-session in the victim's browser via cookie tossing, and then perform a CSRF attack after the victim authenticates. As a solution, newer versions of `@fastify/passport` include the configuration options: `clearSessionOnLogin (default: true)` and `clearSessionIgnoreFields (default: ['passport', 'session'])` to clear all the session attributes by default, preserving those explicitly defined in `clearSessionIgnoreFields`.
impacted_packages:
  - purl: pkg:npm/%40fastify/passport
    affected_versions: vers:npm/<1.1.0|>=2.0.0|<2.3.0
    fixed_versions: vers:npm/1.1.0|2.3.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score:
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:H/A:N
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/npm/@fastify/passport/CVE-2023-29020.yml
weaknesses:
  - CWE-352
  - CWE-384
  - CWE-1035
  - CWE-937
references:
  - url: https://github.com/fastify/fastify-passport/security/advisories/GHSA-2ccf-ffrj-m4qw
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-2ccf-ffrj-m4qw
    reference_type:
    reference_id: GHSA-2ccf-ffrj-m4qw
