advisory_id: npm/@fastify/csrf-protection/CVE-2023-27495
datasource_id: gitlab_importer_v2/npm/@fastify/csrf-protection/CVE-2023-27495
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/npm/@fastify/csrf-protection/CVE-2023-27495.yml
aliases:
  - CVE-2023-27495
  - GHSA-qrgf-9gpc-vrxw
summary: |
  Cross-Site Request Forgery (CSRF)
  @fastify/csrf-protection is a plugin which helps protect Fastify servers against CSRF attacks. The CSRF protection enforced by the @fastify/csrf-protection library in combination with @fastify/cookie can be bypassed from network and same-site attackers under certain conditions. @fastify/csrf-protection supports an optional userInfo parameter that binds the CSRF token to the user. This parameter has been introduced to prevent cookie-tossing attacks as a fix for CVE-2021-29624. Whenever userInfo parameter is missing, or its value can be predicted for the target user account, network and same-site attackers can 1. fixate a _csrf cookie in the victim's browser, and 2. forge CSRF tokens that are valid for the victim's session. This allows attackers to bypass the CSRF protection mechanism. As a fix, @fastify/csrf-protection starting from version 6.3.0 (and v4.1.0) includes a server-defined secret hmacKey that cryptographically binds the CSRF token to the value of the _csrf cookie and the userInfo parameter, making tokens non-spoofable by attackers. This protection is effective as long as the userInfo parameter is unique for each user. This is patched in versions 6.3.0 and v4.1.0. Users are advised to upgrade. Users unable to upgrade may use a random, non-predictable userInfo parameter for each user as a mitigation.
impacted_packages:
  - purl: pkg:npm/%40fastify/csrf-protection
    affected_versions: vers:npm/<4.1.0|>=5.0.0|<6.3.0
    fixed_versions: vers:npm/4.1.0|6.3.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score:
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:H/A:N
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/npm/@fastify/csrf-protection/CVE-2023-27495.yml
weaknesses:
  - CWE-352
  - CWE-1035
  - CWE-937
references:
  - url: https://github.com/fastify/csrf-protection/commit/be3e5761f37aa05c7c1ac8ed44499c51ecec8058
    reference_type:
    reference_id:
  - url: https://github.com/fastify/csrf-protection/releases/tag/v4.1.0
    reference_type:
    reference_id:
  - url: https://github.com/fastify/csrf-protection/releases/tag/v6.3.0
    reference_type:
    reference_id:
  - url: https://github.com/fastify/csrf-protection/security/advisories/GHSA-qrgf-9gpc-vrxw
    reference_type:
    reference_id:
  - url: https://github.com/fastify/csrf-protection/security/advisories/GHSA-rc4q-9m69-gqp8
    reference_type:
    reference_id:
  - url: https://www.cvedetails.com/cve/CVE-2021-29624
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-27495
    reference_type:
    reference_id: CVE-2023-27495
  - url: https://github.com/advisories/GHSA-qrgf-9gpc-vrxw
    reference_type:
    reference_id: GHSA-qrgf-9gpc-vrxw
