advisory_id: npm/@fastify/secure-session/CVE-2024-31999
datasource_id: gitlab_importer_v2/npm/@fastify/secure-session/CVE-2024-31999
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/npm/@fastify/secure-session/CVE-2024-31999.yml
aliases:
  - CVE-2024-31999
  - GHSA-9wwp-q7wq-jx35
summary: |
  @fastify/secure-session: Reuse of destroyed secure session cookie
  At the end of the request handling, it will encrypt all data in the session with a secret key and attach the ciphertext as a cookie value with the defined cookie name. After that, the session on the server side is destroyed. When an encrypted cookie with matching session name is provided with subsequent requests, it will decrypt the ciphertext to get the data. The plugin then creates a new session with the data in the ciphertext. Thus theoretically the web instance is still accessing the data from a server-side session, but technically that session is generated solely from a user provided cookie (which is assumed to be non-craftable because it is encrypted with a secret key not known to the user).

  The issue exists in the session removal process. In the delete function of the code, when the session is deleted, it is marked for deletion. However, if an attacker could gain access to the cookie, they could keep using it forever.
impacted_packages:
  - purl: pkg:npm/%40fastify/secure-session
    affected_versions: vers:npm/<7.3.0
    fixed_versions: vers:npm/7.3.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score:
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:H/I:N/A:N
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/npm/@fastify/secure-session/CVE-2024-31999.yml
weaknesses:
  - CWE-1035
  - CWE-613
  - CWE-937
references:
  - url: https://github.com/fastify/fastify-secure-session
    reference_type:
    reference_id:
  - url: https://github.com/fastify/fastify-secure-session/commit/56d66642ecc633cff0606927601e81cdac361370
    reference_type:
    reference_id:
  - url: https://github.com/fastify/fastify-secure-session/security/advisories/GHSA-9wwp-q7wq-jx35
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-31999
    reference_type:
    reference_id: CVE-2024-31999
  - url: https://github.com/advisories/GHSA-9wwp-q7wq-jx35
    reference_type:
    reference_id: GHSA-9wwp-q7wq-jx35
