advisory_id: npm/fast-xml-parser/GMS-2023-1884
datasource_id: gitlab_importer_v2/npm/fast-xml-parser/GMS-2023-1884
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/npm/fast-xml-parser/GMS-2023-1884.yml
aliases:
  - GHSA-gpv5-7x3g-ghjv
  - GMS-2023-1884
summary: |
  fast-xml-parser regex vulnerability patch could be improved from a safety perspective
  ### Summary
  This is a comment on https://github.com/NaturalIntelligence/fast-xml-parser/security/advisories/GHSA-6w63-h3fj-q4vw and the patches fixing it.

  ### Details
  The code which validates a name calls the validator:
   https://github.com/NaturalIntelligence/fast-xml-parser/blob/ecf6016f9b48aec1a921e673158be0773d07283e/src/xmlparser/DocTypeReader.js#L145-L153
  This checks for the presence of an invalid character. Such an approach is always risky, as it is so easy to forget to include an invalid character in the list. A safer approach is to validate entity names against the XML specification: https://www.w3.org/TR/xml11/#sec-common-syn - an ENTITY name is a Name:

  ```
  [4]  NameStartChar ::= ":" | [A-Z] | "_" | [a-z] | [#xC0-#xD6] | [#xD8-#xF6] | [#xF8-#x2FF] | [#x370-#x37D] |
   [#x37F-#x1FFF] | [#x200C-#x200D] | [#x2070-#x218F] | [#x2C00-#x2FEF] | [#x3001-#xD7FF] |
   [#xF900-#xFDCF] | [#xFDF0-#xFFFD] | [#x10000-#xEFFFF]
  [4a] NameChar ::= NameStartChar | "-" | "." | [0-9] | #xB7 | [#x0300-#x036F] | [#x203F-#x2040]
  [5]  Name ::= NameStartChar (NameChar)*
  ```

  so the safest way to validate an entity name is to build a regex to represent this expression and check whether the name given matches the regex. (Something along the lines of `/^[name start char class][name char class]*$/`.) There's probably a nice way to simplify the explicit list rather than typing it out verbatim using Unicode character properties, but I don't know enough to do so.
impacted_packages:
  - purl: pkg:npm/fast-xml-parser
    affected_versions: vers:npm/4.2.4
    fixed_versions: vers:npm/4.2.5
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses:
  - CWE-1035
  - CWE-937
references:
  - url: https://github.com/NaturalIntelligence/fast-xml-parser/commit/9a880b887916855c3a510869fd1ee268d7fe58b1
    reference_type:
    reference_id:
  - url: https://github.com/NaturalIntelligence/fast-xml-parser/security/advisories/GHSA-6w63-h3fj-q4vw
    reference_type:
    reference_id:
  - url: https://github.com/NaturalIntelligence/fast-xml-parser/security/advisories/GHSA-gpv5-7x3g-ghjv
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-gpv5-7x3g-ghjv
    reference_type:
    reference_id: GHSA-gpv5-7x3g-ghjv
