advisory_id: npm/@apollo/gateway/CVE-2024-43414
datasource_id: gitlab_importer_v2/npm/@apollo/gateway/CVE-2024-43414
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/npm/@apollo/gateway/CVE-2024-43414.yml
aliases:
  - CVE-2024-43414
  - GHSA-fmj9-77q8-g6c4
summary: |
  Apollo Query Planner and Apollo Gateway may infinitely loop on sufficiently complex queries
  Instances of @apollo/query-planner >=2.0.0 and <2.8.5 are impacted by a denial-of-service vulnerability. @apollo/gateway versions >=2.0.0 and < 2.8.5 and Apollo Router <1.52.1 are also impacted through their use of @apollo/query-planner.

  If @apollo/query-planner is asked to plan a sufficiently complex query, it may loop infinitely and never complete. This results in unbounded memory consumption and either a crash or out-of-memory (OOM) termination.

  This issue can be triggered if you have at least one non-`@key` field that can be resolved by multiple subgraphs. To identify these shared fields, the schema for each subgraph must be reviewed. The mechanism to identify shared fields varies based on the version of Federation your subgraphs are using.

  You can check if your subgraphs are using Federation 1 or Federation 2 by reviewing their schemas. Federation 2 subgraph schemas will contain a `@link` directive referencing the version of Federation being used while Federation 1 subgraphs will not. For example, in a Federation 2 subgraph, you will find a line like `@link(url: "https://specs.apollo.dev/federation/v2.0")`. If a similar `@link` directive is not present in your subgraph schema, it is using Federation 1. Note that a supergraph can contain a mix of Federation 1 and Federation 2 subgraphs.

  **To review Federation 1 subgraphs for impact:**

  In Federation 1 subgraphs, fields are implicitly shareable across subgraphs. To review for impact, you will need to review for cases where multiple subgraphs can resolve the same field. For example:

  ```graphql
impacted_packages:
  - purl: pkg:npm/%40apollo/gateway
    affected_versions: vers:npm/>=2.0.0|<2.8.5
    fixed_versions: vers:npm/2.8.5
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score:
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/npm/@apollo/gateway/CVE-2024-43414.yml
weaknesses:
  - CWE-937
  - CWE-673
  - CWE-1035
  - CWE-674
references:
  - url: https://github.com/apollographql/federation
    reference_type:
    reference_id:
  - url: https://github.com/apollographql/federation/security/advisories/GHSA-fmj9-77q8-g6c4
    reference_type:
    reference_id:
  - url: https://github.com/apollographql/router/commit/e309c9bb5a48c1304ff69c88b7eabdd08c26bf45
    reference_type:
    reference_id:
  - url: https://www.apollographql.com/docs/federation/query-plans
    reference_type:
    reference_id:
  - url: https://www.apollographql.com/docs/router/configuration/persisted-queries
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-43414
    reference_type:
    reference_id: CVE-2024-43414
  - url: https://github.com/advisories/GHSA-fmj9-77q8-g6c4
    reference_type:
    reference_id: GHSA-fmj9-77q8-g6c4
