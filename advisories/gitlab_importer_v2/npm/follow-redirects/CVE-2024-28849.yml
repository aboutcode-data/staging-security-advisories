advisory_id: npm/follow-redirects/CVE-2024-28849
datasource_id: gitlab_importer_v2/npm/follow-redirects/CVE-2024-28849
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/npm/follow-redirects/CVE-2024-28849.yml
aliases:
  - CVE-2024-28849
  - GHSA-cxjh-pqwp-8mfp
summary: |
  follow-redirects' Proxy-Authorization header kept across hosts
  When using axios, its dependency library follow-redirects only clears authorization header during cross-domain redirect, but allows the proxy-authentication header which contains credentials too.

  Steps To Reproduce & PoC

  axios Test Code

  const axios = require('axios');

  axios.get('http://127.0.0.1:10081/',{
      headers: {
          'AuThorization': 'Rear Test',
          'ProXy-AuthoriZation': 'Rear Test',
          'coOkie': 't=1'
      }
      }).then(function (response) {
          console.log(response);
  })
  When I meet the cross-domain redirect, the sensitive headers like authorization and cookie are cleared, but proxy-authentication header is kept.

  Request sent by axios

  image-20240314130755052.png
  Request sent by follow-redirects after redirectimage-20240314130809838.png

  Impact

  This vulnerability may lead to credentials leak.

  Recommendations

  Remove proxy-authentication header during cross-domain redirect
  Recommended Patch

  follow-redirects/index.js:464

  removeMatchingHeaders(/^(?:authorization|cookie)$/i, this._options.headers);
  change to

  removeMatchingHeaders(/^(?:authorization|proxy-authorization|cookie)$/i, this._options.headers);
  Ref

  https://fetch.spec.whatwg.org/#authentication-entries
  https://hackerone.com/reports/2390009
impacted_packages:
  - purl: pkg:npm/follow-redirects
    affected_versions: vers:npm/<1.15.6
    fixed_versions: vers:npm/1.15.6
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score:
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/npm/follow-redirects/CVE-2024-28849.yml
weaknesses:
  - CWE-200
  - CWE-1035
  - CWE-937
references:
  - url: https://fetch.spec.whatwg.org/#authentication-entries
    reference_type:
    reference_id:
  - url: https://github.com/follow-redirects/follow-redirects
    reference_type:
    reference_id:
  - url: https://github.com/follow-redirects/follow-redirects/commit/c4f847f85176991f95ab9c88af63b1294de8649b
    reference_type:
    reference_id:
  - url: https://github.com/follow-redirects/follow-redirects/security/advisories/GHSA-cxjh-pqwp-8mfp
    reference_type:
    reference_id:
  - url: https://github.com/psf/requests/issues/1885
    reference_type:
    reference_id:
  - url: https://hackerone.com/reports/2390009
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-28849
    reference_type:
    reference_id: CVE-2024-28849
  - url: https://github.com/advisories/GHSA-cxjh-pqwp-8mfp
    reference_type:
    reference_id: GHSA-cxjh-pqwp-8mfp
