advisory_id: npm/@openzeppelin/contracts-upgradeable/CVE-2023-34459
datasource_id: gitlab_importer_v2/npm/@openzeppelin/contracts-upgradeable/CVE-2023-34459
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/npm/@openzeppelin/contracts-upgradeable/CVE-2023-34459.yml
aliases:
  - CVE-2023-34459
  - GHSA-wprv-93r4-jj2p
summary: |
  Improper Validation of Integrity Check Value
  OpenZeppelin Contracts is a library for smart contract development. Starting in version 4.7.0 and prior to version 4.9.2, when the `verifyMultiProof`, `verifyMultiProofCalldata`, `procesprocessMultiProof`, or `processMultiProofCalldat` functions are in use, it is possible to construct merkle trees that allow forging a valid multiproof for an arbitrary set of leaves.

  A contract may be vulnerable if it uses multiproofs for verification and the merkle tree that is processed includes a node with value 0 at depth 1 (just under the root). This could happen inadvertedly for balanced trees with 3 leaves or less, if the leaves are not hashed. This could happen deliberately if a malicious tree builder includes such a node in the tree.

  A contract is not vulnerable if it uses single-leaf proving (`verify`, `verifyCalldata`, `processProof`, or `processProofCalldata`), or if it uses multiproofs with a known tree that has hashed leaves. Standard merkle trees produced or validated with the @openzeppelin/merkle-tree library are safe.

  The problem has been patched in version 4.9.2.

  Some workarounds are available. For those using multiproofs: When constructing merkle trees hash the leaves and do not insert empty nodes in your trees. Using the @openzeppelin/merkle-tree package eliminates this issue. Do not accept user-provided merkle roots without reconstructing at least the first level of the tree. Verify the merkle tree structure by reconstructing it from the leaves.
impacted_packages:
  - purl: pkg:npm/%40openzeppelin/contracts-upgradeable
    affected_versions: vers:npm/>=4.7.0|<4.9.2
    fixed_versions: vers:npm/4.9.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score:
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:H/A:N
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/npm/@openzeppelin/contracts-upgradeable/CVE-2023-34459.yml
weaknesses:
  - CWE-354
  - CWE-1035
  - CWE-937
references:
  - url: https://github.com/OpenZeppelin/openzeppelin-contracts/commit/4d2383e17186be3e8ccf5a442e9686ecc7de1c55
    reference_type:
    reference_id:
  - url: https://github.com/OpenZeppelin/openzeppelin-contracts/releases/tag/v4.9.2
    reference_type:
    reference_id:
  - url: https://github.com/OpenZeppelin/openzeppelin-contracts/security/advisories/GHSA-wprv-93r4-jj2p
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-34459
    reference_type:
    reference_id: CVE-2023-34459
  - url: https://github.com/advisories/GHSA-wprv-93r4-jj2p
    reference_type:
    reference_id: GHSA-wprv-93r4-jj2p
