advisory_id: packagist/phenx/php-svg-lib/GHSA-97m3-52wr-xvv2
datasource_id: gitlab_importer_v2/packagist/phenx/php-svg-lib/GHSA-97m3-52wr-xvv2
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/packagist/phenx/php-svg-lib/GHSA-97m3-52wr-xvv2.yml
aliases:
  - GHSA-97m3-52wr-xvv2
summary: "Dompdf's usage of vulnerable version of phenx/php-svg-lib leads to restriction bypass\
  \ and potential RCE\n### Summary\nA lack of sanitization/check in the font path returned by\
  \ php-svg-lib, in the case of a inline CSS font defined, that will be used by Cpdf to open\
  \ a font will be passed to a `file_exists` call, which is sufficient to trigger metadata unserializing\
  \ on a PHAR file, through the phar:// URL handler on PHP < 8.0. On other versions, it might\
  \ be used as a way to get a SSRF through, for example, ftp, not restricted by authorized protocols\
  \ configured on dompdf.\n\n### Details\nThe problem lies on the `openFont` function of the\
  \ `lib/Cpdf.php` library, when the `$font` variable passed by php-svg-lib isn't checked correctly.\
  \ A path is crafted through $name and $dir, which are two values that can be controlled through\
  \ CSS : \n\n```\n$name = basename($font);\n$dir = dirname($font);\n[...]\n$metrics_name =\
  \ \"$name.ufm\";\n[...]\n\nif (!isset($this->fonts[$font]) && file_exists(\"$dir/$metrics_name\"\
  )) {\n```\n\nPassing a font named `phar:///foo/bar/baz.phar/test` will set the value of $name\
  \ to `test` and $dir to `phar:///foo/bar/baz.phar`, which once reconstructed will call file_exists\
  \ on `phar:///foo/bar/baz.phar/test.ufm`. That allows to deserialize the `baz.phar` arbitrary\
  \ file that contains a `test.ufm` file in the archive."
impacted_packages:
  - purl: pkg:composer/phenx/php-svg-lib
    affected_versions: vers:composer/<0.5.2
    fixed_versions: vers:composer/0.5.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score:
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/packagist/phenx/php-svg-lib/GHSA-97m3-52wr-xvv2.yml
weaknesses:
  - CWE-937
  - CWE-1035
  - CWE-502
  - CWE-73
references:
  - url: https://github.com/dompdf/dompdf
    reference_type:
    reference_id:
  - url: https://github.com/dompdf/dompdf/security/advisories/GHSA-97m3-52wr-xvv2
    reference_type:
    reference_id:
  - url: https://github.com/dompdf/php-svg-lib/commit/732faa9fb4309221e2bd9b2fda5de44f947133aa
    reference_type:
    reference_id:
  - url: https://github.com/dompdf/php-svg-lib/security/advisories/GHSA-f3qr-qr4x-j273
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-97m3-52wr-xvv2
    reference_type:
    reference_id: GHSA-97m3-52wr-xvv2
