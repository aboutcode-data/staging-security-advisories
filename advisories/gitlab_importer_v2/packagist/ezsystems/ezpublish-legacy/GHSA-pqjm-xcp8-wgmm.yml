advisory_id: packagist/ezsystems/ezpublish-legacy/GHSA-pqjm-xcp8-wgmm
datasource_id: gitlab_importer_v2/packagist/ezsystems/ezpublish-legacy/GHSA-pqjm-xcp8-wgmm
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/packagist/ezsystems/ezpublish-legacy/GHSA-pqjm-xcp8-wgmm.yml
aliases:
  - GHSA-pqjm-xcp8-wgmm
summary: |
  Ez Platform and Legacy are prone to an insecure interpretation of PHP/PHAR uploads
  The eZ Platform and Legacy are affected by an issue related to how uploaded PHP and PHAR files are handled, and consists of two parts: 1. Web server configuration, and 2. Disabling the PHAR stream wrapper.

  **1. WEB SERVER CONFIGURATION**
  The sample web server configuration in our documentation can in some cases allow the execution of uploaded PHP/PHAR code. This can be abused to allow priviledge escalation and breach of content access controls, among other things. Please ensure that your web server will not execute files in directories were files may be uploaded, such as web/var/ and ezpublish_legacy/var/

  As an example, here is how you can make Apache return HTTP 403 Forbidden for a number of executable file types in your eZ Platform var directory. Please adapt it to your needs. It is then possible to enable logging of HTTP 403 in a separate log file if you wish, you could do this to see if someone is trying to abuse the server.
  ```
  RewriteEngine On
impacted_packages:
  - purl: pkg:composer/ezsystems/ezpublish-legacy
    affected_versions: vers:composer/>=5.3.0|<5.3.12+6|>=5.4.0|<5.4.12+3|>=2011.0.0|<2017.12.4+3|>=2018.6.0|<2018.6.1+4|>=2018.9.0|<2018.9.1+3
    fixed_versions: vers:composer/5.3.12+6|5.4.12+3|2017.12.4+3|2018.6.1+4|2018.9.1+3
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses:
  - CWE-1035
  - CWE-937
  - CWE-94
references:
  - url: https://github.com/ezsystems/ezplatform/commit/9a0c52dc4535e4b3ce379f80222dc53f705a2cfd
    reference_type:
    reference_id:
  - url: https://github.com/ezsystems/ezpublish-legacy
    reference_type:
    reference_id:
  - url: https://github.com/ezsystems/ezpublish-legacy/commit/d21957bf202b091ab39dfb5be300f6c30be3933e
    reference_type:
    reference_id:
  - url: https://github.com/FriendsOfPHP/security-advisories/blob/master/ezsystems/ezpublish-legacy/2018-11-21-1.yaml
    reference_type:
    reference_id:
  - url: https://web.archive.org/web/20210614192208/https://share.ez.no/community-project/security-advisories/ezsa-2018-009-do-not-interpret-php-phar-uploads
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-pqjm-xcp8-wgmm
    reference_type:
    reference_id: GHSA-pqjm-xcp8-wgmm
