advisory_id: packagist/simplesamlphp/simplesamlphp/GHSA-7wh8-jrq7-p27f
datasource_id: gitlab_importer_v2/packagist/simplesamlphp/simplesamlphp/GHSA-7wh8-jrq7-p27f
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/packagist/simplesamlphp/simplesamlphp/GHSA-7wh8-jrq7-p27f.yml
aliases:
  - GHSA-7wh8-jrq7-p27f
summary: |
  SimpleSAMLphp exposes credentials in session storage
  When an authentication request is received via the ECP profile, the username and password obtained this way were saved to the state array, which is used to pass relevant data to different routines that may need it. This is not a problem in itself. However, when the ECP profile is disabled in the Identity Provider, other bindings such as HTTP-POST or HTTP-Redirect will be used, and since redirections are involved, the state array is then persisted to the user’s session, effectively storing it in the session backend.

  The ECP profile, which uses the SOAP and PAOS bindings, does not involve any HTTP redirection for the user, and for that reason the state array containing the credentials is never persisted to the session. The logic for determining when to save the credentials to the state array assumed wrongly, though, that if the authentication request came in on the SOAP binding, that means the ECP profile is used. This may not be true as ECP can be disabled by configuration in the IdP’s hosted SAML metadata, and in that case SimpleSAMLphp would then try to default to a binding different than PAOS, such as HTTP-POST or HTTP-Redirect, effectively consolidating the entire state array to the user’s session as described before.

  In practice, any Identity Provider with the ECP profile disabled but metadata for an entity that supports ECP, would reject incoming ECP requests, but write the credentials obtained in the request to the user’s session, which will be stored in the session store, whichever is used (local file system in case PHP sessions are used, Memcache, Redis, relational databases, etc).
impacted_packages:
  - purl: pkg:composer/simplesamlphp/simplesamlphp
    affected_versions: vers:composer/>=1.16.0|<1.16.3
    fixed_versions: vers:composer/1.16.3
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score:
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/packagist/simplesamlphp/simplesamlphp/GHSA-7wh8-jrq7-p27f.yml
weaknesses:
  - CWE-522
  - CWE-1035
  - CWE-937
references:
  - url: https://github.com/FriendsOfPHP/security-advisories/blob/master/simplesamlphp/simplesamlphp/2018-12-20.yaml
    reference_type:
    reference_id:
  - url: https://github.com/simplesamlphp/simplesamlphp
    reference_type:
    reference_id:
  - url: https://github.com/simplesamlphp/simplesamlphp/commit/44d1e3052930d93f0f554c25bc7c7602f8136880
    reference_type:
    reference_id:
  - url: https://simplesamlphp.org/security/201812-01
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-7wh8-jrq7-p27f
    reference_type:
    reference_id: GHSA-7wh8-jrq7-p27f
