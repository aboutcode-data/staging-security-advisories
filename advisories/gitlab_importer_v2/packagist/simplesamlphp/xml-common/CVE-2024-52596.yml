advisory_id: packagist/simplesamlphp/xml-common/CVE-2024-52596
datasource_id: gitlab_importer_v2/packagist/simplesamlphp/xml-common/CVE-2024-52596
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/packagist/simplesamlphp/xml-common/CVE-2024-52596.yml
aliases:
  - CVE-2024-52596
  - GHSA-2x65-fpch-2fcm
summary: |
  SimpleSAMLphp xml-common XXE vulnerability
  Summary

  When loading an (untrusted) XML document, for example the SAMLResponse, it's possible to induce an XXE.

  $options is defined as: https://github.com/simplesamlphp/xml-common/blob/v1.19.0/src/DOMDocumentFactory.php#L39
  including the DTDLoad option, which allows an attacker to read file contents from local file system OR internal network.

  While there is the NONET option, an attacker can simply bypass if by using PHP filters:
  php://filter/convert.base64-encode/resource=http://URL OR FILE

  From there an attacker can induce network connections and steal the targeted file OOB (haven't fully tested this).

  RCE may be possible with the php://expect or php://phar wrappers, but this hasn't been tested.

  Note:
  The mitigation here:
  https://github.com/simplesamlphp/xml-common/blob/v1.19.0/src/DOMDocumentFactory.php#L58
  Comes too late, as the XML has already been loaded into a document.
  Mitigation:

  Remove the LIBXML_DTDLOAD | LIBXML_DTDATTR options.
  Additionally, as a defense in depth measure, check if there is the string: <!DOCTYPE inside the XML before parsing it. (This is not a complete fix because someone may be able to exploit some parser differentials, to load a DOCTYPE, maybe through spacing like: <! DOCTYPE)
impacted_packages:
  - purl: pkg:composer/simplesamlphp/xml-common
    affected_versions: vers:composer/<1.20.0
    fixed_versions: vers:composer/1.20.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score:
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:L/A:H
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/packagist/simplesamlphp/xml-common/CVE-2024-52596.yml
weaknesses:
  - CWE-611
  - CWE-1035
  - CWE-937
references:
  - url: https://github.com/simplesamlphp/xml-common
    reference_type:
    reference_id:
  - url: https://github.com/simplesamlphp/xml-common/commit/fa4ade391c3194466acf5fbfd5d2ecdbf5e831f5
    reference_type:
    reference_id:
  - url: https://github.com/simplesamlphp/xml-common/security/advisories/GHSA-2x65-fpch-2fcm
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2024/12/msg00001.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-52596
    reference_type:
    reference_id: CVE-2024-52596
  - url: https://github.com/advisories/GHSA-2x65-fpch-2fcm
    reference_type:
    reference_id: GHSA-2x65-fpch-2fcm
