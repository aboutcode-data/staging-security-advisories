advisory_id: pypi/tensorflow/CVE-2021-37690
datasource_id: gitlab_importer_v2/pypi/tensorflow/CVE-2021-37690
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/pypi/tensorflow/CVE-2021-37690.yml
aliases:
  - CVE-2021-37690
  - GHSA-3hxh-8cp2-g4hg
summary: |
  Use after free and segfault in shape inference functions
  When running shape functions, some functions (such as `MutableHashTableShape`) produce extra output information in the form of a `ShapeAndType` struct. The shapes embedded in this struct are owned by an inference context that is cleaned up almost immediately; if the upstream code attempts to access this shape information, it can trigger a segfault.

  `ShapeRefiner` is mitigating this for normal output shapes by cloning them (and thus putting the newly created shape under ownership of an inference context that will not die), but we were not doing the same for shapes and types. This commit fixes that by doing similar logic on output shapes and types.
impacted_packages:
  - purl: pkg:pypi/tensorflow
    affected_versions: vers:pypi/<2.3.4|>=2.4.0|<2.4.3|2.5.0|>=2.5.0|<2.5.1
    fixed_versions: vers:pypi/2.3.4|2.4.3|2.5.1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score:
    scoring_system: cvssv2
    scoring_elements: AV:L/AC:L/Au:N/C:P/I:P/A:P
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/pypi/tensorflow/CVE-2021-37690.yml
  - score:
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:H
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/pypi/tensorflow/CVE-2021-37690.yml
weaknesses:
  - CWE-416
  - CWE-1035
  - CWE-937
references:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/tensorflow-cpu/PYSEC-2021-603.yaml
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/tensorflow-gpu/PYSEC-2021-801.yaml
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/tensorflow/PYSEC-2021-312.yaml
    reference_type:
    reference_id:
  - url: https://github.com/tensorflow/tensorflow
    reference_type:
    reference_id:
  - url: https://github.com/tensorflow/tensorflow/commit/ee119d4a498979525046fba1c3dd3f13a039fbb1
    reference_type:
    reference_id:
  - url: https://github.com/tensorflow/tensorflow/security/advisories/GHSA-3hxh-8cp2-g4hg
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-37690
    reference_type:
    reference_id: CVE-2021-37690
  - url: https://github.com/advisories/GHSA-3hxh-8cp2-g4hg
    reference_type:
    reference_id: GHSA-3hxh-8cp2-g4hg
