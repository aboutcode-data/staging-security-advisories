advisory_id: pypi/scrapy/GMS-2024-288
datasource_id: gitlab_importer_v2/pypi/scrapy/GMS-2024-288
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/pypi/scrapy/GMS-2024-288.yml
aliases:
  - GHSA-cw9j-q3vf-hrrv
  - GMS-2024-288
summary: |
  Scrapy authorization header leakage on cross-domain redirect
  ### Impact

  When you send a request with the `Authorization` header to one domain, and the response asks to redirect to a different domain, Scrapyâ€™s built-in redirect middleware creates a follow-up redirect request that keeps the original `Authorization` header, leaking its content to that second domain.

  The [right behavior](https://fetch.spec.whatwg.org/#ref-for-cors-non-wildcard-request-header-name) would be to drop the `Authorization` header instead, in this scenario.

  ### Patches

  Upgrade to Scrapy 2.11.1.

  If you are using Scrapy 1.8 or a lower version, and upgrading to Scrapy 2.11.1 is not an option, you may upgrade to Scrapy 1.8.4 instead.

  ### Workarounds

  If you cannot upgrade, make sure that you are not using the `Authentication` header, either directly or through some third-party plugin.

  If you need to use that header in some requests, add `"dont_redirect": True` to the `request.meta` dictionary of those requests to disable following redirects for them.

  If you need to keep (same domain) redirect support on those requests, make sure you trust the target website not to redirect your requests to a different domain.

  ### Acknowledgements

  This security issue was reported by @ranjit-git [through huntr.com](https://huntr.com/bounties/49974321-2718-43e3-a152-62b16eed72a9/).
impacted_packages:
  - purl: pkg:pypi/scrapy
    affected_versions: vers:pypi/<1.8.4|>=2|<2.11.1
    fixed_versions: vers:pypi/1.8.4|2.11.1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses:
  - CWE-1035
  - CWE-937
references:
  - url: https://github.com/advisories/GHSA-cw9j-q3vf-hrrv
    reference_type:
    reference_id:
  - url: https://github.com/scrapy/scrapy/commit/ee7bd9d217fc126063575d5649f00bdeeca2faae
    reference_type:
    reference_id:
  - url: https://github.com/scrapy/scrapy/security/advisories/GHSA-cw9j-q3vf-hrrv
    reference_type:
    reference_id:
