advisory_id: pypi/commonground-api-common/GMS-2024-208
datasource_id: gitlab_importer_v2/pypi/commonground-api-common/GMS-2024-208
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/pypi/commonground-api-common/GMS-2024-208.yml
aliases:
  - GHSA-c4cm-r9fh-jgj9
  - GMS-2024-208
summary: |
  commonground-api-common unexploitable privilege escalation in JWT authentication middleware
  ### Impact

  This is a privilege escalation vulnerability. The impact is negligible and entirely theoretical.

  A non-exploitable weakness was found in how the client-supplied JWTs are verified. Because an explicit allow-list
  of known algorithms is used in the PyJWT library, user-supplied (invalid) algorithms are rejected.

  If this was not the case, then the client JWTs could be tampered with, resulting in privilege escalation which
  would allow the attacker to perform any operation as any client (impersonation) without leaving a trace of
  the real user/client.


  ### Patches

  Will be fixed in 1.12.2

  ### Workarounds

  None needed. But be careful when updating PyJWT. Check that the used PyJWT has no algorithms specified with a name in "", "HS25", "HS2", "HS", "H", or that those algorithms are acceptable.

  ### Details

  The header and payload of JSON Web Tokens (JWTs) are cryptographically signed with an algorithm. A JWT has a header field `alg` that specifies the algorithm used in the signature.

  The `vng-api-common.middleware.AuthMiddleware` uses PyJWT to check the validity of JWT and indicates it should be "HS256", otherwise an attacker could construct a token with a cryptographically weak token. It should indicate this with a list of acceptable algorithms `["HS256"]`, but instead the string `"HS256"` is passed to PyJWT. PyJWT does not check the type of the argument and checks if the `alg` string in the header exists in the acceptable algorithms value with the `in` operator. Any substring of `"HS256"` passes this `in` check. It is not exploitable because there is no such substring in de set of algorithms PyJWT supports.
impacted_packages:
  - purl: pkg:pypi/commonground-api-common
    affected_versions: vers:pypi/<=1.12.1
    fixed_versions: vers:pypi/
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses:
  - CWE-1035
  - CWE-937
references:
  - url: https://github.com/maykinmedia/commonground-api-common/commit/20d9345a865338777839e8f02c21cd9d6f5a2cae
    reference_type:
    reference_id:
  - url: https://github.com/maykinmedia/commonground-api-common/security/advisories/GHSA-c4cm-r9fh-jgj9
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-c4cm-r9fh-jgj9
    reference_type:
    reference_id: GHSA-c4cm-r9fh-jgj9
