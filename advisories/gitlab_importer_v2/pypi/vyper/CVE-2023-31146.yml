advisory_id: pypi/vyper/CVE-2023-31146
datasource_id: gitlab_importer_v2/pypi/vyper/CVE-2023-31146
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/pypi/vyper/CVE-2023-31146.yml
aliases:
  - CVE-2023-31146
  - GHSA-3p37-3636-q8wv
summary: |
  Vyper vulnerable to OOB DynArray access when array is on both LHS and RHS of an assignment
  during codegen, the length word of a dynarray is written before the data, which can result in OOB array access in the case where the dynarray is on both the lhs and rhs of an assignment. here is a minimal example producing the issue:
  ```vyper
  a:DynArray[uint256,3]
  @external
  def test() -> DynArray[uint256,3]:
  self.a = [1,2,3]
  self.a = empty(DynArray[uint256,3])
  self.a = [self.a[0],self.a[1],self.a[2]]
  return self.a # return [1,2,3]
  ```

  and here is an example demonstrating the issue can cause data corruption across call frames:

  ```vyper
  @external
  def test() -> DynArray[uint256,3]:
  self.a()
  return self.b() # return [1,2,3]

  @internal
  def a():
  a: uint256 = 0
  b: uint256 = 1
  c: uint256 = 2
  d: uint256 = 3

  @internal
  def b() -> DynArray[uint256,3]:
  a: DynArray[uint256,3] = empty(DynArray[uint256,3])
  a = [a[0],a[1],a[2]]
  return a
  ```

  examples involving append and pop:
  ```vyper
  @internal
  def foo():
  c: DynArray[uint256, 1] = []
  c.append(c[0])
  ```

  ```vyper
  @internal
  def foo():
  c: DynArray[uint256, 1] = [1]
  c[0] = c.pop()
  ```

  the expected behavior in all of the above cases is to revert due to oob array access.
impacted_packages:
  - purl: pkg:pypi/vyper
    affected_versions: vers:pypi/<0.3.8
    fixed_versions: vers:pypi/0.3.8
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score:
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:H
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/pypi/vyper/CVE-2023-31146.yml
weaknesses:
  - CWE-787
  - CWE-1035
  - CWE-937
references:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/vyper/PYSEC-2023-77.yaml
    reference_type:
    reference_id:
  - url: https://github.com/vyperlang/vyper
    reference_type:
    reference_id:
  - url: https://github.com/vyperlang/vyper/commit/4f8289a81206f767df1900ac48f485d90fc87edb
    reference_type:
    reference_id:
  - url: https://github.com/vyperlang/vyper/security/advisories/GHSA-3p37-3636-q8wv
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-31146
    reference_type:
    reference_id: CVE-2023-31146
  - url: https://github.com/advisories/GHSA-3p37-3636-q8wv
    reference_type:
    reference_id: GHSA-3p37-3636-q8wv
