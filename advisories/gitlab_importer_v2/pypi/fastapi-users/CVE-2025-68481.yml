advisory_id: pypi/fastapi-users/CVE-2025-68481
datasource_id: gitlab_importer_v2/pypi/fastapi-users/CVE-2025-68481
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/pypi/fastapi-users/CVE-2025-68481.yml
aliases:
  - CVE-2025-68481
  - GHSA-5j53-63w8-8625
summary: |
  FastAPI Users Vulnerable to 1-click Account Takeover in Apps Using FastAPI SSO
  **Description**

  The OAuth login state tokens are completely stateless and carry no per-request entropy or any data that could link them to the session that initiated the OAuth flow. `generate_state_token()` is always called with an empty `state_data` dict, so the resulting JWT only contains the fixed audience claim plus an expiration timestamp. \[1\]

  ```py
  state_data: dict[str, str] = {}
  state = generate_state_token(state_data, state_secret)
  authorization_url = await oauth_client.get_authorization_url(
  authorize_redirect_url,
  state,
  scopes,
  )
  ```

  *fastapi\_users/router/oauth.py:65-71*

  On callback, the library merely checks that the JWT verifies under `state_secret` and is unexpired; there is no attempt to match the state value to the browser that initiated the OAuth request, no correlation cookie, and no server-side cache. \[2\]

  ```py
  try:
  decode_jwt(state, state_secret, [STATE_TOKEN_AUDIENCE])
  except jwt.DecodeError:
  raise HTTPException(
  status_code=status.HTTP_400_BAD_REQUEST,
  detail=ErrorCode.ACCESS_TOKEN_DECODE_ERROR,
  )
  except jwt.ExpiredSignatureError:
  raise HTTPException(
  status_code=status.HTTP_400_BAD_REQUEST,
  detail=ErrorCode.ACCESS_TOKEN_ALREADY_EXPIRED,
  )
  ```

  *fastapi\_users/router/oauth.py:130-141*

  Any attacker can hit `/authorize`, capture the server-generated state, finish the upstream OAuth flow with their own provider account, and then trick a victim into loading `.../callback?code=<attacker_code>&state=<attacker_state>`. Because the state JWT is valid for any client for \~1 hour, the victim’s browser will complete the flow. This leads to login CSRF. Depending on the app’s logic, the login CSRF can lead to an account takeover of the victim account or to the victim user getting logged in to the attacker's account.
impacted_packages:
  - purl: pkg:pypi/fastapi-users
    affected_versions: vers:pypi/<15.0.2
    fixed_versions: vers:pypi/15.0.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score:
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:L/A:N
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/pypi/fastapi-users/CVE-2025-68481.yml
weaknesses:
  - CWE-285
  - CWE-352
  - CWE-1035
  - CWE-937
references:
  - url: https://github.com/fastapi-users/fastapi-users
    reference_type:
    reference_id:
  - url: https://github.com/fastapi-users/fastapi-users/blob/bcee8c9b884de31decb5d799aead3974a0b5b158/fastapi_users/router/oauth.py#L111
    reference_type:
    reference_id:
  - url: https://github.com/fastapi-users/fastapi-users/blob/bcee8c9b884de31decb5d799aead3974a0b5b158/fastapi_users/router/oauth.py#L57
    reference_type:
    reference_id:
  - url: https://github.com/fastapi-users/fastapi-users/commit/7cf413cd766b9cb0ab323ce424ddab2c0d235932
    reference_type:
    reference_id:
  - url: https://github.com/fastapi-users/fastapi-users/security/advisories/GHSA-5j53-63w8-8625
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-68481
    reference_type:
    reference_id:
  - url: https://github.com/advisories/GHSA-5j53-63w8-8625
    reference_type:
    reference_id: GHSA-5j53-63w8-8625
