advisory_id: pypi/matrix-synapse/CVE-2022-39335
datasource_id: gitlab_importer_v2/pypi/matrix-synapse/CVE-2022-39335
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/pypi/matrix-synapse/CVE-2022-39335.yml
aliases:
  - CVE-2022-39335
  - GHSA-45cj-f97f-ggwv
summary: |
  Synapse does not apply enough checks to servers requesting auth events of events in a room
  Synapse is an open-source Matrix homeserver written and maintained by the Matrix.org Foundation. The Matrix Federation API allows remote homeservers to request the *authorisation events* of events in a room. This is necessary so that a homeserver receiving some events can validate that those events are legitimate and permitted in their room.
  However, in versions of Synapse up to and including 1.68.0, a Synapse homeserver answering a query for authorisation events does not sufficiently check that the requesting server should be able to access them.

  Authorisation events include power level events (the list of user IDs and their power levels at the time) and relevant membership events (including the display name of the sender of that event), as well as events like `m.room.create`, `m.room.third_party_invite` and `m.room.join_rules`. Non-authorisation events are unaffected, so it isn't possible to e.g. extract message contents this way.

  This issue is only exploitable when a malicious actor knows the ID of a target room and the ID of an event from that room. In most cases, this makes exploitation infeasible. This issue is of negligible consequence for public rooms given that any server can easily join the room in order to be allowed to view authorisation events. Further, deployments in a closed federation where all homeservers are trustworthy are not affected.
impacted_packages:
  - purl: pkg:pypi/matrix-synapse
    affected_versions: vers:pypi/<1.69.0
    fixed_versions: vers:pypi/1.69.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score:
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:L/I:L/A:L
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/pypi/matrix-synapse/CVE-2022-39335.yml
weaknesses:
  - CWE-937
  - CWE-200
  - CWE-1035
  - CWE-862
references:
  - url: https://github.com/matrix-org/synapse
    reference_type:
    reference_id:
  - url: https://github.com/matrix-org/synapse/issues/13288
    reference_type:
    reference_id:
  - url: https://github.com/matrix-org/synapse/pull/13823
    reference_type:
    reference_id:
  - url: https://github.com/matrix-org/synapse/security/advisories/GHSA-45cj-f97f-ggwv
    reference_type:
    reference_id:
  - url: https://github.com/pypa/advisory-database/tree/main/vulns/matrix-synapse/PYSEC-2023-65.yaml
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/T2MBNMZAFY4RCZL2VGBGAPKGB4JUPZVS
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-39335
    reference_type:
    reference_id: CVE-2022-39335
  - url: https://github.com/advisories/GHSA-45cj-f97f-ggwv
    reference_type:
    reference_id: GHSA-45cj-f97f-ggwv
