advisory_id: gem/message_bus/CVE-2021-43840
datasource_id: gitlab_importer_v2/gem/message_bus/CVE-2021-43840
datasource_url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/gem/message_bus/CVE-2021-43840.yml
aliases:
  - CVE-2021-43840
  - GHSA-xmgj-5fh3-xjmm
summary: |
  Improper Limitation of a Pathname to a Restricted Directory ('Path Traversal')
  message_bus is a messaging bus for Ruby processes and web clients. users who deployed message bus with diagnostics features enabled (default off) is vulnerable to a path traversal bug, which could lead to disclosure of secret information on a machine if an unintended user were to gain access to the diagnostic route. The impact is also greater if there is no proxy for your web application as the number of steps up the directories is not bounded. For deployments which uses a proxy, the impact varies. For example, If a request goes through a proxy like Nginx with `merge_slashes` enabled, the number of steps up the directories that can be read is limited to 3 levels. This issue has been patched Users unable to upgrade should ensure that MessageBus::Diagnostics is disabled.
impacted_packages:
  - purl: pkg:gem/message_bus
    affected_versions: vers:gem/<3.3.7
    fixed_versions: vers:gem/3.3.7
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score:
    scoring_system: cvssv2
    scoring_elements: AV:N/AC:M/Au:S/C:P/I:N/A:N
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/gem/message_bus/CVE-2021-43840.yml
  - score:
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N
    published_at: None
    url: https://gitlab.com/gitlab-org/advisories-community/-/blob/main/gem/message_bus/CVE-2021-43840.yml
weaknesses:
  - CWE-1035
  - CWE-937
  - CWE-22
references:
  - url: https://github.com/discourse/message_bus/commit/9b6deee01ed474c7e9b5ff65a06bb0447b4db2ba
    reference_type:
    reference_id:
  - url: https://github.com/discourse/message_bus/security/advisories/GHSA-xmgj-5fh3-xjmm
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-43840
    reference_type:
    reference_id: CVE-2021-43840
