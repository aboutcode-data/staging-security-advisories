advisory_id: CVE-2017-1000117
datasource_id: collect_kubernetes_fix_commits/CVE-2017-1000117
datasource_url: https://github.com/kubernetes/kubernetes
aliases: []
summary: "26caa84d093107ad47e2355b5ffe88b3635adc48:Merge pull request #63445 from ericchiang/deprecate-git-repo-volume\n\
  \nAutomatic merge from submit-queue (batch tested with PRs 63445, 63820). If you want to cherry-pick\
  \ this change to another branch, please follow the instructions <a href=\"https://github.com/kubernetes/community/blob/master/contributors/devel/cherry-picks.md\"\
  >here</a>.\n\ncore v1: deprecate the gitRepo volume type\n\ngitRepo stopped accepting new\
  \ features nearly 2 years ago https://github.com/kubernetes/kubernetes/issues/17676#issuecomment-228650586\
  \ and today this behavior can easily be achieved through an init container. The kubelet shelling\
  \ out to git in the host namespace can also be a security issue on un-trusted repos, as was\
  \ demonstrated by [CVE-2017-1000117](https://groups.google.com/forum/#!topic/kubernetes-announce/CTLXJ74cu8M).\
  \ Our own documentation even alludes to this volume type being removed in the future:\r\n\r\
  \n> In the future, such volumes may be moved to an even more decoupled model, rather than\
  \ extending the Kubernetes API for every such use case.\r\n\r\nhttps://kubernetes.io/docs/concepts/storage/volumes/#gitrepo\r\
  \n\r\nCloses https://github.com/kubernetes/kubernetes/issues/60999\r\n\r\n```release-note-action-required\r\
  \nThe GitRepo volume type is deprecated. To provision a container with a git repo, mount an\
  \ EmptyDir into an InitContainer that clones the repo using git, then mount the EmptyDir into\
  \ the Pod's container.\r\n```\r\n\r\n/release-note-action-required\r\n\r\nInstead of this:\r\
  \n\r\n```yaml\r\napiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: server\r\nspec:\r\n \
  \ containers:\r\n  - image: nginx\r\n    name: nginx\r\n    volumeMounts:\r\n    - mountPath:\
  \ /mypath\r\n      name: git-volume\r\n  volumes:\r\n  - name: git-volume\r\n    gitRepo:\r\
  \n      repository: \"git@somewhere:me/my-git-repository.git\"\r\n      revision: \"22f1d8406d464b0c0874075539c1f2e96c253775\"\
  \r\n```\r\n\r\nDo this:\r\n\r\n```yaml\r\napiVersion: v1\r\nkind: ConfigMap\r\nmetadata:\r\
  \n  name: git-clone\r\ndata:\r\n  git-clone.sh: |\r\n    #!/bin/sh -e\r\n    git clone $1\
  \ $3\r\n    cd $3\r\n    git reset --hard $2\r\n---\r\napiVersion: v1\r\nkind: Pod\r\nmetadata:\r\
  \n  name: server\r\nspec:\r\n  initContainers:\r\n  - name: git-clone\r\n    image: alpine/git\
  \ # Any image with git will do\r\n    command:\r\n    - /usr/local/git/git-clone.sh\r\n  \
  \  args:\r\n    - \"https://somewhere/me/my-git-repository.git\"\r\n    - \"22f1d8406d464b0c0874075539c1f2e96c253775\"\
  \r\n    - \"/mypath\"\r\n    volumeMounts:\r\n    - name: git-clone\r\n      mountPath: /usr/local/git\r\
  \n    - name: git-repo\r\n      mountPath: /mypath\r\n  containers:\r\n  - image: nginx\r\n\
  \    name: nginx\r\n    volumeMounts:\r\n    - mountPath: /mypath\r\n      name: git-volume\r\
  \n  volumes:\r\n  - name: git-volume\r\n    emptyDir: {}\r\n  - name: git-clone\r\n    configMap:\r\
  \n      name: git-clone\r\n      defaultMode: 0755\r\n```"
impacted_packages:
  - purl: pkg:github/kubernetes/kubernetes
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/kubernetes/kubernetes
        commit: 26caa84d093107ad47e2355b5ffe88b3635adc48
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/kubernetes/kubernetes/tree/26caa84d093107ad47e2355b5ffe88b3635adc48
    reference_type: commit
    reference_id: 26caa84d093107ad47e2355b5ffe88b3635adc48
