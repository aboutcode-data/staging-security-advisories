advisory_id: linux/CVE-2023-54262
datasource_id: debian_importer_v2/linux/CVE-2023-54262
datasource_url: https://security-tracker.debian.org/tracker/CVE-2023-54262
aliases:
  - CVE-2023-54262
summary: 'In the Linux kernel, the following vulnerability has been resolved:  net/mlx5e: Don''t
  clone flow post action attributes second time  The code already clones post action attributes
  in mlx5e_clone_flow_attr_for_post_act(). Creating another copy in mlx5e_tc_post_act_add()
  is a erroneous leftover from original implementation. Instead, assign handle->attribute to
  post_attr provided by the caller. Note that cloning the attribute second time is not just
  wasteful but also causes issues like second copy not being properly updated in neigh update
  code which leads to following use-after-free:  Feb 21 09:02:00 c-237-177-40-045 kernel: BUG:
  KASAN: use-after-free in mlx5_cmd_set_fte+0x200d/0x24c0 [mlx5_core] Feb 21 09:02:00 c-237-177-40-045
  kernel:  kasan_report+0xbb/0x1a0 Feb 21 09:02:00 c-237-177-40-045 kernel:  kasan_save_stack+0x1e/0x40
  Feb 21 09:02:00 c-237-177-40-045 kernel:  kasan_set_track+0x21/0x30 Feb 21 09:02:00 c-237-177-40-045
  kernel:  __kasan_kmalloc+0x7a/0x90 Feb 21 09:02:00 c-237-177-40-045 kernel:  kasan_save_stack+0x1e/0x40
  Feb 21 09:02:00 c-237-177-40-045 kernel:  kasan_set_track+0x21/0x30 Feb 21 09:02:00 c-237-177-40-045
  kernel:  kasan_save_free_info+0x2a/0x40 Feb 21 09:02:00 c-237-177-40-045 kernel:  ____kasan_slab_free+0x11a/0x1b0
  Feb 21 09:02:00 c-237-177-40-045 kernel: page dumped because: kasan: bad access detected Feb
  21 09:02:00 c-237-177-40-045 kernel: mlx5_core 0000:08:00.0: mlx5_cmd_out_err:803:(pid 8833):
  SET_FLOW_TABLE_ENTRY(0x936) op_mod(0x0) failed, status bad resource state(0x9), syndrome (0xf2ff71),
  err(-22) Feb 21 09:02:00 c-237-177-40-045 kernel: mlx5_core 0000:08:00.0 enp8s0f0: Failed
  to add post action rule Feb 21 09:02:00 c-237-177-40-045 kernel: mlx5_core 0000:08:00.0: mlx5e_tc_encap_flows_add:190:(pid
  8833): Failed to update flow post acts, -22 Feb 21 09:02:00 c-237-177-40-045 kernel: Call
  Trace: Feb 21 09:02:00 c-237-177-40-045 kernel:  <TASK> Feb 21 09:02:00 c-237-177-40-045 kernel:  dump_stack_lvl+0x57/0x7d
  Feb 21 09:02:00 c-237-177-40-045 kernel:  print_report+0x170/0x471 Feb 21 09:02:00 c-237-177-40-045
  kernel:  ? mlx5_cmd_set_fte+0x200d/0x24c0 [mlx5_core] Feb 21 09:02:00 c-237-177-40-045 kernel:  kasan_report+0xbb/0x1a0
  Feb 21 09:02:00 c-237-177-40-045 kernel:  ? mlx5_cmd_set_fte+0x200d/0x24c0 [mlx5_core] Feb
  21 09:02:00 c-237-177-40-045 kernel:  mlx5_cmd_set_fte+0x200d/0x24c0 [mlx5_core] Feb 21 09:02:00
  c-237-177-40-045 kernel:  ? __module_address.part.0+0x62/0x200 Feb 21 09:02:00 c-237-177-40-045
  kernel:  ? mlx5_cmd_stub_create_flow_table+0xd0/0xd0 [mlx5_core] Feb 21 09:02:00 c-237-177-40-045
  kernel:  ? __raw_spin_lock_init+0x3b/0x110 Feb 21 09:02:00 c-237-177-40-045 kernel:  mlx5_cmd_create_fte+0x80/0xb0
  [mlx5_core] Feb 21 09:02:00 c-237-177-40-045 kernel:  add_rule_fg+0xe80/0x19c0 [mlx5_core]
  -- Feb 21 09:02:00 c-237-177-40-045 kernel: Allocated by task 13476: Feb 21 09:02:00 c-237-177-40-045
  kernel:  kasan_save_stack+0x1e/0x40 Feb 21 09:02:00 c-237-177-40-045 kernel:  kasan_set_track+0x21/0x30
  Feb 21 09:02:00 c-237-177-40-045 kernel:  __kasan_kmalloc+0x7a/0x90 Feb 21 09:02:00 c-237-177-40-045
  kernel:  mlx5_packet_reformat_alloc+0x7b/0x230 [mlx5_core] Feb 21 09:02:00 c-237-177-40-045
  kernel:  mlx5e_tc_tun_create_header_ipv4+0x977/0xf10 [mlx5_core] Feb 21 09:02:00 c-237-177-40-045
  kernel:  mlx5e_attach_encap+0x15b4/0x1e10 [mlx5_core] Feb 21 09:02:00 c-237-177-40-045 kernel:  post_process_attr+0x305/0xa30
  [mlx5_core] Feb 21 09:02:00 c-237-177-40-045 kernel:  mlx5e_tc_add_fdb_flow+0x4c0/0xcf0 [mlx5_core]
  Feb 21 09:02:00 c-237-177-40-045 kernel:  __mlx5e_add_fdb_flow+0x7cf/0xe90 [mlx5_core] Feb
  21 09:02:00 c-237-177-40-045 kernel:  mlx5e_configure_flower+0xcaa/0x4b90 [mlx5_core] Feb
  21 09:02:00 c-237-177-40-045 kernel:  mlx5e_rep_setup_tc_cls_flower+0x99/0x1b0 [mlx5_core]
  Feb 21 09:02:00 c-237-177-40-045 kernel:  mlx5e_rep_setup_tc_cb+0x133/0x1e0 [mlx5_core] --
  Feb 21 09:02:00 c-237-177-40-045 kernel: Freed by task 8833: Feb 21 09:02:00 c-237-177-40-045
  kernel:  kasan_save_s ---truncated---'
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.37-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.223-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/0
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.3.7-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
