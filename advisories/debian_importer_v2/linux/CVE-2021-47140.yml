advisory_id: linux/CVE-2021-47140
datasource_id: debian_importer_v2/linux/CVE-2021-47140
datasource_url: https://security-tracker.debian.org/tracker/CVE-2021-47140
aliases:
  - CVE-2021-47140
summary: 'In the Linux kernel, the following vulnerability has been resolved:  iommu/amd: Clear
  DMA ops when switching domain  Since commit 08a27c1c3ecf ("iommu: Add support to change default
  domain of an iommu group") a user can switch a device between IOMMU and direct DMA through
  sysfs. This doesn''t work for AMD IOMMU at the moment because dev->dma_ops is not cleared
  when switching from a DMA to an identity IOMMU domain. The DMA layer thus attempts to use
  the dma-iommu ops on an identity domain, causing an oops:    # echo 0000:00:05.0 > /sys/sys/bus/pci/drivers/e1000e/unbind   #
  echo identity > /sys/bus/pci/devices/0000:00:05.0/iommu_group/type   # echo 0000:00:05.0 >
  /sys/sys/bus/pci/drivers/e1000e/bind    ...   BUG: kernel NULL pointer dereference, address:
  0000000000000028    ...    Call Trace:     iommu_dma_alloc     e1000e_setup_tx_resources     e1000e_open  Since
  iommu_change_dev_def_domain() calls probe_finalize() again, clear the dma_ops there like Vt-d
  does.'
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.14.6-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.223-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/0
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
