advisory_id: linux/CVE-2023-54019
datasource_id: debian_importer_v2/linux/CVE-2023-54019
datasource_url: https://security-tracker.debian.org/tracker/CVE-2023-54019
aliases:
  - CVE-2023-54019
summary: 'In the Linux kernel, the following vulnerability has been resolved:  sched/psi: use
  kernfs polling functions for PSI trigger polling  Destroying psi trigger in cgroup_file_release
  causes UAF issues when a cgroup is removed from under a polling process. This is happening
  because cgroup removal causes a call to cgroup_file_release while the actual file is still
  alive. Destroying the trigger at this point would also destroy its waitqueue head and if there
  is still a polling process on that file accessing the waitqueue, it will step on the freed
  pointer:  do_select   vfs_poll                            do_rmdir                              cgroup_rmdir                                kernfs_drain_open_files                                  cgroup_file_release                                    cgroup_pressure_release                                      psi_trigger_destroy                                        wake_up_pollfree(&t->event_wait)
  // vfs_poll is unblocked                                        synchronize_rcu                                        kfree(t)   poll_freewait
  -> UAF access to the trigger''s waitqueue head  Patch [1] fixed this issue for epoll() case
  using wake_up_pollfree(), however the same issue exists for synchronous poll() case. The root
  cause of this issue is that the lifecycles of the psi trigger''s waitqueue and of the file
  associated with the trigger are different. Fix this by using kernfs_generic_poll function
  when polling on cgroup-specific psi triggers. It internally uses kernfs_open_node->poll waitqueue
  head with its lifecycle tied to the file''s lifecycle. This also renders the fix in [1] obsolete,
  so revert it.  [1] commit c2dbe32d5db5 ("sched/psi: Fix use-after-free in ep_remove_wait_queue()")'
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions: vers:deb/5.10.223-1
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions: vers:deb/5.10.223-1
    fixed_versions: vers:deb/6.1.52-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions: vers:deb/5.10.223-1
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions: vers:deb/5.10.223-1
    fixed_versions: vers:deb/6.4.11-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions: vers:deb/5.10.223-1
    fixed_versions: vers:deb/6.18.15-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions: vers:deb/5.10.223-1
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
