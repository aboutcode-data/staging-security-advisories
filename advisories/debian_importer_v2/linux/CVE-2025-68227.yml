advisory_id: linux/CVE-2025-68227
datasource_id: debian_importer_v2/linux/CVE-2025-68227
datasource_url: https://security-tracker.debian.org/tracker/CVE-2025-68227
aliases:
  - CVE-2025-68227
summary: 'In the Linux kernel, the following vulnerability has been resolved:  mptcp: Fix proto
  fallback detection with BPF  The sockmap feature allows bpf syscall from userspace, or based
  on bpf sockops, replacing the sk_prot of sockets during protocol stack processing with sockmap''s
  custom read/write interfaces. '''''' tcp_rcv_state_process()   syn_recv_sock()/subflow_syn_recv_sock()     tcp_init_transfer(BPF_SOCK_OPS_PASSIVE_ESTABLISHED_CB)       bpf_skops_established       <==
  sockops         bpf_sock_map_update(sk)   <== call bpf helper           tcp_bpf_update_proto()  <==
  update sk_prot ''''''  When the server has MPTCP enabled but the client sends a TCP SYN without
  MPTCP, subflow_syn_recv_sock() performs a fallback on the subflow, replacing the subflow sk''s
  sk_prot with the native sk_prot. '''''' subflow_syn_recv_sock()   subflow_ulp_fallback()     subflow_drop_ctx()       mptcp_subflow_ops_undo_override()
  ''''''  Then, this subflow can be normally used by sockmap, which replaces the native sk_prot
  with sockmap''s custom sk_prot. The issue occurs when the user executes accept::mptcp_stream_accept::mptcp_fallback_tcp_ops().
  Here, it uses sk->sk_prot to compare with the native sk_prot, but this is incorrect when sockmap
  is used, as we may incorrectly set sk->sk_socket->ops.  This fix uses the more generic sk_family
  for the comparison instead.  Additionally, this also prevents a WARNING from occurring:  result
  from ./scripts/decode_stacktrace.sh: ------------[ cut here ]------------ WARNING: CPU: 0
  PID: 337 at net/mptcp/protocol.c:68 mptcp_stream_accept \ (net/mptcp/protocol.c:4005) Modules
  linked in: ...  PKRU: 55555554 Call Trace: <TASK> do_accept (net/socket.c:1989) __sys_accept4
  (net/socket.c:2028 net/socket.c:2057) __x64_sys_accept (net/socket.c:2067) x64_sys_call (arch/x86/entry/syscall_64.c:41)
  do_syscall_64 (arch/x86/entry/syscall_64.c:63 arch/x86/entry/syscall_64.c:94) entry_SYSCALL_64_after_hwframe
  (arch/x86/entry/entry_64.S:130) RIP: 0033:0x7f87ac92b83d  ---[ end trace 0000000000000000
  ]---'
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.223-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.247-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.17.10-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.15-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
