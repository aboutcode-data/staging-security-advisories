advisory_id: linux/CVE-2022-50241
datasource_id: debian_importer_v2/linux/CVE-2022-50241
datasource_url: https://security-tracker.debian.org/tracker/CVE-2022-50241
aliases:
  - CVE-2022-50241
summary: 'In the Linux kernel, the following vulnerability has been resolved:  NFSD: fix use-after-free
  on source server when doing inter-server copy  Use-after-free occurred when the laundromat
  tried to free expired cpntf_state entry on the s2s_cp_stateids list after inter-server copy
  completed. The sc_cp_list that the expired copy state was inserted on was already freed.  When
  COPY completes, the Linux client normally sends LOCKU(lock_state x), FREE_STATEID(lock_state
  x) and CLOSE(open_state y) to the source server. The nfs4_put_stid call from nfsd4_free_stateid
  cleans up the copy state from the s2s_cp_stateids list before freeing the lock state''s stid.  However,
  sometimes the CLOSE was sent before the FREE_STATEID request. When this happens, the nfsd4_close_open_stateid
  call from nfsd4_close frees all lock states on its st_locks list without cleaning up the copy
  state on the sc_cp_list list. When the time the FREE_STATEID arrives the server returns BAD_STATEID
  since the lock state was freed. This causes the use-after-free error to occur when the laundromat
  tries to free the expired cpntf_state.  This patch adds a call to nfs4_free_cpntf_statelist
  in nfsd4_close_open_stateid to clean up the copy state before calling free_ol_stateid_reaplist
  to free the lock state''s stid on the reaplist.'
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.0.3-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.223-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.158-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.13-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
