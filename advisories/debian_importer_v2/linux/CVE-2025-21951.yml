advisory_id: linux/CVE-2025-21951
datasource_id: debian_importer_v2/linux/CVE-2025-21951
datasource_url: https://security-tracker.debian.org/tracker/CVE-2025-21951
aliases:
  - CVE-2025-21951
summary: 'In the Linux kernel, the following vulnerability has been resolved:  bus: mhi: host:
  pci_generic: Use pci_try_reset_function() to avoid deadlock  There are multiple places from
  where the recovery work gets scheduled asynchronously. Also, there are multiple places where
  the caller waits synchronously for the recovery to be completed. One such place is during
  the PM shutdown() callback.  If the device is not alive during recovery_work, it will try
  to reset the device using pci_reset_function(). This function internally will take the device_lock()
  first before resetting the device. By this time, if the lock has already been acquired, then
  recovery_work will get stalled while waiting for the lock. And if the lock was already acquired
  by the caller which waits for the recovery_work to be completed, it will lead to deadlock.  This
  is what happened on the X1E80100 CRD device when the device died before shutdown() callback.
  Driver core calls the driver''s shutdown() callback while holding the device_lock() leading
  to deadlock.  And this deadlock scenario can occur on other paths as well, like during the
  PM suspend() callback, where the driver core would hold the device_lock() before calling driver''s
  suspend() callback. And if the recovery_work was already started, it could lead to deadlock.
  This is also observed on the X1E80100 CRD.  So to fix both issues, use pci_try_reset_function()
  in recovery_work. This function first checks for the availability of the device_lock() before
  trying to reset the device. If the lock is available, it will acquire it and reset the device.
  Otherwise, it will return -EAGAIN. If that happens, recovery_work will fail with the error
  message "Recovery failed" as not much could be done.'
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.133-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.223-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/0
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.19-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
