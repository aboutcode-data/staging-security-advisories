advisory_id: linux/CVE-2021-47131
datasource_id: debian_importer_v2/linux/CVE-2021-47131
datasource_url: https://security-tracker.debian.org/tracker/CVE-2021-47131
aliases:
  - CVE-2021-47131
summary: 'In the Linux kernel, the following vulnerability has been resolved:  net/tls: Fix
  use-after-free after the TLS device goes down and up  When a netdev with active TLS offload
  goes down, tls_device_down is called to stop the offload and tear down the TLS context. However,
  the socket stays alive, and it still points to the TLS context, which is now deallocated.
  If a netdev goes up, while the connection is still active, and the data flow resumes after
  a number of TCP retransmissions, it will lead to a use-after-free of the TLS context.  This
  commit addresses this bug by keeping the context alive until its normal destruction, and implements
  the necessary fallbacks, so that the connection can resume in software (non-offloaded) kTLS
  mode.  On the TX side tls_sw_fallback is used to encrypt all packets. The RX side already
  has all the necessary fallbacks, because receiving non-decrypted packets is supported. The
  thing needed on the RX side is to block resync requests, which are normally produced after
  receiving non-decrypted packets.  The necessary synchronization is implemented for a graceful
  teardown: first the fallbacks are deployed, then the driver resources are released (it used
  to be possible to have a tls_dev_resync after tls_dev_del).  A new flag called TLS_RX_DEV_DEGRADED
  is added to indicate the fallback mode. It''s used to skip the RX resync logic completely,
  as it becomes useless, and some objects may be released (for example, resync_async, which
  is allocated and freed by the driver).'
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.46-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.223-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
