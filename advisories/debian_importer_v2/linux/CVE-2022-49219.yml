advisory_id: linux/CVE-2022-49219
datasource_id: debian_importer_v2/linux/CVE-2022-49219
datasource_url: https://security-tracker.debian.org/tracker/CVE-2022-49219
aliases:
  - CVE-2022-49219
summary: 'In the Linux kernel, the following vulnerability has been resolved:  vfio/pci: fix
  memory leak during D3hot to D0 transition  If ''vfio_pci_core_device::needs_pm_restore'' is
  set (PCI device does not have No_Soft_Reset bit set in its PMCSR config register), then the
  current PCI state will be saved locally in ''vfio_pci_core_device::pm_save'' during D0->D3hot
  transition and same will be restored back during D3hot->D0 transition. For saving the PCI
  state locally, pci_store_saved_state() is being used and the pci_load_and_free_saved_state()
  will free the allocated memory.  But for reset related IOCTLs, vfio driver calls PCI reset-related
  API''s which will internally change the PCI power state back to D0. So, when the guest resumes,
  then it will get the current state as D0 and it will skip the call to vfio_pci_set_power_state()
  for changing the power state to D0 explicitly. In this case, the memory pointed by ''pm_save''
  will never be freed. In a malicious sequence, the state changing to D3hot followed by VFIO_DEVICE_RESET/VFIO_DEVICE_PCI_HOT_RESET
  can be run in a loop and it can cause an OOM situation.  This patch frees the earlier allocated
  memory first before overwriting ''pm_save'' to prevent the mentioned memory leak.'
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.17.3-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.223-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.237-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
