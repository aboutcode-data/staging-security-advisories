advisory_id: linux/CVE-2022-50778
datasource_id: debian_importer_v2/linux/CVE-2022-50778
datasource_url: https://security-tracker.debian.org/tracker/CVE-2022-50778
aliases:
  - CVE-2022-50778
summary: 'In the Linux kernel, the following vulnerability has been resolved:  fortify: Fix
  __compiletime_strlen() under UBSAN_BOUNDS_LOCAL  With CONFIG_FORTIFY=y and CONFIG_UBSAN_LOCAL_BOUNDS=y
  enabled, we observe a runtime panic while running Android''s Compatibility Test Suite''s (CTS)
  android.hardware.input.cts.tests. This is stemming from a strlen() call in hidinput_allocate().  __compiletime_strlen()
  is implemented in terms of __builtin_object_size(), then does an array access to check for
  NUL-termination. A quirk of __builtin_object_size() is that for strings whose values are runtime
  dependent, __builtin_object_size(str, 1 or 0) returns the maximum size of possible values
  when those sizes are determinable at compile time. Example:    static const char *v = "FOO
  BAR";   static const char *y = "FOO BA";   unsigned long x (int z) {       // Returns 8, which
  is:       // max(__builtin_object_size(v, 1), __builtin_object_size(y, 1))       return __builtin_object_size(z
  ? v : y, 1);   }  So when FORTIFY_SOURCE is enabled, the current implementation of __compiletime_strlen()
  will try to access beyond the end of y at runtime using the size of v. Mixed with UBSAN_LOCAL_BOUNDS
  we get a fault.  hidinput_allocate() has a local C string whose value is control flow dependent
  on a switch statement, so __builtin_object_size(str, 1) evaluates to the maximum string length,
  making all other cases fault on the last character check. hidinput_allocate() could be cleaned
  up to avoid runtime calls to strlen() since the local variable can only have literal values,
  so there''s no benefit to trying to fortify the strlen call site there.  Perform a __builtin_constant_p()
  check against index 0 earlier in the macro to filter out the control-flow-dependant case.
  Add a KUnit test for checking the expected behavioral characteristics of FORTIFY_SOURCE internals.'
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.0.3-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.223-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/0
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.13-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
