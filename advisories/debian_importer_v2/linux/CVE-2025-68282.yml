advisory_id: linux/CVE-2025-68282
datasource_id: debian_importer_v2/linux/CVE-2025-68282
datasource_url: https://security-tracker.debian.org/tracker/CVE-2025-68282
aliases:
  - CVE-2025-68282
summary: 'In the Linux kernel, the following vulnerability has been resolved:  usb: gadget:
  udc: fix use-after-free in usb_gadget_state_work  A race condition during gadget teardown
  can lead to a use-after-free in usb_gadget_state_work(), as reported by KASAN:    BUG: KASAN:
  invalid-access in sysfs_notify+0x2c/0xd0   Workqueue: events usb_gadget_state_work  The fundamental
  race occurs because a concurrent event (e.g., an interrupt) can call usb_gadget_set_state()
  and schedule gadget->work at any time during the cleanup process in usb_del_gadget().  Commit
  399a45e5237c ("usb: gadget: core: flush gadget workqueue after device removal") attempted
  to fix this by moving flush_work() to after device_del(). However, this does not fully solve
  the race, as a new work item can still be scheduled *after* flush_work() completes but before
  the gadget''s memory is freed, leading to the same use-after-free.  This patch fixes the race
  condition robustly by introducing a ''teardown'' flag and a ''state_lock'' spinlock to the
  usb_gadget struct. The flag is set during cleanup in usb_del_gadget() *before* calling flush_work()
  to prevent any new work from being scheduled once cleanup has commenced. The scheduling site,
  usb_gadget_set_state(), now checks this flag under the lock before queueing the work, thus
  safely closing the race window.'
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.223-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.249-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.17.11-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.15-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
