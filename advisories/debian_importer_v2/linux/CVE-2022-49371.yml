advisory_id: linux/CVE-2022-49371
datasource_id: debian_importer_v2/linux/CVE-2022-49371
datasource_url: https://security-tracker.debian.org/tracker/CVE-2022-49371
aliases:
  - CVE-2022-49371
summary: "In the Linux kernel, the following vulnerability has been resolved:  driver core:\
  \ fix deadlock in __device_attach  In __device_attach function, The lock holding logic is\
  \ as follows: ... __device_attach device_lock(dev)      // get lock dev   async_schedule_dev(__device_attach_async_helper,\
  \ dev); // func     async_schedule_node       async_schedule_node_domain(func)         entry\
  \ = kzalloc(sizeof(struct async_entry), GFP_ATOMIC); \t/* when fail or work limit, sync to\
  \ execute func, but \t   __device_attach_async_helper will get lock dev as \t   well, which\
  \ will lead to A-A deadlock.  */ \tif (!entry || atomic_read(&entry_count) > MAX_WORK) { \t\
  \  func; \telse \t  queue_work_node(node, system_unbound_wq, &entry->work)   device_unlock(dev)\
  \  As shown above, when it is allowed to do async probes, because of out of memory or work\
  \ limit, async work is not allowed, to do sync execute instead. it will lead to A-A deadlock\
  \ because of __device_attach_async_helper getting lock dev.  To fix the deadlock, move the\
  \ async_schedule_dev outside device_lock, as we can see, in async_schedule_node_domain, the\
  \ parameter of queue_work_node is system_unbound_wq, so it can accept concurrent operations.\
  \ which will also not change the code logic, and will not lead to deadlock."
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.18.5-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.223-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.127-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.15-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
