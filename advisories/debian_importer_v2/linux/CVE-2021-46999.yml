advisory_id: linux/CVE-2021-46999
datasource_id: debian_importer_v2/linux/CVE-2021-46999
datasource_url: https://security-tracker.debian.org/tracker/CVE-2021-46999
aliases:
  - CVE-2021-46999
summary: 'In the Linux kernel, the following vulnerability has been resolved:  sctp: do asoc
  update earlier in sctp_sf_do_dupcook_a  There''s a panic that occurs in a few of envs, the
  call trace is as below:    [] general protection fault, ... 0x29acd70f1000a: 0000 [#1] SMP
  PTI   [] RIP: 0010:sctp_ulpevent_notify_peer_addr_change+0x4b/0x1fa [sctp]   []  sctp_assoc_control_transport+0x1b9/0x210
  [sctp]   []  sctp_do_8_2_transport_strike.isra.16+0x15c/0x220 [sctp]   []  sctp_cmd_interpreter.isra.21+0x1231/0x1a10
  [sctp]   []  sctp_do_sm+0xc3/0x2a0 [sctp]   []  sctp_generate_timeout_event+0x81/0xf0 [sctp]  This
  is caused by a transport use-after-free issue. When processing a duplicate COOKIE-ECHO chunk
  in sctp_sf_do_dupcook_a(), both COOKIE-ACK and SHUTDOWN chunks are allocated with the transort
  from the new asoc. However, later in the sideeffect machine, the old asoc is used to send
  them out and old asoc''s shutdown_last_sent_to is set to the transport that SHUTDOWN chunk
  attached to in sctp_cmd_setup_t2(), which actually belongs to the new asoc. After the new_asoc
  is freed and the old asoc T2 timeout, the old asoc''s shutdown_last_sent_to that is already
  freed would be accessed in sctp_sf_t2_timer_expire().  Thanks Alexander and Jere for helping
  dig into this issue.  To fix it, this patch is to do the asoc update first, then allocate
  the COOKIE-ACK and SHUTDOWN chunks with the ''updated'' old asoc. This would make more sense,
  as a chunk from an asoc shouldn''t be sent out with another asoc. We had fixed quite a few
  issues caused by this.'
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.38-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.223-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.15-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
