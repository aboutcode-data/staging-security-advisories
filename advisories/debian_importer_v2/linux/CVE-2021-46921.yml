advisory_id: linux/CVE-2021-46921
datasource_id: debian_importer_v2/linux/CVE-2021-46921
datasource_url: https://security-tracker.debian.org/tracker/CVE-2021-46921
aliases:
  - CVE-2021-46921
summary: "In the Linux kernel, the following vulnerability has been resolved:  locking/qrwlock:\
  \ Fix ordering in queued_write_lock_slowpath()  While this code is executed with the wait_lock\
  \ held, a reader can acquire the lock without holding wait_lock.  The writer side loops checking\
  \ the value with the atomic_cond_read_acquire(), but only truly acquires the lock when the\
  \ compare-and-exchange is completed successfully which isnâ€™t ordered. This exposes the window\
  \ between the acquire and the cmpxchg to an A-B-A problem which allows reads following the\
  \ lock acquisition to observe values speculatively before the write lock is truly acquired.\
  \  We've seen a problem in epoll where the reader does a xchg while holding the read lock,\
  \ but the writer can see a value change out from under it.    Writer                     \
  \           | Reader   --------------------------------------------------------------------------------\
  \   ep_scan_ready_list()                  |   |- write_lock_irq()                   |    \
  \   |- queued_write_lock_slowpath()   | \t|- atomic_cond_read_acquire()   | \t\t\t\t     \
  \   | read_lock_irqsave(&ep->lock, flags);      --> (observes value before unlock) |  chain_epi_lockless()\
  \      |                                  |    epi->next = xchg(&ep->ovflist, epi);      |\
  \                                  | read_unlock_irqrestore(&ep->lock, flags);      |    \
  \                              |      |     atomic_cmpxchg_relaxed()     |      |-- READ_ONCE(ep->ovflist);\
  \        |  A core can order the read of the ovflist ahead of the atomic_cmpxchg_relaxed().\
  \ Switching the cmpxchg to use acquire semantics addresses this issue at which point the atomic_cond_read\
  \ can be switched to use relaxed semantics.  [peterz: use try_cmpxchg()]"
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.38-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.223-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.15-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
