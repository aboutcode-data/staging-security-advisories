advisory_id: linux/CVE-2023-53813
datasource_id: debian_importer_v2/linux/CVE-2023-53813
datasource_url: https://security-tracker.debian.org/tracker/CVE-2023-53813
aliases:
  - CVE-2023-53813
summary: 'In the Linux kernel, the following vulnerability has been resolved:  ext4: fix rbtree
  traversal bug in ext4_mb_use_preallocated  During allocations, while looking for preallocations(PA)
  in the per inode rbtree, we can''t do a direct traversal of the tree because ext4_mb_discard_group_preallocation()
  can paralelly mark the pa deleted and that can cause direct traversal to skip some entries.
  This was leading to a BUG_ON() being hit [1] when we missed a PA that could satisfy our request
  and ultimately tried to create a new PA that would overlap with the missed one.  To makes
  sure we handle that case while still keeping the performance of the rbtree, we make use of
  the fact that the only pa that could possibly overlap the original goal start is the one that
  satisfies the below conditions:    1. It must have it''s logical start immediately to the
  left of   (ie less than) original logical start.    2. It must not be deleted  To find this
  pa we use the following traversal method:  1. Descend into the rbtree normally to find the
  immediate neighboring PA. Here we keep descending irrespective of if the PA is deleted or
  if it overlaps with our request etc. The goal is to find an immediately adjacent PA.  2. If
  the found PA is on right of original goal, use rb_prev() to find the left adjacent PA.  3.
  Check if this PA is deleted and keep moving left with rb_prev() until a non deleted PA is
  found.  4. This is the PA we are looking for. Now we can check if it can satisfy the original
  request and proceed accordingly.  This approach also takes care of having deleted PAs in the
  tree.  (While we are at it, also fix a possible overflow bug in calculating the end of a PA)  [1]
  https://lore.kernel.org/linux-ext4/CA+G9fYv2FRpLqBZf34ZinR8bU2_ZRAUOjKAD3+tKRFaEQHtt8Q@mail.gmail.com/'
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/0
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.223-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.4.11-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
