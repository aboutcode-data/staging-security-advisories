advisory_id: linux/CVE-2024-35895
datasource_id: debian_importer_v2/linux/CVE-2024-35895
datasource_url: https://security-tracker.debian.org/tracker/CVE-2024-35895
aliases:
  - CVE-2024-35895
summary: 'In the Linux kernel, the following vulnerability has been resolved:  bpf, sockmap:
  Prevent lock inversion deadlock in map delete elem  syzkaller started using corpuses where
  a BPF tracing program deletes elements from a sockmap/sockhash map. Because BPF tracing programs
  can be invoked from any interrupt context, locks taken during a map_delete_elem operation
  must be hardirq-safe. Otherwise a deadlock due to lock inversion is possible, as reported
  by lockdep:         CPU0                    CPU1        ----                    ----   lock(&htab->buckets[i].lock);                                local_irq_disable();                                lock(&host->lock);                                lock(&htab->buckets[i].lock);   <Interrupt>     lock(&host->lock);  Locks
  in sockmap are hardirq-unsafe by design. We expects elements to be deleted from sockmap/sockhash
  only in task (normal) context with interrupts enabled, or in softirq context.  Detect when
  map_delete_elem operation is invoked from a context which is _not_ hardirq-unsafe, that is
  interrupts are disabled, and bail out with an error.  Note that map updates are not affected
  by this issue. BPF verifier does not allow updating sockmap/sockhash from a BPF tracing program
  today.'
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.85-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.223-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.216-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.8.9-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.13-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
