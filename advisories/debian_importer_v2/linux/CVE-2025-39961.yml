advisory_id: linux/CVE-2025-39961
datasource_id: debian_importer_v2/linux/CVE-2025-39961
datasource_url: https://security-tracker.debian.org/tracker/CVE-2025-39961
aliases:
  - CVE-2025-39961
summary: "In the Linux kernel, the following vulnerability has been resolved:  iommu/amd/pgtbl:\
  \ Fix possible race while increase page table level  The AMD IOMMU host page table implementation\
  \ supports dynamic page table levels (up to 6 levels), starting with a 3-level configuration\
  \ that expands based on IOVA address. The kernel maintains a root pointer and current page\
  \ table level to enable proper page table walks in alloc_pte()/fetch_pte() operations.  The\
  \ IOMMU IOVA allocator initially starts with 32-bit address and onces its exhuasted it switches\
  \ to 64-bit address (max address is determined based on IOMMU and device DMA capability).\
  \ To support larger IOVA, AMD IOMMU driver increases page table level.  But in unmap path\
  \ (iommu_v1_unmap_pages()), fetch_pte() reads pgtable->[root/mode] without lock. So its possible\
  \ that in exteme corner case, when increase_address_space() is updating pgtable->[root/mode],\
  \ fetch_pte() reads wrong page table level (pgtable->mode). It does compare the value with\
  \ level encoded in page table and returns NULL. This will result is iommu_unmap ops to fail\
  \ and upper layer may retry/log WARN_ON.  CPU 0                                         CPU\
  \ 1 ------                                       ------ map pages                        \
  \            unmap pages alloc_pte() -> increase_address_space()      iommu_v1_unmap_pages()\
  \ -> fetch_pte()   pgtable->root = pte (new root value)                                  \
  \            READ pgtable->[mode/root] \t\t\t\t\t       Reads new root, old mode   Updates\
  \ mode (pgtable->mode += 1)  Since Page table level updates are infrequent and already synchronized\
  \ with a spinlock, implement seqcount to enable lock-free read operations on the read path."
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions: vers:deb/5.10.223-1|6.1.159-1
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions: vers:deb/5.10.223-1|6.1.159-1
    fixed_versions: vers:deb/6.16.9-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions: vers:deb/5.10.223-1|6.1.159-1
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions: vers:deb/5.10.223-1|6.1.159-1
    fixed_versions: vers:deb/6.12.57-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
