advisory_id: linux/CVE-2023-54068
datasource_id: debian_importer_v2/linux/CVE-2023-54068
datasource_url: https://security-tracker.debian.org/tracker/CVE-2023-54068
aliases:
  - CVE-2023-54068
summary: "In the Linux kernel, the following vulnerability has been resolved:  f2fs: compress:\
  \ fix to call f2fs_wait_on_page_writeback() in f2fs_write_raw_pages()  BUG_ON() will be triggered\
  \ when writing files concurrently, because the same page is writtenback multiple times.  1597\
  \ void folio_end_writeback(struct folio *folio) 1598 { \t\t...... 1618     if (!__folio_end_writeback(folio))\
  \ 1619         BUG(); \t\t...... 1625 }  kernel BUG at mm/filemap.c:1619! Call Trace:  <TASK>\
  \  f2fs_write_end_io+0x1a0/0x370  blk_update_request+0x6c/0x410  blk_mq_end_request+0x15/0x130\
  \  blk_complete_reqs+0x3c/0x50  __do_softirq+0xb8/0x29b  ? sort_range+0x20/0x20  run_ksoftirqd+0x19/0x20\
  \  smpboot_thread_fn+0x10b/0x1d0  kthread+0xde/0x110  ? kthread_complete_and_exit+0x20/0x20\
  \  ret_from_fork+0x22/0x30  </TASK>  Below is the concurrency scenario:  [Process A]\t\t[Process\
  \ B]\t\t[Process C] f2fs_write_raw_pages()   - redirty_page_for_writepage()   - unlock page()\
  \ \t\t\tf2fs_do_write_data_page() \t\t\t  - lock_page() \t\t\t  - clear_page_dirty_for_io()\
  \ \t\t\t  - set_page_writeback() [1st writeback] \t\t\t    ..... \t\t\t    - unlock page()\
  \  \t\t\t\t\t\tgeneric_perform_write() \t\t\t\t\t\t  - f2fs_write_begin() \t\t\t\t\t\t   \
  \ - wait_for_stable_page()  \t\t\t\t\t\t  - f2fs_write_end() \t\t\t\t\t\t    - set_page_dirty()\
  \    - lock_page()     - f2fs_do_write_data_page()       - set_page_writeback() [2st writeback]\
  \  This problem was introduced by the previous commit 7377e853967b (\"f2fs: compress: fix\
  \ potential deadlock of compress file\"). All pagelocks were released in f2fs_write_raw_pages(),\
  \ but whether the page was in the writeback state was ignored in the subsequent writing process.\
  \ Let's fix it by waiting for the page to writeback before writing."
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.3.7-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.37-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.223-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.191-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
