advisory_id: linux/CVE-2024-43870
datasource_id: debian_importer_v2/linux/CVE-2024-43870
datasource_url: https://security-tracker.debian.org/tracker/CVE-2024-43870
aliases:
  - CVE-2024-43870
summary: 'In the Linux kernel, the following vulnerability has been resolved:  perf: Fix event
  leak upon exit  When a task is scheduled out, pending sigtrap deliveries are deferred to the
  target task upon resume to userspace via task_work.  However failures while adding an event''s
  callback to the task_work engine are ignored. And since the last call for events exit happen
  after task work is eventually closed, there is a small window during which pending sigtrap
  can be queued though ignored, leaking the event refcount addition such as in the following
  scenario:      TASK A     -----      do_exit()        exit_task_work(tsk);         <IRQ>        perf_event_overflow()           event->pending_sigtrap
  = pending_id;           irq_work_queue(&event->pending_irq);        </IRQ>     =========>
  PREEMPTION: TASK A -> TASK B        event_sched_out()           event->pending_sigtrap = 0;           atomic_long_inc_not_zero(&event->refcount)           //
  FAILS: task work has exited           task_work_add(&event->pending_task)        [...]        <IRQ
  WORK>        perf_pending_irq()           // early return: event->oncpu = -1        </IRQ
  WORK>        [...]     =========> TASK B -> TASK A        perf_event_exit_task(tsk)           perf_event_exit_event()              free_event()                 WARN(atomic_long_cmpxchg(&event->refcount,
  1, 0) != 1)                 // leak event due to unexpected refcount == 2  As a result the
  event is never released while the task exits.  Fix this with appropriate task_work_add()''s
  error handling.'
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.106-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.223-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/0
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.10.3-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.15-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
