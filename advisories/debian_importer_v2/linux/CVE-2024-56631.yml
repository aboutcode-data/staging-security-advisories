advisory_id: linux/CVE-2024-56631
datasource_id: debian_importer_v2/linux/CVE-2024-56631
datasource_url: https://security-tracker.debian.org/tracker/CVE-2024-56631
aliases:
  - CVE-2024-56631
summary: 'In the Linux kernel, the following vulnerability has been resolved:  scsi: sg: Fix
  slab-use-after-free read in sg_release()  Fix a use-after-free bug in sg_release(), detected
  by syzbot with KASAN:  BUG: KASAN: slab-use-after-free in lock_release+0x151/0xa30 kernel/locking/lockdep.c:5838
  __mutex_unlock_slowpath+0xe2/0x750 kernel/locking/mutex.c:912 sg_release+0x1f4/0x2e0 drivers/scsi/sg.c:407  In
  sg_release(), the function kref_put(&sfp->f_ref, sg_remove_sfp) is called before releasing
  the open_rel_lock mutex. The kref_put() call may decrement the reference count of sfp to zero,
  triggering its cleanup through sg_remove_sfp(). This cleanup includes scheduling deferred
  work via sg_remove_sfp_usercontext(), which ultimately frees sfp.  After kref_put(), sg_release()
  continues to unlock open_rel_lock and may reference sfp or sdp. If sfp has already been freed,
  this results in a slab-use-after-free error.  Move the kref_put(&sfp->f_ref, sg_remove_sfp)
  call after unlocking the open_rel_lock mutex. This ensures:   - No references to sfp or sdp
  occur after the reference count is    decremented.   - Cleanup functions such as sg_remove_sfp()
  and    sg_remove_sfp_usercontext() can safely execute without impacting the    mutex handling
  in sg_release().  The fix has been tested and validated by syzbot. This patch closes the bug
  reported at the following syzkaller link and ensures proper sequencing of resource cleanup
  and mutex operations, eliminating the risk of use-after-free errors in sg_release().'
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.128-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.223-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.234-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.5-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.13-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
