advisory_id: linux/CVE-2022-50838
datasource_id: debian_importer_v2/linux/CVE-2022-50838
datasource_url: https://security-tracker.debian.org/tracker/CVE-2022-50838
aliases:
  - CVE-2022-50838
summary: 'In the Linux kernel, the following vulnerability has been resolved:  net: stream:
  purge sk_error_queue in sk_stream_kill_queues()  Changheon Lee reported TCP socket leaks,
  with a nice repro.  It seems we leak TCP sockets with the following sequence:  1) SOF_TIMESTAMPING_TX_ACK
  is enabled on the socket.     Each ACK will cook an skb put in error queue, from __skb_tstamp_tx().    __skb_tstamp_tx()
  is using skb_clone(), unless    SOF_TIMESTAMPING_OPT_TSONLY was also requested.  2) If the
  application is also using MSG_ZEROCOPY, then we put in the    error queue cloned skbs that
  had a struct ubuf_info attached to them.     Whenever an struct ubuf_info is allocated, sock_zerocopy_alloc()    does
  a sock_hold().     As long as the cloned skbs are still in sk_error_queue,    socket refcount
  is kept elevated.  3) Application closes the socket, while error queue is not empty.  Since
  tcp_close() no longer purges the socket error queue, we might end up with a TCP socket with
  at least one skb in error queue keeping the socket alive forever.  This bug can be (ab)used
  to consume all kernel memory and freeze the host.  We need to purge the error queue, with
  proper synchronization against concurrent writers.'
impacted_packages:
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.159-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.1.4-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.223-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/5.10.178-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.12-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.18.13-1
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/debian/linux?distro=trixie
    affected_versions:
    fixed_versions: vers:deb/6.12.63-1
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references: []
