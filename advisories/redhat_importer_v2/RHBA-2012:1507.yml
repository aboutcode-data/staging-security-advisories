advisory_id: RHBA-2012:1507
datasource_id: redhat_importer_v2/RHBA-2012:1507
datasource_url: https://security.access.redhat.com/data/csaf/v2/advisories/2012/rhba-2012_1507.json
aliases:
  - CVE-2012-5638
summary: |
  Updated sanlock packages that fix various bugs and add various enhancements are now available for Red Hat Enterprise Virtualization.

  The sanlock package provides a shared storage lock manager. Hosts with shared access to a block device or file can use sanlock to synchronize their activities. VDSM and libvirt use sanlock to synchronize access to virtual machine images.

  This updated package fixes the following bugs:

  * The init script was not creating a /var/lock/subsys file, which caused the killall init script to not shut down the daemon. (BZ#841991)

  * The wdmd init script was not loading the softdog module when no other watchdog module was loaded, causing the wdmd and sanlock daemons to fail startup. (BZ#840955)

  * The sanlock daemon was assuming that the uid and gid options were defined, which caused it to segfault during startup if the daemon was started without the uid/gid options. (BZ#841992)

  * The add_lockspace api was difficult to use from an application where multiple threads could be adding the same lockspace. These changes make it possible for the threads to coordinate the lockspace operations. (BZ#841994)

  * The sanlock inquire api was always returning an lver of 0 in the state string, rather than the real lver. This would cause anything to fail that
  tried to acquire a lease with an inquired version, like suspend/resume or migrate. (BZ#841995)

  * This enhancement allows a program to be run against registered processes to suspend them and release their leases as an alternative to sanlock killing them directly. (BZ#840953)

  * The sanlock daemon was running as the root uid, and depending on supplementary groups to allow file access on nfs. Some nfs servers do not recognize the groups and refuse access, so the sanlock daemon is changed to run as the sanlock uid, and use the root helper process to kill registered processes. (BZ#842764)

  * The sanlock log file and daemon pid files did not have the correct permissions. (BZ#849181)

  * The watchdog would not fire at the correct time if the wdmd process was
  killed near the firing time, or killed and restarted near the firing time.
  The time until the watchdog fired was also not being correctly calculated
  by sanlock. (BZ#849183)

  * The sanlock and wdmd daemons maintained a constant connection even when it was not needed.  This prevented them from each being restarted independently for upgrade. (BZ#849184)

  * The paxos code was doing some unnecessary host_id checks when the same host re-acquired a lease after it was uncleanly shut down previously. (BZ#849186)

  All users of sanlock are advised to upgrade to these updated packages, which fix these bugs and add these enhancements.

  For users of Red Hat Enterprise Virtualization Hypervisor these bug fixes and enhancements are included in advisory RHSA-2012:1505:

    https://rhn.redhat.com/errata/RHBA-2012-1505.html
impacted_packages:
  - purl: pkg:rpm/redhat/sanlock-python?arch=x86_64
    affected_versions: vers:rpm/<2.3-4.el6_3
    fixed_versions: vers:rpm/2.3-4.el6_3
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:rpm/redhat/sanlock-lib?arch=x86_64
    affected_versions: vers:rpm/<2.3-4.el6_3
    fixed_versions: vers:rpm/2.3-4.el6_3
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:rpm/redhat/sanlock?arch=x86_64
    affected_versions: vers:rpm/<2.3-4.el6_3
    fixed_versions: vers:rpm/2.3-4.el6_3
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:rpm/redhat/sanlock-devel?arch=x86_64
    affected_versions: vers:rpm/<2.3-4.el6_3
    fixed_versions: vers:rpm/2.3-4.el6_3
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:rpm/redhat/sanlock-debuginfo?arch=x86_64
    affected_versions: vers:rpm/<2.3-4.el6_3
    fixed_versions: vers:rpm/2.3-4.el6_3
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:rpm/redhat/sanlock?arch=src
    affected_versions: vers:rpm/<2.3-4.el6_3
    fixed_versions: vers:rpm/2.3-4.el6_3
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: Low
    scoring_system: rhas
    scoring_elements:
    published_at: None
    url: https://security.access.redhat.com/data/csaf/v2/advisories/2012/rhba-2012_1507.json
weaknesses: []
references:
  - url: https://security.access.redhat.com/data/csaf/v2/advisories/2012/rhba-2012_1507.json
    reference_type:
    reference_id:
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=840953
    reference_type: bug
    reference_id: 840953
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=840955
    reference_type: bug
    reference_id: 840955
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=841991
    reference_type: bug
    reference_id: 841991
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=841992
    reference_type: bug
    reference_id: 841992
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=841994
    reference_type: bug
    reference_id: 841994
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=841995
    reference_type: bug
    reference_id: 841995
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=849181
    reference_type: bug
    reference_id: 849181
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=849183
    reference_type: bug
    reference_id: 849183
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=849184
    reference_type: bug
    reference_id: 849184
  - url: https://bugzilla.redhat.com/show_bug.cgi?id=849186
    reference_type: bug
    reference_id: 849186
  - url: https://rhn.redhat.com/errata/RHBA-2012-1505.html
    reference_type:
    reference_id: RHBA-2012-1505.html
  - url: https://access.redhat.com/errata/RHBA-2012:1507
    reference_type:
    reference_id: RHBA-2012:1507
