advisory_id: CVE-2023-42467
datasource_id: collect_qemu_fix_commits/CVE-2023-42467
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  6b7fa3cbab92097785a7c1c67b3ccb1047ca4919:hw/scsi/scsi-disk: Disallow block sizes smaller than 512 [CVE-2023-42467]

  We are doing things like

      nb_sectors /= (s->qdev.blocksize / BDRV_SECTOR_SIZE);

  in the code here (e.g. in scsi_disk_emulate_mode_sense()), so if
  the blocksize is smaller than BDRV_SECTOR_SIZE (=512), this crashes
  with a division by 0 exception. Thus disallow block sizes of 256
  bytes to avoid this situation.

  Resolves: https://gitlab.com/qemu-project/qemu/-/issues/1813
  CVE: 2023-42467
  Signed-off-by: Thomas Huth <thuth@redhat.com>
  Message-ID: <20230925091854.49198-1-thuth@redhat.com>
  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
  (cherry picked from commit 7cfcc79b0ab800959716738aff9419f53fc68c9c)
  Signed-off-by: Michael Tokarev <mjt@tls.msk.ru>
  66aa4b1b4b14b93cc726082755828ed9265509b2:hw/scsi/scsi-disk: Disallow block sizes smaller than 512 [CVE-2023-42467]

  We are doing things like

      nb_sectors /= (s->qdev.blocksize / BDRV_SECTOR_SIZE);

  in the code here (e.g. in scsi_disk_emulate_mode_sense()), so if
  the blocksize is smaller than BDRV_SECTOR_SIZE (=512), this crashes
  with a division by 0 exception. Thus disallow block sizes of 256
  bytes to avoid this situation.

  Resolves: https://gitlab.com/qemu-project/qemu/-/issues/1813
  CVE: 2023-42467
  Signed-off-by: Thomas Huth <thuth@redhat.com>
  Message-ID: <20230925091854.49198-1-thuth@redhat.com>
  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
  (cherry picked from commit 7cfcc79b0ab800959716738aff9419f53fc68c9c)
  Signed-off-by: Michael Tokarev <mjt@tls.msk.ru>
  5dfd80e38b63dc5bf2202bc87a9b1a3e1460efb9:Merge tag 'for-upstream' of https://gitlab.com/bonzini/qemu into staging

  * new round of audio cleanups
  * various shadowed local variable fixes in vl, mptsas, pm_smbus, target/i386
  * remove deprecated pc-i440fx-1.4 up to pc-i440fx-1.7
  * remove PCI drivers from 128K bios.bin
  * remove unused variable in user-exec-stub.c
  * small fixes for ui/vnc
  * scsi-disk: Disallow block sizes smaller than 512 [CVE-2023-42467]

  # -----BEGIN PGP SIGNATURE-----
  #
  # iQFIBAABCAAyFiEE8TM4V0tmI4mGbHaCv/vSX3jHroMFAmUTDaoUHHBib256aW5p
  # QHJlZGhhdC5jb20ACgkQv/vSX3jHroMvEgf+NrSaP4pmHrYcVtm43fnKXoLHFrCx
  # KYfoK9Lke/DDkTff6rrcfW/Wyqid6Pp9Ch4Rrpr/X71X5gi+c6xb5klC8cpSfLg4
  # gtuGctj7WL7KR/067EsLqHvzBob/iebFhZwhtsBrI+z65X+J9pOK78efBTdhezq4
  # EEHTWohMAg1I/MWBK5VnOk2fI4+9z9K9zP5AtWmJzwwJkQUoEyl+YDkVmIhMYoGn
  # CapRO7i2wIvtoF4wuQUCGsOLmrcWTvRIOcV13k3b6PYCPC40/N9AOpiiyg3XqNah
  # UKKM9CcgVnCzCc4Jar2QD+MzkTDxhmQSyLFJgtzrW7CQSE5YB3sUHj3CXg==
  # =8nvs
  # -----END PGP SIGNATURE-----
  # gpg: Signature made Tue 26 Sep 2023 12:58:18 EDT
  # gpg:                using RSA key F13338574B662389866C7682BFFBD25F78C7AE83
  # gpg:                issuer "pbonzini@redhat.com"
  # gpg: Good signature from "Paolo Bonzini <bonzini@gnu.org>" [full]
  # gpg:                 aka "Paolo Bonzini <pbonzini@redhat.com>" [full]
  # Primary key fingerprint: 46F5 9FBD 57D6 12E7 BFD4  E2F7 7E15 100C CD36 69B1
  #      Subkey fingerprint: F133 3857 4B66 2389 866C  7682 BFFB D25F 78C7 AE83

  * tag 'for-upstream' of https://gitlab.com/bonzini/qemu:
    audio: remove shadowed locals
    compiler: introduce QEMU_ANNOTATE
    block: mark mixed functions that can suspend
    target/i386/svm_helper: eliminate duplicate local variable
    target/i386/seg_helper: remove shadowed variable
    target/i386/seg_helper: introduce tss_set_busy
    target/i386/translate: avoid shadowed local variables
    target/i386/cpu: avoid shadowed local variables
    target/i386/kvm: eliminate shadowed local variables
    m48t59-test: avoid possible overflow on ABS
    pm_smbus: rename variable to avoid shadowing
    mptsas: avoid shadowed local variables
    ui/vnc: fix handling of VNC_FEATURE_XVP
    ui/vnc: fix debug output for invalid audio message
    vl: remove shadowed local variables
    hw/scsi/scsi-disk: Disallow block sizes smaller than 512 [CVE-2023-42467]
    user-exec-stub: remove unused variable
    seabios: remove PCI drivers from bios.bin
    pc_piix: remove pc-i440fx-1.4 up to pc-i440fx-1.7

  Signed-off-by: Stefan Hajnoczi <stefanha@redhat.com>
  5dfd80e38b63dc5bf2202bc87a9b1a3e1460efb9:Merge tag 'for-upstream' of https://gitlab.com/bonzini/qemu into staging

  * new round of audio cleanups
  * various shadowed local variable fixes in vl, mptsas, pm_smbus, target/i386
  * remove deprecated pc-i440fx-1.4 up to pc-i440fx-1.7
  * remove PCI drivers from 128K bios.bin
  * remove unused variable in user-exec-stub.c
  * small fixes for ui/vnc
  * scsi-disk: Disallow block sizes smaller than 512 [CVE-2023-42467]

  # -----BEGIN PGP SIGNATURE-----
  #
  # iQFIBAABCAAyFiEE8TM4V0tmI4mGbHaCv/vSX3jHroMFAmUTDaoUHHBib256aW5p
  # QHJlZGhhdC5jb20ACgkQv/vSX3jHroMvEgf+NrSaP4pmHrYcVtm43fnKXoLHFrCx
  # KYfoK9Lke/DDkTff6rrcfW/Wyqid6Pp9Ch4Rrpr/X71X5gi+c6xb5klC8cpSfLg4
  # gtuGctj7WL7KR/067EsLqHvzBob/iebFhZwhtsBrI+z65X+J9pOK78efBTdhezq4
  # EEHTWohMAg1I/MWBK5VnOk2fI4+9z9K9zP5AtWmJzwwJkQUoEyl+YDkVmIhMYoGn
  # CapRO7i2wIvtoF4wuQUCGsOLmrcWTvRIOcV13k3b6PYCPC40/N9AOpiiyg3XqNah
  # UKKM9CcgVnCzCc4Jar2QD+MzkTDxhmQSyLFJgtzrW7CQSE5YB3sUHj3CXg==
  # =8nvs
  # -----END PGP SIGNATURE-----
  # gpg: Signature made Tue 26 Sep 2023 12:58:18 EDT
  # gpg:                using RSA key F13338574B662389866C7682BFFBD25F78C7AE83
  # gpg:                issuer "pbonzini@redhat.com"
  # gpg: Good signature from "Paolo Bonzini <bonzini@gnu.org>" [full]
  # gpg:                 aka "Paolo Bonzini <pbonzini@redhat.com>" [full]
  # Primary key fingerprint: 46F5 9FBD 57D6 12E7 BFD4  E2F7 7E15 100C CD36 69B1
  #      Subkey fingerprint: F133 3857 4B66 2389 866C  7682 BFFB D25F 78C7 AE83

  * tag 'for-upstream' of https://gitlab.com/bonzini/qemu:
    audio: remove shadowed locals
    compiler: introduce QEMU_ANNOTATE
    block: mark mixed functions that can suspend
    target/i386/svm_helper: eliminate duplicate local variable
    target/i386/seg_helper: remove shadowed variable
    target/i386/seg_helper: introduce tss_set_busy
    target/i386/translate: avoid shadowed local variables
    target/i386/cpu: avoid shadowed local variables
    target/i386/kvm: eliminate shadowed local variables
    m48t59-test: avoid possible overflow on ABS
    pm_smbus: rename variable to avoid shadowing
    mptsas: avoid shadowed local variables
    ui/vnc: fix handling of VNC_FEATURE_XVP
    ui/vnc: fix debug output for invalid audio message
    vl: remove shadowed local variables
    hw/scsi/scsi-disk: Disallow block sizes smaller than 512 [CVE-2023-42467]
    user-exec-stub: remove unused variable
    seabios: remove PCI drivers from bios.bin
    pc_piix: remove pc-i440fx-1.4 up to pc-i440fx-1.7

  Signed-off-by: Stefan Hajnoczi <stefanha@redhat.com>
  7cfcc79b0ab800959716738aff9419f53fc68c9c:hw/scsi/scsi-disk: Disallow block sizes smaller than 512 [CVE-2023-42467]

  We are doing things like

      nb_sectors /= (s->qdev.blocksize / BDRV_SECTOR_SIZE);

  in the code here (e.g. in scsi_disk_emulate_mode_sense()), so if
  the blocksize is smaller than BDRV_SECTOR_SIZE (=512), this crashes
  with a division by 0 exception. Thus disallow block sizes of 256
  bytes to avoid this situation.

  Resolves: https://gitlab.com/qemu-project/qemu/-/issues/1813
  CVE: 2023-42467
  Signed-off-by: Thomas Huth <thuth@redhat.com>
  Message-ID: <20230925091854.49198-1-thuth@redhat.com>
  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 5dfd80e38b63dc5bf2202bc87a9b1a3e1460efb9
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 7cfcc79b0ab800959716738aff9419f53fc68c9c
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 6b7fa3cbab92097785a7c1c67b3ccb1047ca4919
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 66aa4b1b4b14b93cc726082755828ed9265509b2
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
