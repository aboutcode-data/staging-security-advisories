advisory_id: CVE-2018-5683
datasource_id: collect_qemu_fix_commits/CVE-2018-5683
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: "63112b16a6abd31d40df2b9a1dd713b42eb59c6b:vga: check the validation of memory addr\
  \ when draw text\n\nStart a vm with qemu-kvm -enable-kvm -vnc :66 -smp 1 -m 1024 -hda\nredhat_5.11.qcow2\
  \  -device pcnet -vga cirrus,\nthen use VNC client to connect to VM, and excute the code below\
  \ in guest\nOS will lead to qemu crash:\n\nint main()\n {\n    iopl(3);\n    srand(time(NULL));\n\
  \    int a,b;\n    while(1){\n\ta = rand()%0x100;\n\tb = 0x3c0 + (rand()%0x20);\n        outb(a,b);\n\
  \    }\n    return 0;\n}\n\nThe above code is writing the registers of VGA randomly.\nWe can\
  \ write VGA CRT controller registers index 0x0C or 0x0D\n(which is the start address register)\
  \ to modify the\nthe display memory address of the upper left pixel\nor character of the screen.\
  \ The address may be out of the\nrange of vga ram. So we should check the validation of memory\
  \ address\nwhen reading or writing it to avoid segfault.\n\nSigned-off-by: linzhecheng <linzhecheng@huawei.com>\n\
  Message-id: 20180111132724.13744-1-linzhecheng@huawei.com\nFixes: CVE-2018-5683\nSigned-off-by:\
  \ Gerd Hoffmann <kraxel@redhat.com>\n(cherry picked from commit 191f59dc17396bb5a8da50f8c59b6e0a430711a4)\n\
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>\nb3bbe959b5dc3bf07041946455cc8e8d562bfd1f:Merge\
  \ remote-tracking branch 'remotes/kraxel/tags/vga-20180125-pull-request' into staging\n\n\
  vga: fix for CVE-2018-5683\n\n# gpg: Signature made Thu 25 Jan 2018 09:33:23 GMT\n# gpg: \
  \               using RSA key 0x4CB6D8EED3E87138\n# gpg: Good signature from \"Gerd Hoffmann\
  \ (work) <kraxel@redhat.com>\"\n# gpg:                 aka \"Gerd Hoffmann <gerd@kraxel.org>\"\
  \n# gpg:                 aka \"Gerd Hoffmann (private) <kraxel@gmail.com>\"\n# Primary key\
  \ fingerprint: A032 8CFF B93A 17A7 9901  FE7D 4CB6 D8EE D3E8 7138\n\n* remotes/kraxel/tags/vga-20180125-pull-request:\n\
  \  vga: check the validation of memory addr when draw text\n\nSigned-off-by: Peter Maydell\
  \ <peter.maydell@linaro.org>\n191f59dc17396bb5a8da50f8c59b6e0a430711a4:vga: check the validation\
  \ of memory addr when draw text\n\nStart a vm with qemu-kvm -enable-kvm -vnc :66 -smp 1 -m\
  \ 1024 -hda\nredhat_5.11.qcow2  -device pcnet -vga cirrus,\nthen use VNC client to connect\
  \ to VM, and excute the code below in guest\nOS will lead to qemu crash:\n\nint main()\n {\n\
  \    iopl(3);\n    srand(time(NULL));\n    int a,b;\n    while(1){\n\ta = rand()%0x100;\n\t\
  b = 0x3c0 + (rand()%0x20);\n        outb(a,b);\n    }\n    return 0;\n}\n\nThe above code\
  \ is writing the registers of VGA randomly.\nWe can write VGA CRT controller registers index\
  \ 0x0C or 0x0D\n(which is the start address register) to modify the\nthe display memory address\
  \ of the upper left pixel\nor character of the screen. The address may be out of the\nrange\
  \ of vga ram. So we should check the validation of memory address\nwhen reading or writing\
  \ it to avoid segfault.\n\nSigned-off-by: linzhecheng <linzhecheng@huawei.com>\nMessage-id:\
  \ 20180111132724.13744-1-linzhecheng@huawei.com\nFixes: CVE-2018-5683\nSigned-off-by: Gerd\
  \ Hoffmann <kraxel@redhat.com>"
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 63112b16a6abd31d40df2b9a1dd713b42eb59c6b
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: '191f59dc17396bb5a8da50f8c59b6e0a430711a4'
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: b3bbe959b5dc3bf07041946455cc8e8d562bfd1f
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
