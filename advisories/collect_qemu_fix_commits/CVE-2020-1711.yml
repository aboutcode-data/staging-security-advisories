advisory_id: CVE-2020-1711
datasource_id: collect_qemu_fix_commits/CVE-2020-1711
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  4e98c388d6b07a7b8b760491b07bcfd887c35e23:iscsi: Cap block count from GET LBA STATUS (CVE-2020-1711)

  When querying an iSCSI server for the provisioning status of blocks (via
  GET LBA STATUS), Qemu only validates that the response descriptor zero's
  LBA matches the one requested. Given the SCSI spec allows servers to
  respond with the status of blocks beyond the end of the LUN, Qemu may
  have its heap corrupted by clearing/setting too many bits at the end of
  its allocmap for the LUN.

  A malicious guest in control of the iSCSI server could carefully program
  Qemu's heap (by selectively setting the bitmap) and then smash it.

  This limits the number of bits that iscsi_co_block_status() will try to
  update in the allocmap so it can't overflow the bitmap.

  Fixes: CVE-2020-1711
  Cc: qemu-stable@nongnu.org
  Signed-off-by: Felipe Franciosi <felipe@nutanix.com>
  Signed-off-by: Peter Turschmid <peter.turschm@nutanix.com>
  Signed-off-by: Raphael Norwitz <raphael.norwitz@nutanix.com>
  Signed-off-by: Kevin Wolf <kwolf@redhat.com>
  (cherry picked from commit 693fd2acdf14dd86c0bf852610f1c2cca80a74dc)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  4e98c388d6b07a7b8b760491b07bcfd887c35e23:iscsi: Cap block count from GET LBA STATUS (CVE-2020-1711)

  When querying an iSCSI server for the provisioning status of blocks (via
  GET LBA STATUS), Qemu only validates that the response descriptor zero's
  LBA matches the one requested. Given the SCSI spec allows servers to
  respond with the status of blocks beyond the end of the LUN, Qemu may
  have its heap corrupted by clearing/setting too many bits at the end of
  its allocmap for the LUN.

  A malicious guest in control of the iSCSI server could carefully program
  Qemu's heap (by selectively setting the bitmap) and then smash it.

  This limits the number of bits that iscsi_co_block_status() will try to
  update in the allocmap so it can't overflow the bitmap.

  Fixes: CVE-2020-1711
  Cc: qemu-stable@nongnu.org
  Signed-off-by: Felipe Franciosi <felipe@nutanix.com>
  Signed-off-by: Peter Turschmid <peter.turschm@nutanix.com>
  Signed-off-by: Raphael Norwitz <raphael.norwitz@nutanix.com>
  Signed-off-by: Kevin Wolf <kwolf@redhat.com>
  (cherry picked from commit 693fd2acdf14dd86c0bf852610f1c2cca80a74dc)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  750fe5989f9efffce86368c6feac013f8b7b433c:Merge remote-tracking branch 'remotes/kevin/tags/for-upstream' into staging

  Block layer patches:

  - iscsi: Cap block count from GET LBA STATUS (CVE-2020-1711)
  - AioContext fixes in QMP commands for backup and bitmaps
  - iotests fixes

  # gpg: Signature made Mon 27 Jan 2020 17:49:58 GMT
  # gpg:                using RSA key 7F09B272C88F2FD6
  # gpg: Good signature from "Kevin Wolf <kwolf@redhat.com>" [full]
  # Primary key fingerprint: DC3D EB15 9A9A F95D 3D74  56FE 7F09 B272 C88F 2FD6

  * remotes/kevin/tags/for-upstream:
    iscsi: Don't access non-existent scsi_lba_status_descriptor
    iscsi: Cap block count from GET LBA STATUS (CVE-2020-1711)
    block/backup: fix memory leak in bdrv_backup_top_append()
    iotests: Test handling of AioContexts with some blockdev actions
    blockdev: Return bs to the proper context on snapshot abort
    blockdev: Acquire AioContext on dirty bitmap functions
    block/backup-top: Don't acquire context while dropping top
    blockdev: honor bdrv_try_set_aio_context() context requirements
    blockdev: unify qmp_blockdev_backup and blockdev-backup transaction paths
    blockdev: unify qmp_drive_backup and drive-backup transaction paths
    blockdev: fix coding style issues in drive_backup_prepare
    iotests: Add more "skip_if_unsupported" statements to the python tests
    iotests.py: Let wait_migration wait even more

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  750fe5989f9efffce86368c6feac013f8b7b433c:Merge remote-tracking branch 'remotes/kevin/tags/for-upstream' into staging

  Block layer patches:

  - iscsi: Cap block count from GET LBA STATUS (CVE-2020-1711)
  - AioContext fixes in QMP commands for backup and bitmaps
  - iotests fixes

  # gpg: Signature made Mon 27 Jan 2020 17:49:58 GMT
  # gpg:                using RSA key 7F09B272C88F2FD6
  # gpg: Good signature from "Kevin Wolf <kwolf@redhat.com>" [full]
  # Primary key fingerprint: DC3D EB15 9A9A F95D 3D74  56FE 7F09 B272 C88F 2FD6

  * remotes/kevin/tags/for-upstream:
    iscsi: Don't access non-existent scsi_lba_status_descriptor
    iscsi: Cap block count from GET LBA STATUS (CVE-2020-1711)
    block/backup: fix memory leak in bdrv_backup_top_append()
    iotests: Test handling of AioContexts with some blockdev actions
    blockdev: Return bs to the proper context on snapshot abort
    blockdev: Acquire AioContext on dirty bitmap functions
    block/backup-top: Don't acquire context while dropping top
    blockdev: honor bdrv_try_set_aio_context() context requirements
    blockdev: unify qmp_blockdev_backup and blockdev-backup transaction paths
    blockdev: unify qmp_drive_backup and drive-backup transaction paths
    blockdev: fix coding style issues in drive_backup_prepare
    iotests: Add more "skip_if_unsupported" statements to the python tests
    iotests.py: Let wait_migration wait even more

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  693fd2acdf14dd86c0bf852610f1c2cca80a74dc:iscsi: Cap block count from GET LBA STATUS (CVE-2020-1711)

  When querying an iSCSI server for the provisioning status of blocks (via
  GET LBA STATUS), Qemu only validates that the response descriptor zero's
  LBA matches the one requested. Given the SCSI spec allows servers to
  respond with the status of blocks beyond the end of the LUN, Qemu may
  have its heap corrupted by clearing/setting too many bits at the end of
  its allocmap for the LUN.

  A malicious guest in control of the iSCSI server could carefully program
  Qemu's heap (by selectively setting the bitmap) and then smash it.

  This limits the number of bits that iscsi_co_block_status() will try to
  update in the allocmap so it can't overflow the bitmap.

  Fixes: CVE-2020-1711
  Cc: qemu-stable@nongnu.org
  Signed-off-by: Felipe Franciosi <felipe@nutanix.com>
  Signed-off-by: Peter Turschmid <peter.turschm@nutanix.com>
  Signed-off-by: Raphael Norwitz <raphael.norwitz@nutanix.com>
  Signed-off-by: Kevin Wolf <kwolf@redhat.com>
  693fd2acdf14dd86c0bf852610f1c2cca80a74dc:iscsi: Cap block count from GET LBA STATUS (CVE-2020-1711)

  When querying an iSCSI server for the provisioning status of blocks (via
  GET LBA STATUS), Qemu only validates that the response descriptor zero's
  LBA matches the one requested. Given the SCSI spec allows servers to
  respond with the status of blocks beyond the end of the LUN, Qemu may
  have its heap corrupted by clearing/setting too many bits at the end of
  its allocmap for the LUN.

  A malicious guest in control of the iSCSI server could carefully program
  Qemu's heap (by selectively setting the bitmap) and then smash it.

  This limits the number of bits that iscsi_co_block_status() will try to
  update in the allocmap so it can't overflow the bitmap.

  Fixes: CVE-2020-1711
  Cc: qemu-stable@nongnu.org
  Signed-off-by: Felipe Franciosi <felipe@nutanix.com>
  Signed-off-by: Peter Turschmid <peter.turschm@nutanix.com>
  Signed-off-by: Raphael Norwitz <raphael.norwitz@nutanix.com>
  Signed-off-by: Kevin Wolf <kwolf@redhat.com>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 750fe5989f9efffce86368c6feac013f8b7b433c
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 4e98c388d6b07a7b8b760491b07bcfd887c35e23
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 693fd2acdf14dd86c0bf852610f1c2cca80a74dc
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
