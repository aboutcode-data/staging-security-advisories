advisory_id: CVE-2020-14364
datasource_id: collect_qemu_fix_commits/CVE-2020-14364
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  f243bb4b0d6dab7da3ae8490e0f46054bae93816:usb: fix setup_len init (CVE-2020-14364)

  Store calculated setup_len in a local variable, verify it, and only
  write it to the struct (USBDevice->setup_len) in case it passed the
  sanity checks.

  This prevents other code (do_token_{in,out} functions specifically)
  from working with invalid USBDevice->setup_len values and overrunning
  the USBDevice->setup_buf[] buffer.

  Fixes: CVE-2020-14364
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Tested-by: Gonglei <arei.gonglei@huawei.com>
  Reviewed-by: Li Qiang <liq3ea@gmail.com>
  Message-id: 20200825053636.29648-1-kraxel@redhat.com
  (cherry picked from commit b946434f2659a182afc17e155be6791ebfb302eb)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  f243bb4b0d6dab7da3ae8490e0f46054bae93816:usb: fix setup_len init (CVE-2020-14364)

  Store calculated setup_len in a local variable, verify it, and only
  write it to the struct (USBDevice->setup_len) in case it passed the
  sanity checks.

  This prevents other code (do_token_{in,out} functions specifically)
  from working with invalid USBDevice->setup_len values and overrunning
  the USBDevice->setup_buf[] buffer.

  Fixes: CVE-2020-14364
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Tested-by: Gonglei <arei.gonglei@huawei.com>
  Reviewed-by: Li Qiang <liq3ea@gmail.com>
  Message-id: 20200825053636.29648-1-kraxel@redhat.com
  (cherry picked from commit b946434f2659a182afc17e155be6791ebfb302eb)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  2f4c51c0f384d7888a04b4815861e6d5fd244d75:Merge remote-tracking branch 'remotes/kraxel/tags/usb-20200831-pull-request' into staging

  usb: usb_packet_map fixes for ehci and xhci.
  usb: setup_len fix (CVE-2020-14364).
  usb: u2f key support (GSoC).
   * v2: 32bit build fixed.
   * v3: libu2f-emu dependency fixed.

  # gpg: Signature made Mon 31 Aug 2020 09:32:49 BST
  # gpg:                using RSA key 4CB6D8EED3E87138
  # gpg: Good signature from "Gerd Hoffmann (work) <kraxel@redhat.com>" [full]
  # gpg:                 aka "Gerd Hoffmann <gerd@kraxel.org>" [full]
  # gpg:                 aka "Gerd Hoffmann (private) <kraxel@gmail.com>" [full]
  # Primary key fingerprint: A032 8CFF B93A 17A7 9901  FE7D 4CB6 D8EE D3E8 7138

  * remotes/kraxel/tags/usb-20200831-pull-request:
    usb: fix setup_len init (CVE-2020-14364)
    usb-host: workaround libusb bug
    hw/usb: Add U2F device autoscan to passthru mode
    hw/usb: Add U2F device check to passthru mode
    scripts: Add u2f-setup-gen script
    docs/qdev-device-use.txt: Add USB U2F key to the QDEV devices examples
    docs/system: Add U2F key to the USB devices examples
    meson: Add U2F key to meson
    hw/usb: Add U2F key emulated mode
    hw/usb: Add U2F key passthru mode
    hw/usb: Add U2F key base class implementation
    hw/usb: Add U2F key base class
    docs: Add USB U2F key device documentation
    hw/usb: Regroup USB HID protocol values
    ehci: drop pointless warn_report for guest bugs.
    hw: ehci: check return value of 'usb_packet_map'
    hw: ehci: destroy sglist in error path
    hw: xhci: check return value of 'usb_packet_map'

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  2f4c51c0f384d7888a04b4815861e6d5fd244d75:Merge remote-tracking branch 'remotes/kraxel/tags/usb-20200831-pull-request' into staging

  usb: usb_packet_map fixes for ehci and xhci.
  usb: setup_len fix (CVE-2020-14364).
  usb: u2f key support (GSoC).
   * v2: 32bit build fixed.
   * v3: libu2f-emu dependency fixed.

  # gpg: Signature made Mon 31 Aug 2020 09:32:49 BST
  # gpg:                using RSA key 4CB6D8EED3E87138
  # gpg: Good signature from "Gerd Hoffmann (work) <kraxel@redhat.com>" [full]
  # gpg:                 aka "Gerd Hoffmann <gerd@kraxel.org>" [full]
  # gpg:                 aka "Gerd Hoffmann (private) <kraxel@gmail.com>" [full]
  # Primary key fingerprint: A032 8CFF B93A 17A7 9901  FE7D 4CB6 D8EE D3E8 7138

  * remotes/kraxel/tags/usb-20200831-pull-request:
    usb: fix setup_len init (CVE-2020-14364)
    usb-host: workaround libusb bug
    hw/usb: Add U2F device autoscan to passthru mode
    hw/usb: Add U2F device check to passthru mode
    scripts: Add u2f-setup-gen script
    docs/qdev-device-use.txt: Add USB U2F key to the QDEV devices examples
    docs/system: Add U2F key to the USB devices examples
    meson: Add U2F key to meson
    hw/usb: Add U2F key emulated mode
    hw/usb: Add U2F key passthru mode
    hw/usb: Add U2F key base class implementation
    hw/usb: Add U2F key base class
    docs: Add USB U2F key device documentation
    hw/usb: Regroup USB HID protocol values
    ehci: drop pointless warn_report for guest bugs.
    hw: ehci: check return value of 'usb_packet_map'
    hw: ehci: destroy sglist in error path
    hw: xhci: check return value of 'usb_packet_map'

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  b946434f2659a182afc17e155be6791ebfb302eb:usb: fix setup_len init (CVE-2020-14364)

  Store calculated setup_len in a local variable, verify it, and only
  write it to the struct (USBDevice->setup_len) in case it passed the
  sanity checks.

  This prevents other code (do_token_{in,out} functions specifically)
  from working with invalid USBDevice->setup_len values and overrunning
  the USBDevice->setup_buf[] buffer.

  Fixes: CVE-2020-14364
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Tested-by: Gonglei <arei.gonglei@huawei.com>
  Reviewed-by: Li Qiang <liq3ea@gmail.com>
  Message-id: 20200825053636.29648-1-kraxel@redhat.com
  b946434f2659a182afc17e155be6791ebfb302eb:usb: fix setup_len init (CVE-2020-14364)

  Store calculated setup_len in a local variable, verify it, and only
  write it to the struct (USBDevice->setup_len) in case it passed the
  sanity checks.

  This prevents other code (do_token_{in,out} functions specifically)
  from working with invalid USBDevice->setup_len values and overrunning
  the USBDevice->setup_buf[] buffer.

  Fixes: CVE-2020-14364
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Tested-by: Gonglei <arei.gonglei@huawei.com>
  Reviewed-by: Li Qiang <liq3ea@gmail.com>
  Message-id: 20200825053636.29648-1-kraxel@redhat.com
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: b946434f2659a182afc17e155be6791ebfb302eb
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 2f4c51c0f384d7888a04b4815861e6d5fd244d75
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: f243bb4b0d6dab7da3ae8490e0f46054bae93816
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
