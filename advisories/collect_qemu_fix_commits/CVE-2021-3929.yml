advisory_id: CVE-2021-3929
datasource_id: collect_qemu_fix_commits/CVE-2021-3929
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  cc6721e449c4c5a9a5007ad8a810f7f54143eadc:Merge remote-tracking branch 'remotes/nvme/tags/nvme-next-pull-request' into staging

  hw/nvme updates

    - fix CVE-2021-3929
    - add zone random write area support
    - misc cleanups from Philippe

  # gpg: Signature made Mon 14 Feb 2022 08:01:34 GMT
  # gpg:                using RSA key 522833AA75E2DCE6A24766C04DE1AF316D4F0DE9
  # gpg: Good signature from "Klaus Jensen <its@irrelevant.dk>" [unknown]
  # gpg:                 aka "Klaus Jensen <k.jensen@samsung.com>" [unknown]
  # gpg: WARNING: This key is not certified with a trusted signature!
  # gpg:          There is no indication that the signature belongs to the owner.
  # Primary key fingerprint: DDCA 4D9C 9EF9 31CC 3468  4272 63D5 6FC5 E55D A838
  #      Subkey fingerprint: 5228 33AA 75E2 DCE6 A247  66C0 4DE1 AF31 6D4F 0DE9

  * remotes/nvme/tags/nvme-next-pull-request:
    hw/nvme: add support for zoned random write area
    hw/nvme: add ozcs enum
    hw/nvme: add struct for zone management send
    hw/nvme/ctrl: Pass buffers as 'void *' types
    hw/nvme/ctrl: Have nvme_addr_write() take const buffer
    hw/nvme: fix CVE-2021-3929

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  cc6721e449c4c5a9a5007ad8a810f7f54143eadc:Merge remote-tracking branch 'remotes/nvme/tags/nvme-next-pull-request' into staging

  hw/nvme updates

    - fix CVE-2021-3929
    - add zone random write area support
    - misc cleanups from Philippe

  # gpg: Signature made Mon 14 Feb 2022 08:01:34 GMT
  # gpg:                using RSA key 522833AA75E2DCE6A24766C04DE1AF316D4F0DE9
  # gpg: Good signature from "Klaus Jensen <its@irrelevant.dk>" [unknown]
  # gpg:                 aka "Klaus Jensen <k.jensen@samsung.com>" [unknown]
  # gpg: WARNING: This key is not certified with a trusted signature!
  # gpg:          There is no indication that the signature belongs to the owner.
  # Primary key fingerprint: DDCA 4D9C 9EF9 31CC 3468  4272 63D5 6FC5 E55D A838
  #      Subkey fingerprint: 5228 33AA 75E2 DCE6 A247  66C0 4DE1 AF31 6D4F 0DE9

  * remotes/nvme/tags/nvme-next-pull-request:
    hw/nvme: add support for zoned random write area
    hw/nvme: add ozcs enum
    hw/nvme: add struct for zone management send
    hw/nvme/ctrl: Pass buffers as 'void *' types
    hw/nvme/ctrl: Have nvme_addr_write() take const buffer
    hw/nvme: fix CVE-2021-3929

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  736b01642d85be832385063f278fe7cd4ffb5221:hw/nvme: fix CVE-2021-3929

  This fixes CVE-2021-3929 "locally" by denying DMA to the iomem of the
  device itself. This still allows DMA to MMIO regions of other devices
  (e.g. doing P2P DMA to the controller memory buffer of another NVMe
  device).

  Fixes: CVE-2021-3929
  Reported-by: Qiuhao Li <Qiuhao.Li@outlook.com>
  Reviewed-by: Keith Busch <kbusch@kernel.org>
  Reviewed-by: Philippe Mathieu-Daudé <f4bug@amsat.org>
  Signed-off-by: Klaus Jensen <k.jensen@samsung.com>
  736b01642d85be832385063f278fe7cd4ffb5221:hw/nvme: fix CVE-2021-3929

  This fixes CVE-2021-3929 "locally" by denying DMA to the iomem of the
  device itself. This still allows DMA to MMIO regions of other devices
  (e.g. doing P2P DMA to the controller memory buffer of another NVMe
  device).

  Fixes: CVE-2021-3929
  Reported-by: Qiuhao Li <Qiuhao.Li@outlook.com>
  Reviewed-by: Keith Busch <kbusch@kernel.org>
  Reviewed-by: Philippe Mathieu-Daudé <f4bug@amsat.org>
  Signed-off-by: Klaus Jensen <k.jensen@samsung.com>
  736b01642d85be832385063f278fe7cd4ffb5221:hw/nvme: fix CVE-2021-3929

  This fixes CVE-2021-3929 "locally" by denying DMA to the iomem of the
  device itself. This still allows DMA to MMIO regions of other devices
  (e.g. doing P2P DMA to the controller memory buffer of another NVMe
  device).

  Fixes: CVE-2021-3929
  Reported-by: Qiuhao Li <Qiuhao.Li@outlook.com>
  Reviewed-by: Keith Busch <kbusch@kernel.org>
  Reviewed-by: Philippe Mathieu-Daudé <f4bug@amsat.org>
  Signed-off-by: Klaus Jensen <k.jensen@samsung.com>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: cc6721e449c4c5a9a5007ad8a810f7f54143eadc
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 736b01642d85be832385063f278fe7cd4ffb5221
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
