advisory_id: CVE-2016-4454
datasource_id: collect_qemu_fix_commits/CVE-2016-4454
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  71798fda8b6ef8df47c7640ba0bc24d7060ad307:vmsvga: shadow fifo registers

  The fifo is normal ram.  So kvm vcpu threads and qemu iothread can
  access the fifo in parallel without syncronization.  Which in turn
  implies we can't use the fifo pointers in-place because the guest
  can try changing them underneath us.  So add shadows for them, to
  make sure the guest can't modify them after we've applied sanity
  checks.

  Fixes: CVE-2016-4454
  Cc: qemu-stable@nongnu.org
  Cc: P J P <ppandit@redhat.com>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Message-id: 1464592161-18348-4-git-send-email-kraxel@redhat.com
  (cherry picked from commit 7e486f7577764a07aa35588e119903c80a5c30a2)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  3141be668fa508f08d76de576c381692bccd99ad:vmsvga: add more fifo checks

  Make sure all fifo ptrs are within range.

  Fixes: CVE-2016-4454
  Cc: qemu-stable@nongnu.org
  Cc: P J P <ppandit@redhat.com>
  Reported-by: 李强 <liqiang6-s@360.cn>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Message-id: 1464592161-18348-3-git-send-email-kraxel@redhat.com
  (cherry picked from commit c2e3c54d3960bc53bfa3a5ce7ea7a050b9be267e)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  394647d7116703615e0c05a1710c4c77f2b5926a:vmsvga: move fifo sanity checks to vmsvga_fifo_length

  Sanity checks are applied when the fifo is enabled by the guest
  (SVGA_REG_CONFIG_DONE write).  Which doesn't help much if the guest
  changes the fifo registers afterwards.  Move the checks to
  vmsvga_fifo_length so they are done each time qemu is about to read
  from the fifo.

  Fixes: CVE-2016-4454
  Cc: qemu-stable@nongnu.org
  Cc: P J P <ppandit@redhat.com>
  Reported-by: 李强 <liqiang6-s@360.cn>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Message-id: 1464592161-18348-2-git-send-email-kraxel@redhat.com
  (cherry picked from commit 521360267876d3b6518b328051a2e56bca55bef8)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  7e486f7577764a07aa35588e119903c80a5c30a2:vmsvga: shadow fifo registers

  The fifo is normal ram.  So kvm vcpu threads and qemu iothread can
  access the fifo in parallel without syncronization.  Which in turn
  implies we can't use the fifo pointers in-place because the guest
  can try changing them underneath us.  So add shadows for them, to
  make sure the guest can't modify them after we've applied sanity
  checks.

  Fixes: CVE-2016-4454
  Cc: qemu-stable@nongnu.org
  Cc: P J P <ppandit@redhat.com>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Message-id: 1464592161-18348-4-git-send-email-kraxel@redhat.com
  c2e3c54d3960bc53bfa3a5ce7ea7a050b9be267e:vmsvga: add more fifo checks

  Make sure all fifo ptrs are within range.

  Fixes: CVE-2016-4454
  Cc: qemu-stable@nongnu.org
  Cc: P J P <ppandit@redhat.com>
  Reported-by: 李强 <liqiang6-s@360.cn>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Message-id: 1464592161-18348-3-git-send-email-kraxel@redhat.com
  521360267876d3b6518b328051a2e56bca55bef8:vmsvga: move fifo sanity checks to vmsvga_fifo_length

  Sanity checks are applied when the fifo is enabled by the guest
  (SVGA_REG_CONFIG_DONE write).  Which doesn't help much if the guest
  changes the fifo registers afterwards.  Move the checks to
  vmsvga_fifo_length so they are done each time qemu is about to read
  from the fifo.

  Fixes: CVE-2016-4454
  Cc: qemu-stable@nongnu.org
  Cc: P J P <ppandit@redhat.com>
  Reported-by: 李强 <liqiang6-s@360.cn>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Message-id: 1464592161-18348-2-git-send-email-kraxel@redhat.com
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 7e486f7577764a07aa35588e119903c80a5c30a2
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 521360267876d3b6518b328051a2e56bca55bef8
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 71798fda8b6ef8df47c7640ba0bc24d7060ad307
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 3141be668fa508f08d76de576c381692bccd99ad
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: c2e3c54d3960bc53bfa3a5ce7ea7a050b9be267e
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 394647d7116703615e0c05a1710c4c77f2b5926a
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
