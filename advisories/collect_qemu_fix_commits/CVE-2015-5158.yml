advisory_id: CVE-2015-5158
datasource_id: collect_qemu_fix_commits/CVE-2015-5158
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  961c74a841ae6d2ef03f6684c9f74fbdf8f472b1:scsi: fix buffer overflow in scsi_req_parse_cdb (CVE-2015-5158)

  This is a guest-triggerable buffer overflow present in QEMU 2.2.0
  and newer.  scsi_cdb_length returns -1 as an error value, but the
  caller does not check it.

  Luckily, the massive overflow means that QEMU will just SIGSEGV,
  making the impact much smaller.

  Reported-by: Zhu Donghai (朱东海) <donghai.zdh@alibaba-inc.com>
  Fixes: 1894df02811f6b79ea3ffbf1084599d96f316173
  Reviewed-by: Fam Zheng <famz@redhat.com>
  Cc: qemu-stable@nongnu.org
  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
  (cherry picked from commit c170aad8b057223b1139d72e5ce7acceafab4fa9)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  f793d97e454a56d17e404004867985622ca1a63b:Merge remote-tracking branch 'remotes/bonzini/tags/for-upstream' into staging

  * qemu-char fixes
  * SCSI fixes (including CVE-2015-5158)
  * RCU fixes
  * Framebuffer logic to set DIRTY_MEMORY_VGA
  * Fix compiler warning for --disable-vnc
  * qemu-doc fixes
  * x86 TCG pasto fix

  # gpg: Signature made Fri Jul 24 12:57:52 2015 BST using RSA key ID 78C7AE83
  # gpg: Good signature from "Paolo Bonzini <bonzini@gnu.org>"
  # gpg:                 aka "Paolo Bonzini <pbonzini@redhat.com>"
  # gpg: WARNING: This key is not certified with sufficiently trusted signatures!
  # gpg:          It is not certain that the signature belongs to the owner.
  # Primary key fingerprint: 46F5 9FBD 57D6 12E7 BFD4  E2F7 7E15 100C CD36 69B1
  #      Subkey fingerprint: F133 3857 4B66 2389 866C  7682 BFFB D25F 78C7 AE83

  * remotes/bonzini/tags/for-upstream:
    target-i386/FPU: a misprint in helper_fistll_ST0
    qemu-doc: fix typos
    framebuffer: set DIRTY_MEMORY_VGA on RAM that is used for the framebuffer
    memory: count number of active VGA logging clients
    vl: Fix compiler warning for builds without VNC
    scsi: Handle no media case for scsi_get_configuration
    rcu: actually register threads that have RCU read-side critical sections
    scsi: fix buffer overflow in scsi_req_parse_cdb (CVE-2015-5158)
    vnc: fix memory leak
    qemu-char: Fix missed data on unix socket
    qemu-char: handle EINTR for TCP character devices
    exec.c: Use atomic_rcu_read() to access dispatch in memory_region_section_get_iotlb()

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  f793d97e454a56d17e404004867985622ca1a63b:Merge remote-tracking branch 'remotes/bonzini/tags/for-upstream' into staging

  * qemu-char fixes
  * SCSI fixes (including CVE-2015-5158)
  * RCU fixes
  * Framebuffer logic to set DIRTY_MEMORY_VGA
  * Fix compiler warning for --disable-vnc
  * qemu-doc fixes
  * x86 TCG pasto fix

  # gpg: Signature made Fri Jul 24 12:57:52 2015 BST using RSA key ID 78C7AE83
  # gpg: Good signature from "Paolo Bonzini <bonzini@gnu.org>"
  # gpg:                 aka "Paolo Bonzini <pbonzini@redhat.com>"
  # gpg: WARNING: This key is not certified with sufficiently trusted signatures!
  # gpg:          It is not certain that the signature belongs to the owner.
  # Primary key fingerprint: 46F5 9FBD 57D6 12E7 BFD4  E2F7 7E15 100C CD36 69B1
  #      Subkey fingerprint: F133 3857 4B66 2389 866C  7682 BFFB D25F 78C7 AE83

  * remotes/bonzini/tags/for-upstream:
    target-i386/FPU: a misprint in helper_fistll_ST0
    qemu-doc: fix typos
    framebuffer: set DIRTY_MEMORY_VGA on RAM that is used for the framebuffer
    memory: count number of active VGA logging clients
    vl: Fix compiler warning for builds without VNC
    scsi: Handle no media case for scsi_get_configuration
    rcu: actually register threads that have RCU read-side critical sections
    scsi: fix buffer overflow in scsi_req_parse_cdb (CVE-2015-5158)
    vnc: fix memory leak
    qemu-char: Fix missed data on unix socket
    qemu-char: handle EINTR for TCP character devices
    exec.c: Use atomic_rcu_read() to access dispatch in memory_region_section_get_iotlb()

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  c170aad8b057223b1139d72e5ce7acceafab4fa9:scsi: fix buffer overflow in scsi_req_parse_cdb (CVE-2015-5158)

  This is a guest-triggerable buffer overflow present in QEMU 2.2.0
  and newer.  scsi_cdb_length returns -1 as an error value, but the
  caller does not check it.

  Luckily, the massive overflow means that QEMU will just SIGSEGV,
  making the impact much smaller.

  Reported-by: Zhu Donghai (朱东海) <donghai.zdh@alibaba-inc.com>
  Fixes: 1894df02811f6b79ea3ffbf1084599d96f316173
  Reviewed-by: Fam Zheng <famz@redhat.com>
  Cc: qemu-stable@nongnu.org
  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: c170aad8b057223b1139d72e5ce7acceafab4fa9
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 961c74a841ae6d2ef03f6684c9f74fbdf8f472b1
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: f793d97e454a56d17e404004867985622ca1a63b
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
