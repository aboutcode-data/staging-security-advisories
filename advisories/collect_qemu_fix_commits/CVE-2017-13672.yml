advisory_id: CVE-2017-13672
datasource_id: collect_qemu_fix_commits/CVE-2017-13672
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  9c7714afd7b574245c86c6bad40ecbcc2992aeec:vga: handle cirrus vbe mode wraparounds.

  Commit "3d90c62548 vga: stop passing pointers to vga_draw_line*
  functions" is incomplete.  It doesn't handle the case that the vga
  rendering code tries to create a shared surface, i.e. a pixman image
  backed by vga video memory.  That can not work in case the guest display
  wraps from end of video memory to the start.  So force shadowing in that
  case.  Also adjust the snapshot region calculation.

  Can trigger with cirrus only, when programming vbe modes using the bochs
  api (stdvga, also qxl and virtio-vga in vga compat mode) wrap arounds
  can't happen.

  Fixes: CVE-2017-13672
  Fixes: 3d90c6254863693a6b13d918d2b8682e08bbc681
  Cc: P J P <ppandit@redhat.com>
  Reported-by: David Buchanan <d@vidbuchanan.co.uk>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Message-id: 20171010141323.14049-3-kraxel@redhat.com
  (cherry picked from commit 28f77de26a4f9995458ddeb9d34bb06c0193bdc9)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  28f77de26a4f9995458ddeb9d34bb06c0193bdc9:vga: handle cirrus vbe mode wraparounds.

  Commit "3d90c62548 vga: stop passing pointers to vga_draw_line*
  functions" is incomplete.  It doesn't handle the case that the vga
  rendering code tries to create a shared surface, i.e. a pixman image
  backed by vga video memory.  That can not work in case the guest display
  wraps from end of video memory to the start.  So force shadowing in that
  case.  Also adjust the snapshot region calculation.

  Can trigger with cirrus only, when programming vbe modes using the bochs
  api (stdvga, also qxl and virtio-vga in vga compat mode) wrap arounds
  can't happen.

  Fixes: CVE-2017-13672
  Fixes: 3d90c6254863693a6b13d918d2b8682e08bbc681
  Cc: P J P <ppandit@redhat.com>
  Reported-by: David Buchanan <d@vidbuchanan.co.uk>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Message-id: 20171010141323.14049-3-kraxel@redhat.com
  2965be1f00d88972650b6dc4bdc28976d2c66043:vga: stop passing pointers to vga_draw_line* functions

  Instead pass around the address (aka offset into vga memory).
  Add vga_read_* helper functions which apply vbe_size_mask to
  the address, to make sure the address stays within the valid
  range, similar to the cirrus blitter fixes (commits ffaf857778
  and 026aeffcb4).

  Impact:  DoS for privileged guest users.  qemu crashes with
  a segfault, when hitting the guard page after vga memory
  allocation, while reading vga memory for display updates.

  Fixes: CVE-2017-13672
  Cc: P J P <ppandit@redhat.com>
  Reported-by: David Buchanan <d@vidbuchanan.co.uk>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Message-id: 20170828122906.18993-1-kraxel@redhat.com
  (cherry picked from commit 3d90c6254863693a6b13d918d2b8682e08bbc681)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  3d90c6254863693a6b13d918d2b8682e08bbc681:vga: stop passing pointers to vga_draw_line* functions

  Instead pass around the address (aka offset into vga memory).
  Add vga_read_* helper functions which apply vbe_size_mask to
  the address, to make sure the address stays within the valid
  range, similar to the cirrus blitter fixes (commits ffaf857778
  and 026aeffcb4).

  Impact:  DoS for privileged guest users.  qemu crashes with
  a segfault, when hitting the guard page after vga memory
  allocation, while reading vga memory for display updates.

  Fixes: CVE-2017-13672
  Cc: P J P <ppandit@redhat.com>
  Reported-by: David Buchanan <d@vidbuchanan.co.uk>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Message-id: 20170828122906.18993-1-kraxel@redhat.com
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 3d90c6254863693a6b13d918d2b8682e08bbc681
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 9c7714afd7b574245c86c6bad40ecbcc2992aeec
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 28f77de26a4f9995458ddeb9d34bb06c0193bdc9
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 2965be1f00d88972650b6dc4bdc28976d2c66043
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
