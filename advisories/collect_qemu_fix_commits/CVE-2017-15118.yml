advisory_id: CVE-2017-15118
datasource_id: collect_qemu_fix_commits/CVE-2017-15118
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  227196c1e73a77769dcbc9c3563f4ede7b908ad7:nbd/server: CVE-2017-15118 Stack smash on large export name

  Introduced in commit f37708f6b8 (2.10).  The NBD spec says a client
  can request export names up to 4096 bytes in length, even though
  they should not expect success on names longer than 256.  However,
  qemu hard-codes the limit of 256, and fails to filter out a client
  that probes for a longer name; the result is a stack smash that can
  potentially give an attacker arbitrary control over the qemu
  process.

  The smash can be easily demonstrated with this client:
  $ qemu-io f raw nbd://localhost:10809/$(printf %3000d 1 | tr ' ' a)

  If the qemu NBD server binary (whether the standalone qemu-nbd, or
  the builtin server of QMP nbd-server-start) was compiled with
  -fstack-protector-strong, the ability to exploit the stack smash
  into arbitrary execution is a lot more difficult (but still
  theoretically possible to a determined attacker, perhaps in
  combination with other CVEs).  Still, crashing a running qemu (and
  losing the VM) is bad enough, even if the attacker did not obtain
  full execution control.

  CC: qemu-stable@nongnu.org
  Signed-off-by: Eric Blake <eblake@redhat.com>
  (cherry picked from commit 51ae4f8455c9e32c54770c4ebc25bf86a8128183)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  844496f3e55a2155200fdcf7f6320acef03d4e9f:Merge remote-tracking branch 'remotes/ericb/tags/pull-nbd-2017-11-28' into staging

  nbd patches for 2017-11-28

  Eric Blake - 0/2 fix two NBD server CVEs

  # gpg: Signature made Tue 28 Nov 2017 12:58:29 GMT
  # gpg:                using RSA key 0xA7A16B4A2527436A
  # gpg: Good signature from "Eric Blake <eblake@redhat.com>"
  # gpg:                 aka "Eric Blake (Free Software Programmer) <ebb9@byu.net>"
  # gpg:                 aka "[jpeg image of size 6874]"
  # Primary key fingerprint: 71C2 CC22 B1C4 6029 27D2  F3AA A7A1 6B4A 2527 436A

  * remotes/ericb/tags/pull-nbd-2017-11-28:
    nbd/server: CVE-2017-15118 Stack smash on large export name
    nbd/server: CVE-2017-15119 Reject options larger than 32M

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  51ae4f8455c9e32c54770c4ebc25bf86a8128183:nbd/server: CVE-2017-15118 Stack smash on large export name

  Introduced in commit f37708f6b8 (2.10).  The NBD spec says a client
  can request export names up to 4096 bytes in length, even though
  they should not expect success on names longer than 256.  However,
  qemu hard-codes the limit of 256, and fails to filter out a client
  that probes for a longer name; the result is a stack smash that can
  potentially give an attacker arbitrary control over the qemu
  process.

  The smash can be easily demonstrated with this client:
  $ qemu-io f raw nbd://localhost:10809/$(printf %3000d 1 | tr ' ' a)

  If the qemu NBD server binary (whether the standalone qemu-nbd, or
  the builtin server of QMP nbd-server-start) was compiled with
  -fstack-protector-strong, the ability to exploit the stack smash
  into arbitrary execution is a lot more difficult (but still
  theoretically possible to a determined attacker, perhaps in
  combination with other CVEs).  Still, crashing a running qemu (and
  losing the VM) is bad enough, even if the attacker did not obtain
  full execution control.

  CC: qemu-stable@nongnu.org
  Signed-off-by: Eric Blake <eblake@redhat.com>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 227196c1e73a77769dcbc9c3563f4ede7b908ad7
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 844496f3e55a2155200fdcf7f6320acef03d4e9f
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 51ae4f8455c9e32c54770c4ebc25bf86a8128183
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
