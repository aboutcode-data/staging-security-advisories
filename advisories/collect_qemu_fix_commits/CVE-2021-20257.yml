advisory_id: CVE-2021-20257
datasource_id: collect_qemu_fix_commits/CVE-2021-20257
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  43583f0c079b084ada9214c00125e21bbfc6266a:e1000: fix tx re-entrancy problem

  The fact that the MMIO handler is not re-entrant causes an infinite
  loop under certain conditions:

  Guest write to TDT ->  Loopback -> RX (DMA to TDT) -> TX

  We now eliminate the effect of this problem locally in e1000, by adding
  a boolean in struct E1000State indicating when the TX side is busy. This
  will cause any entering new call to return early instead of interfering
  with the ongoing work, and eliminates any risk of looping.

  This is intended to address CVE-2021-20257.

  Signed-off-by: Jon Maloy <jmaloy@redhat.com>
  Signed-off-by: Jason Wang <jasowang@redhat.com>
  (cherry picked from commit 25ddb946e6301f42cff3094ea1c25fb78813e7e9)
  Signed-off-by: Michael Roth <michael.roth@amd.com>
  25ddb946e6301f42cff3094ea1c25fb78813e7e9:e1000: fix tx re-entrancy problem

  The fact that the MMIO handler is not re-entrant causes an infinite
  loop under certain conditions:

  Guest write to TDT ->  Loopback -> RX (DMA to TDT) -> TX

  We now eliminate the effect of this problem locally in e1000, by adding
  a boolean in struct E1000State indicating when the TX side is busy. This
  will cause any entering new call to return early instead of interfering
  with the ongoing work, and eliminates any risk of looping.

  This is intended to address CVE-2021-20257.

  Signed-off-by: Jon Maloy <jmaloy@redhat.com>
  Signed-off-by: Jason Wang <jasowang@redhat.com>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 25ddb946e6301f42cff3094ea1c25fb78813e7e9
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 43583f0c079b084ada9214c00125e21bbfc6266a
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
