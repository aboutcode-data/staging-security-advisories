advisory_id: CVE-2023-3354
datasource_id: collect_qemu_fix_commits/CVE-2023-3354
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  5300472ec0990c61742d89b5eea1c1e6941f6d62:io: remove io watch if TLS channel is closed during handshake

  The TLS handshake make take some time to complete, during which time an
  I/O watch might be registered with the main loop. If the owner of the
  I/O channel invokes qio_channel_close() while the handshake is waiting
  to continue the I/O watch must be removed. Failing to remove it will
  later trigger the completion callback which the owner is not expecting
  to receive. In the case of the VNC server, this results in a SEGV as
  vnc_disconnect_start() tries to shutdown a client connection that is
  already gone / NULL.

  CVE-2023-3354
  Reported-by: jiangyegen <jiangyegen@huawei.com>
  Signed-off-by: Daniel P. Berrangé <berrange@redhat.com>
  (cherry picked from commit 10be627d2b5ec2d6b3dce045144aa739eef678b4)
  Signed-off-by: Michael Tokarev <mjt@tls.msk.ru>
  5c6b1b20da7bf55cba27fae15ff7517b887a2e83:io: remove io watch if TLS channel is closed during handshake

  The TLS handshake make take some time to complete, during which time an
  I/O watch might be registered with the main loop. If the owner of the
  I/O channel invokes qio_channel_close() while the handshake is waiting
  to continue the I/O watch must be removed. Failing to remove it will
  later trigger the completion callback which the owner is not expecting
  to receive. In the case of the VNC server, this results in a SEGV as
  vnc_disconnect_start() tries to shutdown a client connection that is
  already gone / NULL.

  CVE-2023-3354
  Reported-by: jiangyegen <jiangyegen@huawei.com>
  Signed-off-by: Daniel P. Berrangé <berrange@redhat.com>
  (cherry picked from commit 10be627d2b5ec2d6b3dce045144aa739eef678b4)
  Signed-off-by: Michael Tokarev <mjt@tls.msk.ru>
  10be627d2b5ec2d6b3dce045144aa739eef678b4:io: remove io watch if TLS channel is closed during handshake

  The TLS handshake make take some time to complete, during which time an
  I/O watch might be registered with the main loop. If the owner of the
  I/O channel invokes qio_channel_close() while the handshake is waiting
  to continue the I/O watch must be removed. Failing to remove it will
  later trigger the completion callback which the owner is not expecting
  to receive. In the case of the VNC server, this results in a SEGV as
  vnc_disconnect_start() tries to shutdown a client connection that is
  already gone / NULL.

  CVE-2023-3354
  Reported-by: jiangyegen <jiangyegen@huawei.com>
  Signed-off-by: Daniel P. Berrangé <berrange@redhat.com>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 10be627d2b5ec2d6b3dce045144aa739eef678b4
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 5300472ec0990c61742d89b5eea1c1e6941f6d62
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 5c6b1b20da7bf55cba27fae15ff7517b887a2e83
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
