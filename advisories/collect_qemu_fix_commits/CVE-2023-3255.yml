advisory_id: CVE-2023-3255
datasource_id: collect_qemu_fix_commits/CVE-2023-3255
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  aada709c26f601a1973d2c1f9880f91dfe75f195:ui/vnc-clipboard: fix inflate_buffer

  Commit d921fea338 ("ui/vnc-clipboard: fix infinite loop in
  inflate_buffer (CVE-2023-3255)") removed this hunk, but it is still
  required, because it can happen that stream.avail_in becomes zero
  before coming across a return value of Z_STREAM_END in the loop.

  This fixes the host->guest direction of the clipboard with noVNC and
  TigerVNC as clients.

  Fixes: d921fea338 ("ui/vnc-clipboard: fix infinite loop in inflate_buffer (CVE-2023-3255)")
  Reported-by: Friedrich Weber <f.weber@proxmox.com>
  Signed-off-by: Fiona Ebner <f.ebner@proxmox.com>
  Acked-by: Marc-André Lureau <marcandre.lureau@redhat.com>
  Message-Id: <20231122125826.228189-1-f.ebner@proxmox.com>
  (cherry picked from commit ebfbf394671163c14e2b24d98f3927a3151d1aff)
  Signed-off-by: Michael Tokarev <mjt@tls.msk.ru>
  aada709c26f601a1973d2c1f9880f91dfe75f195:ui/vnc-clipboard: fix inflate_buffer

  Commit d921fea338 ("ui/vnc-clipboard: fix infinite loop in
  inflate_buffer (CVE-2023-3255)") removed this hunk, but it is still
  required, because it can happen that stream.avail_in becomes zero
  before coming across a return value of Z_STREAM_END in the loop.

  This fixes the host->guest direction of the clipboard with noVNC and
  TigerVNC as clients.

  Fixes: d921fea338 ("ui/vnc-clipboard: fix infinite loop in inflate_buffer (CVE-2023-3255)")
  Reported-by: Friedrich Weber <f.weber@proxmox.com>
  Signed-off-by: Fiona Ebner <f.ebner@proxmox.com>
  Acked-by: Marc-André Lureau <marcandre.lureau@redhat.com>
  Message-Id: <20231122125826.228189-1-f.ebner@proxmox.com>
  (cherry picked from commit ebfbf394671163c14e2b24d98f3927a3151d1aff)
  Signed-off-by: Michael Tokarev <mjt@tls.msk.ru>
  4b2648356f337c1828d03898d38a68c8c3776c88:ui/vnc-clipboard: fix inflate_buffer

  Commit d921fea338 ("ui/vnc-clipboard: fix infinite loop in
  inflate_buffer (CVE-2023-3255)") removed this hunk, but it is still
  required, because it can happen that stream.avail_in becomes zero
  before coming across a return value of Z_STREAM_END in the loop.

  This fixes the host->guest direction of the clipboard with noVNC and
  TigerVNC as clients.

  Fixes: d921fea338 ("ui/vnc-clipboard: fix infinite loop in inflate_buffer (CVE-2023-3255)")
  Reported-by: Friedrich Weber <f.weber@proxmox.com>
  Signed-off-by: Fiona Ebner <f.ebner@proxmox.com>
  Acked-by: Marc-André Lureau <marcandre.lureau@redhat.com>
  Message-Id: <20231122125826.228189-1-f.ebner@proxmox.com>
  (cherry picked from commit ebfbf394671163c14e2b24d98f3927a3151d1aff)
  Signed-off-by: Michael Tokarev <mjt@tls.msk.ru>
  4b2648356f337c1828d03898d38a68c8c3776c88:ui/vnc-clipboard: fix inflate_buffer

  Commit d921fea338 ("ui/vnc-clipboard: fix infinite loop in
  inflate_buffer (CVE-2023-3255)") removed this hunk, but it is still
  required, because it can happen that stream.avail_in becomes zero
  before coming across a return value of Z_STREAM_END in the loop.

  This fixes the host->guest direction of the clipboard with noVNC and
  TigerVNC as clients.

  Fixes: d921fea338 ("ui/vnc-clipboard: fix infinite loop in inflate_buffer (CVE-2023-3255)")
  Reported-by: Friedrich Weber <f.weber@proxmox.com>
  Signed-off-by: Fiona Ebner <f.ebner@proxmox.com>
  Acked-by: Marc-André Lureau <marcandre.lureau@redhat.com>
  Message-Id: <20231122125826.228189-1-f.ebner@proxmox.com>
  (cherry picked from commit ebfbf394671163c14e2b24d98f3927a3151d1aff)
  Signed-off-by: Michael Tokarev <mjt@tls.msk.ru>
  ebfbf394671163c14e2b24d98f3927a3151d1aff:ui/vnc-clipboard: fix inflate_buffer

  Commit d921fea338 ("ui/vnc-clipboard: fix infinite loop in
  inflate_buffer (CVE-2023-3255)") removed this hunk, but it is still
  required, because it can happen that stream.avail_in becomes zero
  before coming across a return value of Z_STREAM_END in the loop.

  This fixes the host->guest direction of the clipboard with noVNC and
  TigerVNC as clients.

  Fixes: d921fea338 ("ui/vnc-clipboard: fix infinite loop in inflate_buffer (CVE-2023-3255)")
  Reported-by: Friedrich Weber <f.weber@proxmox.com>
  Signed-off-by: Fiona Ebner <f.ebner@proxmox.com>
  Acked-by: Marc-André Lureau <marcandre.lureau@redhat.com>
  Message-Id: <20231122125826.228189-1-f.ebner@proxmox.com>
  ebfbf394671163c14e2b24d98f3927a3151d1aff:ui/vnc-clipboard: fix inflate_buffer

  Commit d921fea338 ("ui/vnc-clipboard: fix infinite loop in
  inflate_buffer (CVE-2023-3255)") removed this hunk, but it is still
  required, because it can happen that stream.avail_in becomes zero
  before coming across a return value of Z_STREAM_END in the loop.

  This fixes the host->guest direction of the clipboard with noVNC and
  TigerVNC as clients.

  Fixes: d921fea338 ("ui/vnc-clipboard: fix infinite loop in inflate_buffer (CVE-2023-3255)")
  Reported-by: Friedrich Weber <f.weber@proxmox.com>
  Signed-off-by: Fiona Ebner <f.ebner@proxmox.com>
  Acked-by: Marc-André Lureau <marcandre.lureau@redhat.com>
  Message-Id: <20231122125826.228189-1-f.ebner@proxmox.com>
  35720b3d90866ed4c174eb35762e04a1b9e533d1:ui/vnc-clipboard: fix infinite loop in inflate_buffer (CVE-2023-3255)

  A wrong exit condition may lead to an infinite loop when inflating a
  valid zlib buffer containing some extra bytes in the `inflate_buffer`
  function. The bug only occurs post-authentication. Return the buffer
  immediately if the end of the compressed data has been reached
  (Z_STREAM_END).

  Fixes: CVE-2023-3255
  Fixes: 0bf41cab ("ui/vnc: clipboard support")
  Reported-by: Kevin Denis <kevin.denis@synacktiv.com>
  Signed-off-by: Mauro Matteo Cascella <mcascell@redhat.com>
  Reviewed-by: Marc-André Lureau <marcandre.lureau@redhat.com>
  Tested-by: Marc-André Lureau <marcandre.lureau@redhat.com>
  Message-ID: <20230704084210.101822-1-mcascell@redhat.com>
  (cherry picked from commit d921fea338c1059a27ce7b75309d7a2e485f710b)
  Signed-off-by: Michael Tokarev <mjt@tls.msk.ru>
  35720b3d90866ed4c174eb35762e04a1b9e533d1:ui/vnc-clipboard: fix infinite loop in inflate_buffer (CVE-2023-3255)

  A wrong exit condition may lead to an infinite loop when inflating a
  valid zlib buffer containing some extra bytes in the `inflate_buffer`
  function. The bug only occurs post-authentication. Return the buffer
  immediately if the end of the compressed data has been reached
  (Z_STREAM_END).

  Fixes: CVE-2023-3255
  Fixes: 0bf41cab ("ui/vnc: clipboard support")
  Reported-by: Kevin Denis <kevin.denis@synacktiv.com>
  Signed-off-by: Mauro Matteo Cascella <mcascell@redhat.com>
  Reviewed-by: Marc-André Lureau <marcandre.lureau@redhat.com>
  Tested-by: Marc-André Lureau <marcandre.lureau@redhat.com>
  Message-ID: <20230704084210.101822-1-mcascell@redhat.com>
  (cherry picked from commit d921fea338c1059a27ce7b75309d7a2e485f710b)
  Signed-off-by: Michael Tokarev <mjt@tls.msk.ru>
  8f8a8f20f48e0710d040112ad667b3297b1cd6d5:ui/vnc-clipboard: fix infinite loop in inflate_buffer (CVE-2023-3255)

  A wrong exit condition may lead to an infinite loop when inflating a
  valid zlib buffer containing some extra bytes in the `inflate_buffer`
  function. The bug only occurs post-authentication. Return the buffer
  immediately if the end of the compressed data has been reached
  (Z_STREAM_END).

  Fixes: CVE-2023-3255
  Fixes: 0bf41cab ("ui/vnc: clipboard support")
  Reported-by: Kevin Denis <kevin.denis@synacktiv.com>
  Signed-off-by: Mauro Matteo Cascella <mcascell@redhat.com>
  Reviewed-by: Marc-André Lureau <marcandre.lureau@redhat.com>
  Tested-by: Marc-André Lureau <marcandre.lureau@redhat.com>
  Message-ID: <20230704084210.101822-1-mcascell@redhat.com>
  (cherry picked from commit d921fea338c1059a27ce7b75309d7a2e485f710b)
  Signed-off-by: Michael Tokarev <mjt@tls.msk.ru>
  8f8a8f20f48e0710d040112ad667b3297b1cd6d5:ui/vnc-clipboard: fix infinite loop in inflate_buffer (CVE-2023-3255)

  A wrong exit condition may lead to an infinite loop when inflating a
  valid zlib buffer containing some extra bytes in the `inflate_buffer`
  function. The bug only occurs post-authentication. Return the buffer
  immediately if the end of the compressed data has been reached
  (Z_STREAM_END).

  Fixes: CVE-2023-3255
  Fixes: 0bf41cab ("ui/vnc: clipboard support")
  Reported-by: Kevin Denis <kevin.denis@synacktiv.com>
  Signed-off-by: Mauro Matteo Cascella <mcascell@redhat.com>
  Reviewed-by: Marc-André Lureau <marcandre.lureau@redhat.com>
  Tested-by: Marc-André Lureau <marcandre.lureau@redhat.com>
  Message-ID: <20230704084210.101822-1-mcascell@redhat.com>
  (cherry picked from commit d921fea338c1059a27ce7b75309d7a2e485f710b)
  Signed-off-by: Michael Tokarev <mjt@tls.msk.ru>
  f44ccac2c0c4c8dc8007b8647e50dcfb16fe7cce:Merge tag 'ui-pull-request' of https://gitlab.com/marcandre.lureau/qemu into staging

  ui & audio fixes

  # -----BEGIN PGP SIGNATURE-----
  #
  # iQJQBAABCAA6FiEEh6m9kz+HxgbSdvYt2ujhCXWWnOUFAmS1N6IcHG1hcmNhbmRy
  # ZS5sdXJlYXVAcmVkaGF0LmNvbQAKCRDa6OEJdZac5SYsD/44+FIoik9v478pZDTp
  # CpaezX+DfsW1zee4Ana5eKJkrVld/xEa6i9/msfUHy12bha+kiJ4a6wLu3H4KRZc
  # vX/t6sehG2wNcsV5wLhfcjsKzaNUkYpnxLhIZ0fOYXKA0fSBuM/Bsj6zzGTG6kQA
  # nt/cK58r1wy63V7werZbA7BI8PF0opDUw5SrZqN0GeoN5clbdyLdcXvD50ibvkDf
  # eOVjNQ3QH8IbihmgBVm1wUV8hTuvYRpBmeLJyk7NeR4bnPl3XGIAgtAY8hJL5LdY
  # Bm+I3AuxMSskVcag/22QR8mGR0HhDbf3NZauw4ND3LhSctvNN5syaKHVnY5a9aGe
  # QLVEV9pxXGfqzWQcsD2HmbupRoBihmp6+WsIpV8ZtuSfeD6slyObw+lqarSQL9b5
  # 2C4UFmGCsCOk8rrczZRDp9IWbm23toc/QcQZtg/LhdlCr8nM+7m0XtyEY5WtT3U1
  # 8rJEmjOHHqlD4cVBathc8+ZRjKr8HFRRo1ed6WKMoP6voTsw2fiR7I3Vdc7jO7h9
  # A1lMiMoLdAXi0Q2VqbmBdLMgb4fXtLzYl2mcbzW0aEUm8uyUfDy2bkVIIUopu40M
  # pROmLjaUzUVE3CruckBUCvoYZtJ5hBtvy3W2k8drBNylnP5B8tEqpxpPb+tSFk82
  # xgT6oLp8En8asE293eaACbswuw==
  # =W2Xa
  # -----END PGP SIGNATURE-----
  # gpg: Signature made Mon 17 Jul 2023 01:44:18 PM BST
  # gpg:                using RSA key 87A9BD933F87C606D276F62DDAE8E10975969CE5
  # gpg:                issuer "marcandre.lureau@redhat.com"
  # gpg: Good signature from "Marc-André Lureau <marcandre.lureau@redhat.com>" [full]
  # gpg:                 aka "Marc-André Lureau <marcandre.lureau@gmail.com>" [full]

  * tag 'ui-pull-request' of https://gitlab.com/marcandre.lureau/qemu:
    audio/pw: improve channel position code
    audio/pw: remove wrong comment
    audio/pw: simplify error reporting in stream creation
    audio/pw: add more error reporting
    audio/pw: factorize some common code
    audio/pw: add more details on error
    audio/pw: trace during init before calling pipewire API
    audio/pw: needless check for NULL
    audio/pw: drop needless case statement
    audio/pw: Pipewire->PipeWire case fix for user-visible text
    tests/lcitool: add pipewire
    libvirt-ci: update submodule to cover pipewire
    ui/gtk: skip refresh if new dmabuf has been submitted
    ui/gtk: set scanout-mode right before scheduling draw
    virtio-gpu-udmabuf: correct naming of QemuDmaBuf size properties
    virtio-gpu: replace the surface with null surface when resetting
    ui/gtk: Make sure the right EGL context is currently bound
    ui/vnc-clipboard: fix infinite loop in inflate_buffer (CVE-2023-3255)
    virtio-gpu: fix potential divide-by-zero regression

  Signed-off-by: Richard Henderson <richard.henderson@linaro.org>
  d921fea338c1059a27ce7b75309d7a2e485f710b:ui/vnc-clipboard: fix infinite loop in inflate_buffer (CVE-2023-3255)

  A wrong exit condition may lead to an infinite loop when inflating a
  valid zlib buffer containing some extra bytes in the `inflate_buffer`
  function. The bug only occurs post-authentication. Return the buffer
  immediately if the end of the compressed data has been reached
  (Z_STREAM_END).

  Fixes: CVE-2023-3255
  Fixes: 0bf41cab ("ui/vnc: clipboard support")
  Reported-by: Kevin Denis <kevin.denis@synacktiv.com>
  Signed-off-by: Mauro Matteo Cascella <mcascell@redhat.com>
  Reviewed-by: Marc-André Lureau <marcandre.lureau@redhat.com>
  Tested-by: Marc-André Lureau <marcandre.lureau@redhat.com>
  Message-ID: <20230704084210.101822-1-mcascell@redhat.com>
  d921fea338c1059a27ce7b75309d7a2e485f710b:ui/vnc-clipboard: fix infinite loop in inflate_buffer (CVE-2023-3255)

  A wrong exit condition may lead to an infinite loop when inflating a
  valid zlib buffer containing some extra bytes in the `inflate_buffer`
  function. The bug only occurs post-authentication. Return the buffer
  immediately if the end of the compressed data has been reached
  (Z_STREAM_END).

  Fixes: CVE-2023-3255
  Fixes: 0bf41cab ("ui/vnc: clipboard support")
  Reported-by: Kevin Denis <kevin.denis@synacktiv.com>
  Signed-off-by: Mauro Matteo Cascella <mcascell@redhat.com>
  Reviewed-by: Marc-André Lureau <marcandre.lureau@redhat.com>
  Tested-by: Marc-André Lureau <marcandre.lureau@redhat.com>
  Message-ID: <20230704084210.101822-1-mcascell@redhat.com>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 4b2648356f337c1828d03898d38a68c8c3776c88
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: aada709c26f601a1973d2c1f9880f91dfe75f195
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: f44ccac2c0c4c8dc8007b8647e50dcfb16fe7cce
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: d921fea338c1059a27ce7b75309d7a2e485f710b
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: ebfbf394671163c14e2b24d98f3927a3151d1aff
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 35720b3d90866ed4c174eb35762e04a1b9e533d1
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 8f8a8f20f48e0710d040112ad667b3297b1cd6d5
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
