advisory_id: CVE-2013-4344
datasource_id: collect_qemu_fix_commits/CVE-2013-4344
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  192d2f4cc7931668d4e4f10e882af3c097193c47:scsi_target_send_command(): amend stable-1.6 port of the CVE-2013-4344 fix

  The originally suggested fix for CVE-2013-4344 introduced a regression in
  scsi_target_send_command() / REQUEST_SENSE; the third argument passed to
  scsi_device_get_sense() -- for the "len" parameter -- ignored the
  possibility of the guest SCSI driver requesting truncated (or shorter than
  full) sense data.

  This could result in (r->len > req->cmd.xfer) on return, which is not
  valid SCSI.

  The problem was addressed in the second round, and the commit on the
  master branch (84642435) is correct. However the stable-1.6 branch (the
  v1.6.1 release) has the original, regressive fix (commit fdcbe7d5); let's
  update it.

  Signed-off-by: Laszlo Ersek <lersek@redhat.com>
  Reviewed-by: Paolo Bonzini <pbonzini@redhat.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  192d2f4cc7931668d4e4f10e882af3c097193c47:scsi_target_send_command(): amend stable-1.6 port of the CVE-2013-4344 fix

  The originally suggested fix for CVE-2013-4344 introduced a regression in
  scsi_target_send_command() / REQUEST_SENSE; the third argument passed to
  scsi_device_get_sense() -- for the "len" parameter -- ignored the
  possibility of the guest SCSI driver requesting truncated (or shorter than
  full) sense data.

  This could result in (r->len > req->cmd.xfer) on return, which is not
  valid SCSI.

  The problem was addressed in the second round, and the commit on the
  master branch (84642435) is correct. However the stable-1.6 branch (the
  v1.6.1 release) has the original, regressive fix (commit fdcbe7d5); let's
  update it.

  Signed-off-by: Laszlo Ersek <lersek@redhat.com>
  Reviewed-by: Paolo Bonzini <pbonzini@redhat.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  634ebf4b177723f2cf329a719f31913cf9ce5de6:Merge remote-tracking branch 'bonzini/scsi-next' into staging

  # By Asias He (1) and Peter Lieven (1)
  # Via Paolo Bonzini
  * bonzini/scsi-next:
    scsi: Allocate SCSITargetReq r->buf dynamically [CVE-2013-4344]
    block/iscsi: reenable iscsi_co_get_block_status

  Message-id: 1381332391-8781-1-git-send-email-pbonzini@redhat.com
  Signed-off-by: Anthony Liguori <aliguori@amazon.com>
  846424350b292f16b732b573273a5c1f195cd7a3:scsi: Allocate SCSITargetReq r->buf dynamically [CVE-2013-4344]

  r->buf is hardcoded to 2056 which is (256 + 1) * 8, allowing 256 luns at
  most. If more than 256 luns are specified by user, we have buffer
  overflow in scsi_target_emulate_report_luns.

  To fix, we allocate the buffer dynamically.

  Signed-off-by: Asias He <asias@redhat.com>
  Tested-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 846424350b292f16b732b573273a5c1f195cd7a3
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: '192d2f4cc7931668d4e4f10e882af3c097193c47'
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 634ebf4b177723f2cf329a719f31913cf9ce5de6
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
