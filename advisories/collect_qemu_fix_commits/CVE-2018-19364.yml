advisory_id: CVE-2018-19364
datasource_id: collect_qemu_fix_commits/CVE-2018-19364
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  fff7111fb90e93b148b2196175fd656b2bfea4cd:fuzz: add virtio-9p configurations for fuzzing

  virtio-9p devices are often used to expose a virtual-filesystem to the
  guest. There have been some bugs reported in this device, such as
  CVE-2018-19364, and CVE-2021-20181. We should fuzz this device

  This patch adds two virtio-9p configurations:
   * One with the widely used -fsdev local driver. This driver leaks some
     state in the form of files/directories created in the shared dir.
   * One with the synth driver. While it is not used in the real world, this
     driver won't leak leak state between fuzz inputs.

  Signed-off-by: Alexander Bulekov <alxndr@bu.edu>
  Reviewed-by: Darren Kenny <darren.kenny@oracle.com>
  Message-Id: <20210117230924.449676-4-alxndr@bu.edu>
  46cabfb41e9cb269affc14c8188f0c8745f8cd55:Merge remote-tracking branch 'remotes/gkurz/tags/for-upstream' into staging

  Fixes yet another use-after-free issue that could be triggered by a
  misbehaving guest. This is a follow-up to commit:

  commit 5b76ef50f62079a2389ba28cacaf6cce68b1a0ed
  Author: Greg Kurz <groug@kaod.org>
  Date:   Wed Nov 7 01:00:04 2018 +0100

      9p: write lock path in v9fs_co_open2()

  # gpg: Signature made Tue 20 Nov 2018 12:01:07 GMT
  # gpg:                using RSA key 71D4D5E5822F73D6
  # gpg: Good signature from "Greg Kurz <groug@kaod.org>"
  # gpg:                 aka "Gregory Kurz <gregory.kurz@free.fr>"
  # gpg:                 aka "[jpeg image of size 3330]"
  # Primary key fingerprint: B482 8BAF 9431 40CE F2A3  4910 71D4 D5E5 822F 73D6

  * remotes/gkurz/tags/for-upstream:
    9p: take write lock on fid path updates (CVE-2018-19364)

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  5b3c77aa581ebb215125c84b0742119483571e55:9p: take write lock on fid path updates (CVE-2018-19364)

  Recent commit 5b76ef50f62079a fixed a race where v9fs_co_open2() could
  possibly overwrite a fid path with v9fs_path_copy() while it is being
  accessed by some other thread, ie, use-after-free that can be detected
  by ASAN with a custom 9p client.

  It turns out that the same can happen at several locations where
  v9fs_path_copy() is used to set the fid path. The fix is again to
  take the write lock.

  Fixes CVE-2018-19364.

  Cc: P J P <ppandit@redhat.com>
  Reported-by: zhibin hu <noirfate@gmail.com>
  Reviewed-by: Prasad J Pandit <pjp@fedoraproject.org>
  Signed-off-by: Greg Kurz <groug@kaod.org>
  5b3c77aa581ebb215125c84b0742119483571e55:9p: take write lock on fid path updates (CVE-2018-19364)

  Recent commit 5b76ef50f62079a fixed a race where v9fs_co_open2() could
  possibly overwrite a fid path with v9fs_path_copy() while it is being
  accessed by some other thread, ie, use-after-free that can be detected
  by ASAN with a custom 9p client.

  It turns out that the same can happen at several locations where
  v9fs_path_copy() is used to set the fid path. The fix is again to
  take the write lock.

  Fixes CVE-2018-19364.

  Cc: P J P <ppandit@redhat.com>
  Reported-by: zhibin hu <noirfate@gmail.com>
  Reviewed-by: Prasad J Pandit <pjp@fedoraproject.org>
  Signed-off-by: Greg Kurz <groug@kaod.org>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: fff7111fb90e93b148b2196175fd656b2bfea4cd
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 46cabfb41e9cb269affc14c8188f0c8745f8cd55
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 5b3c77aa581ebb215125c84b0742119483571e55
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
