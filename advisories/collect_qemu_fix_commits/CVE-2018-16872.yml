advisory_id: CVE-2018-16872
datasource_id: collect_qemu_fix_commits/CVE-2018-16872
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  7347a04da35ec6284ce83e8bcd72dc4177d17b10:usb-mtp: use O_NOFOLLOW and O_CLOEXEC.

  Open files and directories with O_NOFOLLOW to avoid symlinks attacks.
  While being at it also add O_CLOEXEC.

  usb-mtp only handles regular files and directories and ignores
  everything else, so users should not see a difference.

  Because qemu ignores symlinks, carrying out a successful symlink attack
  requires swapping an existing file or directory below rootdir for a
  symlink and winning the race against the inotify notification to qemu.

  Fixes: CVE-2018-16872
  Cc: Prasad J Pandit <ppandit@redhat.com>
  Cc: Bandan Das <bsd@redhat.com>
  Reported-by: Michael Hanselmann <public@hansmi.ch>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Reviewed-by: Michael Hanselmann <public@hansmi.ch>
  Message-id: 20181213122511.13853-1-kraxel@redhat.com
  (cherry picked from commit bab9df35ce73d1c8e19a37e2737717ea1c984dc1)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  6b29db871d1262c79d87b9a6ae3c84b1f013fb76:usb-mtp: use O_NOFOLLOW and O_CLOEXEC.

  Open files and directories with O_NOFOLLOW to avoid symlinks attacks.
  While being at it also add O_CLOEXEC.

  usb-mtp only handles regular files and directories and ignores
  everything else, so users should not see a difference.

  Because qemu ignores symlinks, carrying out a successful symlink attack
  requires swapping an existing file or directory below rootdir for a
  symlink and winning the race against the inotify notification to qemu.

  Fixes: CVE-2018-16872
  Cc: Prasad J Pandit <ppandit@redhat.com>
  Cc: Bandan Das <bsd@redhat.com>
  Reported-by: Michael Hanselmann <public@hansmi.ch>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Reviewed-by: Michael Hanselmann <public@hansmi.ch>
  Message-id: 20181213122511.13853-1-kraxel@redhat.com
  (cherry picked from commit bab9df35ce73d1c8e19a37e2737717ea1c984dc1)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  bab9df35ce73d1c8e19a37e2737717ea1c984dc1:usb-mtp: use O_NOFOLLOW and O_CLOEXEC.

  Open files and directories with O_NOFOLLOW to avoid symlinks attacks.
  While being at it also add O_CLOEXEC.

  usb-mtp only handles regular files and directories and ignores
  everything else, so users should not see a difference.

  Because qemu ignores symlinks, carrying out a successful symlink attack
  requires swapping an existing file or directory below rootdir for a
  symlink and winning the race against the inotify notification to qemu.

  Fixes: CVE-2018-16872
  Cc: Prasad J Pandit <ppandit@redhat.com>
  Cc: Bandan Das <bsd@redhat.com>
  Reported-by: Michael Hanselmann <public@hansmi.ch>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Reviewed-by: Michael Hanselmann <public@hansmi.ch>
  Message-id: 20181213122511.13853-1-kraxel@redhat.com
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: bab9df35ce73d1c8e19a37e2737717ea1c984dc1
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 7347a04da35ec6284ce83e8bcd72dc4177d17b10
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 6b29db871d1262c79d87b9a6ae3c84b1f013fb76
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
