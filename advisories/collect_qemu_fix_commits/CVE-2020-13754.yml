advisory_id: CVE-2020-13754
datasource_id: collect_qemu_fix_commits/CVE-2020-13754
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  b14cd263ad87a4c3a83308f093841d247eb711f1:memory: Revert "memory: accept mismatching sizes in memory_region_access_valid"

  Memory API documentation documents valid .min_access_size and .max_access_size
  fields and explains that any access outside these boundaries is blocked.

  This is what devices seem to assume.

  However this is not what the implementation does: it simply
  ignores the boundaries unless there's an "accepts" callback.

  Naturally, this breaks a bunch of devices.

  Revert to the documented behaviour.

  Devices that want to allow any access can just drop the valid field,
  or add the impl field to have accesses converted to appropriate
  length.

  Cc: qemu-stable@nongnu.org
  Reviewed-by: Richard Henderson <rth@twiddle.net>
  Fixes: CVE-2020-13754
  Fixes: https://bugzilla.redhat.com/show_bug.cgi?id=1842363
  Fixes: a014ed07bd5a ("memory: accept mismatching sizes in memory_region_access_valid")
  Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  Message-Id: <20200610134731.1514409-1-mst@redhat.com>
  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
  (cherry picked from commit 5d971f9e672507210e77d020d89e0e89165c8fc9)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  5d971f9e672507210e77d020d89e0e89165c8fc9:memory: Revert "memory: accept mismatching sizes in memory_region_access_valid"

  Memory API documentation documents valid .min_access_size and .max_access_size
  fields and explains that any access outside these boundaries is blocked.

  This is what devices seem to assume.

  However this is not what the implementation does: it simply
  ignores the boundaries unless there's an "accepts" callback.

  Naturally, this breaks a bunch of devices.

  Revert to the documented behaviour.

  Devices that want to allow any access can just drop the valid field,
  or add the impl field to have accesses converted to appropriate
  length.

  Cc: qemu-stable@nongnu.org
  Reviewed-by: Richard Henderson <rth@twiddle.net>
  Fixes: CVE-2020-13754
  Fixes: https://bugzilla.redhat.com/show_bug.cgi?id=1842363
  Fixes: a014ed07bd5a ("memory: accept mismatching sizes in memory_region_access_valid")
  Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  Message-Id: <20200610134731.1514409-1-mst@redhat.com>
  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 5d971f9e672507210e77d020d89e0e89165c8fc9
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: b14cd263ad87a4c3a83308f093841d247eb711f1
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
