advisory_id: CVE-2014-0144
datasource_id: collect_qemu_fix_commits/CVE-2014-0144
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: "cd598d41616189f33b35f69a5f7ba70c8112c272:qcow2: Validate active L1 table offset and\
  \ size (CVE-2014-0144)\n\nThis avoids an unbounded allocation.\n\nSigned-off-by: Kevin Wolf\
  \ <kwolf@redhat.com>\nReviewed-by: Max Reitz <mreitz@redhat.com>\nSigned-off-by: Stefan Hajnoczi\
  \ <stefanha@redhat.com>\n(cherry picked from commit 2d51c32c4b511db8bb9e58208f1e2c25e4c06c85)\n\
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>\n04bc6981ca7ea65d9d4e61b4758dcb9336fd045d:qcow2:\
  \ Validate snapshot table offset/size (CVE-2014-0144)\n\nThis avoid unbounded memory allocation\
  \ and fixes a potential buffer\noverflow on 32 bit hosts.\n\nSigned-off-by: Kevin Wolf <kwolf@redhat.com>\n\
  Reviewed-by: Max Reitz <mreitz@redhat.com>\nSigned-off-by: Stefan Hajnoczi <stefanha@redhat.com>\n\
  (cherry picked from commit ce48f2f441ca98885267af6fd636a7cb804ee646)\nSigned-off-by: Michael\
  \ Roth <mdroth@linux.vnet.ibm.com>\nf6027f805b111deccc0e09eec53d8be9812493fa:qcow2: Check\
  \ refcount table size (CVE-2014-0144)\n\nLimit the in-memory reference count table size to\
  \ 8 MB, it's enough in\npractice. This fixes an unbounded allocation as well as a buffer\n\
  overflow in qcow2_refcount_init().\n\nSigned-off-by: Kevin Wolf <kwolf@redhat.com>\nReviewed-by:\
  \ Max Reitz <mreitz@redhat.com>\nSigned-off-by: Stefan Hajnoczi <stefanha@redhat.com>\n(cherry\
  \ picked from commit 5dab2faddc8eaa1fb1abdbe2f502001fc13a1b21)\nSigned-off-by: Michael Roth\
  \ <mdroth@linux.vnet.ibm.com>\n6f6db0c7aff11b233442d5e9e105f9b8bb66f2c5:qcow2: Check backing_file_offset\
  \ (CVE-2014-0144)\n\nHeader, header extension and the backing file name must all be stored\
  \ in\nthe first cluster. Setting the backing file to a much higher value\nallowed header extensions\
  \ to become much bigger than we want them to be\n(unbounded allocation).\n\nSigned-off-by:\
  \ Kevin Wolf <kwolf@redhat.com>\nReviewed-by: Max Reitz <mreitz@redhat.com>\nSigned-off-by:\
  \ Stefan Hajnoczi <stefanha@redhat.com>\n(cherry picked from commit a1b3955c9415b1e767c130a2f59fee6aa28e575b)\n\
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>\n665f3ad58f040cc1a09cbd4f91b2e7355a874c6e:qcow2:\
  \ Check header_length (CVE-2014-0144)\n\nThis fixes an unbounded allocation for s->unknown_header_fields.\n\
  \nSigned-off-by: Kevin Wolf <kwolf@redhat.com>\nReviewed-by: Max Reitz <mreitz@redhat.com>\n\
  Signed-off-by: Stefan Hajnoczi <stefanha@redhat.com>\n(cherry picked from commit 24342f2cae47d03911e346fe1e520b00dc2818e0)\n\
  \nConflicts:\n\ttests/qemu-iotests/group\n\n*fixed context mismatches in group file\n\nSigned-off-by:\
  \ Michael Roth <mdroth@linux.vnet.ibm.com>\n4854971ac1bbc95c41f6c99c8482903c2ef8d1bb:curl:\
  \ check data size before memcpy to local buffer. (CVE-2014-0144)\n\ncurl_read_cb is callback\
  \ function for libcurl when data arrives. The\ndata size passed in here is not guaranteed\
  \ to be within the range of\nrequest we submitted, so we may overflow the guest IO buffer.\
  \ Check the\nreal size we have before memcpy to buffer to avoid overflow.\n\nSigned-off-by:\
  \ Fam Zheng <famz@redhat.com>\nReviewed-by: Stefan Hajnoczi <stefanha@redhat.com>\nSigned-off-by:\
  \ Kevin Wolf <kwolf@redhat.com>\nReviewed-by: Max Reitz <mreitz@redhat.com>\nSigned-off-by:\
  \ Stefan Hajnoczi <stefanha@redhat.com>\n(cherry picked from commit 6d4b9e55fc625514a38d27cff4b9933f617fa7dc)\n\
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>\n37173f54b7925f02045a93c081deabca1b8a6abd:vdi:\
  \ add bounds checks for blocks_in_image and disk_size header fields (CVE-2014-0144)\n\nThe\
  \ maximum blocks_in_image is 0xffffffff / 4, which also limits the\nmaximum disk_size for\
  \ a VDI image to 1024TB.  Note that this is the maximum\nsize that QEMU will currently support\
  \ with this driver, not necessarily the\nmaximum size allowed by the image format.\n\nThis\
  \ also fixes an incorrect error message, a bug introduced by commit\n5b7aa9b56d1bfc79916262f380c3fc7961becb50\
  \ (Reported by Stefan Weil)\n\nSigned-off-by: Jeff Cody <jcody@redhat.com>\nSigned-off-by:\
  \ Kevin Wolf <kwolf@redhat.com>\nSigned-off-by: Stefan Hajnoczi <stefanha@redhat.com>\n(cherry\
  \ picked from commit 63fa06dc978f3669dbfd9443b33cde9e2a7f4b41)\n\nConflicts:\n\tblock/vdi.c\n\
  \n*modified to retain 1.7's usage of logout() over error_setg()\n\nSigned-off-by: Michael\
  \ Roth <mdroth@linux.vnet.ibm.com>\nb2390c7008561c595127090688960a145a592f6b:vpc/vhd: add\
  \ bounds check for max_table_entries and block_size (CVE-2014-0144)\n\nThis adds checks to\
  \ make sure that max_table_entries and block_size\nare in sane ranges.  Memory is allocated\
  \ based on max_table_entries,\nand block_size is used to calculate indices into that allocated\n\
  memory, so if these values are incorrect that can lead to potential\nunbounded memory allocation,\
  \ or invalid memory accesses.\n\nAlso, the allocation of the pagetable is changed from g_malloc0()\n\
  to qemu_blockalign().\n\nSigned-off-by: Jeff Cody <jcody@redhat.com>\nSigned-off-by: Kevin\
  \ Wolf <kwolf@redhat.com>\nReviewed-by: Max Reitz <mreitz@redhat.com>\nSigned-off-by: Stefan\
  \ Hajnoczi <stefanha@redhat.com>\n(cherry picked from commit 97f1c45c6f456572e5b504b8614e4a69e23b8e3a)\n\
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>\n0fda3e2d639fee7c3262485c48c3b5fd6c9b4114:block/cloop:\
  \ refuse images with bogus offsets (CVE-2014-0144)\n\nThe offsets[] array allows efficient\
  \ seeking and tells us the maximum\ncompressed data size.  If the offsets are bogus the maximum\
  \ compressed\ndata size will be unrealistic.\n\nThis could cause g_malloc() to abort and bogus\
  \ offsets mean the image is\nbroken anyway.  Therefore we should refuse such images.\n\nSigned-off-by:\
  \ Stefan Hajnoczi <stefanha@redhat.com>\nSigned-off-by: Kevin Wolf <kwolf@redhat.com>\nReviewed-by:\
  \ Max Reitz <mreitz@redhat.com>\nSigned-off-by: Stefan Hajnoczi <stefanha@redhat.com>\n(cherry\
  \ picked from commit f56b9bc3ae20fc93815b34aa022be919941406ce)\nSigned-off-by: Michael Roth\
  \ <mdroth@linux.vnet.ibm.com>\n7dcffbb2bfcb38c98cff911cd002c09e9326e3cc:block/cloop: refuse\
  \ images with huge offsets arrays (CVE-2014-0144)\n\nLimit offsets_size to 512 MB so that:\n\
  \n1. g_malloc() does not abort due to an unreasonable size argument.\n\n2. offsets_size does\
  \ not overflow the bdrv_pread() int size argument.\n\nThis limit imposes a maximum image size\
  \ of 16 TB at 256 KB block size.\n\nSigned-off-by: Stefan Hajnoczi <stefanha@redhat.com>\n\
  Signed-off-by: Kevin Wolf <kwolf@redhat.com>\nReviewed-by: Max Reitz <mreitz@redhat.com>\n\
  Signed-off-by: Stefan Hajnoczi <stefanha@redhat.com>\n(cherry picked from commit 7b103b36d6ef3b11827c203d3a793bf7da50ecd6)\n\
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>\n1f6bda93015b6842d37343acda0c93986e78e842:block/cloop:\
  \ validate block_size header field (CVE-2014-0144)\n\nAvoid unbounded s->uncompressed_block\
  \ memory allocation by checking that\nthe block_size header field has a reasonable value.\
  \  Also enforce the\nassumption that the value is a non-zero multiple of 512.\n\nThese constraints\
  \ conform to cloop 2.639's code so we accept existing\nimage files.\n\nSigned-off-by: Stefan\
  \ Hajnoczi <stefanha@redhat.com>\nSigned-off-by: Kevin Wolf <kwolf@redhat.com>\nReviewed-by:\
  \ Max Reitz <mreitz@redhat.com>\nSigned-off-by: Stefan Hajnoczi <stefanha@redhat.com>\n(cherry\
  \ picked from commit d65f97a82c4ed48374a764c769d4ba1ea9724e97)\nSigned-off-by: Michael Roth\
  \ <mdroth@linux.vnet.ibm.com>\n2d51c32c4b511db8bb9e58208f1e2c25e4c06c85:qcow2: Validate active\
  \ L1 table offset and size (CVE-2014-0144)\n\nThis avoids an unbounded allocation.\n\nSigned-off-by:\
  \ Kevin Wolf <kwolf@redhat.com>\nReviewed-by: Max Reitz <mreitz@redhat.com>\nSigned-off-by:\
  \ Stefan Hajnoczi <stefanha@redhat.com>\nce48f2f441ca98885267af6fd636a7cb804ee646:qcow2: Validate\
  \ snapshot table offset/size (CVE-2014-0144)\n\nThis avoid unbounded memory allocation and\
  \ fixes a potential buffer\noverflow on 32 bit hosts.\n\nSigned-off-by: Kevin Wolf <kwolf@redhat.com>\n\
  Reviewed-by: Max Reitz <mreitz@redhat.com>\nSigned-off-by: Stefan Hajnoczi <stefanha@redhat.com>\n\
  5dab2faddc8eaa1fb1abdbe2f502001fc13a1b21:qcow2: Check refcount table size (CVE-2014-0144)\n\
  \nLimit the in-memory reference count table size to 8 MB, it's enough in\npractice. This fixes\
  \ an unbounded allocation as well as a buffer\noverflow in qcow2_refcount_init().\n\nSigned-off-by:\
  \ Kevin Wolf <kwolf@redhat.com>\nReviewed-by: Max Reitz <mreitz@redhat.com>\nSigned-off-by:\
  \ Stefan Hajnoczi <stefanha@redhat.com>\na1b3955c9415b1e767c130a2f59fee6aa28e575b:qcow2: Check\
  \ backing_file_offset (CVE-2014-0144)\n\nHeader, header extension and the backing file name\
  \ must all be stored in\nthe first cluster. Setting the backing file to a much higher value\n\
  allowed header extensions to become much bigger than we want them to be\n(unbounded allocation).\n\
  \nSigned-off-by: Kevin Wolf <kwolf@redhat.com>\nReviewed-by: Max Reitz <mreitz@redhat.com>\n\
  Signed-off-by: Stefan Hajnoczi <stefanha@redhat.com>\n24342f2cae47d03911e346fe1e520b00dc2818e0:qcow2:\
  \ Check header_length (CVE-2014-0144)\n\nThis fixes an unbounded allocation for s->unknown_header_fields.\n\
  \nSigned-off-by: Kevin Wolf <kwolf@redhat.com>\nReviewed-by: Max Reitz <mreitz@redhat.com>\n\
  Signed-off-by: Stefan Hajnoczi <stefanha@redhat.com>\n6d4b9e55fc625514a38d27cff4b9933f617fa7dc:curl:\
  \ check data size before memcpy to local buffer. (CVE-2014-0144)\n\ncurl_read_cb is callback\
  \ function for libcurl when data arrives. The\ndata size passed in here is not guaranteed\
  \ to be within the range of\nrequest we submitted, so we may overflow the guest IO buffer.\
  \ Check the\nreal size we have before memcpy to buffer to avoid overflow.\n\nSigned-off-by:\
  \ Fam Zheng <famz@redhat.com>\nReviewed-by: Stefan Hajnoczi <stefanha@redhat.com>\nSigned-off-by:\
  \ Kevin Wolf <kwolf@redhat.com>\nReviewed-by: Max Reitz <mreitz@redhat.com>\nSigned-off-by:\
  \ Stefan Hajnoczi <stefanha@redhat.com>\n63fa06dc978f3669dbfd9443b33cde9e2a7f4b41:vdi: add\
  \ bounds checks for blocks_in_image and disk_size header fields (CVE-2014-0144)\n\nThe maximum\
  \ blocks_in_image is 0xffffffff / 4, which also limits the\nmaximum disk_size for a VDI image\
  \ to 1024TB.  Note that this is the maximum\nsize that QEMU will currently support with this\
  \ driver, not necessarily the\nmaximum size allowed by the image format.\n\nThis also fixes\
  \ an incorrect error message, a bug introduced by commit\n5b7aa9b56d1bfc79916262f380c3fc7961becb50\
  \ (Reported by Stefan Weil)\n\nSigned-off-by: Jeff Cody <jcody@redhat.com>\nSigned-off-by:\
  \ Kevin Wolf <kwolf@redhat.com>\nSigned-off-by: Stefan Hajnoczi <stefanha@redhat.com>\n97f1c45c6f456572e5b504b8614e4a69e23b8e3a:vpc/vhd:\
  \ add bounds check for max_table_entries and block_size (CVE-2014-0144)\n\nThis adds checks\
  \ to make sure that max_table_entries and block_size\nare in sane ranges.  Memory is allocated\
  \ based on max_table_entries,\nand block_size is used to calculate indices into that allocated\n\
  memory, so if these values are incorrect that can lead to potential\nunbounded memory allocation,\
  \ or invalid memory accesses.\n\nAlso, the allocation of the pagetable is changed from g_malloc0()\n\
  to qemu_blockalign().\n\nSigned-off-by: Jeff Cody <jcody@redhat.com>\nSigned-off-by: Kevin\
  \ Wolf <kwolf@redhat.com>\nReviewed-by: Max Reitz <mreitz@redhat.com>\nSigned-off-by: Stefan\
  \ Hajnoczi <stefanha@redhat.com>\nf56b9bc3ae20fc93815b34aa022be919941406ce:block/cloop: refuse\
  \ images with bogus offsets (CVE-2014-0144)\n\nThe offsets[] array allows efficient seeking\
  \ and tells us the maximum\ncompressed data size.  If the offsets are bogus the maximum compressed\n\
  data size will be unrealistic.\n\nThis could cause g_malloc() to abort and bogus offsets mean\
  \ the image is\nbroken anyway.  Therefore we should refuse such images.\n\nSigned-off-by:\
  \ Stefan Hajnoczi <stefanha@redhat.com>\nSigned-off-by: Kevin Wolf <kwolf@redhat.com>\nReviewed-by:\
  \ Max Reitz <mreitz@redhat.com>\nSigned-off-by: Stefan Hajnoczi <stefanha@redhat.com>\n7b103b36d6ef3b11827c203d3a793bf7da50ecd6:block/cloop:\
  \ refuse images with huge offsets arrays (CVE-2014-0144)\n\nLimit offsets_size to 512 MB so\
  \ that:\n\n1. g_malloc() does not abort due to an unreasonable size argument.\n\n2. offsets_size\
  \ does not overflow the bdrv_pread() int size argument.\n\nThis limit imposes a maximum image\
  \ size of 16 TB at 256 KB block size.\n\nSigned-off-by: Stefan Hajnoczi <stefanha@redhat.com>\n\
  Signed-off-by: Kevin Wolf <kwolf@redhat.com>\nReviewed-by: Max Reitz <mreitz@redhat.com>\n\
  Signed-off-by: Stefan Hajnoczi <stefanha@redhat.com>\nd65f97a82c4ed48374a764c769d4ba1ea9724e97:block/cloop:\
  \ validate block_size header field (CVE-2014-0144)\n\nAvoid unbounded s->uncompressed_block\
  \ memory allocation by checking that\nthe block_size header field has a reasonable value.\
  \  Also enforce the\nassumption that the value is a non-zero multiple of 512.\n\nThese constraints\
  \ conform to cloop 2.639's code so we accept existing\nimage files.\n\nSigned-off-by: Stefan\
  \ Hajnoczi <stefanha@redhat.com>\nSigned-off-by: Kevin Wolf <kwolf@redhat.com>\nReviewed-by:\
  \ Max Reitz <mreitz@redhat.com>\nSigned-off-by: Stefan Hajnoczi <stefanha@redhat.com>"
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: cd598d41616189f33b35f69a5f7ba70c8112c272
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 665f3ad58f040cc1a09cbd4f91b2e7355a874c6e
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 24342f2cae47d03911e346fe1e520b00dc2818e0
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 0fda3e2d639fee7c3262485c48c3b5fd6c9b4114
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 6f6db0c7aff11b233442d5e9e105f9b8bb66f2c5
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: a1b3955c9415b1e767c130a2f59fee6aa28e575b
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 63fa06dc978f3669dbfd9443b33cde9e2a7f4b41
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 7b103b36d6ef3b11827c203d3a793bf7da50ecd6
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 4854971ac1bbc95c41f6c99c8482903c2ef8d1bb
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 5dab2faddc8eaa1fb1abdbe2f502001fc13a1b21
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 2d51c32c4b511db8bb9e58208f1e2c25e4c06c85
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: d65f97a82c4ed48374a764c769d4ba1ea9724e97
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 37173f54b7925f02045a93c081deabca1b8a6abd
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: ce48f2f441ca98885267af6fd636a7cb804ee646
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 97f1c45c6f456572e5b504b8614e4a69e23b8e3a
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: f56b9bc3ae20fc93815b34aa022be919941406ce
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 04bc6981ca7ea65d9d4e61b4758dcb9336fd045d
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: b2390c7008561c595127090688960a145a592f6b
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: f6027f805b111deccc0e09eec53d8be9812493fa
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 6d4b9e55fc625514a38d27cff4b9933f617fa7dc
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 1f6bda93015b6842d37343acda0c93986e78e842
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 7dcffbb2bfcb38c98cff911cd002c09e9326e3cc
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
