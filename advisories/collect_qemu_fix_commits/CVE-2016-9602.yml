advisory_id: CVE-2016-9602
datasource_id: collect_qemu_fix_commits/CVE-2016-9602
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  473a321122fd3c2c327a5a5d01a9a41f26f1734c:Merge remote-tracking branch 'remotes/gkurz/tags/for-upstream' into staging

  Just a single fix for an annoying regression introduced in 2.9 when fixing
  CVE-2016-9602.

  # gpg: Signature made Thu 10 Aug 2017 13:40:28 BST
  # gpg:                using DSA key 0x02FC3AEB0101DBC2
  # gpg: Good signature from "Greg Kurz <groug@kaod.org>"
  # gpg:                 aka "Greg Kurz <groug@free.fr>"
  # gpg:                 aka "Greg Kurz <gkurz@linux.vnet.ibm.com>"
  # gpg:                 aka "Gregory Kurz (Groug) <groug@free.fr>"
  # gpg:                 aka "[jpeg image of size 3330]"
  # gpg: WARNING: This key is not certified with a trusted signature!
  # gpg:          There is no indication that the signature belongs to the owner.
  # Primary key fingerprint: 2BD4 3B44 535E C0A7 9894  DBA2 02FC 3AEB 0101 DBC2

  * remotes/gkurz/tags/for-upstream:
    9pfs: local: fix fchmodat_nofollow() limitations

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  785d9ab216c70e4fd4710e3127acda888756ef71:9pfs: local: fix unlink of alien files in mapped-file mode

  When trying to remove a file from a directory, both created in non-mapped
  mode, the file remains and EBADF is returned to the guest.

  This is a regression introduced by commit "df4938a6651b 9pfs: local:
  unlinkat: don't follow symlinks" when fixing CVE-2016-9602. It changed the
  way we unlink the metadata file from

      ret = remove("$dir/.virtfs_metadata/$name");
      if (ret < 0 && errno != ENOENT) {
           /* Error out */
      }
      /* Ignore absence of metadata */

  to

      fd = openat("$dir/.virtfs_metadata")
      unlinkat(fd, "$name")
      if (ret < 0 && errno != ENOENT) {
           /* Error out */
      }
      /* Ignore absence of metadata */

  If $dir was created in non-mapped mode, openat() fails with ENOENT and
  we pass -1 to unlinkat(), which fails in turn with EBADF.

  We just need to check the return of openat() and ignore ENOENT, in order
  to restore the behaviour we had with remove().

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Eric Blake <eblake@redhat.com>
  [groug: rewrote the comments as suggested by Eric]

  (cherry picked from commit 6a87e7929f97b86c5823d4616fa1aa7636b2f116)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  24df3371d97a7516605aef8abbc253a8c162b211:9pfs: assume utimensat() and futimens() are present

  The utimensat() and futimens() syscalls have been around for ages (ie,
  glibc 2.6 and linux 2.6.22), and the decision was already taken to
  switch to utimensat() anyway when fixing CVE-2016-9602 in 2.9.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Eric Blake <eblake@redhat.com>
  6a87e7929f97b86c5823d4616fa1aa7636b2f116:9pfs: local: fix unlink of alien files in mapped-file mode

  When trying to remove a file from a directory, both created in non-mapped
  mode, the file remains and EBADF is returned to the guest.

  This is a regression introduced by commit "df4938a6651b 9pfs: local:
  unlinkat: don't follow symlinks" when fixing CVE-2016-9602. It changed the
  way we unlink the metadata file from

      ret = remove("$dir/.virtfs_metadata/$name");
      if (ret < 0 && errno != ENOENT) {
           /* Error out */
      }
      /* Ignore absence of metadata */

  to

      fd = openat("$dir/.virtfs_metadata")
      unlinkat(fd, "$name")
      if (ret < 0 && errno != ENOENT) {
           /* Error out */
      }
      /* Ignore absence of metadata */

  If $dir was created in non-mapped mode, openat() fails with ENOENT and
  we pass -1 to unlinkat(), which fails in turn with EBADF.

  We just need to check the return of openat() and ignore ENOENT, in order
  to restore the behaviour we had with remove().

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Eric Blake <eblake@redhat.com>
  [groug: rewrote the comments as suggested by Eric]
  a15785cfbd2c58354cb27976b3659b6ac30a9601:9pfs: fix vulnerability in openat_dir() and local_unlinkat_common()

  We should pass O_NOFOLLOW otherwise openat() will follow symlinks and make
  QEMU vulnerable.

  While here, we also fix local_unlinkat_common() to use openat_dir() for
  the same reasons (it was a leftover in the original patchset actually).

  This fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Daniel P. Berrange <berrange@redhat.com>
  Reviewed-by: Eric Blake <eblake@redhat.com>
  (cherry picked from commit b003fc0d8aa5e7060dbf7e5862b8013c73857c7f)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  9c5cb58970d76a0fe41759c738e14f8bb16cc89d:9pfs: local: open2: don't follow symlinks

  The local_open2() callback is vulnerable to symlink attacks because it
  calls:

  (1) open() which follows symbolic links for all path elements but the
      rightmost one
  (2) local_set_xattr()->setxattr() which follows symbolic links for all
      path elements
  (3) local_set_mapped_file_attr() which calls in turn local_fopen() and
      mkdir(), both functions following symbolic links for all path
      elements but the rightmost one
  (4) local_post_create_passthrough() which calls in turn lchown() and
      chmod(), both functions also following symbolic links

  This patch converts local_open2() to rely on opendir_nofollow() and
  mkdirat() to fix (1), as well as local_set_xattrat(),
  local_set_mapped_file_attrat() and local_set_cred_passthrough() to
  fix (2), (3) and (4) respectively. Since local_open2() already opens
  a descriptor to the target file, local_set_cred_passthrough() is
  modified to reuse it instead of opening a new one.

  The mapped and mapped-file security modes are supposed to be identical,
  except for the place where credentials and file modes are stored. While
  here, we also make that explicit by sharing the call to openat().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit a565fea56546e254b7610305b07711f0a3bda0c7)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  c8c9aab1731c2c79248bd24121c09e8e270f6007:9pfs: local: mkdir: don't follow symlinks

  The local_mkdir() callback is vulnerable to symlink attacks because it
  calls:

  (1) mkdir() which follows symbolic links for all path elements but the
      rightmost one
  (2) local_set_xattr()->setxattr() which follows symbolic links for all
      path elements
  (3) local_set_mapped_file_attr() which calls in turn local_fopen() and
      mkdir(), both functions following symbolic links for all path
      elements but the rightmost one
  (4) local_post_create_passthrough() which calls in turn lchown() and
      chmod(), both functions also following symbolic links

  This patch converts local_mkdir() to rely on opendir_nofollow() and
  mkdirat() to fix (1), as well as local_set_xattrat(),
  local_set_mapped_file_attrat() and local_set_cred_passthrough() to
  fix (2), (3) and (4) respectively.

  The mapped and mapped-file security modes are supposed to be identical,
  except for the place where credentials and file modes are stored. While
  here, we also make that explicit by sharing the call to mkdirat().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit 3f3a16990b09e62d787bd2eb2dd51aafbe90019a)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  5b24a96cd2afff204b1de86d252cc433848ae6fd:9pfs: local: mknod: don't follow symlinks

  The local_mknod() callback is vulnerable to symlink attacks because it
  calls:

  (1) mknod() which follows symbolic links for all path elements but the
      rightmost one
  (2) local_set_xattr()->setxattr() which follows symbolic links for all
      path elements
  (3) local_set_mapped_file_attr() which calls in turn local_fopen() and
      mkdir(), both functions following symbolic links for all path
      elements but the rightmost one
  (4) local_post_create_passthrough() which calls in turn lchown() and
      chmod(), both functions also following symbolic links

  This patch converts local_mknod() to rely on opendir_nofollow() and
  mknodat() to fix (1), as well as local_set_xattrat() and
  local_set_mapped_file_attrat() to fix (2) and (3) respectively.

  A new local_set_cred_passthrough() helper based on fchownat() and
  fchmodat_nofollow() is introduced as a replacement to
  local_post_create_passthrough() to fix (4).

  The mapped and mapped-file security modes are supposed to be identical,
  except for the place where credentials and file modes are stored. While
  here, we also make that explicit by sharing the call to mknodat().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit d815e7219036d6911fce12efe3e59906264c8536)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  9f4ba82b069f6d4c104be66c7a201a44f66dcf00:9pfs: local: symlink: don't follow symlinks

  The local_symlink() callback is vulnerable to symlink attacks because it
  calls:

  (1) symlink() which follows symbolic links for all path elements but the
      rightmost one
  (2) open(O_NOFOLLOW) which follows symbolic links for all path elements but
      the rightmost one
  (3) local_set_xattr()->setxattr() which follows symbolic links for all
      path elements
  (4) local_set_mapped_file_attr() which calls in turn local_fopen() and
      mkdir(), both functions following symbolic links for all path
      elements but the rightmost one

  This patch converts local_symlink() to rely on opendir_nofollow() and
  symlinkat() to fix (1), openat(O_NOFOLLOW) to fix (2), as well as
  local_set_xattrat() and local_set_mapped_file_attrat() to fix (3) and
  (4) respectively.

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit 38771613ea6759f499645afd709aa422161eb27e)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  62d1dbbfce619efac6d10235fc4d7ba5eb987b3f:9pfs: local: chown: don't follow symlinks

  The local_chown() callback is vulnerable to symlink attacks because it
  calls:

  (1) lchown() which follows symbolic links for all path elements but the
      rightmost one
  (2) local_set_xattr()->setxattr() which follows symbolic links for all
      path elements
  (3) local_set_mapped_file_attr() which calls in turn local_fopen() and
      mkdir(), both functions following symbolic links for all path
      elements but the rightmost one

  This patch converts local_chown() to rely on open_nofollow() and
  fchownat() to fix (1), as well as local_set_xattrat() and
  local_set_mapped_file_attrat() to fix (2) and (3) respectively.

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit d369f20763a857eac544a5289a046d0285a91df8)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  ea9e59bdf609343db067c1d5fab79a9a1b01acf5:9pfs: local: chmod: don't follow symlinks

  The local_chmod() callback is vulnerable to symlink attacks because it
  calls:

  (1) chmod() which follows symbolic links for all path elements
  (2) local_set_xattr()->setxattr() which follows symbolic links for all
      path elements
  (3) local_set_mapped_file_attr() which calls in turn local_fopen() and
      mkdir(), both functions following symbolic links for all path
      elements but the rightmost one

  We would need fchmodat() to implement AT_SYMLINK_NOFOLLOW to fix (1). This
  isn't the case on linux unfortunately: the kernel doesn't even have a flags
  argument to the syscall :-\ It is impossible to fix it in userspace in
  a race-free manner. This patch hence converts local_chmod() to rely on
  open_nofollow() and fchmod(). This fixes the vulnerability but introduces
  a limitation: the target file must readable and/or writable for the call
  to openat() to succeed.

  It introduces a local_set_xattrat() replacement to local_set_xattr()
  based on fsetxattrat() to fix (2), and a local_set_mapped_file_attrat()
  replacement to local_set_mapped_file_attr() based on local_fopenat()
  and mkdirat() to fix (3). No effort is made to factor out code because
  both local_set_xattr() and local_set_mapped_file_attr() will be dropped
  when all users have been converted to use the "at" versions.

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit e3187a45dd02a7490f9191c16527dc28a4ba45b9)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  e314b1b1fb9ec8a4792aa495c3fe627d8f0a58a0:9pfs: local: link: don't follow symlinks

  The local_link() callback is vulnerable to symlink attacks because it calls:

  (1) link() which follows symbolic links for all path elements but the
      rightmost one
  (2) local_create_mapped_attr_dir()->mkdir() which follows symbolic links
      for all path elements but the rightmost one

  This patch converts local_link() to rely on opendir_nofollow() and linkat()
  to fix (1), mkdirat() to fix (2).

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit ad0b46e6ac769b187cb4dcf0065675ef8a198a5e)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  d93d06a2fc1e126a411178ba2edc10e802e152a1:9pfs: local: rename: use renameat

  The local_rename() callback is vulnerable to symlink attacks because it
  uses rename() which follows symbolic links in all path elements but the
  rightmost one.

  This patch simply transforms local_rename() into a wrapper around
  local_renameat() which is symlink-attack safe.

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit d2767edec582558f1e6c52e1dd9370d62e2b30fc)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  0f3490faa8796da9986d798428b034e0bb4d6f1d:9pfs: local: renameat: don't follow symlinks

  The local_renameat() callback is currently a wrapper around local_rename()
  which is vulnerable to symlink attacks.

  This patch rewrites local_renameat() to have its own implementation, based
  on local_opendir_nofollow() and renameat().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit 99f2cf4b2dad7b37c69759deb0d0b19d3ec1a24a)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  cfe40e14851e77561074020ff085f1bf49860bc1:9pfs: local: lstat: don't follow symlinks

  The local_lstat() callback is vulnerable to symlink attacks because it
  calls:

  (1) lstat() which follows symbolic links in all path elements but the
      rightmost one
  (2) getxattr() which follows symbolic links in all path elements
  (3) local_mapped_file_attr()->local_fopen()->openat(O_NOFOLLOW) which
      follows symbolic links in all path elements but the rightmost
      one

  This patch converts local_lstat() to rely on opendir_nofollow() and
  fstatat(AT_SYMLINK_NOFOLLOW) to fix (1), fgetxattrat_nofollow() to
  fix (2).

  A new local_fopenat() helper is introduced as a replacement to
  local_fopen() to fix (3). No effort is made to factor out code
  because local_fopen() will be dropped when all users have been
  converted to call local_fopenat().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit f9aef99b3e6df88036436b0d3dc3d504b9346c8c)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  3439290f9ed98f837848d5c9bf688a0c8aa8bd27:9pfs: local: readlink: don't follow symlinks

  The local_readlink() callback is vulnerable to symlink attacks because it
  calls:

  (1) open(O_NOFOLLOW) which follows symbolic links for all path elements but
      the rightmost one
  (2) readlink() which follows symbolic links for all path elements but the
      rightmost one

  This patch converts local_readlink() to rely on open_nofollow() to fix (1)
  and opendir_nofollow(), readlinkat() to fix (2).

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit bec1e9546e03b9e7f5152cf3e8c95cf8acff5e12)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  ec10eada04069a4f22010b4b30c0b70b7f6fd887:9pfs: local: truncate: don't follow symlinks

  The local_truncate() callback is vulnerable to symlink attacks because
  it calls truncate() which follows symbolic links in all path elements.

  This patch converts local_truncate() to rely on open_nofollow() and
  ftruncate() instead.

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit ac125d993b461d4dee4d6df4d93ac3f2eb959d1d)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  d3c54bf9e7f079e43f37bb0d7c2657e8976d3e1d:9pfs: local: statfs: don't follow symlinks

  The local_statfs() callback is vulnerable to symlink attacks because it
  calls statfs() which follows symbolic links in all path elements.

  This patch converts local_statfs() to rely on open_nofollow() and fstatfs()
  instead.

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit 31e51d1c15b35dc98b88a301812914b70a2b55dc)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  91225c670a0eec5354d679b4fd676e572cc37a57:9pfs: local: utimensat: don't follow symlinks

  The local_utimensat() callback is vulnerable to symlink attacks because it
  calls qemu_utimens()->utimensat(AT_SYMLINK_NOFOLLOW) which follows symbolic
  links in all path elements but the rightmost one or qemu_utimens()->utimes()
  which follows symbolic links for all path elements.

  This patch converts local_utimensat() to rely on opendir_nofollow() and
  utimensat(AT_SYMLINK_NOFOLLOW) directly instead of using qemu_utimens().
  It is hence assumed that the OS supports utimensat(), i.e. has glibc 2.6
  or higher and linux 2.6.22 or higher, which seems reasonable nowadays.

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit a33eda0dd99e00faa3bacae43d19490bb9500e07)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  4286f58bfc09eade137770bfd2b0700bf6197cf3:9pfs: local: remove: don't follow symlinks

  The local_remove() callback is vulnerable to symlink attacks because it
  calls:

  (1) lstat() which follows symbolic links in all path elements but the
      rightmost one
  (2) remove() which follows symbolic links in all path elements but the
      rightmost one

  This patch converts local_remove() to rely on opendir_nofollow(),
  fstatat(AT_SYMLINK_NOFOLLOW) to fix (1) and unlinkat() to fix (2).

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit a0e640a87210b1e986bcd4e7f7de03beb3db0a4a)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  0bb99557e17ef7336d8621b6f6c6b9591bd3a13d:9pfs: local: unlinkat: don't follow symlinks

  The local_unlinkat() callback is vulnerable to symlink attacks because it
  calls remove() which follows symbolic links in all path elements but the
  rightmost one.

  This patch converts local_unlinkat() to rely on opendir_nofollow() and
  unlinkat() instead.

  Most of the code is moved to a separate local_unlinkat_common() helper
  which will be reused in a subsequent patch to fix the same issue in
  local_remove().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit df4938a6651b1f980018f9eaf86af43e6b9d7fed)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  a9f46b8b658cc8ba7d7d7d4ab4a6d69e9689268e:9pfs: local: lremovexattr: don't follow symlinks

  The local_lremovexattr() callback is vulnerable to symlink attacks because
  it calls lremovexattr() which follows symbolic links in all path elements
  but the rightmost one.

  This patch introduces a helper to emulate the non-existing fremovexattrat()
  function: it is implemented with /proc/self/fd which provides a trusted
  path that can be safely passed to lremovexattr().

  local_lremovexattr() is converted to use this helper and opendir_nofollow().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit 72f0d0bf51362011c4d841a89fb8f5cfb16e0bf3)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  ed6083afc2df439578f00ae6c47338cb2203eaf1:9pfs: local: lsetxattr: don't follow symlinks

  The local_lsetxattr() callback is vulnerable to symlink attacks because
  it calls lsetxattr() which follows symbolic links in all path elements but
  the rightmost one.

  This patch introduces a helper to emulate the non-existing fsetxattrat()
  function: it is implemented with /proc/self/fd which provides a trusted
  path that can be safely passed to lsetxattr().

  local_lsetxattr() is converted to use this helper and opendir_nofollow().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit 3e36aba757f76673007a80b3cd56a4062c2e3462)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  d10142c11bdcecebe97fd834a834167053b7a05c:9pfs: local: llistxattr: don't follow symlinks

  The local_llistxattr() callback is vulnerable to symlink attacks because
  it calls llistxattr() which follows symbolic links in all path elements but
  the rightmost one.

  This patch introduces a helper to emulate the non-existing flistxattrat()
  function: it is implemented with /proc/self/fd which provides a trusted
  path that can be safely passed to llistxattr().

  local_llistxattr() is converted to use this helper and opendir_nofollow().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit 5507904e362df252f6065cb27d1ff98372db6abc)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  6c1e3a16bcf2a0d663e10ec34ef058d686339861:9pfs: local: lgetxattr: don't follow symlinks

  The local_lgetxattr() callback is vulnerable to symlink attacks because
  it calls lgetxattr() which follows symbolic links in all path elements but
  the rightmost one.

  This patch introduces a helper to emulate the non-existing fgetxattrat()
  function: it is implemented with /proc/self/fd which provides a trusted
  path that can be safely passed to lgetxattr().

  local_lgetxattr() is converted to use this helper and opendir_nofollow().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit 56ad3e54dad6cdcee8668d170df161d89581846f)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  acf22d2264a131ad2695b5a18746dabf0cc8b843:9pfs: local: open/opendir: don't follow symlinks

  The local_open() and local_opendir() callbacks are vulnerable to symlink
  attacks because they call:

  (1) open(O_NOFOLLOW) which follows symbolic links in all path elements but
      the rightmost one
  (2) opendir() which follows symbolic links in all path elements

  This patch converts both callbacks to use new helpers based on
  openat_nofollow() to only open files and directories if they are
  below the virtfs shared folder

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit 996a0d76d7e756e4023ef79bc37bfe629b9eaca7)
  Signed-off-by: Greg Kurz <gkurz@linux.vnet.ibm.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  b003fc0d8aa5e7060dbf7e5862b8013c73857c7f:9pfs: fix vulnerability in openat_dir() and local_unlinkat_common()

  We should pass O_NOFOLLOW otherwise openat() will follow symlinks and make
  QEMU vulnerable.

  While here, we also fix local_unlinkat_common() to use openat_dir() for
  the same reasons (it was a leftover in the original patchset actually).

  This fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Daniel P. Berrange <berrange@redhat.com>
  Reviewed-by: Eric Blake <eblake@redhat.com>
  7287e3556fdc56bfd0666a67d6b1d3ca9ce04083:Merge remote-tracking branch 'remotes/gkurz/tags/cve-2016-9602-for-upstream' into staging

  This pull request have all the fixes for CVE-2016-9602, so that it can
  be easily picked up by downstreams, as suggested by Michel Tokarev.

  # gpg: Signature made Tue 28 Feb 2017 10:21:32 GMT
  # gpg:                using DSA key 0x02FC3AEB0101DBC2
  # gpg: Good signature from "Greg Kurz <groug@kaod.org>"
  # gpg:                 aka "Greg Kurz <groug@free.fr>"
  # gpg:                 aka "Greg Kurz <gkurz@linux.vnet.ibm.com>"
  # gpg:                 aka "Gregory Kurz (Groug) <groug@free.fr>"
  # gpg:                 aka "[jpeg image of size 3330]"
  # gpg: WARNING: This key is not certified with a trusted signature!
  # gpg:          There is no indication that the signature belongs to the owner.
  # Primary key fingerprint: 2BD4 3B44 535E C0A7 9894  DBA2 02FC 3AEB 0101 DBC2

  * remotes/gkurz/tags/cve-2016-9602-for-upstream: (28 commits)
    9pfs: local: drop unused code
    9pfs: local: open2: don't follow symlinks
    9pfs: local: mkdir: don't follow symlinks
    9pfs: local: mknod: don't follow symlinks
    9pfs: local: symlink: don't follow symlinks
    9pfs: local: chown: don't follow symlinks
    9pfs: local: chmod: don't follow symlinks
    9pfs: local: link: don't follow symlinks
    9pfs: local: improve error handling in link op
    9pfs: local: rename: use renameat
    9pfs: local: renameat: don't follow symlinks
    9pfs: local: lstat: don't follow symlinks
    9pfs: local: readlink: don't follow symlinks
    9pfs: local: truncate: don't follow symlinks
    9pfs: local: statfs: don't follow symlinks
    9pfs: local: utimensat: don't follow symlinks
    9pfs: local: remove: don't follow symlinks
    9pfs: local: unlinkat: don't follow symlinks
    9pfs: local: lremovexattr: don't follow symlinks
    9pfs: local: lsetxattr: don't follow symlinks
    ...

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  a565fea56546e254b7610305b07711f0a3bda0c7:9pfs: local: open2: don't follow symlinks

  The local_open2() callback is vulnerable to symlink attacks because it
  calls:

  (1) open() which follows symbolic links for all path elements but the
      rightmost one
  (2) local_set_xattr()->setxattr() which follows symbolic links for all
      path elements
  (3) local_set_mapped_file_attr() which calls in turn local_fopen() and
      mkdir(), both functions following symbolic links for all path
      elements but the rightmost one
  (4) local_post_create_passthrough() which calls in turn lchown() and
      chmod(), both functions also following symbolic links

  This patch converts local_open2() to rely on opendir_nofollow() and
  mkdirat() to fix (1), as well as local_set_xattrat(),
  local_set_mapped_file_attrat() and local_set_cred_passthrough() to
  fix (2), (3) and (4) respectively. Since local_open2() already opens
  a descriptor to the target file, local_set_cred_passthrough() is
  modified to reuse it instead of opening a new one.

  The mapped and mapped-file security modes are supposed to be identical,
  except for the place where credentials and file modes are stored. While
  here, we also make that explicit by sharing the call to openat().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  3f3a16990b09e62d787bd2eb2dd51aafbe90019a:9pfs: local: mkdir: don't follow symlinks

  The local_mkdir() callback is vulnerable to symlink attacks because it
  calls:

  (1) mkdir() which follows symbolic links for all path elements but the
      rightmost one
  (2) local_set_xattr()->setxattr() which follows symbolic links for all
      path elements
  (3) local_set_mapped_file_attr() which calls in turn local_fopen() and
      mkdir(), both functions following symbolic links for all path
      elements but the rightmost one
  (4) local_post_create_passthrough() which calls in turn lchown() and
      chmod(), both functions also following symbolic links

  This patch converts local_mkdir() to rely on opendir_nofollow() and
  mkdirat() to fix (1), as well as local_set_xattrat(),
  local_set_mapped_file_attrat() and local_set_cred_passthrough() to
  fix (2), (3) and (4) respectively.

  The mapped and mapped-file security modes are supposed to be identical,
  except for the place where credentials and file modes are stored. While
  here, we also make that explicit by sharing the call to mkdirat().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  d815e7219036d6911fce12efe3e59906264c8536:9pfs: local: mknod: don't follow symlinks

  The local_mknod() callback is vulnerable to symlink attacks because it
  calls:

  (1) mknod() which follows symbolic links for all path elements but the
      rightmost one
  (2) local_set_xattr()->setxattr() which follows symbolic links for all
      path elements
  (3) local_set_mapped_file_attr() which calls in turn local_fopen() and
      mkdir(), both functions following symbolic links for all path
      elements but the rightmost one
  (4) local_post_create_passthrough() which calls in turn lchown() and
      chmod(), both functions also following symbolic links

  This patch converts local_mknod() to rely on opendir_nofollow() and
  mknodat() to fix (1), as well as local_set_xattrat() and
  local_set_mapped_file_attrat() to fix (2) and (3) respectively.

  A new local_set_cred_passthrough() helper based on fchownat() and
  fchmodat_nofollow() is introduced as a replacement to
  local_post_create_passthrough() to fix (4).

  The mapped and mapped-file security modes are supposed to be identical,
  except for the place where credentials and file modes are stored. While
  here, we also make that explicit by sharing the call to mknodat().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  38771613ea6759f499645afd709aa422161eb27e:9pfs: local: symlink: don't follow symlinks

  The local_symlink() callback is vulnerable to symlink attacks because it
  calls:

  (1) symlink() which follows symbolic links for all path elements but the
      rightmost one
  (2) open(O_NOFOLLOW) which follows symbolic links for all path elements but
      the rightmost one
  (3) local_set_xattr()->setxattr() which follows symbolic links for all
      path elements
  (4) local_set_mapped_file_attr() which calls in turn local_fopen() and
      mkdir(), both functions following symbolic links for all path
      elements but the rightmost one

  This patch converts local_symlink() to rely on opendir_nofollow() and
  symlinkat() to fix (1), openat(O_NOFOLLOW) to fix (2), as well as
  local_set_xattrat() and local_set_mapped_file_attrat() to fix (3) and
  (4) respectively.

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  d369f20763a857eac544a5289a046d0285a91df8:9pfs: local: chown: don't follow symlinks

  The local_chown() callback is vulnerable to symlink attacks because it
  calls:

  (1) lchown() which follows symbolic links for all path elements but the
      rightmost one
  (2) local_set_xattr()->setxattr() which follows symbolic links for all
      path elements
  (3) local_set_mapped_file_attr() which calls in turn local_fopen() and
      mkdir(), both functions following symbolic links for all path
      elements but the rightmost one

  This patch converts local_chown() to rely on open_nofollow() and
  fchownat() to fix (1), as well as local_set_xattrat() and
  local_set_mapped_file_attrat() to fix (2) and (3) respectively.

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  e3187a45dd02a7490f9191c16527dc28a4ba45b9:9pfs: local: chmod: don't follow symlinks

  The local_chmod() callback is vulnerable to symlink attacks because it
  calls:

  (1) chmod() which follows symbolic links for all path elements
  (2) local_set_xattr()->setxattr() which follows symbolic links for all
      path elements
  (3) local_set_mapped_file_attr() which calls in turn local_fopen() and
      mkdir(), both functions following symbolic links for all path
      elements but the rightmost one

  We would need fchmodat() to implement AT_SYMLINK_NOFOLLOW to fix (1). This
  isn't the case on linux unfortunately: the kernel doesn't even have a flags
  argument to the syscall :-\ It is impossible to fix it in userspace in
  a race-free manner. This patch hence converts local_chmod() to rely on
  open_nofollow() and fchmod(). This fixes the vulnerability but introduces
  a limitation: the target file must readable and/or writable for the call
  to openat() to succeed.

  It introduces a local_set_xattrat() replacement to local_set_xattr()
  based on fsetxattrat() to fix (2), and a local_set_mapped_file_attrat()
  replacement to local_set_mapped_file_attr() based on local_fopenat()
  and mkdirat() to fix (3). No effort is made to factor out code because
  both local_set_xattr() and local_set_mapped_file_attr() will be dropped
  when all users have been converted to use the "at" versions.

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  ad0b46e6ac769b187cb4dcf0065675ef8a198a5e:9pfs: local: link: don't follow symlinks

  The local_link() callback is vulnerable to symlink attacks because it calls:

  (1) link() which follows symbolic links for all path elements but the
      rightmost one
  (2) local_create_mapped_attr_dir()->mkdir() which follows symbolic links
      for all path elements but the rightmost one

  This patch converts local_link() to rely on opendir_nofollow() and linkat()
  to fix (1), mkdirat() to fix (2).

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  d2767edec582558f1e6c52e1dd9370d62e2b30fc:9pfs: local: rename: use renameat

  The local_rename() callback is vulnerable to symlink attacks because it
  uses rename() which follows symbolic links in all path elements but the
  rightmost one.

  This patch simply transforms local_rename() into a wrapper around
  local_renameat() which is symlink-attack safe.

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  99f2cf4b2dad7b37c69759deb0d0b19d3ec1a24a:9pfs: local: renameat: don't follow symlinks

  The local_renameat() callback is currently a wrapper around local_rename()
  which is vulnerable to symlink attacks.

  This patch rewrites local_renameat() to have its own implementation, based
  on local_opendir_nofollow() and renameat().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  f9aef99b3e6df88036436b0d3dc3d504b9346c8c:9pfs: local: lstat: don't follow symlinks

  The local_lstat() callback is vulnerable to symlink attacks because it
  calls:

  (1) lstat() which follows symbolic links in all path elements but the
      rightmost one
  (2) getxattr() which follows symbolic links in all path elements
  (3) local_mapped_file_attr()->local_fopen()->openat(O_NOFOLLOW) which
      follows symbolic links in all path elements but the rightmost
      one

  This patch converts local_lstat() to rely on opendir_nofollow() and
  fstatat(AT_SYMLINK_NOFOLLOW) to fix (1), fgetxattrat_nofollow() to
  fix (2).

  A new local_fopenat() helper is introduced as a replacement to
  local_fopen() to fix (3). No effort is made to factor out code
  because local_fopen() will be dropped when all users have been
  converted to call local_fopenat().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  bec1e9546e03b9e7f5152cf3e8c95cf8acff5e12:9pfs: local: readlink: don't follow symlinks

  The local_readlink() callback is vulnerable to symlink attacks because it
  calls:

  (1) open(O_NOFOLLOW) which follows symbolic links for all path elements but
      the rightmost one
  (2) readlink() which follows symbolic links for all path elements but the
      rightmost one

  This patch converts local_readlink() to rely on open_nofollow() to fix (1)
  and opendir_nofollow(), readlinkat() to fix (2).

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  ac125d993b461d4dee4d6df4d93ac3f2eb959d1d:9pfs: local: truncate: don't follow symlinks

  The local_truncate() callback is vulnerable to symlink attacks because
  it calls truncate() which follows symbolic links in all path elements.

  This patch converts local_truncate() to rely on open_nofollow() and
  ftruncate() instead.

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  31e51d1c15b35dc98b88a301812914b70a2b55dc:9pfs: local: statfs: don't follow symlinks

  The local_statfs() callback is vulnerable to symlink attacks because it
  calls statfs() which follows symbolic links in all path elements.

  This patch converts local_statfs() to rely on open_nofollow() and fstatfs()
  instead.

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  a33eda0dd99e00faa3bacae43d19490bb9500e07:9pfs: local: utimensat: don't follow symlinks

  The local_utimensat() callback is vulnerable to symlink attacks because it
  calls qemu_utimens()->utimensat(AT_SYMLINK_NOFOLLOW) which follows symbolic
  links in all path elements but the rightmost one or qemu_utimens()->utimes()
  which follows symbolic links for all path elements.

  This patch converts local_utimensat() to rely on opendir_nofollow() and
  utimensat(AT_SYMLINK_NOFOLLOW) directly instead of using qemu_utimens().
  It is hence assumed that the OS supports utimensat(), i.e. has glibc 2.6
  or higher and linux 2.6.22 or higher, which seems reasonable nowadays.

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  a0e640a87210b1e986bcd4e7f7de03beb3db0a4a:9pfs: local: remove: don't follow symlinks

  The local_remove() callback is vulnerable to symlink attacks because it
  calls:

  (1) lstat() which follows symbolic links in all path elements but the
      rightmost one
  (2) remove() which follows symbolic links in all path elements but the
      rightmost one

  This patch converts local_remove() to rely on opendir_nofollow(),
  fstatat(AT_SYMLINK_NOFOLLOW) to fix (1) and unlinkat() to fix (2).

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  df4938a6651b1f980018f9eaf86af43e6b9d7fed:9pfs: local: unlinkat: don't follow symlinks

  The local_unlinkat() callback is vulnerable to symlink attacks because it
  calls remove() which follows symbolic links in all path elements but the
  rightmost one.

  This patch converts local_unlinkat() to rely on opendir_nofollow() and
  unlinkat() instead.

  Most of the code is moved to a separate local_unlinkat_common() helper
  which will be reused in a subsequent patch to fix the same issue in
  local_remove().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  72f0d0bf51362011c4d841a89fb8f5cfb16e0bf3:9pfs: local: lremovexattr: don't follow symlinks

  The local_lremovexattr() callback is vulnerable to symlink attacks because
  it calls lremovexattr() which follows symbolic links in all path elements
  but the rightmost one.

  This patch introduces a helper to emulate the non-existing fremovexattrat()
  function: it is implemented with /proc/self/fd which provides a trusted
  path that can be safely passed to lremovexattr().

  local_lremovexattr() is converted to use this helper and opendir_nofollow().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  3e36aba757f76673007a80b3cd56a4062c2e3462:9pfs: local: lsetxattr: don't follow symlinks

  The local_lsetxattr() callback is vulnerable to symlink attacks because
  it calls lsetxattr() which follows symbolic links in all path elements but
  the rightmost one.

  This patch introduces a helper to emulate the non-existing fsetxattrat()
  function: it is implemented with /proc/self/fd which provides a trusted
  path that can be safely passed to lsetxattr().

  local_lsetxattr() is converted to use this helper and opendir_nofollow().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  5507904e362df252f6065cb27d1ff98372db6abc:9pfs: local: llistxattr: don't follow symlinks

  The local_llistxattr() callback is vulnerable to symlink attacks because
  it calls llistxattr() which follows symbolic links in all path elements but
  the rightmost one.

  This patch introduces a helper to emulate the non-existing flistxattrat()
  function: it is implemented with /proc/self/fd which provides a trusted
  path that can be safely passed to llistxattr().

  local_llistxattr() is converted to use this helper and opendir_nofollow().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  56ad3e54dad6cdcee8668d170df161d89581846f:9pfs: local: lgetxattr: don't follow symlinks

  The local_lgetxattr() callback is vulnerable to symlink attacks because
  it calls lgetxattr() which follows symbolic links in all path elements but
  the rightmost one.

  This patch introduces a helper to emulate the non-existing fgetxattrat()
  function: it is implemented with /proc/self/fd which provides a trusted
  path that can be safely passed to lgetxattr().

  local_lgetxattr() is converted to use this helper and opendir_nofollow().

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
  996a0d76d7e756e4023ef79bc37bfe629b9eaca7:9pfs: local: open/opendir: don't follow symlinks

  The local_open() and local_opendir() callbacks are vulnerable to symlink
  attacks because they call:

  (1) open(O_NOFOLLOW) which follows symbolic links in all path elements but
      the rightmost one
  (2) opendir() which follows symbolic links in all path elements

  This patch converts both callbacks to use new helpers based on
  openat_nofollow() to only open files and directories if they are
  below the virtfs shared folder

  This partly fixes CVE-2016-9602.

  Signed-off-by: Greg Kurz <groug@kaod.org>
  Reviewed-by: Stefan Hajnoczi <stefanha@redhat.com>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 0bb99557e17ef7336d8621b6f6c6b9591bd3a13d
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 72f0d0bf51362011c4d841a89fb8f5cfb16e0bf3
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: d2767edec582558f1e6c52e1dd9370d62e2b30fc
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: a33eda0dd99e00faa3bacae43d19490bb9500e07
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: d10142c11bdcecebe97fd834a834167053b7a05c
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 3e36aba757f76673007a80b3cd56a4062c2e3462
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 24df3371d97a7516605aef8abbc253a8c162b211
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 4286f58bfc09eade137770bfd2b0700bf6197cf3
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 9f4ba82b069f6d4c104be66c7a201a44f66dcf00
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 62d1dbbfce619efac6d10235fc4d7ba5eb987b3f
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: f9aef99b3e6df88036436b0d3dc3d504b9346c8c
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 5b24a96cd2afff204b1de86d252cc433848ae6fd
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 6c1e3a16bcf2a0d663e10ec34ef058d686339861
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: ad0b46e6ac769b187cb4dcf0065675ef8a198a5e
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: b003fc0d8aa5e7060dbf7e5862b8013c73857c7f
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 31e51d1c15b35dc98b88a301812914b70a2b55dc
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: ec10eada04069a4f22010b4b30c0b70b7f6fd887
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: c8c9aab1731c2c79248bd24121c09e8e270f6007
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 3439290f9ed98f837848d5c9bf688a0c8aa8bd27
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: e314b1b1fb9ec8a4792aa495c3fe627d8f0a58a0
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 0f3490faa8796da9986d798428b034e0bb4d6f1d
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: acf22d2264a131ad2695b5a18746dabf0cc8b843
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 5507904e362df252f6065cb27d1ff98372db6abc
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: a9f46b8b658cc8ba7d7d7d4ab4a6d69e9689268e
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: a15785cfbd2c58354cb27976b3659b6ac30a9601
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 56ad3e54dad6cdcee8668d170df161d89581846f
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: e3187a45dd02a7490f9191c16527dc28a4ba45b9
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: d3c54bf9e7f079e43f37bb0d7c2657e8976d3e1d
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: d93d06a2fc1e126a411178ba2edc10e802e152a1
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 7287e3556fdc56bfd0666a67d6b1d3ca9ce04083
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: d815e7219036d6911fce12efe3e59906264c8536
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: ea9e59bdf609343db067c1d5fab79a9a1b01acf5
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 91225c670a0eec5354d679b4fd676e572cc37a57
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: bec1e9546e03b9e7f5152cf3e8c95cf8acff5e12
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 473a321122fd3c2c327a5a5d01a9a41f26f1734c
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: cfe40e14851e77561074020ff085f1bf49860bc1
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 785d9ab216c70e4fd4710e3127acda888756ef71
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 996a0d76d7e756e4023ef79bc37bfe629b9eaca7
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: a565fea56546e254b7610305b07711f0a3bda0c7
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: ac125d993b461d4dee4d6df4d93ac3f2eb959d1d
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 6a87e7929f97b86c5823d4616fa1aa7636b2f116
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 9c5cb58970d76a0fe41759c738e14f8bb16cc89d
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 38771613ea6759f499645afd709aa422161eb27e
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 3f3a16990b09e62d787bd2eb2dd51aafbe90019a
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: ed6083afc2df439578f00ae6c47338cb2203eaf1
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: a0e640a87210b1e986bcd4e7f7de03beb3db0a4a
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: df4938a6651b1f980018f9eaf86af43e6b9d7fed
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: d369f20763a857eac544a5289a046d0285a91df8
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 99f2cf4b2dad7b37c69759deb0d0b19d3ec1a24a
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
