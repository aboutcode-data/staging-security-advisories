advisory_id: CVE-2023-0664
datasource_id: collect_qemu_fix_commits/CVE-2023-0664
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  b629412e9d2129897126244cdfcc0b0c06df8542:qga/win32: Use rundll for VSS installation

  The custom action uses cmd.exe to run VSS Service installation
  and removal which causes an interactive command shell to spawn.
  This shell can be used to execute any commands as a SYSTEM user.
  Even if call qemu-ga.exe directly the interactive command shell
  will be spawned as qemu-ga.exe is a console application and used
  by users from the console as well as a service.

  As VSS Service runs from DLL which contains the installer and
  uninstaller code, it can be run directly by rundll32.exe without
  any interactive command shell.

  Add specific entry points for rundll which is just a wrapper
  for COMRegister/COMUnregister functions with proper arguments.

  resolves: https://bugzilla.redhat.com/show_bug.cgi?id=2167423
  fixes: CVE-2023-0664 (part 2 of 2)

  Signed-off-by: Konstantin Kostiuk <kkostiuk@redhat.com>
  Reviewed-by: Yan Vugenfirer <yvugenfi@redhat.com>
  Reported-by: Brian Wiltse <brian.wiltse@live.com>
  (cherry picked from commit 07ce178a2b0768eb9e712bb5ad0cf6dc7fcf0158)
  Signed-off-by: Michael Tokarev <mjt@tls.msk.ru>
  5bfbcc3faa43e59e09e9f96ac7eebd98e05ea8e3:qga/win32: Remove change action from MSI installer

  Remove the 'change' button from "Programs and Features" because it does
  not checks if a user is an admin or not. The installer has no components
  to choose from and always installs everything. So the 'change' button is
  not obviously needed but can create a security issue.

  resolves: https://bugzilla.redhat.com/show_bug.cgi?id=2167423
  fixes: CVE-2023-0664 (part 1 of 2)

  Signed-off-by: Konstantin Kostiuk <kkostiuk@redhat.com>
  Reviewed-by: Yan Vugenfirer <yvugenfi@redhat.com>
  Reported-by: Brian Wiltse <brian.wiltse@live.com>
  (cherry picked from commit 88288c2a51faa7c795f053fc8b31b1c16ff804c5)
  Signed-off-by: Michael Tokarev <mjt@tls.msk.ru>
  07ce178a2b0768eb9e712bb5ad0cf6dc7fcf0158:qga/win32: Use rundll for VSS installation

  The custom action uses cmd.exe to run VSS Service installation
  and removal which causes an interactive command shell to spawn.
  This shell can be used to execute any commands as a SYSTEM user.
  Even if call qemu-ga.exe directly the interactive command shell
  will be spawned as qemu-ga.exe is a console application and used
  by users from the console as well as a service.

  As VSS Service runs from DLL which contains the installer and
  uninstaller code, it can be run directly by rundll32.exe without
  any interactive command shell.

  Add specific entry points for rundll which is just a wrapper
  for COMRegister/COMUnregister functions with proper arguments.

  resolves: https://bugzilla.redhat.com/show_bug.cgi?id=2167423
  fixes: CVE-2023-0664 (part 2 of 2)

  Signed-off-by: Konstantin Kostiuk <kkostiuk@redhat.com>
  Reviewed-by: Yan Vugenfirer <yvugenfi@redhat.com>
  Reported-by: Brian Wiltse <brian.wiltse@live.com>
  88288c2a51faa7c795f053fc8b31b1c16ff804c5:qga/win32: Remove change action from MSI installer

  Remove the 'change' button from "Programs and Features" because it does
  not checks if a user is an admin or not. The installer has no components
  to choose from and always installs everything. So the 'change' button is
  not obviously needed but can create a security issue.

  resolves: https://bugzilla.redhat.com/show_bug.cgi?id=2167423
  fixes: CVE-2023-0664 (part 1 of 2)

  Signed-off-by: Konstantin Kostiuk <kkostiuk@redhat.com>
  Reviewed-by: Yan Vugenfirer <yvugenfi@redhat.com>
  Reported-by: Brian Wiltse <brian.wiltse@live.com>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: b629412e9d2129897126244cdfcc0b0c06df8542
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 5bfbcc3faa43e59e09e9f96ac7eebd98e05ea8e3
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 07ce178a2b0768eb9e712bb5ad0cf6dc7fcf0158
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 88288c2a51faa7c795f053fc8b31b1c16ff804c5
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
