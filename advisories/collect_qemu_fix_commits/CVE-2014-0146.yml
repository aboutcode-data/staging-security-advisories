advisory_id: CVE-2014-0146
datasource_id: collect_qemu_fix_commits/CVE-2014-0146
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  c2c52728f5719a4534f52fd2f0c6f3d04e230bdf:qcow2: Fix NULL dereference in qcow2_open() error path (CVE-2014-0146)

  The qcow2 code assumes that s->snapshots is non-NULL if s->nb_snapshots
  != 0. By having the initialisation of both fields separated in
  qcow2_open(), any error occuring in between would cause the error path
  to dereference NULL in qcow2_free_snapshots() if the image had any
  snapshots.

  Signed-off-by: Kevin Wolf <kwolf@redhat.com>
  Reviewed-by: Max Reitz <mreitz@redhat.com>
  Signed-off-by: Stefan Hajnoczi <stefanha@redhat.com>
  (cherry picked from commit 11b128f4062dd7f89b14abc8877ff20d41b28be9)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  53e11bd384a799c03884bd7d8b5be53f025f8e2d:Merge remote-tracking branch 'remotes/stefanha/tags/block-pull-request' into staging

  Block pull request

  # gpg: Signature made Tue 01 Apr 2014 18:11:16 BST using RSA key ID 81AB73C8
  # gpg: Good signature from "Stefan Hajnoczi <stefanha@redhat.com>"
  # gpg:                 aka "Stefan Hajnoczi <stefanha@gmail.com>"

  * remotes/stefanha/tags/block-pull-request: (51 commits)
    qcow2: link all L2 meta updates in preallocate()
    parallels: Sanity check for s->tracks (CVE-2014-0142)
    parallels: Fix catalog size integer overflow (CVE-2014-0143)
    qcow2: Limit snapshot table size
    qcow2: Check maximum L1 size in qcow2_snapshot_load_tmp() (CVE-2014-0143)
    qcow2: Fix L1 allocation size in qcow2_snapshot_load_tmp() (CVE-2014-0145)
    qcow2: Fix NULL dereference in qcow2_open() error path (CVE-2014-0146)
    qcow2: Fix copy_sectors() with VM state
    block: Limit request size (CVE-2014-0143)
    block: vdi bounds check qemu-io tests
    dmg: prevent chunk buffer overflow (CVE-2014-0145)
    dmg: use uint64_t consistently for sectors and lengths
    dmg: sanitize chunk length and sectorcount (CVE-2014-0145)
    dmg: use appropriate types when reading chunks
    dmg: drop broken bdrv_pread() loop
    dmg: prevent out-of-bounds array access on terminator
    dmg: coding style and indentation cleanup
    qcow2: Fix new L1 table size check (CVE-2014-0143)
    qcow2: Protect against some integer overflows in bdrv_check
    qcow2: Fix types in qcow2_alloc_clusters and alloc_clusters_noref
    ...

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  11b128f4062dd7f89b14abc8877ff20d41b28be9:qcow2: Fix NULL dereference in qcow2_open() error path (CVE-2014-0146)

  The qcow2 code assumes that s->snapshots is non-NULL if s->nb_snapshots
  != 0. By having the initialisation of both fields separated in
  qcow2_open(), any error occuring in between would cause the error path
  to dereference NULL in qcow2_free_snapshots() if the image had any
  snapshots.

  Signed-off-by: Kevin Wolf <kwolf@redhat.com>
  Reviewed-by: Max Reitz <mreitz@redhat.com>
  Signed-off-by: Stefan Hajnoczi <stefanha@redhat.com>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 11b128f4062dd7f89b14abc8877ff20d41b28be9
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: c2c52728f5719a4534f52fd2f0c6f3d04e230bdf
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 53e11bd384a799c03884bd7d8b5be53f025f8e2d
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
