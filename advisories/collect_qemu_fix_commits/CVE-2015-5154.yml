advisory_id: CVE-2015-5154
datasource_id: collect_qemu_fix_commits/CVE-2015-5154
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  9634e45e0b2bd4906778efdfb4b38b6fa042ebec:ide: Check array bounds before writing to io_buffer (CVE-2015-5154)

  If the end_transfer_func of a command is called because enough data has
  been read or written for the current PIO transfer, and it fails to
  correctly call the command completion functions, the DRQ bit in the
  status register and s->end_transfer_func may remain set. This allows the
  guest to access further bytes in s->io_buffer beyond s->data_end, and
  eventually overflowing the io_buffer.

  One case where this currently happens is emulation of the ATAPI command
  START STOP UNIT.

  This patch fixes the problem by adding explicit array bounds checks
  before accessing the buffer instead of relying on end_transfer_func to
  function correctly.

  Cc: qemu-stable@nongnu.org
  Signed-off-by: Kevin Wolf <kwolf@redhat.com>
  Reviewed-by: John Snow <jsnow@redhat.com>
  (cherry picked from commit d2ff85854512574e7209f295e87b0835d5b032c6)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  e40db4c6d391419c0039fe274c74df32a6ca1a28:Merge remote-tracking branch 'remotes/jnsnow/tags/cve-2015-5154-pull-request' into staging

  # gpg: Signature made Mon Jul 27 13:01:10 2015 BST using RSA key ID AAFC390E
  # gpg: Good signature from "John Snow (John Huston) <jsnow@redhat.com>"
  # gpg: WARNING: This key is not certified with sufficiently trusted signatures!
  # gpg:          It is not certain that the signature belongs to the owner.
  # Primary key fingerprint: FAEB 9711 A12C F475 812F  18F2 88A9 064D 1835 61EB
  #      Subkey fingerprint: F9B7 ABDB BCAC DF95 BE76  CBD0 7DEF 8106 AAFC 390E

  * remotes/jnsnow/tags/cve-2015-5154-pull-request:
    ide: Clear DRQ after handling all expected accesses
    ide/atapi: Fix START STOP UNIT command completion
    ide: Check array bounds before writing to io_buffer (CVE-2015-5154)

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  d2ff85854512574e7209f295e87b0835d5b032c6:ide: Check array bounds before writing to io_buffer (CVE-2015-5154)

  If the end_transfer_func of a command is called because enough data has
  been read or written for the current PIO transfer, and it fails to
  correctly call the command completion functions, the DRQ bit in the
  status register and s->end_transfer_func may remain set. This allows the
  guest to access further bytes in s->io_buffer beyond s->data_end, and
  eventually overflowing the io_buffer.

  One case where this currently happens is emulation of the ATAPI command
  START STOP UNIT.

  This patch fixes the problem by adding explicit array bounds checks
  before accessing the buffer instead of relying on end_transfer_func to
  function correctly.

  Cc: qemu-stable@nongnu.org
  Signed-off-by: Kevin Wolf <kwolf@redhat.com>
  Reviewed-by: John Snow <jsnow@redhat.com>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: d2ff85854512574e7209f295e87b0835d5b032c6
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 9634e45e0b2bd4906778efdfb4b38b6fa042ebec
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: e40db4c6d391419c0039fe274c74df32a6ca1a28
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
