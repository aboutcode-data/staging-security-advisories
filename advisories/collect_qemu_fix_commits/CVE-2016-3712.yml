advisory_id: CVE-2016-3712
datasource_id: collect_qemu_fix_commits/CVE-2016-3712
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  7ff5dc445d6bb392f9fb3d0a254ef9071304780b:vga: add sr_vbe register set

  Commit "fd3c136 vga: make sure vga register setup for vbe stays intact
  (CVE-2016-3712)." causes a regression.  The win7 installer is unhappy
  because it can't freely modify vga registers any more while in vbe mode.

  This patch introduces a new sr_vbe register set.  The vbe_update_vgaregs
  will fill sr_vbe[] instead of sr[].  Normal vga register reads and
  writes go to sr[].  Any sr register read access happens through a new
  sr() helper function which will read from sr_vbe[] with vbe active and
  from sr[] otherwise.

  This way we can allow guests update sr[] registers as they want, without
  allowing them disrupt vbe video modes that way.

  Cc: qemu-stable@nongnu.org
  Reported-by: Thomas Lamprecht <thomas@lamprecht.org>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Message-id: 1463475294-14119-1-git-send-email-kraxel@redhat.com
  (cherry picked from commit 94ef4f337fb614f18b765a8e0e878a4c23cdedcd)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  38629bf5e4b563d7038cca50ca2c1f09640877da:Merge remote-tracking branch 'remotes/kraxel/tags/pull-vga-20160523-1' into staging

  vga: fix CVE-2016-3712 regression, misc virtio-gpu fixes.

  # gpg: Signature made Mon 23 May 2016 13:30:26 BST using RSA key ID D3E87138
  # gpg: Good signature from "Gerd Hoffmann (work) <kraxel@redhat.com>"
  # gpg:                 aka "Gerd Hoffmann <gerd@kraxel.org>"
  # gpg:                 aka "Gerd Hoffmann (private) <kraxel@gmail.com>"

  * remotes/kraxel/tags/pull-vga-20160523-1:
    vga: add sr_vbe register set
    virtio-gpu: fix ui idx check
    virtio-gpu: use VIRTIO_GPU_MAX_SCANOUTS
    virtio-gpu: check max_outputs only
    virtio-gpu: check max_outputs value
    virtio-vga: propagate on gpu realized error
    virtio-gpu: check early scanout id

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  94ef4f337fb614f18b765a8e0e878a4c23cdedcd:vga: add sr_vbe register set

  Commit "fd3c136 vga: make sure vga register setup for vbe stays intact
  (CVE-2016-3712)." causes a regression.  The win7 installer is unhappy
  because it can't freely modify vga registers any more while in vbe mode.

  This patch introduces a new sr_vbe register set.  The vbe_update_vgaregs
  will fill sr_vbe[] instead of sr[].  Normal vga register reads and
  writes go to sr[].  Any sr register read access happens through a new
  sr() helper function which will read from sr_vbe[] with vbe active and
  from sr[] otherwise.

  This way we can allow guests update sr[] registers as they want, without
  allowing them disrupt vbe video modes that way.

  Cc: qemu-stable@nongnu.org
  Reported-by: Thomas Lamprecht <thomas@lamprecht.org>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Message-id: 1463475294-14119-1-git-send-email-kraxel@redhat.com
  53db932604dfa7bb9241d132e0173894cf54261c:Merge remote-tracking branch 'remotes/kraxel/tags/pull-vga-20160509-1' into staging

  vga security fixes (CVE-2016-3710, CVE-2016-3712)

  # gpg: Signature made Mon 09 May 2016 13:39:30 BST using RSA key ID D3E87138
  # gpg: Good signature from "Gerd Hoffmann (work) <kraxel@redhat.com>"
  # gpg:                 aka "Gerd Hoffmann <gerd@kraxel.org>"
  # gpg:                 aka "Gerd Hoffmann (private) <kraxel@gmail.com>"

  * remotes/kraxel/tags/pull-vga-20160509-1:
    vga: make sure vga register setup for vbe stays intact (CVE-2016-3712).
    vga: update vga register setup on vbe changes
    vga: factor out vga register setup
    vga: add vbe_enabled() helper
    vga: fix banked access bounds checking (CVE-2016-3710)

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  53db932604dfa7bb9241d132e0173894cf54261c:Merge remote-tracking branch 'remotes/kraxel/tags/pull-vga-20160509-1' into staging

  vga security fixes (CVE-2016-3710, CVE-2016-3712)

  # gpg: Signature made Mon 09 May 2016 13:39:30 BST using RSA key ID D3E87138
  # gpg: Good signature from "Gerd Hoffmann (work) <kraxel@redhat.com>"
  # gpg:                 aka "Gerd Hoffmann <gerd@kraxel.org>"
  # gpg:                 aka "Gerd Hoffmann (private) <kraxel@gmail.com>"

  * remotes/kraxel/tags/pull-vga-20160509-1:
    vga: make sure vga register setup for vbe stays intact (CVE-2016-3712).
    vga: update vga register setup on vbe changes
    vga: factor out vga register setup
    vga: add vbe_enabled() helper
    vga: fix banked access bounds checking (CVE-2016-3710)

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  44b86aa32e4147c727fadd9a0f0bc503a5dedb72:vga: make sure vga register setup for vbe stays intact (CVE-2016-3712).

  Call vbe_update_vgaregs() when the guest touches GFX, SEQ or CRT
  registers, to make sure the vga registers will always have the
  values needed by vbe mode.  This makes sure the sanity checks
  applied by vbe_fixup_regs() are effective.

  Without this guests can muck with shift_control, can turn on planar
  vga modes or text mode emulation while VBE is active, making qemu
  take code paths meant for CGA compatibility, but with the very
  large display widths and heigts settable using VBE registers.

  Which is good for one or another buffer overflow.  Not that
  critical as they typically read overflows happening somewhere
  in the display code.  So guests can DoS by crashing qemu with a
  segfault, but it is probably not possible to break out of the VM.

  Fixes: CVE-2016-3712
  Reported-by: Zuozhi Fzz <zuozhi.fzz@alibaba-inc.com>
  Reported-by: P J P <ppandit@redhat.com>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  44b86aa32e4147c727fadd9a0f0bc503a5dedb72:vga: make sure vga register setup for vbe stays intact (CVE-2016-3712).

  Call vbe_update_vgaregs() when the guest touches GFX, SEQ or CRT
  registers, to make sure the vga registers will always have the
  values needed by vbe mode.  This makes sure the sanity checks
  applied by vbe_fixup_regs() are effective.

  Without this guests can muck with shift_control, can turn on planar
  vga modes or text mode emulation while VBE is active, making qemu
  take code paths meant for CGA compatibility, but with the very
  large display widths and heigts settable using VBE registers.

  Which is good for one or another buffer overflow.  Not that
  critical as they typically read overflows happening somewhere
  in the display code.  So guests can DoS by crashing qemu with a
  segfault, but it is probably not possible to break out of the VM.

  Fixes: CVE-2016-3712
  Reported-by: Zuozhi Fzz <zuozhi.fzz@alibaba-inc.com>
  Reported-by: P J P <ppandit@redhat.com>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  fd3c136b3e1482cd0ec7285d6bc2a3e6a62c38d7:vga: make sure vga register setup for vbe stays intact (CVE-2016-3712).

  Call vbe_update_vgaregs() when the guest touches GFX, SEQ or CRT
  registers, to make sure the vga registers will always have the
  values needed by vbe mode.  This makes sure the sanity checks
  applied by vbe_fixup_regs() are effective.

  Without this guests can muck with shift_control, can turn on planar
  vga modes or text mode emulation while VBE is active, making qemu
  take code paths meant for CGA compatibility, but with the very
  large display widths and heigts settable using VBE registers.

  Which is good for one or another buffer overflow.  Not that
  critical as they typically read overflows happening somewhere
  in the display code.  So guests can DoS by crashing qemu with a
  segfault, but it is probably not possible to break out of the VM.

  Fixes: CVE-2016-3712
  Reported-by: Zuozhi Fzz <zuozhi.fzz@alibaba-inc.com>
  Reported-by: P J P <ppandit@redhat.com>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
  fd3c136b3e1482cd0ec7285d6bc2a3e6a62c38d7:vga: make sure vga register setup for vbe stays intact (CVE-2016-3712).

  Call vbe_update_vgaregs() when the guest touches GFX, SEQ or CRT
  registers, to make sure the vga registers will always have the
  values needed by vbe mode.  This makes sure the sanity checks
  applied by vbe_fixup_regs() are effective.

  Without this guests can muck with shift_control, can turn on planar
  vga modes or text mode emulation while VBE is active, making qemu
  take code paths meant for CGA compatibility, but with the very
  large display widths and heigts settable using VBE registers.

  Which is good for one or another buffer overflow.  Not that
  critical as they typically read overflows happening somewhere
  in the display code.  So guests can DoS by crashing qemu with a
  segfault, but it is probably not possible to break out of the VM.

  Fixes: CVE-2016-3712
  Reported-by: Zuozhi Fzz <zuozhi.fzz@alibaba-inc.com>
  Reported-by: P J P <ppandit@redhat.com>
  Signed-off-by: Gerd Hoffmann <kraxel@redhat.com>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 94ef4f337fb614f18b765a8e0e878a4c23cdedcd
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: fd3c136b3e1482cd0ec7285d6bc2a3e6a62c38d7
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 53db932604dfa7bb9241d132e0173894cf54261c
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 38629bf5e4b563d7038cca50ca2c1f09640877da
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 7ff5dc445d6bb392f9fb3d0a254ef9071304780b
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 44b86aa32e4147c727fadd9a0f0bc503a5dedb72
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
