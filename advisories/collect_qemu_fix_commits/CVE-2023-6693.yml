advisory_id: CVE-2023-6693
datasource_id: collect_qemu_fix_commits/CVE-2023-6693
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  415f21c723320af3f694efffb6fc47484cc03fb0:virtio-net: correctly copy vnet header when flushing TX

  When HASH_REPORT is negotiated, the guest_hdr_len might be larger than
  the size of the mergeable rx buffer header. Using
  virtio_net_hdr_mrg_rxbuf during the header swap might lead a stack
  overflow in this case. Fixing this by using virtio_net_hdr_v1_hash
  instead.

  Reported-by: Xiao Lei <leixiao.nop@zju.edu.cn>
  Cc: Yuri Benditovich <yuri.benditovich@daynix.com>
  Cc: qemu-stable@nongnu.org
  Cc: Mauro Matteo Cascella <mcascell@redhat.com>
  Fixes: CVE-2023-6693
  Fixes: e22f0603fb2f ("virtio-net: reference implementation of hash report")
  Reviewed-by: Michael Tokarev <mjt@tls.msk.ru>
  Signed-off-by: Jason Wang <jasowang@redhat.com>
  (cherry picked from commit 2220e8189fb94068dbad333228659fbac819abb0)
  Signed-off-by: Michael Tokarev <mjt@tls.msk.ru>
  dd1d3c8c29144e8e3bb89d18fd7feed4b65d328d:virtio-net: correctly copy vnet header when flushing TX

  When HASH_REPORT is negotiated, the guest_hdr_len might be larger than
  the size of the mergeable rx buffer header. Using
  virtio_net_hdr_mrg_rxbuf during the header swap might lead a stack
  overflow in this case. Fixing this by using virtio_net_hdr_v1_hash
  instead.

  Reported-by: Xiao Lei <leixiao.nop@zju.edu.cn>
  Cc: Yuri Benditovich <yuri.benditovich@daynix.com>
  Cc: qemu-stable@nongnu.org
  Cc: Mauro Matteo Cascella <mcascell@redhat.com>
  Fixes: CVE-2023-6693
  Fixes: e22f0603fb2f ("virtio-net: reference implementation of hash report")
  Reviewed-by: Michael Tokarev <mjt@tls.msk.ru>
  Signed-off-by: Jason Wang <jasowang@redhat.com>
  (cherry picked from commit 2220e8189fb94068dbad333228659fbac819abb0)
  Signed-off-by: Michael Tokarev <mjt@tls.msk.ru>
  939a09575fff7048446e36ce438fa7be6e251d41:virtio-net: correctly copy vnet header when flushing TX

  When HASH_REPORT is negotiated, the guest_hdr_len might be larger than
  the size of the mergeable rx buffer header. Using
  virtio_net_hdr_mrg_rxbuf during the header swap might lead a stack
  overflow in this case. Fixing this by using virtio_net_hdr_v1_hash
  instead.

  Reported-by: Xiao Lei <leixiao.nop@zju.edu.cn>
  Cc: Yuri Benditovich <yuri.benditovich@daynix.com>
  Cc: qemu-stable@nongnu.org
  Cc: Mauro Matteo Cascella <mcascell@redhat.com>
  Fixes: CVE-2023-6693
  Fixes: e22f0603fb2f ("virtio-net: reference implementation of hash report")
  Reviewed-by: Michael Tokarev <mjt@tls.msk.ru>
  Signed-off-by: Jason Wang <jasowang@redhat.com>
  (cherry picked from commit 2220e8189fb94068dbad333228659fbac819abb0)
  Signed-off-by: Michael Tokarev <mjt@tls.msk.ru>
  2220e8189fb94068dbad333228659fbac819abb0:virtio-net: correctly copy vnet header when flushing TX

  When HASH_REPORT is negotiated, the guest_hdr_len might be larger than
  the size of the mergeable rx buffer header. Using
  virtio_net_hdr_mrg_rxbuf during the header swap might lead a stack
  overflow in this case. Fixing this by using virtio_net_hdr_v1_hash
  instead.

  Reported-by: Xiao Lei <leixiao.nop@zju.edu.cn>
  Cc: Yuri Benditovich <yuri.benditovich@daynix.com>
  Cc: qemu-stable@nongnu.org
  Cc: Mauro Matteo Cascella <mcascell@redhat.com>
  Fixes: CVE-2023-6693
  Fixes: e22f0603fb2f ("virtio-net: reference implementation of hash report")
  Reviewed-by: Michael Tokarev <mjt@tls.msk.ru>
  Signed-off-by: Jason Wang <jasowang@redhat.com>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: dd1d3c8c29144e8e3bb89d18fd7feed4b65d328d
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 2220e8189fb94068dbad333228659fbac819abb0
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 939a09575fff7048446e36ce438fa7be6e251d41
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 415f21c723320af3f694efffb6fc47484cc03fb0
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
