advisory_id: CVE-2014-0222
datasource_id: collect_qemu_fix_commits/CVE-2014-0222
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  a3967c74de398149d722deac5c26634a5e9ddbe2:qcow1: Validate L2 table size (CVE-2014-0222)

  Too large L2 table sizes cause unbounded allocations. Images actually
  created by qemu-img only have 512 byte or 4k L2 tables.

  To keep things consistent with cluster sizes, allow ranges between 512
  bytes and 64k (in fact, down to 1 entry = 8 bytes is technically
  working, but L2 table sizes smaller than a cluster don't make a lot of
  sense).

  This also means that the number of bytes on the virtual disk that are
  described by the same L2 table is limited to at most 8k * 64k or 2^29,
  preventively avoiding any integer overflows.

  Cc: qemu-stable@nongnu.org
  Signed-off-by: Kevin Wolf <kwolf@redhat.com>
  Reviewed-by: Benoit Canet <benoit@irqsave.net>
  (cherry picked from commit 42eb58179b3b215bb507da3262b682b8a2ec10b5)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  8b17eb6e6cdd4d5b4f3291c7e8afff83960f00d7:qcow1: Validate L2 table size (CVE-2014-0222)

  Too large L2 table sizes cause unbounded allocations. Images actually
  created by qemu-img only have 512 byte or 4k L2 tables.

  To keep things consistent with cluster sizes, allow ranges between 512
  bytes and 64k (in fact, down to 1 entry = 8 bytes is technically
  working, but L2 table sizes smaller than a cluster don't make a lot of
  sense).

  This also means that the number of bytes on the virtual disk that are
  described by the same L2 table is limited to at most 8k * 64k or 2^29,
  preventively avoiding any integer overflows.

  Cc: qemu-stable@nongnu.org
  Signed-off-by: Kevin Wolf <kwolf@redhat.com>
  Reviewed-by: Benoit Canet <benoit@irqsave.net>
  (cherry picked from commit 42eb58179b3b215bb507da3262b682b8a2ec10b5)
  Signed-off-by: Michael Roth <mdroth@linux.vnet.ibm.com>
  ca8c0fab9504f000216308cafc833eb957fe9284:Merge remote-tracking branch 'remotes/kevin/tags/for-upstream' into staging

  Block patches

  # gpg: Signature made Mon 19 May 2014 15:21:14 BST using RSA key ID C88F2FD6
  # gpg: Good signature from "Kevin Wolf <kwolf@redhat.com>"

  * remotes/kevin/tags/for-upstream: (22 commits)
    block: optimize zero writes with bdrv_write_zeroes
    blockdev: add a function to parse enum ids from strings
    util: add qemu_iovec_is_zero
    qcow1: Stricter backing file length check
    qcow1: Validate image size (CVE-2014-0223)
    qcow1: Validate L2 table size (CVE-2014-0222)
    qcow1: Check maximum cluster size
    qcow1: Make padding in the header explicit
    curl: Add usage documentation
    curl: Add sslverify option
    curl: Remove broken parsing of options from url
    curl: Fix build when curl_multi_socket_action isn't available
    qemu-iotests: Fix blkdebug in VM drive in 030
    qemu-iotests: Fix core dump suppression in test 039
    iotests: Add test for the JSON protocol
    block: Allow JSON filenames
    check-qdict: Add test for qdict_join()
    qdict: Add qdict_join()
    block: add test for vhdx image created by Disk2VHD
    block: vhdx - account for identical header sections
    ...

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  42eb58179b3b215bb507da3262b682b8a2ec10b5:qcow1: Validate L2 table size (CVE-2014-0222)

  Too large L2 table sizes cause unbounded allocations. Images actually
  created by qemu-img only have 512 byte or 4k L2 tables.

  To keep things consistent with cluster sizes, allow ranges between 512
  bytes and 64k (in fact, down to 1 entry = 8 bytes is technically
  working, but L2 table sizes smaller than a cluster don't make a lot of
  sense).

  This also means that the number of bytes on the virtual disk that are
  described by the same L2 table is limited to at most 8k * 64k or 2^29,
  preventively avoiding any integer overflows.

  Cc: qemu-stable@nongnu.org
  Signed-off-by: Kevin Wolf <kwolf@redhat.com>
  Reviewed-by: Benoit Canet <benoit@irqsave.net>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 42eb58179b3b215bb507da3262b682b8a2ec10b5
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 8b17eb6e6cdd4d5b4f3291c7e8afff83960f00d7
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: a3967c74de398149d722deac5c26634a5e9ddbe2
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: ca8c0fab9504f000216308cafc833eb957fe9284
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
