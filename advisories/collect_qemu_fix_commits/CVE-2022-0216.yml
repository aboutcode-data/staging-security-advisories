advisory_id: CVE-2022-0216
datasource_id: collect_qemu_fix_commits/CVE-2022-0216
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: "285f64fcbf86dac2be6dbd0a8a32872bcff3cacb:Merge tag 'for-upstream' of https://gitlab.com/bonzini/qemu\
  \ into staging\n\n* SCSI fuzzing fix (Mauro)\n* pre-install data files in the build directory\
  \ (Akihiko)\n* SCSI fixes for Mac OS (Mark)\n\n# gpg: Signature made Wed 13 Jul 2022 15:59:00\
  \ BST\n# gpg:                using RSA key F13338574B662389866C7682BFFBD25F78C7AE83\n# gpg:\
  \                issuer \"pbonzini@redhat.com\"\n# gpg: Good signature from \"Paolo Bonzini\
  \ <bonzini@gnu.org>\" [full]\n# gpg:                 aka \"Paolo Bonzini <pbonzini@redhat.com>\"\
  \ [full]\n# Primary key fingerprint: 46F5 9FBD 57D6 12E7 BFD4  E2F7 7E15 100C CD36 69B1\n\
  #      Subkey fingerprint: F133 3857 4B66 2389 866C  7682 BFFB D25F 78C7 AE83\n\n* tag 'for-upstream'\
  \ of https://gitlab.com/bonzini/qemu:\n  pc-bios/s390-ccw: add -Wno-array-bounds\n  q800:\
  \ add default vendor and product information for scsi-cd devices\n  q800: add default vendor\
  \ and product information for scsi-hd devices\n  scsi-disk: allow MODE SELECT block descriptor\
  \ to set the block size\n  scsi-disk: allow the MODE_PAGE_R_W_ERROR AWRE bit to be changeable\
  \ for CDROM drives\n  q800: implement compat_props to enable quirk_mode_page_truncated for\
  \ scsi-cd devices\n  scsi-disk: add SCSI_DISK_QUIRK_MODE_PAGE_TRUNCATED quirk for Macintosh\n\
  \  scsi-disk: add FORMAT UNIT command\n  q800: implement compat_props to enable quirk_mode_page_vendor_specific_apple\
  \ for scsi devices\n  scsi-disk: add SCSI_DISK_QUIRK_MODE_PAGE_VENDOR_SPECIFIC_APPLE quirk\
  \ for Macintosh\n  q800: implement compat_props to enable quirk_mode_sense_rom_use_dbd for\
  \ scsi-cd devices\n  scsi-disk: add SCSI_DISK_QUIRK_MODE_SENSE_ROM_USE_DBD quirk for Macintosh\n\
  \  q800: implement compat_props to enable quirk_mode_page_apple_vendor for scsi-cd devices\n\
  \  scsi-disk: add MODE_PAGE_APPLE_VENDOR quirk for Macintosh\n  scsi-disk: add new quirks\
  \ bitmap to SCSIDiskState\n  meson: Prefix each element of firmware path\n  module: Use bundle\
  \ mechanism\n  datadir: Use bundle mechanism\n  cutils: Introduce bundle mechanism\n  scsi/lsi53c895a:\
  \ really fix use-after-free in lsi_do_msgout (CVE-2022-0216)\n\nSigned-off-by: Peter Maydell\
  \ <peter.maydell@linaro.org>\n4367a20cc442c56b05611b4224de9a61908f9eac:scsi/lsi53c895a: really\
  \ fix use-after-free in lsi_do_msgout (CVE-2022-0216)\n\nSet current_req to NULL, not current_req->req,\
  \ to prevent reusing a free'd\nbuffer in case of repeated SCSI cancel requests.  Also apply\
  \ the fix to\nCLEAR QUEUE and BUS DEVICE RESET messages as well, since they also cancel\n\
  the request.\n\nThanks to Alexander Bulekov for providing a reproducer.\n\nFixes: CVE-2022-0216\n\
  Resolves: https://gitlab.com/qemu-project/qemu/-/issues/972\nSigned-off-by: Mauro Matteo Cascella\
  \ <mcascell@redhat.com>\nTested-by: Alexander Bulekov <alxndr@bu.edu>\nMessage-Id: <20220711123316.421279-1-mcascell@redhat.com>\n\
  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>\n4367a20cc442c56b05611b4224de9a61908f9eac:scsi/lsi53c895a:\
  \ really fix use-after-free in lsi_do_msgout (CVE-2022-0216)\n\nSet current_req to NULL, not\
  \ current_req->req, to prevent reusing a free'd\nbuffer in case of repeated SCSI cancel requests.\
  \  Also apply the fix to\nCLEAR QUEUE and BUS DEVICE RESET messages as well, since they also\
  \ cancel\nthe request.\n\nThanks to Alexander Bulekov for providing a reproducer.\n\nFixes:\
  \ CVE-2022-0216\nResolves: https://gitlab.com/qemu-project/qemu/-/issues/972\nSigned-off-by:\
  \ Mauro Matteo Cascella <mcascell@redhat.com>\nTested-by: Alexander Bulekov <alxndr@bu.edu>\n\
  Message-Id: <20220711123316.421279-1-mcascell@redhat.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>\n\
  8e3d85d36b77f11ad7bded3a2d48c1f0cc334f82:Merge tag 'for-upstream' of https://gitlab.com/bonzini/qemu\
  \ into staging\n\n* fuzzing fixes (Alexander)\n* fix cross compilation CFLAGS and compiler\
  \ choice\n* do not specify -bios option for tests/vm\n* miscellaneous fixes\n* preparation\
  \ for pre-install tree in the build directory (Akihiko)\n\n# gpg: Signature made Tue 12 Jul\
  \ 2022 13:47:19 BST\n# gpg:                using RSA key F13338574B662389866C7682BFFBD25F78C7AE83\n\
  # gpg:                issuer \"pbonzini@redhat.com\"\n# gpg: Good signature from \"Paolo Bonzini\
  \ <bonzini@gnu.org>\" [full]\n# gpg:                 aka \"Paolo Bonzini <pbonzini@redhat.com>\"\
  \ [full]\n# Primary key fingerprint: 46F5 9FBD 57D6 12E7 BFD4  E2F7 7E15 100C CD36 69B1\n\
  #      Subkey fingerprint: F133 3857 4B66 2389 866C  7682 BFFB D25F 78C7 AE83\n\n* tag 'for-upstream'\
  \ of https://gitlab.com/bonzini/qemu:\n  meson: place default firmware path under .../share\n\
  \  qga: Relocate a path emitted in the help text\n  build: Do not depend on pc-bios for config-host.mak\n\
  \  accel: kvm: Fix memory leak in find_stats_descriptors\n  audio/dbus: fix building\n  fuzz:\
  \ only use generic-fuzz targets on oss-fuzz\n  build: improve -fsanitize-coverage-allowlist\
  \ check\n  build: try both native and cross compilers\n  configure: pass whole target name\
  \ to probe_target_compiler\n  tests/tcg: compile system emulation tests as freestanding\n\
  \  configure: write EXTRA_CFLAGS for all sub-Makefiles\n  configure: allow more host/target\
  \ combos to use the host compiler\n  configure, pc-bios/vof: pass cross CFLAGS correctly\n\
  \  configure, pc-bios/s390-ccw: pass cross CFLAGS correctly\n  configure, pc-bios/optionrom:\
  \ pass cross CFLAGS correctly\n  pc-bios/optionrom: use -m16 unconditionally\n  scsi/lsi53c895a:\
  \ fix use-after-free in lsi_do_msgout (CVE-2022-0216)\n  tests/vm: do not specify -bios option\n\
  \nSigned-off-by: Peter Maydell <peter.maydell@linaro.org>\n\n# Conflicts:\n#\tpc-bios/s390-ccw/netboot.mak\n\
  6c8fa961da5e60f574bb52fd3ad44b1e9e8ad4b8:scsi/lsi53c895a: fix use-after-free in lsi_do_msgout\
  \ (CVE-2022-0216)\n\nSet current_req->req to NULL to prevent reusing a free'd buffer in case\
  \ of\nrepeated SCSI cancel requests. Thanks to Thomas Huth for suggesting the patch.\n\nFixes:\
  \ CVE-2022-0216\nResolves: https://gitlab.com/qemu-project/qemu/-/issues/972\nSigned-off-by:\
  \ Mauro Matteo Cascella <mcascell@redhat.com>\nReviewed-by: Thomas Huth <thuth@redhat.com>\n\
  Message-Id: <20220705200543.2366809-1-mcascell@redhat.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>\n\
  6c8fa961da5e60f574bb52fd3ad44b1e9e8ad4b8:scsi/lsi53c895a: fix use-after-free in lsi_do_msgout\
  \ (CVE-2022-0216)\n\nSet current_req->req to NULL to prevent reusing a free'd buffer in case\
  \ of\nrepeated SCSI cancel requests. Thanks to Thomas Huth for suggesting the patch.\n\nFixes:\
  \ CVE-2022-0216\nResolves: https://gitlab.com/qemu-project/qemu/-/issues/972\nSigned-off-by:\
  \ Mauro Matteo Cascella <mcascell@redhat.com>\nReviewed-by: Thomas Huth <thuth@redhat.com>\n\
  Message-Id: <20220705200543.2366809-1-mcascell@redhat.com>\nSigned-off-by: Paolo Bonzini <pbonzini@redhat.com>"
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 4367a20cc442c56b05611b4224de9a61908f9eac
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 8e3d85d36b77f11ad7bded3a2d48c1f0cc334f82
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 285f64fcbf86dac2be6dbd0a8a32872bcff3cacb
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 6c8fa961da5e60f574bb52fd3ad44b1e9e8ad4b8
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
