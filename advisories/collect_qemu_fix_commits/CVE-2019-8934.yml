advisory_id: CVE-2019-8934
datasource_id: collect_qemu_fix_commits/CVE-2019-8934
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  0a794529bd1109aeea0c407784b40a2605e808b9:spapr: Simplify handling of host-serial and host-model values

  27461d69a0f "ppc: add host-serial and host-model machine attributes
  (CVE-2019-8934)" introduced 'host-serial' and 'host-model' machine
  properties for spapr to explicitly control the values advertised to the
  guest in device tree properties with the same names.

  The previous behaviour on KVM was to unconditionally populate the device
  tree with the real host serial number and model, which leaks possibly
  sensitive information about the host to the guest.

  To maintain compatibility for old machine types, we allowed those props
  to be set to "passthrough" to take the value from the host as before.  Or
  they could be set to "none" to explicitly omit the device tree items.

  Special casing specific values on what's otherwise a user supplied string
  is very ugly.  So, this patch simplifies things by implementing the
  backwards compatibility in a different way: we have a machine class flag
  set for the older machines, and we only load the host values into the
  device tree if A) they're not set by the user and B) we have that flag set.

  This does mean that the "passthrough" functionality is no longer available
  with the current machine type.  That's ok though: if a user or management
  layer really wants the information passed through they can read it
  themselves (OpenStack Nova already does something similar for x86).

  It also means the user can't explicitly ask for the values to be omitted
  on the old machine types.  I think that's an acceptable trade-off: if you
  care enough about not leaking the host information you can either move to
  the new machine type, or use a dummy value for the properties.

  For the new machine type, this also removes an odd inconsistency
  between running on a POWER and non-POWER (or non-Linux) hosts: if the
  host information couldn't be read from where we expect (in the host's
  device tree as exposed by Linux), we'd fallback to omitting the guest
  device tree items.

  While we're there, improve some poorly worded comments, and the help text
  for the properties.

  Signed-off-by: David Gibson <david@gibson.dropbear.id.au>
  Reviewed-by: Daniel P. Berrangé <berrange@redhat.com>
  Reviewed-by: Greg Kurz <groug@kaod.org>
  Tested-by: Greg Kurz <groug@kaod.org>
  1387294169a37e4694313e41e05fc32f211b0564:Merge remote-tracking branch 'remotes/dgibson/tags/ppc-for-4.0-20190226' into staging

  ppc patch queue 2019-02-26

  Next set of patches for ppc and spapr.  There's a lot in this one:
   * Support "STOP light" states on POWER9
   * Add support for HVI interrupts on POWER9 (powernv machine)
   * CVE-2019-8934: Don't leak host model and serial information to the guest
   * Tests and cleanups for various hot unplug options
   * Hash and radix MMU implementation on POWER9 for powernv machine
   * PCI Host Bridge hotplug support for pseries machine
   * Allow larger kernels and initrds for powernv machine

  Plus a handful of miscellaneous fixes and cleanups.

  The cpu hotplug tests and cleanups from David Hildenbrand aren't
  solely power related.  However the consensus amongst Michael Tsirkin,
  David Hildenbrand, Cornelia Huck and myself was that it made most
  sense to come in via my tree.

  # gpg: Signature made Tue 26 Feb 2019 03:37:46 GMT
  # gpg:                using RSA key 75F46586AE61A66CC44E87DC6C38CACA20D9B392
  # gpg: Good signature from "David Gibson <david@gibson.dropbear.id.au>" [full]
  # gpg:                 aka "David Gibson (Red Hat) <dgibson@redhat.com>" [full]
  # gpg:                 aka "David Gibson (ozlabs.org) <dgibson@ozlabs.org>" [full]
  # gpg:                 aka "David Gibson (kernel.org) <dwg@kernel.org>" [unknown]
  # Primary key fingerprint: 75F4 6586 AE61 A66C C44E  87DC 6C38 CACA 20D9 B392

  * remotes/dgibson/tags/ppc-for-4.0-20190226: (50 commits)
    ppc/pnv: use IEC binary prefixes to represent sizes
    ppc/pnv: add INITRD_MAX_SIZE constant
    ppc/pnv: increase kernel size limit to 256MiB
    hw/ppc: Use object_initialize_child for correct reference counting
    ppc/xive: xive does not have a POWER7 interrupt model
    tests/device-plug: Add PHB unplug request test for spapr
    spapr: enable PHB hotplug for default pseries machine type
    spapr: add hotplug hooks for PHB hotplug
    spapr_pci: add ibm, my-drc-index property for PHB hotplug
    spapr_pci: provide node start offset via spapr_populate_pci_dt()
    spapr_events: add support for phb hotplug events
    spapr: populate PHB DRC entries for root DT node
    spapr: create DR connectors for PHBs
    spapr_pci: add PHB unrealize
    spapr_irq: Expose the phandle of the interrupt controller
    spapr: Expose the name of the interrupt controller node
    xics: Write source state to KVM at claim time
    spapr/drc: Drop spapr_drc_attach() fdt argument
    spapr/pci: Generate FDT fragment at configure connector time
    spapr: Generate FDT fragment for CPUs at configure connector time
    ...

  Signed-off-by: Peter Maydell <peter.maydell@linaro.org>
  27461d69a0f108dea756419251acc3ea65198f1b:ppc: add host-serial and host-model machine attributes (CVE-2019-8934)

  On ppc hosts, hypervisor shares following system attributes

    - /proc/device-tree/system-id
    - /proc/device-tree/model

  with a guest. This could lead to information leakage and misuse.[*]
  Add machine attributes to control such system information exposure
  to a guest.

  [*] https://wiki.openstack.org/wiki/OSSN/OSSN-0028

  Reported-by: Daniel P. Berrangé <berrange@redhat.com>
  Fix-suggested-by: Daniel P. Berrangé <berrange@redhat.com>
  Signed-off-by: Prasad J Pandit <pjp@fedoraproject.org>
  Message-Id: <20190218181349.23885-1-ppandit@redhat.com>
  Reviewed-by: Daniel P. Berrangé <berrange@redhat.com>
  Reviewed-by: Greg Kurz <groug@kaod.org>
  Signed-off-by: David Gibson <david@gibson.dropbear.id.au>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 27461d69a0f108dea756419251acc3ea65198f1b
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 1387294169a37e4694313e41e05fc32f211b0564
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 0a794529bd1109aeea0c407784b40a2605e808b9
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
