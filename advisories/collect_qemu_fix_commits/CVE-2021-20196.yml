advisory_id: CVE-2021-20196
datasource_id: collect_qemu_fix_commits/CVE-2021-20196
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  ef0cf1887ee9acb21a8d7a06e83bdbbae0fdf9e6:tests/qtest/fdc-test: Add a regression test for CVE-2021-20196

  Without the previous commit, when running 'make check-qtest-i386'
  with QEMU configured with '--enable-sanitizers' we get:

    AddressSanitizer:DEADLYSIGNAL
    =================================================================
    ==287878==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000344
    ==287878==The signal is caused by a WRITE memory access.
    ==287878==Hint: address points to the zero page.
        #0 0x564b2e5bac27 in blk_inc_in_flight block/block-backend.c:1346:5
        #1 0x564b2e5bb228 in blk_pwritev_part block/block-backend.c:1317:5
        #2 0x564b2e5bcd57 in blk_pwrite block/block-backend.c:1498:11
        #3 0x564b2ca1cdd3 in fdctrl_write_data hw/block/fdc.c:2221:17
        #4 0x564b2ca1b2f7 in fdctrl_write hw/block/fdc.c:829:9
        #5 0x564b2dc49503 in portio_write softmmu/ioport.c:201:9

  Add the reproducer for CVE-2021-20196.

  Suggested-by: Alexander Bulekov <alxndr@bu.edu>
  Reviewed-by: Darren Kenny <darren.kenny@oracle.com>
  Signed-off-by: Philippe Mathieu-Daudé <philmd@redhat.com>
  Message-id: 20211124161536.631563-4-philmd@redhat.com
  Signed-off-by: John Snow <jsnow@redhat.com>
  (cherry picked from commit cc20926e9b8077bff6813efc8dcdeae90d1a3b10)
  Signed-off-by: Michael Roth <michael.roth@amd.com>
  ef0cf1887ee9acb21a8d7a06e83bdbbae0fdf9e6:tests/qtest/fdc-test: Add a regression test for CVE-2021-20196

  Without the previous commit, when running 'make check-qtest-i386'
  with QEMU configured with '--enable-sanitizers' we get:

    AddressSanitizer:DEADLYSIGNAL
    =================================================================
    ==287878==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000344
    ==287878==The signal is caused by a WRITE memory access.
    ==287878==Hint: address points to the zero page.
        #0 0x564b2e5bac27 in blk_inc_in_flight block/block-backend.c:1346:5
        #1 0x564b2e5bb228 in blk_pwritev_part block/block-backend.c:1317:5
        #2 0x564b2e5bcd57 in blk_pwrite block/block-backend.c:1498:11
        #3 0x564b2ca1cdd3 in fdctrl_write_data hw/block/fdc.c:2221:17
        #4 0x564b2ca1b2f7 in fdctrl_write hw/block/fdc.c:829:9
        #5 0x564b2dc49503 in portio_write softmmu/ioport.c:201:9

  Add the reproducer for CVE-2021-20196.

  Suggested-by: Alexander Bulekov <alxndr@bu.edu>
  Reviewed-by: Darren Kenny <darren.kenny@oracle.com>
  Signed-off-by: Philippe Mathieu-Daudé <philmd@redhat.com>
  Message-id: 20211124161536.631563-4-philmd@redhat.com
  Signed-off-by: John Snow <jsnow@redhat.com>
  (cherry picked from commit cc20926e9b8077bff6813efc8dcdeae90d1a3b10)
  Signed-off-by: Michael Roth <michael.roth@amd.com>
  71ba2adfeb4ca63015d4a51a665e67c46a06e822:hw/block/fdc: Kludge missing floppy drive to fix CVE-2021-20196

  Guest might select another drive on the bus by setting the
  DRIVE_SEL bit of the DIGITAL OUTPUT REGISTER (DOR).
  The current controller model doesn't expect a BlockBackend
  to be NULL. A simple way to fix CVE-2021-20196 is to create
  an empty BlockBackend when it is missing. All further
  accesses will be safely handled, and the controller state
  machines keep behaving correctly.

  Cc: qemu-stable@nongnu.org
  Fixes: CVE-2021-20196
  Reported-by: Gaoning Pan (Ant Security Light-Year Lab) <pgn@zju.edu.cn>
  Reviewed-by: Darren Kenny <darren.kenny@oracle.com>
  Reviewed-by: Hanna Reitz <hreitz@redhat.com>
  Signed-off-by: Philippe Mathieu-Daudé <philmd@redhat.com>
  Message-id: 20211124161536.631563-3-philmd@redhat.com
  BugLink: https://bugs.launchpad.net/qemu/+bug/1912780
  Resolves: https://gitlab.com/qemu-project/qemu/-/issues/338
  Reviewed-by: Darren Kenny <darren.kenny@oracle.com>
  Reviewed-by: Hanna Reitz <hreitz@redhat.com>
  Signed-off-by: Philippe Mathieu-Daudé <philmd@redhat.com>
  Signed-off-by: John Snow <jsnow@redhat.com>
  (cherry picked from commit 1ab95af033a419e7a64e2d58e67dd96b20af5233)
  Signed-off-by: Michael Roth <michael.roth@amd.com>
  71ba2adfeb4ca63015d4a51a665e67c46a06e822:hw/block/fdc: Kludge missing floppy drive to fix CVE-2021-20196

  Guest might select another drive on the bus by setting the
  DRIVE_SEL bit of the DIGITAL OUTPUT REGISTER (DOR).
  The current controller model doesn't expect a BlockBackend
  to be NULL. A simple way to fix CVE-2021-20196 is to create
  an empty BlockBackend when it is missing. All further
  accesses will be safely handled, and the controller state
  machines keep behaving correctly.

  Cc: qemu-stable@nongnu.org
  Fixes: CVE-2021-20196
  Reported-by: Gaoning Pan (Ant Security Light-Year Lab) <pgn@zju.edu.cn>
  Reviewed-by: Darren Kenny <darren.kenny@oracle.com>
  Reviewed-by: Hanna Reitz <hreitz@redhat.com>
  Signed-off-by: Philippe Mathieu-Daudé <philmd@redhat.com>
  Message-id: 20211124161536.631563-3-philmd@redhat.com
  BugLink: https://bugs.launchpad.net/qemu/+bug/1912780
  Resolves: https://gitlab.com/qemu-project/qemu/-/issues/338
  Reviewed-by: Darren Kenny <darren.kenny@oracle.com>
  Reviewed-by: Hanna Reitz <hreitz@redhat.com>
  Signed-off-by: Philippe Mathieu-Daudé <philmd@redhat.com>
  Signed-off-by: John Snow <jsnow@redhat.com>
  (cherry picked from commit 1ab95af033a419e7a64e2d58e67dd96b20af5233)
  Signed-off-by: Michael Roth <michael.roth@amd.com>
  71ba2adfeb4ca63015d4a51a665e67c46a06e822:hw/block/fdc: Kludge missing floppy drive to fix CVE-2021-20196

  Guest might select another drive on the bus by setting the
  DRIVE_SEL bit of the DIGITAL OUTPUT REGISTER (DOR).
  The current controller model doesn't expect a BlockBackend
  to be NULL. A simple way to fix CVE-2021-20196 is to create
  an empty BlockBackend when it is missing. All further
  accesses will be safely handled, and the controller state
  machines keep behaving correctly.

  Cc: qemu-stable@nongnu.org
  Fixes: CVE-2021-20196
  Reported-by: Gaoning Pan (Ant Security Light-Year Lab) <pgn@zju.edu.cn>
  Reviewed-by: Darren Kenny <darren.kenny@oracle.com>
  Reviewed-by: Hanna Reitz <hreitz@redhat.com>
  Signed-off-by: Philippe Mathieu-Daudé <philmd@redhat.com>
  Message-id: 20211124161536.631563-3-philmd@redhat.com
  BugLink: https://bugs.launchpad.net/qemu/+bug/1912780
  Resolves: https://gitlab.com/qemu-project/qemu/-/issues/338
  Reviewed-by: Darren Kenny <darren.kenny@oracle.com>
  Reviewed-by: Hanna Reitz <hreitz@redhat.com>
  Signed-off-by: Philippe Mathieu-Daudé <philmd@redhat.com>
  Signed-off-by: John Snow <jsnow@redhat.com>
  (cherry picked from commit 1ab95af033a419e7a64e2d58e67dd96b20af5233)
  Signed-off-by: Michael Roth <michael.roth@amd.com>
  a69254a2b320e31d3aa63ca910b7aa02efcd5492:Merge tag 'ide-pull-request' of https://gitlab.com/jsnow/qemu into staging

  Pull request

  # gpg: Signature made Wed 01 Dec 2021 10:17:38 PM PST
  # gpg:                using RSA key F9B7ABDBBCACDF95BE76CBD07DEF8106AAFC390E
  # gpg: Good signature from "John Snow (John Huston) <jsnow@redhat.com>" [full]

  * tag 'ide-pull-request' of https://gitlab.com/jsnow/qemu:
    tests/qtest/fdc-test: Add a regression test for CVE-2021-20196
    hw/block/fdc: Kludge missing floppy drive to fix CVE-2021-20196
    hw/block/fdc: Extract blk_create_empty_drive()

  Signed-off-by: Richard Henderson <richard.henderson@linaro.org>
  a69254a2b320e31d3aa63ca910b7aa02efcd5492:Merge tag 'ide-pull-request' of https://gitlab.com/jsnow/qemu into staging

  Pull request

  # gpg: Signature made Wed 01 Dec 2021 10:17:38 PM PST
  # gpg:                using RSA key F9B7ABDBBCACDF95BE76CBD07DEF8106AAFC390E
  # gpg: Good signature from "John Snow (John Huston) <jsnow@redhat.com>" [full]

  * tag 'ide-pull-request' of https://gitlab.com/jsnow/qemu:
    tests/qtest/fdc-test: Add a regression test for CVE-2021-20196
    hw/block/fdc: Kludge missing floppy drive to fix CVE-2021-20196
    hw/block/fdc: Extract blk_create_empty_drive()

  Signed-off-by: Richard Henderson <richard.henderson@linaro.org>
  cc20926e9b8077bff6813efc8dcdeae90d1a3b10:tests/qtest/fdc-test: Add a regression test for CVE-2021-20196

  Without the previous commit, when running 'make check-qtest-i386'
  with QEMU configured with '--enable-sanitizers' we get:

    AddressSanitizer:DEADLYSIGNAL
    =================================================================
    ==287878==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000344
    ==287878==The signal is caused by a WRITE memory access.
    ==287878==Hint: address points to the zero page.
        #0 0x564b2e5bac27 in blk_inc_in_flight block/block-backend.c:1346:5
        #1 0x564b2e5bb228 in blk_pwritev_part block/block-backend.c:1317:5
        #2 0x564b2e5bcd57 in blk_pwrite block/block-backend.c:1498:11
        #3 0x564b2ca1cdd3 in fdctrl_write_data hw/block/fdc.c:2221:17
        #4 0x564b2ca1b2f7 in fdctrl_write hw/block/fdc.c:829:9
        #5 0x564b2dc49503 in portio_write softmmu/ioport.c:201:9

  Add the reproducer for CVE-2021-20196.

  Suggested-by: Alexander Bulekov <alxndr@bu.edu>
  Reviewed-by: Darren Kenny <darren.kenny@oracle.com>
  Signed-off-by: Philippe Mathieu-Daudé <philmd@redhat.com>
  Message-id: 20211124161536.631563-4-philmd@redhat.com
  Signed-off-by: John Snow <jsnow@redhat.com>
  cc20926e9b8077bff6813efc8dcdeae90d1a3b10:tests/qtest/fdc-test: Add a regression test for CVE-2021-20196

  Without the previous commit, when running 'make check-qtest-i386'
  with QEMU configured with '--enable-sanitizers' we get:

    AddressSanitizer:DEADLYSIGNAL
    =================================================================
    ==287878==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000344
    ==287878==The signal is caused by a WRITE memory access.
    ==287878==Hint: address points to the zero page.
        #0 0x564b2e5bac27 in blk_inc_in_flight block/block-backend.c:1346:5
        #1 0x564b2e5bb228 in blk_pwritev_part block/block-backend.c:1317:5
        #2 0x564b2e5bcd57 in blk_pwrite block/block-backend.c:1498:11
        #3 0x564b2ca1cdd3 in fdctrl_write_data hw/block/fdc.c:2221:17
        #4 0x564b2ca1b2f7 in fdctrl_write hw/block/fdc.c:829:9
        #5 0x564b2dc49503 in portio_write softmmu/ioport.c:201:9

  Add the reproducer for CVE-2021-20196.

  Suggested-by: Alexander Bulekov <alxndr@bu.edu>
  Reviewed-by: Darren Kenny <darren.kenny@oracle.com>
  Signed-off-by: Philippe Mathieu-Daudé <philmd@redhat.com>
  Message-id: 20211124161536.631563-4-philmd@redhat.com
  Signed-off-by: John Snow <jsnow@redhat.com>
  1ab95af033a419e7a64e2d58e67dd96b20af5233:hw/block/fdc: Kludge missing floppy drive to fix CVE-2021-20196

  Guest might select another drive on the bus by setting the
  DRIVE_SEL bit of the DIGITAL OUTPUT REGISTER (DOR).
  The current controller model doesn't expect a BlockBackend
  to be NULL. A simple way to fix CVE-2021-20196 is to create
  an empty BlockBackend when it is missing. All further
  accesses will be safely handled, and the controller state
  machines keep behaving correctly.

  Cc: qemu-stable@nongnu.org
  Fixes: CVE-2021-20196
  Reported-by: Gaoning Pan (Ant Security Light-Year Lab) <pgn@zju.edu.cn>
  Reviewed-by: Darren Kenny <darren.kenny@oracle.com>
  Reviewed-by: Hanna Reitz <hreitz@redhat.com>
  Signed-off-by: Philippe Mathieu-Daudé <philmd@redhat.com>
  Message-id: 20211124161536.631563-3-philmd@redhat.com
  BugLink: https://bugs.launchpad.net/qemu/+bug/1912780
  Resolves: https://gitlab.com/qemu-project/qemu/-/issues/338
  Reviewed-by: Darren Kenny <darren.kenny@oracle.com>
  Reviewed-by: Hanna Reitz <hreitz@redhat.com>
  Signed-off-by: Philippe Mathieu-Daudé <philmd@redhat.com>
  Signed-off-by: John Snow <jsnow@redhat.com>
  1ab95af033a419e7a64e2d58e67dd96b20af5233:hw/block/fdc: Kludge missing floppy drive to fix CVE-2021-20196

  Guest might select another drive on the bus by setting the
  DRIVE_SEL bit of the DIGITAL OUTPUT REGISTER (DOR).
  The current controller model doesn't expect a BlockBackend
  to be NULL. A simple way to fix CVE-2021-20196 is to create
  an empty BlockBackend when it is missing. All further
  accesses will be safely handled, and the controller state
  machines keep behaving correctly.

  Cc: qemu-stable@nongnu.org
  Fixes: CVE-2021-20196
  Reported-by: Gaoning Pan (Ant Security Light-Year Lab) <pgn@zju.edu.cn>
  Reviewed-by: Darren Kenny <darren.kenny@oracle.com>
  Reviewed-by: Hanna Reitz <hreitz@redhat.com>
  Signed-off-by: Philippe Mathieu-Daudé <philmd@redhat.com>
  Message-id: 20211124161536.631563-3-philmd@redhat.com
  BugLink: https://bugs.launchpad.net/qemu/+bug/1912780
  Resolves: https://gitlab.com/qemu-project/qemu/-/issues/338
  Reviewed-by: Darren Kenny <darren.kenny@oracle.com>
  Reviewed-by: Hanna Reitz <hreitz@redhat.com>
  Signed-off-by: Philippe Mathieu-Daudé <philmd@redhat.com>
  Signed-off-by: John Snow <jsnow@redhat.com>
  1ab95af033a419e7a64e2d58e67dd96b20af5233:hw/block/fdc: Kludge missing floppy drive to fix CVE-2021-20196

  Guest might select another drive on the bus by setting the
  DRIVE_SEL bit of the DIGITAL OUTPUT REGISTER (DOR).
  The current controller model doesn't expect a BlockBackend
  to be NULL. A simple way to fix CVE-2021-20196 is to create
  an empty BlockBackend when it is missing. All further
  accesses will be safely handled, and the controller state
  machines keep behaving correctly.

  Cc: qemu-stable@nongnu.org
  Fixes: CVE-2021-20196
  Reported-by: Gaoning Pan (Ant Security Light-Year Lab) <pgn@zju.edu.cn>
  Reviewed-by: Darren Kenny <darren.kenny@oracle.com>
  Reviewed-by: Hanna Reitz <hreitz@redhat.com>
  Signed-off-by: Philippe Mathieu-Daudé <philmd@redhat.com>
  Message-id: 20211124161536.631563-3-philmd@redhat.com
  BugLink: https://bugs.launchpad.net/qemu/+bug/1912780
  Resolves: https://gitlab.com/qemu-project/qemu/-/issues/338
  Reviewed-by: Darren Kenny <darren.kenny@oracle.com>
  Reviewed-by: Hanna Reitz <hreitz@redhat.com>
  Signed-off-by: Philippe Mathieu-Daudé <philmd@redhat.com>
  Signed-off-by: John Snow <jsnow@redhat.com>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: ef0cf1887ee9acb21a8d7a06e83bdbbae0fdf9e6
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 1ab95af033a419e7a64e2d58e67dd96b20af5233
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: a69254a2b320e31d3aa63ca910b7aa02efcd5492
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: cc20926e9b8077bff6813efc8dcdeae90d1a3b10
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 71ba2adfeb4ca63015d4a51a665e67c46a06e822
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
