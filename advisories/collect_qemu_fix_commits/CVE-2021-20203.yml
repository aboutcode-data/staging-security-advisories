advisory_id: CVE-2021-20203
datasource_id: collect_qemu_fix_commits/CVE-2021-20203
datasource_url: https://gitlab.com/qemu-project/qemu
aliases: []
summary: |
  b209cc4556d56938fa8a933670b8fb98c036af37:hw/net/vmxnet3: allow VMXNET3_MAX_MTU itself as a value

  Currently, VMXNET3_MAX_MTU itself (being 9000) is not considered a
  valid value for the MTU, but a guest running ESXi 7.0 might try to
  set it and fail the assert [0].

  In the Linux kernel, dev->max_mtu itself is a valid value for the MTU
  and for the vmxnet3 driver it's 9000, so a guest running Linux will
  also fail the assert when trying to set an MTU of 9000.

  VMXNET3_MAX_MTU and s->mtu don't seem to be used in relation to buffer
  allocations/accesses, so allowing the upper limit itself as a value
  should be fine.

  [0]: https://forum.proxmox.com/threads/114011/

  Fixes: d05dcd94ae ("net: vmxnet3: validate configuration values during activate (CVE-2021-20203)")
  Signed-off-by: Fiona Ebner <f.ebner@proxmox.com>
  Signed-off-by: Jason Wang <jasowang@redhat.com>
  (cherry picked from commit 099a63828130843741d317cb28e936f468b2b53b)
  Signed-off-by: Michael Tokarev <mjt@tls.msk.ru>
  099a63828130843741d317cb28e936f468b2b53b:hw/net/vmxnet3: allow VMXNET3_MAX_MTU itself as a value

  Currently, VMXNET3_MAX_MTU itself (being 9000) is not considered a
  valid value for the MTU, but a guest running ESXi 7.0 might try to
  set it and fail the assert [0].

  In the Linux kernel, dev->max_mtu itself is a valid value for the MTU
  and for the vmxnet3 driver it's 9000, so a guest running Linux will
  also fail the assert when trying to set an MTU of 9000.

  VMXNET3_MAX_MTU and s->mtu don't seem to be used in relation to buffer
  allocations/accesses, so allowing the upper limit itself as a value
  should be fine.

  [0]: https://forum.proxmox.com/threads/114011/

  Fixes: d05dcd94ae ("net: vmxnet3: validate configuration values during activate (CVE-2021-20203)")
  Signed-off-by: Fiona Ebner <f.ebner@proxmox.com>
  Signed-off-by: Jason Wang <jasowang@redhat.com>
  1ce084af083b6958c8287ea742a008a105bc960d:net: vmxnet3: validate configuration values during activate (CVE-2021-20203)

  While activating device in vmxnet3_acticate_device(), it does not
  validate guest supplied configuration values against predefined
  minimum - maximum limits. This may lead to integer overflow or
  OOB access issues. Add checks to avoid it.

  Fixes: CVE-2021-20203
  Buglink: https://bugs.launchpad.net/qemu/+bug/1913873
  Reported-by: Gaoning Pan <pgn@zju.edu.cn>
  Signed-off-by: Prasad J Pandit <pjp@fedoraproject.org>
  Signed-off-by: Jason Wang <jasowang@redhat.com>
  (cherry picked from commit d05dcd94aee88728facafb993c7280547eb4d645)
  Signed-off-by: Michael Roth <michael.roth@amd.com>
  1ce084af083b6958c8287ea742a008a105bc960d:net: vmxnet3: validate configuration values during activate (CVE-2021-20203)

  While activating device in vmxnet3_acticate_device(), it does not
  validate guest supplied configuration values against predefined
  minimum - maximum limits. This may lead to integer overflow or
  OOB access issues. Add checks to avoid it.

  Fixes: CVE-2021-20203
  Buglink: https://bugs.launchpad.net/qemu/+bug/1913873
  Reported-by: Gaoning Pan <pgn@zju.edu.cn>
  Signed-off-by: Prasad J Pandit <pjp@fedoraproject.org>
  Signed-off-by: Jason Wang <jasowang@redhat.com>
  (cherry picked from commit d05dcd94aee88728facafb993c7280547eb4d645)
  Signed-off-by: Michael Roth <michael.roth@amd.com>
  3760a04c352f8d255b247211f6da07ac99f1630a:Merge tag 'net-pull-request' of https://github.com/jasowang/qemu into staging

  # gpg: Signature made Fri 19 Nov 2021 04:45:32 AM CET
  # gpg:                using RSA key EF04965B398D6211
  # gpg: Good signature from "Jason Wang (Jason Wang on RedHat) <jasowang@redhat.com>" [marginal]
  # gpg: WARNING: This key is not certified with sufficiently trusted signatures!
  # gpg:          It is not certain that the signature belongs to the owner.
  # Primary key fingerprint: 215D 46F4 8246 689E C77F  3562 EF04 965B 398D 6211

  * tag 'net-pull-request' of https://github.com/jasowang/qemu:
    net/colo-compare.c: Fix incorrect return when input wrong size
    net/colo-compare.c: Fix ACK track reverse issue
    net: vmxnet3: validate configuration values during activate (CVE-2021-20203)

  Signed-off-by: Richard Henderson <richard.henderson@linaro.org>
  d05dcd94aee88728facafb993c7280547eb4d645:net: vmxnet3: validate configuration values during activate (CVE-2021-20203)

  While activating device in vmxnet3_acticate_device(), it does not
  validate guest supplied configuration values against predefined
  minimum - maximum limits. This may lead to integer overflow or
  OOB access issues. Add checks to avoid it.

  Fixes: CVE-2021-20203
  Buglink: https://bugs.launchpad.net/qemu/+bug/1913873
  Reported-by: Gaoning Pan <pgn@zju.edu.cn>
  Signed-off-by: Prasad J Pandit <pjp@fedoraproject.org>
  Signed-off-by: Jason Wang <jasowang@redhat.com>
  d05dcd94aee88728facafb993c7280547eb4d645:net: vmxnet3: validate configuration values during activate (CVE-2021-20203)

  While activating device in vmxnet3_acticate_device(), it does not
  validate guest supplied configuration values against predefined
  minimum - maximum limits. This may lead to integer overflow or
  OOB access issues. Add checks to avoid it.

  Fixes: CVE-2021-20203
  Buglink: https://bugs.launchpad.net/qemu/+bug/1913873
  Reported-by: Gaoning Pan <pgn@zju.edu.cn>
  Signed-off-by: Prasad J Pandit <pjp@fedoraproject.org>
  Signed-off-by: Jason Wang <jasowang@redhat.com>
impacted_packages:
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 3760a04c352f8d255b247211f6da07ac99f1630a
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 1ce084af083b6958c8287ea742a008a105bc960d
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: 099a63828130843741d317cb28e936f468b2b53b
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: d05dcd94aee88728facafb993c7280547eb4d645
    introduced_in_commits: []
  - purl: pkg:gitlab/qemu-project/qemu
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://gitlab.com/qemu-project/qemu
        commit: b209cc4556d56938fa8a933670b8fb98c036af37
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://gitlab.com/qemu-project/qemu
    reference_type: commit
    reference_id: 91c6438caffc880e999a7312825479685d659b44
