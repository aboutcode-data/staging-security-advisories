advisory_id: UBUNTU-CVE-2025-59734
datasource_id: ubuntu_osv_importer_v2/UBUNTU-CVE-2025-59734
datasource_url: https://github.com/canonical/ubuntu-security-notices/blob/main/osv/cve/2025/UBUNTU-CVE-2025-59734.json
aliases:
  - CVE-2025-59734
summary: It is possible to cause an use-after-free write in SANM decoding with a carefully crafted
  animation using subversion <2. When a STOR chunk is present, a subsequent FOBJ chunk will
  be saved in ctx->stored_frame. Stored frames can later be referenced by FTCH chunks. For files
  using subversion < 2, the undecoded frame is stored, and decoded again when the FTCH chunks
  are parsed. However, in process_frame_obj if the frame has an invalid size, there’s an early
  return, with a value of 0. This causes the code in decode_frame to still store the raw frame
  buffer into ctx->stored_frame. Leaving ctx->has_dimensions set to false. A subsequent chunk
  with type FTCH would call process_ftch and decode that frame obj again, adding to the top/left
  values and calling process_frame_obj again. Given that we never set ctx->have_dimensions before,
  this time we set the dimensions, calling init_buffers, which can reallocate the buffer in
  ctx->stored_frame, freeing the previous one. However, the GetByteContext object gb still holds
  a reference to the old buffer. Finally, when the code tries to decode the frame, codecs that
  accept a GetByteContext as a parameter will trigger a use-after-free read when using gb. GetByteContext is
  only used for reading bytes, so at most one could read invalid data. There are no heap allocations
  between the free and when the object is accessed. However, upon returning to process_ftch,
  the code restores the original values for top/left in stored_frame, writing 4 bytes to the
  freed data at offset 6, potentially corrupting the allocator’s metadata. This issue can be
  triggered just by probing whether a file has the sanm format. We recommend upgrading to version
  8.0 or beyond.
impacted_packages:
  - purl: pkg:deb/ubuntu/libav?arch=source&distro=esm-infra-legacy/trusty
    affected_versions: vers:deb/6:0.8.7-1ubuntu2|6:9.10-1ubuntu1|6:9.10-1ubuntu2|6:9.10-1ubuntu5|6:9.10-1ubuntu6|6:9.10-1ubuntu7|6:9.11-2ubuntu1|6:9.11-2ubuntu2|6:9.13-0ubuntu0.14.04.1|6:9.14-0ubuntu0.14.04.1|6:9.16-0ubuntu0.14.04.1|6:9.18-0ubuntu0.14.04.1|6:9.20-0ubuntu0.14.04.1|6:9.20-0ubuntu0.14.04.1+esm1
    fixed_versions:
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/ubuntu/ffmpeg?arch=source&distro=esm-apps/xenial
    affected_versions: vers:deb/7:2.7.2-1build1|7:2.8.1-1ubuntu1|7:2.8.2-1ubuntu1|7:2.8.3-1|7:2.8.4-1|7:2.8.4-1ubuntu1|7:2.8.4-1ubuntu2|7:2.8.4-1ubuntu3|7:2.8.4-1ubuntu4|7:2.8.6-1ubuntu1|7:2.8.6-1ubuntu2|7:2.8.8-0ubuntu0.16.04.1|7:2.8.10-0ubuntu0.16.04.1|7:2.8.11-0ubuntu0.16.04.1|7:2.8.14-0ubuntu0.16.04.1|7:2.8.15-0ubuntu0.16.04.1|7:2.8.15-0ubuntu0.16.04.1+esm1|7:2.8.17-0ubuntu0.1|7:2.8.17-0ubuntu0.1+esm1|7:2.8.17-0ubuntu0.1+esm2|7:2.8.17-0ubuntu0.1+esm3|7:2.8.17-0ubuntu0.1+esm4|7:2.8.17-0ubuntu0.1+esm5|7:2.8.17-0ubuntu0.1+esm6|7:2.8.17-0ubuntu0.1+esm7|7:2.8.17-0ubuntu0.1+esm8|7:2.8.17-0ubuntu0.1+esm9|7:2.8.17-0ubuntu0.1+esm10|7:2.8.17-0ubuntu0.1+esm11|7:2.8.17-0ubuntu0.1+esm12|7:2.8.17-0ubuntu0.1+esm13|7:2.8.17-0ubuntu0.1+esm14
    fixed_versions:
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/ubuntu/ffmpeg?arch=source&distro=esm-apps/bionic
    affected_versions: vers:deb/7:3.3.4-2|7:3.3.4-2build3|7:3.4-2ubuntu2|7:3.4-4|7:3.4-4build1|7:3.4.1-1|7:3.4.1-1build1|7:3.4.2-1|7:3.4.2-1build1|7:3.4.2-2|7:3.4.4-0ubuntu0.18.04.1|7:3.4.6-0ubuntu0.18.04.1|7:3.4.8-0ubuntu0.2|7:3.4.11-0ubuntu0.1|7:3.4.11-0ubuntu0.1+esm1|7:3.4.11-0ubuntu0.1+esm2|7:3.4.11-0ubuntu0.1+esm3|7:3.4.11-0ubuntu0.1+esm4|7:3.4.11-0ubuntu0.1+esm5|7:3.4.11-0ubuntu0.1+esm6|7:3.4.11-0ubuntu0.1+esm7|7:3.4.11-0ubuntu0.1+esm8|7:3.4.11-0ubuntu0.1+esm9|7:3.4.11-0ubuntu0.1+esm10|7:3.4.11-0ubuntu0.1+esm11|7:3.4.11-0ubuntu0.1+esm12
    fixed_versions:
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/ubuntu/ffmpeg?arch=source&distro=esm-apps/focal
    affected_versions: vers:deb/7:4.1.4-1build2|7:4.2.1-2|7:4.2.1-2ubuntu1|7:4.2.2-1build1|7:4.2.2-1ubuntu1|7:4.2.4-1ubuntu0.1|7:4.2.4-1ubuntu0.1+esm1|7:4.2.7-0ubuntu0.1|7:4.2.7-0ubuntu0.1+esm1|7:4.2.7-0ubuntu0.1+esm2|7:4.2.7-0ubuntu0.1+esm3|7:4.2.7-0ubuntu0.1+esm4|7:4.2.7-0ubuntu0.1+esm5|7:4.2.7-0ubuntu0.1+esm6|7:4.2.7-0ubuntu0.1+esm7|7:4.2.7-0ubuntu0.1+esm8|7:4.2.7-0ubuntu0.1+esm9|7:4.2.7-0ubuntu0.1+esm10|7:4.2.7-0ubuntu0.1+esm11|7:4.2.7-0ubuntu0.1+esm12
    fixed_versions:
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:deb/ubuntu/ffmpeg?arch=source&distro=questing
    affected_versions: vers:deb/7:7.1.1-1ubuntu1|7:7.1.1-1ubuntu2|7:7.1.1-1ubuntu3|7:7.1.1-1ubuntu4|7:7.1.1-1ubuntu4.1|7:7.1.1-1ubuntu4.2
    fixed_versions:
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '8.7'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:A/AC:H/AT:N/PR:N/UI:P/VC:H/VI:H/VA:N/SC:H/SI:H/SA:N
    published_at: None
    url: https://github.com/canonical/ubuntu-security-notices/blob/main/osv/cve/2025/UBUNTU-CVE-2025-59734.json
  - score: medium
    scoring_system: ubuntu-priority
    scoring_elements:
    published_at: None
    url: https://github.com/canonical/ubuntu-security-notices/blob/main/osv/cve/2025/UBUNTU-CVE-2025-59734.json
weaknesses: []
references:
  - url: https://issuetracker.google.com/issues/440183164
    reference_type:
    reference_id:
  - url: https://ubuntu.com/security/CVE-2025-59734
    reference_type:
    reference_id:
  - url: https://www.cve.org/CVERecord?id=CVE-2025-59734
    reference_type:
    reference_id:
