advisory_id: CVE-2025-38216
datasource_id: nvd_importer_v2/CVE-2025-38216
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-38216
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  iommu/vt-d: Restore context entry setup order for aliased devices

  Commit 2031c469f816 ("iommu/vt-d: Add support for static identity domain")
  changed the context entry setup during domain attachment from a
  set-and-check policy to a clear-and-reset approach. This inadvertently
  introduced a regression affecting PCI aliased devices behind PCIe-to-PCI
  bridges.

  Specifically, keyboard and touchpad stopped working on several Apple
  Macbooks with below messages:

   kernel: platform pxa2xx-spi.3: Adding to iommu group 20
   kernel: input: Apple SPI Keyboard as
   /devices/pci0000:00/0000:00:1e.3/pxa2xx-spi.3/spi_master/spi2/spi-APP000D:00/input/input0
   kernel: DMAR: DRHD: handling fault status reg 3
   kernel: DMAR: [DMA Read NO_PASID] Request device [00:1e.3] fault addr
   0xffffa000 [fault reason 0x06] PTE Read access is not set
   kernel: DMAR: DRHD: handling fault status reg 3
   kernel: DMAR: [DMA Read NO_PASID] Request device [00:1e.3] fault addr
   0xffffa000 [fault reason 0x06] PTE Read access is not set
   kernel: applespi spi-APP000D:00: Error writing to device: 01 0e 00 00
   kernel: DMAR: DRHD: handling fault status reg 3
   kernel: DMAR: [DMA Read NO_PASID] Request device [00:1e.3] fault addr
   0xffffa000 [fault reason 0x06] PTE Read access is not set
   kernel: DMAR: DRHD: handling fault status reg 3
   kernel: applespi spi-APP000D:00: Error writing to device: 01 0e 00 00

  Fix this by restoring the previous context setup order.
impacted_packages: []
severities:
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-38216
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/320302baed05c6456164652541f23d2a96522c06
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d43c81b691813e16a2d08208ce8947aebdab83cd
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/fb5873b779dd5858123c19bbd6959566771e2e83
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-38216
    reference_type:
    reference_id: CVE-2025-38216
