advisory_id: CVE-2025-38682
datasource_id: nvd_importer_v2/CVE-2025-38682
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-38682
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  i2c: core: Fix double-free of fwnode in i2c_unregister_device()

  Before commit df6d7277e552 ("i2c: core: Do not dereference fwnode in struct
  device"), i2c_unregister_device() only called fwnode_handle_put() on
  of_node-s in the form of calling of_node_put(client->dev.of_node).

  But after this commit the i2c_client's fwnode now unconditionally gets
  fwnode_handle_put() on it.

  When the i2c_client has no primary (ACPI / OF) fwnode but it does have
  a software fwnode, the software-node will be the primary node and
  fwnode_handle_put() will put() it.

  But for the software fwnode device_remove_software_node() will also put()
  it leading to a double free:

  [   82.665598] ------------[ cut here ]------------
  [   82.665609] refcount_t: underflow; use-after-free.
  [   82.665808] WARNING: CPU: 3 PID: 1502 at lib/refcount.c:28 refcount_warn_saturate+0xba/0x11
  ...
  [   82.666830] RIP: 0010:refcount_warn_saturate+0xba/0x110
  ...
  [   82.666962]  <TASK>
  [   82.666971]  i2c_unregister_device+0x60/0x90

  Fix this by not calling fwnode_handle_put() when the primary fwnode is
  a software-node.
impacted_packages: []
severities:
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-38682
weaknesses:
  - CWE-415
references:
  - url: https://git.kernel.org/stable/c/1c24e5fc0c7096e00c202a6a3e0c342c1afb47c2
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ffe02f7c4e36090154646612e67d331832f92037
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-38682
    reference_type:
    reference_id: CVE-2025-38682
