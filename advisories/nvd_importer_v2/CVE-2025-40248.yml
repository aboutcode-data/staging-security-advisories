advisory_id: CVE-2025-40248
datasource_id: nvd_importer_v2/CVE-2025-40248
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-40248
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  vsock: Ignore signal/timeout on connect() if already established

  During connect(), acting on a signal/timeout by disconnecting an already
  established socket leads to several issues:

  1. connect() invoking vsock_transport_cancel_pkt() ->
     virtio_transport_purge_skbs() may race with sendmsg() invoking
     virtio_transport_get_credit(). This results in a permanently elevated
     `vvs->bytes_unsent`. Which, in turn, confuses the SOCK_LINGER handling.

  2. connect() resetting a connected socket's state may race with socket
     being placed in a sockmap. A disconnected socket remaining in a sockmap
     breaks sockmap's assumptions. And gives rise to WARNs.

  3. connect() transitioning SS_CONNECTED -> SS_UNCONNECTED allows for a
     transport change/drop after TCP_ESTABLISHED. Which poses a problem for
     any simultaneous sendmsg() or connect() and may result in a
     use-after-free/null-ptr-deref.

  Do not disconnect socket on signal/timeout. Keep the logic for unconnected
  sockets: they don't linger, can't be placed in a sockmap, are rejected by
  sendmsg().

  [1]: https://lore.kernel.org/netdev/e07fd95c-9a38-4eea-9638-133e38c2ec9b@rbox.co/
  [2]: https://lore.kernel.org/netdev/20250317-vsock-trans-signal-race-v4-0-fc8837f3f1d4@rbox.co/
  [3]: https://lore.kernel.org/netdev/60f1b7db-3099-4f6a-875e-af9f6ef194f6@rbox.co/
impacted_packages: []
severities: []
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/002541ef650b742a198e4be363881439bb9d86b4
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/3f71753935d648082a8279a97d30efe6b85be680
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5998da5a8208ae9ad7838ba322bccb2bdcd95e81
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/67432915145848658149683101104e32f9fd6559
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ab6b19f690d89ae4709fba73a3c4a7911f495b7a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/da664101fb4a0de5cb70d2bae6a650df954df2af
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/eeca93f06df89be5a36305b7b9dae1ed65550dfc
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f1c170cae285e4b8f61be043bb17addc3d0a14b5
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-40248
    reference_type:
    reference_id: CVE-2025-40248
