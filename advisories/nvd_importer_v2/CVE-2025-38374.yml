advisory_id: CVE-2025-38374
datasource_id: nvd_importer_v2/CVE-2025-38374
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-38374
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  optee: ffa: fix sleep in atomic context

  The OP-TEE driver registers the function notif_callback() for FF-A
  notifications. However, this function is called in an atomic context
  leading to errors like this when processing asynchronous notifications:

   | BUG: sleeping function called from invalid context at kernel/locking/mutex.c:258
   | in_atomic(): 1, irqs_disabled(): 1, non_block: 0, pid: 9, name: kworker/0:0
   | preempt_count: 1, expected: 0
   | RCU nest depth: 0, expected: 0
   | CPU: 0 UID: 0 PID: 9 Comm: kworker/0:0 Not tainted 6.14.0-00019-g657536ebe0aa #13
   | Hardware name: linux,dummy-virt (DT)
   | Workqueue: ffa_pcpu_irq_notification notif_pcpu_irq_work_fn
   | Call trace:
   |  show_stack+0x18/0x24 (C)
   |  dump_stack_lvl+0x78/0x90
   |  dump_stack+0x18/0x24
   |  __might_resched+0x114/0x170
   |  __might_sleep+0x48/0x98
   |  mutex_lock+0x24/0x80
   |  optee_get_msg_arg+0x7c/0x21c
   |  simple_call_with_arg+0x50/0xc0
   |  optee_do_bottom_half+0x14/0x20
   |  notif_callback+0x3c/0x48
   |  handle_notif_callbacks+0x9c/0xe0
   |  notif_get_and_handle+0x40/0x88
   |  generic_exec_single+0x80/0xc0
   |  smp_call_function_single+0xfc/0x1a0
   |  notif_pcpu_irq_work_fn+0x2c/0x38
   |  process_one_work+0x14c/0x2b4
   |  worker_thread+0x2e4/0x3e0
   |  kthread+0x13c/0x210
   |  ret_from_fork+0x10/0x20

  Fix this by adding work queue to process the notification in a
  non-atomic context.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-38374
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/312d02adb959ea199372f375ada06e0186f651e4
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5f28563f0c6862c99eb115c918421d9b73f137ad
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f27cf15783bd60063c6c97434cbd67ebd91d8db5
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-38374
    reference_type:
    reference_id: CVE-2025-38374
