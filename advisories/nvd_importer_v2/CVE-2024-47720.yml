advisory_id: CVE-2024-47720
datasource_id: nvd_importer_v2/CVE-2024-47720
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-47720
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  drm/amd/display: Add null check for set_output_gamma in dcn30_set_output_transfer_func

  This commit adds a null check for the set_output_gamma function pointer
  in the  dcn30_set_output_transfer_func function. Previously,
  set_output_gamma was being checked for nullity at line 386, but then it
  was being dereferenced without any nullity check at line 401. This
  could potentially lead to a null pointer dereference error if
  set_output_gamma is indeed null.

  To fix this, we now ensure that set_output_gamma is not null before
  dereferencing it. We do this by adding a nullity check for
  set_output_gamma before the call to set_output_gamma at line 401. If
  set_output_gamma is null, we log an error message and do not call the
  function.

  This fix prevents a potential null pointer dereference error.

  drivers/gpu/drm/amd/amdgpu/../display/dc/hwss/dcn30/dcn30_hwseq.c:401 dcn30_set_output_transfer_func()
  error: we previously assumed 'mpc->funcs->set_output_gamma' could be null (see line 386)

  drivers/gpu/drm/amd/amdgpu/../display/dc/hwss/dcn30/dcn30_hwseq.c
      373 bool dcn30_set_output_transfer_func(struct dc *dc,
      374                                 struct pipe_ctx *pipe_ctx,
      375                                 const struct dc_stream_state *stream)
      376 {
      377         int mpcc_id = pipe_ctx->plane_res.hubp->inst;
      378         struct mpc *mpc = pipe_ctx->stream_res.opp->ctx->dc->res_pool->mpc;
      379         const struct pwl_params *params = NULL;
      380         bool ret = false;
      381
      382         /* program OGAM or 3DLUT only for the top pipe*/
      383         if (pipe_ctx->top_pipe == NULL) {
      384                 /*program rmu shaper and 3dlut in MPC*/
      385                 ret = dcn30_set_mpc_shaper_3dlut(pipe_ctx, stream);
      386                 if (ret == false && mpc->funcs->set_output_gamma) {
                                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ If this is NULL

      387                         if (stream->out_transfer_func.type == TF_TYPE_HWPWL)
      388                                 params = &stream->out_transfer_func.pwl;
      389                         else if (pipe_ctx->stream->out_transfer_func.type ==
      390                                         TF_TYPE_DISTRIBUTED_POINTS &&
      391                                         cm3_helper_translate_curve_to_hw_format(
      392                                         &stream->out_transfer_func,
      393                                         &mpc->blender_params, false))
      394                                 params = &mpc->blender_params;
      395                          /* there are no ROM LUTs in OUTGAM */
      396                         if (stream->out_transfer_func.type == TF_TYPE_PREDEFINED)
      397                                 BREAK_TO_DEBUGGER();
      398                 }
      399         }
      400
  --> 401         mpc->funcs->set_output_gamma(mpc, mpcc_id, params);
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^ Then it will crash

      402         return ret;
      403 }
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-47720
weaknesses:
  - CWE-476
references:
  - url: https://git.kernel.org/stable/c/08ae395ea22fb3d9b318c8bde28c0dfd2f5fa4d2
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/44948d3cb943602ba4a0b5ed3c91ae0525838fb1
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/64886a4e6f1dce843c0889505cf0673b5211e16a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/72ee32d0907364104fbcf4f68dd5ae63cd8eae9e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/84edd5a3f5fa6aafa4afcaf9f101f46426c620c9
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ddf9ff244d704e1903533f7be377615ed34b83e7
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/01/msg00001.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-47720
    reference_type:
    reference_id: CVE-2024-47720
