advisory_id: CVE-2025-38527
datasource_id: nvd_importer_v2/CVE-2025-38527
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-38527
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  smb: client: fix use-after-free in cifs_oplock_break

  A race condition can occur in cifs_oplock_break() leading to a
  use-after-free of the cinode structure when unmounting:

    cifs_oplock_break()
      _cifsFileInfo_put(cfile)
        cifsFileInfo_put_final()
          cifs_sb_deactive()
            [last ref, start releasing sb]
              kill_sb()
                kill_anon_super()
                  generic_shutdown_super()
                    evict_inodes()
                      dispose_list()
                        evict()
                          destroy_inode()
                            call_rcu(&inode->i_rcu, i_callback)
      spin_lock(&cinode->open_file_lock)  <- OK
                              [later] i_callback()
                                cifs_free_inode()
                                  kmem_cache_free(cinode)
      spin_unlock(&cinode->open_file_lock)  <- UAF
      cifs_done_oplock_break(cinode)       <- UAF

  The issue occurs when umount has already released its reference to the
  superblock. When _cifsFileInfo_put() calls cifs_sb_deactive(), this
  releases the last reference, triggering the immediate cleanup of all
  inodes under RCU. However, cifs_oplock_break() continues to access the
  cinode after this point, resulting in use-after-free.

  Fix this by holding an extra reference to the superblock during the
  entire oplock break operation. This ensures that the superblock and
  its inodes remain valid until the oplock break completes.
impacted_packages: []
severities:
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-38527
weaknesses:
  - CWE-416
references:
  - url: https://git.kernel.org/stable/c/09bce2138a30ef10d8821c8c3f73a4ab7a5726bc
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/0a4eec84d4d2c4085d4ed8630fd74e4b39033c1b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/2baaf5bbab2ac474c4f92c10fcb3310f824db995
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/4256a483fe58af66a46cbf3dc48ff26e580d3308
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/705c79101ccf9edea5a00d761491a03ced314210
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/da11bd4b697b393a207f19a2ed7d382a811a3ddc
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/10/msg00008.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:debian:debian_linux:11.0:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:debian:debian_linux:11.0:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.1:-:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.1:-:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.1:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.1:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.1:rc7:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.1:rc7:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-38527
    reference_type:
    reference_id: CVE-2025-38527
