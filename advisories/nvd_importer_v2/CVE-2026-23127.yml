advisory_id: CVE-2026-23127
datasource_id: nvd_importer_v2/CVE-2026-23127
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2026-23127
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  perf: Fix refcount warning on event->mmap_count increment

  When calling refcount_inc(&event->mmap_count) inside perf_mmap_rb(), the
  following warning is triggered:

          refcount_t: addition on 0; use-after-free.
          WARNING: lib/refcount.c:25

  PoC:

      struct perf_event_attr attr = {0};
      int fd = syscall(__NR_perf_event_open, &attr, 0, -1, -1, 0);
      mmap(NULL, 0x3000, PROT_READ | PROT_WRITE, MAP_SHARED, fd, 0);
      int victim = syscall(__NR_perf_event_open, &attr, 0, -1, fd,
                           PERF_FLAG_FD_OUTPUT);
      mmap(NULL, 0x3000, PROT_READ | PROT_WRITE, MAP_SHARED, victim, 0);

  This occurs when creating a group member event with the flag
  PERF_FLAG_FD_OUTPUT. The group leader should be mmap-ed and then mmap-ing
  the event triggers the warning.

  Since the event has copied the output_event in perf_event_set_output(),
  event->rb is set. As a result, perf_mmap_rb() calls
  refcount_inc(&event->mmap_count) when event->mmap_count = 0.

  Disallow the case when event->mmap_count = 0. This also prevents two
  events from updating the same user_page.
impacted_packages: []
severities: []
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/23c0e4bd93d0b250775162faf456470485ac9fc7
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d06bf78e55d5159c1b00072e606ab924ffbbad35
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2026-23127
    reference_type:
    reference_id: CVE-2026-23127
