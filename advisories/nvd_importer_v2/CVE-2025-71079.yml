advisory_id: CVE-2025-71079
datasource_id: nvd_importer_v2/CVE-2025-71079
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-71079
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  net: nfc: fix deadlock between nfc_unregister_device and rfkill_fop_write

  A deadlock can occur between nfc_unregister_device() and rfkill_fop_write()
  due to lock ordering inversion between device_lock and rfkill_global_mutex.

  The problematic lock order is:

  Thread A (rfkill_fop_write):
    rfkill_fop_write()
      mutex_lock(&rfkill_global_mutex)
        rfkill_set_block()
          nfc_rfkill_set_block()
            nfc_dev_down()
              device_lock(&dev->dev)    <- waits for device_lock

  Thread B (nfc_unregister_device):
    nfc_unregister_device()
      device_lock(&dev->dev)
        rfkill_unregister()
          mutex_lock(&rfkill_global_mutex)  <- waits for rfkill_global_mutex

  This creates a classic ABBA deadlock scenario.

  Fix this by moving rfkill_unregister() and rfkill_destroy() outside the
  device_lock critical section. Store the rfkill pointer in a local variable
  before releasing the lock, then call rfkill_unregister() after releasing
  device_lock.

  This change is safe because rfkill_fop_write() holds rfkill_global_mutex
  while calling the rfkill callbacks, and rfkill_unregister() also acquires
  rfkill_global_mutex before cleanup. Therefore, rfkill_unregister() will
  wait for any ongoing callback to complete before proceeding, and
  device_del() is only called after rfkill_unregister() returns, preventing
  any use-after-free.

  The similar lock ordering in nfc_register_device() (device_lock ->
  rfkill_global_mutex via rfkill_register) is safe because during
  registration the device is not yet in rfkill_list, so no concurrent
  rfkill operations can occur on this device.
impacted_packages: []
severities: []
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/1ab526d97a57e44d26fadcc0e9adeb9c0c0182f5
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/2e0831e9fc46a06daa6d4d8d57a2738e343130c3
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/6b93c8ab6f6cda8818983a4ae3fcf84b023037b4
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/8fc4632fb508432895430cd02b38086bdd649083
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e02a1c33f10a0ed3aba855ab8ae2b6c4c5be8012
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ee41f4f3ccf8cd6ba3732e867abbec7e6d8d12e5
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f3a8a7c1aa278f2378b2f3a10500c6674dffdfda
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-71079
    reference_type:
    reference_id: CVE-2025-71079
