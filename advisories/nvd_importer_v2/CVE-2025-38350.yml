advisory_id: CVE-2025-38350
datasource_id: nvd_importer_v2/CVE-2025-38350
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-38350
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  net/sched: Always pass notifications when child class becomes empty

  Certain classful qdiscs may invoke their classes' dequeue handler on an
  enqueue operation. This may unexpectedly empty the child qdisc and thus
  make an in-flight class passive via qlen_notify(). Most qdiscs do not
  expect such behaviour at this point in time and may re-activate the
  class eventually anyways which will lead to a use-after-free.

  The referenced fix commit attempted to fix this behavior for the HFSC
  case by moving the backlog accounting around, though this turned out to
  be incomplete since the parent's parent may run into the issue too.
  The following reproducer demonstrates this use-after-free:

      tc qdisc add dev lo root handle 1: drr
      tc filter add dev lo parent 1: basic classid 1:1
      tc class add dev lo parent 1: classid 1:1 drr
      tc qdisc add dev lo parent 1:1 handle 2: hfsc def 1
      tc class add dev lo parent 2: classid 2:1 hfsc rt m1 8 d 1 m2 0
      tc qdisc add dev lo parent 2:1 handle 3: netem
      tc qdisc add dev lo parent 3:1 handle 4: blackhole

      echo 1 | socat -u STDIN UDP4-DATAGRAM:127.0.0.1:8888
      tc class delete dev lo classid 1:1
      echo 1 | socat -u STDIN UDP4-DATAGRAM:127.0.0.1:8888

  Since backlog accounting issues leading to a use-after-frees on stale
  class pointers is a recurring pattern at this point, this patch takes
  a different approach. Instead of trying to fix the accounting, the patch
  ensures that qdisc_tree_reduce_backlog always calls qlen_notify when
  the child qdisc is empty. This solves the problem because deletion of
  qdiscs always involves a call to qdisc_reset() and / or
  qdisc_purge_queue() which ultimately resets its qlen to 0 thus causing
  the following qdisc_tree_reduce_backlog() to report to the parent. Note
  that this may call qlen_notify on passive classes multiple times. This
  is not a problem after the recent patch series that made all the
  classful qdiscs qlen_notify() handlers idempotent.
impacted_packages: []
severities:
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-38350
weaknesses:
  - CWE-416
references:
  - url: https://git.kernel.org/stable/c/103406b38c600fec1fe375a77b27d87e314aea09
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/3b290923ad2b23596208c1e29520badef4356a43
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/7874c9c132e906a52a187d045995b115973c93fb
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a44acdd9e84a211989ff4b9b92bf3545d8456ad5
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a553afd91f55ff39b1e8a1c4989a29394c9e0472
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e269f29e9395527bc00c213c6b15da04ebb35070
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e9921b57dca05ac5f4fa1fa8e993d4f0ee52e2b7
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f680a4643c6f71e758d8fe0431a958e9a6a4f59d
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/10/msg00007.html
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/10/msg00008.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:debian:debian_linux:11.0:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:debian:debian_linux:11.0:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.15:-:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.15:-:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-38350
    reference_type:
    reference_id: CVE-2025-38350
