advisory_id: CVE-2025-38591
datasource_id: nvd_importer_v2/CVE-2025-38591
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-38591
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  bpf: Reject narrower access to pointer ctx fields

  The following BPF program, simplified from a syzkaller repro, causes a
  kernel warning:

      r0 = *(u8 *)(r1 + 169);
      exit;

  With pointer field sk being at offset 168 in __sk_buff. This access is
  detected as a narrower read in bpf_skb_is_valid_access because it
  doesn't match offsetof(struct __sk_buff, sk). It is therefore allowed
  and later proceeds to bpf_convert_ctx_access. Note that for the
  "is_narrower_load" case in the convert_ctx_accesses(), the insn->off
  is aligned, so the cnt may not be 0 because it matches the
  offsetof(struct __sk_buff, sk) in the bpf_convert_ctx_access. However,
  the target_size stays 0 and the verifier errors with a kernel warning:

      verifier bug: error during ctx access conversion(1)

  This patch fixes that to return a proper "invalid bpf_context access
  off=X size=Y" error on the load instruction.

  The same issue affects multiple other fields in context structures that
  allow narrow access. Some other non-affected fields (for sk_msg,
  sk_lookup, and sockopt) were also changed to use bpf_ctx_range_ptr for
  consistency.

  Note this syzkaller crash was reported in the "Closes" link below, which
  used to be about a different bug, fixed in
  commit fce7bd8e385a ("bpf/verifier: Handle BPF_LOAD_ACQ instructions
  in insn_def_regno()"). Because syzbot somehow confused the two bugs,
  the new crash and repro didn't get reported to the mailing list.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-38591
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/058a0da4f6d916a79b693384111bb80a90d73763
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/202900ceeef67458c964c2af6e1427c8e533ea7c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/33660d44e789edb4f303210c813fc56d56377a90
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/7847c4140e06f6e87229faae22cc38525334c156
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e09299225d5ba3916c91ef70565f7d2187e4cca0
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/feae34c992eb7191862fb1594c704fbbf650fef8
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-38591
    reference_type:
    reference_id: CVE-2025-38591
