advisory_id: CVE-2022-49309
datasource_id: nvd_importer_v2/CVE-2022-49309
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2022-49309
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  drivers: staging: rtl8723bs: Fix deadlock in rtw_surveydone_event_callback()

  There is a deadlock in rtw_surveydone_event_callback(),
  which is shown below:

     (Thread 1)                  |      (Thread 2)
                                 | _set_timer()
  rtw_surveydone_event_callback()|  mod_timer()
   spin_lock_bh() //(1)          |  (wait a time)
   ...                           | rtw_scan_timeout_handler()
   del_timer_sync()              |  spin_lock_bh() //(2)
   (wait timer to stop)          |  ...

  We hold pmlmepriv->lock in position (1) of thread 1 and use
  del_timer_sync() to wait timer to stop, but timer handler
  also need pmlmepriv->lock in position (2) of thread 2.
  As a result, rtw_surveydone_event_callback() will block forever.

  This patch extracts del_timer_sync() from the protection of
  spin_lock_bh(), which could let timer handler to obtain
  the needed lock. What`s more, we change spin_lock_bh() in
  rtw_scan_timeout_handler() to spin_lock_irq(). Otherwise,
  spin_lock_bh() will also cause deadlock() in timer handler.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-49309
weaknesses:
  - CWE-667
references:
  - url: https://git.kernel.org/stable/c/2c41f5c341853f84b7bc2f32605d4e2782e8c279
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c84e5c819600ee0628f61b33d145258ae0f3d7a7
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/cc7ad0d77b51c872d629bcd98aea463a3c4109e7
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ce129d3efd181da5fd56f4360cc8827122afa67e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f89f6c3ebf69623b8ea48200bd690e9e210335a1
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/05/msg00030.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-49309
    reference_type:
    reference_id: CVE-2022-49309
