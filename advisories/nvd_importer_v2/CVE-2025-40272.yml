advisory_id: CVE-2025-40272
datasource_id: nvd_importer_v2/CVE-2025-40272
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-40272
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  mm/secretmem: fix use-after-free race in fault handler

  When a page fault occurs in a secret memory file created with
  `memfd_secret(2)`, the kernel will allocate a new folio for it, mark the
  underlying page as not-present in the direct map, and add it to the file
  mapping.

  If two tasks cause a fault in the same page concurrently, both could end
  up allocating a folio and removing the page from the direct map, but only
  one would succeed in adding the folio to the file mapping.  The task that
  failed undoes the effects of its attempt by (a) freeing the folio again
  and (b) putting the page back into the direct map.  However, by doing
  these two operations in this order, the page becomes available to the
  allocator again before it is placed back in the direct mapping.

  If another task attempts to allocate the page between (a) and (b), and the
  kernel tries to access it via the direct map, it would result in a
  supervisor not-present page fault.

  Fix the ordering to restore the direct map before the folio is freed.
impacted_packages: []
severities: []
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/1e4643d6628edf9c0047b1f8f5bc574665025acb
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/42d486d35a4143cc37fc72ee66edc99d942dd367
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/4444767e625da46009fc94a453fd1967b80ba047
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/52f2d5cf33de9a8f5e72bbb0ed38282ae0bc4649
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/6f86d0534fddfbd08687fa0f01479d4226bc3c3d
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/bb1c19636aedae39360e6fdbcaef4f2bcff25785
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-40272
    reference_type:
    reference_id: CVE-2025-40272
