advisory_id: CVE-2022-49778
datasource_id: nvd_importer_v2/CVE-2022-49778
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2022-49778
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  arm64/mm: fix incorrect file_map_count for non-leaf pmd/pud

  The page table check trigger BUG_ON() unexpectedly when collapse hugepage:

   ------------[ cut here ]------------
   kernel BUG at mm/page_table_check.c:82!
   Internal error: Oops - BUG: 00000000f2000800 [#1] SMP
   Dumping ftrace buffer:
      (ftrace buffer empty)
   Modules linked in:
   CPU: 6 PID: 68 Comm: khugepaged Not tainted 6.1.0-rc3+ #750
   Hardware name: linux,dummy-virt (DT)
   pstate: 60000005 (nZCv daif -PAN -UAO -TCO -DIT -SSBS BTYPE=--)
   pc : page_table_check_clear.isra.0+0x258/0x3f0
   lr : page_table_check_clear.isra.0+0x240/0x3f0
  [...]
   Call trace:
    page_table_check_clear.isra.0+0x258/0x3f0
    __page_table_check_pmd_clear+0xbc/0x108
    pmdp_collapse_flush+0xb0/0x160
    collapse_huge_page+0xa08/0x1080
    hpage_collapse_scan_pmd+0xf30/0x1590
    khugepaged_scan_mm_slot.constprop.0+0x52c/0xac8
    khugepaged+0x338/0x518
    kthread+0x278/0x2f8
    ret_from_fork+0x10/0x20
  [...]

  Since pmd_user_accessible_page() doesn't check if a pmd is leaf, it
  decrease file_map_count for a non-leaf pmd comes from collapse_huge_page().
  and so trigger BUG_ON() unexpectedly.

  Fix this problem by using pmd_leaf() insteal of pmd_present() in
  pmd_user_accessible_page(). Moreover, use pud_leaf() for
  pud_user_accessible_page() too.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-49778
weaknesses:
  - CWE-617
references:
  - url: https://git.kernel.org/stable/c/2d458046df634088611d44fd77f45465e833ef78
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5b47348fc0b18a78c96f8474cc90b7525ad1bbfe
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.1:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.1:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.1:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.1:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.1:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.1:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.1:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.1:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.1:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.1:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-49778
    reference_type:
    reference_id: CVE-2022-49778
