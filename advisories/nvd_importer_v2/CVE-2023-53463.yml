advisory_id: CVE-2023-53463
datasource_id: nvd_importer_v2/CVE-2023-53463
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2023-53463
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  ibmvnic: Do not reset dql stats on NON_FATAL err

  All ibmvnic resets, make a call to netdev_tx_reset_queue() when
  re-opening the device. netdev_tx_reset_queue() resets the num_queued
  and num_completed byte counters. These stats are used in Byte Queue
  Limit (BQL) algorithms. The difference between these two stats tracks
  the number of bytes currently sitting on the physical NIC. ibmvnic
  increases the number of queued bytes though calls to
  netdev_tx_sent_queue() in the drivers xmit function. When, VIOS reports
  that it is done transmitting bytes, the ibmvnic device increases the
  number of completed bytes through calls to netdev_tx_completed_queue().
  It is important to note that the driver batches its transmit calls and
  num_queued is increased every time that an skb is added to the next
  batch, not necessarily when the batch is sent to VIOS for transmission.

  Unlike other reset types, a NON FATAL reset will not flush the sub crq
  tx buffers. Therefore, it is possible for the batched skb array to be
  partially full. So if there is call to netdev_tx_reset_queue() when
  re-opening the device, the value of num_queued (0) would not account
  for the skb's that are currently batched. Eventually, when the batch
  is sent to VIOS, the call to netdev_tx_completed_queue() would increase
  num_completed to a value greater than the num_queued. This causes a
  BUG_ON crash:

  ibmvnic 30000002: Firmware reports error, cause: adapter problem.
  Starting recovery...
  ibmvnic 30000002: tx error 600
  ibmvnic 30000002: tx error 600
  ibmvnic 30000002: tx error 600
  ibmvnic 30000002: tx error 600
  ------------[ cut here ]------------
  kernel BUG at lib/dynamic_queue_limits.c:27!
  Oops: Exception in kernel mode, sig: 5
  [....]
  NIP dql_completed+0x28/0x1c0
  LR ibmvnic_complete_tx.isra.0+0x23c/0x420 [ibmvnic]
  Call Trace:
  ibmvnic_complete_tx.isra.0+0x3f8/0x420 [ibmvnic] (unreliable)
  ibmvnic_interrupt_tx+0x40/0x70 [ibmvnic]
  __handle_irq_event_percpu+0x98/0x270
  ---[ end trace ]---

  Therefore, do not reset the dql stats when performing a NON_FATAL reset.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2023-53463
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/48538ccb825b05544ec308a509e2cc9c013402db
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/91a0632e73070928aafeb36b3cc676843c716931
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b8aedf29db1280c83191fc9579ae605791faf97f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f67ef8f9f6776e2b2073cad7c5cf29de850f83d7
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-53463
    reference_type:
    reference_id: CVE-2023-53463
