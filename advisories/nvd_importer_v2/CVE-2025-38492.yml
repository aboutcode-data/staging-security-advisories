advisory_id: CVE-2025-38492
datasource_id: nvd_importer_v2/CVE-2025-38492
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-38492
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  netfs: Fix race between cache write completion and ALL_QUEUED being set

  When netfslib is issuing subrequests, the subrequests start processing
  immediately and may complete before we reach the end of the issuing
  function.  At the end of the issuing function we set NETFS_RREQ_ALL_QUEUED
  to indicate to the collector that we aren't going to issue any more subreqs
  and that it can do the final notifications and cleanup.

  Now, this isn't a problem if the request is synchronous
  (NETFS_RREQ_OFFLOAD_COLLECTION is unset) as the result collection will be
  done in-thread and we're guaranteed an opportunity to run the collector.

  However, if the request is asynchronous, collection is primarily triggered
  by the termination of subrequests queuing it on a workqueue.  Now, a race
  can occur here if the app thread sets ALL_QUEUED after the last subrequest
  terminates.

  This can happen most easily with the copy2cache code (as used by Ceph)
  where, in the collection routine of a read request, an asynchronous write
  request is spawned to copy data to the cache.  Folios are added to the
  write request as they're unlocked, but there may be a delay before
  ALL_QUEUED is set as the write subrequests may complete before we get
  there.

  If all the write subreqs have finished by the ALL_QUEUED point, no further
  events happen and the collection never happens, leaving the request
  hanging.

  Fix this by queuing the collector after setting ALL_QUEUED.  This is a bit
  heavy-handed and it may be sufficient to do it only if there are no extant
  subreqs.

  Also add a tracepoint to cross-reference both requests in a copy-to-request
  operation and add a trace to the netfs_rreq tracepoint to indicate the
  setting of ALL_QUEUED.
impacted_packages: []
severities:
  - score: '4.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-38492
weaknesses:
  - CWE-362
references:
  - url: https://git.kernel.org/stable/c/110188a13c4853bd4c342e600ced4dfd26c3feb5
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/89635eae076cd8eaa5cb752f66538c9dc6c9fdc3
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-38492
    reference_type:
    reference_id: CVE-2025-38492
