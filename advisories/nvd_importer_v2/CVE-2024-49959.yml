advisory_id: CVE-2024-49959
datasource_id: nvd_importer_v2/CVE-2024-49959
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-49959
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  jbd2: stop waiting for space when jbd2_cleanup_journal_tail() returns error

  In __jbd2_log_wait_for_space(), we might call jbd2_cleanup_journal_tail()
  to recover some journal space. But if an error occurs while executing
  jbd2_cleanup_journal_tail() (e.g., an EIO), we don't stop waiting for free
  space right away, we try other branches, and if j_committing_transaction
  is NULL (i.e., the tid is 0), we will get the following complain:

  ============================================
  JBD2: I/O error when updating journal superblock for sdd-8.
  __jbd2_log_wait_for_space: needed 256 blocks and only had 217 space available
  __jbd2_log_wait_for_space: no way to get more journal space in sdd-8
  ------------[ cut here ]------------
  WARNING: CPU: 2 PID: 139804 at fs/jbd2/checkpoint.c:109 __jbd2_log_wait_for_space+0x251/0x2e0
  Modules linked in:
  CPU: 2 PID: 139804 Comm: kworker/u8:3 Not tainted 6.6.0+ #1
  RIP: 0010:__jbd2_log_wait_for_space+0x251/0x2e0
  Call Trace:
   <TASK>
   add_transaction_credits+0x5d1/0x5e0
   start_this_handle+0x1ef/0x6a0
   jbd2__journal_start+0x18b/0x340
   ext4_dirty_inode+0x5d/0xb0
   __mark_inode_dirty+0xe4/0x5d0
   generic_update_time+0x60/0x70
  [...]
  ============================================

  So only if jbd2_cleanup_journal_tail() returns 1, i.e., there is nothing to
  clean up at the moment, continue to try to reclaim free space in other ways.

  Note that this fix relies on commit 6f6a6fda2945 ("jbd2: fix ocfs2 corrupt
  when updating journal superblock fails") to make jbd2_cleanup_journal_tail
  return the correct error code.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-49959
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/1c62dc0d82c62f0dc8fcdc4843208e522acccaf5
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/3ced0fe6c0eff032733ea8b38778b34707270138
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/481e8f18a290e39e04ddb7feb2bb2a2cc3b213ed
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/70bae48377a2c4296fd3caf4caf8f11079111019
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/801a35dfef6996f3d5eaa96a59caf00440d9165e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c6bf043b210eac67d35a114e345c4e5585672913
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d5dc65370a746750dbb2f03eabcf86b18db65f32
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ec7f8337c98ad281020ad1f11ba492462d80737a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f5cacdc6f2bb2a9bf214469dd7112b43dd2dd68a
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/01/msg00001.html
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/03/msg00002.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-49959
    reference_type:
    reference_id: CVE-2024-49959
