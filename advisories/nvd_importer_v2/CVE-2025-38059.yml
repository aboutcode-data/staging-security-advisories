advisory_id: CVE-2025-38059
datasource_id: nvd_importer_v2/CVE-2025-38059
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-38059
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  btrfs: avoid NULL pointer dereference if no valid csum tree

  [BUG]
  When trying read-only scrub on a btrfs with rescue=idatacsums mount
  option, it will crash with the following call trace:

    BUG: kernel NULL pointer dereference, address: 0000000000000208
    #PF: supervisor read access in kernel mode
    #PF: error_code(0x0000) - not-present page
    CPU: 1 UID: 0 PID: 835 Comm: btrfs Tainted: G           O        6.15.0-rc3-custom+ #236 PREEMPT(full)
    Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS unknown 02/02/2022
    RIP: 0010:btrfs_lookup_csums_bitmap+0x49/0x480 [btrfs]
    Call Trace:
     <TASK>
     scrub_find_fill_first_stripe+0x35b/0x3d0 [btrfs]
     scrub_simple_mirror+0x175/0x290 [btrfs]
     scrub_stripe+0x5f7/0x6f0 [btrfs]
     scrub_chunk+0x9a/0x150 [btrfs]
     scrub_enumerate_chunks+0x333/0x660 [btrfs]
     btrfs_scrub_dev+0x23e/0x600 [btrfs]
     btrfs_ioctl+0x1dcf/0x2f80 [btrfs]
     __x64_sys_ioctl+0x97/0xc0
     do_syscall_64+0x4f/0x120
     entry_SYSCALL_64_after_hwframe+0x76/0x7e

  [CAUSE]
  Mount option "rescue=idatacsums" will completely skip loading the csum
  tree, so that any data read will not find any data csum thus we will
  ignore data checksum verification.

  Normally call sites utilizing csum tree will check the fs state flag
  NO_DATA_CSUMS bit, but unfortunately scrub does not check that bit at all.

  This results in scrub to call btrfs_search_slot() on a NULL pointer
  and triggered above crash.

  [FIX]
  Check both extent and csum tree root before doing any tree search.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-38059
weaknesses:
  - CWE-476
references:
  - url: https://git.kernel.org/stable/c/50d0de59f66cbe6d597481e099bf1c70fd07e0a9
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/6e9770de024964b1017f99ee94f71967bd6edaeb
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d35bed14b0bc95c6845863a3744ecd10b888c830
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f95d186255b319c48a365d47b69bd997fecb674e
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.15:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.15:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.15:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.15:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.15:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.15:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.15:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.15:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.15:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.15:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-38059
    reference_type:
    reference_id: CVE-2025-38059
