advisory_id: CVE-2024-56644
datasource_id: nvd_importer_v2/CVE-2024-56644
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-56644
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  net/ipv6: release expired exception dst cached in socket

  Dst objects get leaked in ip6_negative_advice() when this function is
  executed for an expired IPv6 route located in the exception table. There
  are several conditions that must be fulfilled for the leak to occur:
  * an ICMPv6 packet indicating a change of the MTU for the path is received,
    resulting in an exception dst being created
  * a TCP connection that uses the exception dst for routing packets must
    start timing out so that TCP begins retransmissions
  * after the exception dst expires, the FIB6 garbage collector must not run
    before TCP executes ip6_negative_advice() for the expired exception dst

  When TCP executes ip6_negative_advice() for an exception dst that has
  expired and if no other socket holds a reference to the exception dst, the
  refcount of the exception dst is 2, which corresponds to the increment
  made by dst_init() and the increment made by the TCP socket for which the
  connection is timing out. The refcount made by the socket is never
  released. The refcount of the dst is decremented in sk_dst_reset() but
  that decrement is counteracted by a dst_hold() intentionally placed just
  before the sk_dst_reset() in ip6_negative_advice(). After
  ip6_negative_advice() has finished, there is no other object tied to the
  dst. The socket lost its reference stored in sk_dst_cache and the dst is
  no longer in the exception table. The exception dst becomes a leaked
  object.

  As a result of this dst leak, an unbalanced refcount is reported for the
  loopback device of a net namespace being destroyed under kernels that do
  not contain e5f80fcf869a ("ipv6: give an IPv6 dev to blackhole_netdev"):
  unregister_netdevice: waiting for lo to become free. Usage count = 2

  Fix the dst leak by removing the dst_hold() in ip6_negative_advice(). The
  patch that introduced the dst_hold() in ip6_negative_advice() was
  92f1655aa2b22 ("net: fix __dst_negative_advice() race"). But 92f1655aa2b22
  merely refactored the code with regards to the dst refcount so the issue
  was present even before 92f1655aa2b22. The bug was introduced in
  54c1a859efd9f ("ipv6: Don't drop cache route entry unless timer actually
  expired.") where the expired cached route is deleted and the sk_dst_cache
  member of the socket is set to NULL by calling dst_negative_advice() but
  the refcount belonging to the socket is left unbalanced.

  The IPv4 version - ipv4_negative_advice() - is not affected by this bug.
  When the TCP connection times out ipv4_negative_advice() merely resets the
  sk_dst_cache of the socket while decrementing the refcount of the
  exception dst.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-56644
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/0b8903e6c881f72c6849d4952de742c656eb5ab9
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/3301ab7d5aeb0fe270f73a3d4810c9d1b6a9f045
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/535add1e9f274502209cb997801208bbe1ae6c6f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/8b591bd522b71c42a82898290e35d32b482047e4
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a95808252e8acc0123bacd2dff8b9af10bc145b7
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b90d061345bb8cd51fece561a800bae1c95448a6
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f43d12fd0fa8ee5b9caf8a3927e10d06431764d2
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/03/msg00001.html
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/03/msg00002.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:debian:debian_linux:11.0:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:debian:debian_linux:11.0:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:2.6.34:-:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:2.6.34:-:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:2.6.34:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:2.6.34:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:2.6.34:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:2.6.34:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:2.6.34:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:2.6.34:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:2.6.34:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:2.6.34:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:2.6.34:rc7:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:2.6.34:rc7:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.13:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.13:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-56644
    reference_type:
    reference_id: CVE-2024-56644
