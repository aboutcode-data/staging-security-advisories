advisory_id: CVE-2025-38217
datasource_id: nvd_importer_v2/CVE-2025-38217
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-38217
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  hwmon: (ftsteutates) Fix TOCTOU race in fts_read()

  In the fts_read() function, when handling hwmon_pwm_auto_channels_temp,
  the code accesses the shared variable data->fan_source[channel] twice
  without holding any locks. It is first checked against
  FTS_FAN_SOURCE_INVALID, and if the check passes, it is read again
  when used as an argument to the BIT() macro.

  This creates a Time-of-Check to Time-of-Use (TOCTOU) race condition.
  Another thread executing fts_update_device() can modify the value of
  data->fan_source[channel] between the check and its use. If the value
  is changed to FTS_FAN_SOURCE_INVALID (0xff) during this window, the
  BIT() macro will be called with a large shift value (BIT(255)).
  A bit shift by a value greater than or equal to the type width is
  undefined behavior and can lead to a crash or incorrect values being
  returned to userspace.

  Fix this by reading data->fan_source[channel] into a local variable
  once, eliminating the race condition. Additionally, add a bounds check
  to ensure the value is less than BITS_PER_LONG before passing it to
  the BIT() macro, making the code more robust against undefined behavior.

  This possible bug was found by an experimental static analysis tool
  developed by our team.
impacted_packages: []
severities:
  - score: '4.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-38217
weaknesses:
  - CWE-367
references:
  - url: https://git.kernel.org/stable/c/14c9ede9ca4cd078ad76a6ab9617b81074eb58bf
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/4d646f627d3b7ed1cacca66e598af8bcd632d465
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/83e2ba8971ccd8fc08319fc7593288f070d80a76
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d95d87841d2a575bed3691884e8fedef57d7710d
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-38217
    reference_type:
    reference_id: CVE-2025-38217
