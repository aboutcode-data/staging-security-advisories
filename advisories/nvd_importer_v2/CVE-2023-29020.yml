advisory_id: CVE-2023-29020
datasource_id: nvd_importer_v2/CVE-2023-29020
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2023-29020
aliases: []
summary: '@fastify/passport is a port of passport authentication library for the Fastify ecosystem.
  The CSRF (Cross-Site Request Forger) protection enforced by the `@fastify/csrf-protection`
  library, when combined with `@fastify/passport` in affected versions, can be bypassed by network
  and same-site attackers. `fastify/csrf-protection` implements the synchronizer token pattern
  (using plugins `@fastify/session` and `@fastify/secure-session`) by storing a random value
  used for CSRF token generation in the `_csrf` attribute of a user''s session. The `@fastify/passport`
  library does not clear the session object upon authentication, preserving the `_csrf` attribute
  between pre-login and authenticated sessions. Consequently, CSRF tokens generated before authentication
  are still valid. Network and same-site attackers can thus obtain a CSRF token for their pre-session,
  fixate that pre-session in the victim''s browser via cookie tossing, and then perform a CSRF
  attack after the victim authenticates. As a solution, newer versions of `@fastify/passport`
  include the configuration options: `clearSessionOnLogin (default: true)` and `clearSessionIgnoreFields
  (default: [''passport'', ''session''])` to clear all the session attributes by default, preserving
  those explicitly defined in `clearSessionIgnoreFields`.'
impacted_packages: []
severities:
  - score: '6.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:H/A:N
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2023-29020
weaknesses:
  - CWE-352
  - CWE-384
references:
  - url: https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#synchronizer-token-pattern
    reference_type:
    reference_id:
  - url: https://github.com/fastify/fastify-passport/commit/07c90feab9cba0dd4779e47cfb0717a7e2f01d3d
    reference_type:
    reference_id:
  - url: https://github.com/fastify/fastify-passport/security/advisories/GHSA-2ccf-ffrj-m4qw
    reference_type:
    reference_id:
  - url: https://owasp.org/www-community/attacks/csrf
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:a:fastify:passport:*:*:*:*:*:node.js:*:*
    reference_type:
    reference_id: cpe:2.3:a:fastify:passport:*:*:*:*:*:node.js:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-29020
    reference_type:
    reference_id: CVE-2023-29020
