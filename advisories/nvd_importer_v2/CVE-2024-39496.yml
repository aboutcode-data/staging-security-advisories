advisory_id: CVE-2024-39496
datasource_id: nvd_importer_v2/CVE-2024-39496
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-39496
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  btrfs: zoned: fix use-after-free due to race with dev replace

  While loading a zone's info during creation of a block group, we can race
  with a device replace operation and then trigger a use-after-free on the
  device that was just replaced (source device of the replace operation).

  This happens because at btrfs_load_zone_info() we extract a device from
  the chunk map into a local variable and then use the device while not
  under the protection of the device replace rwsem. So if there's a device
  replace operation happening when we extract the device and that device
  is the source of the replace operation, we will trigger a use-after-free
  if before we finish using the device the replace operation finishes and
  frees the device.

  Fix this by enlarging the critical section under the protection of the
  device replace rwsem so that all uses of the device are done inside the
  critical section.
impacted_packages: []
severities:
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-39496
weaknesses:
  - CWE-416
references:
  - url: https://git.kernel.org/stable/c/0090d6e1b210551e63cf43958dc7a1ec942cdde9
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/092571ef9a812566c8f2c9038d9c2a64c49788d6
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/17765964703b88d8befd899f8501150bb7e07e43
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a0cc006f4214b87e70983c692e05bb36c59b5752
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/01/msg00001.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:debian:debian_linux:11.0:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:debian:debian_linux:11.0:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-39496
    reference_type:
    reference_id: CVE-2024-39496
