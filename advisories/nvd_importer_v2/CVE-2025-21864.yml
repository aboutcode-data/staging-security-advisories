advisory_id: CVE-2025-21864
datasource_id: nvd_importer_v2/CVE-2025-21864
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-21864
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  tcp: drop secpath at the same time as we currently drop dst

  Xiumei reported hitting the WARN in xfrm6_tunnel_net_exit while
  running tests that boil down to:
   - create a pair of netns
   - run a basic TCP test over ipcomp6
   - delete the pair of netns

  The xfrm_state found on spi_byaddr was not deleted at the time we
  delete the netns, because we still have a reference on it. This
  lingering reference comes from a secpath (which holds a ref on the
  xfrm_state), which is still attached to an skb. This skb is not
  leaked, it ends up on sk_receive_queue and then gets defer-free'd by
  skb_attempt_defer_free.

  The problem happens when we defer freeing an skb (push it on one CPU's
  defer_list), and don't flush that list before the netns is deleted. In
  that case, we still have a reference on the xfrm_state that we don't
  expect at this point.

  We already drop the skb's dst in the TCP receive path when it's no
  longer needed, so let's also drop the secpath. At this point,
  tcp_filter has already called into the LSM hooks that may require the
  secpath, so it should not be needed anymore. However, in some of those
  places, the MPTCP extension has just been attached to the skb, so we
  cannot simply drop all extensions.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-21864
weaknesses:
  - CWE-476
references:
  - url: https://git.kernel.org/stable/c/69cafd9413084cd5012cf5d7c7ec6f3d493726d9
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/87858bbf21da239ace300d61dd209907995c0491
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9b6412e6979f6f9e0632075f8f008937b5cd4efd
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/cd34a07f744451e2ecf9005bb7d24d0b2fb83656
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f1d5e6a5e468308af7759cf5276779d3155c5e98
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/05/msg00045.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.14:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.14:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.14:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.14:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.14:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.14:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-21864
    reference_type:
    reference_id: CVE-2025-21864
