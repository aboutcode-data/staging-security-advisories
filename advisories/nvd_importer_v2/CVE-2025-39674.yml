advisory_id: CVE-2025-39674
datasource_id: nvd_importer_v2/CVE-2025-39674
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-39674
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  scsi: ufs: ufs-qcom: Fix ESI null pointer dereference

  ESI/MSI is a performance optimization feature that provides dedicated
  interrupts per MCQ hardware queue. This is optional feature and UFS MCQ
  should work with and without ESI feature.

  Commit e46a28cea29a ("scsi: ufs: qcom: Remove the MSI descriptor abuse")
  brings a regression in ESI (Enhanced System Interrupt) configuration that
  causes a null pointer dereference when Platform MSI allocation fails.

  The issue occurs in when platform_device_msi_init_and_alloc_irqs() in
  ufs_qcom_config_esi() fails (returns -EINVAL) but the current code uses
  __free() macro for automatic cleanup free MSI resources that were never
  successfully allocated.

  Unable to handle kernel NULL pointer dereference at virtual
  address 0000000000000008

    Call trace:
    mutex_lock+0xc/0x54 (P)
    platform_device_msi_free_irqs_all+0x1c/0x40
    ufs_qcom_config_esi+0x1d0/0x220 [ufs_qcom]
    ufshcd_config_mcq+0x28/0x104
    ufshcd_init+0xa3c/0xf40
    ufshcd_pltfrm_init+0x504/0x7d4
    ufs_qcom_probe+0x20/0x58 [ufs_qcom]

  Fix by restructuring the ESI configuration to try MSI allocation first,
  before any other resource allocation and instead use explicit cleanup
  instead of __free() macro to avoid cleanup of unallocated resources.

  Tested on SM8750 platform with MCQ enabled, both with and without
  Platform ESI support.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-39674
weaknesses:
  - CWE-476
references:
  - url: https://git.kernel.org/stable/c/6300d5c5438724c0876828da2f6e2c1a661871fc
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/aaf17a35a59572c8b29372883619c3dbb0ebb50a
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.17:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.17:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.17:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.17:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-39674
    reference_type:
    reference_id: CVE-2025-39674
