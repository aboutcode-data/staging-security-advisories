advisory_id: CVE-2022-49205
datasource_id: nvd_importer_v2/CVE-2022-49205
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2022-49205
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  bpf, sockmap: Fix double uncharge the mem of sk_msg

  If tcp_bpf_sendmsg is running during a tear down operation, psock may be
  freed.

  tcp_bpf_sendmsg()
   tcp_bpf_send_verdict()
    sk_msg_return()
    tcp_bpf_sendmsg_redir()
     unlikely(!psock))
       sk_msg_free()

  The mem of msg has been uncharged in tcp_bpf_send_verdict() by
  sk_msg_return(), and would be uncharged by sk_msg_free() again. When psock
  is null, we can simply returning an error code, this would then trigger
  the sk_msg_free_nocharge in the error path of __SK_REDIRECT and would have
  the side effect of throwing an error up to user space. This would be a
  slight change in behavior from user side but would look the same as an
  error if the redirect on the socket threw an error.

  This issue can cause the following info:
  WARNING: CPU: 0 PID: 2136 at net/ipv4/af_inet.c:155 inet_sock_destruct+0x13c/0x260
  Call Trace:
   <TASK>
   __sk_destruct+0x24/0x1f0
   sk_psock_destroy+0x19b/0x1c0
   process_one_work+0x1b3/0x3c0
   worker_thread+0x30/0x350
   ? process_one_work+0x3c0/0x3c0
   kthread+0xe6/0x110
   ? kthread_complete_and_exit+0x20/0x20
   ret_from_fork+0x22/0x30
   </TASK>
impacted_packages: []
severities:
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-49205
weaknesses:
  - CWE-415
references:
  - url: https://git.kernel.org/stable/c/223f3c51ab163852dd4819d357dcf33039929434
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/2486ab434b2c2a14e9237296db00b1e1b7ae3273
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/94c6ac22abcdede72bfaa0f4c22fb370891f4002
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ac3ecb7760c750c8e4fc09c719241d8e6e88028c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/cb6f141ae705af0101e819065a79e6d029f6e393
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/cd84ea3920aef936c559b63099ef0013ce6b2325
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-49205
    reference_type:
    reference_id: CVE-2022-49205
