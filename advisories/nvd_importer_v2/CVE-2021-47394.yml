advisory_id: CVE-2021-47394
datasource_id: nvd_importer_v2/CVE-2021-47394
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2021-47394
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  netfilter: nf_tables: unlink table before deleting it

  syzbot reports following UAF:
  BUG: KASAN: use-after-free in memcmp+0x18f/0x1c0 lib/string.c:955
   nla_strcmp+0xf2/0x130 lib/nlattr.c:836
   nft_table_lookup.part.0+0x1a2/0x460 net/netfilter/nf_tables_api.c:570
   nft_table_lookup net/netfilter/nf_tables_api.c:4064 [inline]
   nf_tables_getset+0x1b3/0x860 net/netfilter/nf_tables_api.c:4064
   nfnetlink_rcv_msg+0x659/0x13f0 net/netfilter/nfnetlink.c:285
   netlink_rcv_skb+0x153/0x420 net/netlink/af_netlink.c:2504

  Problem is that all get operations are lockless, so the commit_mutex
  held by nft_rcv_nl_event() isn't enough to stop a parallel GET request
  from doing read-accesses to the table object even after synchronize_rcu().

  To avoid this, unlink the table first and store the table objects in
  on-stack scratch space.
impacted_packages: []
severities:
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-47394
weaknesses:
  - CWE-416
references:
  - url: https://git.kernel.org/stable/c/a499b03bf36b0c2e3b958a381d828678ab0ffc5e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f65c73d3aabb87d4353e0bc4a718b5ae8c43fd04
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.15:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.15:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.15:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.15:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.15:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.15:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-47394
    reference_type:
    reference_id: CVE-2021-47394
