advisory_id: CVE-2024-35791
datasource_id: nvd_importer_v2/CVE-2024-35791
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-35791
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  KVM: SVM: Flush pages under kvm->lock to fix UAF in svm_register_enc_region()

  Do the cache flush of converted pages in svm_register_enc_region() before
  dropping kvm->lock to fix use-after-free issues where region and/or its
  array of pages could be freed by a different task, e.g. if userspace has
  __unregister_enc_region_locked() already queued up for the region.

  Note, the "obvious" alternative of using local variables doesn't fully
  resolve the bug, as region->pages is also dynamically allocated.  I.e. the
  region structure itself would be fine, but region->pages could be freed.

  Flushing multiple pages under kvm->lock is unfortunate, but the entire
  flow is a rare slow path, and the manual flush is only needed on CPUs that
  lack coherency for encrypted memory.
impacted_packages: []
severities:
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-35791
weaknesses:
  - CWE-416
references:
  - url: https://git.kernel.org/stable/c/12f8e32a5a389a5d58afc67728c76e61beee1ad4
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/2d13b79640b147bd77c34a5998533b2021a4122d
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/4868c0ecdb6cfde7c70cf478c46e06bb9c7e5865
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5ef1d8c1ddbf696e47b226e11888eaf8d9e8e807
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e126b508ed2e616d679d85fca2fbe77bb48bbdd7
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f6d53d8a2617dd58c89171a6b9610c470ebda38a
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2024/06/msg00017.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:debian:debian_linux:10.0:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:debian:debian_linux:10.0:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.11:-:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.11:-:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.11:rc7:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.11:rc7:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.8:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.8:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.8:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.8:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.8:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.8:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.8:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.8:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.8:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.8:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.8:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.8:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.8:rc7:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.8:rc7:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-35791
    reference_type:
    reference_id: CVE-2024-35791
