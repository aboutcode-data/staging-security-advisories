advisory_id: CVE-2025-38351
datasource_id: nvd_importer_v2/CVE-2025-38351
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-38351
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  KVM: x86/hyper-v: Skip non-canonical addresses during PV TLB flush

  In KVM guests with Hyper-V hypercalls enabled, the hypercalls
  HVCALL_FLUSH_VIRTUAL_ADDRESS_LIST and HVCALL_FLUSH_VIRTUAL_ADDRESS_LIST_EX
  allow a guest to request invalidation of portions of a virtual TLB.
  For this, the hypercall parameter includes a list of GVAs that are supposed
  to be invalidated.

  However, when non-canonical GVAs are passed, there is currently no
  filtering in place and they are eventually passed to checked invocations of
  INVVPID on Intel / INVLPGA on AMD.  While AMD's INVLPGA silently ignores
  non-canonical addresses (effectively a no-op), Intel's INVVPID explicitly
  signals VM-Fail and ultimately triggers the WARN_ONCE in invvpid_error():

    invvpid failed: ext=0x0 vpid=1 gva=0xaaaaaaaaaaaaa000
    WARNING: CPU: 6 PID: 326 at arch/x86/kvm/vmx/vmx.c:482
    invvpid_error+0x91/0xa0 [kvm_intel]
    Modules linked in: kvm_intel kvm 9pnet_virtio irqbypass fuse
    CPU: 6 UID: 0 PID: 326 Comm: kvm-vm Not tainted 6.15.0 #14 PREEMPT(voluntary)
    RIP: 0010:invvpid_error+0x91/0xa0 [kvm_intel]
    Call Trace:
      vmx_flush_tlb_gva+0x320/0x490 [kvm_intel]
      kvm_hv_vcpu_flush_tlb+0x24f/0x4f0 [kvm]
      kvm_arch_vcpu_ioctl_run+0x3013/0x5810 [kvm]

  Hyper-V documents that invalid GVAs (those that are beyond a partition's
  GVA space) are to be ignored.  While not completely clear whether this
  ruling also applies to non-canonical GVAs, it is likely fine to make that
  assumption, and manual testing on Azure confirms "real" Hyper-V interprets
  the specification in the same way.

  Skip non-canonical GVAs when processing the list of address to avoid
  tripping the INVVPID failure.  Alternatively, KVM could filter out "bad"
  GVAs before inserting into the FIFO, but practically speaking the only
  downside of pushing validation to the final processing is that doing so
  is suboptimal for the guest, and no well-behaved guest will request TLB
  flushes for non-canonical addresses.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-38351
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/2d4dea3f76510c0afe3f18c910f647b816f7d566
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d5784ea45663330eaa868c518ea40e7a9f06aa2d
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f1b3ad11ec11c88ba9f79a73d27d4cda3f80fb24
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/fa787ac07b3ceb56dd88a62d1866038498e96230
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-38351
    reference_type:
    reference_id: CVE-2025-38351
