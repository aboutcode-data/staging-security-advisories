advisory_id: CVE-2021-47619
datasource_id: nvd_importer_v2/CVE-2021-47619
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2021-47619
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  i40e: Fix queues reservation for XDP

  When XDP was configured on a system with large number of CPUs
  and X722 NIC there was a call trace with NULL pointer dereference.

  i40e 0000:87:00.0: failed to get tracking for 256 queues for VSI 0 err -12
  i40e 0000:87:00.0: setup of MAIN VSI failed

  BUG: kernel NULL pointer dereference, address: 0000000000000000
  RIP: 0010:i40e_xdp+0xea/0x1b0 [i40e]
  Call Trace:
  ? i40e_reconfig_rss_queues+0x130/0x130 [i40e]
  dev_xdp_install+0x61/0xe0
  dev_xdp_attach+0x18a/0x4c0
  dev_change_xdp_fd+0x1e6/0x220
  do_setlink+0x616/0x1030
  ? ahci_port_stop+0x80/0x80
  ? ata_qc_issue+0x107/0x1e0
  ? lock_timer_base+0x61/0x80
  ? __mod_timer+0x202/0x380
  rtnl_setlink+0xe5/0x170
  ? bpf_lsm_binder_transaction+0x10/0x10
  ? security_capable+0x36/0x50
  rtnetlink_rcv_msg+0x121/0x350
  ? rtnl_calcit.isra.0+0x100/0x100
  netlink_rcv_skb+0x50/0xf0
  netlink_unicast+0x1d3/0x2a0
  netlink_sendmsg+0x22a/0x440
  sock_sendmsg+0x5e/0x60
  __sys_sendto+0xf0/0x160
  ? __sys_getsockname+0x7e/0xc0
  ? _copy_from_user+0x3c/0x80
  ? __sys_setsockopt+0xc8/0x1a0
  __x64_sys_sendto+0x20/0x30
  do_syscall_64+0x33/0x40
  entry_SYSCALL_64_after_hwframe+0x44/0xae
  RIP: 0033:0x7f83fa7a39e0

  This was caused by PF queue pile fragmentation due to
  flow director VSI queue being placed right after main VSI.
  Because of this main VSI was not able to resize its
  queue allocation for XDP resulting in no queues allocated
  for main VSI when XDP was turned on.

  Fix this by always allocating last queue in PF queue pile
  for a flow director VSI.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-47619
weaknesses:
  - CWE-476
references:
  - url: https://git.kernel.org/stable/c/00eddb0e4ea115154581d1049507a996acfc2d3e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/4b3aa858268b7b9aeef02e5f9c4cd8f8fac101c8
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/768eb705e6381f0c70ca29d4e66f19790d5d19a1
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/92947844b8beee988c0ce17082b705c2f75f0742
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/be6998f232b8e4ca8225029e305b8329d89bfd59
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d46fa4ea9756ef6cbcf9752d0832cc66e2d7121b
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.17:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.17:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-47619
    reference_type:
    reference_id: CVE-2021-47619
