advisory_id: CVE-2021-47229
datasource_id: nvd_importer_v2/CVE-2021-47229
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2021-47229
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  PCI: aardvark: Fix kernel panic during PIO transfer

  Trying to start a new PIO transfer by writing value 0 in PIO_START register
  when previous transfer has not yet completed (which is indicated by value 1
  in PIO_START) causes an External Abort on CPU, which results in kernel
  panic:

      SError Interrupt on CPU0, code 0xbf000002 -- SError
      Kernel panic - not syncing: Asynchronous SError Interrupt

  To prevent kernel panic, it is required to reject a new PIO transfer when
  previous one has not finished yet.

  If previous PIO transfer is not finished yet, the kernel may issue a new
  PIO request only if the previous PIO transfer timed out.

  In the past the root cause of this issue was incorrectly identified (as it
  often happens during link retraining or after link down event) and special
  hack was implemented in Trusted Firmware to catch all SError events in EL3,
  to ignore errors with code 0xbf000002 and not forwarding any other errors
  to kernel and instead throw panic from EL3 Trusted Firmware handler.

  Links to discussion and patches about this issue:
  https://git.trustedfirmware.org/TF-A/trusted-firmware-a.git/commit/?id=3c7dcdac5c50
  https://lore.kernel.org/linux-pci/20190316161243.29517-1-repk@triplefau.lt/
  https://lore.kernel.org/linux-pci/971be151d24312cc533989a64bd454b4@www.loen.fr/
  https://review.trustedfirmware.org/c/TF-A/trusted-firmware-a/+/1541

  But the real cause was the fact that during link retraining or after link
  down event the PIO transfer may take longer time, up to the 1.44s until it
  times out. This increased probability that a new PIO transfer would be
  issued by kernel while previous one has not finished yet.

  After applying this change into the kernel, it is possible to revert the
  mentioned TF-A hack and SError events do not have to be caught in TF-A EL3.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-47229
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/1a1dbc4473974867fe8c5f195c17b341c8e82867
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/3d213a4ddf49a860be6e795482c17f87e0c82b2a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/400e6b1860c8be61388d0b77814c53260f96e17a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/4c90f90a91d75c3c73dd633827c90e8746d9f54d
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b00a9aaa4be20ad6e3311fb78a485eae0899e89a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f18139966d072dab8e4398c95ce955a9742e04f7
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.13:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.13:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.13:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.13:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.13:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.13:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.13:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.13:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.13:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.13:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.13:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.13:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-47229
    reference_type:
    reference_id: CVE-2021-47229
