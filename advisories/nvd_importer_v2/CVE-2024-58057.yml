advisory_id: CVE-2024-58057
datasource_id: nvd_importer_v2/CVE-2024-58057
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-58057
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  idpf: convert workqueues to unbound

  When a workqueue is created with `WQ_UNBOUND`, its work items are
  served by special worker-pools, whose host workers are not bound to
  any specific CPU. In the default configuration (i.e. when
  `queue_delayed_work` and friends do not specify which CPU to run the
  work item on), `WQ_UNBOUND` allows the work item to be executed on any
  CPU in the same node of the CPU it was enqueued on. While this
  solution potentially sacrifices locality, it avoids contention with
  other processes that might dominate the CPU time of the processor the
  work item was scheduled on.

  This is not just a theoretical problem: in a particular scenario
  misconfigured process was hogging most of the time from CPU0, leaving
  less than 0.5% of its CPU time to the kworker. The IDPF workqueues
  that were using the kworker on CPU0 suffered large completion delays
  as a result, causing performance degradation, timeouts and eventual
  system crash.


  * I have also run a manual test to gauge the performance
    improvement. The test consists of an antagonist process
    (`./stress --cpu 2`) consuming as much of CPU 0 as possible. This
    process is run under `taskset 01` to bind it to CPU0, and its
    priority is changed with `chrt -pQ 9900 10000 ${pid}` and
    `renice -n -20 ${pid}` after start.

    Then, the IDPF driver is forced to prefer CPU0 by editing all calls
    to `queue_delayed_work`, `mod_delayed_work`, etc... to use CPU 0.

    Finally, `ktraces` for the workqueue events are collected.

    Without the current patch, the antagonist process can force
    arbitrary delays between `workqueue_queue_work` and
    `workqueue_execute_start`, that in my tests were as high as
    `30ms`. With the current patch applied, the workqueue can be
    migrated to another unloaded CPU in the same node, and, keeping
    everything else equal, the maximum delay I could see was `6us`.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-58057
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/66bf9b3d9e1658333741f075320dc8e7cd6f8d09
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/868202ec3854e13de1164e4a3e25521194c5af72
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9a5b021cb8186f1854bac2812bd4f396bb1e881c
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-58057
    reference_type:
    reference_id: CVE-2024-58057
