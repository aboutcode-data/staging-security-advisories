advisory_id: CVE-2022-50545
datasource_id: nvd_importer_v2/CVE-2022-50545
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2022-50545
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  r6040: Fix kmemleak in probe and remove

  There is a memory leaks reported by kmemleak:

    unreferenced object 0xffff888116111000 (size 2048):
      comm "modprobe", pid 817, jiffies 4294759745 (age 76.502s)
      hex dump (first 32 bytes):
        00 c4 0a 04 81 88 ff ff 08 10 11 16 81 88 ff ff  ................
        08 10 11 16 81 88 ff ff 00 00 00 00 00 00 00 00  ................
      backtrace:
        [<ffffffff815bcd82>] kmalloc_trace+0x22/0x60
        [<ffffffff827e20ee>] phy_device_create+0x4e/0x90
        [<ffffffff827e6072>] get_phy_device+0xd2/0x220
        [<ffffffff827e7844>] mdiobus_scan+0xa4/0x2e0
        [<ffffffff827e8be2>] __mdiobus_register+0x482/0x8b0
        [<ffffffffa01f5d24>] r6040_init_one+0x714/0xd2c [r6040]
        ...

  The problem occurs in probe process as follows:
    r6040_init_one:
      mdiobus_register
        mdiobus_scan    <- alloc and register phy_device,
                           the reference count of phy_device is 3
      r6040_mii_probe
        phy_connect     <- connect to the first phy_device,
                           so the reference count of the first
                           phy_device is 4, others are 3
      register_netdev   <- fault inject succeeded, goto error handling path

      // error handling path
      err_out_mdio_unregister:
        mdiobus_unregister(lp->mii_bus);
      err_out_mdio:
        mdiobus_free(lp->mii_bus);    <- the reference count of the first
                                         phy_device is 1, it is not released
                                         and other phy_devices are released
    // similarly, the remove process also has the same problem

  The root cause is traced to the phy_device is not disconnected when
  removes one r6040 device in r6040_remove_one() or on error handling path
  after r6040_mii probed successfully. In r6040_mii_probe(), a net ethernet
  device is connected to the first PHY device of mii_bus, in order to
  notify the connected driver when the link status changes, which is the
  default behavior of the PHY infrastructure to handle everything.
  Therefore the phy_device should be disconnected when removes one r6040
  device or on error handling path.

  Fix it by adding phy_disconnect() when removes one r6040 device or on
  error handling path after r6040_mii probed successfully.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-50545
weaknesses:
  - CWE-401
references:
  - url: https://git.kernel.org/stable/c/2ce242e1b9ad31c1f68496b3548e407a8cb2c07d
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/3d5f83a62e8235d235534b3dc6f197d8a822c269
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5944c25c67de54e0aa53623e1e1af3bf8b16ed44
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/7e43039a49c2da45edc1d9d7c9ede4003ab45a5f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9b5b50329e2e966831a7237dd6949e7b5362a49a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a04707f4596952049da05756c27398c34d9a1d36
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ad2c8f25457ca9a81e7e958148cbc26600ce3071
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b0a61359026b57a287a48fbb4ba1d097023eca3e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b4448816e6a565e08236a6009c6bf48c6836cdfd
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-50545
    reference_type:
    reference_id: CVE-2022-50545
