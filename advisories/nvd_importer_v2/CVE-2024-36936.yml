advisory_id: CVE-2024-36936
datasource_id: nvd_importer_v2/CVE-2024-36936
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-36936
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  efi/unaccepted: touch soft lockup during memory accept

  Commit 50e782a86c98 ("efi/unaccepted: Fix soft lockups caused by
  parallel memory acceptance") has released the spinlock so other CPUs can
  do memory acceptance in parallel and not triggers softlockup on other
  CPUs.

  However the softlock up was intermittent shown up if the memory of the
  TD guest is large, and the timeout of softlockup is set to 1 second:

   RIP: 0010:_raw_spin_unlock_irqrestore
   Call Trace:
   ? __hrtimer_run_queues
   <IRQ>
   ? hrtimer_interrupt
   ? watchdog_timer_fn
   ? __sysvec_apic_timer_interrupt
   ? __pfx_watchdog_timer_fn
   ? sysvec_apic_timer_interrupt
   </IRQ>
   ? __hrtimer_run_queues
   <TASK>
   ? hrtimer_interrupt
   ? asm_sysvec_apic_timer_interrupt
   ? _raw_spin_unlock_irqrestore
   ? __sysvec_apic_timer_interrupt
   ? sysvec_apic_timer_interrupt
   accept_memory
   try_to_accept_memory
   do_huge_pmd_anonymous_page
   get_page_from_freelist
   __handle_mm_fault
   __alloc_pages
   __folio_alloc
   ? __tdx_hypercall
   handle_mm_fault
   vma_alloc_folio
   do_user_addr_fault
   do_huge_pmd_anonymous_page
   exc_page_fault
   ? __do_huge_pmd_anonymous_page
   asm_exc_page_fault
   __handle_mm_fault

  When the local irq is enabled at the end of accept_memory(), the
  softlockup detects that the watchdog on single CPU has not been fed for
  a while. That is to say, even other CPUs will not be blocked by
  spinlock, the current CPU might be stunk with local irq disabled for a
  while, which hurts not only nmi watchdog but also softlockup.

  Chao Gao pointed out that the memory accept could be time costly and
  there was similar report before. Thus to avoid any softlocup detection
  during this stage, give the softlockup a flag to skip the timeout check
  at the end of accept_memory(), by invoking touch_softlockup_watchdog().
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-36936
weaknesses:
  - CWE-667
references:
  - url: https://git.kernel.org/stable/c/1c5a1627f48105cbab81d25ec2f72232bfaa8185
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/781e34b736014188ba9e46a71535237313dcda81
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e115c1b5de55a105c75aba8eb08301c075fa4ef4
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.6:-:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.6:-:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.6:rc7:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.6:rc7:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-36936
    reference_type:
    reference_id: CVE-2024-36936
