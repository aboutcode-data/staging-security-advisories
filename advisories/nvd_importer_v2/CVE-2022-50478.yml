advisory_id: CVE-2022-50478
datasource_id: nvd_importer_v2/CVE-2022-50478
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2022-50478
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  nilfs2: fix shift-out-of-bounds/overflow in nilfs_sb2_bad_offset()

  Patch series "nilfs2: fix UBSAN shift-out-of-bounds warnings on mount
  time".

  The first patch fixes a bug reported by syzbot, and the second one fixes
  the remaining bug of the same kind.  Although they are triggered by the
  same super block data anomaly, I divided it into the above two because the
  details of the issues and how to fix it are different.

  Both are required to eliminate the shift-out-of-bounds issues at mount
  time.


  This patch (of 2):

  If the block size exponent information written in an on-disk superblock is
  corrupted, nilfs_sb2_bad_offset helper function can trigger
  shift-out-of-bounds warning followed by a kernel panic (if panic_on_warn
  is set):

   shift exponent 38983 is too large for 64-bit type 'unsigned long long'
   Call Trace:
    <TASK>
    __dump_stack lib/dump_stack.c:88 [inline]
    dump_stack_lvl+0x1b1/0x28e lib/dump_stack.c:106
    ubsan_epilogue lib/ubsan.c:151 [inline]
    __ubsan_handle_shift_out_of_bounds+0x33d/0x3b0 lib/ubsan.c:322
    nilfs_sb2_bad_offset fs/nilfs2/the_nilfs.c:449 [inline]
    nilfs_load_super_block+0xdf5/0xe00 fs/nilfs2/the_nilfs.c:523
    init_nilfs+0xb7/0x7d0 fs/nilfs2/the_nilfs.c:577
    nilfs_fill_super+0xb1/0x5d0 fs/nilfs2/super.c:1047
    nilfs_mount+0x613/0x9b0 fs/nilfs2/super.c:1317
    ...

  In addition, since nilfs_sb2_bad_offset() performs multiplication without
  considering the upper bound, the computation may overflow if the disk
  layout parameters are not normal.

  This fixes these issues by inserting preliminary sanity checks for those
  parameters and by converting the comparison from one involving
  multiplication and left bit-shifting to one using division and right
  bit-shifting.
impacted_packages: []
severities:
  - score: '7.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-50478
weaknesses:
  - CWE-125
references:
  - url: https://git.kernel.org/stable/c/1012ff77284e3bec0ec0a35a820b03ec43dec2cc
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/610a2a3d7d8be3537458a378ec69396a76c385b6
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/62d11ec205ef14d8acf172cfc9904fdbf200025a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/6b0ea3df56cccd53398d0289f399f19d43136b2e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9b3ba54025357440d6c4414c670984f628c6f6bf
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a6f89b10042baca218c8598d6db5a44c7e32625f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b47f5c579c8186f7f5ab5e4254e0734ea5b7bf7a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d464b035c0613856d012cf1704879d3ff3f057fb
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d706485dffbbbf848e681edda29c7a46ac55698c
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-50478
    reference_type:
    reference_id: CVE-2022-50478
