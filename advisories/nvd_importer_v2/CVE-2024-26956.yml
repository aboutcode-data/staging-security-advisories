advisory_id: CVE-2024-26956
datasource_id: nvd_importer_v2/CVE-2024-26956
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-26956
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  nilfs2: fix failure to detect DAT corruption in btree and direct mappings

  Patch series "nilfs2: fix kernel bug at submit_bh_wbc()".

  This resolves a kernel BUG reported by syzbot.  Since there are two
  flaws involved, I've made each one a separate patch.

  The first patch alone resolves the syzbot-reported bug, but I think
  both fixes should be sent to stable, so I've tagged them as such.


  This patch (of 2):

  Syzbot has reported a kernel bug in submit_bh_wbc() when writing file data
  to a nilfs2 file system whose metadata is corrupted.

  There are two flaws involved in this issue.

  The first flaw is that when nilfs_get_block() locates a data block using
  btree or direct mapping, if the disk address translation routine
  nilfs_dat_translate() fails with internal code -ENOENT due to DAT metadata
  corruption, it can be passed back to nilfs_get_block().  This causes
  nilfs_get_block() to misidentify an existing block as non-existent,
  causing both data block lookup and insertion to fail inconsistently.

  The second flaw is that nilfs_get_block() returns a successful status in
  this inconsistent state.  This causes the caller __block_write_begin_int()
  or others to request a read even though the buffer is not mapped,
  resulting in a BUG_ON check for the BH_Mapped flag in submit_bh_wbc()
  failing.

  This fixes the first issue by changing the return value to code -EINVAL
  when a conversion using DAT fails with code -ENOENT, avoiding the
  conflicting condition that leads to the kernel bug described above.  Here,
  code -EINVAL indicates that metadata corruption was detected during the
  block lookup, which will be properly handled as a file system error and
  converted to -EIO when passing through the nilfs2 bmap layer.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-26956
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-26956
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/2e2619ff5d0def4bb6c2037a32a6eaa28dd95c84
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/46b832e09d43b394ac0f6d9485d2b1a06593f0b7
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/82827ca21e7c8a91384c5baa656f78a5adfa4ab4
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9cbe1ad5f4354f4df1445e5f4883983328cd6d8e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a8e4d098de1c0f4c5c1f2ed4633a860f0da6d713
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b67189690eb4b7ecc84ae16fa1e880e0123eaa35
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c3b5c5c31e723b568f83d8cafab8629d9d830ffb
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f2f26b4a84a0ef41791bd2d70861c8eac748f4ba
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f69e81396aea66304d214f175aa371f1b5578862
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2024/06/msg00017.html
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2024/06/msg00020.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:debian:debian_linux:10.0:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:debian:debian_linux:10.0:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-26956
    reference_type:
    reference_id: CVE-2024-26956
