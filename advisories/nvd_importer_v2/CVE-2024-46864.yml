advisory_id: CVE-2024-46864
datasource_id: nvd_importer_v2/CVE-2024-46864
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-46864
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  x86/hyperv: fix kexec crash due to VP assist page corruption

  commit 9636be85cc5b ("x86/hyperv: Fix hyperv_pcpu_input_arg handling when
  CPUs go online/offline") introduces a new cpuhp state for hyperv
  initialization.

  cpuhp_setup_state() returns the state number if state is
  CPUHP_AP_ONLINE_DYN or CPUHP_BP_PREPARE_DYN and 0 for all other states.
  For the hyperv case, since a new cpuhp state was introduced it would
  return 0. However, in hv_machine_shutdown(), the cpuhp_remove_state() call
  is conditioned upon "hyperv_init_cpuhp > 0". This will never be true and
  so hv_cpu_die() won't be called on all CPUs. This means the VP assist page
  won't be reset. When the kexec kernel tries to setup the VP assist page
  again, the hypervisor corrupts the memory region of the old VP assist page
  causing a panic in case the kexec kernel is using that memory elsewhere.
  This was originally fixed in commit dfe94d4086e4 ("x86/hyperv: Fix kexec
  panic/hang issues").

  Get rid of hyperv_init_cpuhp entirely since we are no longer using a
  dynamic cpuhp state and use CPUHP_AP_HYPERV_ONLINE directly with
  cpuhp_remove_state().
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-46864
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/2ae1beb3ab4f28868cc5d1541d05e1fbee3ad825
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b9af6418279c4cf73ca073f8ea024992b38be8ab
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d6f018a3b49d0a94ddbd0e479c2af6b19724e434
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc7:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc7:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-46864
    reference_type:
    reference_id: CVE-2024-46864
