advisory_id: CVE-2022-49687
datasource_id: nvd_importer_v2/CVE-2022-49687
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2022-49687
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  virtio_net: fix xdp_rxq_info bug after suspend/resume

  The following sequence currently causes a driver bug warning
  when using virtio_net:

    # ip link set eth0 up
    # echo mem > /sys/power/state (or e.g. # rtcwake -s 10 -m mem)
    <resume>
    # ip link set eth0 down

    Missing register, driver bug
    WARNING: CPU: 0 PID: 375 at net/core/xdp.c:138 xdp_rxq_info_unreg+0x58/0x60
    Call trace:
     xdp_rxq_info_unreg+0x58/0x60
     virtnet_close+0x58/0xac
     __dev_close_many+0xac/0x140
     __dev_change_flags+0xd8/0x210
     dev_change_flags+0x24/0x64
     do_setlink+0x230/0xdd0
     ...

  This happens because virtnet_freeze() frees the receive_queue
  completely (including struct xdp_rxq_info) but does not call
  xdp_rxq_info_unreg(). Similarly, virtnet_restore() sets up the
  receive_queue again but does not call xdp_rxq_info_reg().

  Actually, parts of virtnet_freeze_down() and virtnet_restore_up()
  are almost identical to virtnet_close() and virtnet_open(): only
  the calls to xdp_rxq_info_(un)reg() are missing. This means that
  we can fix this easily and avoid such problems in the future by
  just calling virtnet_close()/open() from the freeze/restore handlers.

  Aside from adding the missing xdp_rxq_info calls the only difference
  is that the refill work is only cancelled if netif_running(). However,
  this should not make any functional difference since the refill work
  should only be active if the network interface is actually up.
impacted_packages: []
severities:
  - score: '7.1'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-49687
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/340fbdc8011f2dc678f622c5ce1cbb5ab8305de7
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/57ee40f1b198b59d43c216fbc4672f9300d3c8b0
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/8af52fe9fd3bf5e7478da99193c0632276e1dfce
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/8c7a32b7c15555beddc5810c3334d9cefff061bf
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/8d7fe9ad6fddc2af8bde4b921b4f8fab231ed38c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9222672fa6370f0ec3d899662cb8680e9282fc4c
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.19:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.19:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.19:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.19:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.19:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.19:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-49687
    reference_type:
    reference_id: CVE-2022-49687
