advisory_id: CVE-2024-26806
datasource_id: nvd_importer_v2/CVE-2024-26806
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-26806
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  spi: cadence-qspi: remove system-wide suspend helper calls from runtime PM hooks

  The ->runtime_suspend() and ->runtime_resume() callbacks are not
  expected to call spi_controller_suspend() and spi_controller_resume().
  Remove calls to those in the cadence-qspi driver.

  Those helpers have two roles currently:
   - They stop/start the queue, including dealing with the kworker.
   - They toggle the SPI controller SPI_CONTROLLER_SUSPENDED flag. It
     requires acquiring ctlr->bus_lock_mutex.

  Step one is irrelevant because cadence-qspi is not queued. Step two
  however has two implications:
   - A deadlock occurs, because ->runtime_resume() is called in a context
     where the lock is already taken (in the ->exec_op() callback, where
     the usage count is incremented).
   - It would disallow all operations once the device is auto-suspended.

  Here is a brief call tree highlighting the mutex deadlock:

  spi_mem_exec_op()
          ...
          spi_mem_access_start()
                  mutex_lock(&ctlr->bus_lock_mutex)

          cqspi_exec_mem_op()
                  pm_runtime_resume_and_get()
                          cqspi_resume()
                                  spi_controller_resume()
                                          mutex_lock(&ctlr->bus_lock_mutex)
                  ...

          spi_mem_access_end()
                  mutex_unlock(&ctlr->bus_lock_mutex)
          ...
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-26806
weaknesses:
  - CWE-667
references:
  - url: https://git.kernel.org/stable/c/041562ebc4759c9932b59a06527f8753b86da365
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/959043afe53ae80633e810416cee6076da6e91c6
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.8:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.8:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.8:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.8:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.8:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.8:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.8:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.8:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.8:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.8:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.8:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.8:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-26806
    reference_type:
    reference_id: CVE-2024-26806
