advisory_id: CVE-2024-46760
datasource_id: nvd_importer_v2/CVE-2024-46760
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-46760
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  wifi: rtw88: usb: schedule rx work after everything is set up

  Right now it's possible to hit NULL pointer dereference in
  rtw_rx_fill_rx_status on hw object and/or its fields because
  initialization routine can start getting USB replies before
  rtw_dev is fully setup.

  The stack trace looks like this:

  rtw_rx_fill_rx_status
  rtw8821c_query_rx_desc
  rtw_usb_rx_handler
  ...
  queue_work
  rtw_usb_read_port_complete
  ...
  usb_submit_urb
  rtw_usb_rx_resubmit
  rtw_usb_init_rx
  rtw_usb_probe

  So while we do the async stuff rtw_usb_probe continues and calls
  rtw_register_hw, which does all kinds of initialization (e.g.
  via ieee80211_register_hw) that rtw_rx_fill_rx_status relies on.

  Fix this by moving the first usb_submit_urb after everything
  is set up.

  For me, this bug manifested as:
  [    8.893177] rtw_8821cu 1-1:1.2: band wrong, packet dropped
  [    8.910904] rtw_8821cu 1-1:1.2: hw->conf.chandef.chan NULL in rtw_rx_fill_rx_status
  because I'm using Larry's backport of rtw88 driver with the NULL
  checks in rtw_rx_fill_rx_status.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-46760
weaknesses:
  - CWE-476
references:
  - url: https://git.kernel.org/stable/c/25eaef533bf3ccc6fee5067aac16f41f280e343e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/adc539784c98a7cc602cbf557debfc2e7b9be8b3
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c83d464b82a8ad62ec9077637f75d73fe955635a
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-46760
    reference_type:
    reference_id: CVE-2024-46760
