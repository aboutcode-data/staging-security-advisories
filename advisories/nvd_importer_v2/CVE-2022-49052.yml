advisory_id: CVE-2022-49052
datasource_id: nvd_importer_v2/CVE-2022-49052
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2022-49052
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  mm: fix unexpected zeroed page mapping with zram swap

  Two processes under CLONE_VM cloning, user process can be corrupted by
  seeing zeroed page unexpectedly.

        CPU A                        CPU B

    do_swap_page                do_swap_page
    SWP_SYNCHRONOUS_IO path     SWP_SYNCHRONOUS_IO path
    swap_readpage valid data
      swap_slot_free_notify
        delete zram entry
                                swap_readpage zeroed(invalid) data
                                pte_lock
                                map the *zero data* to userspace
                                pte_unlock
    pte_lock
    if (!pte_same)
      goto out_nomap;
    pte_unlock
    return and next refault will
    read zeroed data

  The swap_slot_free_notify is bogus for CLONE_VM case since it doesn't
  increase the refcount of swap slot at copy_mm so it couldn't catch up
  whether it's safe or not to discard data from backing device.  In the
  case, only the lock it could rely on to synchronize swap slot freeing is
  page table lock.  Thus, this patch gets rid of the swap_slot_free_notify
  function.  With this patch, CPU A will see correct data.

        CPU A                        CPU B

    do_swap_page                do_swap_page
    SWP_SYNCHRONOUS_IO path     SWP_SYNCHRONOUS_IO path
                                swap_readpage original data
                                pte_lock
                                map the original data
                                swap_free
                                  swap_range_free
                                    bd_disk->fops->swap_slot_free_notify
    swap_readpage read zeroed data
                                pte_unlock
    pte_lock
    if (!pte_same)
      goto out_nomap;
    pte_unlock
    return
    on next refault will see mapped data by CPU B

  The concern of the patch would increase memory consumption since it
  could keep wasted memory with compressed form in zram as well as
  uncompressed form in address space.  However, most of cases of zram uses
  no readahead and do_swap_page is followed by swap_free so it will free
  the compressed form from in zram quickly.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-49052
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/12ba1d38115a101c45d8e0ca3aa1181fd148e57f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/20ed94f8181a25212e7404e44958e234f407624b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/afac4b88699a06c8b9369f9d759a1ec3c254b788
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e914d8f00391520ecc4495dd0ca0124538ab7119
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f098f8b9820fe3f2e41aefc4329dfe8a3859d1c1
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f86d55cf616199404c05f5b0c5c41b17351baa02
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.18:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.18:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.18:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.18:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-49052
    reference_type:
    reference_id: CVE-2022-49052
