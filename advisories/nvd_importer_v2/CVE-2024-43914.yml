advisory_id: CVE-2024-43914
datasource_id: nvd_importer_v2/CVE-2024-43914
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-43914
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  md/raid5: avoid BUG_ON() while continue reshape after reassembling

  Currently, mdadm support --revert-reshape to abort the reshape while
  reassembling, as the test 07revert-grow. However, following BUG_ON()
  can be triggerred by the test:

  kernel BUG at drivers/md/raid5.c:6278!
  invalid opcode: 0000 [#1] PREEMPT SMP PTI
  irq event stamp: 158985
  CPU: 6 PID: 891 Comm: md0_reshape Not tainted 6.9.0-03335-g7592a0b0049a #94
  RIP: 0010:reshape_request+0x3f1/0xe60
  Call Trace:
   <TASK>
   raid5_sync_request+0x43d/0x550
   md_do_sync+0xb7a/0x2110
   md_thread+0x294/0x2b0
   kthread+0x147/0x1c0
   ret_from_fork+0x59/0x70
   ret_from_fork_asm+0x1a/0x30
   </TASK>

  Root cause is that --revert-reshape update the raid_disks from 5 to 4,
  while reshape position is still set, and after reassembling the array,
  reshape position will be read from super block, then during reshape the
  checking of 'writepos' that is caculated by old reshape position will
  fail.

  Fix this panic the easy way first, by converting the BUG_ON() to
  WARN_ON(), and stop the reshape if checkings fail.

  Noted that mdadm must fix --revert-shape as well, and probably md/raid
  should enhance metadata validation as well, however this means
  reassemble will fail and there must be user tools to fix the wrong
  metadata.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-43914
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/2c92f8c1c456d556f15cbf51667b385026b2e6a0
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/305a5170dc5cf3d395bb4c4e9239bca6d0b54b49
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/3b33740c1750a39e046339ff9240e954f0156707
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/4811d6e5d9f4090c3e0ff9890eb24077108046ab
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/6b33c468d543f6a83de2d61f09fec74b27e19fd2
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/775a9ba16c9ffe98fe54ebf14e55d5660f2bf600
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/bf0ff69a42a3d2d46876d0514ecf13dffc516666
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c384dd4f1fb3b14a2fd199360701cc163ea88705
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2024/10/msg00003.html
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/01/msg00001.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-43914
    reference_type:
    reference_id: CVE-2024-43914
