advisory_id: CVE-2024-46847
datasource_id: nvd_importer_v2/CVE-2024-46847
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-46847
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  mm: vmalloc: ensure vmap_block is initialised before adding to queue

  Commit 8c61291fd850 ("mm: fix incorrect vbq reference in
  purge_fragmented_block") extended the 'vmap_block' structure to contain a
  'cpu' field which is set at allocation time to the id of the initialising
  CPU.

  When a new 'vmap_block' is being instantiated by new_vmap_block(), the
  partially initialised structure is added to the local 'vmap_block_queue'
  xarray before the 'cpu' field has been initialised.  If another CPU is
  concurrently walking the xarray (e.g.  via vm_unmap_aliases()), then it
  may perform an out-of-bounds access to the remote queue thanks to an
  uninitialised index.

  This has been observed as UBSAN errors in Android:

   | Internal error: UBSAN: array index out of bounds: 00000000f2005512 [#1] PREEMPT SMP
   |
   | Call trace:
   |  purge_fragmented_block+0x204/0x21c
   |  _vm_unmap_aliases+0x170/0x378
   |  vm_unmap_aliases+0x1c/0x28
   |  change_memory_common+0x1dc/0x26c
   |  set_memory_ro+0x18/0x24
   |  module_enable_ro+0x98/0x238
   |  do_init_module+0x1b0/0x310

  Move the initialisation of 'vb->cpu' in new_vmap_block() ahead of the
  addition to the xarray.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-46847
weaknesses:
  - CWE-129
references:
  - url: https://git.kernel.org/stable/c/1b2770e27d6d952f491bb362b657e5b2713c3efd
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/3e3de7947c751509027d26b679ecd243bc9db255
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/6cf74e0e5e3ab5d5c9defb4c73dad54d52224671
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.11:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.11:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-46847
    reference_type:
    reference_id: CVE-2024-46847
