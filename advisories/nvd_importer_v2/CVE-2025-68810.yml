advisory_id: CVE-2025-68810
datasource_id: nvd_importer_v2/CVE-2025-68810
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-68810
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  KVM: Disallow toggling KVM_MEM_GUEST_MEMFD on an existing memslot

  Reject attempts to disable KVM_MEM_GUEST_MEMFD on a memslot that was
  initially created with a guest_memfd binding, as KVM doesn't support
  toggling KVM_MEM_GUEST_MEMFD on existing memslots.  KVM prevents enabling
  KVM_MEM_GUEST_MEMFD, but doesn't prevent clearing the flag.

  Failure to reject the new memslot results in a use-after-free due to KVM
  not unbinding from the guest_memfd instance.  Unbinding on a FLAGS_ONLY
  change is easy enough, and can/will be done as a hardening measure (in
  anticipation of KVM supporting dirty logging on guest_memfd at some point),
  but fixing the use-after-free would only address the immediate symptom.

    ==================================================================
    BUG: KASAN: slab-use-after-free in kvm_gmem_release+0x362/0x400 [kvm]
    Write of size 8 at addr ffff8881111ae908 by task repro/745

    CPU: 7 UID: 1000 PID: 745 Comm: repro Not tainted 6.18.0-rc6-115d5de2eef3-next-kasan #3 NONE
    Hardware name: QEMU Standard PC (Q35 + ICH9, 2009), BIOS 0.0.0 02/06/2015
    Call Trace:
     <TASK>
     dump_stack_lvl+0x51/0x60
     print_report+0xcb/0x5c0
     kasan_report+0xb4/0xe0
     kvm_gmem_release+0x362/0x400 [kvm]
     __fput+0x2fa/0x9d0
     task_work_run+0x12c/0x200
     do_exit+0x6ae/0x2100
     do_group_exit+0xa8/0x230
     __x64_sys_exit_group+0x3a/0x50
     x64_sys_call+0x737/0x740
     do_syscall_64+0x5b/0x900
     entry_SYSCALL_64_after_hwframe+0x4b/0x53
    RIP: 0033:0x7f581f2eac31
     </TASK>

    Allocated by task 745 on cpu 6 at 9.746971s:
     kasan_save_stack+0x20/0x40
     kasan_save_track+0x13/0x50
     __kasan_kmalloc+0x77/0x90
     kvm_set_memory_region.part.0+0x652/0x1110 [kvm]
     kvm_vm_ioctl+0x14b0/0x3290 [kvm]
     __x64_sys_ioctl+0x129/0x1a0
     do_syscall_64+0x5b/0x900
     entry_SYSCALL_64_after_hwframe+0x4b/0x53

    Freed by task 745 on cpu 6 at 9.747467s:
     kasan_save_stack+0x20/0x40
     kasan_save_track+0x13/0x50
     __kasan_save_free_info+0x37/0x50
     __kasan_slab_free+0x3b/0x60
     kfree+0xf5/0x440
     kvm_set_memslot+0x3c2/0x1160 [kvm]
     kvm_set_memory_region.part.0+0x86a/0x1110 [kvm]
     kvm_vm_ioctl+0x14b0/0x3290 [kvm]
     __x64_sys_ioctl+0x129/0x1a0
     do_syscall_64+0x5b/0x900
     entry_SYSCALL_64_after_hwframe+0x4b/0x53
impacted_packages: []
severities: []
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/89dbbe6ff323fc34659621a577fe0af913f47386
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9935df5333aa503a18de5071f53762b65c783c4c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/cb51bef465d8ec60a968507330e01020e35dc127
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-68810
    reference_type:
    reference_id: CVE-2025-68810
