advisory_id: CVE-2024-53119
datasource_id: nvd_importer_v2/CVE-2024-53119
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-53119
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  virtio/vsock: Fix accept_queue memory leak

  As the final stages of socket destruction may be delayed, it is possible
  that virtio_transport_recv_listen() will be called after the accept_queue
  has been flushed, but before the SOCK_DONE flag has been set. As a result,
  sockets enqueued after the flush would remain unremoved, leading to a
  memory leak.

  vsock_release
    __vsock_release
      lock
      virtio_transport_release
        virtio_transport_close
          schedule_delayed_work(close_work)
      sk_shutdown = SHUTDOWN_MASK
  (!) flush accept_queue
      release
                                          virtio_transport_recv_pkt
                                            vsock_find_bound_socket
                                            lock
                                            if flag(SOCK_DONE) return
                                            virtio_transport_recv_listen
                                              child = vsock_create_connected
                                        (!)   vsock_enqueue_accept(child)
                                            release
  close_work
    lock
    virtio_transport_do_close
      set_flag(SOCK_DONE)
      virtio_transport_remove_sock
        vsock_remove_sock
          vsock_remove_bound
    release

  Introduce a sk_shutdown check to disallow vsock_enqueue_accept() during
  socket destruction.

  unreferenced object 0xffff888109e3f800 (size 2040):
    comm "kworker/5:2", pid 371, jiffies 4294940105
    hex dump (first 32 bytes):
      00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00  ................
      28 00 0b 40 00 00 00 00 00 00 00 00 00 00 00 00  (..@............
    backtrace (crc 9e5f4e84):
      [<ffffffff81418ff1>] kmem_cache_alloc_noprof+0x2c1/0x360
      [<ffffffff81d27aa0>] sk_prot_alloc+0x30/0x120
      [<ffffffff81d2b54c>] sk_alloc+0x2c/0x4b0
      [<ffffffff81fe049a>] __vsock_create.constprop.0+0x2a/0x310
      [<ffffffff81fe6d6c>] virtio_transport_recv_pkt+0x4dc/0x9a0
      [<ffffffff81fe745d>] vsock_loopback_work+0xfd/0x140
      [<ffffffff810fc6ac>] process_one_work+0x20c/0x570
      [<ffffffff810fce3f>] worker_thread+0x1bf/0x3a0
      [<ffffffff811070dd>] kthread+0xdd/0x110
      [<ffffffff81044fdd>] ret_from_fork+0x2d/0x50
      [<ffffffff8100785a>] ret_from_fork_asm+0x1a/0x30
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-53119
weaknesses:
  - CWE-401
references:
  - url: https://git.kernel.org/stable/c/2415345042245de7601dcc6eafdbe3a3dcc9e379
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/4310902c766e371359e6c6311056ae80b5beeac9
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/897617a413e0bf1c6380e3b34b2f28f450508549
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/946c7600fa2207cc8d3fbc86a518ec56f98a5813
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d7b0ff5a866724c3ad21f2628c22a63336deec3f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e26fa236758e8baa61a82cfd9fd4388d2e8d6a4c
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/01/msg00001.html
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/03/msg00002.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc7:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc7:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-53119
    reference_type:
    reference_id: CVE-2024-53119
