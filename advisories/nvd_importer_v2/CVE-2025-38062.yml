advisory_id: CVE-2025-38062
datasource_id: nvd_importer_v2/CVE-2025-38062
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-38062
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  genirq/msi: Store the IOMMU IOVA directly in msi_desc instead of iommu_cookie

  The IOMMU translation for MSI message addresses has been a 2-step process,
  separated in time:

   1) iommu_dma_prepare_msi(): A cookie pointer containing the IOVA address
      is stored in the MSI descriptor when an MSI interrupt is allocated.

   2) iommu_dma_compose_msi_msg(): this cookie pointer is used to compute a
      translated message address.

  This has an inherent lifetime problem for the pointer stored in the cookie
  that must remain valid between the two steps. However, there is no locking
  at the irq layer that helps protect the lifetime. Today, this works under
  the assumption that the iommu domain is not changed while MSI interrupts
  being programmed. This is true for normal DMA API users within the kernel,
  as the iommu domain is attached before the driver is probed and cannot be
  changed while a driver is attached.

  Classic VFIO type1 also prevented changing the iommu domain while VFIO was
  running as it does not support changing the "container" after starting up.

  However, iommufd has improved this so that the iommu domain can be changed
  during VFIO operation. This potentially allows userspace to directly race
  VFIO_DEVICE_ATTACH_IOMMUFD_PT (which calls iommu_attach_group()) and
  VFIO_DEVICE_SET_IRQS (which calls into iommu_dma_compose_msi_msg()).

  This potentially causes both the cookie pointer and the unlocked call to
  iommu_get_domain_for_dev() on the MSI translation path to become UAFs.

  Fix the MSI cookie UAF by removing the cookie pointer. The translated IOVA
  address is already known during iommu_dma_prepare_msi() and cannot change.
  Thus, it can simply be stored as an integer in the MSI descriptor.

  The other UAF related to iommu_get_domain_for_dev() will be addressed in
  patch "iommu: Make iommu_dma_prepare_msi() into a generic operation" by
  using the IOMMU group mutex.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-38062
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/1f7df3a691740a7736bbc99dc4ed536120eb4746
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/53f42776e435f63e5f8e61955e4c205dbfeaf524
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/856152eb91e67858a09e30a7149a1f29b04b7384
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ba41e4e627db51d914444aee0b93eb67f31fa330
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e4d3763223c7b72ded53425207075e7453b4e3d5
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/10/msg00008.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:debian:debian_linux:11.0:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:debian:debian_linux:11.0:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-38062
    reference_type:
    reference_id: CVE-2025-38062
