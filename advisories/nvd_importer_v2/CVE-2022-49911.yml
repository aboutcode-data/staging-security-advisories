advisory_id: CVE-2022-49911
datasource_id: nvd_importer_v2/CVE-2022-49911
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2022-49911
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  netfilter: ipset: enforce documented limit to prevent allocating huge memory

  Daniel Xu reported that the hash:net,iface type of the ipset subsystem does
  not limit adding the same network with different interfaces to a set, which
  can lead to huge memory usage or allocation failure.

  The quick reproducer is

  $ ipset create ACL.IN.ALL_PERMIT hash:net,iface hashsize 1048576 timeout 0
  $ for i in $(seq 0 100); do /sbin/ipset add ACL.IN.ALL_PERMIT 0.0.0.0/0,kaf_$i timeout 0 -exist; done

  The backtrace when vmalloc fails:

          [Tue Oct 25 00:13:08 2022] ipset: vmalloc error: size 1073741848, exceeds total pages
          <...>
          [Tue Oct 25 00:13:08 2022] Call Trace:
          [Tue Oct 25 00:13:08 2022]  <TASK>
          [Tue Oct 25 00:13:08 2022]  dump_stack_lvl+0x48/0x60
          [Tue Oct 25 00:13:08 2022]  warn_alloc+0x155/0x180
          [Tue Oct 25 00:13:08 2022]  __vmalloc_node_range+0x72a/0x760
          [Tue Oct 25 00:13:08 2022]  ? hash_netiface4_add+0x7c0/0xb20
          [Tue Oct 25 00:13:08 2022]  ? __kmalloc_large_node+0x4a/0x90
          [Tue Oct 25 00:13:08 2022]  kvmalloc_node+0xa6/0xd0
          [Tue Oct 25 00:13:08 2022]  ? hash_netiface4_resize+0x99/0x710
          <...>

  The fix is to enforce the limit documented in the ipset(8) manpage:

  >  The internal restriction of the hash:net,iface set type is that the same
  >  network prefix cannot be stored with more than 64 different interfaces
  >  in a single set.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-49911
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/42d20d5e24575c9afa2d66d9a51e7386db9514f5
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/510841da1fcc16f702440ab58ef0b4d82a9056b7
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a37ef32fe5956fe9248df68f6a61997845ba047e
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.1:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.1:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.1:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.1:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.1:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.1:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-49911
    reference_type:
    reference_id: CVE-2022-49911
