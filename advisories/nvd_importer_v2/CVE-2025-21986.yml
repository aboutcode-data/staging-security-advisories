advisory_id: CVE-2025-21986
datasource_id: nvd_importer_v2/CVE-2025-21986
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-21986
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  net: switchdev: Convert blocking notification chain to a raw one

  A blocking notification chain uses a read-write semaphore to protect the
  integrity of the chain. The semaphore is acquired for writing when
  adding / removing notifiers to / from the chain and acquired for reading
  when traversing the chain and informing notifiers about an event.

  In case of the blocking switchdev notification chain, recursive
  notifications are possible which leads to the semaphore being acquired
  twice for reading and to lockdep warnings being generated [1].

  Specifically, this can happen when the bridge driver processes a
  SWITCHDEV_BRPORT_UNOFFLOADED event which causes it to emit notifications
  about deferred events when calling switchdev_deferred_process().

  Fix this by converting the notification chain to a raw notification
  chain in a similar fashion to the netdev notification chain. Protect
  the chain using the RTNL mutex by acquiring it when modifying the chain.
  Events are always informed under the RTNL mutex, but add an assertion in
  call_switchdev_blocking_notifiers() to make sure this is not violated in
  the future.

  Maintain the "blocking" prefix as events are always emitted from process
  context and listeners are allowed to block.

  [1]:
  WARNING: possible recursive locking detected
  6.14.0-rc4-custom-g079270089484 #1 Not tainted
  --------------------------------------------
  ip/52731 is trying to acquire lock:
  ffffffff850918d8 ((switchdev_blocking_notif_chain).rwsem){++++}-{4:4}, at: blocking_notifier_call_chain+0x58/0xa0

  but task is already holding lock:
  ffffffff850918d8 ((switchdev_blocking_notif_chain).rwsem){++++}-{4:4}, at: blocking_notifier_call_chain+0x58/0xa0

  other info that might help us debug this:
  Possible unsafe locking scenario:
  CPU0
  ----
  lock((switchdev_blocking_notif_chain).rwsem);
  lock((switchdev_blocking_notif_chain).rwsem);

  *** DEADLOCK ***
  May be due to missing lock nesting notation
  3 locks held by ip/52731:
   #0: ffffffff84f795b0 (rtnl_mutex){+.+.}-{4:4}, at: rtnl_newlink+0x727/0x1dc0
   #1: ffffffff8731f628 (&net->rtnl_mutex){+.+.}-{4:4}, at: rtnl_newlink+0x790/0x1dc0
   #2: ffffffff850918d8 ((switchdev_blocking_notif_chain).rwsem){++++}-{4:4}, at: blocking_notifier_call_chain+0x58/0xa0

  stack backtrace:
  ...
  ? __pfx_down_read+0x10/0x10
  ? __pfx_mark_lock+0x10/0x10
  ? __pfx_switchdev_port_attr_set_deferred+0x10/0x10
  blocking_notifier_call_chain+0x58/0xa0
  switchdev_port_attr_notify.constprop.0+0xb3/0x1b0
  ? __pfx_switchdev_port_attr_notify.constprop.0+0x10/0x10
  ? mark_held_locks+0x94/0xe0
  ? switchdev_deferred_process+0x11a/0x340
  switchdev_port_attr_set_deferred+0x27/0xd0
  switchdev_deferred_process+0x164/0x340
  br_switchdev_port_unoffload+0xc8/0x100 [bridge]
  br_switchdev_blocking_event+0x29f/0x580 [bridge]
  notifier_call_chain+0xa2/0x440
  blocking_notifier_call_chain+0x6e/0xa0
  switchdev_bridge_port_unoffload+0xde/0x1a0
  ...
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-21986
weaknesses:
  - CWE-667
references:
  - url: https://git.kernel.org/stable/c/1f7d051814e7a0cb1f0717ed5527c1059992129d
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/62531a1effa87bdab12d5104015af72e60d926ff
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a597d4b75669ec82c72cbee9fe75a15d04b35b2b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/af757f5ee3f754c5dceefb05c12ff37cb46fc682
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f9ed3fb50b872bd78bcb01f25087f9e4e25085d8
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/05/msg00045.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.14:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.14:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.14:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.14:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.14:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.14:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.14:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.14:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.14:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.14:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.14:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.14:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.8:-:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.8:-:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.8:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.8:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.8:rc7:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.8:rc7:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-21986
    reference_type:
    reference_id: CVE-2025-21986
