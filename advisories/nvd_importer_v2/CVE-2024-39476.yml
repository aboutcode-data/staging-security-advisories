advisory_id: CVE-2024-39476
datasource_id: nvd_importer_v2/CVE-2024-39476
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-39476
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  md/raid5: fix deadlock that raid5d() wait for itself to clear MD_SB_CHANGE_PENDING

  Xiao reported that lvm2 test lvconvert-raid-takeover.sh can hang with
  small possibility, the root cause is exactly the same as commit
  bed9e27baf52 ("Revert "md/raid5: Wait for MD_SB_CHANGE_PENDING in raid5d"")

  However, Dan reported another hang after that, and junxiao investigated
  the problem and found out that this is caused by plugged bio can't issue
  from raid5d().

  Current implementation in raid5d() has a weird dependence:

  1) md_check_recovery() from raid5d() must hold 'reconfig_mutex' to clear
     MD_SB_CHANGE_PENDING;
  2) raid5d() handles IO in a deadloop, until all IO are issued;
  3) IO from raid5d() must wait for MD_SB_CHANGE_PENDING to be cleared;

  This behaviour is introduce before v2.6, and for consequence, if other
  context hold 'reconfig_mutex', and md_check_recovery() can't update
  super_block, then raid5d() will waste one cpu 100% by the deadloop, until
  'reconfig_mutex' is released.

  Refer to the implementation from raid1 and raid10, fix this problem by
  skipping issue IO if MD_SB_CHANGE_PENDING is still set after
  md_check_recovery(), daemon thread will be woken up when 'reconfig_mutex'
  is released. Meanwhile, the hang problem will be fixed as well.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-39476
weaknesses:
  - CWE-667
references:
  - url: https://git.kernel.org/stable/c/098d54934814dd876963abfe751c3b1cf7fbe56a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/151f66bb618d1fd0eeb84acb61b4a9fa5d8bb0fa
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/3f8d5e802d4cedd445f9a89be8c3fd2d0e99024b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/634ba3c97ec413cb10681c7b196db43ee461ecf4
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/aa64464c8f4d2ab92f6d0b959a1e0767b829d787
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b32aa95843cac6b12c2c014d40fca18aef24a347
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/cd2538e5af495b3c747e503db346470fc1ffc447
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e332a12f65d8fed8cf63bedb4e9317bb872b9ac7
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-39476
    reference_type:
    reference_id: CVE-2024-39476
