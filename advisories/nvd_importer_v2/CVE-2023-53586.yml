advisory_id: CVE-2023-53586
datasource_id: nvd_importer_v2/CVE-2023-53586
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2023-53586
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  scsi: target: Fix multiple LUN_RESET handling

  This fixes a bug where an initiator thinks a LUN_RESET has cleaned up
  running commands when it hasn't. The bug was added in commit 51ec502a3266
  ("target: Delete tmr from list before processing").

  The problem occurs when:

   1. We have N I/O cmds running in the target layer spread over 2 sessions.

   2. The initiator sends a LUN_RESET for each session.

   3. session1's LUN_RESET loops over all the running commands from both
      sessions and moves them to its local drain_task_list.

   4. session2's LUN_RESET does not see the LUN_RESET from session1 because
      the commit above has it remove itself. session2 also does not see any
      commands since the other reset moved them off the state lists.

   5. sessions2's LUN_RESET will then complete with a successful response.

   6. sessions2's inititor believes the running commands on its session are
      now cleaned up due to the successful response and cleans up the running
      commands from its side. It then restarts them.

   7. The commands do eventually complete on the backend and the target
      starts to return aborted task statuses for them. The initiator will
      either throw a invalid ITT error or might accidentally lookup a new
      task if the ITT has been reallocated already.

  Fix the bug by reverting the patch, and serialize the execution of
  LUN_RESETs and Preempt and Aborts.

  Also prevent us from waiting on LUN_RESETs in core_tmr_drain_tmr_list,
  because it turns out the original patch fixed a bug that was not
  mentioned. For LUN_RESET1 core_tmr_drain_tmr_list can see a second
  LUN_RESET and wait on it. Then the second reset will run
  core_tmr_drain_tmr_list and see the first reset and wait on it resulting in
  a deadlock.
impacted_packages: []
severities:
  - score: '4.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2023-53586
weaknesses:
  - CWE-415
references:
  - url: https://git.kernel.org/stable/c/2c43de56f9220dca3e28c774d1c5e2cab574223a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/673db054d7a2b5a470d7a25baf65956d005ad729
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9158c86fd3237acaea8f0181c7836d90fd6eea10
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e1f59cd18a10969d08a082264b557876ca38766e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/eacfe32c3650bfd0e54224d160c431013d7f6998
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ed18526289b5603bf2253dee50f1d7ec245cf397
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-53586
    reference_type:
    reference_id: CVE-2023-53586
