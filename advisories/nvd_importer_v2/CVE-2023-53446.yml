advisory_id: CVE-2023-53446
datasource_id: nvd_importer_v2/CVE-2023-53446
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2023-53446
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  PCI/ASPM: Disable ASPM on MFD function removal to avoid use-after-free

  Struct pcie_link_state->downstream is a pointer to the pci_dev of function
  0.  Previously we retained that pointer when removing function 0, and
  subsequent ASPM policy changes dereferenced it, resulting in a
  use-after-free warning from KASAN, e.g.:

    # echo 1 > /sys/bus/pci/devices/0000:03:00.0/remove
    # echo powersave > /sys/module/pcie_aspm/parameters/policy

    BUG: KASAN: slab-use-after-free in pcie_config_aspm_link+0x42d/0x500
    Call Trace:
     kasan_report+0xae/0xe0
     pcie_config_aspm_link+0x42d/0x500
     pcie_aspm_set_policy+0x8e/0x1a0
     param_attr_store+0x162/0x2c0
     module_attr_store+0x3e/0x80

  PCIe spec r6.0, sec 7.5.3.7, recommends that software program the same ASPM
  Control value in all functions of multi-function devices.

  Disable ASPM and free the pcie_link_state when any child function is
  removed so we can discard the dangling pcie_link_state->downstream pointer
  and maintain the same ASPM Control configuration for all functions.

  [bhelgaas: commit log and comment]
impacted_packages: []
severities:
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2023-53446
weaknesses:
  - CWE-416
references:
  - url: https://git.kernel.org/stable/c/4203722d51afe3d239e03f15cc73efdf023a7103
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/456d8aa37d0f56fc9e985e812496e861dcd6f2f2
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/666e7f9d60cee23077ea3e6331f6f8a19f7ea03f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/7aecdd47910c51707696e8b0e045b9f88bd4230f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/7badf4d6f49a358a01ab072bbff88d3ee886c33b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9856c0de49052174ab474113f4ba40c02aaee086
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d51d2eeae4ce54d542909c4d9d07bf371a78592c
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-53446
    reference_type:
    reference_id: CVE-2023-53446
