advisory_id: CVE-2023-53564
datasource_id: nvd_importer_v2/CVE-2023-53564
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2023-53564
aliases: []
summary: "In the Linux kernel, the following vulnerability has been resolved:\n\nocfs2: fix\
  \ defrag path triggering jbd2 ASSERT\n\ncode path:\n\nocfs2_ioctl_move_extents\n ocfs2_move_extents\n\
  \  ocfs2_defrag_extent\n   __ocfs2_move_extent\n    + ocfs2_journal_access_di\n    + ocfs2_split_extent\
  \  //sub-paths call jbd2_journal_restart\n    + ocfs2_journal_dirty //crash by jbs2 ASSERT\n\
  \ncrash stacks:\n\nPID: 11297  TASK: ffff974a676dcd00  CPU: 67  COMMAND: \"defragfs.ocfs2\"\
  \n #0 [ffffb25d8dad3900] machine_kexec at ffffffff8386fe01\n #1 [ffffb25d8dad3958] __crash_kexec\
  \ at ffffffff8395959d\n #2 [ffffb25d8dad3a20] crash_kexec at ffffffff8395a45d\n #3 [ffffb25d8dad3a38]\
  \ oops_end at ffffffff83836d3f\n #4 [ffffb25d8dad3a58] do_trap at ffffffff83833205\n #5 [ffffb25d8dad3aa0]\
  \ do_invalid_op at ffffffff83833aa6\n #6 [ffffb25d8dad3ac0] invalid_op at ffffffff84200d18\n\
  \    [exception RIP: jbd2_journal_dirty_metadata+0x2ba]\n    RIP: ffffffffc09ca54a  RSP: ffffb25d8dad3b70\
  \  RFLAGS: 00010207\n    RAX: 0000000000000000  RBX: ffff9706eedc5248  RCX: 0000000000000000\n\
  \    RDX: 0000000000000001  RSI: ffff97337029ea28  RDI: ffff9706eedc5250\n    RBP: ffff9703c3520200\
  \   R8: 000000000f46b0b2   R9: 0000000000000000\n    R10: 0000000000000001  R11: 00000001000000fe\
  \  R12: ffff97337029ea28\n    R13: 0000000000000000  R14: ffff9703de59bf60  R15: ffff9706eedc5250\n\
  \    ORIG_RAX: ffffffffffffffff  CS: 0010  SS: 0018\n #7 [ffffb25d8dad3ba8] ocfs2_journal_dirty\
  \ at ffffffffc137fb95 [ocfs2]\n #8 [ffffb25d8dad3be8] __ocfs2_move_extent at ffffffffc139a950\
  \ [ocfs2]\n #9 [ffffb25d8dad3c80] ocfs2_defrag_extent at ffffffffc139b2d2 [ocfs2]\n\nAnalysis\n\
  \nThis bug has the same root cause of 'commit 7f27ec978b0e (\"ocfs2: call\nocfs2_journal_access_di()\
  \ before ocfs2_journal_dirty() in\nocfs2_write_end_nolock()\")'.  For this bug, jbd2_journal_restart()\
  \ is\ncalled by ocfs2_split_extent() during defragmenting.\n\nHow to fix\n\nFor ocfs2_split_extent()\
  \ can handle journal operations totally by itself. \nCaller doesn't need to call journal access/dirty\
  \ pair, and caller only\nneeds to call journal start/stop pair.  The fix method is to remove\n\
  journal access/dirty from __ocfs2_move_extent().\n\nThe discussion for this patch:\nhttps://oss.oracle.com/pipermail/ocfs2-devel/2023-February/000647.html"
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2023-53564
weaknesses:
  - CWE-617
references:
  - url: https://git.kernel.org/stable/c/2c559b3ba8e0b9e3c4bb08159a28ccadc698410f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/33665d1042666f2e5c736a3df1f453e31f030663
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/590507ebabd33cd93324c04f9a5538309a5ba934
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5f43d34a51ed30e6a60f7e59d224a63014fe2cd5
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/60eed1e3d45045623e46944ebc7c42c30a4350f0
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/669134a66d37258e1c4a5cfbd5b82f547ae30fca
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/7f3b1c28e2908755fb248d3ee8ff56826f2387db
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/8163ea90d89b7012dd1fa4b28edf5db0c641eca7
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-53564
    reference_type:
    reference_id: CVE-2023-53564
