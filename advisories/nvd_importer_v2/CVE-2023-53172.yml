advisory_id: CVE-2023-53172
datasource_id: nvd_importer_v2/CVE-2023-53172
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2023-53172
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  fsverity: reject FS_IOC_ENABLE_VERITY on mode 3 fds

  Commit 56124d6c87fd ("fsverity: support enabling with tree block size <
  PAGE_SIZE") changed FS_IOC_ENABLE_VERITY to use __kernel_read() to read
  the file's data, instead of direct pagecache accesses.

  An unintended consequence of this is that the
  'WARN_ON_ONCE(!(file->f_mode & FMODE_READ))' in __kernel_read() became
  reachable by fuzz tests.  This happens if FS_IOC_ENABLE_VERITY is called
  on a fd opened with access mode 3, which means "ioctl access only".

  Arguably, FS_IOC_ENABLE_VERITY should work on ioctl-only fds.  But
  ioctl-only fds are a weird Linux extension that is rarely used and that
  few people even know about.  (The documentation for FS_IOC_ENABLE_VERITY
  even specifically says it requires O_RDONLY.)  It's probably not
  worthwhile to make the ioctl internally open a new fd just to handle
  this case.  Thus, just reject the ioctl on such fds for now.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2023-53172
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/04839139213cf60d4c5fc792214a08830e294ff8
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/85c039cff3c359967cafe90443c02321e950b216
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.3:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.3:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-53172
    reference_type:
    reference_id: CVE-2023-53172
