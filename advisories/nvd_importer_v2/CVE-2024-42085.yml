advisory_id: CVE-2024-42085
datasource_id: nvd_importer_v2/CVE-2024-42085
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-42085
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  usb: dwc3: core: remove lock of otg mode during gadget suspend/resume to avoid deadlock

  When config CONFIG_USB_DWC3_DUAL_ROLE is selected, and trigger system
  to enter suspend status with below command:
  echo mem > /sys/power/state
  There will be a deadlock issue occurring. Detailed invoking path as
  below:
  dwc3_suspend_common()
      spin_lock_irqsave(&dwc->lock, flags);              <-- 1st
      dwc3_gadget_suspend(dwc);
          dwc3_gadget_soft_disconnect(dwc);
              spin_lock_irqsave(&dwc->lock, flags);      <-- 2nd
  This issue is exposed by commit c7ebd8149ee5 ("usb: dwc3: gadget: Fix
  NULL pointer dereference in dwc3_gadget_suspend") that removes the code
  of checking whether dwc->gadget_driver is NULL or not. It causes the
  following code is executed and deadlock occurs when trying to get the
  spinlock. In fact, the root cause is the commit 5265397f9442("usb: dwc3:
  Remove DWC3 locking during gadget suspend/resume") that forgot to remove
  the lock of otg mode. So, remove the redundant lock of otg mode during
  gadget suspend/resume.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-42085
weaknesses:
  - CWE-667
references:
  - url: https://git.kernel.org/stable/c/17e2956633ca560b95f1cbbb297cfc2adf650649
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/7026576e89094aa9a0062aa6d10cba18aa99944c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/7838de15bb700c2898a7d741db9b1f3cbc86c136
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/8731a0b180f6b5d52397c7aeea6eda9511a467a7
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d77e2b5104c51d3668b9717c825a4a06998efe63
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f1274cfab183e69a7c7bafffcb4f50703c876276
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/01/msg00001.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-42085
    reference_type:
    reference_id: CVE-2024-42085
