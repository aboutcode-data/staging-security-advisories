advisory_id: CVE-2022-49219
datasource_id: nvd_importer_v2/CVE-2022-49219
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2022-49219
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  vfio/pci: fix memory leak during D3hot to D0 transition

  If 'vfio_pci_core_device::needs_pm_restore' is set (PCI device does
  not have No_Soft_Reset bit set in its PMCSR config register), then
  the current PCI state will be saved locally in
  'vfio_pci_core_device::pm_save' during D0->D3hot transition and same
  will be restored back during D3hot->D0 transition.
  For saving the PCI state locally, pci_store_saved_state() is being
  used and the pci_load_and_free_saved_state() will free the allocated
  memory.

  But for reset related IOCTLs, vfio driver calls PCI reset-related
  API's which will internally change the PCI power state back to D0. So,
  when the guest resumes, then it will get the current state as D0 and it
  will skip the call to vfio_pci_set_power_state() for changing the
  power state to D0 explicitly. In this case, the memory pointed by
  'pm_save' will never be freed. In a malicious sequence, the state changing
  to D3hot followed by VFIO_DEVICE_RESET/VFIO_DEVICE_PCI_HOT_RESET can be
  run in a loop and it can cause an OOM situation.

  This patch frees the earlier allocated memory first before overwriting
  'pm_save' to prevent the mentioned memory leak.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-49219
weaknesses:
  - CWE-401
references:
  - url: https://git.kernel.org/stable/c/26ddd196e9eb264da8e1bdc4df8a94d62581c8b5
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/4319f17fb8264ba39352b611dfa913a4d8c1d1a0
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c8a1f8bd586ee31020614b8d48b702ece3e2ae44
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/da426ad86027b849b877d4628b277ffbbd2f5325
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/eadf88ecf6ac7d6a9f47a76c6055d9a1987a8991
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/05/msg00030.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-49219
    reference_type:
    reference_id: CVE-2022-49219
