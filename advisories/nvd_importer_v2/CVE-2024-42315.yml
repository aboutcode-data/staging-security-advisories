advisory_id: CVE-2024-42315
datasource_id: nvd_importer_v2/CVE-2024-42315
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-42315
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  exfat: fix potential deadlock on __exfat_get_dentry_set

  When accessing a file with more entries than ES_MAX_ENTRY_NUM, the bh-array
  is allocated in __exfat_get_entry_set. The problem is that the bh-array is
  allocated with GFP_KERNEL. It does not make sense. In the following cases,
  a deadlock for sbi->s_lock between the two processes may occur.

         CPU0                CPU1
         ----                ----
    kswapd
     balance_pgdat
      lock(fs_reclaim)
                        exfat_iterate
                         lock(&sbi->s_lock)
                         exfat_readdir
                          exfat_get_uniname_from_ext_entry
                           exfat_get_dentry_set
                            __exfat_get_dentry_set
                             kmalloc_array
                              ...
                              lock(fs_reclaim)
      ...
      evict
       exfat_evict_inode
        lock(&sbi->s_lock)

  To fix this, let's allocate bh-array with GFP_NOFS.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-42315
weaknesses:
  - CWE-667
references:
  - url: https://git.kernel.org/stable/c/1d1970493c289e3f44b9ec847ed26a5dbdf56a62
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/632fb232b6bbf8277edcbe9ecd4b4d98ecb122eb
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/89fc548767a2155231128cb98726d6d2ea1256c9
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a7ac198f8dba791e3144c4da48a5a9b95773ee4b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c052f775ee6ccacd3c97e4cf41a2a657e63d4259
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/cd1c7858641384191ff7033fb1fc65dfcd559c6f
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/03/msg00001.html
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/03/msg00002.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-42315
    reference_type:
    reference_id: CVE-2024-42315
