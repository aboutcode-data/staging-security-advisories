advisory_id: CVE-2022-49434
datasource_id: nvd_importer_v2/CVE-2022-49434
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2022-49434
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  PCI: Avoid pci_dev_lock() AB/BA deadlock with sriov_numvfs_store()

  The sysfs sriov_numvfs_store() path acquires the device lock before the
  config space access lock:

    sriov_numvfs_store
      device_lock                 # A (1) acquire device lock
      sriov_configure
        vfio_pci_sriov_configure  # (for example)
          vfio_pci_core_sriov_configure
            pci_disable_sriov
              sriov_disable
                pci_cfg_access_lock
                  pci_wait_cfg    # B (4) wait for dev->block_cfg_access == 0

  Previously, pci_dev_lock() acquired the config space access lock before the
  device lock:

    pci_dev_lock
      pci_cfg_access_lock
        dev->block_cfg_access = 1 # B (2) set dev->block_cfg_access = 1
      device_lock                 # A (3) wait for device lock

  Any path that uses pci_dev_lock(), e.g., pci_reset_function(), may
  deadlock with sriov_numvfs_store() if the operations occur in the sequence
  (1) (2) (3) (4).

  Avoid the deadlock by reversing the order in pci_dev_lock() so it acquires
  the device lock before the config space access lock, the same as the
  sriov_numvfs_store() path.

  [bhelgaas: combined and adapted commit log from Jay Zhou's independent
  subsequent posting:
  https://lore.kernel.org/r/20220404062539.1710-1-jianjay.zhou@huawei.com]
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-49434
weaknesses:
  - CWE-667
references:
  - url: https://git.kernel.org/stable/c/2cdd5284035322795b0964f899eefba254cfe483
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/59ea6b3ae51df7cd6bfd84c9c0030609b9315622
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a91ee0e9fca9d7501286cfbced9b30a33e52740a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/aed6d4d519210c28817948f34c53b6e058e0456c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c3c6dc1853b8bf3c718f96fd8480a6eb09ba4831
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c9a81f9ed6ae3554621d6a50220b1bc74b67d81e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ea047f51172aa68841adef7f52d375002438b8f0
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/eff3587b9c01439b738298475e555c028ac9f55e
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-49434
    reference_type:
    reference_id: CVE-2022-49434
