advisory_id: CVE-2022-50457
datasource_id: nvd_importer_v2/CVE-2022-50457
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2022-50457
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  mtd: core: Fix refcount error in del_mtd_device()

  del_mtd_device() will call of_node_put() to mtd_get_of_node(mtd), which
  is mtd->dev.of_node. However, memset(&mtd->dev, 0) is called before
  of_node_put(). As the result, of_node_put() won't do anything in
  del_mtd_device(), and causes the refcount leak.

  del_mtd_device()
      memset(&mtd->dev, 0, sizeof(mtd->dev) # clear mtd->dev
      of_node_put()
          mtd_get_of_node(mtd) # mtd->dev is cleared, can't locate of_node
                               # of_node_put(NULL) won't do anything

  Fix the error by caching the pointer of the device_node.

  OF: ERROR: memory leak, expected refcount 1 instead of 2,
  of_node_get()/of_node_put() unbalanced - destroy cset entry: attach
  overlay node /spi/spi-sram@0
  CPU: 3 PID: 275 Comm: python3 Tainted: G N 6.1.0-rc3+ #54
      0d8a1edddf51f172ff5226989a7565c6313b08e2
  Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS
  rel-1.15.0-0-g2dd4b9b3f840-prebuilt.qemu.org 04/01/2014
  Call Trace:
  <TASK>
      dump_stack_lvl+0x67/0x83
      kobject_get+0x155/0x160
      of_node_get+0x1f/0x30
      of_fwnode_get+0x43/0x70
      fwnode_handle_get+0x54/0x80
      fwnode_get_nth_parent+0xc9/0xe0
      fwnode_full_name_string+0x3f/0xa0
      device_node_string+0x30f/0x750
      pointer+0x598/0x7a0
      vsnprintf+0x62d/0x9b0
      ...
      cfs_overlay_release+0x30/0x90
      config_item_release+0xbe/0x1a0
      config_item_put+0x5e/0x80
      configfs_rmdir+0x3bd/0x540
      vfs_rmdir+0x18c/0x320
      do_rmdir+0x198/0x330
      __x64_sys_rmdir+0x2c/0x40
      do_syscall_64+0x37/0x90
      entry_SYSCALL_64_after_hwframe+0x63/0xcd

  [<miquel.raynal@bootlin.com>: Light reword of the commit log]
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-50457
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/56570bdad5e31c5c538cd6efff5c4510256e1bb4
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/616dc895d982026f41f500c88d1bfea004938cc8
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f6016557f1ef7735963bd8691592d2797bbf91d2
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-50457
    reference_type:
    reference_id: CVE-2022-50457
