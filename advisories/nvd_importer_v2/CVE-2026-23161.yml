advisory_id: CVE-2026-23161
datasource_id: nvd_importer_v2/CVE-2026-23161
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2026-23161
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  mm/shmem, swap: fix race of truncate and swap entry split

  The helper for shmem swap freeing is not handling the order of swap
  entries correctly.  It uses xa_cmpxchg_irq to erase the swap entry, but it
  gets the entry order before that using xa_get_order without lock
  protection, and it may get an outdated order value if the entry is split
  or changed in other ways after the xa_get_order and before the
  xa_cmpxchg_irq.

  And besides, the order could grow and be larger than expected, and cause
  truncation to erase data beyond the end border.  For example, if the
  target entry and following entries are swapped in or freed, then a large
  folio was added in place and swapped out, using the same entry, the
  xa_cmpxchg_irq will still succeed, it's very unlikely to happen though.

  To fix that, open code the Xarray cmpxchg and put the order retrieval and
  value checking in the same critical section.  Also, ensure the order won't
  exceed the end border, skip it if the entry goes across the border.

  Skipping large swap entries crosses the end border is safe here.  Shmem
  truncate iterates the range twice, in the first iteration,
  find_lock_entries already filtered such entries, and shmem will swapin the
  entries that cross the end border and partially truncate the folio (split
  the folio or at least zero part of it).  So in the second loop here, if we
  see a swap entry that crosses the end order, it must at least have its
  content erased already.

  I observed random swapoff hangs and kernel panics when stress testing
  ZSWAP with shmem.  After applying this patch, all problems are gone.
impacted_packages: []
severities: []
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/8a1968bd997f45a9b11aefeabdd1232e1b6c7184
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a99f9a4669a04662c8f9efe0e62cafc598153139
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b23bee8cdb7aabce5701a7f57414db5a354ae8ed
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2026-23161
    reference_type:
    reference_id: CVE-2026-23161
