advisory_id: CVE-2022-50552
datasource_id: nvd_importer_v2/CVE-2022-50552
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2022-50552
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  blk-mq: use quiesced elevator switch when reinitializing queues

  The hctx's run_work may be racing with the elevator switch when
  reinitializing hardware queues. The queue is merely frozen in this
  context, but that only prevents requests from allocating and doesn't
  stop the hctx work from running. The work may get an elevator pointer
  that's being torn down, and can result in use-after-free errors and
  kernel panics (example below). Use the quiesced elevator switch instead,
  and make the previous one static since it is now only used locally.

    nvme nvme0: resetting controller
    nvme nvme0: 32/0/0 default/read/poll queues
    BUG: kernel NULL pointer dereference, address: 0000000000000008
    #PF: supervisor read access in kernel mode
    #PF: error_code(0x0000) - not-present page
    PGD 80000020c8861067 P4D 80000020c8861067 PUD 250f8c8067 PMD 0
    Oops: 0000 [#1] SMP PTI
    Workqueue: kblockd blk_mq_run_work_fn
    RIP: 0010:kyber_has_work+0x29/0x70

  ...

    Call Trace:
     __blk_mq_do_dispatch_sched+0x83/0x2b0
     __blk_mq_sched_dispatch_requests+0x12e/0x170
     blk_mq_sched_dispatch_requests+0x30/0x60
     __blk_mq_run_hw_queue+0x2b/0x50
     process_one_work+0x1ef/0x380
     worker_thread+0x2d/0x3e0
impacted_packages: []
severities:
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-50552
weaknesses:
  - CWE-416
references:
  - url: https://git.kernel.org/stable/c/63a681bcc32a43528ce0f690569f7f48e59c3963
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/8237c01f1696bc53c470493bf1fe092a107648a6
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c478b3b2900f1834cf9eda5bfef0d5696099505d
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-50552
    reference_type:
    reference_id: CVE-2022-50552
