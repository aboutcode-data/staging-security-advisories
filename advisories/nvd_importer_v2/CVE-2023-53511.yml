advisory_id: CVE-2023-53511
datasource_id: nvd_importer_v2/CVE-2023-53511
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2023-53511
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  io_uring: fix fget leak when fs don't support nowait buffered read

  Heming reported a BUG when using io_uring doing link-cp on ocfs2. [1]

  Do the following steps can reproduce this BUG:
  mount -t ocfs2 /dev/vdc /mnt/ocfs2
  cp testfile /mnt/ocfs2/
  ./link-cp /mnt/ocfs2/testfile /mnt/ocfs2/testfile.1
  umount /mnt/ocfs2

  Then umount will fail, and it outputs:
  umount: /mnt/ocfs2: target is busy.

  While tracing umount, it blames mnt_get_count() not return as expected.
  Do a deep investigation for fget()/fput() on related code flow, I've
  finally found that fget() leaks since ocfs2 doesn't support nowait
  buffered read.

  io_issue_sqe
  |-io_assign_file  // do fget() first
    |-io_read
    |-io_iter_do_read
      |-ocfs2_file_read_iter  // return -EOPNOTSUPP
    |-kiocb_done
      |-io_rw_done
        |-__io_complete_rw_common  // set REQ_F_REISSUE
      |-io_resubmit_prep
        |-io_req_prep_async  // override req->file, leak happens

  This was introduced by commit a196c78b5443 in v5.18. Fix it by don't
  re-assign req->file if it has already been assigned.

  [1] https://lore.kernel.org/ocfs2-devel/ab580a75-91c8-d68a-3455-40361be1bfa8@linux.alibaba.com/T/#t
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2023-53511
weaknesses:
  - CWE-401
references:
  - url: https://git.kernel.org/stable/c/10fb2e16ee6ffaf1716b9e90d007e6b300bfa457
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/54aa7f2330b82884f4a1afce0220add6e8312f8b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/75a499fc9d66a32271e2b3e4ca71156e8ad3b484
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.18:-:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.18:-:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.18:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.18:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.18:rc7:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.18:rc7:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-53511
    reference_type:
    reference_id: CVE-2023-53511
