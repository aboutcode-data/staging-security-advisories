advisory_id: CVE-2025-38687
datasource_id: nvd_importer_v2/CVE-2025-38687
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-38687
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  comedi: fix race between polling and detaching

  syzbot reports a use-after-free in comedi in the below link, which is
  due to comedi gladly removing the allocated async area even though poll
  requests are still active on the wait_queue_head inside of it. This can
  cause a use-after-free when the poll entries are later triggered or
  removed, as the memory for the wait_queue_head has been freed.  We need
  to check there are no tasks queued on any of the subdevices' wait queues
  before allowing the device to be detached by the `COMEDI_DEVCONFIG`
  ioctl.

  Tasks will read-lock `dev->attach_lock` before adding themselves to the
  subdevice wait queue, so fix the problem in the `COMEDI_DEVCONFIG` ioctl
  handler by write-locking `dev->attach_lock` before checking that all of
  the subdevices are safe to be deleted.  This includes testing for any
  sleepers on the subdevices' wait queues.  It remains locked until the
  device has been detached.  This requires the `comedi_device_detach()`
  function to be refactored slightly, moving the bulk of it into new
  function `comedi_device_detach_locked()`.

  Note that the refactor of `comedi_device_detach()` results in
  `comedi_device_cancel_all()` now being called while `dev->attach_lock`
  is write-locked, which wasn't the case previously, but that does not
  matter.

  Thanks to Jens Axboe for diagnosing the problem and co-developing this
  patch.
impacted_packages: []
severities:
  - score: '4.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-38687
weaknesses:
  - CWE-362
references:
  - url: https://git.kernel.org/stable/c/017198079551a2a5cf61eae966af3c4b145e1f3b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/0f989f9d05492028afd2bded4b42023c57d8a76e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/35b6fc51c666fc96355be5cd633ed0fe4ccf68b2
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5724e82df4f9a4be62908362c97d522d25de75dd
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5c4a2ffcbd052c69bbf4680677d4c4eaa5a252d4
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/71ca60d2e631cf9c63bcbc7017961c61ff04e419
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/cd4286123d6948ff638ea9cd5818ae4796d5d252
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d85fac8729c9acfd72368faff1d576ec585e5c8f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/fe67122ba781df44a1a9716eb1dfd751321ab512
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/10/msg00007.html
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/10/msg00008.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:debian:debian_linux:11.0:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:debian:debian_linux:11.0:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-38687
    reference_type:
    reference_id: CVE-2025-38687
