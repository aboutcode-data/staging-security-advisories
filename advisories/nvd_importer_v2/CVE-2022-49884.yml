advisory_id: CVE-2022-49884
datasource_id: nvd_importer_v2/CVE-2022-49884
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2022-49884
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  KVM: Initialize gfn_to_pfn_cache locks in dedicated helper

  Move the gfn_to_pfn_cache lock initialization to another helper and
  call the new helper during VM/vCPU creation.  There are race
  conditions possible due to kvm_gfn_to_pfn_cache_init()'s
  ability to re-initialize the cache's locks.

  For example: a race between ioctl(KVM_XEN_HVM_EVTCHN_SEND) and
  kvm_gfn_to_pfn_cache_init() leads to a corrupted shinfo gpc lock.

                  (thread 1)                |           (thread 2)
                                            |
   kvm_xen_set_evtchn_fast                  |
    read_lock_irqsave(&gpc->lock, ...)      |
                                            | kvm_gfn_to_pfn_cache_init
                                            |  rwlock_init(&gpc->lock)
    read_unlock_irqrestore(&gpc->lock, ...) |

  Rename "cache_init" and "cache_destroy" to activate+deactivate to
  avoid implying that the cache really is destroyed/freed.

  Note, there more races in the newly named kvm_gpc_activate() that will
  be addressed separately.

  [sean: call out that this is a bug fix]
impacted_packages: []
severities:
  - score: '4.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-49884
weaknesses:
  - CWE-362
references:
  - url: https://git.kernel.org/stable/c/52491a38b2c2411f3f0229dc6ad610349c704a41
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/61242001d6c9c253df7645dab090842d8da08764
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.1:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.1:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.1:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.1:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.1:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.1:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-49884
    reference_type:
    reference_id: CVE-2022-49884
