advisory_id: CVE-2024-58099
datasource_id: nvd_importer_v2/CVE-2024-58099
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-58099
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  vmxnet3: Fix packet corruption in vmxnet3_xdp_xmit_frame

  Andrew and Nikolay reported connectivity issues with Cilium's service
  load-balancing in case of vmxnet3.

  If a BPF program for native XDP adds an encapsulation header such as
  IPIP and transmits the packet out the same interface, then in case
  of vmxnet3 a corrupted packet is being sent and subsequently dropped
  on the path.

  vmxnet3_xdp_xmit_frame() which is called e.g. via vmxnet3_run_xdp()
  through vmxnet3_xdp_xmit_back() calculates an incorrect DMA address:

    page = virt_to_page(xdpf->data);
    tbi->dma_addr = page_pool_get_dma_addr(page) +
                    VMXNET3_XDP_HEADROOM;
    dma_sync_single_for_device(&adapter->pdev->dev,
                               tbi->dma_addr, buf_size,
                               DMA_TO_DEVICE);

  The above assumes a fixed offset (VMXNET3_XDP_HEADROOM), but the XDP
  BPF program could have moved xdp->data. While the passed buf_size is
  correct (xdpf->len), the dma_addr needs to have a dynamic offset which
  can be calculated as xdpf->data - (void *)xdpf, that is, xdp->data -
  xdp->data_hard_start.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-58099
weaknesses:
  - CWE-787
references:
  - url: https://git.kernel.org/stable/c/4678adf94da4a9e9683817b246b58ce15fb81782
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/59ba6cdadb9c26b606a365eb9c9b25eb2052622d
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f82eb34fb59a8fb96c19f4f492c20eb774140bb5
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-58099
    reference_type:
    reference_id: CVE-2024-58099
