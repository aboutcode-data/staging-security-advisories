advisory_id: CVE-2021-41130
datasource_id: nvd_importer_v2/CVE-2021-41130
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2021-41130
aliases: []
summary: 'Extensible Service Proxy, a.k.a. ESP is a proxy which enables API management capabilities
  for JSON/REST or gRPC API services. ESPv1 can be configured to authenticate a JWT token. Its
  verified JWT claim is passed to the application by HTTP header "X-Endpoint-API-UserInfo",
  the application can use it to do authorization. But if there are two "X-Endpoint-API-UserInfo"
  headers from the client, ESPv1 only replaces the first one, the 2nd one will be passed to
  the application. An attacker can send two "X-Endpoint-API-UserInfo" headers, the second one
  with a fake JWT claim. Application may use the fake JWT claim to do the authorization. This
  impacts following ESPv1 usages: 1) Users have configured ESPv1 to do JWT authentication with
  Google ID Token as described in the referenced google endpoint document. 2) Users backend
  application is using the info in the "X-Endpoint-API-UserInfo" header to do the authorization.
  It has been fixed by v1.58.0. You need to patch it in the following ways: * If your docker
  image is using tag ":1", needs to re-start the container to pick up the new version. The tag
  ":1" will automatically point to the latest version. * If your docker image tag pings to a
  specific minor version, e.g. ":1.57". You need to update it to ":1.58" and re-start the container.
  There are no workaround for this issue.'
impacted_packages: []
severities:
  - score: '4.9'
    scoring_system: cvssv2
    scoring_elements: AV:N/AC:M/Au:S/C:P/I:P/A:N
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-41130
  - score: '5.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:N
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-41130
  - score: '6.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-41130
weaknesses:
  - CWE-290
references:
  - url: https://cloud.google.com/endpoints/docs/openapi/authenticating-users-google-id
    reference_type:
    reference_id:
  - url: https://github.com/cloudendpoints/esp/commit/e310c4f91d229a072507f80c73811489b4cdff27
    reference_type:
    reference_id:
  - url: https://github.com/cloudendpoints/esp/releases/tag/v1.58.0
    reference_type:
    reference_id:
  - url: https://github.com/cloudendpoints/esp/security/advisories/GHSA-43wx-8qmj-9r9q
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:a:google:extensible_service_proxy:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:a:google:extensible_service_proxy:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-41130
    reference_type:
    reference_id: CVE-2021-41130
