advisory_id: CVE-2021-47517
datasource_id: nvd_importer_v2/CVE-2021-47517
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2021-47517
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  ethtool: do not perform operations on net devices being unregistered

  There is a short period between a net device starts to be unregistered
  and when it is actually gone. In that time frame ethtool operations
  could still be performed, which might end up in unwanted or undefined
  behaviours[1].

  Do not allow ethtool operations after a net device starts its
  unregistration. This patch targets the netlink part as the ioctl one
  isn't affected: the reference to the net device is taken and the
  operation is executed within an rtnl lock section and the net device
  won't be found after unregister.

  [1] For example adding Tx queues after unregister ends up in NULL
      pointer exceptions and UaFs, such as:

        BUG: KASAN: use-after-free in kobject_get+0x14/0x90
        Read of size 1 at addr ffff88801961248c by task ethtool/755

        CPU: 0 PID: 755 Comm: ethtool Not tainted 5.15.0-rc6+ #778
        Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.14.0-4.fc34 04/014
        Call Trace:
         dump_stack_lvl+0x57/0x72
         print_address_description.constprop.0+0x1f/0x140
         kasan_report.cold+0x7f/0x11b
         kobject_get+0x14/0x90
         kobject_add_internal+0x3d1/0x450
         kobject_init_and_add+0xba/0xf0
         netdev_queue_update_kobjects+0xcf/0x200
         netif_set_real_num_tx_queues+0xb4/0x310
         veth_set_channels+0x1c3/0x550
         ethnl_set_channels+0x524/0x610
impacted_packages: []
severities:
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-47517
weaknesses:
  - CWE-416
references:
  - url: https://git.kernel.org/stable/c/7c26da3be1e9843a15b5318f90db8a564479d2ac
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/cfd719f04267108f5f5bf802b9d7de69e99a99f9
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/dde91ccfa25fd58f64c397d91b81a4b393100ffa
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.16:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.16:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.16:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.16:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.16:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.16:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.16:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.16:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-47517
    reference_type:
    reference_id: CVE-2021-47517
