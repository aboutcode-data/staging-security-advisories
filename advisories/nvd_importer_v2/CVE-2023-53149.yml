advisory_id: CVE-2023-53149
datasource_id: nvd_importer_v2/CVE-2023-53149
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2023-53149
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  ext4: avoid deadlock in fs reclaim with page writeback

  Ext4 has a filesystem wide lock protecting ext4_writepages() calls to
  avoid races with switching of journalled data flag or inode format. This
  lock can however cause a deadlock like:

  CPU0                            CPU1

  ext4_writepages()
    percpu_down_read(sbi->s_writepages_rwsem);
                                  ext4_change_inode_journal_flag()
                                    percpu_down_write(sbi->s_writepages_rwsem);
                                      - blocks, all readers block from now on
    ext4_do_writepages()
      ext4_init_io_end()
        kmem_cache_zalloc(io_end_cachep, GFP_KERNEL)
          fs_reclaim frees dentry...
            dentry_unlink_inode()
              iput() - last ref =>
                iput_final() - inode dirty =>
                  write_inode_now()...
                    ext4_writepages() tries to acquire sbi->s_writepages_rwsem
                      and blocks forever

  Make sure we cannot recurse into filesystem reclaim from writeback code
  to avoid the deadlock.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2023-53149
weaknesses:
  - CWE-667
references:
  - url: https://git.kernel.org/stable/c/00d873c17e29cc32d90ca852b82685f1673acaa5
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/2ec97dc90df40c50e509809dc9a198638a7e18b6
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/4b4340bf04ce9a52061f15000ecedd126abc093c
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.4:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.4:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-53149
    reference_type:
    reference_id: CVE-2023-53149
