advisory_id: CVE-2023-53660
datasource_id: nvd_importer_v2/CVE-2023-53660
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2023-53660
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  bpf, cpumap: Handle skb as well when clean up ptr_ring

  The following warning was reported when running xdp_redirect_cpu with
  both skb-mode and stress-mode enabled:

    ------------[ cut here ]------------
    Incorrect XDP memory type (-2128176192) usage
    WARNING: CPU: 7 PID: 1442 at net/core/xdp.c:405
    Modules linked in:
    CPU: 7 PID: 1442 Comm: kworker/7:0 Tainted: G  6.5.0-rc2+ #1
    Hardware name: QEMU Standard PC (i440FX + PIIX, 1996)
    Workqueue: events __cpu_map_entry_free
    RIP: 0010:__xdp_return+0x1e4/0x4a0
    ......
    Call Trace:
     <TASK>
     ? show_regs+0x65/0x70
     ? __warn+0xa5/0x240
     ? __xdp_return+0x1e4/0x4a0
     ......
     xdp_return_frame+0x4d/0x150
     __cpu_map_entry_free+0xf9/0x230
     process_one_work+0x6b0/0xb80
     worker_thread+0x96/0x720
     kthread+0x1a5/0x1f0
     ret_from_fork+0x3a/0x70
     ret_from_fork_asm+0x1b/0x30
     </TASK>

  The reason for the warning is twofold. One is due to the kthread
  cpu_map_kthread_run() is stopped prematurely. Another one is
  __cpu_map_ring_cleanup() doesn't handle skb mode and treats skbs in
  ptr_ring as XDP frames.

  Prematurely-stopped kthread will be fixed by the preceding patch and
  ptr_ring will be empty when __cpu_map_ring_cleanup() is called. But
  as the comments in __cpu_map_ring_cleanup() said, handling and freeing
  skbs in ptr_ring as well to "catch any broken behaviour gracefully".
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2023-53660
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/7c62b75cd1a792e14b037fa4f61f9b18914e7de1
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/937345720d18f1ad006ba3d5dcb3fa121037b8a2
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b58d34068fd9f96bfc7d389988dfaf9a92a8fe00
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/cbd000451885801e9bbfd9cf7a7946806a85cb5e
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.5:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.5:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.5:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.5:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.5:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.5:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.5:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.5:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-53660
    reference_type:
    reference_id: CVE-2023-53660
