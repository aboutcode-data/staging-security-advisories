advisory_id: CVE-2024-35852
datasource_id: nvd_importer_v2/CVE-2024-35852
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-35852
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  mlxsw: spectrum_acl_tcam: Fix memory leak when canceling rehash work

  The rehash delayed work is rescheduled with a delay if the number of
  credits at end of the work is not negative as supposedly it means that
  the migration ended. Otherwise, it is rescheduled immediately.

  After "mlxsw: spectrum_acl_tcam: Fix possible use-after-free during
  rehash" the above is no longer accurate as a non-negative number of
  credits is no longer indicative of the migration being done. It can also
  happen if the work encountered an error in which case the migration will
  resume the next time the work is scheduled.

  The significance of the above is that it is possible for the work to be
  pending and associated with hints that were allocated when the migration
  started. This leads to the hints being leaked [1] when the work is
  canceled while pending as part of ACL region dismantle.

  Fix by freeing the hints if hints are associated with a work that was
  canceled while pending.

  Blame the original commit since the reliance on not having a pending
  work associated with hints is fragile.

  [1]
  unreferenced object 0xffff88810e7c3000 (size 256):
    comm "kworker/0:16", pid 176, jiffies 4295460353
    hex dump (first 32 bytes):
      00 30 95 11 81 88 ff ff 61 00 00 00 00 00 00 80  .0......a.......
      00 00 61 00 40 00 00 00 00 00 00 00 04 00 00 00  ..a.@...........
    backtrace (crc 2544ddb9):
      [<00000000cf8cfab3>] kmalloc_trace+0x23f/0x2a0
      [<000000004d9a1ad9>] objagg_hints_get+0x42/0x390
      [<000000000b143cf3>] mlxsw_sp_acl_erp_rehash_hints_get+0xca/0x400
      [<0000000059bdb60a>] mlxsw_sp_acl_tcam_vregion_rehash_work+0x868/0x1160
      [<00000000e81fd734>] process_one_work+0x59c/0xf20
      [<00000000ceee9e81>] worker_thread+0x799/0x12c0
      [<00000000bda6fe39>] kthread+0x246/0x300
      [<0000000070056d23>] ret_from_fork+0x34/0x70
      [<00000000dea2b93e>] ret_from_fork_asm+0x1a/0x30
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-35852
weaknesses:
  - CWE-401
references:
  - url: https://git.kernel.org/stable/c/51cefc9da400b953fee749c9e5d26cd4a2b5d758
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5bfe7bf9656ed2633718388f12b7c38b86414a04
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/63d814d93c5cce4c18284adc810028f28dca493f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/857ed800133ffcfcee28582090b63b0cbb8ba59d
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d72dd6fcd7886d0523afbab8b4a4b22d17addd7d
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/de1aaefa75be9d0ec19c9a3e0e2f9696de20c6ab
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/fb4e2b70a7194b209fc7320bbf33b375f7114bd5
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2024/06/msg00017.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-35852
    reference_type:
    reference_id: CVE-2024-35852
