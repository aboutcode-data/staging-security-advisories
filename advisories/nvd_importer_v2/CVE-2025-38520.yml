advisory_id: CVE-2025-38520
datasource_id: nvd_importer_v2/CVE-2025-38520
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-38520
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  drm/amdkfd: Don't call mmput from MMU notifier callback

  If the process is exiting, the mmput inside mmu notifier callback from
  compactd or fork or numa balancing could release the last reference
  of mm struct to call exit_mmap and free_pgtable, this triggers deadlock
  with below backtrace.

  The deadlock will leak kfd process as mmu notifier release is not called
  and cause VRAM leaking.

  The fix is to take mm reference mmget_non_zero when adding prange to the
  deferred list to pair with mmput in deferred list work.

  If prange split and add into pchild list, the pchild work_item.mm is not
  used, so remove the mm parameter from svm_range_unmap_split and
  svm_range_add_child.

  The backtrace of hung task:

   INFO: task python:348105 blocked for more than 64512 seconds.
   Call Trace:
    __schedule+0x1c3/0x550
    schedule+0x46/0xb0
    rwsem_down_write_slowpath+0x24b/0x4c0
    unlink_anon_vmas+0xb1/0x1c0
    free_pgtables+0xa9/0x130
    exit_mmap+0xbc/0x1a0
    mmput+0x5a/0x140
    svm_range_cpu_invalidate_pagetables+0x2b/0x40 [amdgpu]
    mn_itree_invalidate+0x72/0xc0
    __mmu_notifier_invalidate_range_start+0x48/0x60
    try_to_unmap_one+0x10fa/0x1400
    rmap_walk_anon+0x196/0x460
    try_to_unmap+0xbb/0x210
    migrate_page_unmap+0x54d/0x7e0
    migrate_pages_batch+0x1c3/0xae0
    migrate_pages_sync+0x98/0x240
    migrate_pages+0x25c/0x520
    compact_zone+0x29d/0x590
    compact_zone_order+0xb6/0xf0
    try_to_compact_pages+0xbe/0x220
    __alloc_pages_direct_compact+0x96/0x1a0
    __alloc_pages_slowpath+0x410/0x930
    __alloc_pages_nodemask+0x3a9/0x3e0
    do_huge_pmd_anonymous_page+0xd7/0x3e0
    __handle_mm_fault+0x5e3/0x5f0
    handle_mm_fault+0xf7/0x2e0
    hmm_vma_fault.isra.0+0x4d/0xa0
    walk_pmd_range.isra.0+0xa8/0x310
    walk_pud_range+0x167/0x240
    walk_pgd_range+0x55/0x100
    __walk_page_range+0x87/0x90
    walk_page_range+0xf6/0x160
    hmm_range_fault+0x4f/0x90
    amdgpu_hmm_range_get_pages+0x123/0x230 [amdgpu]
    amdgpu_ttm_tt_get_user_pages+0xb1/0x150 [amdgpu]
    init_user_pages+0xb1/0x2a0 [amdgpu]
    amdgpu_amdkfd_gpuvm_alloc_memory_of_gpu+0x543/0x7d0 [amdgpu]
    kfd_ioctl_alloc_memory_of_gpu+0x24c/0x4e0 [amdgpu]
    kfd_ioctl+0x29d/0x500 [amdgpu]

  (cherry picked from commit a29e067bd38946f752b0ef855f3dfff87e77bec7)
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-38520
weaknesses:
  - CWE-667
references:
  - url: https://git.kernel.org/stable/c/145a56bd68f4bff098d59fbc7c263d20dfef4fc4
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a7eb0a25010a674c8fdfbece38353ef7be8c5834
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c1bde9d48e09933c361521720f77a8072083c83a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/cf234231fcbc7d391e2135b9518613218cc5347f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e90ee15ce28c61f6d83a0511c3e02e2662478350
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/10/msg00008.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:debian:debian_linux:11.0:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:debian:debian_linux:11.0:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.19:-:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.19:-:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.19:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.19:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.19:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.19:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.19:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.19:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.19:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.19:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.19:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.19:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.19:rc7:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.19:rc7:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.19:rc8:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.19:rc8:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-38520
    reference_type:
    reference_id: CVE-2025-38520
