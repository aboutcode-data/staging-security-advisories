advisory_id: CVE-2025-21807
datasource_id: nvd_importer_v2/CVE-2025-21807
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-21807
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  block: fix queue freeze vs limits lock order in sysfs store methods

  queue_attr_store() always freezes a device queue before calling the
  attribute store operation. For attributes that control queue limits, the
  store operation will also lock the queue limits with a call to
  queue_limits_start_update(). However, some drivers (e.g. SCSI sd) may
  need to issue commands to a device to obtain limit values from the
  hardware with the queue limits locked. This creates a potential ABBA
  deadlock situation if a user attempts to modify a limit (thus freezing
  the device queue) while the device driver starts a revalidation of the
  device queue limits.

  Avoid such deadlock by not freezing the queue before calling the
  ->store_limit() method in struct queue_sysfs_entry and instead use the
  queue_limits_commit_update_frozen helper to freeze the queue after taking
  the limits lock.

  This also removes taking the sysfs lock for the store_limit method as
  it doesn't protect anything here, but creates even more nesting.
  Hopefully it will go away from the actual sysfs methods entirely soon.

  (commit log adapted from a similar patch from  Damien Le Moal)
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-21807
weaknesses:
  - CWE-667
references:
  - url: https://git.kernel.org/stable/c/8985da5481562e96b95e94ed8e5cc9b6565eb82b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c99f66e4084a62a2cc401c4704a84328aeddc9ec
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-21807
    reference_type:
    reference_id: CVE-2025-21807
