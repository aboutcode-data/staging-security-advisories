advisory_id: CVE-2023-52978
datasource_id: nvd_importer_v2/CVE-2023-52978
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2023-52978
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  riscv: kprobe: Fixup kernel panic when probing an illegal position

  The kernel would panic when probed for an illegal position. eg:

  (CONFIG_RISCV_ISA_C=n)

  echo 'p:hello kernel_clone+0x16 a0=%a0' >> kprobe_events
  echo 1 > events/kprobes/hello/enable
  cat trace

  Kernel panic - not syncing: stack-protector: Kernel stack
  is corrupted in: __do_sys_newfstatat+0xb8/0xb8
  CPU: 0 PID: 111 Comm: sh Not tainted
  6.2.0-rc1-00027-g2d398fe49a4d #490
  Hardware name: riscv-virtio,qemu (DT)
  Call Trace:
  [<ffffffff80007268>] dump_backtrace+0x38/0x48
  [<ffffffff80c5e83c>] show_stack+0x50/0x68
  [<ffffffff80c6da28>] dump_stack_lvl+0x60/0x84
  [<ffffffff80c6da6c>] dump_stack+0x20/0x30
  [<ffffffff80c5ecf4>] panic+0x160/0x374
  [<ffffffff80c6db94>] generic_handle_arch_irq+0x0/0xa8
  [<ffffffff802deeb0>] sys_newstat+0x0/0x30
  [<ffffffff800158c0>] sys_clone+0x20/0x30
  [<ffffffff800039e8>] ret_from_syscall+0x0/0x4
  ---[ end Kernel panic - not syncing: stack-protector:
  Kernel stack is corrupted in: __do_sys_newfstatat+0xb8/0xb8 ]---

  That is because the kprobe's ebreak instruction broke the kernel's
  original code. The user should guarantee the correction of the probe
  position, but it couldn't make the kernel panic.

  This patch adds arch_check_kprobe in arch_prepare_kprobe to prevent an
  illegal position (Such as the middle of an instruction).
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2023-52978
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/04a73558209554da17f46490ec4faaaf1b2bab68
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/12316538b1d193064109ce1a28fc9bacd43950de
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/87f48c7ccc73afc78630530d9af51f458f58cab8
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.2:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.2:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.2:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.2:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.2:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.2:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.2:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.2:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.2:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.2:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.2:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.2:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-52978
    reference_type:
    reference_id: CVE-2023-52978
