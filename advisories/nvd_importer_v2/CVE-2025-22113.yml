advisory_id: CVE-2025-22113
datasource_id: nvd_importer_v2/CVE-2025-22113
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-22113
aliases: []
summary: "In the Linux kernel, the following vulnerability has been resolved:\n\next4: avoid\
  \ journaling sb update on error if journal is destroying\n\nPresently we always BUG_ON if\
  \ trying to start a transaction on a journal marked\nwith JBD2_UNMOUNT, since this should\
  \ never happen. However, while ltp running\nstress tests, it was observed that in case of\
  \ some error handling paths, it is\npossible for update_super_work to start a transaction\
  \ after the journal is\ndestroyed eg:\n\n(umount)\next4_kill_sb\n  kill_block_super\n    generic_shutdown_super\n\
  \      sync_filesystem /* commits all txns */\n      evict_inodes\n        /* might start\
  \ a new txn */\n      ext4_put_super\n\tflush_work(&sbi->s_sb_upd_work) /* flush the workqueue\
  \ */\n        jbd2_journal_destroy\n          journal_kill_thread\n            journal->j_flags\
  \ |= JBD2_UNMOUNT;\n          jbd2_journal_commit_transaction\n            jbd2_journal_get_descriptor_buffer\n\
  \              jbd2_journal_bmap\n                ext4_journal_bmap\n                  ext4_map_blocks\n\
  \                    ...\n                    ext4_inode_error\n                      ext4_handle_error\n\
  \                        schedule_work(&sbi->s_sb_upd_work)\n\n                          \
  \                     /* work queue kicks in */\n                                        \
  \       update_super_work\n                                                 jbd2_journal_start\n\
  \                                                   start_this_handle\n                  \
  \                                   BUG_ON(journal->j_flags &\n                          \
  \                                  JBD2_UNMOUNT)\n\nHence, introduce a new mount flag to indicate\
  \ journal is destroying and only do\na journaled (and deferred) update of sb if this flag\
  \ is not set. Otherwise, just\nfallback to an un-journaled commit.\n\nFurther, in the journal\
  \ destroy path, we have the following sequence:\n\n  1. Set mount flag indicating journal\
  \ is destroying\n  2. force a commit and wait for it\n  3. flush pending sb updates\n\nThis\
  \ sequence is important as it ensures that, after this point, there is no sb\nupdate that\
  \ might be journaled so it is safe to update the sb outside the\njournal. (To avoid race discussed\
  \ in 2d01ddc86606)\n\nAlso, we don't need a similar check in ext4_grp_locked_error since it\
  \ is only\ncalled from mballoc and AFAICT it would be always valid to schedule work here."
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-22113
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/ce2f26e73783b4a7c46a86e3af5b5c8de0971790
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/db05767b5bc307143d99fe2afd8c43af58d2ebef
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/eddca44ddf810e27f0c96913aa3cc92ebd679ddb
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.11:-:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.11:-:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.11:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.11:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.11:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.11:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.11:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.11:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.11:rc7:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.11:rc7:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-22113
    reference_type:
    reference_id: CVE-2025-22113
