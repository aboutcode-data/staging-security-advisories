advisory_id: CVE-2022-49371
datasource_id: nvd_importer_v2/CVE-2022-49371
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2022-49371
aliases: []
summary: "In the Linux kernel, the following vulnerability has been resolved:\n\ndriver core:\
  \ fix deadlock in __device_attach\n\nIn __device_attach function, The lock holding logic is\
  \ as follows:\n...\n__device_attach\ndevice_lock(dev)      // get lock dev\n  async_schedule_dev(__device_attach_async_helper,\
  \ dev); // func\n    async_schedule_node\n      async_schedule_node_domain(func)\n       \
  \ entry = kzalloc(sizeof(struct async_entry), GFP_ATOMIC);\n\t/* when fail or work limit,\
  \ sync to execute func, but\n\t   __device_attach_async_helper will get lock dev as\n\t  \
  \ well, which will lead to A-A deadlock.  */\n\tif (!entry || atomic_read(&entry_count) >\
  \ MAX_WORK) {\n\t  func;\n\telse\n\t  queue_work_node(node, system_unbound_wq, &entry->work)\n\
  \  device_unlock(dev)\n\nAs shown above, when it is allowed to do async probes, because of\n\
  out of memory or work limit, async work is not allowed, to do\nsync execute instead. it will\
  \ lead to A-A deadlock because of\n__device_attach_async_helper getting lock dev.\n\nTo fix\
  \ the deadlock, move the async_schedule_dev outside device_lock,\nas we can see, in async_schedule_node_domain,\
  \ the parameter of\nqueue_work_node is system_unbound_wq, so it can accept concurrent\noperations.\
  \ which will also not change the code logic, and will\nnot lead to deadlock."
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-49371
weaknesses:
  - CWE-667
references:
  - url: https://git.kernel.org/stable/c/34fdd9b7def9d2fcb71bb7b0bc4848dd7313767e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/36ee9ffca8ef56c302f2855c4a5fccf61c0c1ada
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/593b595332bd2d65e1a5c1ae7897996c157f5468
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b232b02bf3c205b13a26dcec08e53baddd8e59ed
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d53a227bfcd5160ce1b61d9954901968a20651e7
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/df6de52b80aa3b46f5ac804412355ffe2e1df93e
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-49371
    reference_type:
    reference_id: CVE-2022-49371
