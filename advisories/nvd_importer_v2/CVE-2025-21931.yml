advisory_id: CVE-2025-21931
datasource_id: nvd_importer_v2/CVE-2025-21931
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-21931
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  hwpoison, memory_hotplug: lock folio before unmap hwpoisoned folio

  Commit b15c87263a69 ("hwpoison, memory_hotplug: allow hwpoisoned pages to
  be offlined) add page poison checks in do_migrate_range in order to make
  offline hwpoisoned page possible by introducing isolate_lru_page and
  try_to_unmap for hwpoisoned page.  However folio lock must be held before
  calling try_to_unmap.  Add it to fix this problem.

  Warning will be produced if folio is not locked during unmap:

    ------------[ cut here ]------------
    kernel BUG at ./include/linux/swapops.h:400!
    Internal error: Oops - BUG: 00000000f2000800 [#1] PREEMPT SMP
    Modules linked in:
    CPU: 4 UID: 0 PID: 411 Comm: bash Tainted: G        W          6.13.0-rc1-00016-g3c434c7ee82a-dirty #41
    Tainted: [W]=WARN
    Hardware name: QEMU QEMU Virtual Machine, BIOS 0.0.0 02/06/2015
    pstate: 40400005 (nZcv daif +PAN -UAO -TCO -DIT -SSBS BTYPE=--)
    pc : try_to_unmap_one+0xb08/0xd3c
    lr : try_to_unmap_one+0x3dc/0xd3c
    Call trace:
     try_to_unmap_one+0xb08/0xd3c (P)
     try_to_unmap_one+0x3dc/0xd3c (L)
     rmap_walk_anon+0xdc/0x1f8
     rmap_walk+0x3c/0x58
     try_to_unmap+0x88/0x90
     unmap_poisoned_folio+0x30/0xa8
     do_migrate_range+0x4a0/0x568
     offline_pages+0x5a4/0x670
     memory_block_action+0x17c/0x374
     memory_subsys_offline+0x3c/0x78
     device_offline+0xa4/0xd0
     state_store+0x8c/0xf0
     dev_attr_store+0x18/0x2c
     sysfs_kf_write+0x44/0x54
     kernfs_fop_write_iter+0x118/0x1a8
     vfs_write+0x3a8/0x4bc
     ksys_write+0x6c/0xf8
     __arm64_sys_write+0x1c/0x28
     invoke_syscall+0x44/0x100
     el0_svc_common.constprop.0+0x40/0xe0
     do_el0_svc+0x1c/0x28
     el0_svc+0x30/0xd0
     el0t_64_sync_handler+0xc8/0xcc
     el0t_64_sync+0x198/0x19c
    Code: f9407be0 b5fff320 d4210000 17ffff97 (d4210000)
    ---[ end trace 0000000000000000 ]---
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-21931
weaknesses:
  - CWE-667
references:
  - url: https://git.kernel.org/stable/c/3926b572fd073491bde13ec42ee08ac1b337bf4d
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/576a2f4c437c19bec7d05d05b5990f178d2b0f40
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/629dfc6ba5431056701d4e44830f3409b989955a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/93df6da64b004f75d307ed08d3f0f1020280d339
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/af288a426c3e3552b62595c6138ec6371a17dbba
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/08/msg00010.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.14:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.14:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.14:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.14:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.14:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.14:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.14:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.14:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.14:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.14:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-21931
    reference_type:
    reference_id: CVE-2025-21931
