advisory_id: CVE-2021-21411
datasource_id: nvd_importer_v2/CVE-2021-21411
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2021-21411
aliases: []
summary: 'OAuth2-Proxy is an open source reverse proxy that provides authentication with Google,
  Github or other providers. The `--gitlab-group` flag for group-based authorization in the
  GitLab provider stopped working in the v7.0.0 release. Regardless of the flag settings, authorization
  wasn''t restricted. Additionally, any authenticated users had whichever groups were set in
  `--gitlab-group` added to the new `X-Forwarded-Groups` header to the upstream application.
  While adding GitLab project based authorization support in #630, a bug was introduced where
  the user session''s groups field was populated with the `--gitlab-group` config entries instead
  of pulling the individual user''s group membership from the GitLab Userinfo endpoint. When
  the session groups where compared against the allowed groups for authorization, they matched
  improperly (since both lists were populated with the same data) so authorization was allowed.
  This impacts GitLab Provider users who relies on group membership for authorization restrictions.
  Any authenticated users in your GitLab environment can access your applications regardless
  of `--gitlab-group` membership restrictions. This is patched in v7.1.0. There is no workaround
  for the Group membership bug. But `--gitlab-project` can be set to use Project membership
  as the authorization checks instead of groups; it is not broken.'
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv2
    scoring_elements: AV:N/AC:L/Au:S/C:P/I:P/A:N
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-21411
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:C/C:L/I:L/A:N
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-21411
weaknesses:
  - CWE-863
references:
  - url: https://docs.gitlab.com/ee/user/group/
    reference_type:
    reference_id:
  - url: https://github.com/oauth2-proxy/oauth2-proxy/commit/0279fa7dff1752f1710707dbd1ffac839de8bbfc
    reference_type:
    reference_id:
  - url: https://github.com/oauth2-proxy/oauth2-proxy/releases/tag/v7.1.0
    reference_type:
    reference_id:
  - url: https://github.com/oauth2-proxy/oauth2-proxy/security/advisories/GHSA-652x-m2gr-hppm
    reference_type:
    reference_id:
  - url: https://pkg.go.dev/github.com/oauth2-proxy/oauth2-proxy/v7
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:a:oauth2_proxy_project:oauth2_proxy:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:a:oauth2_proxy_project:oauth2_proxy:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-21411
    reference_type:
    reference_id: CVE-2021-21411
