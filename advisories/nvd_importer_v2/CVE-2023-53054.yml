advisory_id: CVE-2023-53054
datasource_id: nvd_importer_v2/CVE-2023-53054
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2023-53054
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  usb: dwc2: fix a devres leak in hw_enable upon suspend resume

  Each time the platform goes to low power, PM suspend / resume routines
  call: __dwc2_lowlevel_hw_enable -> devm_add_action_or_reset().
  This adds a new devres each time.
  This may also happen at runtime, as dwc2_lowlevel_hw_enable() can be
  called from udc_start().

  This can be seen with tracing:
  - echo 1 > /sys/kernel/debug/tracing/events/dev/devres_log/enable
  - go to low power
  - cat /sys/kernel/debug/tracing/trace

  A new "ADD" entry is found upon each low power cycle:
  ... devres_log: 49000000.usb-otg ADD 82a13bba devm_action_release (8 bytes)
  ... devres_log: 49000000.usb-otg ADD 49889daf devm_action_release (8 bytes)
  ...

  A second issue is addressed here:
  - regulator_bulk_enable() is called upon each PM cycle (suspend/resume).
  - regulator_bulk_disable() never gets called.

  So the reference count for these regulators constantly increase, by one
  upon each low power cycle, due to missing regulator_bulk_disable() call
  in __dwc2_lowlevel_hw_disable().

  The original fix that introduced the devm_add_action_or_reset() call,
  fixed an issue during probe, that happens due to other errors in
  dwc2_driver_probe() -> dwc2_core_reset(). Then the probe fails without
  disabling regulators, when dr_mode == USB_DR_MODE_PERIPHERAL.

  Rather fix the error path: disable all the low level hardware in the
  error path, by using the "hsotg->ll_hw_enabled" flag. Checking dr_mode
  has been introduced to avoid a dual call to dwc2_lowlevel_hw_disable().
  "ll_hw_enabled" should achieve the same (and is used currently in the
  remove() routine).
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2023-53054
weaknesses:
  - CWE-401
references:
  - url: https://git.kernel.org/stable/c/1f01027c51eb16145e8e07fafea3ca07ef102d06
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/6485fc381b6528b6f547ee1ff10bdbcbe31a6e4c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/cba76e1fb896b573f09f51aa299223276a77bc90
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f747313249b74f323ddf841a9c8db14d989f296a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ffb8ab6f87bd28d700ab5c20d9d3a7e75067630d
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.3:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.3:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.3:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.3:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.3:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.3:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-53054
    reference_type:
    reference_id: CVE-2023-53054
