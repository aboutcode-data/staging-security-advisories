advisory_id: CVE-2025-21654
datasource_id: nvd_importer_v2/CVE-2025-21654
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-21654
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  ovl: support encoding fid from inode with no alias

  Dmitry Safonov reported that a WARN_ON() assertion can be trigered by
  userspace when calling inotify_show_fdinfo() for an overlayfs watched
  inode, whose dentry aliases were discarded with drop_caches.

  The WARN_ON() assertion in inotify_show_fdinfo() was removed, because
  it is possible for encoding file handle to fail for other reason, but
  the impact of failing to encode an overlayfs file handle goes beyond
  this assertion.

  As shown in the LTP test case mentioned in the link below, failure to
  encode an overlayfs file handle from a non-aliased inode also leads to
  failure to report an fid with FAN_DELETE_SELF fanotify events.

  As Dmitry notes in his analyzis of the problem, ovl_encode_fh() fails
  if it cannot find an alias for the inode, but this failure can be fixed.
  ovl_encode_fh() seldom uses the alias and in the case of non-decodable
  file handles, as is often the case with fanotify fid info,
  ovl_encode_fh() never needs to use the alias to encode a file handle.

  Defer finding an alias until it is actually needed so ovl_encode_fh()
  will not fail in the common case of FAN_DELETE_SELF fanotify events.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-21654
weaknesses:
  - CWE-617
references:
  - url: https://git.kernel.org/stable/c/3c7c90274ae339e1ad443c9be1c67a20b80b9c76
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c45beebfde34aa71afbc48b2c54cdda623515037
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f0c0ac84de17c37e6e84da65fb920f91dada55ad
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.13:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.13:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.13:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.13:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.13:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.13:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.13:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.13:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.13:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.13:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.13:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.13:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-21654
    reference_type:
    reference_id: CVE-2025-21654
