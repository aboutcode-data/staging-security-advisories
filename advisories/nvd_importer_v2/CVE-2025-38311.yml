advisory_id: CVE-2025-38311
datasource_id: nvd_importer_v2/CVE-2025-38311
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-38311
aliases: []
summary: "In the Linux kernel, the following vulnerability has been resolved:\n\niavf: get rid\
  \ of the crit lock\n\nGet rid of the crit lock.\nThat frees us from the error prone logic\
  \ of try_locks.\n\nThanks to netdev_lock() by Jakub it is now easy, and in most cases we were\n\
  protected by it already - replace crit lock by netdev lock when it was not\nthe case.\n\n\
  Lockdep reports that we should cancel the work under crit_lock [splat1],\nand that was the\
  \ scheme we have mostly followed since [1] by Slawomir.\nBut when that is done we still got\
  \ into deadlocks [splat2]. So instead\nwe should look at the bigger problem, namely \"weird\
  \ locking/scheduling\"\nof the iavf. The first step to fix that is to remove the crit lock.\n\
  I will followup with a -next series that simplifies scheduling/tasks.\n\nCancel the work without\
  \ netdev lock (weird unlock+lock scheme),\nto fix the [splat2] (which would be totally ugly\
  \ if we would kept\nthe crit lock).\n\nExtend protected part of iavf_watchdog_task() to include\
  \ scheduling\nmore work.\n\nNote that the removed comment in iavf_reset_task() was misplaced,\n\
  it belonged to inside of the removed if condition, so it's gone now.\n\n[splat1] - w/o this\
  \ patch - The deadlock during VF removal:\n     WARNING: possible circular locking dependency\
  \ detected\n     sh/3825 is trying to acquire lock:\n      ((work_completion)(&(&adapter->watchdog_task)->work)){+.+.}-{0:0},\
  \ at: start_flush_work+0x1a1/0x470\n          but task is already holding lock:\n      (&adapter->crit_lock){+.+.}-{4:4},\
  \ at: iavf_remove+0xd1/0x690 [iavf]\n          which lock already depends on the new lock.\n\
  \n[splat2] - when cancelling work under crit lock, w/o this series,\n\t   see [2] for the\
  \ band aid attempt\n    WARNING: possible circular locking dependency detected\n    sh/3550\
  \ is trying to acquire lock:\n    ((wq_completion)iavf){+.+.}-{0:0}, at: touch_wq_lockdep_map+0x26/0x90\n\
  \        but task is already holding lock:\n    (&dev->lock){+.+.}-{4:4}, at: iavf_remove+0xa6/0x6e0\
  \ [iavf]\n        which lock already depends on the new lock.\n\n[1] fc2e6b3b132a (\"iavf:\
  \ Rework mutexes for better synchronisation\")\n[2] https://github.com/pkitszel/linux/commit/52dddbfc2bb60294083f5711a158a"
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-38311
weaknesses:
  - CWE-667
references:
  - url: https://git.kernel.org/stable/c/120f28a6f314fef7f282c99f196923fe44081cad
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/620ab4d6215de0b25227f9fff1a8c7fb66837cb8
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.5:-:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.5:-:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.5:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.5:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.5:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.5:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.5:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.5:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.5:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.5:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.5:rc7:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.5:rc7:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-38311
    reference_type:
    reference_id: CVE-2025-38311
