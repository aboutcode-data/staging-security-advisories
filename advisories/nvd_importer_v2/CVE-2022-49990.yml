advisory_id: CVE-2022-49990
datasource_id: nvd_importer_v2/CVE-2022-49990
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2022-49990
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  s390: fix double free of GS and RI CBs on fork() failure

  The pointers for guarded storage and runtime instrumentation control
  blocks are stored in the thread_struct of the associated task. These
  pointers are initially copied on fork() via arch_dup_task_struct()
  and then cleared via copy_thread() before fork() returns. If fork()
  happens to fail after the initial task dup and before copy_thread(),
  the newly allocated task and associated thread_struct memory are
  freed via free_task() -> arch_release_task_struct(). This results in
  a double free of the guarded storage and runtime info structs
  because the fields in the failed task still refer to memory
  associated with the source task.

  This problem can manifest as a BUG_ON() in set_freepointer() (with
  CONFIG_SLAB_FREELIST_HARDENED enabled) or KASAN splat (if enabled)
  when running trinity syscall fuzz tests on s390x. To avoid this
  problem, clear the associated pointer fields in
  arch_dup_task_struct() immediately after the new task is copied.
  Note that the RI flag is still cleared in copy_thread() because it
  resides in thread stack memory and that is where stack info is
  copied.
impacted_packages: []
severities:
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-49990
weaknesses:
  - CWE-415
references:
  - url: https://git.kernel.org/stable/c/13cccafe0edcd03bf1c841de8ab8a1c8e34f77d9
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/25a95303b9e513cd2978aacc385d06e6fec23d07
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/297ae7e87a87a001dd3dfeac1cb26a42fd929708
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/8195e065abf3df84eb0ad2987e76a40f21d1791c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/cacd522e6652fbc2dc0cc6ae11c4e30782fef14b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/fbdc482d43eda40a70de4b0155843d5472f6de62
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.0:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.0:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.0:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.0:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-49990
    reference_type:
    reference_id: CVE-2022-49990
