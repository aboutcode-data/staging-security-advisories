advisory_id: CVE-2025-38388
datasource_id: nvd_importer_v2/CVE-2025-38388
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-38388
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  firmware: arm_ffa: Replace mutex with rwlock to avoid sleep in atomic context

  The current use of a mutex to protect the notifier hashtable accesses
  can lead to issues in the atomic context. It results in the below
  kernel warnings:

    |  BUG: sleeping function called from invalid context at kernel/locking/mutex.c:258
    |  in_atomic(): 1, irqs_disabled(): 1, non_block: 0, pid: 9, name: kworker/0:0
    |  preempt_count: 1, expected: 0
    |  RCU nest depth: 0, expected: 0
    |  CPU: 0 UID: 0 PID: 9 Comm: kworker/0:0 Not tainted 6.14.0 #4
    |  Workqueue: ffa_pcpu_irq_notification notif_pcpu_irq_work_fn
    |  Call trace:
    |   show_stack+0x18/0x24 (C)
    |   dump_stack_lvl+0x78/0x90
    |   dump_stack+0x18/0x24
    |   __might_resched+0x114/0x170
    |   __might_sleep+0x48/0x98
    |   mutex_lock+0x24/0x80
    |   handle_notif_callbacks+0x54/0xe0
    |   notif_get_and_handle+0x40/0x88
    |   generic_exec_single+0x80/0xc0
    |   smp_call_function_single+0xfc/0x1a0
    |   notif_pcpu_irq_work_fn+0x2c/0x38
    |   process_one_work+0x14c/0x2b4
    |   worker_thread+0x2e4/0x3e0
    |   kthread+0x13c/0x210
    |   ret_from_fork+0x10/0x20

  To address this, replace the mutex with an rwlock to protect the notifier
  hashtable accesses. This ensures that read-side locking does not sleep and
  multiple readers can acquire the lock concurrently, avoiding unnecessary
  contention and potential deadlocks. Writer access remains exclusive,
  preserving correctness.

  This change resolves warnings from lockdep about potential sleep in
  atomic context.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-38388
weaknesses:
  - CWE-667
references:
  - url: https://git.kernel.org/stable/c/31405510a48dcf054abfa5b7b8d70ce1b27d1f13
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/8986f8f61b482c0e6efd28f0b2423d9640c20eb1
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9ca7a421229bbdfbe2e1e628cff5cfa782720a10
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.16:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.16:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-38388
    reference_type:
    reference_id: CVE-2025-38388
