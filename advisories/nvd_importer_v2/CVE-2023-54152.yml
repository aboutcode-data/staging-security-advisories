advisory_id: CVE-2023-54152
datasource_id: nvd_importer_v2/CVE-2023-54152
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2023-54152
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  can: j1939: prevent deadlock by moving j1939_sk_errqueue()

  This commit addresses a deadlock situation that can occur in certain
  scenarios, such as when running data TP/ETP transfer and subscribing to
  the error queue while receiving a net down event. The deadlock involves
  locks in the following order:

  3
    j1939_session_list_lock ->  active_session_list_lock
    j1939_session_activate
    ...
    j1939_sk_queue_activate_next -> sk_session_queue_lock
    ...
    j1939_xtp_rx_eoma_one

  2
    j1939_sk_queue_drop_all  ->  sk_session_queue_lock
    ...
    j1939_sk_netdev_event_netdown -> j1939_socks_lock
    j1939_netdev_notify

  1
    j1939_sk_errqueue -> j1939_socks_lock
    __j1939_session_cancel -> active_session_list_lock
    j1939_tp_rxtimer

         CPU0                    CPU1
         ----                    ----
    lock(&priv->active_session_list_lock);
                                 lock(&jsk->sk_session_queue_lock);
                                 lock(&priv->active_session_list_lock);
    lock(&priv->j1939_socks_lock);

  The solution implemented in this commit is to move the
  j1939_sk_errqueue() call out of the active_session_list_lock context,
  thus preventing the deadlock situation.
impacted_packages: []
severities: []
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/8a581b71cf686b4cd1a85c9c2dfc2fb88382c3b4
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ace6aa2ab5ba5869563ca689bbd912100514ae7b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d1366b283d94ac4537a4b3a1e8668da4df7ce7e9
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f09ce9d765de1f064ce3919f57c6beb061744784
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-54152
    reference_type:
    reference_id: CVE-2023-54152
