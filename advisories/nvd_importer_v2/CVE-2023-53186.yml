advisory_id: CVE-2023-53186
datasource_id: nvd_importer_v2/CVE-2023-53186
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2023-53186
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  skbuff: Fix a race between coalescing and releasing SKBs

  Commit 1effe8ca4e34 ("skbuff: fix coalescing for page_pool fragment
  recycling") allowed coalescing to proceed with non page pool page and page
  pool page when @from is cloned, i.e.

  to->pp_recycle    --> false
  from->pp_recycle  --> true
  skb_cloned(from)  --> true

  However, it actually requires skb_cloned(@from) to hold true until
  coalescing finishes in this situation. If the other cloned SKB is
  released while the merging is in process, from_shinfo->nr_frags will be
  set to 0 toward the end of the function, causing the increment of frag
  page _refcount to be unexpectedly skipped resulting in inconsistent
  reference counts. Later when SKB(@to) is released, it frees the page
  directly even though the page pool page is still in use, leading to
  use-after-free or double-free errors. So it should be prohibited.

  The double-free error message below prompted us to investigate:
  BUG: Bad page state in process swapper/1  pfn:0e0d1
  page:00000000c6548b28 refcount:-1 mapcount:0 mapping:0000000000000000
  index:0x2 pfn:0xe0d1
  flags: 0xfffffc0000000(node=0|zone=1|lastcpupid=0x1fffff)
  raw: 000fffffc0000000 0000000000000000 ffffffff00000101 0000000000000000
  raw: 0000000000000002 0000000000000000 ffffffffffffffff 0000000000000000
  page dumped because: nonzero _refcount

  CPU: 1 PID: 0 Comm: swapper/1 Tainted: G            E      6.2.0+
  Call Trace:
   <IRQ>
  dump_stack_lvl+0x32/0x50
  bad_page+0x69/0xf0
  free_pcp_prepare+0x260/0x2f0
  free_unref_page+0x20/0x1c0
  skb_release_data+0x10b/0x1a0
  napi_consume_skb+0x56/0x150
  net_rx_action+0xf0/0x350
  ? __napi_schedule+0x79/0x90
  __do_softirq+0xc8/0x2b1
  __irq_exit_rcu+0xb9/0xf0
  common_interrupt+0x82/0xa0
  </IRQ>
  <TASK>
  asm_common_interrupt+0x22/0x40
  RIP: 0010:default_idle+0xb/0x20
impacted_packages: []
severities:
  - score: '4.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2023-53186
weaknesses:
  - CWE-362
references:
  - url: https://git.kernel.org/stable/c/0646dc31ca886693274df5749cd0c8c1eaaeb5ca
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5f692c992a3bb9a8018e3488098b401a4229e7ec
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/71850b5af92da21b4862a9bc55bda61091247d00
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/906a6689bb0191ad2a44131a3377006aa098af59
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.3:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.3:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.3:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.3:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.3:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.3:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.3:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.3:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.3:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.3:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.3:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.3:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-53186
    reference_type:
    reference_id: CVE-2023-53186
