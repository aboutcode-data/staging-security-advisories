advisory_id: CVE-2025-40327
datasource_id: nvd_importer_v2/CVE-2025-40327
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-40327
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  perf/core: Fix system hang caused by cpu-clock usage

  cpu-clock usage by the async-profiler tool can trigger a system hang,
  which got bisected back to the following commit by Octavia Togami:

    18dbcbfabfff ("perf: Fix the POLL_HUP delivery breakage") causes this issue

  The root cause of the hang is that cpu-clock is a special type of SW
  event which relies on hrtimers. The __perf_event_overflow() callback
  is invoked from the hrtimer handler for cpu-clock events, and
  __perf_event_overflow() tries to call cpu_clock_event_stop()
  to stop the event, which calls htimer_cancel() to cancel the hrtimer.

  But that's a recursion into the hrtimer code from a hrtimer handler,
  which (unsurprisingly) deadlocks.

  To fix this bug, use hrtimer_try_to_cancel() instead, and set
  the PERF_HES_STOPPED flag, which causes perf_swevent_hrtimer()
  to stop the event once it sees the PERF_HES_STOPPED flag.

  [ mingo: Fixed the comments and improved the changelog. ]
impacted_packages: []
severities: []
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/6b8c512811644cf2f5eaf6f44e928683c54127f0
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/eb3182ef0405ff2f6668fd3e5ff9883f60ce8801
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-40327
    reference_type:
    reference_id: CVE-2025-40327
