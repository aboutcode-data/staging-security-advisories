advisory_id: CVE-2024-49985
datasource_id: nvd_importer_v2/CVE-2024-49985
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-49985
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  i2c: stm32f7: Do not prepare/unprepare clock during runtime suspend/resume

  In case there is any sort of clock controller attached to this I2C bus
  controller, for example Versaclock or even an AIC32x4 I2C codec, then
  an I2C transfer triggered from the clock controller clk_ops .prepare
  callback may trigger a deadlock on drivers/clk/clk.c prepare_lock mutex.

  This is because the clock controller first grabs the prepare_lock mutex
  and then performs the prepare operation, including its I2C access. The
  I2C access resumes this I2C bus controller via .runtime_resume callback,
  which calls clk_prepare_enable(), which attempts to grab the prepare_lock
  mutex again and deadlocks.

  Since the clock are already prepared since probe() and unprepared in
  remove(), use simple clk_enable()/clk_disable() calls to enable and
  disable the clock on runtime suspend and resume, to avoid hitting the
  prepare_lock mutex.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-49985
weaknesses:
  - CWE-667
references:
  - url: https://git.kernel.org/stable/c/048bbbdbf85e5e00258dfb12f5e368f908801d7b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/1883cad2cc629ded4a3556c0bbb8b42533ad8764
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/22a1f8a5b56ba93d3e8b7a1dafa24e01c8bb48ba
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/894cd5f5fd9061983445bbd1fa3d81be43095344
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9b8bc33ad64192f54142396470cc34ce539a8940
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c2024b1a583ab9176c797ea1e5f57baf8d5e2682
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d6f1250a4d5773f447740b9fe37b8692105796d4
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/fac3c9f7784e8184c0338e9f0877b81e55d3ef1c
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/01/msg00001.html
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/03/msg00002.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-49985
    reference_type:
    reference_id: CVE-2024-49985
