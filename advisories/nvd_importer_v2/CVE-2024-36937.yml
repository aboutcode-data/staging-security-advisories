advisory_id: CVE-2024-36937
datasource_id: nvd_importer_v2/CVE-2024-36937
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-36937
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  xdp: use flags field to disambiguate broadcast redirect

  When redirecting a packet using XDP, the bpf_redirect_map() helper will set
  up the redirect destination information in struct bpf_redirect_info (using
  the __bpf_xdp_redirect_map() helper function), and the xdp_do_redirect()
  function will read this information after the XDP program returns and pass
  the frame on to the right redirect destination.

  When using the BPF_F_BROADCAST flag to do multicast redirect to a whole
  map, __bpf_xdp_redirect_map() sets the 'map' pointer in struct
  bpf_redirect_info to point to the destination map to be broadcast. And
  xdp_do_redirect() reacts to the value of this map pointer to decide whether
  it's dealing with a broadcast or a single-value redirect. However, if the
  destination map is being destroyed before xdp_do_redirect() is called, the
  map pointer will be cleared out (by bpf_clear_redirect_map()) without
  waiting for any XDP programs to stop running. This causes xdp_do_redirect()
  to think that the redirect was to a single target, but the target pointer
  is also NULL (since broadcast redirects don't have a single target), so
  this causes a crash when a NULL pointer is passed to dev_map_enqueue().

  To fix this, change xdp_do_redirect() to react directly to the presence of
  the BPF_F_BROADCAST flag in the 'flags' value in struct bpf_redirect_info
  to disambiguate between a single-target and a broadcast redirect. And only
  read the 'map' pointer if the broadcast flag is set, aborting if that has
  been cleared out in the meantime. This prevents the crash, while keeping
  the atomic (cmpxchg-based) clearing of the map pointer itself, and without
  adding any more checks in the non-broadcast fast path.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-36937
weaknesses:
  - CWE-476
references:
  - url: https://git.kernel.org/stable/c/12481f30128fbebc2eeb55eb2d56390fdfa30c5e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/272bfb019f3cc018f654b992115774e77b4f3ffc
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5bcf0dcbf9066348058b88a510c57f70f384c92c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/6fd81f9d333e7b3532036577b1beb74ba1323553
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e22e25820fa04ea5eaac4ef7ee200e9923f466a4
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-36937
    reference_type:
    reference_id: CVE-2024-36937
