advisory_id: CVE-2026-23159
datasource_id: nvd_importer_v2/CVE-2026-23159
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2026-23159
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  perf: sched: Fix perf crash with new is_user_task() helper

  In order to do a user space stacktrace the current task needs to be a user
  task that has executed in user space. It use to be possible to test if a
  task is a user task or not by simply checking the task_struct mm field. If
  it was non NULL, it was a user task and if not it was a kernel task.

  But things have changed over time, and some kernel tasks now have their
  own mm field.

  An idea was made to instead test PF_KTHREAD and two functions were used to
  wrap this check in case it became more complex to test if a task was a
  user task or not[1]. But this was rejected and the C code simply checked
  the PF_KTHREAD directly.

  It was later found that not all kernel threads set PF_KTHREAD. The io-uring
  helpers instead set PF_USER_WORKER and this needed to be added as well.

  But checking the flags is still not enough. There's a very small window
  when a task exits that it frees its mm field and it is set back to NULL.
  If perf were to trigger at this moment, the flags test would say its a
  user space task but when perf would read the mm field it would crash with
  at NULL pointer dereference.

  Now there are flags that can be used to test if a task is exiting, but
  they are set in areas that perf may still want to profile the user space
  task (to see where it exited). The only real test is to check both the
  flags and the mm field.

  Instead of making this modification in every location, create a new
  is_user_task() helper function that does all the tests needed to know if
  it is safe to read the user space memory or not.

  [1] https://lore.kernel.org/all/20250425204120.639530125@goodmis.org/
impacted_packages: []
severities: []
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/5aac392fcd3d981d7997f1a0766829e1afdeac2e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/76ed27608f7dd235b727ebbb12163438c2fbb617
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a28fce0365e1cb9cb8c04c893b9334e5ca9d9f1c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d84a4836dc246b7dc244e46a08ff992956b68db0
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/detail/CVE-2026-23159
    reference_type:
    reference_id: CVE-2026-23159
