advisory_id: CVE-2025-39958
datasource_id: nvd_importer_v2/CVE-2025-39958
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-39958
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  iommu/s390: Make attach succeed when the device was surprise removed

  When a PCI device is removed with surprise hotplug, there may still be
  attempts to attach the device to the default domain as part of tear down
  via (__iommu_release_dma_ownership()), or because the removal happens
  during probe (__iommu_probe_device()). In both cases zpci_register_ioat()
  fails with a cc value indicating that the device handle is invalid. This
  is because the device is no longer part of the instance as far as the
  hypervisor is concerned.

  Currently this leads to an error return and s390_iommu_attach_device()
  fails. This triggers the WARN_ON() in __iommu_group_set_domain_nofail()
  because attaching to the default domain must never fail.

  With the device fenced by the hypervisor no DMAs to or from memory are
  possible and the IOMMU translations have no effect. Proceed as if the
  registration was successful and let the hotplug event handling clean up
  the device.

  This is similar to how devices in the error state are handled since
  commit 59bbf596791b ("iommu/s390: Make attach succeed even if the device
  is in error state") except that for removal the domain will not be
  registered later. This approach was also previously discussed at the
  link.

  Handle both cases, error state and removal, in a helper which checks if
  the error needs to be propagated or ignored. Avoid magic number
  condition codes by using the pre-existing, but never used, defines for
  PCI load/store condition codes and rename them to reflect that they
  apply to all PCI instructions.
impacted_packages: []
severities:
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-39958
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/359613f2fa009587154511e4842e8ab9532edd15
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9ffaf5229055fcfbb3b3d6f1c7e58d63715c3f73
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.17:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.17:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.17:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.17:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.17:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.17:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.17:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.17:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.17:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.17:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.17:rc6:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.17:rc6:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-39958
    reference_type:
    reference_id: CVE-2025-39958
