advisory_id: CVE-2021-32829
datasource_id: nvd_importer_v2/CVE-2021-32829
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2021-32829
aliases: []
summary: ZStack is open source IaaS(infrastructure as a service) software aiming to automate
  datacenters, managing resources of compute, storage, and networking all by APIs. Affected
  versions of ZStack REST API are vulnerable to post-authentication Remote Code Execution (RCE)
  via bypass of the Groovy shell sandbox. The REST API exposes the GET zstack/v1/batch-queries?script
  endpoint which is backed up by the BatchQueryAction class. Messages are represented by the
  APIBatchQueryMsg, dispatched to the QueryFacadeImpl facade and handled by the BatchQuery class.
  The HTTP request parameter script is mapped to the APIBatchQueryMsg.script property and evaluated
  as a Groovy script in BatchQuery.query the evaluation of the user-controlled Groovy script
  is sandboxed by SandboxTransformer which will apply the restrictions defined in the registered
  (sandbox.register()) GroovyInterceptor. Even though the sandbox heavily restricts the receiver
  types to a small set of allowed types, the sandbox is non effective at controlling any code
  placed in Java annotations and therefore vulnerable to meta-programming escapes. This issue
  leads to post-authenticated remote code execution. For more details see the referenced GHSL-2021-065.
  This issue is patched in versions 3.8.21, 3.10.8, and 4.1.0.
impacted_packages: []
severities:
  - score: '6.5'
    scoring_system: cvssv2
    scoring_elements: AV:N/AC:L/Au:S/C:P/I:P/A:P
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-32829
  - score: '9.6'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:N
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-32829
  - score: '9.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2021-32829
weaknesses:
  - CWE-863
  - CWE-94
references:
  - url: https://github.com/zstackio/zstack/security/advisories/GHSA-6xgq-7rqg-x3q5
    reference_type:
    reference_id:
  - url: https://securitylab.github.com/advisories/GHSL-2021-065-zstack/
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:a:zstack:rest_api:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:a:zstack:rest_api:*:*:*:*:*:*:*:*
  - url: https://blog.orange.tw/2019/02/abusing-meta-programming-for-unauthenticated-rce.html
    reference_type: exploit
    reference_id: CVE-2019-1003002;CVE-2019-1003001;CVE-2019-1003000
  - url: https://nvd.nist.gov/vuln/detail/CVE-2021-32829
    reference_type:
    reference_id: CVE-2021-32829
