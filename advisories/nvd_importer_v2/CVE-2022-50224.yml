advisory_id: CVE-2022-50224
datasource_id: nvd_importer_v2/CVE-2022-50224
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2022-50224
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  KVM: x86/mmu: Treat NX as a valid SPTE bit for NPT

  Treat the NX bit as valid when using NPT, as KVM will set the NX bit when
  the NX huge page mitigation is enabled (mindblowing) and trigger the WARN
  that fires on reserved SPTE bits being set.

  KVM has required NX support for SVM since commit b26a71a1a5b9 ("KVM: SVM:
  Refuse to load kvm_amd if NX support is not available") for exactly this
  reason, but apparently it never occurred to anyone to actually test NPT
  with the mitigation enabled.

    ------------[ cut here ]------------
    spte = 0x800000018a600ee7, level = 2, rsvd bits = 0x800f0000001fe000
    WARNING: CPU: 152 PID: 15966 at arch/x86/kvm/mmu/spte.c:215 make_spte+0x327/0x340 [kvm]
    Hardware name: Google, Inc. Arcadia_IT_80/Arcadia_IT_80, BIOS 10.48.0 01/27/2022
    RIP: 0010:make_spte+0x327/0x340 [kvm]
    Call Trace:
     <TASK>
     tdp_mmu_map_handle_target_level+0xc3/0x230 [kvm]
     kvm_tdp_mmu_map+0x343/0x3b0 [kvm]
     direct_page_fault+0x1ae/0x2a0 [kvm]
     kvm_tdp_page_fault+0x7d/0x90 [kvm]
     kvm_mmu_page_fault+0xfb/0x2e0 [kvm]
     npf_interception+0x55/0x90 [kvm_amd]
     svm_invoke_exit_handler+0x31/0xf0 [kvm_amd]
     svm_handle_exit+0xf6/0x1d0 [kvm_amd]
     vcpu_enter_guest+0xb6d/0xee0 [kvm]
     ? kvm_pmu_trigger_event+0x6d/0x230 [kvm]
     vcpu_run+0x65/0x2c0 [kvm]
     kvm_arch_vcpu_ioctl_run+0x355/0x610 [kvm]
     kvm_vcpu_ioctl+0x551/0x610 [kvm]
     __se_sys_ioctl+0x77/0xc0
     __x64_sys_ioctl+0x1d/0x20
     do_syscall_64+0x44/0xa0
     entry_SYSCALL_64_after_hwframe+0x46/0xb0
     </TASK>
    ---[ end trace 0000000000000000 ]---
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2022-50224
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/6271f2854b9233702e236e576b885a876dde4889
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/6c6ab524cfae0799e55c82b2c1d61f1af0156f8d
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.4:-:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.4:-:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:5.4:rc8:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:5.4:rc8:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2022-50224
    reference_type:
    reference_id: CVE-2022-50224
