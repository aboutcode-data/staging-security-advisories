advisory_id: CVE-2024-26924
datasource_id: nvd_importer_v2/CVE-2024-26924
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-26924
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  netfilter: nft_set_pipapo: do not free live element

  Pablo reports a crash with large batches of elements with a
  back-to-back add/remove pattern.  Quoting Pablo:

    add_elem("00000000") timeout 100 ms
    ...
    add_elem("0000000X") timeout 100 ms
    del_elem("0000000X") <---------------- delete one that was just added
    ...
    add_elem("00005000") timeout 100 ms

    1) nft_pipapo_remove() removes element 0000000X
    Then, KASAN shows a splat.

  Looking at the remove function there is a chance that we will drop a
  rule that maps to a non-deactivated element.

  Removal happens in two steps, first we do a lookup for key k and return the
  to-be-removed element and mark it as inactive in the next generation.
  Then, in a second step, the element gets removed from the set/map.

  The _remove function does not work correctly if we have more than one
  element that share the same key.

  This can happen if we insert an element into a set when the set already
  holds an element with same key, but the element mapping to the existing
  key has timed out or is not active in the next generation.

  In such case its possible that removal will unmap the wrong element.
  If this happens, we will leak the non-deactivated element, it becomes
  unreachable.

  The element that got deactivated (and will be freed later) will
  remain reachable in the set data structure, this can result in
  a crash when such an element is retrieved during lookup (stale
  pointer).

  Add a check that the fully matching key does in fact map to the element
  that we have marked as inactive in the deactivation step.
  If not, we need to continue searching.

  Add a bug/warn trap at the end of the function as well, the remove
  function must not ever be called with an invisible/unreachable/non-existent
  element.

  v2: avoid uneeded temporary variable (Stefano)
impacted_packages: []
severities:
  - score: '5.9'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-26924
weaknesses:
  - CWE-476
references:
  - url: https://git.kernel.org/stable/c/14b001ba221136c15f894577253e8db535b99487
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/3cfc9ec039af60dbd8965ae085b2c2ccdcfbe1cc
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/41d8fdf3afaff312e17466e4ab732937738d5644
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/7a1679e2d9bfa3b5f8755c2c7113e54b7d42bd46
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e3b887a9c11caf8357a821260e095f2a694a34f2
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ebf7c9746f073035ee26209e38c3a1170f7b349a
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2024/06/msg00017.html
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/4EZ6PJW7VOZ224TD7N4JZNU6KV32ZJ53/
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/DAMSOZXJEPUOXW33WZYWCVAY7Z5S7OOY/
    reference_type:
    reference_id:
  - url: https://lists.fedoraproject.org/archives/list/package-announce@lists.fedoraproject.org/message/GCBZZEC7L7KTWWAS2NLJK6SO3IZIL4WW/
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:debian:debian_linux:10.0:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:debian:debian_linux:10.0:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-26924
    reference_type:
    reference_id: CVE-2024-26924
