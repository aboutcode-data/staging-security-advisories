advisory_id: CVE-2025-39884
datasource_id: nvd_importer_v2/CVE-2025-39884
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2025-39884
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  btrfs: fix subvolume deletion lockup caused by inodes xarray race

  There is a race condition between inode eviction and inode caching that
  can cause a live struct btrfs_inode to be missing from the root->inodes
  xarray. Specifically, there is a window during evict() between the inode
  being unhashed and deleted from the xarray. If btrfs_iget() is called
  for the same inode in that window, it will be recreated and inserted
  into the xarray, but then eviction will delete the new entry, leaving
  nothing in the xarray:

  Thread 1                          Thread 2
  ---------------------------------------------------------------
  evict()
    remove_inode_hash()
                                    btrfs_iget_path()
                                      btrfs_iget_locked()
                                      btrfs_read_locked_inode()
                                        btrfs_add_inode_to_root()
    destroy_inode()
      btrfs_destroy_inode()
        btrfs_del_inode_from_root()
          __xa_erase

  In turn, this can cause issues for subvolume deletion. Specifically, if
  an inode is in this lost state, and all other inodes are evicted, then
  btrfs_del_inode_from_root() will call btrfs_add_dead_root() prematurely.
  If the lost inode has a delayed_node attached to it, then when
  btrfs_clean_one_deleted_snapshot() calls btrfs_kill_all_delayed_nodes(),
  it will loop forever because the delayed_nodes xarray will never become
  empty (unless memory pressure forces the inode out). We saw this
  manifest as soft lockups in production.

  Fix it by only deleting the xarray entry if it matches the given inode
  (using __xa_cmpxchg()).
impacted_packages: []
severities:
  - score: '4.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2025-39884
weaknesses:
  - CWE-667
references:
  - url: https://git.kernel.org/stable/c/9ba898c9fcbe6ebb88bcd4df8aab0f90090d202e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f1498abaf74f8d7b1e7001f16ed77818d8ae6a59
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f6a6c280059c4ddc23e12e3de1b01098e240036f
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.17:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.17:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.17:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.17:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.17:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.17:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.17:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.17:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.17:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.17:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2025-39884
    reference_type:
    reference_id: CVE-2025-39884
