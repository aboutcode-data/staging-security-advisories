advisory_id: CVE-2024-35917
datasource_id: nvd_importer_v2/CVE-2024-35917
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-35917
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  s390/bpf: Fix bpf_plt pointer arithmetic

  Kui-Feng Lee reported a crash on s390x triggered by the
  dummy_st_ops/dummy_init_ptr_arg test [1]:

    [<0000000000000002>] 0x2
    [<00000000009d5cde>] bpf_struct_ops_test_run+0x156/0x250
    [<000000000033145a>] __sys_bpf+0xa1a/0xd00
    [<00000000003319dc>] __s390x_sys_bpf+0x44/0x50
    [<0000000000c4382c>] __do_syscall+0x244/0x300
    [<0000000000c59a40>] system_call+0x70/0x98

  This is caused by GCC moving memcpy() after assignments in
  bpf_jit_plt(), resulting in NULL pointers being written instead of
  the return and the target addresses.

  Looking at the GCC internals, the reordering is allowed because the
  alias analysis thinks that the memcpy() destination and the assignments'
  left-hand-sides are based on different objects: new_plt and
  bpf_plt_ret/bpf_plt_target respectively, and therefore they cannot
  alias.

  This is in turn due to a violation of the C standard:

    When two pointers are subtracted, both shall point to elements of the
    same array object, or one past the last element of the array object
    ...

  From the C's perspective, bpf_plt_ret and bpf_plt are distinct objects
  and cannot be subtracted. In the practical terms, doing so confuses the
  GCC's alias analysis.

  The code was written this way in order to let the C side know a few
  offsets defined in the assembly. While nice, this is by no means
  necessary. Fix the noncompliance by hardcoding these offsets.

  [1] https://lore.kernel.org/bpf/c9923c1d-971d-4022-8dc8-1364e929d34c@gmail.com/
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-35917
weaknesses:
  - CWE-476
references:
  - url: https://git.kernel.org/stable/c/7ded842b356d151ece8ac4985940438e6d3998bb
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c3062bdb859b6e2567e7f5c8cde20c0250bb130f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d3d74e45a060d218fe4b0c9174f0a77517509d8e
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.9:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.9:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-35917
    reference_type:
    reference_id: CVE-2024-35917
