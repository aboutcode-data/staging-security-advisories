advisory_id: CVE-2024-50252
datasource_id: nvd_importer_v2/CVE-2024-50252
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2024-50252
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  mlxsw: spectrum_ipip: Fix memory leak when changing remote IPv6 address

  The device stores IPv6 addresses that are used for encapsulation in
  linear memory that is managed by the driver.

  Changing the remote address of an ip6gre net device never worked
  properly, but since cited commit the following reproducer [1] would
  result in a warning [2] and a memory leak [3]. The problem is that the
  new remote address is never added by the driver to its hash table (and
  therefore the device) and the old address is never removed from it.

  Fix by programming the new address when the configuration of the ip6gre
  net device changes and removing the old one. If the address did not
  change, then the above would result in increasing the reference count of
  the address and then decreasing it.

  [1]
   # ip link add name bla up type ip6gre local 2001:db8:1::1 remote 2001:db8:2::1 tos inherit ttl inherit
   # ip link set dev bla type ip6gre remote 2001:db8:3::1
   # ip link del dev bla
   # devlink dev reload pci/0000:01:00.0

  [2]
  WARNING: CPU: 0 PID: 1682 at drivers/net/ethernet/mellanox/mlxsw/spectrum.c:3002 mlxsw_sp_ipv6_addr_put+0x140/0x1d0
  Modules linked in:
  CPU: 0 UID: 0 PID: 1682 Comm: ip Not tainted 6.12.0-rc3-custom-g86b5b55bc835 #151
  Hardware name: Nvidia SN5600/VMOD0013, BIOS 5.13 05/31/2023
  RIP: 0010:mlxsw_sp_ipv6_addr_put+0x140/0x1d0
  [...]
  Call Trace:
   <TASK>
   mlxsw_sp_router_netdevice_event+0x55f/0x1240
   notifier_call_chain+0x5a/0xd0
   call_netdevice_notifiers_info+0x39/0x90
   unregister_netdevice_many_notify+0x63e/0x9d0
   rtnl_dellink+0x16b/0x3a0
   rtnetlink_rcv_msg+0x142/0x3f0
   netlink_rcv_skb+0x50/0x100
   netlink_unicast+0x242/0x390
   netlink_sendmsg+0x1de/0x420
   ____sys_sendmsg+0x2bd/0x320
   ___sys_sendmsg+0x9a/0xe0
   __sys_sendmsg+0x7a/0xd0
   do_syscall_64+0x9e/0x1a0
   entry_SYSCALL_64_after_hwframe+0x77/0x7f

  [3]
  unreferenced object 0xffff898081f597a0 (size 32):
    comm "ip", pid 1626, jiffies 4294719324
    hex dump (first 32 bytes):
      20 01 0d b8 00 02 00 00 00 00 00 00 00 00 00 01   ...............
      21 49 61 83 80 89 ff ff 00 00 00 00 01 00 00 00  !Ia.............
    backtrace (crc fd9be911):
      [<00000000df89c55d>] __kmalloc_cache_noprof+0x1da/0x260
      [<00000000ff2a1ddb>] mlxsw_sp_ipv6_addr_kvdl_index_get+0x281/0x340
      [<000000009ddd445d>] mlxsw_sp_router_netdevice_event+0x47b/0x1240
      [<00000000743e7757>] notifier_call_chain+0x5a/0xd0
      [<000000007c7b9e13>] call_netdevice_notifiers_info+0x39/0x90
      [<000000002509645d>] register_netdevice+0x5f7/0x7a0
      [<00000000c2e7d2a9>] ip6gre_newlink_common.isra.0+0x65/0x130
      [<0000000087cd6d8d>] ip6gre_newlink+0x72/0x120
      [<000000004df7c7cc>] rtnl_newlink+0x471/0xa20
      [<0000000057ed632a>] rtnetlink_rcv_msg+0x142/0x3f0
      [<0000000032e0d5b5>] netlink_rcv_skb+0x50/0x100
      [<00000000908bca63>] netlink_unicast+0x242/0x390
      [<00000000cdbe1c87>] netlink_sendmsg+0x1de/0x420
      [<0000000011db153e>] ____sys_sendmsg+0x2bd/0x320
      [<000000003b6d53eb>] ___sys_sendmsg+0x9a/0xe0
      [<00000000cae27c62>] __sys_sendmsg+0x7a/0xd0
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2024-50252
weaknesses:
  - CWE-401
references:
  - url: https://git.kernel.org/stable/c/12ae97c531fcd3bfd774d4dfeaeac23eafe24280
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/31384aa2ad05c29c7745000f321154f42de24d1a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c1bbdbe07f0bc3bc9f87efe4672d67208c6d6942
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d8f298eb6659eb6a38e26b79e77de4449dc6e61b
    reference_type:
    reference_id:
  - url: https://lists.debian.org/debian-lts-announce/2025/01/msg00001.html
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc3:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc3:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc4:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc4:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.12:rc5:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.12:rc5:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2024-50252
    reference_type:
    reference_id: CVE-2024-50252
