advisory_id: CVE-2023-53123
datasource_id: nvd_importer_v2/CVE-2023-53123
datasource_url: https://nvd.nist.gov/vuln/detail/CVE-2023-53123
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  PCI: s390: Fix use-after-free of PCI resources with per-function hotplug

  On s390 PCI functions may be hotplugged individually even when they
  belong to a multi-function device. In particular on an SR-IOV device VFs
  may be removed and later re-added.

  In commit a50297cf8235 ("s390/pci: separate zbus creation from
  scanning") it was missed however that struct pci_bus and struct
  zpci_bus's resource list retained a reference to the PCI functions MMIO
  resources even though those resources are released and freed on
  hot-unplug. These stale resources may subsequently be claimed when the
  PCI function re-appears resulting in use-after-free.

  One idea of fixing this use-after-free in s390 specific code that was
  investigated was to simply keep resources around from the moment a PCI
  function first appeared until the whole virtual PCI bus created for
  a multi-function device disappears. The problem with this however is
  that due to the requirement of artificial MMIO addreesses (address
  cookies) extra logic is then needed to keep the address cookies
  compatible on re-plug. At the same time the MMIO resources semantically
  belong to the PCI function so tying their lifecycle to the function
  seems more logical.

  Instead a simpler approach is to remove the resources of an individually
  hot-unplugged PCI function from the PCI bus's resource list while
  keeping the resources of other PCI functions on the PCI bus untouched.

  This is done by introducing pci_bus_remove_resource() to remove an
  individual resource. Similarly the resource also needs to be removed
  from the struct zpci_bus's resource list. It turns out however, that
  there is really no need to add the MMIO resources to the struct
  zpci_bus's resource list at all and instead we can simply use the
  zpci_bar_struct's resource pointer directly.
impacted_packages: []
severities:
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url: https://nvd.nist.gov/vuln/detail/CVE-2023-53123
weaknesses:
  - CWE-416
references:
  - url: https://git.kernel.org/stable/c/437bb839e36cc9f35adc6d2a2bf113b7a0fc9985
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a2410d0c3d2d714ed968a135dfcbed6aa3ff7027
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ab909509850b27fd39b8ba99e44cda39dbc3858c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b99ebf4b62774e690e73a551cf5fbf6f219bdd96
    reference_type:
    reference_id:
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:*:*:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.3:rc1:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.3:rc1:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/search/results?adv_search=true&isCpeNameSearch=true&query=cpe:2.3:o:linux:linux_kernel:6.3:rc2:*:*:*:*:*:*
    reference_type:
    reference_id: cpe:2.3:o:linux:linux_kernel:6.3:rc2:*:*:*:*:*:*
  - url: https://nvd.nist.gov/vuln/detail/CVE-2023-53123
    reference_type:
    reference_id: CVE-2023-53123
