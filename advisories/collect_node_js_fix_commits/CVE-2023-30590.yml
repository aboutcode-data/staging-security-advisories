advisory_id: CVE-2023-30590
datasource_id: collect_node_js_fix_commits/CVE-2023-30590
datasource_url: https://github.com/nodejs/node
aliases: []
summary: |
  4a82c8fda00b45663cf0f24bc3d6f369f4cc5215:doc,test: clarify behavior of DH generateKeys

  The DiffieHellman class is an old and thin wrapper around certain
  OpenSSL functions, many of which are deprecated in OpenSSL 3.0. Because
  the Node.js API mirrors the OpenSSL API, it adopts some of its
  peculiarities, but the Node.js documentation does not properly reflect
  these. Most importantly, despite the documentation saying otherwise,
  diffieHellman.generateKeys() does not generate a new private key when
  one has already been set or generated. Based on the documentation alone,
  users may be led to misuse the API in a way that results in key reuse,
  which can have drastic negative consequences for subsequent operations
  that consume the shared secret.

  These design issues in this old API have been around for many years, and
  we are not currently aware of any misuse in the ecosystem that falls
  into the above scenario. Changing the behavior of the API would be a
  significant breaking change and is thus not appropriate for a security
  release (nor is it a goal.) The reported issue is treated as CWE-1068
  (after a vast amount of uncertainty whether to treat it as a
  vulnerability at all), therefore, this change only updates the
  documentation to match the actual behavior. Tests are also added that
  demonstrate this particular oddity.

  Newer APIs exist that can be used for some, but not all, Diffie-Hellman
  operations (e.g., crypto.diffieHellman() that was added in 2020). We
  should keep modernizing crypto APIs, but that is a non-goal for this
  security release.

  The ECDH class mirrors the DiffieHellman class in many ways, but it does
  not appear to be affected by this particular peculiarity. In particular,
  ecdh.generateKeys() does appear to always generate a new private key.

  PR-URL: https://github.com/nodejs-private/node-private/pull/426
  Reviewed-By: Rafael Gonzaga <rafael.nunu@hotmail.com>
  Reviewed-By: Ben Noordhuis <info@bnoordhuis.nl>
  CVE-ID: CVE-2023-30590
  b607b74a4fb3640fc958cff1ff81ca7558134e9d:2023-06-20, Version 18.16.1 'Hydrogen' (LTS)

  This is a security release.

  Notable changes:

  Following CVEs are fixed in this release:

  * CVE-2023-30581: `mainModule.__proto__` Bypass Experimental Policy Mechanism (High)
  * CVE-2023-30585: Privilege escalation via Malicious Registry Key manipulation during Node.js installer repair process (Medium)
  * CVE-2023-30588: Process interuption due to invalid Public Key information in x509 certificates (Medium)
  * CVE-2023-30589: HTTP Request Smuggling via Empty headers separated by CR (Medium)
  * CVE-2023-30590: DiffieHellman does not generate keys after setting a private key (Medium)
  * OpenSSL Security Releases
    * https://www.openssl.org/news/secadv/20230328.txt
    * https://www.openssl.org/news/secadv/20230420.txt
    * https://www.openssl.org/news/secadv/20230530.txt
  * c-ares vulnerabilities:
    * GHSA-9g78-jv2r-p7vc
    * GHSA-8r8p-23f3-64c2
    * GHSA-54xr-f67r-4pc4
    * GHSA-x6mf-cxr9-8q6v

  PR-URL: https://github.com/nodejs-private/node-private/pull/434
  167dc77d85e97db5f8dcbcf110ade634944e02f9:2023-06-20, Version 20.3.1 (Current)

  This is a security release.

  Notable Changes

  The following CVEs are fixed in this release:
  * CVE-2023-30581: `mainModule.__proto__` Bypass Experimental Policy Mechanism (High)
  * CVE-2023-30584: Path Traversal Bypass in Experimental Permission Model (High)
  * CVE-2023-30587: Bypass of Experimental Permission Model via Node.js Inspector (High)
  * CVE-2023-30582: Inadequate Permission Model Allows Unauthorized File Watching (Medium)
  * CVE-2023-30583: Bypass of Experimental Permission Model via fs.openAsBlob() (Medium)
  * CVE-2023-30585: Privilege escalation via Malicious Registry Key manipulation during Node.js installer repair process (Medium)
  * CVE-2023-30586: Bypass of Experimental Permission Model via Arbitrary OpenSSL Engines (Medium)
  * CVE-2023-30588: Process interuption due to invalid Public Key information in x509 certificates (Medium)
  * CVE-2023-30589: HTTP Request Smuggling via Empty headers separated by CR (Medium)
  * CVE-2023-30590: DiffieHellman does not generate keys after setting a private key (Medium)

  * OpenSSL Security Releases
    * [OpenSSL security advisory 28th March](https://www.openssl.org/news/secadv/20230328.txt).
    * [OpenSSL security advisory 20th April](https://www.openssl.org/news/secadv/20230420.txt).
    * [OpenSSL security advisory 30th May](https://www.openssl.org/news/secadv/20230530.txt)

  PR-URL: https://github.com/nodejs-private/node-private/pull/435
  c09acb3ea82fab3553e40b68f923a9b9f00c8eba:2023-06-20, Version 16.20.1 'Gallium' (LTS)

  This is a security release.

  Notable changes:

  Following CVEs are fixed in this release:

  * CVE-2023-30581: `mainModule.__proto__` Bypass Experimental Policy Mechanism (High)
  * CVE-2023-30585: Privilege escalation via Malicious Registry Key manipulation during Node.js installer repair process (Medium)
  * CVE-2023-30588: Process interuption due to invalid Public Key information in x509 certificates (Medium)
  * CVE-2023-30589: HTTP Request Smuggling via Empty headers separated by CR (Medium)
  * CVE-2023-30590: DiffieHellman does not generate keys after setting a private key (Medium)
  * OpenSSL Security Releases
    * https://www.openssl.org/news/secadv/20230328.txt
    * https://www.openssl.org/news/secadv/20230420.txt
    * https://www.openssl.org/news/secadv/20230530.txt
  * c-ares vulnerabilities:
    * GHSA-9g78-jv2r-p7vc
    * GHSA-8r8p-23f3-64c2
    * GHSA-54xr-f67r-4pc4
    * GHSA-x6mf-cxr9-8q6v

  PR-URL: https://github.com/nodejs-private/node-private/pull/432
  9869bdc93d7bd8b439c4a2598607ee779483ee53:2023-06-20, Version 20.3.1 (Current)

  This is a security release.

  Notable Changes

  The following CVEs are fixed in this release:
  * CVE-2023-30581: `mainModule.__proto__` Bypass Experimental Policy Mechanism (High)
  * CVE-2023-30584: Path Traversal Bypass in Experimental Permission Model (High)
  * CVE-2023-30587: Bypass of Experimental Permission Model via Node.js Inspector (High)
  * CVE-2023-30582: Inadequate Permission Model Allows Unauthorized File Watching (Medium)
  * CVE-2023-30583: Bypass of Experimental Permission Model via fs.openAsBlob() (Medium)
  * CVE-2023-30585: Privilege escalation via Malicious Registry Key manipulation during Node.js installer repair process (Medium)
  * CVE-2023-30586: Bypass of Experimental Permission Model via Arbitrary OpenSSL Engines (Medium)
  * CVE-2023-30588: Process interuption due to invalid Public Key information in x509 certificates (Medium)
  * CVE-2023-30589: HTTP Request Smuggling via Empty headers separated by CR (Medium)
  * CVE-2023-30590: DiffieHellman does not generate keys after setting a private key (Medium)

  * OpenSSL Security Releases
    * [OpenSSL security advisory 28th March](https://www.openssl.org/news/secadv/20230328.txt).
    * [OpenSSL security advisory 20th April](https://www.openssl.org/news/secadv/20230420.txt).
    * [OpenSSL security advisory 30th May](https://www.openssl.org/news/secadv/20230530.txt)

  PR-URL: https://github.com/nodejs-private/node-private/pull/435
  8658efe376838821be7f9b4ff25c8bc2e229bb92:2023-06-20, Version 18.16.1 'Hydrogen' (LTS)

  This is a security release.

  Notable changes:

  Following CVEs are fixed in this release:

  * CVE-2023-30581: `mainModule.__proto__` Bypass Experimental Policy Mechanism (High)
  * CVE-2023-30585: Privilege escalation via Malicious Registry Key manipulation during Node.js installer repair process (Medium)
  * CVE-2023-30588: Process interuption due to invalid Public Key information in x509 certificates (Medium)
  * CVE-2023-30589: HTTP Request Smuggling via Empty headers separated by CR (Medium)
  * CVE-2023-30590: DiffieHellman does not generate keys after setting a private key (Medium)
  * OpenSSL Security Releases
    * https://www.openssl.org/news/secadv/20230328.txt
    * https://www.openssl.org/news/secadv/20230420.txt
    * https://www.openssl.org/news/secadv/20230530.txt
  * c-ares vulnerabilities:
    * GHSA-9g78-jv2r-p7vc
    * GHSA-8r8p-23f3-64c2
    * GHSA-54xr-f67r-4pc4
    * GHSA-x6mf-cxr9-8q6v

  PR-URL: https://github.com/nodejs-private/node-private/pull/434
  b53c51995380b1f8d642297d848cab6010d2909c:2023-06-20, Version 16.20.1 'Gallium' (LTS)

  This is a security release.

  Notable changes:

  Following CVEs are fixed in this release:

  * CVE-2023-30581: `mainModule.__proto__` Bypass Experimental Policy Mechanism (High)
  * CVE-2023-30585: Privilege escalation via Malicious Registry Key manipulation during Node.js installer repair process (Medium)
  * CVE-2023-30588: Process interuption due to invalid Public Key information in x509 certificates (Medium)
  * CVE-2023-30589: HTTP Request Smuggling via Empty headers separated by CR (Medium)
  * CVE-2023-30590: DiffieHellman does not generate keys after setting a private key (Medium)
  * OpenSSL Security Releases
    * https://www.openssl.org/news/secadv/20230328.txt
    * https://www.openssl.org/news/secadv/20230420.txt
    * https://www.openssl.org/news/secadv/20230530.txt
  * c-ares vulnerabilities:
    * GHSA-9g78-jv2r-p7vc
    * GHSA-8r8p-23f3-64c2
    * GHSA-54xr-f67r-4pc4
    * GHSA-x6mf-cxr9-8q6v

  PR-URL: https://github.com/nodejs-private/node-private/pull/432
  0459bf9c99df1011d35a1f600a8c95c07d41b1af:doc,test: clarify behavior of DH generateKeys

  The DiffieHellman class is an old and thin wrapper around certain
  OpenSSL functions, many of which are deprecated in OpenSSL 3.0. Because
  the Node.js API mirrors the OpenSSL API, it adopts some of its
  peculiarities, but the Node.js documentation does not properly reflect
  these. Most importantly, despite the documentation saying otherwise,
  diffieHellman.generateKeys() does not generate a new private key when
  one has already been set or generated. Based on the documentation alone,
  users may be led to misuse the API in a way that results in key reuse,
  which can have drastic negative consequences for subsequent operations
  that consume the shared secret.

  These design issues in this old API have been around for many years, and
  we are not currently aware of any misuse in the ecosystem that falls
  into the above scenario. Changing the behavior of the API would be a
  significant breaking change and is thus not appropriate for a security
  release (nor is it a goal.) The reported issue is treated as CWE-1068
  (after a vast amount of uncertainty whether to treat it as a
  vulnerability at all), therefore, this change only updates the
  documentation to match the actual behavior. Tests are also added that
  demonstrate this particular oddity.

  Newer APIs exist that can be used for some, but not all, Diffie-Hellman
  operations (e.g., crypto.diffieHellman() that was added in 2020). We
  should keep modernizing crypto APIs, but that is a non-goal for this
  security release.

  The ECDH class mirrors the DiffieHellman class in many ways, but it does
  not appear to be affected by this particular peculiarity. In particular,
  ecdh.generateKeys() does appear to always generate a new private key.

  PR-URL: https://github.com/nodejs-private/node-private/pull/426
  Reviewed-By: Rafael Gonzaga <rafael.nunu@hotmail.com>
  Reviewed-By: Ben Noordhuis <info@bnoordhuis.nl>
  CVE-ID: CVE-2023-30590
  1a5c9284ebce5cd71cf7a3c29759a748c373ac85:doc,test: clarify behavior of DH generateKeys

  The DiffieHellman class is an old and thin wrapper around certain
  OpenSSL functions, many of which are deprecated in OpenSSL 3.0. Because
  the Node.js API mirrors the OpenSSL API, it adopts some of its
  peculiarities, but the Node.js documentation does not properly reflect
  these. Most importantly, despite the documentation saying otherwise,
  diffieHellman.generateKeys() does not generate a new private key when
  one has already been set or generated. Based on the documentation alone,
  users may be led to misuse the API in a way that results in key reuse,
  which can have drastic negative consequences for subsequent operations
  that consume the shared secret.

  These design issues in this old API have been around for many years, and
  we are not currently aware of any misuse in the ecosystem that falls
  into the above scenario. Changing the behavior of the API would be a
  significant breaking change and is thus not appropriate for a security
  release (nor is it a goal.) The reported issue is treated as CWE-1068
  (after a vast amount of uncertainty whether to treat it as a
  vulnerability at all), therefore, this change only updates the
  documentation to match the actual behavior. Tests are also added that
  demonstrate this particular oddity.

  Newer APIs exist that can be used for some, but not all, Diffie-Hellman
  operations (e.g., crypto.diffieHellman() that was added in 2020). We
  should keep modernizing crypto APIs, but that is a non-goal for this
  security release.

  The ECDH class mirrors the DiffieHellman class in many ways, but it does
  not appear to be affected by this particular peculiarity. In particular,
  ecdh.generateKeys() does appear to always generate a new private key.

  PR-URL: https://github.com/nodejs-private/node-private/pull/426
  Reviewed-By: Rafael Gonzaga <rafael.nunu@hotmail.com>
  Reviewed-By: Ben Noordhuis <info@bnoordhuis.nl>
  CVE-ID: CVE-2023-30590
  7e3d2d85c2597739bcbd6bc7c03a25657a135b40:doc,test: clarify behavior of DH generateKeys

  The DiffieHellman class is an old and thin wrapper around certain
  OpenSSL functions, many of which are deprecated in OpenSSL 3.0. Because
  the Node.js API mirrors the OpenSSL API, it adopts some of its
  peculiarities, but the Node.js documentation does not properly reflect
  these. Most importantly, despite the documentation saying otherwise,
  diffieHellman.generateKeys() does not generate a new private key when
  one has already been set or generated. Based on the documentation alone,
  users may be led to misuse the API in a way that results in key reuse,
  which can have drastic negative consequences for subsequent operations
  that consume the shared secret.

  These design issues in this old API have been around for many years, and
  we are not currently aware of any misuse in the ecosystem that falls
  into the above scenario. Changing the behavior of the API would be a
  significant breaking change and is thus not appropriate for a security
  release (nor is it a goal.) The reported issue is treated as CWE-1068
  (after a vast amount of uncertainty whether to treat it as a
  vulnerability at all), therefore, this change only updates the
  documentation to match the actual behavior. Tests are also added that
  demonstrate this particular oddity.

  Newer APIs exist that can be used for some, but not all, Diffie-Hellman
  operations (e.g., crypto.diffieHellman() that was added in 2020). We
  should keep modernizing crypto APIs, but that is a non-goal for this
  security release.

  The ECDH class mirrors the DiffieHellman class in many ways, but it does
  not appear to be affected by this particular peculiarity. In particular,
  ecdh.generateKeys() does appear to always generate a new private key.

  PR-URL: https://github.com/nodejs-private/node-private/pull/426
  Reviewed-By: Rafael Gonzaga <rafael.nunu@hotmail.com>
  Reviewed-By: Ben Noordhuis <info@bnoordhuis.nl>
  CVE-ID: CVE-2023-30590
impacted_packages:
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: 167dc77d85e97db5f8dcbcf110ade634944e02f9
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: b607b74a4fb3640fc958cff1ff81ca7558134e9d
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: 0459bf9c99df1011d35a1f600a8c95c07d41b1af
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: 7e3d2d85c2597739bcbd6bc7c03a25657a135b40
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: c09acb3ea82fab3553e40b68f923a9b9f00c8eba
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: 8658efe376838821be7f9b4ff25c8bc2e229bb92
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: 1a5c9284ebce5cd71cf7a3c29759a748c373ac85
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: b53c51995380b1f8d642297d848cab6010d2909c
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: 9869bdc93d7bd8b439c4a2598607ee779483ee53
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: 4a82c8fda00b45663cf0f24bc3d6f369f4cc5215
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/nodejs/node/tree/0459bf9c99df1011d35a1f600a8c95c07d41b1af
    reference_type: commit
    reference_id: 0459bf9c99df1011d35a1f600a8c95c07d41b1af
  - url: https://github.com/nodejs/node/tree/167dc77d85e97db5f8dcbcf110ade634944e02f9
    reference_type: commit
    reference_id: 167dc77d85e97db5f8dcbcf110ade634944e02f9
  - url: https://github.com/nodejs/node/tree/1a5c9284ebce5cd71cf7a3c29759a748c373ac85
    reference_type: commit
    reference_id: 1a5c9284ebce5cd71cf7a3c29759a748c373ac85
  - url: https://github.com/nodejs/node/tree/4a82c8fda00b45663cf0f24bc3d6f369f4cc5215
    reference_type: commit
    reference_id: 4a82c8fda00b45663cf0f24bc3d6f369f4cc5215
  - url: https://github.com/nodejs/node/tree/7e3d2d85c2597739bcbd6bc7c03a25657a135b40
    reference_type: commit
    reference_id: 7e3d2d85c2597739bcbd6bc7c03a25657a135b40
  - url: https://github.com/nodejs/node/tree/8658efe376838821be7f9b4ff25c8bc2e229bb92
    reference_type: commit
    reference_id: 8658efe376838821be7f9b4ff25c8bc2e229bb92
  - url: https://github.com/nodejs/node/tree/9869bdc93d7bd8b439c4a2598607ee779483ee53
    reference_type: commit
    reference_id: 9869bdc93d7bd8b439c4a2598607ee779483ee53
  - url: https://github.com/nodejs/node/tree/b53c51995380b1f8d642297d848cab6010d2909c
    reference_type: commit
    reference_id: b53c51995380b1f8d642297d848cab6010d2909c
  - url: https://github.com/nodejs/node/tree/b607b74a4fb3640fc958cff1ff81ca7558134e9d
    reference_type: commit
    reference_id: b607b74a4fb3640fc958cff1ff81ca7558134e9d
  - url: https://github.com/nodejs/node/tree/c09acb3ea82fab3553e40b68f923a9b9f00c8eba
    reference_type: commit
    reference_id: c09acb3ea82fab3553e40b68f923a9b9f00c8eba
