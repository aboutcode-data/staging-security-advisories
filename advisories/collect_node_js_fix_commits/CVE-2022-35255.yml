advisory_id: CVE-2022-35255
datasource_id: collect_node_js_fix_commits/CVE-2022-35255
datasource_url: https://github.com/nodejs/node
aliases: []
summary: |
  a54283a638703fdc66163720806a26a9801bbf92:crypto: fix weak randomness in WebCrypto keygen

  Commit dae283d96f from August 2020 introduced a call to EntropySource()
  in SecretKeyGenTraits::DoKeyGen() in src/crypto/crypto_keygen.cc. There
  are two problems with that:

  1. It does not check the return value, it assumes EntropySource() always
     succeeds, but it can (and sometimes will) fail.

  2. The random data returned byEntropySource() may not be
     cryptographically strong and therefore not suitable as keying
     material.

  An example is a freshly booted system or a system without /dev/random or
  getrandom(2).

  EntropySource() calls out to openssl's RAND_poll() and RAND_bytes() in a
  best-effort attempt to obtain random data. OpenSSL has a built-in CSPRNG
  but that can fail to initialize, in which case it's possible either:

  1. No random data gets written to the output buffer, i.e., the output is
     unmodified, or

  2. Weak random data is written. It's theoretically possible for the
     output to be fully predictable because the CSPRNG starts from a
     predictable state.

  Replace EntropySource() and CheckEntropy() with new function CSPRNG()
  that enforces checking of the return value. Abort on startup when the
  entropy pool fails to initialize because that makes it too easy to
  compromise the security of the process.

  Refs: https://hackerone.com/bugs?report_id=1690000
  Refs: https://github.com/nodejs/node/pull/35093
  Backport-PR-URL: https://github.com/nodejs-private/node-private/pull/349
  PR-URL: https://github.com/nodejs-private/node-private/pull/346
  Reviewed-By: Vladimir de Turckheim <vlad2t@hotmail.com>
  Reviewed-By: Tobias Nießen <tniessen@tnie.de>
  CVE-ID: CVE-2022-35255
  0c2a5723beff39d1f62daec96b5389da3d427e79:crypto: fix weak randomness in WebCrypto keygen

  Commit dae283d96f from August 2020 introduced a call to EntropySource()
  in SecretKeyGenTraits::DoKeyGen() in src/crypto/crypto_keygen.cc. There
  are two problems with that:

  1. It does not check the return value, it assumes EntropySource() always
     succeeds, but it can (and sometimes will) fail.

  2. The random data returned byEntropySource() may not be
     cryptographically strong and therefore not suitable as keying
     material.

  An example is a freshly booted system or a system without /dev/random or
  getrandom(2).

  EntropySource() calls out to openssl's RAND_poll() and RAND_bytes() in a
  best-effort attempt to obtain random data. OpenSSL has a built-in CSPRNG
  but that can fail to initialize, in which case it's possible either:

  1. No random data gets written to the output buffer, i.e., the output is
     unmodified, or

  2. Weak random data is written. It's theoretically possible for the
     output to be fully predictable because the CSPRNG starts from a
     predictable state.

  Replace EntropySource() and CheckEntropy() with new function CSPRNG()
  that enforces checking of the return value. Abort on startup when the
  entropy pool fails to initialize because that makes it too easy to
  compromise the security of the process.

  Refs: https://hackerone.com/bugs?report_id=1690000
  Refs: https://github.com/nodejs/node/pull/35093

  Reviewed-By: Rafael Gonzaga <rafael.nunu@hotmail.com>
  Reviewed-By: Tobias Nießen <tniessen@tnie.de>
  PR-URL: #346
  Backport-PR-URL: #351
  CVE-ID: CVE-2022-35255
impacted_packages:
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: a54283a638703fdc66163720806a26a9801bbf92
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: 0c2a5723beff39d1f62daec96b5389da3d427e79
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/nodejs/node/tree/0c2a5723beff39d1f62daec96b5389da3d427e79
    reference_type: commit
    reference_id: 0c2a5723beff39d1f62daec96b5389da3d427e79
  - url: https://github.com/nodejs/node/tree/a54283a638703fdc66163720806a26a9801bbf92
    reference_type: commit
    reference_id: a54283a638703fdc66163720806a26a9801bbf92
