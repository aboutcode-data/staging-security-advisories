advisory_id: CVE-2023-30586
datasource_id: collect_node_js_fix_commits/CVE-2023-30586
datasource_url: https://github.com/nodejs/node
aliases: []
summary: |
  1b16ffa7e72fd7a04778094b6fc097eebe4a251b:crypto,https,tls: disable engines if perms enabled

  When the experimental permission model is enabled, the running
  JavaScript code is subject to certain restrictions, all of which can
  be bypassed or even disabled by native code due to the nature of the
  permission model implementation. That is why Node.js native addons
  are disabled by default when the permission model is enabled. However,
  the built-in crypto, https, and tls modules still allow loading
  custom OpenSSL engines. Because OpenSSL engines can execute arbitrary
  (native) code while being loaded by Node.js, this has the same security
  implications as allowing native addons. In other words, allowing user
  code to load OpenSSL engines at runtime effectively enables bypassing
  any supposed security restrictions.

  This patch adds appropriate checks before attempting to dynamically
  load an OpenSSL engine that throw an error if the permission model is
  enabled.

  PR-URL: https://github.com/nodejs-private/node-private/pull/409
  Reviewed-By: Rafael Gonzaga <rafael.nunu@hotmail.com>
  CVE-ID: CVE-2023-30586
  167dc77d85e97db5f8dcbcf110ade634944e02f9:2023-06-20, Version 20.3.1 (Current)

  This is a security release.

  Notable Changes

  The following CVEs are fixed in this release:
  * CVE-2023-30581: `mainModule.__proto__` Bypass Experimental Policy Mechanism (High)
  * CVE-2023-30584: Path Traversal Bypass in Experimental Permission Model (High)
  * CVE-2023-30587: Bypass of Experimental Permission Model via Node.js Inspector (High)
  * CVE-2023-30582: Inadequate Permission Model Allows Unauthorized File Watching (Medium)
  * CVE-2023-30583: Bypass of Experimental Permission Model via fs.openAsBlob() (Medium)
  * CVE-2023-30585: Privilege escalation via Malicious Registry Key manipulation during Node.js installer repair process (Medium)
  * CVE-2023-30586: Bypass of Experimental Permission Model via Arbitrary OpenSSL Engines (Medium)
  * CVE-2023-30588: Process interuption due to invalid Public Key information in x509 certificates (Medium)
  * CVE-2023-30589: HTTP Request Smuggling via Empty headers separated by CR (Medium)
  * CVE-2023-30590: DiffieHellman does not generate keys after setting a private key (Medium)

  * OpenSSL Security Releases
    * [OpenSSL security advisory 28th March](https://www.openssl.org/news/secadv/20230328.txt).
    * [OpenSSL security advisory 20th April](https://www.openssl.org/news/secadv/20230420.txt).
    * [OpenSSL security advisory 30th May](https://www.openssl.org/news/secadv/20230530.txt)

  PR-URL: https://github.com/nodejs-private/node-private/pull/435
  9869bdc93d7bd8b439c4a2598607ee779483ee53:2023-06-20, Version 20.3.1 (Current)

  This is a security release.

  Notable Changes

  The following CVEs are fixed in this release:
  * CVE-2023-30581: `mainModule.__proto__` Bypass Experimental Policy Mechanism (High)
  * CVE-2023-30584: Path Traversal Bypass in Experimental Permission Model (High)
  * CVE-2023-30587: Bypass of Experimental Permission Model via Node.js Inspector (High)
  * CVE-2023-30582: Inadequate Permission Model Allows Unauthorized File Watching (Medium)
  * CVE-2023-30583: Bypass of Experimental Permission Model via fs.openAsBlob() (Medium)
  * CVE-2023-30585: Privilege escalation via Malicious Registry Key manipulation during Node.js installer repair process (Medium)
  * CVE-2023-30586: Bypass of Experimental Permission Model via Arbitrary OpenSSL Engines (Medium)
  * CVE-2023-30588: Process interuption due to invalid Public Key information in x509 certificates (Medium)
  * CVE-2023-30589: HTTP Request Smuggling via Empty headers separated by CR (Medium)
  * CVE-2023-30590: DiffieHellman does not generate keys after setting a private key (Medium)

  * OpenSSL Security Releases
    * [OpenSSL security advisory 28th March](https://www.openssl.org/news/secadv/20230328.txt).
    * [OpenSSL security advisory 20th April](https://www.openssl.org/news/secadv/20230420.txt).
    * [OpenSSL security advisory 30th May](https://www.openssl.org/news/secadv/20230530.txt)

  PR-URL: https://github.com/nodejs-private/node-private/pull/435
  d274c3babce1e39ec5112166aa0197e37fd3d65c:crypto,https,tls: disable engines if perms enabled

  When the experimental permission model is enabled, the running
  JavaScript code is subject to certain restrictions, all of which can
  be bypassed or even disabled by native code due to the nature of the
  permission model implementation. That is why Node.js native addons
  are disabled by default when the permission model is enabled. However,
  the built-in crypto, https, and tls modules still allow loading
  custom OpenSSL engines. Because OpenSSL engines can execute arbitrary
  (native) code while being loaded by Node.js, this has the same security
  implications as allowing native addons. In other words, allowing user
  code to load OpenSSL engines at runtime effectively enables bypassing
  any supposed security restrictions.

  This patch adds appropriate checks before attempting to dynamically
  load an OpenSSL engine that throw an error if the permission model is
  enabled.

  PR-URL: https://github.com/nodejs-private/node-private/pull/409
  Reviewed-By: Rafael Gonzaga <rafael.nunu@hotmail.com>
  CVE-ID: CVE-2023-30586
impacted_packages:
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: d274c3babce1e39ec5112166aa0197e37fd3d65c
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: 9869bdc93d7bd8b439c4a2598607ee779483ee53
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: 1b16ffa7e72fd7a04778094b6fc097eebe4a251b
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: 167dc77d85e97db5f8dcbcf110ade634944e02f9
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/nodejs/node/tree/167dc77d85e97db5f8dcbcf110ade634944e02f9
    reference_type: commit
    reference_id: 167dc77d85e97db5f8dcbcf110ade634944e02f9
  - url: https://github.com/nodejs/node/tree/1b16ffa7e72fd7a04778094b6fc097eebe4a251b
    reference_type: commit
    reference_id: 1b16ffa7e72fd7a04778094b6fc097eebe4a251b
  - url: https://github.com/nodejs/node/tree/9869bdc93d7bd8b439c4a2598607ee779483ee53
    reference_type: commit
    reference_id: 9869bdc93d7bd8b439c4a2598607ee779483ee53
  - url: https://github.com/nodejs/node/tree/d274c3babce1e39ec5112166aa0197e37fd3d65c
    reference_type: commit
    reference_id: d274c3babce1e39ec5112166aa0197e37fd3d65c
