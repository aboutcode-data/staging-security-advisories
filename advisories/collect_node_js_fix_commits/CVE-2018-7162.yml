advisory_id: CVE-2018-7162
datasource_id: collect_node_js_fix_commits/CVE-2018-7162
datasource_url: https://github.com/nodejs/node
aliases: []
summary: |
  0cb3325f124805c0f8911627a38cfb34be35b675:tls: fix SSL write error handling

  Fix an use-after-free bug in the TLS implementation.

  If we return from `DoWrite()` with an early error, we should
  not be storing the `WriteWrap` object and complete it
  again at a later point, when it has already been freed
  (because of the write error).

  This issue was reported by Jordan Zebor at F5 Networks,
  who also helped with investigating this bug and coming
  up with a reproduction.

  This fixes CVE-2018-7162.

  Fixes: https://github.com/nodejs-private/security/issues/189
  PR-URL: https://github.com/nodejs-private/node-private/pull/127
  Reviewed-By: Evan Lucas <evanlucas@me.com>
  06cab45b2c2121af527b7e305f0176114da741d1:2018-06-12, Version 10.4.1 (Current)

  Notable changes:

  * **Fixes memory exhaustion DoS** (CVE-2018-7164): Fixes a bug introduced
      in 9.7.0 that increases the memory consumed when reading from the network
      into JavaScript using the net.Socket object directly as a stream.
  * **http2**
    * (CVE-2018-7161): Fixes Denial of Service vulnerability by updating the
      http2 implementation to not crash under certain circumstances during cleanup
    * (CVE-2018-1000168): Fixes Denial of Service vulnerability by upgrading
      nghttp2 to 1.32.0
  * **tls** (CVE-2018-7162): Fixes Denial of Service vulnerability by updating
      the TLS implementation to not crash upon receiving
  * **n-api**: Prevent use-after-free in napi_delete_async_work

  PR-URL: https://github.com/nodejs-private/node-private/pull/136
  0fb290a3472c92bff5635405e65432643bcca30e:2018-06-12, Version 9.11.2 (Maintenance)

  Notable changes:

  * **Fixes memory exhaustion DoS** (CVE-2018-7164): Fixes a bug introduced
      in 9.7.0 that increases the memory consumed when reading from the network
      into JavaScript using the net.Socket object directly as a stream.
  * **buffer** (CVE-2018-7167): Fixes Denial of Service vulnerability where
      calling Buffer.fill() could hang
  * **http2**
    * (CVE-2018-7161): Fixes Denial of Service vulnerability by updating the
      http2 implementation to not crash under certain circumstances during cleanup
    * (CVE-2018-1000168): Fixes Denial of Service vulnerability by upgrading
      nghttp2 to 1.32.0
  * **tls** (CVE-2018-7162): Fixes Denial of Service vulnerability by updating
      the TLS implementation to not crash upon receiving

  PR-URL: https://github.com/nodejs-private/node-private/pull/135
  b5339ff549fcd7ff7f228d00d0ff79b78a347dc6:2018-06-12, Version 9.11.2 (Maintenance)

  Notable changes:

  * **Fixes memory exhaustion DoS** (CVE-2018-7164): Fixes a bug introduced
      in 9.7.0 that increases the memory consumed when reading from the network
      into JavaScript using the net.Socket object directly as a stream.
  * **buffer** (CVE-2018-7167): Fixes Denial of Service vulnerability where
      calling Buffer.fill() could hang
  * **http2**
    * (CVE-2018-7161): Fixes Denial of Service vulnerability by updating the
      http2 implementation to not crash under certain circumstances during cleanup
    * (CVE-2018-1000168): Fixes Denial of Service vulnerability by upgrading
      nghttp2 to 1.32.0
  * **tls** (CVE-2018-7162): Fixes Denial of Service vulnerability by updating
      the TLS implementation to not crash upon receiving

  PR-URL: https://github.com/nodejs-private/node-private/pull/135
  84f23d2f12749a146155b52080594c2631836398:tls: fix SSL write error handling

  Fix an use-after-free bug in the TLS implementation.

  If we return from `DoWrite()` with an early error, we should
  not be storing the `WriteWrap` object and complete it
  again at a later point, when it has already been freed
  (because of the write error).

  This issue was reported by Jordan Zebor at F5 Networks,
  who also helped with investigating this bug and coming
  up with a reproduction.

  This fixes CVE-2018-7162.

  Fixes: https://github.com/nodejs-private/security/issues/189
  PR-URL: https://github.com/nodejs-private/node-private/pull/130
  Reviewed-By: Evan Lucas <evanlucas@me.com>
  1442cfef73c0a7157b1552658529ae9ff9154de9:2018-06-12, Version 10.4.1 (Current)

  Notable changes:

  * **Fixes memory exhaustion DoS** (CVE-2018-7164): Fixes a bug introduced
      in 9.7.0 that increases the memory consumed when reading from the network
      into JavaScript using the net.Socket object directly as a stream.
  * **http2**
    * (CVE-2018-7161): Fixes Denial of Service vulnerability by updating the
      http2 implementation to not crash under certain circumstances during cleanup
    * (CVE-2018-1000168): Fixes Denial of Service vulnerability by upgrading
      nghttp2 to 1.32.0
  * **tls** (CVE-2018-7162): Fixes Denial of Service vulnerability by updating
      the TLS implementation to not crash upon receiving
  * **n-api**: Prevent use-after-free in napi_delete_async_work

  PR-URL: https://github.com/nodejs-private/node-private/pull/136
  eea2bce58d02c3171e1e997a1081327c2a899983:tls: fix SSL write error handling

  Fix an use-after-free bug in the TLS implementation.

  If we return from `DoWrite()` with an early error, we should
  not be storing the `WriteWrap` object and complete it
  again at a later point, when it has already been freed
  (because of the write error).

  This issue was reported by Jordan Zebor at F5 Networks,
  who also helped with investigating this bug and coming
  up with a reproduction.

  This fixes CVE-2018-7162.

  Fixes: https://github.com/nodejs-private/security/issues/189
  PR-URL: https://github.com/nodejs-private/node-private/pull/127
  Reviewed-By: Evan Lucas <evanlucas@me.com>
  bc91220ca280c014d0cad61ab4a392cba62362b3:test: add tls write error regression test

  Add a mock TLS socket implementation and a regression test for
  the previous commit.

  This is to prevent v8.x from becoming susceptible to CVE-2018-7162.

  Refs: https://github.com/nodejs-private/security/issues/189
  PR-URL: https://github.com/nodejs-private/node-private/pull/131
  Reviewed-By: Anna Henningsen <anna@addaleax.net>
  Reviewed-By: Evan Lucas <evanlucas@me.com>
impacted_packages:
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: 1442cfef73c0a7157b1552658529ae9ff9154de9
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: 0cb3325f124805c0f8911627a38cfb34be35b675
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: 0fb290a3472c92bff5635405e65432643bcca30e
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: bc91220ca280c014d0cad61ab4a392cba62362b3
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: b5339ff549fcd7ff7f228d00d0ff79b78a347dc6
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: eea2bce58d02c3171e1e997a1081327c2a899983
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: 84f23d2f12749a146155b52080594c2631836398
    introduced_in_commits: []
  - purl: pkg:github/nodejs/node
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/nodejs/node
        commit: 06cab45b2c2121af527b7e305f0176114da741d1
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/nodejs/node/tree/06cab45b2c2121af527b7e305f0176114da741d1
    reference_type: commit
    reference_id: 06cab45b2c2121af527b7e305f0176114da741d1
  - url: https://github.com/nodejs/node/tree/0cb3325f124805c0f8911627a38cfb34be35b675
    reference_type: commit
    reference_id: 0cb3325f124805c0f8911627a38cfb34be35b675
  - url: https://github.com/nodejs/node/tree/0fb290a3472c92bff5635405e65432643bcca30e
    reference_type: commit
    reference_id: 0fb290a3472c92bff5635405e65432643bcca30e
  - url: https://github.com/nodejs/node/tree/1442cfef73c0a7157b1552658529ae9ff9154de9
    reference_type: commit
    reference_id: 1442cfef73c0a7157b1552658529ae9ff9154de9
  - url: https://github.com/nodejs/node/tree/84f23d2f12749a146155b52080594c2631836398
    reference_type: commit
    reference_id: 84f23d2f12749a146155b52080594c2631836398
  - url: https://github.com/nodejs/node/tree/b5339ff549fcd7ff7f228d00d0ff79b78a347dc6
    reference_type: commit
    reference_id: b5339ff549fcd7ff7f228d00d0ff79b78a347dc6
  - url: https://github.com/nodejs/node/tree/bc91220ca280c014d0cad61ab4a392cba62362b3
    reference_type: commit
    reference_id: bc91220ca280c014d0cad61ab4a392cba62362b3
  - url: https://github.com/nodejs/node/tree/eea2bce58d02c3171e1e997a1081327c2a899983
    reference_type: commit
    reference_id: eea2bce58d02c3171e1e997a1081327c2a899983
