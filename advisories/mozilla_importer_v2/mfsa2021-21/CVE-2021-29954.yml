advisory_id: mfsa2021-21/CVE-2021-29954
datasource_id: mozilla_importer_v2/mfsa2021-21/CVE-2021-29954
datasource_url: https://github.com/mozilla/foundation-security-advisories/blob/master/announce/2021/mfsa2021-21.yml
aliases:
  - CVE-2021-29954
summary: "The proxy functionality built into our Reticulum software package was overly permissive\
  \ allowing access to internal URLs, including the metadata service, which could allow access\
  \ to credentials specific to a Hubs Cloud Instance. Both existing and new Hubs Cloud instances\
  \ have since been patched.\n\nYou can determine if your Hubs Cloud stack was abused by inspecting\
  \ the HTTP access logs on the “app” EC2 instances associated with your Hubs Cloud stack. Check\
  \ the logs for the presence of “/meta-data/iam/security-credentials/” string in the URI path\
  \ which resulted in an HTTP 200 response.\n\nTo locate the running instances for your Hubs\
  \ Cloud instance:\n\n\nGo to AWS Marketplace (https://aws.amazon.com/marketplace) and log\
  \ into your AWS Marketplace Account\nIn the top right drop down under \"Hello, {username}\"\
  \ select \"Your Marketplace Software\"\nOn the \"Manage Subscriptions\" page under \"Your\
  \ subscriptions\" type \"Mozilla\" into the search box to pull up all\n        Mozilla products\
  \ you are subscribed to\n    \nSelect the \"Manage\" button on the subscription you want to\
  \ update\nOn the \"Manage Subscriptions\" page, select the \"Actions\" dropdown and then \"\
  Instances\" > \"View Instances\"\n    \nIn the \"View instances\" display window you'll see\
  \ region, instance ID, and status for all instances your Mozilla\n        subscription is\
  \ running\n    \n\n\nDetailed instructions for checking your logs:\n\n\nIn order to access\
  \ your EC2 instance using SSH, you’ll need to follow the instructions in the “Server Access”\n\
  \        section of your Hubs Cloud admin console. You will need the SSH key file that you\
  \ used when setting up your Hubs\n        Cloud stack.\n    \nRetrieve the server names for\
  \ the “app” EC2 instances under your Hubs Cloud stack. The easiest way to do this is\n   \
  \     to filter the list of EC2 instances in the AWS Console.\n      \nVisit the EC2 service\
  \ in the AWS Console. Make sure you are in the region associated with your Hubs Cloud\n  \
  \            stack.\n          \nIn the “Instances” panel, filter the instances using “polycosm-type:\
  \ app”\n\n\nSSH into the instances in that filtered list using your SSH key file, the EC2\
  \ instance name and your internal\n        domain name.\n      \n The SSH command will look\
  \ something like this: ssh -i key_file ubuntu@server_name.domainname\n\n\nOnce you’ve accessed\
  \ your EC2 instance, you can paste the following command into the terminal to determine if\n\
  \        the vulnerability was exploited.\n      \njournalctl | grep \"29954-no-results|$(journalctl\
  \ | grep -i meta-data/iam/security-credentials | grep -o 'request_id=[^ ]\\+' | tr '\\n' '|'\
  \ | sed 's/|$//g' | sed 's/|/\\\\|/g')\" | grep ' 200 in ' | wc -l\n\n\nIf the output of the\
  \ command above is a number other than zero (0), your stack was abused and you should contact\n\
  \        Mozilla at hubs-support@mozilla.com for help.\n    \nYou will have to do this for\
  \ each of the “app” EC2 instances, since they each have their own separate access\n      \
  \  log.\n    \n\n\n*Note: that web requests which contain the string “/meta-data/iam/security-credentials/”\
  \ and result in an HTTP\n    401 response are an example of patched behavior, and should be\
  \ treated as benign.*\n\nIf you find any examples of this vulnerability being abused or have\
  \ any questions, please contact Mozilla directly via\nhubs-support@mozilla.com\n\nProxy functionality\
  \ built into Hubs Cloud’s Reticulum software allowed access to internal URLs, including the\
  \ metadata service."
impacted_packages: []
severities:
  - score: critical
    scoring_system: generic_textual
    scoring_elements:
    published_at: None
    url: https://www.mozilla.org/en-US/security/advisories/mfsa2021-21
weaknesses: []
references:
  - url: https://www.mozilla.org/en-US/security/advisories/mfsa2021-21
    reference_type:
    reference_id:
