advisory_id: CVE-2010-1173
datasource_id: collect_linux_fix_commits/CVE-2010-1173
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: "2e3219b5c8a2e44e0b83ae6e04f52f20a82ac0f2:sctp: fix append error cause to ERROR chunk\
  \ correctly\n\ncommit 5fa782c2f5ef6c2e4f04d3e228412c9b4a4c8809\n  sctp: Fix skb_over_panic\
  \ resulting from multiple invalid \\\n    parameter errors (CVE-2010-1173) (v4)\n\ncause 'error\
  \ cause' never be add the the ERROR chunk due to\nsome typo when check valid length in sctp_init_cause_fixed().\n\
  \nSigned-off-by: Wei Yongjun <yjwei@cn.fujitsu.com>\nReviewed-by: Neil Horman <nhorman@tuxdriver.com>\n\
  Acked-by: Vlad Yasevich <vladislav.yasevich@hp.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>\n\
  7437e7d3672b6d23c08212c68752c9a9c25f8e9e:Merge git://git.kernel.org/pub/scm/linux/kernel/git/davem/net-2.6\n\
  \n* git://git.kernel.org/pub/scm/linux/kernel/git/davem/net-2.6:\n  FEC: Fix kernel panic\
  \ in fec_set_mac_address.\n  ipv6: Fix default multicast hops setting.\n  net: ep93xx_eth\
  \ stops receiving packets\n  drivers/net/phy: micrel phy driver\n  dm9601: fix phy/eeprom\
  \ write routine\n  ppp_generic: handle non-linear skbs when passing them to pppd\n  ppp_generic:\
  \ pull 2 bytes so that PPP_PROTO(skb) is valid\n  net: fix compile error due to double return\
  \ type in SOCK_DEBUG\n  net/usb: initiate sync sequence in sierra_net.c driver\n  net/usb:\
  \ remove default in Kconfig for sierra_net driver\n  r8169: Fix rtl8169_rx_interrupt()\n \
  \ e1000e: Fix oops caused by ASPM patch.\n  net/sb1250: register mdio bus in probe\n  sctp:\
  \ Fix skb_over_panic resulting from multiple invalid parameter errors (CVE-2010-1173) (v4)\n\
  \  p54pci: fix bugs in p54p_check_tx_ring\n5fa782c2f5ef6c2e4f04d3e228412c9b4a4c8809:sctp:\
  \ Fix skb_over_panic resulting from multiple invalid parameter errors (CVE-2010-1173) (v4)\n\
  \nOk, version 4\n\nChange Notes:\n1) Minor cleanups, from Vlads notes\n\nSummary:\n\nHey-\n\
  \tRecently, it was reported to me that the kernel could oops in the\nfollowing way:\n\n<5>\
  \ kernel BUG at net/core/skbuff.c:91!\n<5> invalid operand: 0000 [#1]\n<5> Modules linked\
  \ in: sctp netconsole nls_utf8 autofs4 sunrpc iptable_filter\nip_tables cpufreq_powersave\
  \ parport_pc lp parport vmblock(U) vsock(U) vmci(U)\nvmxnet(U) vmmemctl(U) vmhgfs(U) acpiphp\
  \ dm_mirror dm_mod button battery ac md5\nipv6 uhci_hcd ehci_hcd snd_ens1371 snd_rawmidi snd_seq_device\
  \ snd_pcm_oss\nsnd_mixer_oss snd_pcm snd_timer snd_page_alloc snd_ac97_codec snd soundcore\n\
  pcnet32 mii floppy ext3 jbd ata_piix libata mptscsih mptsas mptspi mptscsi\nmptbase sd_mod\
  \ scsi_mod\n<5> CPU:    0\n<5> EIP:    0060:[<c02bff27>]    Not tainted VLI\n<5> EFLAGS: 00010216\
  \   (2.6.9-89.0.25.EL)\n<5> EIP is at skb_over_panic+0x1f/0x2d\n<5> eax: 0000002c   ebx: c033f461\
  \   ecx: c0357d96   edx: c040fd44\n<5> esi: c033f461   edi: df653280   ebp: 00000000   esp:\
  \ c040fd40\n<5> ds: 007b   es: 007b   ss: 0068\n<5> Process swapper (pid: 0, threadinfo=c040f000\
  \ task=c0370be0)\n<5> Stack: c0357d96 e0c29478 00000084 00000004 c033f461 df653280 d7883180\n\
  e0c2947d\n<5>        00000000 00000080 df653490 00000004 de4f1ac0 de4f1ac0 00000004\ndf653490\n\
  <5>        00000001 e0c2877a 08000800 de4f1ac0 df653490 00000000 e0c29d2e\n00000004\n<5> Call\
  \ Trace:\n<5>  [<e0c29478>] sctp_addto_chunk+0xb0/0x128 [sctp]\n<5>  [<e0c2947d>] sctp_addto_chunk+0xb5/0x128\
  \ [sctp]\n<5>  [<e0c2877a>] sctp_init_cause+0x3f/0x47 [sctp]\n<5>  [<e0c29d2e>] sctp_process_unk_param+0xac/0xb8\
  \ [sctp]\n<5>  [<e0c29e90>] sctp_verify_init+0xcc/0x134 [sctp]\n<5>  [<e0c20322>] sctp_sf_do_5_1B_init+0x83/0x28e\
  \ [sctp]\n<5>  [<e0c25333>] sctp_do_sm+0x41/0x77 [sctp]\n<5>  [<c01555a4>] cache_grow+0x140/0x233\n\
  <5>  [<e0c26ba1>] sctp_endpoint_bh_rcv+0xc5/0x108 [sctp]\n<5>  [<e0c2b863>] sctp_inq_push+0xe/0x10\
  \ [sctp]\n<5>  [<e0c34600>] sctp_rcv+0x454/0x509 [sctp]\n<5>  [<e084e017>] ipt_hook+0x17/0x1c\
  \ [iptable_filter]\n<5>  [<c02d005e>] nf_iterate+0x40/0x81\n<5>  [<c02e0bb9>] ip_local_deliver_finish+0x0/0x151\n\
  <5>  [<c02e0c7f>] ip_local_deliver_finish+0xc6/0x151\n<5>  [<c02d0362>] nf_hook_slow+0x83/0xb5\n\
  <5>  [<c02e0bb2>] ip_local_deliver+0x1a2/0x1a9\n<5>  [<c02e0bb9>] ip_local_deliver_finish+0x0/0x151\n\
  <5>  [<c02e103e>] ip_rcv+0x334/0x3b4\n<5>  [<c02c66fd>] netif_receive_skb+0x320/0x35b\n<5>\
  \  [<e0a0928b>] init_stall_timer+0x67/0x6a [uhci_hcd]\n<5>  [<c02c67a4>] process_backlog+0x6c/0xd9\n\
  <5>  [<c02c690f>] net_rx_action+0xfe/0x1f8\n<5>  [<c012a7b1>] __do_softirq+0x35/0x79\n<5>\
  \  [<c0107efb>] handle_IRQ_event+0x0/0x4f\n<5>  [<c01094de>] do_softirq+0x46/0x4d\n\nIts an\
  \ skb_over_panic BUG halt that results from processing an init chunk in\nwhich too many of\
  \ its variable length parameters are in some way malformed.\n\nThe problem is in sctp_process_unk_param:\n\
  if (NULL == *errp)\n\t*errp = sctp_make_op_error_space(asoc, chunk,\n\t\t\t\t\t ntohs(chunk->chunk_hdr->length));\n\
  \n\tif (*errp) {\n\t\tsctp_init_cause(*errp, SCTP_ERROR_UNKNOWN_PARAM,\n\t\t\t\t WORD_ROUND(ntohs(param.p->length)));\n\
  \t\tsctp_addto_chunk(*errp,\n\t\t\tWORD_ROUND(ntohs(param.p->length)),\n\t\t\t\t  param.v);\n\
  \nWhen we allocate an error chunk, we assume that the worst case scenario requires\nthat we\
  \ have chunk_hdr->length data allocated, which would be correct nominally,\ngiven that we\
  \ call sctp_addto_chunk for the violating parameter.  Unfortunately,\nwe also, in sctp_init_cause\
  \ insert a sctp_errhdr_t structure into the error\nchunk, so the worst case situation in which\
  \ all parameters are in violation\nrequires chunk_hdr->length+(sizeof(sctp_errhdr_t)*param_count)\
  \ bytes of data.\n\nThe result of this error is that a deliberately malformed packet sent\
  \ to a\nlistening host can cause a remote DOS, described in CVE-2010-1173:\nhttp://cve.mitre.org/cgi-bin/cvename.cgi?name=2010-1173\n\
  \nI've tested the below fix and confirmed that it fixes the issue.  We move to a\nstrategy\
  \ whereby we allocate a fixed size error chunk and ignore errors we don't\nhave space to report.\
  \  Tested by me successfully\n\nSigned-off-by: Neil Horman <nhorman@tuxdriver.com>\nAcked-by:\
  \ Vlad Yasevich <vladislav.yasevich@hp.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>\n\
  5fa782c2f5ef6c2e4f04d3e228412c9b4a4c8809:sctp: Fix skb_over_panic resulting from multiple\
  \ invalid parameter errors (CVE-2010-1173) (v4)\n\nOk, version 4\n\nChange Notes:\n1) Minor\
  \ cleanups, from Vlads notes\n\nSummary:\n\nHey-\n\tRecently, it was reported to me that the\
  \ kernel could oops in the\nfollowing way:\n\n<5> kernel BUG at net/core/skbuff.c:91!\n<5>\
  \ invalid operand: 0000 [#1]\n<5> Modules linked in: sctp netconsole nls_utf8 autofs4 sunrpc\
  \ iptable_filter\nip_tables cpufreq_powersave parport_pc lp parport vmblock(U) vsock(U) vmci(U)\n\
  vmxnet(U) vmmemctl(U) vmhgfs(U) acpiphp dm_mirror dm_mod button battery ac md5\nipv6 uhci_hcd\
  \ ehci_hcd snd_ens1371 snd_rawmidi snd_seq_device snd_pcm_oss\nsnd_mixer_oss snd_pcm snd_timer\
  \ snd_page_alloc snd_ac97_codec snd soundcore\npcnet32 mii floppy ext3 jbd ata_piix libata\
  \ mptscsih mptsas mptspi mptscsi\nmptbase sd_mod scsi_mod\n<5> CPU:    0\n<5> EIP:    0060:[<c02bff27>]\
  \    Not tainted VLI\n<5> EFLAGS: 00010216   (2.6.9-89.0.25.EL)\n<5> EIP is at skb_over_panic+0x1f/0x2d\n\
  <5> eax: 0000002c   ebx: c033f461   ecx: c0357d96   edx: c040fd44\n<5> esi: c033f461   edi:\
  \ df653280   ebp: 00000000   esp: c040fd40\n<5> ds: 007b   es: 007b   ss: 0068\n<5> Process\
  \ swapper (pid: 0, threadinfo=c040f000 task=c0370be0)\n<5> Stack: c0357d96 e0c29478 00000084\
  \ 00000004 c033f461 df653280 d7883180\ne0c2947d\n<5>        00000000 00000080 df653490 00000004\
  \ de4f1ac0 de4f1ac0 00000004\ndf653490\n<5>        00000001 e0c2877a 08000800 de4f1ac0 df653490\
  \ 00000000 e0c29d2e\n00000004\n<5> Call Trace:\n<5>  [<e0c29478>] sctp_addto_chunk+0xb0/0x128\
  \ [sctp]\n<5>  [<e0c2947d>] sctp_addto_chunk+0xb5/0x128 [sctp]\n<5>  [<e0c2877a>] sctp_init_cause+0x3f/0x47\
  \ [sctp]\n<5>  [<e0c29d2e>] sctp_process_unk_param+0xac/0xb8 [sctp]\n<5>  [<e0c29e90>] sctp_verify_init+0xcc/0x134\
  \ [sctp]\n<5>  [<e0c20322>] sctp_sf_do_5_1B_init+0x83/0x28e [sctp]\n<5>  [<e0c25333>] sctp_do_sm+0x41/0x77\
  \ [sctp]\n<5>  [<c01555a4>] cache_grow+0x140/0x233\n<5>  [<e0c26ba1>] sctp_endpoint_bh_rcv+0xc5/0x108\
  \ [sctp]\n<5>  [<e0c2b863>] sctp_inq_push+0xe/0x10 [sctp]\n<5>  [<e0c34600>] sctp_rcv+0x454/0x509\
  \ [sctp]\n<5>  [<e084e017>] ipt_hook+0x17/0x1c [iptable_filter]\n<5>  [<c02d005e>] nf_iterate+0x40/0x81\n\
  <5>  [<c02e0bb9>] ip_local_deliver_finish+0x0/0x151\n<5>  [<c02e0c7f>] ip_local_deliver_finish+0xc6/0x151\n\
  <5>  [<c02d0362>] nf_hook_slow+0x83/0xb5\n<5>  [<c02e0bb2>] ip_local_deliver+0x1a2/0x1a9\n\
  <5>  [<c02e0bb9>] ip_local_deliver_finish+0x0/0x151\n<5>  [<c02e103e>] ip_rcv+0x334/0x3b4\n\
  <5>  [<c02c66fd>] netif_receive_skb+0x320/0x35b\n<5>  [<e0a0928b>] init_stall_timer+0x67/0x6a\
  \ [uhci_hcd]\n<5>  [<c02c67a4>] process_backlog+0x6c/0xd9\n<5>  [<c02c690f>] net_rx_action+0xfe/0x1f8\n\
  <5>  [<c012a7b1>] __do_softirq+0x35/0x79\n<5>  [<c0107efb>] handle_IRQ_event+0x0/0x4f\n<5>\
  \  [<c01094de>] do_softirq+0x46/0x4d\n\nIts an skb_over_panic BUG halt that results from processing\
  \ an init chunk in\nwhich too many of its variable length parameters are in some way malformed.\n\
  \nThe problem is in sctp_process_unk_param:\nif (NULL == *errp)\n\t*errp = sctp_make_op_error_space(asoc,\
  \ chunk,\n\t\t\t\t\t ntohs(chunk->chunk_hdr->length));\n\n\tif (*errp) {\n\t\tsctp_init_cause(*errp,\
  \ SCTP_ERROR_UNKNOWN_PARAM,\n\t\t\t\t WORD_ROUND(ntohs(param.p->length)));\n\t\tsctp_addto_chunk(*errp,\n\
  \t\t\tWORD_ROUND(ntohs(param.p->length)),\n\t\t\t\t  param.v);\n\nWhen we allocate an error\
  \ chunk, we assume that the worst case scenario requires\nthat we have chunk_hdr->length data\
  \ allocated, which would be correct nominally,\ngiven that we call sctp_addto_chunk for the\
  \ violating parameter.  Unfortunately,\nwe also, in sctp_init_cause insert a sctp_errhdr_t\
  \ structure into the error\nchunk, so the worst case situation in which all parameters are\
  \ in violation\nrequires chunk_hdr->length+(sizeof(sctp_errhdr_t)*param_count) bytes of data.\n\
  \nThe result of this error is that a deliberately malformed packet sent to a\nlistening host\
  \ can cause a remote DOS, described in CVE-2010-1173:\nhttp://cve.mitre.org/cgi-bin/cvename.cgi?name=2010-1173\n\
  \nI've tested the below fix and confirmed that it fixes the issue.  We move to a\nstrategy\
  \ whereby we allocate a fixed size error chunk and ignore errors we don't\nhave space to report.\
  \  Tested by me successfully\n\nSigned-off-by: Neil Horman <nhorman@tuxdriver.com>\nAcked-by:\
  \ Vlad Yasevich <vladislav.yasevich@hp.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>"
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 5fa782c2f5ef6c2e4f04d3e228412c9b4a4c8809
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 7437e7d3672b6d23c08212c68752c9a9c25f8e9e
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 2e3219b5c8a2e44e0b83ae6e04f52f20a82ac0f2
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/2e3219b5c8a2e44e0b83ae6e04f52f20a82ac0f2
    reference_type: commit
    reference_id: 2e3219b5c8a2e44e0b83ae6e04f52f20a82ac0f2
  - url: https://github.com/torvalds/linux/tree/5fa782c2f5ef6c2e4f04d3e228412c9b4a4c8809
    reference_type: commit
    reference_id: 5fa782c2f5ef6c2e4f04d3e228412c9b4a4c8809
  - url: https://github.com/torvalds/linux/tree/7437e7d3672b6d23c08212c68752c9a9c25f8e9e
    reference_type: commit
    reference_id: 7437e7d3672b6d23c08212c68752c9a9c25f8e9e
