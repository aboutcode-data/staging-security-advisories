advisory_id: CVE-2010-3849
datasource_id: collect_linux_fix_commits/CVE-2010-3849
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  33dd94ae1ccbfb7bf0fb6c692bc3d1c4269e6177:do_exit(): make sure that we run with get_fs() == USER_DS

  If a user manages to trigger an oops with fs set to KERNEL_DS, fs is not
  otherwise reset before do_exit().  do_exit may later (via mm_release in
  fork.c) do a put_user to a user-controlled address, potentially allowing
  a user to leverage an oops into a controlled write into kernel memory.

  This is only triggerable in the presence of another bug, but this
  potentially turns a lot of DoS bugs into privilege escalations, so it's
  worth fixing.  I have proof-of-concept code which uses this bug along
  with CVE-2010-3849 to write a zero to an arbitrary kernel address, so
  I've tested that this is not theoretical.

  A more logical place to put this fix might be when we know an oops has
  occurred, before we call do_exit(), but that would involve changing
  every architecture, in multiple places.

  Let's just stick it in do_exit instead.

  [akpm@linux-foundation.org: update code comment]
  Signed-off-by: Nelson Elhage <nelhage@ksplice.com>
  Cc: KOSAKI Motohiro <kosaki.motohiro@jp.fujitsu.com>
  Cc: <stable@kernel.org>
  Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
  a01af8e4a4ee1135598f157051959982418c38f8:Merge git://git.kernel.org/pub/scm/linux/kernel/git/davem/net-2.6

  * git://git.kernel.org/pub/scm/linux/kernel/git/davem/net-2.6: (27 commits)
    af_unix: limit recursion level
    pch_gbe driver: The wrong of initializer entry
    pch_gbe dreiver: chang author
    ucc_geth: fix ucc halt problem in half duplex mode
    inet: Fix __inet_inherit_port() to correctly increment bsockets and num_owners
    ehea: Add some info messages and fix an issue
    hso: fix disable_net
    NET: wan/x25_asy, move lapb_unregister to x25_asy_close_tty
    cxgb4vf: fix setting unicast/multicast addresses ...
    net, ppp: Report correct error code if unit allocation failed
    DECnet: don't leak uninitialized stack byte
    au1000_eth: fix invalid address accessing the MAC enable register
    dccp: fix error in updating the GAR
    tcp: restrict net.ipv4.tcp_adv_win_scale (#20312)
    netns: Don't leak others' openreq-s in proc
    Net: ceph: Makefile: Remove unnessary code
    vhost/net: fix rcu check usage
    econet: fix CVE-2010-3848
    econet: fix CVE-2010-3850
    econet: disallow NULL remote addr for sendmsg(), fixes CVE-2010-3849
    ...
  fa0e846494792e722d817b9d3d625a4ef4896c96:econet: disallow NULL remote addr for sendmsg(), fixes CVE-2010-3849

  Later parts of econet_sendmsg() rely on saddr != NULL, so return early
  with EINVAL if NULL was passed otherwise an oops may occur.

  Signed-off-by: Phil Blundell <philb@gnu.org>
  Signed-off-by: David S. Miller <davem@davemloft.net>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 33dd94ae1ccbfb7bf0fb6c692bc3d1c4269e6177
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: fa0e846494792e722d817b9d3d625a4ef4896c96
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: a01af8e4a4ee1135598f157051959982418c38f8
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/33dd94ae1ccbfb7bf0fb6c692bc3d1c4269e6177
    reference_type: commit
    reference_id: 33dd94ae1ccbfb7bf0fb6c692bc3d1c4269e6177
  - url: https://github.com/torvalds/linux/tree/a01af8e4a4ee1135598f157051959982418c38f8
    reference_type: commit
    reference_id: a01af8e4a4ee1135598f157051959982418c38f8
  - url: https://github.com/torvalds/linux/tree/fa0e846494792e722d817b9d3d625a4ef4896c96
    reference_type: commit
    reference_id: fa0e846494792e722d817b9d3d625a4ef4896c96
