advisory_id: CVE-2014-0102
datasource_id: collect_linux_fix_commits/CVE-2014-0102
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: "979e0d74651ba5aa533277f2a6423d0f982fb6f6:KEYS: Make the keyring cycle detector ignore\
  \ other keyrings of the same name\n\nThis fixes CVE-2014-0102.\n\nThe following command sequence\
  \ produces an oops:\n\n\tkeyctl new_session\n\ti=`keyctl newring _ses @s`\n\tkeyctl link @s\
  \ $i\n\nThe problem is that search_nested_keyrings() sees two keyrings that have\nmatching\
  \ type and description, so keyring_compare_object() returns true.\ns_n_k() then passes the\
  \ key to the iterator function -\nkeyring_detect_cycle_iterator() - which *should* check to\
  \ see whether this is\nthe keyring of interest, not just one with the same name.\n\nBecause\
  \ assoc_array_find() will return one and only one match, I assumed that\nthe iterator function\
  \ would only see an exact match or never be called - but\nthe iterator isn't only called from\
  \ assoc_array_find()...\n\nThe oops looks something like this:\n\n\tkernel BUG at /data/fs/linux-2.6-fscache/security/keys/keyring.c:1003!\n\
  \tinvalid opcode: 0000 [#1] SMP\n\t...\n\tRIP: keyring_detect_cycle_iterator+0xe/0x1f\n\t\
  ...\n\tCall Trace:\n\t  search_nested_keyrings+0x76/0x2aa\n\t  __key_link_check_live_key+0x50/0x5f\n\
  \t  key_link+0x4e/0x85\n\t  keyctl_keyring_link+0x60/0x81\n\t  SyS_keyctl+0x65/0xe4\n\t  tracesys+0xdd/0xe2\n\
  \nThe fix is to make keyring_detect_cycle_iterator() check that the key it\nhas is the key\
  \ it was actually looking for rather than calling BUG_ON().\n\nA testcase has been included\
  \ in the keyutils testsuite for this:\n\n\thttp://git.kernel.org/cgit/linux/kernel/git/dhowells/keyutils.git/commit/?id=891f3365d07f1996778ade0e3428f01878a1790b\n\
  \nReported-by: Tommi Rantala <tt.rantala@gmail.com>\nSigned-off-by: David Howells <dhowells@redhat.com>\n\
  Acked-by: James Morris <james.l.morris@oracle.com>\nSigned-off-by: Linus Torvalds <torvalds@linux-foundation.org>"
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 979e0d74651ba5aa533277f2a6423d0f982fb6f6
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/979e0d74651ba5aa533277f2a6423d0f982fb6f6
    reference_type: commit
    reference_id: 979e0d74651ba5aa533277f2a6423d0f982fb6f6
