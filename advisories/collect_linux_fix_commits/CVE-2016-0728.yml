advisory_id: CVE-2016-0728
datasource_id: collect_linux_fix_commits/CVE-2016-0728
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: "23567fd052a9abb6d67fe8e7a9ccdd9800a540f2:KEYS: Fix keyring ref leak in join_session_keyring()\n\
  \nThis fixes CVE-2016-0728.\n\nIf a thread is asked to join as a session keyring the keyring\
  \ that's already\nset as its session, we leak a keyring reference.\n\nThis can be tested with\
  \ the following program:\n\n\t#include <stddef.h>\n\t#include <stdio.h>\n\t#include <sys/types.h>\n\
  \t#include <keyutils.h>\n\n\tint main(int argc, const char *argv[])\n\t{\n\t\tint i = 0;\n\
  \t\tkey_serial_t serial;\n\n\t\tserial = keyctl(KEYCTL_JOIN_SESSION_KEYRING,\n\t\t\t\t\"leaked-keyring\"\
  );\n\t\tif (serial < 0) {\n\t\t\tperror(\"keyctl\");\n\t\t\treturn -1;\n\t\t}\n\n\t\tif (keyctl(KEYCTL_SETPERM,\
  \ serial,\n\t\t\t   KEY_POS_ALL | KEY_USR_ALL) < 0) {\n\t\t\tperror(\"keyctl\");\n\t\t\treturn\
  \ -1;\n\t\t}\n\n\t\tfor (i = 0; i < 100; i++) {\n\t\t\tserial = keyctl(KEYCTL_JOIN_SESSION_KEYRING,\n\
  \t\t\t\t\t\"leaked-keyring\");\n\t\t\tif (serial < 0) {\n\t\t\t\tperror(\"keyctl\");\n\t\t\
  \t\treturn -1;\n\t\t\t}\n\t\t}\n\n\t\treturn 0;\n\t}\n\nIf, after the program has run, there\
  \ something like the following line in\n/proc/keys:\n\n3f3d898f I--Q---   100 perm 3f3f0000\
  \     0     0 keyring   leaked-keyring: empty\n\nwith a usage count of 100 * the number of\
  \ times the program has been run,\nthen the kernel is malfunctioning.  If leaked-keyring has\
  \ zero usages or\nhas been garbage collected, then the problem is fixed.\n\nReported-by: Yevgeny\
  \ Pats <yevgeny@perception-point.io>\nSigned-off-by: David Howells <dhowells@redhat.com>\n\
  Acked-by: Don Zickus <dzickus@redhat.com>\nAcked-by: Prarit Bhargava <prarit@redhat.com>\n\
  Acked-by: Jarod Wilson <jarod@redhat.com>\nSigned-off-by: James Morris <james.l.morris@oracle.com>"
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 23567fd052a9abb6d67fe8e7a9ccdd9800a540f2
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/23567fd052a9abb6d67fe8e7a9ccdd9800a540f2
    reference_type: commit
    reference_id: 23567fd052a9abb6d67fe8e7a9ccdd9800a540f2
