advisory_id: CVE-2013-4348
datasource_id: collect_linux_fix_commits/CVE-2013-4348
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: "105bc1306e9b29c2aa2783b9524f7aec9b5a5b1f:Merge git://git.kernel.org/pub/scm/linux/kernel/git/bpf/bpf-next\n\
  \nDaniel Borkmann says:\n\n====================\npull-request: bpf-next 2018-09-25\n\nThe\
  \ following pull-request contains BPF updates for your *net-next* tree.\n\nThe main changes\
  \ are:\n\n1) Allow for RX stack hardening by implementing the kernel's flow\n   dissector\
  \ in BPF. Idea was originally presented at netconf 2017 [0].\n   Quote from merge commit:\n\
  \n     [...] Because of the rigorous checks of the BPF verifier, this\n     provides significant\
  \ security guarantees. In particular, the BPF\n     flow dissector cannot get inside of an\
  \ infinite loop, as with\n     CVE-2013-4348, because BPF programs are guaranteed to terminate.\n\
  \     It cannot read outside of packet bounds, because all memory accesses\n     are checked.\
  \ Also, with BPF the administrator can decide which\n     protocols to support, reducing potential\
  \ attack surface. Rarely\n     encountered protocols can be excluded from dissection and the\n\
  \     program can be updated without kernel recompile or reboot if a\n     bug is discovered.\
  \ [...]\n\n   Also, a sample flow dissector has been implemented in BPF as part\n   of this\
  \ work, from Petar and Willem.\n\n   [0] http://vger.kernel.org/netconf2017_files/rx_hardening_and_udp_gso.pdf\n\
  \n2) Add support for bpftool to list currently active attachment\n   points of BPF networking\
  \ programs providing a quick overview\n   similar to bpftool's perf subcommand, from Yonghong.\n\
  \n3) Fix a verifier pruning instability bug where a union member\n   from the register state\
  \ was not cleared properly leading to\n   branches not being pruned despite them being valid\
  \ candidates,\n   from Alexei.\n\n4) Various smaller fast-path optimizations in XDP's map\
  \ redirect\n   code, from Jesper.\n\n5) Enable to recognize BPF_MAP_TYPE_REUSEPORT_SOCKARRAY\
  \ maps\n   in bpftool, from Roman.\n\n6) Remove a duplicate check in libbpf that probes for\
  \ function\n   storage, from Taeung.\n\n7) Fix an issue in test_progs by avoid checking for\
  \ errno since\n   on success its value should not be checked, from Mauricio.\n\n8) Fix unused\
  \ variable warning in bpf_getsockopt() helper when\n   CONFIG_INET is not configured, from\
  \ Anders.\n\n9) Fix a compilation failure in the BPF sample code's use of\n   bpf_flow_keys,\
  \ from Prashant.\n\n10) Minor cleanups in BPF code, from Yue and Zhong.\n====================\n\
  \nSigned-off-by: David S. Miller <davem@davemloft.net>\n4a9f42c9dcbfb8da40bfeaa923b6a740a64a889b:Merge\
  \ branch 'bpf-flow-dissector'\n\nPetar Penkov says:\n\n====================\nThis patch series\
  \ hardens the RX stack by allowing flow dissection in BPF,\nas previously discussed [1]. Because\
  \ of the rigorous checks of the BPF\nverifier, this provides significant security guarantees.\
  \ In particular, the\nBPF flow dissector cannot get inside of an infinite loop, as with\n\
  CVE-2013-4348, because BPF programs are guaranteed to terminate. It cannot\nread outside of\
  \ packet bounds, because all memory accesses are checked.\nAlso, with BPF the administrator\
  \ can decide which protocols to support,\nreducing potential attack surface. Rarely encountered\
  \ protocols can be\nexcluded from dissection and the program can be updated without kernel\n\
  recompile or reboot if a bug is discovered.\n\nPatch 1 adds infrastructure to execute a BPF\
  \ program in __skb_flow_dissect.\nThis includes a new BPF program and attach type.\n\nPatch\
  \ 2 adds the new BPF flow dissector definitions to tools/uapi.\n\nPatch 3 adds support for\
  \ the new BPF program type to libbpf and bpftool.\n\nPatch 4 adds a flow dissector program\
  \ in BPF. This parses most protocols in\n__skb_flow_dissect in BPF for a subset of flow keys\
  \ (basic, control, ports,\nand address types).\n\nPatch 5 adds a selftest that attaches the\
  \ BPF program to the flow dissector\nand sends traffic with different levels of encapsulation.\n\
  \nPerformance Evaluation:\nThe in-kernel implementation was compared against the demo program\
  \ from\npatch 4 using the test in patch 5 with IPv4/UDP traffic over 10 seconds.\n\t$perf\
  \ record -a -C 4 taskset -c 4 ./test_flow_dissector -i 4 -f 8 \\\n\t\t-t 10\n\nIn-kernel Dissector:\n\
  \t__skb_flow_dissect overhead: 2.12%\n\tTotal Packets: 3,272,597 (from output of ./test_flow_dissector)\n\
  \nBPF Dissector:\n\t__skb_flow_dissect overhead: 1.63%\n\tTotal Packets: 3,232,356 (from output\
  \ of ./test_flow_dissector)\n\nNo-op BPF Dissector:\n\t__skb_flow_dissect overhead: 1.52%\n\
  \tTotal Packets: 3,330,635 (from output of ./test_flow_dissector)\n\nChanges since v3:\n1/\
  \ struct bpf_flow_keys reorganized to remove holes in patch 1 and patch 2.\n\nChanges since\
  \ v2:\n1/ Changes to tools/include/uapi pulled into a separate patch 2\n2/ Changes to tools/lib\
  \ and tools/bpftool pulled into a separate patch 3\n3/ Changed flow_keys in __sk_buff from\
  \ __u32 to struct bpf_flow_keys *\n4/ Added nhoff field in struct bpf_flow_keys to pass initial\
  \ offset\n5/ Saving all of the modified control block, rather than just the qdisc\n6/ Sample\
  \ BPF program in patch 4 modified to use the changes above\n\nChanges since v1:\n1/ LD_ABS\
  \ instructions now disallowed for the new BPF prog type\n2/ now checks if skb is NULL in __skb_flow_dissect()\n\
  3/ fixed incorrect accesses in flow_dissector_is_valid_access()\n\t- writes to the flow_keys\
  \ field now disallowed\n\t- reads/writes to tc_classid and data_meta now disallowed\n4/ headers\
  \ pulled with bpf_skb_load_data if direct access fails\n\nChanges since RFC:\n1/ Flow dissector\
  \ hook changed from global to per-netns\n2/ Defined struct bpf_flow_keys to be used in BPF\
  \ flow dissector\nprograms instead of exposing the internal flow keys layout. Added a\nfunction\
  \ to translate from bpf_flow_keys to the internal layout after BPF\ndissection is complete.\
  \ The pointer to this struct is stored in\nqdisc_skb_cb rather than inside of the 20 byte\
  \ control block which\nsimplifies verification and allows access to all 20 bytes of the cb.\n\
  3/ Removed GUE parsing as it relied on a hardcoded port\n4/ MPLS parsing now stops at the\
  \ first label which is consistent\nwith the in-kernel flow dissector\n5/ Refactored to use\
  \ direct packet access and to write out to\nstruct bpf_flow_keys\n\n[1] http://vger.kernel.org/netconf2017_files/rx_hardening_and_udp_gso.pdf\n\
  ====================\n\nSigned-off-by: Alexei Starovoitov <ast@kernel.org>"
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 4a9f42c9dcbfb8da40bfeaa923b6a740a64a889b
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 105bc1306e9b29c2aa2783b9524f7aec9b5a5b1f
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/105bc1306e9b29c2aa2783b9524f7aec9b5a5b1f
    reference_type: commit
    reference_id: 105bc1306e9b29c2aa2783b9524f7aec9b5a5b1f
  - url: https://github.com/torvalds/linux/tree/4a9f42c9dcbfb8da40bfeaa923b6a740a64a889b
    reference_type: commit
    reference_id: 4a9f42c9dcbfb8da40bfeaa923b6a740a64a889b
