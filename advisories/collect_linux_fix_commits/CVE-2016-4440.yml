advisory_id: CVE-2016-4440
datasource_id: collect_linux_fix_commits/CVE-2016-4440
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  e28e909c36bb5d6319953822d84df00fce7cbd18:Merge tag 'for-linus' of git://git.kernel.org/pub/scm/virt/kvm/kvm

  Pull second batch of KVM updates from Radim Krčmář:
   "General:

     - move kvm_stat tool from QEMU repo into tools/kvm/kvm_stat (kvm_stat
       had nothing to do with QEMU in the first place -- the tool only
       interprets debugfs)

     - expose per-vm statistics in debugfs and support them in kvm_stat
       (KVM always collected per-vm statistics, but they were summarised
       into global statistics)

    x86:

     - fix dynamic APICv (VMX was improperly configured and a guest could
       access host's APIC MSRs, CVE-2016-4440)

     - minor fixes

    ARM changes from Christoffer Dall:

     - new vgic reimplementation of our horribly broken legacy vgic
       implementation.  The two implementations will live side-by-side
       (with the new being the configured default) for one kernel release
       and then we'll remove the legacy one.

     - fix for a non-critical issue with virtual abort injection to guests"

  * tag 'for-linus' of git://git.kernel.org/pub/scm/virt/kvm/kvm: (70 commits)
    tools: kvm_stat: Add comments
    tools: kvm_stat: Introduce pid monitoring
    KVM: Create debugfs dir and stat files for each VM
    MAINTAINERS: Add kvm tools
    tools: kvm_stat: Powerpc related fixes
    tools: Add kvm_stat man page
    tools: Add kvm_stat vm monitor script
    kvm:vmx: more complete state update on APICv on/off
    KVM: SVM: Add more SVM_EXIT_REASONS
    KVM: Unify traced vector format
    svm: bitwise vs logical op typo
    KVM: arm/arm64: vgic-new: Synchronize changes to active state
    KVM: arm/arm64: vgic-new: enable build
    KVM: arm/arm64: vgic-new: implement mapped IRQ handling
    KVM: arm/arm64: vgic-new: Wire up irqfd injection
    KVM: arm/arm64: vgic-new: Add vgic_v2/v3_enable
    KVM: arm/arm64: vgic-new: vgic_init: implement map_resources
    KVM: arm/arm64: vgic-new: vgic_init: implement vgic_init
    KVM: arm/arm64: vgic-new: vgic_init: implement vgic_create
    KVM: arm/arm64: vgic-new: vgic_init: implement kvm_vgic_hyp_init
    ...
  3ce424e45411cf5a13105e0386b6ecf6eeb4f66f:kvm:vmx: more complete state update on APICv on/off

  The function to update APICv on/off state (in particular, to deactivate
  it when enabling Hyper-V SynIC) is incomplete: it doesn't adjust
  APICv-related fields among secondary processor-based VM-execution
  controls.  As a result, Windows 2012 guests get stuck when SynIC-based
  auto-EOI interrupt intersected with e.g. an IPI in the guest.

  In addition, the MSR intercept bitmap isn't updated every time "virtualize
  x2APIC mode" is toggled.  This path can only be triggered by a malicious
  guest, because Windows didn't use x2APIC but rather their own synthetic
  APIC access MSRs; however a guest running in a SynIC-enabled VM could
  switch to x2APIC and thus obtain direct access to host APIC MSRs
  (CVE-2016-4440).

  The patch fixes those omissions.

  Signed-off-by: Roman Kagan <rkagan@virtuozzo.com>
  Reported-by: Steve Rutherford <srutherford@google.com>
  Reported-by: Yang Zhang <yang.zhang.wz@gmail.com>
  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 3ce424e45411cf5a13105e0386b6ecf6eeb4f66f
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: e28e909c36bb5d6319953822d84df00fce7cbd18
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/3ce424e45411cf5a13105e0386b6ecf6eeb4f66f
    reference_type: commit
    reference_id: 3ce424e45411cf5a13105e0386b6ecf6eeb4f66f
  - url: https://github.com/torvalds/linux/tree/e28e909c36bb5d6319953822d84df00fce7cbd18
    reference_type: commit
    reference_id: e28e909c36bb5d6319953822d84df00fce7cbd18
