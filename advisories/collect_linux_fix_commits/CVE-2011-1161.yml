advisory_id: CVE-2011-1161
datasource_id: collect_linux_fix_commits/CVE-2011-1161
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  ee70bc1e7b63ac8023c9ff9475d8741e397316e7:tpm-dev-common: Reject too short writes

  tpm_transmit() does not offer an explicit interface to indicate the number
  of valid bytes in the communication buffer. Instead, it relies on the
  commandSize field in the TPM header that is encoded within the buffer.
  Therefore, ensure that a) enough data has been written to the buffer, so
  that the commandSize field is present and b) the commandSize field does not
  announce more data than has been written to the buffer.

  This should have been fixed with CVE-2011-1161 long ago, but apparently
  a correct version of that patch never made it into the kernel.

  Cc: stable@vger.kernel.org
  Signed-off-by: Alexander Steffen <Alexander.Steffen@infineon.com>
  Reviewed-by: Jarkko Sakkinen <jarkko.sakkinen@linux.intel.com>
  Tested-by: Jarkko Sakkinen <jarkko.sakkinen@linux.intel.com>
  Signed-off-by: Jarkko Sakkinen <jarkko.sakkinen@linux.intel.com>
  6b07d30aca7e52f2881b8c8c20c8a2cd28e8b3d3:TPM: Call tpm_transmit with correct size

  This patch changes the call of tpm_transmit by supplying the size of the
  userspace buffer instead of TPM_BUFSIZE.

  This got assigned CVE-2011-1161.

  [The first hunk didn't make sense given one could expect
   way less data than TPM_BUFSIZE, so added tpm_transmit boundary
   check over bufsiz instead
   The last parameter of tpm_transmit() reflects the amount
   of data expected from the device, and not the buffer size
   being supplied to it. It isn't ideal to parse it directly,
   so we just set it to the maximum the input buffer can handle
   and let the userspace API to do such job.]

  Signed-off-by: Rajiv Andrade <srajiv@linux.vnet.ibm.com>
  Cc: Stable Kernel <stable@kernel.org>
  Signed-off-by: James Morris <jmorris@namei.org>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: ee70bc1e7b63ac8023c9ff9475d8741e397316e7
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 6b07d30aca7e52f2881b8c8c20c8a2cd28e8b3d3
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/6b07d30aca7e52f2881b8c8c20c8a2cd28e8b3d3
    reference_type: commit
    reference_id: 6b07d30aca7e52f2881b8c8c20c8a2cd28e8b3d3
  - url: https://github.com/torvalds/linux/tree/ee70bc1e7b63ac8023c9ff9475d8741e397316e7
    reference_type: commit
    reference_id: ee70bc1e7b63ac8023c9ff9475d8741e397316e7
