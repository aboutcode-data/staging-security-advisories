advisory_id: CVE-2023-47233
datasource_id: collect_linux_fix_commits/CVE-2023-47233
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: "0f7352557a35ab7888bc7831411ec8a3cbe20d78:wifi: brcmfmac: Fix use-after-free bug in\
  \ brcmf_cfg80211_detach\n\nThis is the candidate patch of CVE-2023-47233 :\nhttps://nvd.nist.gov/vuln/detail/CVE-2023-47233\n\
  \nIn brcm80211 driver,it starts with the following invoking chain\nto start init a timeout\
  \ worker:\n\n->brcmf_usb_probe\n  ->brcmf_usb_probe_cb\n    ->brcmf_attach\n      ->brcmf_bus_started\n\
  \        ->brcmf_cfg80211_attach\n          ->wl_init_priv\n            ->brcmf_init_escan\n\
  \              ->INIT_WORK(&cfg->escan_timeout_work,\n\t\t  brcmf_cfg80211_escan_timeout_worker);\n\
  \nIf we disconnect the USB by hotplug, it will call\nbrcmf_usb_disconnect to make cleanup.\
  \ The invoking chain is :\n\nbrcmf_usb_disconnect\n  ->brcmf_usb_disconnect_cb\n    ->brcmf_detach\n\
  \      ->brcmf_cfg80211_detach\n        ->kfree(cfg);\n\nWhile the timeout woker may still\
  \ be running. This will cause\na use-after-free bug on cfg in brcmf_cfg80211_escan_timeout_worker.\n\
  \nFix it by deleting the timer and canceling the worker in\nbrcmf_cfg80211_detach.\n\nFixes:\
  \ e756af5b30b0 (\"brcmfmac: add e-scan support.\")\nSigned-off-by: Zheng Wang <zyytlz.wz@163.com>\n\
  Cc: stable@vger.kernel.org\n[arend.vanspriel@broadcom.com: keep timer delete as is and cancel\
  \ work just before free]\nSigned-off-by: Arend van Spriel <arend.vanspriel@broadcom.com>\n\
  Signed-off-by: Kalle Valo <kvalo@kernel.org>\nLink: https://msgid.link/20240107072504.392713-1-arend.vanspriel@broadcom.com\n\
  0f7352557a35ab7888bc7831411ec8a3cbe20d78:wifi: brcmfmac: Fix use-after-free bug in brcmf_cfg80211_detach\n\
  \nThis is the candidate patch of CVE-2023-47233 :\nhttps://nvd.nist.gov/vuln/detail/CVE-2023-47233\n\
  \nIn brcm80211 driver,it starts with the following invoking chain\nto start init a timeout\
  \ worker:\n\n->brcmf_usb_probe\n  ->brcmf_usb_probe_cb\n    ->brcmf_attach\n      ->brcmf_bus_started\n\
  \        ->brcmf_cfg80211_attach\n          ->wl_init_priv\n            ->brcmf_init_escan\n\
  \              ->INIT_WORK(&cfg->escan_timeout_work,\n\t\t  brcmf_cfg80211_escan_timeout_worker);\n\
  \nIf we disconnect the USB by hotplug, it will call\nbrcmf_usb_disconnect to make cleanup.\
  \ The invoking chain is :\n\nbrcmf_usb_disconnect\n  ->brcmf_usb_disconnect_cb\n    ->brcmf_detach\n\
  \      ->brcmf_cfg80211_detach\n        ->kfree(cfg);\n\nWhile the timeout woker may still\
  \ be running. This will cause\na use-after-free bug on cfg in brcmf_cfg80211_escan_timeout_worker.\n\
  \nFix it by deleting the timer and canceling the worker in\nbrcmf_cfg80211_detach.\n\nFixes:\
  \ e756af5b30b0 (\"brcmfmac: add e-scan support.\")\nSigned-off-by: Zheng Wang <zyytlz.wz@163.com>\n\
  Cc: stable@vger.kernel.org\n[arend.vanspriel@broadcom.com: keep timer delete as is and cancel\
  \ work just before free]\nSigned-off-by: Arend van Spriel <arend.vanspriel@broadcom.com>\n\
  Signed-off-by: Kalle Valo <kvalo@kernel.org>\nLink: https://msgid.link/20240107072504.392713-1-arend.vanspriel@broadcom.com"
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 0f7352557a35ab7888bc7831411ec8a3cbe20d78
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/0f7352557a35ab7888bc7831411ec8a3cbe20d78
    reference_type: commit
    reference_id: 0f7352557a35ab7888bc7831411ec8a3cbe20d78
