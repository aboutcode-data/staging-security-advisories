advisory_id: CVE-2018-1120
datasource_id: collect_linux_fix_commits/CVE-2018-1120
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  7f7ccc2ccc2e70c6054685f5e3522efa81556830:proc: do not access cmdline nor environ from file-backed areas

  proc_pid_cmdline_read() and environ_read() directly access the target
  process' VM to retrieve the command line and environment. If this
  process remaps these areas onto a file via mmap(), the requesting
  process may experience various issues such as extra delays if the
  underlying device is slow to respond.

  Let's simply refuse to access file-backed areas in these functions.
  For this we add a new FOLL_ANON gup flag that is passed to all calls
  to access_remote_vm(). The code already takes care of such failures
  (including unmapped areas). Accesses via /proc/pid/mem were not
  changed though.

  This was assigned CVE-2018-1120.

  Note for stable backports: the patch may apply to kernels prior to 4.11
  but silently miss one location; it must be checked that no call to
  access_remote_vm() keeps zero as the last argument.

  Reported-by: Qualys Security Advisory <qsa@qualys.com>
  Cc: Linus Torvalds <torvalds@linux-foundation.org>
  Cc: Andy Lutomirski <luto@amacapital.net>
  Cc: Oleg Nesterov <oleg@redhat.com>
  Cc: stable@vger.kernel.org
  Signed-off-by: Willy Tarreau <w@1wt.eu>
  Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 7f7ccc2ccc2e70c6054685f5e3522efa81556830
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/7f7ccc2ccc2e70c6054685f5e3522efa81556830
    reference_type: commit
    reference_id: 7f7ccc2ccc2e70c6054685f5e3522efa81556830
