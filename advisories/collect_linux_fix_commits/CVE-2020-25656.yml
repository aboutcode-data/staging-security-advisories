advisory_id: CVE-2020-25656
datasource_id: collect_linux_fix_commits/CVE-2020-25656
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: "82e61c3909db51d91b9d3e2071557b6435018b80:vt: keyboard, extend func_buf_lock to readers\n\
  \nBoth read-side users of func_table/func_buf need locking. Without that,\none can easily\
  \ confuse the code by repeatedly setting altering strings\nlike:\nwhile (1)\n\tfor (a = 0;\
  \ a < 2; a++) {\n\t\tstruct kbsentry kbs = {};\n\t\tstrcpy((char *)kbs.kb_string, a ? \".\\\
  n\" : \"88888\\n\");\n\t\tioctl(fd, KDSKBSENT, &kbs);\n\t}\n\nWhen that program runs, one\
  \ can get unexpected output by holding F1\n(note the unxpected period on the last line):\n\
  .\n88888\n.8888\n\nSo protect all accesses to 'func_table' (and func_buf) by preexisting\n\
  'func_buf_lock'.\n\nIt is easy in 'k_fn' handler as 'puts_queue' is expected not to sleep.\n\
  On the other hand, KDGKBSENT needs a local (atomic) copy of the string\nbecause copy_to_user\
  \ can sleep. Use already allocated, but unused\n'kbs->kb_string' for that purpose.\n\nNote\
  \ that the program above needs at least CAP_SYS_TTY_CONFIG.\n\nThis depends on the previous\
  \ patch and on the func_buf_lock lock added\nin commit 46ca3f735f34 (tty/vt: fix write/write\
  \ race in ioctl(KDSKBSENT)\nhandler) in 5.2.\n\nLikely fixes CVE-2020-25656.\n\nCc: <stable@vger.kernel.org>\n\
  Reported-by: Minh Yuan <yuanmingbuaa@gmail.com>\nSigned-off-by: Jiri Slaby <jslaby@suse.cz>\n\
  Link: https://lore.kernel.org/r/20201019085517.10176-2-jslaby@suse.cz\nSigned-off-by: Greg\
  \ Kroah-Hartman <gregkh@linuxfoundation.org>"
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 82e61c3909db51d91b9d3e2071557b6435018b80
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/82e61c3909db51d91b9d3e2071557b6435018b80
    reference_type: commit
    reference_id: 82e61c3909db51d91b9d3e2071557b6435018b80
