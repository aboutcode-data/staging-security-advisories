advisory_id: CVE-2013-6376
datasource_id: collect_linux_fix_commits/CVE-2013-6376
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  45c3094a6424614e6fea135e4e1afd8e0a65f468:KVM: x86: allow 256 logical x2APICs again

  While fixing an x2apic bug,
   17d68b7 KVM: x86: fix guest-initiated crash with x2apic (CVE-2013-6376)
  we've made only one cluster available.  This means that the amount of
  logically addressible x2APICs was reduced to 16 and VCPUs kept
  overwriting themselves in that region, so even the first cluster wasn't
  set up correctly.

  This patch extends x2APIC support back to the logical_map's limit, and
  keeps the CVE fixed as messages for non-present APICs are dropped.

  Signed-off-by: Radim Krčmář <rkrcmar@redhat.com>
  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
  54fb723cc48db2fde964fb9bb0eaaccf2cf31a9f:Merge tag 'for-linus' of git://git.kernel.org/pub/scm/virt/kvm/kvm

  Pull kvm fixes from Paolo Bonzini:
   "Four security fixes for KVM on x86.  Thanks to Andrew Honig and Lars
    Bull from Google for reporting them"

  * tag 'for-linus' of git://git.kernel.org/pub/scm/virt/kvm/kvm:
    KVM: x86: fix guest-initiated crash with x2apic (CVE-2013-6376)
    KVM: x86: Convert vapic synchronization to _cached functions (CVE-2013-6368)
    KVM: x86: Fix potential divide by 0 in lapic (CVE-2013-6367)
    KVM: Improve create VCPU parameter (CVE-2013-4587)
  17d68b763f09a9ce824ae23eb62c9efc57b69271:KVM: x86: fix guest-initiated crash with x2apic (CVE-2013-6376)

  A guest can cause a BUG_ON() leading to a host kernel crash.
  When the guest writes to the ICR to request an IPI, while in x2apic
  mode the following things happen, the destination is read from
  ICR2, which is a register that the guest can control.

  kvm_irq_delivery_to_apic_fast uses the high 16 bits of ICR2 as the
  cluster id.  A BUG_ON is triggered, which is a protection against
  accessing map->logical_map with an out-of-bounds access and manages
  to avoid that anything really unsafe occurs.

  The logic in the code is correct from real HW point of view. The problem
  is that KVM supports only one cluster with ID 0 in clustered mode, but
  the code that has the bug does not take this into account.

  Reported-by: Lars Bull <larsbull@google.com>
  Cc: stable@vger.kernel.org
  Signed-off-by: Gleb Natapov <gleb@redhat.com>
  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 45c3094a6424614e6fea135e4e1afd8e0a65f468
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 17d68b763f09a9ce824ae23eb62c9efc57b69271
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 54fb723cc48db2fde964fb9bb0eaaccf2cf31a9f
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/17d68b763f09a9ce824ae23eb62c9efc57b69271
    reference_type: commit
    reference_id: 17d68b763f09a9ce824ae23eb62c9efc57b69271
  - url: https://github.com/torvalds/linux/tree/45c3094a6424614e6fea135e4e1afd8e0a65f468
    reference_type: commit
    reference_id: 45c3094a6424614e6fea135e4e1afd8e0a65f468
  - url: https://github.com/torvalds/linux/tree/54fb723cc48db2fde964fb9bb0eaaccf2cf31a9f
    reference_type: commit
    reference_id: 54fb723cc48db2fde964fb9bb0eaaccf2cf31a9f
