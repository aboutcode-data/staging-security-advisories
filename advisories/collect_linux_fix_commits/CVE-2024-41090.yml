advisory_id: CVE-2024-41090
datasource_id: collect_linux_fix_commits/CVE-2024-41090
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  af65ea42bd1d28d818b74b9b3b4f8da7ada9f88b:Merge branch 'tap-tun-harden-by-dropping-short-frame'

  Dongli Zhang says:

  ====================
  tap/tun: harden by dropping short frame

  This is to harden all of tap/tun to avoid any short frame smaller than the
  Ethernet header (ETH_HLEN).

  While the xen-netback already rejects short frame smaller than ETH_HLEN ...

   914 static void xenvif_tx_build_gops(struct xenvif_queue *queue,
   915                                      int budget,
   916                                      unsigned *copy_ops,
   917                                      unsigned *map_ops)
   918 {
  ... ...
  1007                 if (unlikely(txreq.size < ETH_HLEN)) {
  1008                         netdev_dbg(queue->vif->dev,
  1009                                    "Bad packet size: %d\n", txreq.size);
  1010                         xenvif_tx_err(queue, &txreq, extra_count, idx);
  1011                         break;
  1012                 }

  ... the short frame may not be dropped by vhost-net/tap/tun.

  This fixes CVE-2024-41090 and CVE-2024-41091.
  ====================

  Link: https://patch.msgid.link/20240724170452.16837-1-dongli.zhang@oracle.com
  Signed-off-by: Jakub Kicinski <kuba@kernel.org>
  ed7f2afdd0e043a397677e597ced0830b83ba0b3:tap: add missing verification for short frame

  The cited commit missed to check against the validity of the frame length
  in the tap_get_user_xdp() path, which could cause a corrupted skb to be
  sent downstack. Even before the skb is transmitted, the
  tap_get_user_xdp()-->skb_set_network_header() may assume the size is more
  than ETH_HLEN. Once transmitted, this could either cause out-of-bound
  access beyond the actual length, or confuse the underlayer with incorrect
  or inconsistent header length in the skb metadata.

  In the alternative path, tap_get_user() already prohibits short frame which
  has the length less than Ethernet header size from being transmitted.

  This is to drop any frame shorter than the Ethernet header size just like
  how tap_get_user() does.

  CVE: CVE-2024-41090
  Link: https://lore.kernel.org/netdev/1717026141-25716-1-git-send-email-si-wei.liu@oracle.com/
  Fixes: 0efac27791ee ("tap: accept an array of XDP buffs through sendmsg()")
  Cc: stable@vger.kernel.org
  Signed-off-by: Si-Wei Liu <si-wei.liu@oracle.com>
  Signed-off-by: Dongli Zhang <dongli.zhang@oracle.com>
  Reviewed-by: Willem de Bruijn <willemb@google.com>
  Reviewed-by: Paolo Abeni <pabeni@redhat.com>
  Reviewed-by: Jason Wang <jasowang@redhat.com>
  Link: https://patch.msgid.link/20240724170452.16837-2-dongli.zhang@oracle.com
  Signed-off-by: Jakub Kicinski <kuba@kernel.org>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: af65ea42bd1d28d818b74b9b3b4f8da7ada9f88b
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: ed7f2afdd0e043a397677e597ced0830b83ba0b3
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/af65ea42bd1d28d818b74b9b3b4f8da7ada9f88b
    reference_type: commit
    reference_id: af65ea42bd1d28d818b74b9b3b4f8da7ada9f88b
  - url: https://github.com/torvalds/linux/tree/ed7f2afdd0e043a397677e597ced0830b83ba0b3
    reference_type: commit
    reference_id: ed7f2afdd0e043a397677e597ced0830b83ba0b3
