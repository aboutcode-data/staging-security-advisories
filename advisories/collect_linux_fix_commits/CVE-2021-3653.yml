advisory_id: CVE-2021-3653
datasource_id: collect_linux_fix_commits/CVE-2021-3653
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  faf6b755629627f19feafa75b32e81cd7738f12d:KVM: x86: nSVM: don't copy virt_ext from vmcb12

  These field correspond to features that we don't expose yet to L2

  While currently there are no CVE worthy features in this field,
  if AMD adds more features to this field, that could allow guest
  escapes similar to CVE-2021-3653 and CVE-2021-3656.

  Signed-off-by: Maxim Levitsky <mlevitsk@redhat.com>
  Message-Id: <20210914154825.104886-6-mlevitsk@redhat.com>
  Cc: stable@vger.kernel.org
  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
  02a3715449a0edf06a37efe3862bc7732099a220:Merge tag 'for-linus' of git://git.kernel.org/pub/scm/virt/kvm/kvm

  Pull KVM fixes from Paolo Bonzini:
   "Two nested virtualization fixes for AMD processors"

  * tag 'for-linus' of git://git.kernel.org/pub/scm/virt/kvm/kvm:
    KVM: nSVM: always intercept VMLOAD/VMSAVE when nested (CVE-2021-3656)
    KVM: nSVM: avoid picking up unsupported bits from L2 in int_ctl (CVE-2021-3653)
  0f923e07124df069ba68d8bb12324398f4b6b709:KVM: nSVM: avoid picking up unsupported bits from L2 in int_ctl (CVE-2021-3653)

  * Invert the mask of bits that we pick from L2 in
    nested_vmcb02_prepare_control

  * Invert and explicitly use VIRQ related bits bitmask in svm_clear_vintr

  This fixes a security issue that allowed a malicious L1 to run L2 with
  AVIC enabled, which allowed the L2 to exploit the uninitialized and enabled
  AVIC to read/write the host physical memory at some offsets.

  Fixes: 3d6368ef580a ("KVM: SVM: Add VMRUN handler")
  Signed-off-by: Maxim Levitsky <mlevitsk@redhat.com>
  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 02a3715449a0edf06a37efe3862bc7732099a220
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 0f923e07124df069ba68d8bb12324398f4b6b709
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: faf6b755629627f19feafa75b32e81cd7738f12d
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/02a3715449a0edf06a37efe3862bc7732099a220
    reference_type: commit
    reference_id: 02a3715449a0edf06a37efe3862bc7732099a220
  - url: https://github.com/torvalds/linux/tree/0f923e07124df069ba68d8bb12324398f4b6b709
    reference_type: commit
    reference_id: 0f923e07124df069ba68d8bb12324398f4b6b709
  - url: https://github.com/torvalds/linux/tree/faf6b755629627f19feafa75b32e81cd7738f12d
    reference_type: commit
    reference_id: faf6b755629627f19feafa75b32e81cd7738f12d
