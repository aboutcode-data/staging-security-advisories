advisory_id: CVE-2021-29657
datasource_id: collect_linux_fix_commits/CVE-2021-29657
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  a58d9166a756a0f4a6618e4f593232593d6df134:KVM: SVM: load control fields from VMCB12 before checking them

  Avoid races between check and use of the nested VMCB controls.  This
  for example ensures that the VMRUN intercept is always reflected to the
  nested hypervisor, instead of being processed by the host.  Without this
  patch, it is possible to end up with svm->nested.hsave pointing to
  the MSR permission bitmap for nested guests.

  This bug is CVE-2021-29657.

  Reported-by: Felix Wilhelm <fwilhelm@google.com>
  Cc: stable@vger.kernel.org
  Fixes: 2fcf4876ada ("KVM: nSVM: implement on demand allocation of the nested state")
  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: a58d9166a756a0f4a6618e4f593232593d6df134
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/a58d9166a756a0f4a6618e4f593232593d6df134
    reference_type: commit
    reference_id: a58d9166a756a0f4a6618e4f593232593d6df134
