advisory_id: CVE-2017-7518
datasource_id: collect_linux_fix_commits/CVE-2017-7518
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  c8401dda2f0a00cd25c0af6a95ed50e478d25de4:KVM: x86: fix singlestepping over syscall

  TF is handled a bit differently for syscall and sysret, compared
  to the other instructions: TF is checked after the instruction completes,
  so that the OS can disable #DB at a syscall by adding TF to FMASK.
  When the sysret is executed the #DB is taken "as if" the syscall insn
  just completed.

  KVM emulates syscall so that it can trap 32-bit syscall on Intel processors.
  Fix the behavior, otherwise you could get #DB on a user stack which is not
  nice.  This does not affect Linux guests, as they use an IST or task gate
  for #DB.

  This fixes CVE-2017-7518.

  Cc: stable@vger.kernel.org
  Reported-by: Andy Lutomirski <luto@kernel.org>
  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
  Signed-off-by: Radim Krčmář <rkrcmar@redhat.com>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: c8401dda2f0a00cd25c0af6a95ed50e478d25de4
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/c8401dda2f0a00cd25c0af6a95ed50e478d25de4
    reference_type: commit
    reference_id: c8401dda2f0a00cd25c0af6a95ed50e478d25de4
