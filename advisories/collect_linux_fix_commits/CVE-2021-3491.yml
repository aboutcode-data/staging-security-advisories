advisory_id: CVE-2021-3491
datasource_id: collect_linux_fix_commits/CVE-2021-3491
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  d1f82808877bb10d3deee7cf3374a4eb3fb582db:io_uring: truncate lengths larger than MAX_RW_COUNT on provide buffers

  Read and write operations are capped to MAX_RW_COUNT. Some read ops rely on
  that limit, and that is not guaranteed by the IORING_OP_PROVIDE_BUFFERS.

  Truncate those lengths when doing io_add_buffers, so buffer addresses still
  use the uncapped length.

  Also, take the chance and change struct io_buffer len member to __u32, so
  it matches struct io_provide_buffer len member.

  This fixes CVE-2021-3491, also reported as ZDI-CAN-13546.

  Fixes: ddf0322db79c ("io_uring: add IORING_OP_PROVIDE_BUFFERS")
  Reported-by: Billy Jheng Bing-Jhong (@st424204)
  Signed-off-by: Thadeu Lima de Souza Cascardo <cascardo@canonical.com>
  Signed-off-by: Jens Axboe <axboe@kernel.dk>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: d1f82808877bb10d3deee7cf3374a4eb3fb582db
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/d1f82808877bb10d3deee7cf3374a4eb3fb582db
    reference_type: commit
    reference_id: d1f82808877bb10d3deee7cf3374a4eb3fb582db
