advisory_id: CVE-2016-7097
datasource_id: collect_linux_fix_commits/CVE-2016-7097
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  497de07d89c1410d76a15bec2bb41f24a2a89f31:tmpfs: clear S_ISGID when setting posix ACLs

  This change was missed the tmpfs modification in In CVE-2016-7097
  commit 073931017b49 ("posix_acl: Clear SGID bit when setting
  file permissions")
  It can test by xfstest generic/375, which failed to clear
  setgid bit in the following test case on tmpfs:

    touch $testfile
    chown 100:100 $testfile
    chmod 2755 $testfile
    _runas -u 100 -g 101 -- setfacl -m u::rwx,g::rwx,o::rwx $testfile

  Signed-off-by: Gu Zheng <guzheng1@huawei.com>
  Signed-off-by: Al Viro <viro@zeniv.linux.org.uk>
  073931017b49d9458aa351605b43a7e34598caef:posix_acl: Clear SGID bit when setting file permissions

  When file permissions are modified via chmod(2) and the user is not in
  the owning group or capable of CAP_FSETID, the setgid bit is cleared in
  inode_change_ok().  Setting a POSIX ACL via setxattr(2) sets the file
  permissions as well as the new ACL, but doesn't clear the setgid bit in
  a similar way; this allows to bypass the check in chmod(2).  Fix that.

  References: CVE-2016-7097
  Reviewed-by: Christoph Hellwig <hch@lst.de>
  Reviewed-by: Jeff Layton <jlayton@redhat.com>
  Signed-off-by: Jan Kara <jack@suse.cz>
  Signed-off-by: Andreas Gruenbacher <agruenba@redhat.com>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 073931017b49d9458aa351605b43a7e34598caef
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 497de07d89c1410d76a15bec2bb41f24a2a89f31
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/073931017b49d9458aa351605b43a7e34598caef
    reference_type: commit
    reference_id: 073931017b49d9458aa351605b43a7e34598caef
  - url: https://github.com/torvalds/linux/tree/497de07d89c1410d76a15bec2bb41f24a2a89f31
    reference_type: commit
    reference_id: 497de07d89c1410d76a15bec2bb41f24a2a89f31
