advisory_id: CVE-2014-0049
datasource_id: collect_linux_fix_commits/CVE-2014-0049
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  d8efcf38b13df3e9e889cf7cc214cb85dc53600c:Merge tag 'for-linus' of git://git.kernel.org/pub/scm/virt/kvm/kvm

  Pull KVM fixes from Paolo Bonzini:
   "Three x86 fixes and one for ARM/ARM64.

    In particular, nested virtualization on Intel is broken in 3.13 and
    fixed by this pull request"

  * tag 'for-linus' of git://git.kernel.org/pub/scm/virt/kvm/kvm:
    kvm, vmx: Really fix lazy FPU on nested guest
    kvm: x86: fix emulator buffer overflow (CVE-2014-0049)
    arm/arm64: KVM: detect CPU reset on CPU_PM_EXIT
    KVM: MMU: drop read-only large sptes when creating lower level sptes
  a08d3b3b99efd509133946056531cdf8f3a0c09b:kvm: x86: fix emulator buffer overflow (CVE-2014-0049)

  The problem occurs when the guest performs a pusha with the stack
  address pointing to an mmio address (or an invalid guest physical
  address) to start with, but then extending into an ordinary guest
  physical address.  When doing repeated emulated pushes
  emulator_read_write sets mmio_needed to 1 on the first one.  On a
  later push when the stack points to regular memory,
  mmio_nr_fragments is set to 0, but mmio_is_needed is not set to 0.

  As a result, KVM exits to userspace, and then returns to
  complete_emulated_mmio.  In complete_emulated_mmio
  vcpu->mmio_cur_fragment is incremented.  The termination condition of
  vcpu->mmio_cur_fragment == vcpu->mmio_nr_fragments is never achieved.
  The code bounces back and fourth to userspace incrementing
  mmio_cur_fragment past it's buffer.  If the guest does nothing else it
  eventually leads to a a crash on a memcpy from invalid memory address.

  However if a guest code can cause the vm to be destroyed in another
  vcpu with excellent timing, then kvm_clear_async_pf_completion_queue
  can be used by the guest to control the data that's pointed to by the
  call to cancel_work_item, which can be used to gain execution.

  Fixes: f78146b0f9230765c6315b2e14f56112513389ad
  Signed-off-by: Andrew Honig <ahonig@google.com>
  Cc: stable@vger.kernel.org (3.5+)
  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: a08d3b3b99efd509133946056531cdf8f3a0c09b
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: d8efcf38b13df3e9e889cf7cc214cb85dc53600c
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/a08d3b3b99efd509133946056531cdf8f3a0c09b
    reference_type: commit
    reference_id: a08d3b3b99efd509133946056531cdf8f3a0c09b
  - url: https://github.com/torvalds/linux/tree/d8efcf38b13df3e9e889cf7cc214cb85dc53600c
    reference_type: commit
    reference_id: d8efcf38b13df3e9e889cf7cc214cb85dc53600c
