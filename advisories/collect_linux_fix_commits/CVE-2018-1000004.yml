advisory_id: CVE-2018-1000004
datasource_id: collect_linux_fix_commits/CVE-2018-1000004
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  7bd80091567789f1c0cb70eb4737aac8bcd2b6b9:ALSA: seq: More protection for concurrent write and ioctl races

  This patch is an attempt for further hardening against races between
  the concurrent write and ioctls.  The previous fix d15d662e89fc
  ("ALSA: seq: Fix racy pool initializations") covered the race of the
  pool initialization at writer and the pool resize ioctl by the
  client->ioctl_mutex (CVE-2018-1000004).  However, basically this mutex
  should be applied more widely to the whole write operation for
  avoiding the unexpected pool operations by another thread.

  The only change outside snd_seq_write() is the additional mutex
  argument to helper functions, so that we can unlock / relock the given
  mutex temporarily during schedule() call for blocking write.

  Fixes: d15d662e89fc ("ALSA: seq: Fix racy pool initializations")
  Reported-by: 范龙飞 <long7573@126.com>
  Reported-by: Nicolai Stange <nstange@suse.de>
  Reviewed-and-tested-by: Nicolai Stange <nstange@suse.de>
  Cc: <stable@vger.kernel.org>
  Signed-off-by: Takashi Iwai <tiwai@suse.de>
  d85739367c6d56e475c281945c68fdb05ca74b4c:ALSA: seq: Don't allow resizing pool in use

  This is a fix for a (sort of) fallout in the recent commit
  d15d662e89fc ("ALSA: seq: Fix racy pool initializations") for
  CVE-2018-1000004.
  As the pool resize deletes the existing cells, it may lead to a race
  when another thread is writing concurrently, eventually resulting a
  UAF.

  A simple workaround is not to allow the pool resizing when the pool is
  in use.  It's an invalid behavior in anyway.

  Fixes: d15d662e89fc ("ALSA: seq: Fix racy pool initializations")
  Reported-by: 范龙飞 <long7573@126.com>
  Reported-by: Nicolai Stange <nstange@suse.de>
  Cc: <stable@vger.kernel.org>
  Signed-off-by: Takashi Iwai <tiwai@suse.de>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 7bd80091567789f1c0cb70eb4737aac8bcd2b6b9
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: d85739367c6d56e475c281945c68fdb05ca74b4c
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/7bd80091567789f1c0cb70eb4737aac8bcd2b6b9
    reference_type: commit
    reference_id: 7bd80091567789f1c0cb70eb4737aac8bcd2b6b9
  - url: https://github.com/torvalds/linux/tree/d85739367c6d56e475c281945c68fdb05ca74b4c
    reference_type: commit
    reference_id: d85739367c6d56e475c281945c68fdb05ca74b4c
