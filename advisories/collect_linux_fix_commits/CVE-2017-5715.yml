advisory_id: CVE-2017-5715
datasource_id: collect_linux_fix_commits/CVE-2017-5715
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  4bc352ffb39e4eec253e70f8c076f2f48a6c1926:arm64: KVM: Use SMCCC_ARCH_WORKAROUND_1 for Falkor BP hardening

  The function SMCCC_ARCH_WORKAROUND_1 was introduced as part of SMC
  V1.1 Calling Convention to mitigate CVE-2017-5715. This patch uses
  the standard call SMCCC_ARCH_WORKAROUND_1 for Falkor chips instead
  of Silicon provider service ID 0xC2001700.

  Cc: <stable@vger.kernel.org> # 4.14+
  Signed-off-by: Shanker Donthineni <shankerd@codeaurora.org>
  [maz: reworked errata framework integration]
  Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
  Signed-off-by: Will Deacon <will.deacon@arm.com>
  f9f5dc19509bbef6f5e675346f1a7d7b846bdb12:arm64: KVM: Use SMCCC_ARCH_WORKAROUND_1 for Falkor BP hardening

  The function SMCCC_ARCH_WORKAROUND_1 was introduced as part of SMC
  V1.1 Calling Convention to mitigate CVE-2017-5715. This patch uses
  the standard call SMCCC_ARCH_WORKAROUND_1 for Falkor chips instead
  of Silicon provider service ID 0xC2001700.

  Cc: <stable@vger.kernel.org> # 4.14+
  Signed-off-by: Shanker Donthineni <shankerd@codeaurora.org>
  Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
  6167ec5c9145cdf493722dfd80a5d48bafc4a18a:arm64: KVM: Report SMCCC_ARCH_WORKAROUND_1 BP hardening support

  A new feature of SMCCC 1.1 is that it offers firmware-based CPU
  workarounds. In particular, SMCCC_ARCH_WORKAROUND_1 provides
  BP hardening for CVE-2017-5715.

  If the host has some mitigation for this issue, report that
  we deal with it using SMCCC_ARCH_WORKAROUND_1, as we apply the
  host workaround on every guest exit.

  Tested-by: Ard Biesheuvel <ard.biesheuvel@linaro.org>
  Reviewed-by: Christoffer Dall <christoffer.dall@linaro.org>
  Signed-off-by: Marc Zyngier <marc.zyngier@arm.com>
  Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
  3214d01f139b7544e870fc0b7fcce8da13c1cb51:KVM: PPC: Book3S: Provide information about hardware/firmware CVE workarounds

  This adds a new ioctl, KVM_PPC_GET_CPU_CHAR, that gives userspace
  information about the underlying machine's level of vulnerability
  to the recently announced vulnerabilities CVE-2017-5715,
  CVE-2017-5753 and CVE-2017-5754, and whether the machine provides
  instructions to assist software to work around the vulnerabilities.

  The ioctl returns two u64 words describing characteristics of the
  CPU and required software behaviour respectively, plus two mask
  words which indicate which bits have been filled in by the kernel,
  for extensibility.  The bit definitions are the same as for the
  new H_GET_CPU_CHARACTERISTICS hypercall.

  There is also a new capability, KVM_CAP_PPC_GET_CPU_CHAR, which
  indicates whether the new ioctl is available.

  Signed-off-by: Paul Mackerras <paulus@ozlabs.org>
  290af86629b25ffd1ed6232c4e9107da031705cb:bpf: introduce BPF_JIT_ALWAYS_ON config

  The BPF interpreter has been used as part of the spectre 2 attack CVE-2017-5715.

  A quote from goolge project zero blog:
  "At this point, it would normally be necessary to locate gadgets in
  the host kernel code that can be used to actually leak data by reading
  from an attacker-controlled location, shifting and masking the result
  appropriately and then using the result of that as offset to an
  attacker-controlled address for a load. But piecing gadgets together
  and figuring out which ones work in a speculation context seems annoying.
  So instead, we decided to use the eBPF interpreter, which is built into
  the host kernel - while there is no legitimate way to invoke it from inside
  a VM, the presence of the code in the host kernel's text section is sufficient
  to make it usable for the attack, just like with ordinary ROP gadgets."

  To make attacker job harder introduce BPF_JIT_ALWAYS_ON config
  option that removes interpreter from the kernel in favor of JIT-only mode.
  So far eBPF JIT is supported by:
  x64, arm64, arm32, sparc64, s390, powerpc64, mips64

  The start of JITed program is randomized and code page is marked as read-only.
  In addition "constant blinding" can be turned on with net.core.bpf_jit_harden

  v2->v3:
  - move __bpf_prog_ret0 under ifdef (Daniel)

  v1->v2:
  - fix init order, test_bpf and cBPF (Daniel's feedback)
  - fix offloaded bpf (Jakub's feedback)
  - add 'return 0' dummy in case something can invoke prog->bpf_func
  - retarget bpf tree. For bpf-next the patch would need one extra hunk.
    It will be sent when the trees are merged back to net-next

  Considered doing:
    int bpf_jit_enable __read_mostly = BPF_EBPF_JIT_DEFAULT;
  but it seems better to land the patch as-is and in bpf-next remove
  bpf_jit_enable global variable from all JITs, consolidate in one place
  and remove this jit_init() function.

  Signed-off-by: Alexei Starovoitov <ast@kernel.org>
  Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: f9f5dc19509bbef6f5e675346f1a7d7b846bdb12
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 6167ec5c9145cdf493722dfd80a5d48bafc4a18a
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 290af86629b25ffd1ed6232c4e9107da031705cb
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 3214d01f139b7544e870fc0b7fcce8da13c1cb51
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 4bc352ffb39e4eec253e70f8c076f2f48a6c1926
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/290af86629b25ffd1ed6232c4e9107da031705cb
    reference_type: commit
    reference_id: 290af86629b25ffd1ed6232c4e9107da031705cb
  - url: https://github.com/torvalds/linux/tree/3214d01f139b7544e870fc0b7fcce8da13c1cb51
    reference_type: commit
    reference_id: 3214d01f139b7544e870fc0b7fcce8da13c1cb51
  - url: https://github.com/torvalds/linux/tree/4bc352ffb39e4eec253e70f8c076f2f48a6c1926
    reference_type: commit
    reference_id: 4bc352ffb39e4eec253e70f8c076f2f48a6c1926
  - url: https://github.com/torvalds/linux/tree/6167ec5c9145cdf493722dfd80a5d48bafc4a18a
    reference_type: commit
    reference_id: 6167ec5c9145cdf493722dfd80a5d48bafc4a18a
  - url: https://github.com/torvalds/linux/tree/f9f5dc19509bbef6f5e675346f1a7d7b846bdb12
    reference_type: commit
    reference_id: f9f5dc19509bbef6f5e675346f1a7d7b846bdb12
