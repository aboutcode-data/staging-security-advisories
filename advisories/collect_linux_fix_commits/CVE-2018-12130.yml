advisory_id: CVE-2018-12130
datasource_id: collect_linux_fix_commits/CVE-2018-12130
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  fa4bff165070dc40a3de35b78e4f8da8e8d85ec5:Merge branch 'x86-mds-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip

  Pull x86 MDS mitigations from Thomas Gleixner:
   "Microarchitectural Data Sampling (MDS) is a hardware vulnerability
    which allows unprivileged speculative access to data which is
    available in various CPU internal buffers. This new set of misfeatures
    has the following CVEs assigned:

       CVE-2018-12126  MSBDS  Microarchitectural Store Buffer Data Sampling
       CVE-2018-12130  MFBDS  Microarchitectural Fill Buffer Data Sampling
       CVE-2018-12127  MLPDS  Microarchitectural Load Port Data Sampling
       CVE-2019-11091  MDSUM  Microarchitectural Data Sampling Uncacheable Memory

    MDS attacks target microarchitectural buffers which speculatively
    forward data under certain conditions. Disclosure gadgets can expose
    this data via cache side channels.

    Contrary to other speculation based vulnerabilities the MDS
    vulnerability does not allow the attacker to control the memory target
    address. As a consequence the attacks are purely sampling based, but
    as demonstrated with the TLBleed attack samples can be postprocessed
    successfully.

    The mitigation is to flush the microarchitectural buffers on return to
    user space and before entering a VM. It's bolted on the VERW
    instruction and requires a microcode update. As some of the attacks
    exploit data structures shared between hyperthreads, full protection
    requires to disable hyperthreading. The kernel does not do that by
    default to avoid breaking unattended updates.

    The mitigation set comes with documentation for administrators and a
    deeper technical view"

  * 'x86-mds-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip: (23 commits)
    x86/speculation/mds: Fix documentation typo
    Documentation: Correct the possible MDS sysfs values
    x86/mds: Add MDSUM variant to the MDS documentation
    x86/speculation/mds: Add 'mitigations=' support for MDS
    x86/speculation/mds: Print SMT vulnerable on MSBDS with mitigations off
    x86/speculation/mds: Fix comment
    x86/speculation/mds: Add SMT warning message
    x86/speculation: Move arch_smt_update() call to after mitigation decisions
    x86/speculation/mds: Add mds=full,nosmt cmdline option
    Documentation: Add MDS vulnerability documentation
    Documentation: Move L1TF to separate directory
    x86/speculation/mds: Add mitigation mode VMWERV
    x86/speculation/mds: Add sysfs reporting for MDS
    x86/speculation/mds: Add mitigation control for MDS
    x86/speculation/mds: Conditionally clear CPU buffers on idle entry
    x86/kvm/vmx: Add MDS protection when L1D Flush is not active
    x86/speculation/mds: Clear CPU buffers on exit to user
    x86/speculation/mds: Add mds_clear_cpu_buffers()
    x86/kvm: Expose X86_FEATURE_MD_CLEAR to guests
    x86/speculation/mds: Add BUG_MSBDS_ONLY
    ...
  ed5194c2732c8084af9fd159c146ea92bf137128:x86/speculation/mds: Add basic bug infrastructure for MDS

  Microarchitectural Data Sampling (MDS), is a class of side channel attacks
  on internal buffers in Intel CPUs. The variants are:

   - Microarchitectural Store Buffer Data Sampling (MSBDS) (CVE-2018-12126)
   - Microarchitectural Fill Buffer Data Sampling (MFBDS) (CVE-2018-12130)
   - Microarchitectural Load Port Data Sampling (MLPDS) (CVE-2018-12127)

  MSBDS leaks Store Buffer Entries which can be speculatively forwarded to a
  dependent load (store-to-load forwarding) as an optimization. The forward
  can also happen to a faulting or assisting load operation for a different
  memory address, which can be exploited under certain conditions. Store
  buffers are partitioned between Hyper-Threads so cross thread forwarding is
  not possible. But if a thread enters or exits a sleep state the store
  buffer is repartitioned which can expose data from one thread to the other.

  MFBDS leaks Fill Buffer Entries. Fill buffers are used internally to manage
  L1 miss situations and to hold data which is returned or sent in response
  to a memory or I/O operation. Fill buffers can forward data to a load
  operation and also write data to the cache. When the fill buffer is
  deallocated it can retain the stale data of the preceding operations which
  can then be forwarded to a faulting or assisting load operation, which can
  be exploited under certain conditions. Fill buffers are shared between
  Hyper-Threads so cross thread leakage is possible.

  MLDPS leaks Load Port Data. Load ports are used to perform load operations
  from memory or I/O. The received data is then forwarded to the register
  file or a subsequent operation. In some implementations the Load Port can
  contain stale data from a previous operation which can be forwarded to
  faulting or assisting loads under certain conditions, which again can be
  exploited eventually. Load ports are shared between Hyper-Threads so cross
  thread leakage is possible.

  All variants have the same mitigation for single CPU thread case (SMT off),
  so the kernel can treat them as one MDS issue.

  Add the basic infrastructure to detect if the current CPU is affected by
  MDS.

  [ tglx: Rewrote changelog ]

  Signed-off-by: Andi Kleen <ak@linux.intel.com>
  Signed-off-by: Thomas Gleixner <tglx@linutronix.de>
  Reviewed-by: Borislav Petkov <bp@suse.de>
  Reviewed-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
  Reviewed-by: Frederic Weisbecker <frederic@kernel.org>
  Reviewed-by: Jon Masters <jcm@redhat.com>
  Tested-by: Jon Masters <jcm@redhat.com>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: fa4bff165070dc40a3de35b78e4f8da8e8d85ec5
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: ed5194c2732c8084af9fd159c146ea92bf137128
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/ed5194c2732c8084af9fd159c146ea92bf137128
    reference_type: commit
    reference_id: ed5194c2732c8084af9fd159c146ea92bf137128
  - url: https://github.com/torvalds/linux/tree/fa4bff165070dc40a3de35b78e4f8da8e8d85ec5
    reference_type: commit
    reference_id: fa4bff165070dc40a3de35b78e4f8da8e8d85ec5
