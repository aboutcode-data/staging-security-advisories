advisory_id: CVE-2016-7042
datasource_id: collect_linux_fix_commits/CVE-2016-7042
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: "43937003de5b677781b2fe4c871d628ab00cc341:Merge branch 'for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jmorris/linux-security\n\
  \nPull key fixes from James Morris:\n\n - fix a buffer overflow when displaying /proc/keys\
  \ [CVE-2016-7042].\n\n - fix broken initialisation in the big_key implementation that can\n\
  \   result in an oops.\n\n - make big_key depend on having a random number generator available\
  \ in\n   Kconfig.\n\n* 'for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jmorris/linux-security:\n\
  \  security/keys: make BIG_KEYS dependent on stdrng.\n  KEYS: Sort out big_key initialisation\n\
  \  KEYS: Fix short sprintf buffer in /proc/keys show function\n03dab869b7b239c4e013ec82aea22e181e441cfc:KEYS:\
  \ Fix short sprintf buffer in /proc/keys show function\n\nThis fixes CVE-2016-7042.\n\nFix\
  \ a short sprintf buffer in proc_keys_show().  If the gcc stack protector\nis turned on, this\
  \ can cause a panic due to stack corruption.\n\nThe problem is that xbuf[] is not big enough\
  \ to hold a 64-bit timeout\nrendered as weeks:\n\n\t(gdb) p 0xffffffffffffffffULL/(60*60*24*7)\n\
  \t$2 = 30500568904943\n\nThat's 14 chars plus NUL, not 11 chars plus NUL.\n\nExpand the buffer\
  \ to 16 chars.\n\nI think the unpatched code apparently works if the stack-protector is not\n\
  enabled because on a 32-bit machine the buffer won't be overflowed and on a\n64-bit machine\
  \ there's a 64-bit aligned pointer at one side and an int that\nisn't checked again on the\
  \ other side.\n\nThe panic incurred looks something like:\n\nKernel panic - not syncing: stack-protector:\
  \ Kernel stack is corrupted in: ffffffff81352ebe\nCPU: 0 PID: 1692 Comm: reproducer Not tainted\
  \ 4.7.2-201.fc24.x86_64 #1\nHardware name: Red Hat KVM, BIOS 0.5.1 01/01/2011\n 0000000000000086\
  \ 00000000fbbd2679 ffff8800a044bc00 ffffffff813d941f\n ffffffff81a28d58 ffff8800a044bc98 ffff8800a044bc88\
  \ ffffffff811b2cb6\n ffff880000000010 ffff8800a044bc98 ffff8800a044bc30 00000000fbbd2679\n\
  Call Trace:\n [<ffffffff813d941f>] dump_stack+0x63/0x84\n [<ffffffff811b2cb6>] panic+0xde/0x22a\n\
  \ [<ffffffff81352ebe>] ? proc_keys_show+0x3ce/0x3d0\n [<ffffffff8109f7f9>] __stack_chk_fail+0x19/0x30\n\
  \ [<ffffffff81352ebe>] proc_keys_show+0x3ce/0x3d0\n [<ffffffff81350410>] ? key_validate+0x50/0x50\n\
  \ [<ffffffff8134db30>] ? key_default_cmp+0x20/0x20\n [<ffffffff8126b31c>] seq_read+0x2cc/0x390\n\
  \ [<ffffffff812b6b12>] proc_reg_read+0x42/0x70\n [<ffffffff81244fc7>] __vfs_read+0x37/0x150\n\
  \ [<ffffffff81357020>] ? security_file_permission+0xa0/0xc0\n [<ffffffff81246156>] vfs_read+0x96/0x130\n\
  \ [<ffffffff81247635>] SyS_read+0x55/0xc0\n [<ffffffff817eb872>] entry_SYSCALL_64_fastpath+0x1a/0xa4\n\
  \nReported-by: Ondrej Kozina <okozina@redhat.com>\nSigned-off-by: David Howells <dhowells@redhat.com>\n\
  Tested-by: Ondrej Kozina <okozina@redhat.com>\ncc: stable@vger.kernel.org\nSigned-off-by:\
  \ James Morris <james.l.morris@oracle.com>"
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 43937003de5b677781b2fe4c871d628ab00cc341
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 03dab869b7b239c4e013ec82aea22e181e441cfc
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/03dab869b7b239c4e013ec82aea22e181e441cfc
    reference_type: commit
    reference_id: 03dab869b7b239c4e013ec82aea22e181e441cfc
  - url: https://github.com/torvalds/linux/tree/43937003de5b677781b2fe4c871d628ab00cc341
    reference_type: commit
    reference_id: 43937003de5b677781b2fe4c871d628ab00cc341
