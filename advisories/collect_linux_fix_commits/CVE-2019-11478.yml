advisory_id: CVE-2019-11478
datasource_id: collect_linux_fix_commits/CVE-2019-11478
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: "b617158dc096709d8600c53b6052144d12b89fab:tcp: be more careful in tcp_fragment()\n\n\
  Some applications set tiny SO_SNDBUF values and expect\nTCP to just work. Recent patches to\
  \ address CVE-2019-11478\nbroke them in case of losses, since retransmits might\nbe prevented.\n\
  \nWe should allow these flows to make progress.\n\nThis patch allows the first and last skb\
  \ in retransmit queue\nto be split even if memory limits are hit.\n\nIt also adds the some\
  \ room due to the fact that tcp_sendmsg()\nand tcp_sendpage() might overshoot sk_wmem_queued\
  \ by about one full\nTSO skb (64KB size). Note this allowance was already present\nin stable\
  \ backports for kernels < 4.15\n\nNote for < 4.15 backports :\n tcp_rtx_queue_tail() will\
  \ probably look like :\n\nstatic inline struct sk_buff *tcp_rtx_queue_tail(const struct sock\
  \ *sk)\n{\n\tstruct sk_buff *skb = tcp_send_head(sk);\n\n\treturn skb ? tcp_write_queue_prev(sk,\
  \ skb) : tcp_write_queue_tail(sk);\n}\n\nFixes: f070ef2ac667 (\"tcp: tcp_fragment() should\
  \ apply sane memory limits\")\nSigned-off-by: Eric Dumazet <edumazet@google.com>\nReported-by:\
  \ Andrew Prout <aprout@ll.mit.edu>\nTested-by: Andrew Prout <aprout@ll.mit.edu>\nTested-by:\
  \ Jonathan Lemon <jonathan.lemon@gmail.com>\nTested-by: Michal Kubecek <mkubecek@suse.cz>\n\
  Acked-by: Neal Cardwell <ncardwell@google.com>\nAcked-by: Yuchung Cheng <ycheng@google.com>\n\
  Acked-by: Christoph Paasch <cpaasch@apple.com>\nCc: Jonathan Looney <jtl@netflix.com>\nSigned-off-by:\
  \ David S. Miller <davem@davemloft.net>\nf070ef2ac66716357066b683fb0baf55f8191a2e:tcp: tcp_fragment()\
  \ should apply sane memory limits\n\nJonathan Looney reported that a malicious peer can force\
  \ a sender\nto fragment its retransmit queue into tiny skbs, inflating memory\nusage and/or\
  \ overflow 32bit counters.\n\nTCP allows an application to queue up to sk_sndbuf bytes,\n\
  so we need to give some allowance for non malicious splitting\nof retransmit queue.\n\nA new\
  \ SNMP counter is added to monitor how many times TCP\ndid not allow to split an skb if the\
  \ allowance was exceeded.\n\nNote that this counter might increase in the case applications\n\
  use SO_SNDBUF socket option to lower sk_sndbuf.\n\nCVE-2019-11478 : tcp_fragment, prevent\
  \ fragmenting a packet when the\n\tsocket is already using more than half the allowed space\n\
  \nSigned-off-by: Eric Dumazet <edumazet@google.com>\nReported-by: Jonathan Looney <jtl@netflix.com>\n\
  Acked-by: Neal Cardwell <ncardwell@google.com>\nAcked-by: Yuchung Cheng <ycheng@google.com>\n\
  Reviewed-by: Tyler Hicks <tyhicks@canonical.com>\nCc: Bruce Curtis <brucec@netflix.com>\n\
  Cc: Jonathan Lemon <jonathan.lemon@gmail.com>\nSigned-off-by: David S. Miller <davem@davemloft.net>"
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: b617158dc096709d8600c53b6052144d12b89fab
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: f070ef2ac66716357066b683fb0baf55f8191a2e
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/b617158dc096709d8600c53b6052144d12b89fab
    reference_type: commit
    reference_id: b617158dc096709d8600c53b6052144d12b89fab
  - url: https://github.com/torvalds/linux/tree/f070ef2ac66716357066b683fb0baf55f8191a2e
    reference_type: commit
    reference_id: f070ef2ac66716357066b683fb0baf55f8191a2e
