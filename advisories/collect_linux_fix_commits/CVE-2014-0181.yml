advisory_id: CVE-2014-0181
datasource_id: collect_linux_fix_commits/CVE-2014-0181
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  2d7a85f4b06e9c27ff629f07a524c48074f07f81:netlink: Only check file credentials for implicit destinations

  It was possible to get a setuid root or setcap executable to write to
  it's stdout or stderr (which has been set made a netlink socket) and
  inadvertently reconfigure the networking stack.

  To prevent this we check that both the creator of the socket and
  the currentl applications has permission to reconfigure the network
  stack.

  Unfortunately this breaks Zebra which always uses sendto/sendmsg
  and creates it's socket without any privileges.

  To keep Zebra working don't bother checking if the creator of the
  socket has privilege when a destination address is specified.  Instead
  rely exclusively on the privileges of the sender of the socket.

  Note from Andy: This is exactly Eric's code except for some comment
  clarifications and formatting fixes.  Neither I nor, I think, anyone
  else is thrilled with this approach, but I'm hesitant to wait on a
  better fix since 3.15 is almost here.

  Note to stable maintainers: This is a mess.  An earlier series of
  patches in 3.15 fix a rather serious security issue (CVE-2014-0181),
  but they did so in a way that breaks Zebra.  The offending series
  includes:

      commit aa4cf9452f469f16cea8c96283b641b4576d4a7b
      Author: Eric W. Biederman <ebiederm@xmission.com>
      Date:   Wed Apr 23 14:28:03 2014 -0700

          net: Add variants of capable for use on netlink messages

  If a given kernel version is missing that series of fixes, it's
  probably worth backporting it and this patch.  if that series is
  present, then this fix is critical if you care about Zebra.

  Cc: stable@vger.kernel.org
  Signed-off-by: "Eric W. Biederman" <ebiederm@xmission.com>
  Signed-off-by: Andy Lutomirski <luto@amacapital.net>
  Signed-off-by: David S. Miller <davem@davemloft.net>
  29e8f59cf1ff91f2854563faddc5f61098cf4958:Merge branch 'netlink-caps'

  Eric W. Biederman says:

  ====================
  netlink: Preventing abuse when passing file descriptors.

  Andy Lutomirski when looking at the networking stack noticed that it is
  possible to trick privilged processes into calling write on a netlink
  socket and send netlink messages they did not intend.

  In particular from time to time there are suid applications that will
  write to stdout or stderr without checking exactly what kind of file
  descriptors those are and can be tricked into acting as a limited form
  of suid cat.  In other conversations the magic string CVE-2014-0181 has
  been used to talk about this issue.

  This patchset cleans things up a bit, adds some clean abstractions that
  when used prevent this kind of problem and then finally changes all of
  the handlers of netlink messages that I could find that call capable to
  use netlink_ns_capable or an appropriate wrapper.

  The abstraction netlink_ns_capable verifies that the original creator of
  the netlink socket a message is sent from had the necessary capabilities
  as well as verifying that the current sender of a netlink packet has the
  necessary capabilities.

  The idea is to prevent file descriptor passing of any form from
  resulting in a file descriptor that can do more than it can for the
  creator of the file descriptor.
  ====================

  Signed-off-by: David S. Miller <davem@davemloft.net>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 29e8f59cf1ff91f2854563faddc5f61098cf4958
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 2d7a85f4b06e9c27ff629f07a524c48074f07f81
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/29e8f59cf1ff91f2854563faddc5f61098cf4958
    reference_type: commit
    reference_id: 29e8f59cf1ff91f2854563faddc5f61098cf4958
  - url: https://github.com/torvalds/linux/tree/2d7a85f4b06e9c27ff629f07a524c48074f07f81
    reference_type: commit
    reference_id: 2d7a85f4b06e9c27ff629f07a524c48074f07f81
