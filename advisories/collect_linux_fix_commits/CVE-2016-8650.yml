advisory_id: CVE-2016-8650
datasource_id: collect_linux_fix_commits/CVE-2016-8650
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: "86b01b5419fd303a3699b2ce6f4b9bfbdaa4ed37:Merge branch 'for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/jmorris/linux-security\n\
  \nPull keys fixes from James Morris:\n \"From David:\n\n   - Fix mpi_powm()'s handling of\
  \ a number with a zero exponent\n     [CVE-2016-8650].\n\n     Integrate my and Andrey's patches\
  \ for mpi_powm() and use\n     mpi_resize() instead of RESIZE_IF_NEEDED() - the latter adds\
  \ a\n     duplicate check into the execution path of a trivial case we\n     don't normally\
  \ expect to be taken.\n\n   - Fix double free in X.509 error handling\"\n\n* 'for-linus' of\
  \ git://git.kernel.org/pub/scm/linux/kernel/git/jmorris/linux-security:\n  mpi: Fix NULL ptr\
  \ dereference in mpi_powm() [ver #3]\n  X.509: Fix double free in x509_cert_parse() [ver #3]\n\
  f5527fffff3f002b0a6b376163613b82f69de073:mpi: Fix NULL ptr dereference in mpi_powm() [ver\
  \ #3]\n\nThis fixes CVE-2016-8650.\n\nIf mpi_powm() is given a zero exponent, it wants to\
  \ immediately return\neither 1 or 0, depending on the modulus.  However, if the result was\n\
  initalised with zero limb space, no limbs space is allocated and a\nNULL-pointer exception\
  \ ensues.\n\nFix this by allocating a minimal amount of limb space for the result when\nthe\
  \ 0-exponent case when the result is 1 and not touching the limb space\nwhen the result is\
  \ 0.\n\nThis affects the use of RSA keys and X.509 certificates that carry them.\n\nBUG: unable\
  \ to handle kernel NULL pointer dereference at           (null)\nIP: [<ffffffff8138ce5d>]\
  \ mpi_powm+0x32/0x7e6\nPGD 0\nOops: 0002 [#1] SMP\nModules linked in:\nCPU: 3 PID: 3014 Comm:\
  \ keyctl Not tainted 4.9.0-rc6-fscache+ #278\nHardware name: ASUS All Series/H97-PLUS, BIOS\
  \ 2306 10/09/2014\ntask: ffff8804011944c0 task.stack: ffff880401294000\nRIP: 0010:[<ffffffff8138ce5d>]\
  \  [<ffffffff8138ce5d>] mpi_powm+0x32/0x7e6\nRSP: 0018:ffff880401297ad8  EFLAGS: 00010212\n\
  RAX: 0000000000000000 RBX: ffff88040868bec0 RCX: ffff88040868bba0\nRDX: ffff88040868b260 RSI:\
  \ ffff88040868bec0 RDI: ffff88040868bee0\nRBP: ffff880401297ba8 R08: 0000000000000000 R09:\
  \ 0000000000000000\nR10: 0000000000000047 R11: ffffffff8183b210 R12: 0000000000000000\nR13:\
  \ ffff8804087c7600 R14: 000000000000001f R15: ffff880401297c50\nFS:  00007f7a7918c700(0000)\
  \ GS:ffff88041fb80000(0000) knlGS:0000000000000000\nCS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033\n\
  CR2: 0000000000000000 CR3: 0000000401250000 CR4: 00000000001406e0\nStack:\n ffff88040868bec0\
  \ 0000000000000020 ffff880401297b00 ffffffff81376cd4\n 0000000000000100 ffff880401297b10 ffffffff81376d12\
  \ ffff880401297b30\n ffffffff81376f37 0000000000000100 0000000000000000 ffff880401297ba8\n\
  Call Trace:\n [<ffffffff81376cd4>] ? __sg_page_iter_next+0x43/0x66\n [<ffffffff81376d12>]\
  \ ? sg_miter_get_next_page+0x1b/0x5d\n [<ffffffff81376f37>] ? sg_miter_next+0x17/0xbd\n [<ffffffff8138ba3a>]\
  \ ? mpi_read_raw_from_sgl+0xf2/0x146\n [<ffffffff8132a95c>] rsa_verify+0x9d/0xee\n [<ffffffff8132acca>]\
  \ ? pkcs1pad_sg_set_buf+0x2e/0xbb\n [<ffffffff8132af40>] pkcs1pad_verify+0xc0/0xe1\n [<ffffffff8133cb5e>]\
  \ public_key_verify_signature+0x1b0/0x228\n [<ffffffff8133d974>] x509_check_for_self_signed+0xa1/0xc4\n\
  \ [<ffffffff8133cdde>] x509_cert_parse+0x167/0x1a1\n [<ffffffff8133d609>] x509_key_preparse+0x21/0x1a1\n\
  \ [<ffffffff8133c3d7>] asymmetric_key_preparse+0x34/0x61\n [<ffffffff812fc9f3>] key_create_or_update+0x145/0x399\n\
  \ [<ffffffff812fe227>] SyS_add_key+0x154/0x19e\n [<ffffffff81001c2b>] do_syscall_64+0x80/0x191\n\
  \ [<ffffffff816825e4>] entry_SYSCALL64_slow_path+0x25/0x25\nCode: 56 41 55 41 54 53 48 81\
  \ ec a8 00 00 00 44 8b 71 04 8b 42 04 4c 8b 67 18 45 85 f6 89 45 80 0f 84 b4 06 00 00 85 c0\
  \ 75 2f 41 ff ce <49> c7 04 24 01 00 00 00 b0 01 75 0b 48 8b 41 18 48 83 38 01 0f\nRIP  [<ffffffff8138ce5d>]\
  \ mpi_powm+0x32/0x7e6\n RSP <ffff880401297ad8>\nCR2: 0000000000000000\n---[ end trace d82015255d4a5d8d\
  \ ]---\n\nBasically, this is a backport of a libgcrypt patch:\n\n\thttp://git.gnupg.org/cgi-bin/gitweb.cgi?p=libgcrypt.git;a=patch;h=6e1adb05d290aeeb1c230c763970695f4a538526\n\
  \nFixes: cdec9cb5167a (\"crypto: GnuPG based MPI lib - source files (part 1)\")\nSigned-off-by:\
  \ Andrey Ryabinin <aryabinin@virtuozzo.com>\nSigned-off-by: David Howells <dhowells@redhat.com>\n\
  cc: Dmitry Kasatkin <dmitry.kasatkin@gmail.com>\ncc: linux-ima-devel@lists.sourceforge.net\n\
  cc: stable@vger.kernel.org\nSigned-off-by: James Morris <james.l.morris@oracle.com>"
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: f5527fffff3f002b0a6b376163613b82f69de073
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 86b01b5419fd303a3699b2ce6f4b9bfbdaa4ed37
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/86b01b5419fd303a3699b2ce6f4b9bfbdaa4ed37
    reference_type: commit
    reference_id: 86b01b5419fd303a3699b2ce6f4b9bfbdaa4ed37
  - url: https://github.com/torvalds/linux/tree/f5527fffff3f002b0a6b376163613b82f69de073
    reference_type: commit
    reference_id: f5527fffff3f002b0a6b376163613b82f69de073
