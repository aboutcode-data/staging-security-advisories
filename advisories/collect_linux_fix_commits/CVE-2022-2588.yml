advisory_id: CVE-2022-2588
datasource_id: collect_linux_fix_commits/CVE-2022-2588
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  9ad36309e2719a884f946678e0296be10f0bb4c1:net_sched: cls_route: remove from list when handle is 0

  When a route filter is replaced and the old filter has a 0 handle, the old
  one won't be removed from the hashtable, while it will still be freed.

  The test was there since before commit 1109c00547fc ("net: sched: RCU
  cls_route"), when a new filter was not allocated when there was an old one.
  The old filter was reused and the reinserting would only be necessary if an
  old filter was replaced. That was still wrong for the same case where the
  old handle was 0.

  Remove the old filter from the list independently from its handle value.

  This fixes CVE-2022-2588, also reported as ZDI-CAN-17440.

  Reported-by: Zhenpeng Lin <zplin@u.northwestern.edu>
  Signed-off-by: Thadeu Lima de Souza Cascardo <cascardo@canonical.com>
  Reviewed-by: Kamal Mostafa <kamal@canonical.com>
  Cc: <stable@vger.kernel.org>
  Acked-by: Jamal Hadi Salim <jhs@mojatatu.com>
  Link: https://lore.kernel.org/r/20220809170518.164662-1-cascardo@canonical.com
  Signed-off-by: Jakub Kicinski <kuba@kernel.org>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 9ad36309e2719a884f946678e0296be10f0bb4c1
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/9ad36309e2719a884f946678e0296be10f0bb4c1
    reference_type: commit
    reference_id: 9ad36309e2719a884f946678e0296be10f0bb4c1
