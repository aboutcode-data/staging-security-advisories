advisory_id: CVE-2018-3620
datasource_id: collect_linux_fix_commits/CVE-2018-3620
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: "958f338e96f874a0d29442396d6adf9c1e17aa2d:Merge branch 'l1tf-final' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip\n\
  \nMerge L1 Terminal Fault fixes from Thomas Gleixner:\n \"L1TF, aka L1 Terminal Fault, is\
  \ yet another speculative hardware\n  engineering trainwreck. It's a hardware vulnerability\
  \ which allows\n  unprivileged speculative access to data which is available in the\n  Level\
  \ 1 Data Cache when the page table entry controlling the virtual\n  address, which is used\
  \ for the access, has the Present bit cleared or\n  other reserved bits set.\n\n  If an instruction\
  \ accesses a virtual address for which the relevant\n  page table entry (PTE) has the Present\
  \ bit cleared or other reserved\n  bits set, then speculative execution ignores the invalid\
  \ PTE and loads\n  the referenced data if it is present in the Level 1 Data Cache, as if\n\
  \  the page referenced by the address bits in the PTE was still present\n  and accessible.\n\
  \n  While this is a purely speculative mechanism and the instruction will\n  raise a page\
  \ fault when it is retired eventually, the pure act of\n  loading the data and making it available\
  \ to other speculative\n  instructions opens up the opportunity for side channel attacks to\n\
  \  unprivileged malicious code, similar to the Meltdown attack.\n\n  While Meltdown breaks\
  \ the user space to kernel space protection, L1TF\n  allows to attack any physical memory\
  \ address in the system and the\n  attack works across all protection domains. It allows an\
  \ attack of SGX\n  and also works from inside virtual machines because the speculation\n \
  \ bypasses the extended page table (EPT) protection mechanism.\n\n  The assoicated CVEs are:\
  \ CVE-2018-3615, CVE-2018-3620, CVE-2018-3646\n\n  The mitigations provided by this pull request\
  \ include:\n\n   - Host side protection by inverting the upper address bits of a non\n   \
  \  present page table entry so the entry points to uncacheable memory.\n\n   - Hypervisor\
  \ protection by flushing L1 Data Cache on VMENTER.\n\n   - SMT (HyperThreading) control knobs,\
  \ which allow to 'turn off' SMT\n     by offlining the sibling CPU threads. The knobs are\
  \ available on\n     the kernel command line and at runtime via sysfs\n\n   - Control knobs\
  \ for the hypervisor mitigation, related to L1D flush\n     and SMT control. The knobs are\
  \ available on the kernel command line\n     and at runtime via sysfs\n\n   - Extensive documentation\
  \ about L1TF including various degrees of\n     mitigations.\n\n  Thanks to all people who\
  \ have contributed to this in various ways -\n  patches, review, testing, backporting - and\
  \ the fruitful, sometimes\n  heated, but at the end constructive discussions.\n\n  There is\
  \ work in progress to provide other forms of mitigations, which\n  might be less horrible\
  \ performance wise for a particular kind of\n  workloads, but this is not yet ready for consumption\
  \ due to their\n  complexity and limitations\"\n\n* 'l1tf-final' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/tip:\
  \ (75 commits)\n  x86/microcode: Allow late microcode loading with SMT disabled\n  tools headers:\
  \ Synchronise x86 cpufeatures.h for L1TF additions\n  x86/mm/kmmio: Make the tracer robust\
  \ against L1TF\n  x86/mm/pat: Make set_memory_np() L1TF safe\n  x86/speculation/l1tf: Make\
  \ pmd/pud_mknotpresent() invert\n  x86/speculation/l1tf: Invert all not present mappings\n\
  \  cpu/hotplug: Fix SMT supported evaluation\n  KVM: VMX: Tell the nested hypervisor to skip\
  \ L1D flush on vmentry\n  x86/speculation: Use ARCH_CAPABILITIES to skip L1D flush on vmentry\n\
  \  x86/speculation: Simplify sysfs report of VMX L1TF vulnerability\n  Documentation/l1tf:\
  \ Remove Yonah processors from not vulnerable list\n  x86/KVM/VMX: Don't set l1tf_flush_l1d\
  \ from vmx_handle_external_intr()\n  x86/irq: Let interrupt handlers set kvm_cpu_l1tf_flush_l1d\n\
  \  x86: Don't include linux/irq.h from asm/hardirq.h\n  x86/KVM/VMX: Introduce per-host-cpu\
  \ analogue of l1tf_flush_l1d\n  x86/irq: Demote irq_cpustat_t::__softirq_pending to u16\n\
  \  x86/KVM/VMX: Move the l1tf_flush_l1d test to vmx_l1d_flush()\n  x86/KVM/VMX: Replace 'vmx_l1d_flush_always'\
  \ with 'vmx_l1d_flush_cond'\n  x86/KVM/VMX: Don't set l1tf_flush_l1d to true from vmx_l1d_flush()\n\
  \  cpu/hotplug: detect SMT disabled by BIOS\n  ...\na399477e52c17e148746d3ce9a483f681c2aa9a0:x86/KVM/VMX:\
  \ Add module argument for L1TF mitigation\n\nAdd a mitigation mode parameter \"vmentry_l1d_flush\"\
  \ for CVE-2018-3620, aka\nL1 terminal fault. The valid arguments are:\n\n - \"always\" \t\
  L1D cache flush on every VMENTER.\n - \"cond\"\tConditional L1D cache flush, explained below\n\
  \ - \"never\"\tDisable the L1D cache flush mitigation\n\n\"cond\" is trying to avoid L1D cache\
  \ flushes on VMENTER if the code executed\nbetween VMEXIT and VMENTER is considered safe,\
  \ i.e. is not bringing any\ninteresting information into L1D which might exploited.\n\n[ tglx:\
  \ Split out from a larger patch ]\n\nSigned-off-by: Konrad Rzeszutek Wilk <konrad.wilk@oracle.com>\n\
  Signed-off-by: Thomas Gleixner <tglx@linutronix.de>"
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: a399477e52c17e148746d3ce9a483f681c2aa9a0
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 958f338e96f874a0d29442396d6adf9c1e17aa2d
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/958f338e96f874a0d29442396d6adf9c1e17aa2d
    reference_type: commit
    reference_id: 958f338e96f874a0d29442396d6adf9c1e17aa2d
  - url: https://github.com/torvalds/linux/tree/a399477e52c17e148746d3ce9a483f681c2aa9a0
    reference_type: commit
    reference_id: a399477e52c17e148746d3ce9a483f681c2aa9a0
