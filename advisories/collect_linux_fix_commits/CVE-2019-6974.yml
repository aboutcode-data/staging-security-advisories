advisory_id: CVE-2019-6974
datasource_id: collect_linux_fix_commits/CVE-2019-6974
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  6fb845f0e78de19eaaf6a2d351702474e44b6a9e:Merge tag 'v5.0-rc6' into for-5.1/block

  Pull in 5.0-rc6 to avoid a dumb merge conflict with fs/iomap.c.
  This is needed since io_uring is now based on the block branch,
  to avoid a conflict between the multi-page bvecs and the bits
  of io_uring that touch the core block parts.

  * tag 'v5.0-rc6': (525 commits)
    Linux 5.0-rc6
    x86/mm: Make set_pmd_at() paravirt aware
    MAINTAINERS: Update the ocores i2c bus driver maintainer, etc
    blk-mq: remove duplicated definition of blk_mq_freeze_queue
    Blk-iolatency: warn on negative inflight IO counter
    blk-iolatency: fix IO hang due to negative inflight counter
    MAINTAINERS: unify reference to xen-devel list
    x86/mm/cpa: Fix set_mce_nospec()
    futex: Handle early deadlock return correctly
    futex: Fix barrier comment
    net: dsa: b53: Fix for failure when irq is not defined in dt
    blktrace: Show requests without sector
    mips: cm: reprime error cause
    mips: loongson64: remove unreachable(), fix loongson_poweroff().
    sit: check if IPv6 enabled before calling ip6_err_gen_icmpv6_unreach()
    geneve: should not call rt6_lookup() when ipv6 was disabled
    KVM: nVMX: unconditionally cancel preemption timer in free_nested (CVE-2019-7221)
    KVM: x86: work around leak of uninitialized stack contents (CVE-2019-7222)
    kvm: fix kvm_ioctl_create_device() reference counting (CVE-2019-6974)
    signal: Better detection of synchronous signals
    ...
  e303a067ceede918fbf90ff3dc8affbb98bad4e8:Merge tag 'for-linus' of git://git.kernel.org/pub/scm/virt/kvm/kvm

  Pull KVM fixes from Paolo Bonzini:
   "Three security fixes"

  * tag 'for-linus' of git://git.kernel.org/pub/scm/virt/kvm/kvm:
    KVM: nVMX: unconditionally cancel preemption timer in free_nested (CVE-2019-7221)
    KVM: x86: work around leak of uninitialized stack contents (CVE-2019-7222)
    kvm: fix kvm_ioctl_create_device() reference counting (CVE-2019-6974)
  cfa39381173d5f969daf43582c95ad679189cbc9:kvm: fix kvm_ioctl_create_device() reference counting (CVE-2019-6974)

  kvm_ioctl_create_device() does the following:

  1. creates a device that holds a reference to the VM object (with a borrowed
     reference, the VM's refcount has not been bumped yet)
  2. initializes the device
  3. transfers the reference to the device to the caller's file descriptor table
  4. calls kvm_get_kvm() to turn the borrowed reference to the VM into a real
     reference

  The ownership transfer in step 3 must not happen before the reference to the VM
  becomes a proper, non-borrowed reference, which only happens in step 4.
  After step 3, an attacker can close the file descriptor and drop the borrowed
  reference, which can cause the refcount of the kvm object to drop to zero.

  This means that we need to grab a reference for the device before
  anon_inode_getfd(), otherwise the VM can disappear from under us.

  Fixes: 852b6d57dc7f ("kvm: add device control API")
  Cc: stable@kernel.org
  Signed-off-by: Jann Horn <jannh@google.com>
  Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: e303a067ceede918fbf90ff3dc8affbb98bad4e8
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: cfa39381173d5f969daf43582c95ad679189cbc9
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 6fb845f0e78de19eaaf6a2d351702474e44b6a9e
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/6fb845f0e78de19eaaf6a2d351702474e44b6a9e
    reference_type: commit
    reference_id: 6fb845f0e78de19eaaf6a2d351702474e44b6a9e
  - url: https://github.com/torvalds/linux/tree/cfa39381173d5f969daf43582c95ad679189cbc9
    reference_type: commit
    reference_id: cfa39381173d5f969daf43582c95ad679189cbc9
  - url: https://github.com/torvalds/linux/tree/e303a067ceede918fbf90ff3dc8affbb98bad4e8
    reference_type: commit
    reference_id: e303a067ceede918fbf90ff3dc8affbb98bad4e8
