advisory_id: CVE-2019-19921
datasource_id: collect_linux_fix_commits/CVE-2019-19921
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  f70d24c230bcaa1e95f66252133068a98c895200:Merge tag 'vfs-6.17-rc1.nsfs' of git://git.kernel.org/pub/scm/linux/kernel/git/vfs/vfs

  Pull namespace updates from Christian Brauner:
   "This contains namespace updates. This time specifically for nsfs:

     - Userspace heavily relies on the root inode numbers for namespaces
       to identify the initial namespaces. That's already a hard
       dependency. So we cannot change that anymore. Move the initial
       inode numbers to a public header and align the only two namespaces
       that currently don't do that with all the other namespaces.

     - The root inode of /proc having a fixed inode number has been part
       of the core kernel ABI since its inception, and recently some
       userspace programs (mainly container runtimes) have started to
       explicitly depend on this behaviour.

       The main reason this is useful to userspace is that by checking
       that a suspect /proc handle has fstype PROC_SUPER_MAGIC and is
       PROCFS_ROOT_INO, they can then use openat2() together with
       RESOLVE_{NO_{XDEV,MAGICLINK},BENEATH} to ensure that there isn't a
       bind-mount that replaces some procfs file with a different one.

       This kind of attack has lead to security issues in container
       runtimes in the past (such as CVE-2019-19921) and libraries like
       libpathrs[1] use this feature of procfs to provide safe procfs
       handling functions"

  * tag 'vfs-6.17-rc1.nsfs' of git://git.kernel.org/pub/scm/linux/kernel/git/vfs/vfs:
    uapi: export PROCFS_ROOT_INO
    mntns: use stable inode number for initial mount ns
    netns: use stable inode number for initial mount ns
    nsfs: move root inode number to uapi
  76fdb7eb4e1c91086ce9c3db6972c2ed48c96afb:uapi: export PROCFS_ROOT_INO

  The root inode of /proc having a fixed inode number has been part of the
  core kernel ABI since its inception, and recently some userspace
  programs (mainly container runtimes) have started to explicitly depend
  on this behaviour.

  The main reason this is useful to userspace is that by checking that a
  suspect /proc handle has fstype PROC_SUPER_MAGIC and is PROCFS_ROOT_INO,
  they can then use openat2(RESOLVE_{NO_{XDEV,MAGICLINK},BENEATH}) to
  ensure that there isn't a bind-mount that replaces some procfs file with
  a different one. This kind of attack has lead to security issues in
  container runtimes in the past (such as CVE-2019-19921) and libraries
  like libpathrs[1] use this feature of procfs to provide safe procfs
  handling functions.

  There was also some trailing whitespace in the "struct proc_dir_entry"
  initialiser, so fix that up as well.

  [1]: https://github.com/openSUSE/libpathrs

  Signed-off-by: Aleksa Sarai <cyphar@cyphar.com>
  Link: https://lore.kernel.org/20250708-uapi-procfs-root-ino-v1-1-6ae61e97c79b@cyphar.com
  Signed-off-by: Christian Brauner <brauner@kernel.org>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 76fdb7eb4e1c91086ce9c3db6972c2ed48c96afb
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: f70d24c230bcaa1e95f66252133068a98c895200
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/76fdb7eb4e1c91086ce9c3db6972c2ed48c96afb
    reference_type: commit
    reference_id: 76fdb7eb4e1c91086ce9c3db6972c2ed48c96afb
  - url: https://github.com/torvalds/linux/tree/f70d24c230bcaa1e95f66252133068a98c895200
    reference_type: commit
    reference_id: f70d24c230bcaa1e95f66252133068a98c895200
