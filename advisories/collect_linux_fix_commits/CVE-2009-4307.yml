advisory_id: CVE-2009-4307
datasource_id: collect_linux_fix_commits/CVE-2009-4307
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: "d50f2ab6f050311dbf7b8f5501b25f0bf64a439b:ext4: fix undefined behavior in ext4_fill_flex_info()\n\
  \nCommit 503358ae01b70ce6909d19dd01287093f6b6271c (\"ext4: avoid divide by\nzero when trying\
  \ to mount a corrupted file system\") fixes CVE-2009-4307\nby performing a sanity check on\
  \ s_log_groups_per_flex, since it can be\nset to a bogus value by an attacker.\n\n\tsbi->s_log_groups_per_flex\
  \ = sbi->s_es->s_log_groups_per_flex;\n\tgroups_per_flex = 1 << sbi->s_log_groups_per_flex;\n\
  \n\tif (groups_per_flex < 2) { ... }\n\nThis patch fixes two potential issues in the previous\
  \ commit.\n\n1) The sanity check might only work on architectures like PowerPC.\nOn x86, 5\
  \ bits are used for the shifting amount.  That means, given a\nlarge s_log_groups_per_flex\
  \ value like 36, groups_per_flex = 1 << 36\nis essentially 1 << 4 = 16, rather than 0.  This\
  \ will bypass the check,\nleaving s_log_groups_per_flex and groups_per_flex inconsistent.\n\
  \n2) The sanity check relies on undefined behavior, i.e., oversized shift.\nA standard-confirming\
  \ C compiler could rewrite the check in unexpected\nways.  Consider the following equivalent\
  \ form, assuming groups_per_flex\nis unsigned for simplicity.\n\n\tgroups_per_flex = 1 <<\
  \ sbi->s_log_groups_per_flex;\n\tif (groups_per_flex == 0 || groups_per_flex == 1) {\n\nWe\
  \ compile the code snippet using Clang 3.0 and GCC 4.6.  Clang will\ncompletely optimize away\
  \ the check groups_per_flex == 0, leaving the\npatched code as vulnerable as the original.\
  \  GCC keeps the check, but\nthere is no guarantee that future versions will do the same.\n\
  \nSigned-off-by: Xi Wang <xi.wang@gmail.com>\nSigned-off-by: \"Theodore Ts'o\" <tytso@mit.edu>\n\
  Cc: stable@vger.kernel.org"
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: d50f2ab6f050311dbf7b8f5501b25f0bf64a439b
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/d50f2ab6f050311dbf7b8f5501b25f0bf64a439b
    reference_type: commit
    reference_id: d50f2ab6f050311dbf7b8f5501b25f0bf64a439b
