advisory_id: CVE-2018-1108
datasource_id: collect_linux_fix_commits/CVE-2018-1108
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  a26fb01c2879ed7026e6cbd78bb701912d249eef:Merge tag 'random_for_linus_stable' of git://git.kernel.org/pub/scm/linux/kernel/git/tytso/random

  Pull random fixes from Ted Ts'o:
   "In reaction to the fixes to address CVE-2018-1108, some Linux
    distributions that have certain systemd versions in some cases
    combined with patches to libcrypt for FIPS/FEDRAMP compliance, have
    led to boot-time stalls for some hardware.

    The reaction by some distros and Linux sysadmins has been to install
    packages that try to do complicated things with the CPU and hope that
    leads to randomness.

    To mitigate this, if RDRAND is available, mix it into entropy provided
    by userspace. It won't hurt, and it will probably help"

  * tag 'random_for_linus_stable' of git://git.kernel.org/pub/scm/linux/kernel/git/tytso/random:
    random: mix rdrand with entropy sent in from userspace
  8ef35c866f8862df074a49a93b0309725812dea8:random: set up the NUMA crng instances after the CRNG is fully initialized

  Until the primary_crng is fully initialized, don't initialize the NUMA
  crng nodes.  Otherwise users of /dev/urandom on NUMA systems before
  the CRNG is fully initialized can get very bad quality randomness.  Of
  course everyone should move to getrandom(2) where this won't be an
  issue, but there's a lot of legacy code out there.  This related to
  CVE-2018-1108.

  Reported-by: Jann Horn <jannh@google.com>
  Fixes: 1e7f583af67b ("random: make /dev/urandom scalable for silly...")
  Cc: stable@kernel.org # 4.8+
  Signed-off-by: Theodore Ts'o <tytso@mit.edu>
  dc12baacb95f205948f64dc936a47d89ee110117:random: use a different mixing algorithm for add_device_randomness()

  add_device_randomness() use of crng_fast_load() was highly
  problematic.  Some callers of add_device_randomness() can pass in a
  large amount of static information.  This would immediately promote
  the crng_init state from 0 to 1, without really doing much to
  initialize the primary_crng's internal state with something even
  vaguely unpredictable.

  Since we don't have the speed constraints of add_interrupt_randomness(),
  we can do a better job mixing in the what unpredictability a device
  driver or architecture maintainer might see fit to give us, and do it
  in a way which does not bump the crng_init_cnt variable.

  Also, since add_device_randomness() doesn't bump any entropy
  accounting in crng_init state 0, mix the device randomness into the
  input_pool entropy pool as well.  This is related to CVE-2018-1108.

  Reported-by: Jann Horn <jannh@google.com>
  Fixes: ee7998c50c26 ("random: do not ignore early device randomness")
  Cc: stable@kernel.org # 4.13+
  Signed-off-by: Theodore Ts'o <tytso@mit.edu>
  43838a23a05fbd13e47d750d3dfd77001536dd33:random: fix crng_ready() test

  The crng_init variable has three states:

  0: The CRNG is not initialized at all
  1: The CRNG has a small amount of entropy, hopefully good enough for
     early-boot, non-cryptographical use cases
  2: The CRNG is fully initialized and we are sure it is safe for
     cryptographic use cases.

  The crng_ready() function should only return true once we are in the
  last state.  This addresses CVE-2018-1108.

  Reported-by: Jann Horn <jannh@google.com>
  Fixes: e192be9d9a30 ("random: replace non-blocking pool...")
  Cc: stable@kernel.org # 4.8+
  Signed-off-by: Theodore Ts'o <tytso@mit.edu>
  Reviewed-by: Jann Horn <jannh@google.com>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: a26fb01c2879ed7026e6cbd78bb701912d249eef
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 8ef35c866f8862df074a49a93b0309725812dea8
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: dc12baacb95f205948f64dc936a47d89ee110117
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 43838a23a05fbd13e47d750d3dfd77001536dd33
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/43838a23a05fbd13e47d750d3dfd77001536dd33
    reference_type: commit
    reference_id: 43838a23a05fbd13e47d750d3dfd77001536dd33
  - url: https://github.com/torvalds/linux/tree/8ef35c866f8862df074a49a93b0309725812dea8
    reference_type: commit
    reference_id: 8ef35c866f8862df074a49a93b0309725812dea8
  - url: https://github.com/torvalds/linux/tree/a26fb01c2879ed7026e6cbd78bb701912d249eef
    reference_type: commit
    reference_id: a26fb01c2879ed7026e6cbd78bb701912d249eef
  - url: https://github.com/torvalds/linux/tree/dc12baacb95f205948f64dc936a47d89ee110117
    reference_type: commit
    reference_id: dc12baacb95f205948f64dc936a47d89ee110117
