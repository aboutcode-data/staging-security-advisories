advisory_id: CVE-2016-9604
datasource_id: collect_linux_fix_commits/CVE-2016-9604
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: "f205b5dc1c9e62237ac6e21642724d8cbc85f7ee:Merge tag 'keys-fixes-20170419' of git://git.kernel.org/pub/scm/linux/kernel/git/dhowells/linux-fs\n\
  \nPull keyrings fixes from David Howells:\n\n (1) Disallow keyrings whose name begins with\
  \ a '.' to be joined\n     [CVE-2016-9604].\n\n (2) Change the name of the dead type to \"\
  .dead\" to prevent user access\n     [CVE-2017-6951].\n\n (3) Fix keyctl_set_reqkey_keyring()\
  \ to not leak thread keyrings\n     [CVE-2017-7472]\n\n* tag 'keys-fixes-20170419' of git://git.kernel.org/pub/scm/linux/kernel/git/dhowells/linux-fs:\n\
  \  KEYS: fix keyctl_set_reqkey_keyring() to not leak thread keyrings\n  KEYS: Change the name\
  \ of the dead type to \".dead\" to prevent user access\n  KEYS: Disallow keyrings beginning\
  \ with '.' to be joined as session keyrings\nee8f844e3c5a73b999edf733df1c529d6503ec2f:KEYS:\
  \ Disallow keyrings beginning with '.' to be joined as session keyrings\n\nThis fixes CVE-2016-9604.\n\
  \nKeyrings whose name begin with a '.' are special internal keyrings and so\nuserspace isn't\
  \ allowed to create keyrings by this name to prevent\nshadowing.  However, the patch that\
  \ added the guard didn't fix\nKEYCTL_JOIN_SESSION_KEYRING.  Not only can that create dot-named\
  \ keyrings,\nit can also subscribe to them as a session keyring if they grant SEARCH\npermission\
  \ to the user.\n\nThis, for example, allows a root process to set .builtin_trusted_keys as\n\
  its session keyring, at which point it has full access because now the\npossessor permissions\
  \ are added.  This permits root to add extra public\nkeys, thereby bypassing module verification.\n\
  \nThis also affects kexec and IMA.\n\nThis can be tested by (as root):\n\n\tkeyctl session\
  \ .builtin_trusted_keys\n\tkeyctl add user a a @s\n\tkeyctl list @s\n\nwhich on my test box\
  \ gives me:\n\n\t2 keys in keyring:\n\t180010936: ---lswrv     0     0 asymmetric: Build time\
  \ autogenerated kernel key: ae3d4a31b82daa8e1a75b49dc2bba949fd992a05\n\t801382539: --alswrv\
  \     0     0 user: a\n\n\nFix this by rejecting names beginning with a '.' in the keyctl.\n\
  \nSigned-off-by: David Howells <dhowells@redhat.com>\nAcked-by: Mimi Zohar <zohar@linux.vnet.ibm.com>\n\
  cc: linux-ima-devel@lists.sourceforge.net\ncc: stable@vger.kernel.org"
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: ee8f844e3c5a73b999edf733df1c529d6503ec2f
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: f205b5dc1c9e62237ac6e21642724d8cbc85f7ee
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/ee8f844e3c5a73b999edf733df1c529d6503ec2f
    reference_type: commit
    reference_id: ee8f844e3c5a73b999edf733df1c529d6503ec2f
  - url: https://github.com/torvalds/linux/tree/f205b5dc1c9e62237ac6e21642724d8cbc85f7ee
    reference_type: commit
    reference_id: f205b5dc1c9e62237ac6e21642724d8cbc85f7ee
