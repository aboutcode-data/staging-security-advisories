advisory_id: CVE-2014-0069
datasource_id: collect_linux_fix_commits/CVE-2014-0069
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  33807f4f0daec3b00565c2932d95f614f5833adf:Merge branch 'for-next' of git://git.samba.org/sfrench/cifs-2.6

  Pull CIFS fixes from Steve French:
   "A fix for the problem which Al spotted in cifs_writev and a followup
    (noticed when fixing CVE-2014-0069) patch to ensure that cifs never
    sends more than the smb frame length over the socket (as we saw with
    that cifs_iovec_write problem that Jeff fixed last month)"

  * 'for-next' of git://git.samba.org/sfrench/cifs-2.6:
    cifs: mask off top byte in get_rfc1002_length()
    cifs: sanity check length of data to send before sending
    CIFS: Fix wrong pos argument of cifs_find_lock_conflict
  351a7934c0e788262f83380188f18e575f6bc63f:Merge branch 'for-linus' of git://git.samba.org/sfrench/cifs-2.6

  Pull CIFS fixes from Steve French:
   "Three cifs fixes, the most important fixing the problem with passing
    bogus pointers with writev (CVE-2014-0069).

    Two additional cifs fixes are still in review (including the fix for
    an append problem which Al also discovered)"

  * 'for-linus' of git://git.samba.org/sfrench/cifs-2.6:
    CIFS: Fix too big maxBuf size for SMB3 mounts
    cifs: ensure that uncached writes handle unmapped areas correctly
    [CIFS] Fix cifsacl mounts over smb2 to not call cifs
  5d81de8e8667da7135d3a32a964087c0faf5483f:cifs: ensure that uncached writes handle unmapped areas correctly

  It's possible for userland to pass down an iovec via writev() that has a
  bogus user pointer in it. If that happens and we're doing an uncached
  write, then we can end up getting less bytes than we expect from the
  call to iov_iter_copy_from_user. This is CVE-2014-0069

  cifs_iovec_write isn't set up to handle that situation however. It'll
  blindly keep chugging through the page array and not filling those pages
  with anything useful. Worse yet, we'll later end up with a negative
  number in wdata->tailsz, which will confuse the sending routines and
  cause an oops at the very least.

  Fix this by having the copy phase of cifs_iovec_write stop copying data
  in this situation and send the last write as a short one. At the same
  time, we want to avoid sending a zero-length write to the server, so
  break out of the loop and set rc to -EFAULT if that happens. This also
  allows us to handle the case where no address in the iovec is valid.

  [Note: Marking this for stable on v3.4+ kernels, but kernels as old as
         v2.6.38 may have a similar problem and may need similar fix]

  Cc: <stable@vger.kernel.org> # v3.4+
  Reviewed-by: Pavel Shilovsky <piastry@etersoft.ru>
  Reported-by: Al Viro <viro@zeniv.linux.org.uk>
  Signed-off-by: Jeff Layton <jlayton@redhat.com>
  Signed-off-by: Steve French <smfrench@gmail.com>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 5d81de8e8667da7135d3a32a964087c0faf5483f
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 351a7934c0e788262f83380188f18e575f6bc63f
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 33807f4f0daec3b00565c2932d95f614f5833adf
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/33807f4f0daec3b00565c2932d95f614f5833adf
    reference_type: commit
    reference_id: 33807f4f0daec3b00565c2932d95f614f5833adf
  - url: https://github.com/torvalds/linux/tree/351a7934c0e788262f83380188f18e575f6bc63f
    reference_type: commit
    reference_id: 351a7934c0e788262f83380188f18e575f6bc63f
  - url: https://github.com/torvalds/linux/tree/5d81de8e8667da7135d3a32a964087c0faf5483f
    reference_type: commit
    reference_id: 5d81de8e8667da7135d3a32a964087c0faf5483f
