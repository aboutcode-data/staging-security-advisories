advisory_id: CVE-2022-2586
datasource_id: collect_linux_fix_commits/CVE-2022-2586
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  470ee20e069a6d05ae549f7d0ef2bdbcee6a81b2:netfilter: nf_tables: do not allow SET_ID to refer to another table

  When doing lookups for sets on the same batch by using its ID, a set from a
  different table can be used.

  Then, when the table is removed, a reference to the set may be kept after
  the set is freed, leading to a potential use-after-free.

  When looking for sets by ID, use the table that was used for the lookup by
  name, and only return sets belonging to that same table.

  This fixes CVE-2022-2586, also reported as ZDI-CAN-17470.

  Reported-by: Team Orca of Sea Security (@seasecresponse)
  Fixes: 958bee14d071 ("netfilter: nf_tables: use new transaction infrastructure to handle sets")
  Signed-off-by: Thadeu Lima de Souza Cascardo <cascardo@canonical.com>
  Cc: <stable@vger.kernel.org>
  Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 470ee20e069a6d05ae549f7d0ef2bdbcee6a81b2
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/470ee20e069a6d05ae549f7d0ef2bdbcee6a81b2
    reference_type: commit
    reference_id: 470ee20e069a6d05ae549f7d0ef2bdbcee6a81b2
