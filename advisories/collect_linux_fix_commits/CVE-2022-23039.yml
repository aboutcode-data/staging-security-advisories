advisory_id: CVE-2022-23039
datasource_id: collect_linux_fix_commits/CVE-2022-23039
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  d3b6372c5881cb54925212abb62c521df8ba4809:xen/gntalloc: don't use gnttab_query_foreign_access()

  Using gnttab_query_foreign_access() is unsafe, as it is racy by design.

  The use case in the gntalloc driver is not needed at all. While at it
  replace the call of gnttab_end_foreign_access_ref() with a call of
  gnttab_end_foreign_access(), which is what is really wanted there. In
  case the grant wasn't used due to an allocation failure, just free the
  grant via gnttab_free_grant_reference().

  This is CVE-2022-23039 / part of XSA-396.

  Reported-by: Demi Marie Obenour <demi@invisiblethingslab.com>
  Signed-off-by: Juergen Gross <jgross@suse.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  ---
  V3:
  - fix __del_gref() (Jan Beulich)
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: d3b6372c5881cb54925212abb62c521df8ba4809
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/d3b6372c5881cb54925212abb62c521df8ba4809
    reference_type: commit
    reference_id: d3b6372c5881cb54925212abb62c521df8ba4809
