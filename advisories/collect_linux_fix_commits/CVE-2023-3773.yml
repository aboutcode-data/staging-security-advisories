advisory_id: CVE-2023-3773
datasource_id: collect_linux_fix_commits/CVE-2023-3773
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  5d6ba607d6cb5c58a4ddf33381e18c83dbb4098f:vdpa: Add max vqp attr to vdpa_nl_policy for nlattr length check

  The vdpa_nl_policy structure is used to validate the nlattr when parsing
  the incoming nlmsg. It will ensure the attribute being described produces
  a valid nlattr pointer in info->attrs before entering into each handler
  in vdpa_nl_ops.

  That is to say, the missing part in vdpa_nl_policy may lead to illegal
  nlattr after parsing, which could lead to OOB read just like CVE-2023-3773.

  This patch adds the missing nla_policy for vdpa max vqp attr to avoid
  such bugs.

  Fixes: ad69dd0bf26b ("vdpa: Introduce query of device config layout")
  Signed-off-by: Lin Ma <linma@zju.edu.cn>
  Cc: stable@vger.kernel.org
  Message-Id: <20230727175757.73988-7-dtatulea@nvidia.com>
  Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  b3003e1b54e057f5f3124e437b80c3bef26ed3fe:vdpa: Add queue index attr to vdpa_nl_policy for nlattr length check

  The vdpa_nl_policy structure is used to validate the nlattr when parsing
  the incoming nlmsg. It will ensure the attribute being described produces
  a valid nlattr pointer in info->attrs before entering into each handler
  in vdpa_nl_ops.

  That is to say, the missing part in vdpa_nl_policy may lead to illegal
  nlattr after parsing, which could lead to OOB read just like CVE-2023-3773.

  This patch adds the missing nla_policy for vdpa queue index attr to avoid
  such bugs.

  Fixes: 13b00b135665 ("vdpa: Add support for querying vendor statistics")
  Signed-off-by: Lin Ma <linma@zju.edu.cn>
  Cc: stable@vger.kernelorg
  Message-Id: <20230727175757.73988-5-dtatulea@nvidia.com>
  Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  79c8651587504ba263d2fd67fd4406240fb21f69:vdpa: Add features attr to vdpa_nl_policy for nlattr length check

  The vdpa_nl_policy structure is used to validate the nlattr when parsing
  the incoming nlmsg. It will ensure the attribute being described produces
  a valid nlattr pointer in info->attrs before entering into each handler
  in vdpa_nl_ops.

  That is to say, the missing part in vdpa_nl_policy may lead to illegal
  nlattr after parsing, which could lead to OOB read just like CVE-2023-3773.

  This patch adds the missing nla_policy for vdpa features attr to avoid
  such bugs.

  Fixes: 90fea5a800c3 ("vdpa: device feature provisioning")
  Signed-off-by: Lin Ma <linma@zju.edu.cn>
  Cc: stable@vger.kernel.org
  Message-Id: <20230727175757.73988-3-dtatulea@nvidia.com>
  Signed-off-by: Michael S. Tsirkin <mst@redhat.com>
  5e2424708da7207087934c5c75211e8584d553a0:xfrm: add forgotten nla_policy for XFRMA_MTIMER_THRESH

  The previous commit 4e484b3e969b ("xfrm: rate limit SA mapping change
  message to user space") added one additional attribute named
  XFRMA_MTIMER_THRESH and described its type at compat_policy
  (net/xfrm/xfrm_compat.c).

  However, the author forgot to also describe the nla_policy at
  xfrma_policy (net/xfrm/xfrm_user.c). Hence, this suppose NLA_U32 (4
  bytes) value can be faked as empty (0 bytes) by a malicious user, which
  leads to 4 bytes overflow read and heap information leak when parsing
  nlattrs.

  To exploit this, one malicious user can spray the SLUB objects and then
  leverage this 4 bytes OOB read to leak the heap data into
  x->mapping_maxage (see xfrm_update_ae_params(...)), and leak it to
  userspace via copy_to_user_state_extra(...).

  The above bug is assigned CVE-2023-3773. To fix it, this commit just
  completes the nla_policy description for XFRMA_MTIMER_THRESH, which
  enforces the length check and avoids such OOB read.

  Fixes: 4e484b3e969b ("xfrm: rate limit SA mapping change message to user space")
  Signed-off-by: Lin Ma <linma@zju.edu.cn>
  Reviewed-by: Simon Horman <simon.horman@corigine.com>
  Reviewed-by: Leon Romanovsky <leonro@nvidia.com>
  Signed-off-by: Steffen Klassert <steffen.klassert@secunet.com>
  55cef78c244d0d076f5a75a35530ca63c92f4426:macvlan: add forgotten nla_policy for IFLA_MACVLAN_BC_CUTOFF

  The previous commit 954d1fa1ac93 ("macvlan: Add netlink attribute for
  broadcast cutoff") added one additional attribute named
  IFLA_MACVLAN_BC_CUTOFF to allow broadcast cutfoff.

  However, it forgot to describe the nla_policy at macvlan_policy
  (drivers/net/macvlan.c). Hence, this suppose NLA_S32 (4 bytes) integer
  can be faked as empty (0 bytes) by a malicious user, which could leads
  to OOB in heap just like CVE-2023-3773.

  To fix it, this commit just completes the nla_policy description for
  IFLA_MACVLAN_BC_CUTOFF. This enforces the length check and avoids the
  potential OOB read.

  Fixes: 954d1fa1ac93 ("macvlan: Add netlink attribute for broadcast cutoff")
  Signed-off-by: Lin Ma <linma@zju.edu.cn>
  Reviewed-by: Simon Horman <simon.horman@corigine.com>
  Link: https://lore.kernel.org/r/20230723080205.3715164-1-linma@zju.edu.cn
  Signed-off-by: Jakub Kicinski <kuba@kernel.org>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 5d6ba607d6cb5c58a4ddf33381e18c83dbb4098f
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 55cef78c244d0d076f5a75a35530ca63c92f4426
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 5e2424708da7207087934c5c75211e8584d553a0
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 79c8651587504ba263d2fd67fd4406240fb21f69
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: b3003e1b54e057f5f3124e437b80c3bef26ed3fe
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/55cef78c244d0d076f5a75a35530ca63c92f4426
    reference_type: commit
    reference_id: 55cef78c244d0d076f5a75a35530ca63c92f4426
  - url: https://github.com/torvalds/linux/tree/5d6ba607d6cb5c58a4ddf33381e18c83dbb4098f
    reference_type: commit
    reference_id: 5d6ba607d6cb5c58a4ddf33381e18c83dbb4098f
  - url: https://github.com/torvalds/linux/tree/5e2424708da7207087934c5c75211e8584d553a0
    reference_type: commit
    reference_id: 5e2424708da7207087934c5c75211e8584d553a0
  - url: https://github.com/torvalds/linux/tree/79c8651587504ba263d2fd67fd4406240fb21f69
    reference_type: commit
    reference_id: 79c8651587504ba263d2fd67fd4406240fb21f69
  - url: https://github.com/torvalds/linux/tree/b3003e1b54e057f5f3124e437b80c3bef26ed3fe
    reference_type: commit
    reference_id: b3003e1b54e057f5f3124e437b80c3bef26ed3fe
