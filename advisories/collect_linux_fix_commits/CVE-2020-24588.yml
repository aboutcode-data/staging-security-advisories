advisory_id: CVE-2020-24588
datasource_id: collect_linux_fix_commits/CVE-2020-24588
datasource_url: https://github.com/torvalds/linux
aliases: []
summary: |
  737bb912ebbe4571195c56eba557c4d7315b26fb:wifi: prevent A-MSDU attacks in mesh networks

  This patch is a mitigation to prevent the A-MSDU spoofing vulnerability
  for mesh networks. The initial update to the IEEE 802.11 standard, in
  response to the FragAttacks, missed this case (CVE-2025-27558). It can
  be considered a variant of CVE-2020-24588 but for mesh networks.

  This patch tries to detect if a standard MSDU was turned into an A-MSDU
  by an adversary. This is done by parsing a received A-MSDU as a standard
  MSDU, calculating the length of the Mesh Control header, and seeing if
  the 6 bytes after this header equal the start of an rfc1042 header. If
  equal, this is a strong indication of an ongoing attack attempt.

  This defense was tested with mac80211_hwsim against a mesh network that
  uses an empty Mesh Address Extension field, i.e., when four addresses
  are used, and when using a 12-byte Mesh Address Extension field, i.e.,
  when six addresses are used. Functionality of normal MSDUs and A-MSDUs
  was also tested, and confirmed working, when using both an empty and
  12-byte Mesh Address Extension field.

  It was also tested with mac80211_hwsim that A-MSDU attacks in non-mesh
  networks keep being detected and prevented.

  Note that the vulnerability being patched, and the defense being
  implemented, was also discussed in the following paper and in the
  following IEEE 802.11 presentation:

  https://papers.mathyvanhoef.com/wisec2025.pdf
  https://mentor.ieee.org/802.11/dcn/25/11-25-0949-00-000m-a-msdu-mesh-spoof-protection.docx

  Cc: stable@vger.kernel.org
  Signed-off-by: Mathy Vanhoef <Mathy.Vanhoef@kuleuven.be>
  Link: https://patch.msgid.link/20250616004635.224344-1-Mathy.Vanhoef@kuleuven.be
  Signed-off-by: Johannes Berg <johannes.berg@intel.com>
  28131d896d6d316bc1f6f305d1a9ed6d96c3f2a1:Merge tag 'wireless-drivers-next-2021-10-29' of git://git.kernel.org/pub/scm/linux/kernel/git/kvalo/wireless-drivers-next

  Kalle Valo says:

  ====================
  wireless-drivers-next patches for v5.16

  Fourth set of patches for v5.16. Mostly fixes this time, wcn36xx and
  iwlwifi have some new features but nothing really out of ordinary.
  We have one conflict with kspp tree.

  Major changes:

  ath11k
   * fix QCA6390 A-MSDU handling (CVE-2020-24588)

  wcn36xx
   * enable hardware scan offload for 5Ghz band
   * add missing 5GHz channels 136 and 144

  iwlwifi
   * support a new ACPI table revision
   * improvements in the device selection code
   * new hardware support
   * support for WiFi 6E enablement via BIOS
   * support firmware API version 67
   * support for 160MHz in ranging measurements

  ====================

  Link: https://lore.kernel.org/r/20211029134707.DE2B0C4360D@smtp.codeaurora.org
  Signed-off-by: Jakub Kicinski <kuba@kernel.org>
  d7333a8ec8ca88b106a2f9729b119cb09c7e41dc:Merge ath-next from git://git.kernel.org/pub/scm/linux/kernel/git/kvalo/ath.git

  ath.git patches for v5.16. Major changes:

  ath11k

  * fix QCA6390 A-MSDU handling (CVE-2020-24588)

  wcn36xx

  * enable hardware scan offload for 5Ghz band

  * add missing 5GHz channels 136 and 144
  734223d78428de3c7c7d7bc04daf258085780d90:ath11k: change return buffer manager for QCA6390

  QCA6390 firmware uses HAL_RX_BUF_RBM_SW1_BM, not HAL_RX_BUF_RBM_SW3_BM. This is
  needed to fix a case where an A-MSDU has an unexpected LLC/SNAP header in the
  first subframe (CVE-2020-24588).

  Tested-on: QCA6390 hw2.0 PCI WLAN.HST.1.0.1-01740-QCAHSTSWPLZ_V2_TO_X86-1

  Signed-off-by: Baochen Qiang <bqiang@codeaurora.org>
  Signed-off-by: Jouni Malinen <jouni@codeaurora.org>
  Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
  Link: https://lore.kernel.org/r/20210914163726.38604-2-jouni@codeaurora.org
  5e7a2c6494813e58252caf342f5ddb166ad44d1a:Merge tag 'wireless-drivers-2021-06-03' of git://git.kernel.org/pub/scm/linux/kernel/git/kvalo/wireless-drivers

  Kalle Valo says:

  ====================
  wireless-drivers fixes for v5.13

  We have only mt76 fixes this time, most important being the fix for
  A-MSDU injection attacks.

  mt76

  * mitigate A-MSDU injection attacks (CVE-2020-24588)

  * fix possible array out of bound access in mt7921_mcu_tx_rate_report

  * various aggregation and HE setting fixes

  * suspend/resume fix for pci devices

  * mt7615: fix crash when runtime-pm is not supported
  ====================

  Signed-off-by: David S. Miller <davem@davemloft.net>
  2c2bdd2372afcfcf24fe11c65ebe3361b7e1cd9f:mt76: validate rx A-MSDU subframes

  Mitigate A-MSDU injection attacks (CVE-2020-24588) by detecting if the
  destination address of a subframe equals an RFC1042 (i.e., LLC/SNAP)
  header, and if so dropping the complete A-MSDU frame. This mitigates
  known attacks, although new (unknown) aggregation-based attacks may
  remain possible.

  This defense works because in A-MSDU aggregation injection attacks, a
  normal encrypted Wi-Fi frame is turned into an A-MSDU frame. This means
  the first 6 bytes of the first A-MSDU subframe correspond to an RFC1042
  header. In other words, the destination MAC address of the first A-MSDU
  subframe contains the start of an RFC1042 header during an aggregation
  attack. We can detect this and thereby prevent this specific attack.
  For details, see Section 7.2 of "Fragment and Forge: Breaking Wi-Fi
  Through Frame Aggregation and Fragmentation".

  Signed-off-by: Felix Fietkau <nbd@nbd.name>
  Signed-off-by: Kalle Valo <kvalo@codeaurora.org>
  Link: https://lore.kernel.org/r/20210513070303.20253-1-nbd@nbd.name
  079a108feba474b4b32bd3471db03e11f2f83b81:ath10k: drop MPDU which has discard flag set by firmware for SDIO

  When the discard flag is set by the firmware for an MPDU, it should be
  dropped. This allows a mitigation for CVE-2020-24588 to be implemented
  in the firmware.

  Tested-on: QCA6174 hw3.2 SDIO WLAN.RMH.4.4.1-00049

  Cc: stable@vger.kernel.org
  Signed-off-by: Wen Gong <wgong@codeaurora.org>
  Signed-off-by: Jouni Malinen <jouni@codeaurora.org>
  Link: https://lore.kernel.org/r/20210511200110.11968c725b5c.Idd166365ebea2771c0c0a38c78b5060750f90e17@changeid
  Signed-off-by: Johannes Berg <johannes.berg@intel.com>
  270032a2a9c4535799736142e1e7c413ca7b836e:mac80211: drop A-MSDUs on old ciphers

  With old ciphers (WEP and TKIP) we shouldn't be using A-MSDUs
  since A-MSDUs are only supported if we know that they are, and
  the only practical way for that is HT support which doesn't
  support old ciphers.

  However, we would normally accept them anyway. Since we check
  the MMIC before deaggregating A-MSDUs, and the A-MSDU bit in
  the QoS header is not protected in TKIP (or WEP), this enables
  attacks similar to CVE-2020-24588. To prevent that, drop A-MSDUs
  completely with old ciphers.

  Cc: stable@vger.kernel.org
  Link: https://lore.kernel.org/r/20210511200110.076543300172.I548e6e71f1ee9cad4b9a37bf212ae7db723587aa@changeid
  Signed-off-by: Johannes Berg <johannes.berg@intel.com>
  2b8a1fee3488c602aca8bea004a087e60806a5cf:cfg80211: mitigate A-MSDU aggregation attacks

  Mitigate A-MSDU injection attacks (CVE-2020-24588) by detecting if the
  destination address of a subframe equals an RFC1042 (i.e., LLC/SNAP)
  header, and if so dropping the complete A-MSDU frame. This mitigates
  known attacks, although new (unknown) aggregation-based attacks may
  remain possible.

  This defense works because in A-MSDU aggregation injection attacks, a
  normal encrypted Wi-Fi frame is turned into an A-MSDU frame. This means
  the first 6 bytes of the first A-MSDU subframe correspond to an RFC1042
  header. In other words, the destination MAC address of the first A-MSDU
  subframe contains the start of an RFC1042 header during an aggregation
  attack. We can detect this and thereby prevent this specific attack.
  For details, see Section 7.2 of "Fragment and Forge: Breaking Wi-Fi
  Through Frame Aggregation and Fragmentation".

  Note that for kernel 4.9 and above this patch depends on "mac80211:
  properly handle A-MSDUs that start with a rfc1042 header". Otherwise
  this patch has no impact and attacks will remain possible.

  Cc: stable@vger.kernel.org
  Signed-off-by: Mathy Vanhoef <Mathy.Vanhoef@kuleuven.be>
  Link: https://lore.kernel.org/r/20210511200110.25d93176ddaf.I9e265b597f2cd23eb44573f35b625947b386a9de@changeid
  Signed-off-by: Johannes Berg <johannes.berg@intel.com>
impacted_packages:
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 079a108feba474b4b32bd3471db03e11f2f83b81
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 734223d78428de3c7c7d7bc04daf258085780d90
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 270032a2a9c4535799736142e1e7c413ca7b836e
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 28131d896d6d316bc1f6f305d1a9ed6d96c3f2a1
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 2c2bdd2372afcfcf24fe11c65ebe3361b7e1cd9f
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 2b8a1fee3488c602aca8bea004a087e60806a5cf
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: d7333a8ec8ca88b106a2f9729b119cb09c7e41dc
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 737bb912ebbe4571195c56eba557c4d7315b26fb
    introduced_in_commits: []
  - purl: pkg:github/torvalds/linux
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/torvalds/linux
        commit: 5e7a2c6494813e58252caf342f5ddb166ad44d1a
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/torvalds/linux/tree/079a108feba474b4b32bd3471db03e11f2f83b81
    reference_type: commit
    reference_id: 079a108feba474b4b32bd3471db03e11f2f83b81
  - url: https://github.com/torvalds/linux/tree/270032a2a9c4535799736142e1e7c413ca7b836e
    reference_type: commit
    reference_id: 270032a2a9c4535799736142e1e7c413ca7b836e
  - url: https://github.com/torvalds/linux/tree/28131d896d6d316bc1f6f305d1a9ed6d96c3f2a1
    reference_type: commit
    reference_id: 28131d896d6d316bc1f6f305d1a9ed6d96c3f2a1
  - url: https://github.com/torvalds/linux/tree/2b8a1fee3488c602aca8bea004a087e60806a5cf
    reference_type: commit
    reference_id: 2b8a1fee3488c602aca8bea004a087e60806a5cf
  - url: https://github.com/torvalds/linux/tree/2c2bdd2372afcfcf24fe11c65ebe3361b7e1cd9f
    reference_type: commit
    reference_id: 2c2bdd2372afcfcf24fe11c65ebe3361b7e1cd9f
  - url: https://github.com/torvalds/linux/tree/5e7a2c6494813e58252caf342f5ddb166ad44d1a
    reference_type: commit
    reference_id: 5e7a2c6494813e58252caf342f5ddb166ad44d1a
  - url: https://github.com/torvalds/linux/tree/734223d78428de3c7c7d7bc04daf258085780d90
    reference_type: commit
    reference_id: 734223d78428de3c7c7d7bc04daf258085780d90
  - url: https://github.com/torvalds/linux/tree/737bb912ebbe4571195c56eba557c4d7315b26fb
    reference_type: commit
    reference_id: 737bb912ebbe4571195c56eba557c4d7315b26fb
  - url: https://github.com/torvalds/linux/tree/d7333a8ec8ca88b106a2f9729b119cb09c7e41dc
    reference_type: commit
    reference_id: d7333a8ec8ca88b106a2f9729b119cb09c7e41dc
