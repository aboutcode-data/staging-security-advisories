advisory_id: CVE-2021-33196
datasource_id: collect_go_fix_commits/CVE-2021-33196
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  895fb1bb6fc0d3c01c5ef7c8cbaf033d1fff9ad7:[release-branch.go1.16] archive/zip: only preallocate File slice if reasonably sized

  Since the number of files in the EOCD record isn't validated, it isn't
  safe to preallocate Reader.Files using that field. A malformed archive
  can indicate it contains up to 1 << 128 - 1 files. We can still safely
  preallocate the slice by checking if the specified number of files in
  the archive is reasonable, given the size of the archive.

  Thanks to the OSS-Fuzz project for discovering this issue and to
  Emmanuel Odeke for reporting it.

  Updates #46242
  Fixes #46397
  Fixes CVE-2021-33196

  Change-Id: I3c76d8eec178468b380d87fdb4a3f2cb06f0ee76
  Reviewed-on: https://go-review.googlesource.com/c/go/+/318909
  Trust: Roland Shoemaker <roland@golang.org>
  Trust: Katie Hockman <katie@golang.org>
  Trust: Joe Tsai <thebrokentoaster@gmail.com>
  Run-TryBot: Roland Shoemaker <roland@golang.org>
  TryBot-Result: Go Bot <gobot@golang.org>
  Reviewed-by: Katie Hockman <katie@golang.org>
  Reviewed-by: Joe Tsai <thebrokentoaster@gmail.com>
  (cherry picked from commit 74242baa4136c7a9132a8ccd9881354442788c8c)
  Reviewed-on: https://go-review.googlesource.com/c/go/+/322909
  Reviewed-by: Filippo Valsorda <filippo@golang.org>
  c92adf420a3d9a5510f9aea382d826f0c9216a10:[release-branch.go1.15] archive/zip: only preallocate File slice if reasonably sized

  Since the number of files in the EOCD record isn't validated, it isn't
  safe to preallocate Reader.Files using that field. A malformed archive
  can indicate it contains up to 1 << 128 - 1 files. We can still safely
  preallocate the slice by checking if the specified number of files in
  the archive is reasonable, given the size of the archive.

  Thanks to the OSS-Fuzz project for discovering this issue and to
  Emmanuel Odeke for reporting it.

  Updates #46242
  Fixes #46396
  Fixes CVE-2021-33196

  Change-Id: I3c76d8eec178468b380d87fdb4a3f2cb06f0ee76
  Reviewed-on: https://go-review.googlesource.com/c/go/+/318909
  Trust: Roland Shoemaker <roland@golang.org>
  Trust: Katie Hockman <katie@golang.org>
  Trust: Joe Tsai <thebrokentoaster@gmail.com>
  Run-TryBot: Roland Shoemaker <roland@golang.org>
  TryBot-Result: Go Bot <gobot@golang.org>
  Reviewed-by: Katie Hockman <katie@golang.org>
  Reviewed-by: Joe Tsai <thebrokentoaster@gmail.com>
  (cherry picked from commit 74242baa4136c7a9132a8ccd9881354442788c8c)
  Reviewed-on: https://go-review.googlesource.com/c/go/+/322949
  Reviewed-by: Filippo Valsorda <filippo@golang.org>
  74242baa4136c7a9132a8ccd9881354442788c8c:archive/zip: only preallocate File slice if reasonably sized

  Since the number of files in the EOCD record isn't validated, it isn't
  safe to preallocate Reader.Files using that field. A malformed archive
  can indicate it contains up to 1 << 128 - 1 files. We can still safely
  preallocate the slice by checking if the specified number of files in
  the archive is reasonable, given the size of the archive.

  Thanks to the OSS-Fuzz project for discovering this issue and to
  Emmanuel Odeke for reporting it.

  Fixes #46242
  Fixes CVE-2021-33196

  Change-Id: I3c76d8eec178468b380d87fdb4a3f2cb06f0ee76
  Reviewed-on: https://go-review.googlesource.com/c/go/+/318909
  Trust: Roland Shoemaker <roland@golang.org>
  Trust: Katie Hockman <katie@golang.org>
  Trust: Joe Tsai <thebrokentoaster@gmail.com>
  Run-TryBot: Roland Shoemaker <roland@golang.org>
  TryBot-Result: Go Bot <gobot@golang.org>
  Reviewed-by: Katie Hockman <katie@golang.org>
  Reviewed-by: Joe Tsai <thebrokentoaster@gmail.com>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 895fb1bb6fc0d3c01c5ef7c8cbaf033d1fff9ad7
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 74242baa4136c7a9132a8ccd9881354442788c8c
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: c92adf420a3d9a5510f9aea382d826f0c9216a10
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/74242baa4136c7a9132a8ccd9881354442788c8c
    reference_type: commit
    reference_id: 74242baa4136c7a9132a8ccd9881354442788c8c
  - url: https://github.com/golang/go/tree/895fb1bb6fc0d3c01c5ef7c8cbaf033d1fff9ad7
    reference_type: commit
    reference_id: 895fb1bb6fc0d3c01c5ef7c8cbaf033d1fff9ad7
  - url: https://github.com/golang/go/tree/c92adf420a3d9a5510f9aea382d826f0c9216a10
    reference_type: commit
    reference_id: c92adf420a3d9a5510f9aea382d826f0c9216a10
