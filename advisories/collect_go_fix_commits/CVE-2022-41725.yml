advisory_id: CVE-2022-41725
datasource_id: collect_go_fix_commits/CVE-2022-41725
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  5c55ac9bf1e5f779220294c843526536605f42ab:[release-branch.go1.19] mime/multipart: limit memory/inode consumption of ReadForm

  Reader.ReadForm is documented as storing "up to maxMemory bytes + 10MB"
  in memory. Parsed forms can consume substantially more memory than
  this limit, since ReadForm does not account for map entry overhead
  and MIME headers.

  In addition, while the amount of disk memory consumed by ReadForm can
  be constrained by limiting the size of the parsed input, ReadForm will
  create one temporary file per form part stored on disk, potentially
  consuming a large number of inodes.

  Update ReadForm's memory accounting to include part names,
  MIME headers, and map entry overhead.

  Update ReadForm to store all on-disk file parts in a single
  temporary file.

  Files returned by FileHeader.Open are documented as having a concrete
  type of *os.File when a file is stored on disk. The change to use a
  single temporary file for all parts means that this is no longer the
  case when a form contains more than a single file part stored on disk.

  The previous behavior of storing each file part in a separate disk
  file may be reenabled with GODEBUG=multipartfiles=distinct.

  Update Reader.NextPart and Reader.NextRawPart to set a 10MiB cap
  on the size of MIME headers.

  Thanks to Jakob Ackermann (@das7pad) for reporting this issue.

  Updates #58006
  Fixes #58362
  Fixes CVE-2022-41725

  Change-Id: Ibd780a6c4c83ac8bcfd3cbe344f042e9940f2eab
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1714276
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  TryBot-Result: Security TryBots <security-trybots@go-security-trybots.iam.gserviceaccount.com>
  Reviewed-by: Roland Shoemaker <bracewell@google.com>
  Run-TryBot: Damien Neil <dneil@google.com>
  (cherry picked from commit ed4664330edcd91b24914c9371c377c132dbce8c)
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1728949
  Reviewed-by: Tatiana Bradley <tatianabradley@google.com>
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Damien Neil <dneil@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/468116
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Reviewed-by: Than McIntosh <thanm@google.com>
  Run-TryBot: Michael Pratt <mpratt@google.com>
  Auto-Submit: Michael Pratt <mpratt@google.com>
  53b43607d92e9738067c93829bd799441eda8034:[release-branch.go1.20] mime/multipart: limit memory/inode consumption of ReadForm

  Reader.ReadForm is documented as storing "up to maxMemory bytes + 10MB"
  in memory. Parsed forms can consume substantially more memory than
  this limit, since ReadForm does not account for map entry overhead
  and MIME headers.

  In addition, while the amount of disk memory consumed by ReadForm can
  be constrained by limiting the size of the parsed input, ReadForm will
  create one temporary file per form part stored on disk, potentially
  consuming a large number of inodes.

  Update ReadForm's memory accounting to include part names,
  MIME headers, and map entry overhead.

  Update ReadForm to store all on-disk file parts in a single
  temporary file.

  Files returned by FileHeader.Open are documented as having a concrete
  type of *os.File when a file is stored on disk. The change to use a
  single temporary file for all parts means that this is no longer the
  case when a form contains more than a single file part stored on disk.

  The previous behavior of storing each file part in a separate disk
  file may be reenabled with GODEBUG=multipartfiles=distinct.

  Update Reader.NextPart and Reader.NextRawPart to set a 10MiB cap
  on the size of MIME headers.

  Thanks to Jakob Ackermann (@das7pad) for reporting this issue.

  Updates #58006
  Fixes #58363
  Fixes CVE-2022-41725

  Change-Id: Ibd780a6c4c83ac8bcfd3cbe344f042e9940f2eab
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1714276
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  TryBot-Result: Security TryBots <security-trybots@go-security-trybots.iam.gserviceaccount.com>
  Reviewed-by: Roland Shoemaker <bracewell@google.com>
  Run-TryBot: Damien Neil <dneil@google.com>
  (cherry picked from commit 7d0da0029bfbe3228cc5216ced8c7b3184eb517d)
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1728950
  Reviewed-by: Damien Neil <dneil@google.com>
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Tatiana Bradley <tatianabradley@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/468120
  Auto-Submit: Michael Pratt <mpratt@google.com>
  Run-TryBot: Michael Pratt <mpratt@google.com>
  Reviewed-by: Than McIntosh <thanm@google.com>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  0af2c78c362481e45339b76d0a210bf462cfe65c:mime/multipart: limit memory/inode consumption of ReadForm

  Reader.ReadForm is documented as storing "up to maxMemory bytes + 10MB"
  in memory. Parsed forms can consume substantially more memory than
  this limit, since ReadForm does not account for map entry overhead
  and MIME headers.

  In addition, while the amount of disk memory consumed by ReadForm can
  be constrained by limiting the size of the parsed input, ReadForm will
  create one temporary file per form part stored on disk, potentially
  consuming a large number of inodes.

  Update ReadForm's memory accounting to include part names,
  MIME headers, and map entry overhead.

  Update ReadForm to store all on-disk file parts in a single
  temporary file.

  Files returned by FileHeader.Open are documented as having a concrete
  type of *os.File when a file is stored on disk. The change to use a
  single temporary file for all parts means that this is no longer the
  case when a form contains more than a single file part stored on disk.

  The previous behavior of storing each file part in a separate disk
  file may be reenabled with GODEBUG=multipartfiles=distinct.

  Update Reader.NextPart and Reader.NextRawPart to set a 10MiB cap
  on the size of MIME headers.

  Thanks to Jakob Ackermann (@das7pad) for reporting this issue.

  Fixes #58006
  Fixes CVE-2022-41725

  Change-Id: Ibd780a6c4c83ac8bcfd3cbe344f042e9940f2eab
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1714276
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  TryBot-Result: Security TryBots <security-trybots@go-security-trybots.iam.gserviceaccount.com>
  Reviewed-by: Roland Shoemaker <bracewell@google.com>
  Run-TryBot: Damien Neil <dneil@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/468124
  Auto-Submit: Michael Pratt <mpratt@google.com>
  Run-TryBot: Michael Pratt <mpratt@google.com>
  Reviewed-by: Than McIntosh <thanm@google.com>
  TryBot-Result: Gopher Robot <gobot@golang.org>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 53b43607d92e9738067c93829bd799441eda8034
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 5c55ac9bf1e5f779220294c843526536605f42ab
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 0af2c78c362481e45339b76d0a210bf462cfe65c
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/0af2c78c362481e45339b76d0a210bf462cfe65c
    reference_type: commit
    reference_id: 0af2c78c362481e45339b76d0a210bf462cfe65c
  - url: https://github.com/golang/go/tree/53b43607d92e9738067c93829bd799441eda8034
    reference_type: commit
    reference_id: 53b43607d92e9738067c93829bd799441eda8034
  - url: https://github.com/golang/go/tree/5c55ac9bf1e5f779220294c843526536605f42ab
    reference_type: commit
    reference_id: 5c55ac9bf1e5f779220294c843526536605f42ab
