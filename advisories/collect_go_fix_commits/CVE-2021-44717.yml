advisory_id: CVE-2021-44717
datasource_id: collect_go_fix_commits/CVE-2021-44717
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  a76511f3a40ea69ee4f5cd86e735e1c8a84f0aa2:syscall: fix ForkLock spurious close(0) on pipe failure

  Pipe (and therefore forkLockPipe) does not make any guarantees
  about the state of p after a failed Pipe(p). Avoid that assumption
  and the too-clever goto, so that we don't accidentally Close a real fd
  if the failed pipe leaves p[0] or p[1] set >= 0.

  Fixes #50057
  Fixes CVE-2021-44717

  Change-Id: Iff8e19a6efbba0c73cc8b13ecfae381c87600bb4
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1291270
  Reviewed-by: Ian Lance Taylor <iant@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/370576
  Run-TryBot: Filippo Valsorda <filippo@golang.org>
  Trust: Russ Cox <rsc@golang.org>
  Reviewed-by: Alex Rakoczy <alex@golang.org>
  44a3fb49d99cc8a4de4925b69650f97bb07faf1d:[release-branch.go1.16] syscall: fix ForkLock spurious close(0) on pipe failure

  Pipe (and therefore forkLockPipe) does not make any guarantees
  about the state of p after a failed Pipe(p). Avoid that assumption
  and the too-clever goto, so that we don't accidentally Close a real fd
  if the failed pipe leaves p[0] or p[1] set >= 0.

  Updates #50057
  Fixes CVE-2021-44717

  Change-Id: Iff8e19a6efbba0c73cc8b13ecfae381c87600bb4
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1291270
  Reviewed-by: Ian Lance Taylor <iant@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/370514
  Trust: Filippo Valsorda <filippo@golang.org>
  Run-TryBot: Filippo Valsorda <filippo@golang.org>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Reviewed-by: Alex Rakoczy <alex@golang.org>
  e46abcb816fb20663483f84fe52e370790a99bee:[release-branch.go1.17] syscall: fix ForkLock spurious close(0) on pipe failure

  Pipe (and therefore forkLockPipe) does not make any guarantees
  about the state of p after a failed Pipe(p). Avoid that assumption
  and the too-clever goto, so that we don't accidentally Close a real fd
  if the failed pipe leaves p[0] or p[1] set >= 0.

  Updates #50057
  Fixes CVE-2021-44717

  Change-Id: Iff8e19a6efbba0c73cc8b13ecfae381c87600bb4
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1291270
  Reviewed-by: Ian Lance Taylor <iant@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/370534
  Trust: Filippo Valsorda <filippo@golang.org>
  Run-TryBot: Filippo Valsorda <filippo@golang.org>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Reviewed-by: Alex Rakoczy <alex@golang.org>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: e46abcb816fb20663483f84fe52e370790a99bee
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: a76511f3a40ea69ee4f5cd86e735e1c8a84f0aa2
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 44a3fb49d99cc8a4de4925b69650f97bb07faf1d
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/44a3fb49d99cc8a4de4925b69650f97bb07faf1d
    reference_type: commit
    reference_id: 44a3fb49d99cc8a4de4925b69650f97bb07faf1d
  - url: https://github.com/golang/go/tree/a76511f3a40ea69ee4f5cd86e735e1c8a84f0aa2
    reference_type: commit
    reference_id: a76511f3a40ea69ee4f5cd86e735e1c8a84f0aa2
  - url: https://github.com/golang/go/tree/e46abcb816fb20663483f84fe52e370790a99bee
    reference_type: commit
    reference_id: e46abcb816fb20663483f84fe52e370790a99bee
