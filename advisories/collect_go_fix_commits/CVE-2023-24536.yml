advisory_id: CVE-2023-24536
datasource_id: collect_go_fix_commits/CVE-2023-24536
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  1e43cfa15b4b618812e85c00c9e92c2615b324c8:mime/multipart: limit parsed mime message sizes

  The parsed forms of MIME headers and multipart forms can consume
  substantially more memory than the size of the input data.
  A malicious input containing a very large number of headers or
  form parts can cause excessively large memory allocations.

  Set limits on the size of MIME data:

  Reader.NextPart and Reader.NextRawPart limit the the number
  of headers in a part to 10000.

  Reader.ReadForm limits the total number of headers in all
  FileHeaders to 10000.

  Both of these limits may be set with with
  GODEBUG=multipartmaxheaders=<values>.

  Reader.ReadForm limits the number of parts in a form to 1000.
  This limit may be set with GODEBUG=multipartmaxparts=<value>.

  Thanks for Jakob Ackermann (@das7pad) for reporting this issue.

  For CVE-2023-24536
  For #59153

  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802455
  Run-TryBot: Damien Neil <dneil@google.com>
  Reviewed-by: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  Change-Id: I08dd297bd75724aade4b0bd6a7d19aeca5bbf99f
  Reviewed-on: https://go-review.googlesource.com/c/go/+/482077
  Run-TryBot: Michael Knyszek <mknyszek@google.com>
  Auto-Submit: Michael Knyszek <mknyszek@google.com>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Reviewed-by: Matthew Dempsky <mdempsky@google.com>
  3c010f2c2182a12f28ad86c5e1ff984f1f2d880a:net/textproto, mime/multipart: improve accounting of non-file data

  For requests containing large numbers of small parts,
  memory consumption of a parsed form could be about 250%
  over the estimated size.

  When considering the size of parsed forms, account for the size of
  FileHeader structs and increase the estimate of memory consumed by
  map entries.

  Thanks to Jakob Ackermann (@das7pad) for reporting this issue.

  For CVE-2023-24536
  For #59153

  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802454
  Run-TryBot: Damien Neil <dneil@google.com>
  Reviewed-by: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  Change-Id: I9620758495ed77c09ca6dc5db4b723c29f3baad8
  Reviewed-on: https://go-review.googlesource.com/c/go/+/482076
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Auto-Submit: Michael Knyszek <mknyszek@google.com>
  Run-TryBot: Michael Knyszek <mknyszek@google.com>
  Reviewed-by: Matthew Dempsky <mdempsky@google.com>
  3549c613b9d354d9f5410afc54dc9f7e6393c8cf:mime/multipart: avoid excessive copy buffer allocations in ReadForm

  When copying form data to disk with io.Copy,
  allocate only one copy buffer and reuse it rather than
  creating two buffers per file (one from io.multiReader.WriteTo,
  and a second one from os.File.ReadFrom).

  Thanks to Jakob Ackermann (@das7pad) for reporting this issue.

  For CVE-2023-24536
  For #59153

  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802453
  Run-TryBot: Damien Neil <dneil@google.com>
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  Reviewed-by: Roland Shoemaker <bracewell@google.com>
  Change-Id: I732bd2e1e7467918cac8ab9d65d089272ba4656f
  Reviewed-on: https://go-review.googlesource.com/c/go/+/482075
  Auto-Submit: Michael Knyszek <mknyszek@google.com>
  Reviewed-by: Matthew Dempsky <mdempsky@google.com>
  TryBot-Bypass: Michael Knyszek <mknyszek@google.com>
  Run-TryBot: Michael Knyszek <mknyszek@google.com>
  bf8c7c575c8a552d9d79deb29e80854dc88528d0:[release-branch.go1.20] mime/multipart: limit parsed mime message sizes

  The parsed forms of MIME headers and multipart forms can consume
  substantially more memory than the size of the input data.
  A malicious input containing a very large number of headers or
  form parts can cause excessively large memory allocations.

  Set limits on the size of MIME data:

  Reader.NextPart and Reader.NextRawPart limit the the number
  of headers in a part to 10000.

  Reader.ReadForm limits the total number of headers in all
  FileHeaders to 10000.

  Both of these limits may be set with with
  GODEBUG=multipartmaxheaders=<values>.

  Reader.ReadForm limits the number of parts in a form to 1000.
  This limit may be set with GODEBUG=multipartmaxparts=<value>.

  Thanks for Jakob Ackermann (@das7pad) for reporting this issue.

  For CVE-2023-24536
  For #59153
  For #59270

  Change-Id: I36ddceead7f8292c327286fd8694e6113d3b4977
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802455
  Run-TryBot: Damien Neil <dneil@google.com>
  Reviewed-by: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802608
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/481991
  Run-TryBot: Michael Knyszek <mknyszek@google.com>
  Reviewed-by: Matthew Dempsky <mdempsky@google.com>
  Auto-Submit: Michael Knyszek <mknyszek@google.com>
  TryBot-Bypass: Michael Knyszek <mknyszek@google.com>
  ec18f62df59d8f857e63ed3d7480754c49b072c3:[release-branch.go1.20] net/textproto, mime/multipart: improve accounting of non-file data

  For requests containing large numbers of small parts,
  memory consumption of a parsed form could be about 250%
  over the estimated size.

  When considering the size of parsed forms, account for the size of
  FileHeader structs and increase the estimate of memory consumed by
  map entries.

  Thanks to Jakob Ackermann (@das7pad) for reporting this issue.

  For CVE-2023-24536
  For #59153
  For #59270

  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802454
  Run-TryBot: Damien Neil <dneil@google.com>
  Reviewed-by: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  Change-Id: I9753aa1f8a1b1479c160f870def3b7081b6847ac
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802399
  TryBot-Result: Security TryBots <security-trybots@go-security-trybots.iam.gserviceaccount.com>
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/481990
  TryBot-Bypass: Michael Knyszek <mknyszek@google.com>
  Reviewed-by: Matthew Dempsky <mdempsky@google.com>
  Run-TryBot: Michael Knyszek <mknyszek@google.com>
  Auto-Submit: Michael Knyszek <mknyszek@google.com>
  ea6b5a64dd5bf68b33286436ffbe06f68a1fdbfd:[release-branch.go1.20] mime/multipart: avoid excessive copy buffer allocations in ReadForm

  When copying form data to disk with io.Copy,
  allocate only one copy buffer and reuse it rather than
  creating two buffers per file (one from io.multiReader.WriteTo,
  and a second one from os.File.ReadFrom).

  Thanks to Jakob Ackermann (@das7pad) for reporting this issue.

  For CVE-2023-24536
  For #59153
  For #59270

  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802453
  Run-TryBot: Damien Neil <dneil@google.com>
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  Reviewed-by: Roland Shoemaker <bracewell@google.com>
  Change-Id: I44ef17c4b4964cdac2858317275594194801fee3
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802398
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/481989
  Auto-Submit: Michael Knyszek <mknyszek@google.com>
  Run-TryBot: Michael Knyszek <mknyszek@google.com>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Reviewed-by: Matthew Dempsky <mdempsky@google.com>
  7917b5f31204528ea72e0629f0b7d52b35b27538:[release-branch.go1.19] mime/multipart: limit parsed mime message sizes

  The parsed forms of MIME headers and multipart forms can consume
  substantially more memory than the size of the input data.
  A malicious input containing a very large number of headers or
  form parts can cause excessively large memory allocations.

  Set limits on the size of MIME data:

  Reader.NextPart and Reader.NextRawPart limit the the number
  of headers in a part to 10000.

  Reader.ReadForm limits the total number of headers in all
  FileHeaders to 10000.

  Both of these limits may be set with with
  GODEBUG=multipartmaxheaders=<values>.

  Reader.ReadForm limits the number of parts in a form to 1000.
  This limit may be set with GODEBUG=multipartmaxparts=<value>.

  Thanks for Jakob Ackermann (@das7pad) for reporting this issue.

  For CVE-2023-24536
  For #59153
  For #59269

  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802455
  Run-TryBot: Damien Neil <dneil@google.com>
  Reviewed-by: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1801087
  Reviewed-by: Damien Neil <dneil@google.com>
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  Change-Id: If134890d75f0d95c681d67234daf191ba08e6424
  Reviewed-on: https://go-review.googlesource.com/c/go/+/481985
  Run-TryBot: Michael Knyszek <mknyszek@google.com>
  Auto-Submit: Michael Knyszek <mknyszek@google.com>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Reviewed-by: Matthew Dempsky <mdempsky@google.com>
  7a359a651c7ebdb29e0a1c03102fce793e9f58f0:[release-branch.go1.19] net/textproto, mime/multipart: improve accounting of non-file data

  For requests containing large numbers of small parts,
  memory consumption of a parsed form could be about 250%
  over the estimated size.

  When considering the size of parsed forms, account for the size of
  FileHeader structs and increase the estimate of memory consumed by
  map entries.

  Thanks to Jakob Ackermann (@das7pad) for reporting this issue.

  For CVE-2023-24536
  For #59153
  For #59269

  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802454
  Run-TryBot: Damien Neil <dneil@google.com>
  Reviewed-by: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802396
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Damien Neil <dneil@google.com>
  Change-Id: I31bc50e9346b4eee6fbe51a18c3c57230cc066db
  Reviewed-on: https://go-review.googlesource.com/c/go/+/481984
  Reviewed-by: Matthew Dempsky <mdempsky@google.com>
  Auto-Submit: Michael Knyszek <mknyszek@google.com>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Run-TryBot: Michael Knyszek <mknyszek@google.com>
  ef41a4e2face45e580c5836eaebd51629fc23f15:[release-branch.go1.19] mime/multipart: avoid excessive copy buffer allocations in ReadForm

  When copying form data to disk with io.Copy,
  allocate only one copy buffer and reuse it rather than
  creating two buffers per file (one from io.multiReader.WriteTo,
  and a second one from os.File.ReadFrom).

  Thanks to Jakob Ackermann (@das7pad) for reporting this issue.

  For CVE-2023-24536
  For #59153
  For #59269

  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802453
  Run-TryBot: Damien Neil <dneil@google.com>
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  Reviewed-by: Roland Shoemaker <bracewell@google.com>
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802395
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Damien Neil <dneil@google.com>
  Change-Id: Ie405470c92abffed3356913b37d813e982c96c8b
  Reviewed-on: https://go-review.googlesource.com/c/go/+/481983
  Run-TryBot: Michael Knyszek <mknyszek@google.com>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Auto-Submit: Michael Knyszek <mknyszek@google.com>
  Reviewed-by: Matthew Dempsky <mdempsky@google.com>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 3549c613b9d354d9f5410afc54dc9f7e6393c8cf
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 7a359a651c7ebdb29e0a1c03102fce793e9f58f0
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: bf8c7c575c8a552d9d79deb29e80854dc88528d0
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: ef41a4e2face45e580c5836eaebd51629fc23f15
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 7917b5f31204528ea72e0629f0b7d52b35b27538
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 3c010f2c2182a12f28ad86c5e1ff984f1f2d880a
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: ec18f62df59d8f857e63ed3d7480754c49b072c3
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 1e43cfa15b4b618812e85c00c9e92c2615b324c8
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: ea6b5a64dd5bf68b33286436ffbe06f68a1fdbfd
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/1e43cfa15b4b618812e85c00c9e92c2615b324c8
    reference_type: commit
    reference_id: 1e43cfa15b4b618812e85c00c9e92c2615b324c8
  - url: https://github.com/golang/go/tree/3549c613b9d354d9f5410afc54dc9f7e6393c8cf
    reference_type: commit
    reference_id: 3549c613b9d354d9f5410afc54dc9f7e6393c8cf
  - url: https://github.com/golang/go/tree/3c010f2c2182a12f28ad86c5e1ff984f1f2d880a
    reference_type: commit
    reference_id: 3c010f2c2182a12f28ad86c5e1ff984f1f2d880a
  - url: https://github.com/golang/go/tree/7917b5f31204528ea72e0629f0b7d52b35b27538
    reference_type: commit
    reference_id: 7917b5f31204528ea72e0629f0b7d52b35b27538
  - url: https://github.com/golang/go/tree/7a359a651c7ebdb29e0a1c03102fce793e9f58f0
    reference_type: commit
    reference_id: 7a359a651c7ebdb29e0a1c03102fce793e9f58f0
  - url: https://github.com/golang/go/tree/bf8c7c575c8a552d9d79deb29e80854dc88528d0
    reference_type: commit
    reference_id: bf8c7c575c8a552d9d79deb29e80854dc88528d0
  - url: https://github.com/golang/go/tree/ea6b5a64dd5bf68b33286436ffbe06f68a1fdbfd
    reference_type: commit
    reference_id: ea6b5a64dd5bf68b33286436ffbe06f68a1fdbfd
  - url: https://github.com/golang/go/tree/ec18f62df59d8f857e63ed3d7480754c49b072c3
    reference_type: commit
    reference_id: ec18f62df59d8f857e63ed3d7480754c49b072c3
  - url: https://github.com/golang/go/tree/ef41a4e2face45e580c5836eaebd51629fc23f15
    reference_type: commit
    reference_id: ef41a4e2face45e580c5836eaebd51629fc23f15
