advisory_id: CVE-2021-39293
datasource_id: collect_go_fix_commits/CVE-2021-39293
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  6c480017ae600b2c90a264a922e041df04dfa785:[release-branch.go1.16] archive/zip: prevent preallocation check from overflowing

  If the indicated directory size in the archive header is so large that
  subtracting it from the archive size overflows a uint64, the check that
  the indicated number of files in the archive can be effectively
  bypassed. Prevent this from happening by checking that the indicated
  directory size is less than the size of the archive.

  Thanks to the OSS-Fuzz project for discovering this issue and to
  Emmanuel Odeke for reporting it.

  Fixes #47985
  Updates #47801
  Fixes CVE-2021-39293

  Change-Id: Ifade26b98a40f3b37398ca86bd5252d12394dd24
  Reviewed-on: https://go-review.googlesource.com/c/go/+/343434
  Trust: Roland Shoemaker <roland@golang.org>
  Run-TryBot: Roland Shoemaker <roland@golang.org>
  TryBot-Result: Go Bot <gobot@golang.org>
  Reviewed-by: Russ Cox <rsc@golang.org>
  (cherry picked from commit bacbc33439b124ffd7392c91a5f5d96eca8c0c0b)
  Reviewed-on: https://go-review.googlesource.com/c/go/+/345409
  Reviewed-by: Emmanuel Odeke <emmanuel@orijtech.com>
  Run-TryBot: Emmanuel Odeke <emmanuel@orijtech.com>
  Trust: Cherry Mui <cherryyz@google.com>
  1dd24caf08985066b309af6bc461780c73e05c35:[release-branch.go1.17] archive/zip: prevent preallocation check from overflowing

  If the indicated directory size in the archive header is so large that
  subtracting it from the archive size overflows a uint64, the check that
  the indicated number of files in the archive can be effectively
  bypassed. Prevent this from happening by checking that the indicated
  directory size is less than the size of the archive.

  Thanks to the OSS-Fuzz project for discovering this issue and to
  Emmanuel Odeke for reporting it.

  Fixes #47986
  Updates #47801
  Fixes CVE-2021-39293

  Change-Id: Ifade26b98a40f3b37398ca86bd5252d12394dd24
  Reviewed-on: https://go-review.googlesource.com/c/go/+/343434
  Trust: Roland Shoemaker <roland@golang.org>
  Run-TryBot: Roland Shoemaker <roland@golang.org>
  TryBot-Result: Go Bot <gobot@golang.org>
  Reviewed-by: Russ Cox <rsc@golang.org>
  (cherry picked from commit bacbc33439b124ffd7392c91a5f5d96eca8c0c0b)
  Reviewed-on: https://go-review.googlesource.com/c/go/+/345410
  Reviewed-by: Emmanuel Odeke <emmanuel@orijtech.com>
  Run-TryBot: Emmanuel Odeke <emmanuel@orijtech.com>
  Trust: Cherry Mui <cherryyz@google.com>
  bacbc33439b124ffd7392c91a5f5d96eca8c0c0b:archive/zip: prevent preallocation check from overflowing

  If the indicated directory size in the archive header is so large that
  subtracting it from the archive size overflows a uint64, the check that
  the indicated number of files in the archive can be effectively
  bypassed. Prevent this from happening by checking that the indicated
  directory size is less than the size of the archive.

  Thanks to the OSS-Fuzz project for discovering this issue and to
  Emmanuel Odeke for reporting it.

  Fixes #47801
  Fixes CVE-2021-39293

  Change-Id: Ifade26b98a40f3b37398ca86bd5252d12394dd24
  Reviewed-on: https://go-review.googlesource.com/c/go/+/343434
  Trust: Roland Shoemaker <roland@golang.org>
  Run-TryBot: Roland Shoemaker <roland@golang.org>
  TryBot-Result: Go Bot <gobot@golang.org>
  Reviewed-by: Russ Cox <rsc@golang.org>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: bacbc33439b124ffd7392c91a5f5d96eca8c0c0b
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 6c480017ae600b2c90a264a922e041df04dfa785
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 1dd24caf08985066b309af6bc461780c73e05c35
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/1dd24caf08985066b309af6bc461780c73e05c35
    reference_type: commit
    reference_id: 1dd24caf08985066b309af6bc461780c73e05c35
  - url: https://github.com/golang/go/tree/6c480017ae600b2c90a264a922e041df04dfa785
    reference_type: commit
    reference_id: 6c480017ae600b2c90a264a922e041df04dfa785
  - url: https://github.com/golang/go/tree/bacbc33439b124ffd7392c91a5f5d96eca8c0c0b
    reference_type: commit
    reference_id: bacbc33439b124ffd7392c91a5f5d96eca8c0c0b
