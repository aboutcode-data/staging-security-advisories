advisory_id: CVE-2019-14809
datasource_id: collect_go_fix_commits/CVE-2019-14809
datasource_url: https://github.com/golang/go
aliases: []
summary: "c1d9ca70995dc232a2145e3214f94e03409f6fcc:[release-branch.go1.11-security] net/url:\
  \ make Hostname and Port predictable for invalid Host values\n\nWhen Host is not valid per\
  \ RFC 3986, the behavior of Hostname and Port\nwas wildly unpredictable, to the point that\
  \ Host could have a suffix\nthat didn't appear in neither Hostname nor Port.\n\nThis is a\
  \ security issue when applications are applying checks to Host\nand expecting them to be meaningful\
  \ for the contents of Hostname.\n\nTo reduce disruption, this change only aims to guarantee\
  \ the following\ntwo security-relevant invariants.\n\n* Host is either Hostname or [Hostname]\
  \ with Port empty, or\n  Hostname:Port or [Hostname]:Port.\n\n* Port is only decimals.\n\n\
  The second invariant is the one that's most likely to cause disruption,\nbut I believe it's\
  \ important, as it's conceivable an application might\ndo a suffix check on Host and expect\
  \ it to be meaningful for the\ncontents of Hostname (if the suffix is not a valid port).\n\
  \nThere are three ways to ensure it.\n\n1) Reject invalid ports in Parse. Note that non-numeric\
  \ ports are\n   already rejected if and only if the host starts with \"[\".\n\n2) Consider\
  \ non-numeric ports as part of Hostname, not Port.\n\n3) Allow non-numeric ports, and hope\
  \ they only flow down to net/http,\n   which will reject them (#14353).\n\nThis change adopts\
  \ both 1 and 2. We could do only the latter, but then\nthese invalid hosts would flow past\
  \ port checks, like in\nhttp_test.TestTransportRejectsAlphaPort. Non-numeric ports weren't\
  \ fully\nsupported anyway, because they were rejected after IPv6 literals, so\nthis restores\
  \ consistency. We could do only the former, but at this\npoint 2) is free and might help with\
  \ manually constructed Host values\n(or if we get something wrong in Parse).\n\nNote that\
  \ net.SplitHostPort and net.Dial explicitly accept service names\nin place of port numbers,\
  \ but this is an URL package, and RFC 3986,\nSection 3.2.3, clearly specifies ports as a number\
  \ in decimal.\n\nnet/http uses a mix of net.SplitHostPort and url.Parse that would\ndeserve\
  \ looking into, but in general it seems that it will still accept\nservice names in Addr fields\
  \ as they are passed to net.Listen, while\nrejecting them in URLs, which feels correct.\n\n\
  This leaves a number of invalid URLs to reject, which however are not\nsecurity relevant once\
  \ the two invariants above hold, so can be done in\nGo 1.14: IPv6 literals without brackets\
  \ (#31024), invalid IPv6 literals,\nhostnames with invalid characters, and more.\n\nTested\
  \ with 200M executions of go-fuzz and the following Fuzz function.\n\n\tu, err := url.Parse(string(data))\n\
  \tif err != nil {\n\t\treturn 0\n\t}\n\th := u.Hostname()\n\tp := u.Port()\n\n\tswitch u.Host\
  \ {\n\tcase h + \":\" + p:\n\t\treturn 1\n\tcase \"[\" + h + \"]:\" + p:\n\t\treturn 1\n\t\
  case h:\n\t\tfallthrough\n\tcase \"[\" + h + \"]\":\n\t\tif p != \"\" {\n\t\t\tpanic(\"unexpected\
  \ Port()\")\n\t\t}\n\t\treturn 1\n\t}\n\tpanic(\"Host is not a variant of [Hostname]:Port\"\
  )\n\nFixes CVE-2019-14809\nUpdates #29098\n\nChange-Id: I7ef40823dab28f29511329fa2d5a7fb10c3ec895\n\
  Reviewed-on: https://go-review.googlesource.com/c/go/+/189258\nReviewed-by: Ian Lance Taylor\
  \ <iant@golang.org>\n(cherry picked from commit 61bb56ad63992a3199acc55b2537c8355ef887b6)\n\
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/526408\nReviewed-by:\
  \ Dmitri Shuralyov <dmitshur@google.com>\n(cherry picked from commit 3226f2d492963d361af9dfc6714ef141ba606713)\n\
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/526409\n3226f2d492963d361af9dfc6714ef141ba606713:[release-branch.go1.12-security]\
  \ net/url: make Hostname and Port predictable for invalid Host values\n\nWhen Host is not\
  \ valid per RFC 3986, the behavior of Hostname and Port\nwas wildly unpredictable, to the\
  \ point that Host could have a suffix\nthat didn't appear in neither Hostname nor Port.\n\n\
  This is a security issue when applications are applying checks to Host\nand expecting them\
  \ to be meaningful for the contents of Hostname.\n\nTo reduce disruption, this change only\
  \ aims to guarantee the following\ntwo security-relevant invariants.\n\n* Host is either Hostname\
  \ or [Hostname] with Port empty, or\n  Hostname:Port or [Hostname]:Port.\n\n* Port is only\
  \ decimals.\n\nThe second invariant is the one that's most likely to cause disruption,\nbut\
  \ I believe it's important, as it's conceivable an application might\ndo a suffix check on\
  \ Host and expect it to be meaningful for the\ncontents of Hostname (if the suffix is not\
  \ a valid port).\n\nThere are three ways to ensure it.\n\n1) Reject invalid ports in Parse.\
  \ Note that non-numeric ports are\n   already rejected if and only if the host starts with\
  \ \"[\".\n\n2) Consider non-numeric ports as part of Hostname, not Port.\n\n3) Allow non-numeric\
  \ ports, and hope they only flow down to net/http,\n   which will reject them (#14353).\n\n\
  This change adopts both 1 and 2. We could do only the latter, but then\nthese invalid hosts\
  \ would flow past port checks, like in\nhttp_test.TestTransportRejectsAlphaPort. Non-numeric\
  \ ports weren't fully\nsupported anyway, because they were rejected after IPv6 literals, so\n\
  this restores consistency. We could do only the former, but at this\npoint 2) is free and\
  \ might help with manually constructed Host values\n(or if we get something wrong in Parse).\n\
  \nNote that net.SplitHostPort and net.Dial explicitly accept service names\nin place of port\
  \ numbers, but this is an URL package, and RFC 3986,\nSection 3.2.3, clearly specifies ports\
  \ as a number in decimal.\n\nnet/http uses a mix of net.SplitHostPort and url.Parse that would\n\
  deserve looking into, but in general it seems that it will still accept\nservice names in\
  \ Addr fields as they are passed to net.Listen, while\nrejecting them in URLs, which feels\
  \ correct.\n\nThis leaves a number of invalid URLs to reject, which however are not\nsecurity\
  \ relevant once the two invariants above hold, so can be done in\nGo 1.14: IPv6 literals without\
  \ brackets (#31024), invalid IPv6 literals,\nhostnames with invalid characters, and more.\n\
  \nTested with 200M executions of go-fuzz and the following Fuzz function.\n\n\tu, err := url.Parse(string(data))\n\
  \tif err != nil {\n\t\treturn 0\n\t}\n\th := u.Hostname()\n\tp := u.Port()\n\n\tswitch u.Host\
  \ {\n\tcase h + \":\" + p:\n\t\treturn 1\n\tcase \"[\" + h + \"]:\" + p:\n\t\treturn 1\n\t\
  case h:\n\t\tfallthrough\n\tcase \"[\" + h + \"]\":\n\t\tif p != \"\" {\n\t\t\tpanic(\"unexpected\
  \ Port()\")\n\t\t}\n\t\treturn 1\n\t}\n\tpanic(\"Host is not a variant of [Hostname]:Port\"\
  )\n\nFixes CVE-2019-14809\nUpdates #29098\n\nChange-Id: I7ef40823dab28f29511329fa2d5a7fb10c3ec895\n\
  Reviewed-on: https://go-review.googlesource.com/c/go/+/189258\nReviewed-by: Ian Lance Taylor\
  \ <iant@golang.org>\n(cherry picked from commit 61bb56ad63992a3199acc55b2537c8355ef887b6)\n\
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/526408\nReviewed-by:\
  \ Dmitri Shuralyov <dmitshur@google.com>\n61bb56ad63992a3199acc55b2537c8355ef887b6:net/url:\
  \ make Hostname and Port predictable for invalid Host values\n\nWhen Host is not valid per\
  \ RFC 3986, the behavior of Hostname and Port\nwas wildly unpredictable, to the point that\
  \ Host could have a suffix\nthat didn't appear in neither Hostname nor Port.\n\nThis is a\
  \ security issue when applications are applying checks to Host\nand expecting them to be meaningful\
  \ for the contents of Hostname.\n\nTo reduce disruption, this change only aims to guarantee\
  \ the following\ntwo security-relevant invariants.\n\n* Host is either Hostname or [Hostname]\
  \ with Port empty, or\n  Hostname:Port or [Hostname]:Port.\n\n* Port is only decimals.\n\n\
  The second invariant is the one that's most likely to cause disruption,\nbut I believe it's\
  \ important, as it's conceivable an application might\ndo a suffix check on Host and expect\
  \ it to be meaningful for the\ncontents of Hostname (if the suffix is not a valid port).\n\
  \nThere are three ways to ensure it.\n\n1) Reject invalid ports in Parse. Note that non-numeric\
  \ ports are\n   already rejected if and only if the host starts with \"[\".\n\n2) Consider\
  \ non-numeric ports as part of Hostname, not Port.\n\n3) Allow non-numeric ports, and hope\
  \ they only flow down to net/http,\n   which will reject them (#14353).\n\nThis change adopts\
  \ both 1 and 2. We could do only the latter, but then\nthese invalid hosts would flow past\
  \ port checks, like in\nhttp_test.TestTransportRejectsAlphaPort. Non-numeric ports weren't\
  \ fully\nsupported anyway, because they were rejected after IPv6 literals, so\nthis restores\
  \ consistency. We could do only the former, but at this\npoint 2) is free and might help with\
  \ manually constructed Host values\n(or if we get something wrong in Parse).\n\nNote that\
  \ net.SplitHostPort and net.Dial explicitly accept service names\nin place of port numbers,\
  \ but this is an URL package, and RFC 3986,\nSection 3.2.3, clearly specifies ports as a number\
  \ in decimal.\n\nnet/http uses a mix of net.SplitHostPort and url.Parse that would\ndeserve\
  \ looking into, but in general it seems that it will still accept\nservice names in Addr fields\
  \ as they are passed to net.Listen, while\nrejecting them in URLs, which feels correct.\n\n\
  This leaves a number of invalid URLs to reject, which however are not\nsecurity relevant once\
  \ the two invariants above hold, so can be done in\nGo 1.14: IPv6 literals without brackets\
  \ (#31024), invalid IPv6 literals,\nhostnames with invalid characters, and more.\n\nTested\
  \ with 200M executions of go-fuzz and the following Fuzz function.\n\n\tu, err := url.Parse(string(data))\n\
  \tif err != nil {\n\t\treturn 0\n\t}\n\th := u.Hostname()\n\tp := u.Port()\n\n\tswitch u.Host\
  \ {\n\tcase h + \":\" + p:\n\t\treturn 1\n\tcase \"[\" + h + \"]:\" + p:\n\t\treturn 1\n\t\
  case h:\n\t\tfallthrough\n\tcase \"[\" + h + \"]\":\n\t\tif p != \"\" {\n\t\t\tpanic(\"unexpected\
  \ Port()\")\n\t\t}\n\t\treturn 1\n\t}\n\tpanic(\"Host is not a variant of [Hostname]:Port\"\
  )\n\nFixes CVE-2019-14809\nUpdates #29098\n\nChange-Id: I7ef40823dab28f29511329fa2d5a7fb10c3ec895\n\
  Reviewed-on: https://go-review.googlesource.com/c/go/+/189258\nReviewed-by: Ian Lance Taylor\
  \ <iant@golang.org>"
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 61bb56ad63992a3199acc55b2537c8355ef887b6
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 3226f2d492963d361af9dfc6714ef141ba606713
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: c1d9ca70995dc232a2145e3214f94e03409f6fcc
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/3226f2d492963d361af9dfc6714ef141ba606713
    reference_type: commit
    reference_id: 3226f2d492963d361af9dfc6714ef141ba606713
  - url: https://github.com/golang/go/tree/61bb56ad63992a3199acc55b2537c8355ef887b6
    reference_type: commit
    reference_id: 61bb56ad63992a3199acc55b2537c8355ef887b6
  - url: https://github.com/golang/go/tree/c1d9ca70995dc232a2145e3214f94e03409f6fcc
    reference_type: commit
    reference_id: c1d9ca70995dc232a2145e3214f94e03409f6fcc
