advisory_id: CVE-2024-45340
datasource_id: collect_go_fix_commits/CVE-2024-45340
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  8336dfde7096ff75c1ff256cb3079863cefac33a:[release-branch.go1.24] cmd/go: restore netrc preferences for GOAUTH and fix domain lookup

  Store netrc lines into the credential map backward so that earlier lines
  take priority over later lines. This matches Go 1.23 netrc lookup which
  stopped at the first match it found.
  Additionally, this fixes a security issue related to domain parsing
  which could have allowed servers to read credentials belonging to other
  servers. The fix was to switch from using path.Dir(currentPrefix) to
  strings.Cut(currentPrefix, "/")

  Thanks to Juho Forsén of Mattermost for reporting this issue.

  Fixes #71249
  Fixes CVE-2024-45340

  Change-Id: I175a00d6d7f4d31c9e4d79b7cf1c2a0ad35b2781
  Reviewed-on: https://go-internal-review.googlesource.com/c/go/+/1781
  Reviewed-by: Tatiana Bradley <tatianabradley@google.com>
  Commit-Queue: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Damien Neil <dneil@google.com>
  (cherry picked from commit 76833d221aa3ccc978b6f41bd24e26babf771375)
  Reviewed-on: https://go-internal-review.googlesource.com/c/go/+/1840
  Reviewed-on: https://go-review.googlesource.com/c/go/+/643101
  Reviewed-by: Michael Pratt <mpratt@google.com>
  LUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>
  Auto-Submit: Michael Knyszek <mknyszek@google.com>
  139d6eedae38f9e8bc81bb2c8c5c2c75d12853ab:cmd/go: restore netrc preferences for GOAUTH and fix domain lookup

  Store netrc lines into the credential map backward so that earlier lines
  take priority over later lines. This matches Go 1.23 netrc lookup which
  stopped at the first match it found.
  Additionally, this fixes a security issue related to domain parsing
  which could have allowed servers to read credentials belonging to other
  servers. The fix was to switch from using path.Dir(currentPrefix) to
  strings.Cut(currentPrefix, "/")

  Thanks to Juho Forsén of Mattermost for reporting this issue.

  Fixes #71249
  Fixes CVE-2024-45340

  Change-Id: I175a00d6d7f4d31c9e4d79b7cf1c2a0ad35b2781
  Reviewed-on: https://go-internal-review.googlesource.com/c/go/+/1781
  Reviewed-by: Tatiana Bradley <tatianabradley@google.com>
  Commit-Queue: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Damien Neil <dneil@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/643097
  Reviewed-by: Michael Pratt <mpratt@google.com>
  LUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>
  Auto-Submit: Michael Knyszek <mknyszek@google.com>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 139d6eedae38f9e8bc81bb2c8c5c2c75d12853ab
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 8336dfde7096ff75c1ff256cb3079863cefac33a
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/139d6eedae38f9e8bc81bb2c8c5c2c75d12853ab
    reference_type: commit
    reference_id: 139d6eedae38f9e8bc81bb2c8c5c2c75d12853ab
  - url: https://github.com/golang/go/tree/8336dfde7096ff75c1ff256cb3079863cefac33a
    reference_type: commit
    reference_id: 8336dfde7096ff75c1ff256cb3079863cefac33a
