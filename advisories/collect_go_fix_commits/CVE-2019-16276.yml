advisory_id: CVE-2019-16276
datasource_id: collect_go_fix_commits/CVE-2019-16276
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  41b1f88efab9d263408448bf139659119002ea50:net/textproto: don't normalize headers with spaces before the colon

  RFC 7230 is clear about headers with a space before the colon, like

  X-Answer : 42

  being invalid, but we've been accepting and normalizing them for compatibility
  purposes since CL 5690059 in 2012.

  On the client side, this is harmless and indeed most browsers behave the same
  to this day. On the server side, this becomes a security issue when the
  behavior doesn't match that of a reverse proxy sitting in front of the server.

  For example, if a WAF accepts them without normalizing them, it might be
  possible to bypass its filters, because the Go server would interpret the
  header differently. Worse, if the reverse proxy coalesces requests onto a
  single HTTP/1.1 connection to a Go server, the understanding of the request
  boundaries can get out of sync between them, allowing an attacker to tack an
  arbitrary method and path onto a request by other clients, including
  authentication headers unknown to the attacker.

  This was recently presented at multiple security conferences:
  https://portswigger.net/blog/http-desync-attacks-request-smuggling-reborn

  net/http servers already reject header keys with invalid characters.
  Simply stop normalizing extra spaces in net/textproto, let it return them
  unchanged like it does for other invalid headers, and let net/http enforce
  RFC 7230, which is HTTP specific. This loses us normalization on the client
  side, but there's no right answer on the client side anyway, and hiding the
  issue sounds worse than letting the application decide.

  Fixes CVE-2019-16276
  Fixes #34540

  Change-Id: I6d272de827e0870da85d93df770d6a0e161bbcf1
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/549719
  Reviewed-by: Brad Fitzpatrick <bradfitz@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/197503
  Run-TryBot: Filippo Valsorda <filippo@golang.org>
  TryBot-Result: Gobot Gobot <gobot@golang.org>
  Reviewed-by: Dmitri Shuralyov <dmitshur@golang.org>
  6e6f4aaf70c8b1cc81e65a26332aa9409de03ad8:[release-branch.go1.12-security] net/textproto: don't normalize headers with spaces before the colon

  RFC 7230 is clear about headers with a space before the colon, like

  X-Answer : 42

  being invalid, but we've been accepting and normalizing them for compatibility
  purposes since CL 5690059 in 2012.

  On the client side, this is harmless and indeed most browsers behave the same
  to this day. On the server side, this becomes a security issue when the
  behavior doesn't match that of a reverse proxy sitting in front of the server.

  For example, if a WAF accepts them without normalizing them, it might be
  possible to bypass its filters, because the Go server would interpret the
  header differently. Worse, if the reverse proxy coalesces requests onto a
  single HTTP/1.1 connection to a Go server, the understanding of the request
  boundaries can get out of sync between them, allowing an attacker to tack an
  arbitrary method and path onto a request by other clients, including
  authentication headers unknown to the attacker.

  This was recently presented at multiple security conferences:
  https://portswigger.net/blog/http-desync-attacks-request-smuggling-reborn

  net/http servers already reject header keys with invalid characters.
  Simply stop normalizing extra spaces in net/textproto, let it return them
  unchanged like it does for other invalid headers, and let net/http enforce
  RFC 7230, which is HTTP specific. This loses us normalization on the client
  side, but there's no right answer on the client side anyway, and hiding the
  issue sounds worse than letting the application decide.

  Fixes CVE-2019-16276

  Change-Id: I6d272de827e0870da85d93df770d6a0e161bbcf1
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/549719
  Reviewed-by: Brad Fitzpatrick <bradfitz@google.com>
  (cherry picked from commit 1280b868e82bf173ea3e988be3092d160ee66082)
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/558776
  Reviewed-by: Dmitri Shuralyov <dmitshur@google.com>
  5a6ab1ec3e678640befebeb3318b746a64ad986c:[release-branch.go1.13-security] net/textproto: don't normalize headers with spaces before the colon

  RFC 7230 is clear about headers with a space before the colon, like

  X-Answer : 42

  being invalid, but we've been accepting and normalizing them for compatibility
  purposes since CL 5690059 in 2012.

  On the client side, this is harmless and indeed most browsers behave the same
  to this day. On the server side, this becomes a security issue when the
  behavior doesn't match that of a reverse proxy sitting in front of the server.

  For example, if a WAF accepts them without normalizing them, it might be
  possible to bypass its filters, because the Go server would interpret the
  header differently. Worse, if the reverse proxy coalesces requests onto a
  single HTTP/1.1 connection to a Go server, the understanding of the request
  boundaries can get out of sync between them, allowing an attacker to tack an
  arbitrary method and path onto a request by other clients, including
  authentication headers unknown to the attacker.

  This was recently presented at multiple security conferences:
  https://portswigger.net/blog/http-desync-attacks-request-smuggling-reborn

  net/http servers already reject header keys with invalid characters.
  Simply stop normalizing extra spaces in net/textproto, let it return them
  unchanged like it does for other invalid headers, and let net/http enforce
  RFC 7230, which is HTTP specific. This loses us normalization on the client
  side, but there's no right answer on the client side anyway, and hiding the
  issue sounds worse than letting the application decide.

  Fixes CVE-2019-16276

  Change-Id: I6d272de827e0870da85d93df770d6a0e161bbcf1
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/549719
  Reviewed-by: Brad Fitzpatrick <bradfitz@google.com>
  (cherry picked from commit 1280b868e82bf173ea3e988be3092d160ee66082)
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/558935
  Reviewed-by: Dmitri Shuralyov <dmitshur@google.com>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 5a6ab1ec3e678640befebeb3318b746a64ad986c
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 6e6f4aaf70c8b1cc81e65a26332aa9409de03ad8
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 41b1f88efab9d263408448bf139659119002ea50
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/41b1f88efab9d263408448bf139659119002ea50
    reference_type: commit
    reference_id: 41b1f88efab9d263408448bf139659119002ea50
  - url: https://github.com/golang/go/tree/5a6ab1ec3e678640befebeb3318b746a64ad986c
    reference_type: commit
    reference_id: 5a6ab1ec3e678640befebeb3318b746a64ad986c
  - url: https://github.com/golang/go/tree/6e6f4aaf70c8b1cc81e65a26332aa9409de03ad8
    reference_type: commit
    reference_id: 6e6f4aaf70c8b1cc81e65a26332aa9409de03ad8
