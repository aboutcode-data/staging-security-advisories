advisory_id: CVE-2022-41720
datasource_id: collect_go_fix_commits/CVE-2022-41720
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  7dc9fcb13de7bb20b11f6a526865545cc9142c2c:os, net/http: avoid escapes from os.DirFS and http.Dir on Windows

  Do not permit access to Windows reserved device names (NUL, COM1, etc.)
  via os.DirFS and http.Dir filesystems.

  Avoid escapes from os.DirFS(`\`) on Windows. DirFS would join the
  the root to the relative path with a path separator, making
  os.DirFS(`\`).Open(`/foo/bar`) open the path `\\foo\bar`, which is
  a UNC name. Not only does this not open the intended file, but permits
  reference to any file on the system rather than only files on the
  current drive.

  Make os.DirFS("") invalid, with all file access failing. Previously,
  a root of "" was interpreted as "/", which is surprising and probably
  unintentional.

  Fixes CVE-2022-41720
  Fixes #56694

  Change-Id: I275b5fa391e6ad7404309ea98ccc97405942e0f0
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1663834
  Reviewed-by: Tatiana Bradley <tatianabradley@google.com>
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/455362
  Reviewed-by: Michael Pratt <mpratt@google.com>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Run-TryBot: Jenny Rakoczy <jenny@golang.org>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/455716
  Reviewed-by: Jenny Rakoczy <jenny@golang.org>
  Run-TryBot: Damien Neil <dneil@google.com>
  d80340177116c079fb2ad681dd4aaa4bdc27b770:[release-branch.go1.19] os, net/http: avoid escapes from os.DirFS and http.Dir on Windows

  Do not permit access to Windows reserved device names (NUL, COM1, etc.)
  via os.DirFS and http.Dir filesystems.

  Avoid escapes from os.DirFS(`\`) on Windows. DirFS would join the
  the root to the relative path with a path separator, making
  os.DirFS(`\`).Open(`/foo/bar`) open the path `\\foo\bar`, which is
  a UNC name. Not only does this not open the intended file, but permits
  reference to any file on the system rather than only files on the
  current drive.

  Make os.DirFS("") invalid, with all file access failing. Previously,
  a root of "" was interpreted as "/", which is surprising and probably
  unintentional.

  Fixes CVE-2022-41720
  Fixes #56694

  Change-Id: I275b5fa391e6ad7404309ea98ccc97405942e0f0
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1663834
  Reviewed-by: Tatiana Bradley <tatianabradley@google.com>
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/455362
  Reviewed-by: Michael Pratt <mpratt@google.com>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Run-TryBot: Jenny Rakoczy <jenny@golang.org>
  7013a4f5f816af62033ad63dd06b77c30d7a62a7:[release-branch.go1.18] os, net/http: avoid escapes from os.DirFS and http.Dir on Windows

  Do not permit access to Windows reserved device names (NUL, COM1, etc.)
  via os.DirFS and http.Dir filesystems.

  Avoid escapes from os.DirFS(`\`) on Windows. DirFS would join the
  the root to the relative path with a path separator, making
  os.DirFS(`\`).Open(`/foo/bar`) open the path `\\foo\bar`, which is
  a UNC name. Not only does this not open the intended file, but permits
  reference to any file on the system rather than only files on the
  current drive.

  Make os.DirFS("") invalid, with all file access failing. Previously,
  a root of "" was interpreted as "/", which is surprising and probably
  unintentional.

  Fixes CVE-2022-41720.
  Fixes #56694.

  Change-Id: I275b5fa391e6ad7404309ea98ccc97405942e0f0
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1663832
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  Reviewed-by: Tatiana Bradley <tatianabradley@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/455360
  Reviewed-by: Michael Pratt <mpratt@google.com>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Run-TryBot: Jenny Rakoczy <jenny@golang.org>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 7dc9fcb13de7bb20b11f6a526865545cc9142c2c
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: d80340177116c079fb2ad681dd4aaa4bdc27b770
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 7013a4f5f816af62033ad63dd06b77c30d7a62a7
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/7013a4f5f816af62033ad63dd06b77c30d7a62a7
    reference_type: commit
    reference_id: 7013a4f5f816af62033ad63dd06b77c30d7a62a7
  - url: https://github.com/golang/go/tree/7dc9fcb13de7bb20b11f6a526865545cc9142c2c
    reference_type: commit
    reference_id: 7dc9fcb13de7bb20b11f6a526865545cc9142c2c
  - url: https://github.com/golang/go/tree/d80340177116c079fb2ad681dd4aaa4bdc27b770
    reference_type: commit
    reference_id: d80340177116c079fb2ad681dd4aaa4bdc27b770
