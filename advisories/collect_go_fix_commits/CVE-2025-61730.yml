advisory_id: CVE-2025-61730
datasource_id: collect_go_fix_commits/CVE-2025-61730
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  ad2cd043db66cd36e1f55359638729d2c8ff3d99:[release-branch.go1.24] crypto/tls: reject trailing messages after client/server hello

  For TLS 1.3, after procesesing the server/client hello, if there isn't a
  CCS message, reject the trailing messages which were appended to the
  hello messages. This prevents an on-path attacker from injecting
  plaintext messages into the handshake.

  Additionally, check that we don't have any buffered messages before we
  switch the read traffic secret regardless, since any buffered messages
  would have been under an old key which is no longer appropriate.

  We also invert the ordering of setting the read/write secrets so that if
  we fail when changing the read secret we send the alert using the
  correct write secret.

  Updates #76443
  Fixes #76854
  Fixes CVE-2025-61730

  Change-Id: If6ba8ad16f48d5cd5db5574824062ad4244a5b52
  Reviewed-on: https://go-review.googlesource.com/c/go/+/724120
  LUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>
  Reviewed-by: Michael Knyszek <mknyszek@google.com>
  Reviewed-by: Daniel McCarney <daniel@binaryparadox.net>
  Reviewed-by: Coia Prant <coiaprant@gmail.com>
  (cherry picked from commit 5046bdf8a612b35a2c1a9e168054c1d5c65e7dd7)
  Reviewed-on: https://go-review.googlesource.com/c/go/+/731961
  Reviewed-by: Damien Neil <dneil@google.com>
  525dd853633f90d6038719d9a48cba3770ca71ea:[release-branch.go1.25] crypto/tls: reject trailing messages after client/server hello

  For TLS 1.3, after procesesing the server/client hello, if there isn't a
  CCS message, reject the trailing messages which were appended to the
  hello messages. This prevents an on-path attacker from injecting
  plaintext messages into the handshake.

  Additionally, check that we don't have any buffered messages before we
  switch the read traffic secret regardless, since any buffered messages
  would have been under an old key which is no longer appropriate.

  We also invert the ordering of setting the read/write secrets so that if
  we fail when changing the read secret we send the alert using the
  correct write secret.

  Updates #76443
  Fixes #76855
  Fixes CVE-2025-61730

  Change-Id: If6ba8ad16f48d5cd5db5574824062ad4244a5b52
  Reviewed-on: https://go-review.googlesource.com/c/go/+/724120
  LUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>
  Reviewed-by: Michael Knyszek <mknyszek@google.com>
  Reviewed-by: Daniel McCarney <daniel@binaryparadox.net>
  Reviewed-by: Coia Prant <coiaprant@gmail.com>
  (cherry picked from commit 5046bdf8a612b35a2c1a9e168054c1d5c65e7dd7)
  Reviewed-on: https://go-review.googlesource.com/c/go/+/731960
  Reviewed-by: Damien Neil <dneil@google.com>
  5046bdf8a612b35a2c1a9e168054c1d5c65e7dd7:crypto/tls: reject trailing messages after client/server hello

  For TLS 1.3, after procesesing the server/client hello, if there isn't a
  CCS message, reject the trailing messages which were appended to the
  hello messages. This prevents an on-path attacker from injecting
  plaintext messages into the handshake.

  Additionally, check that we don't have any buffered messages before we
  switch the read traffic secret regardless, since any buffered messages
  would have been under an old key which is no longer appropriate.

  We also invert the ordering of setting the read/write secrets so that if
  we fail when changing the read secret we send the alert using the
  correct write secret.

  Fixes #76443
  Fixes CVE-2025-61730

  Change-Id: If6ba8ad16f48d5cd5db5574824062ad4244a5b52
  Reviewed-on: https://go-review.googlesource.com/c/go/+/724120
  LUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>
  Reviewed-by: Michael Knyszek <mknyszek@google.com>
  Reviewed-by: Daniel McCarney <daniel@binaryparadox.net>
  Reviewed-by: Coia Prant <coiaprant@gmail.com>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: ad2cd043db66cd36e1f55359638729d2c8ff3d99
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 525dd853633f90d6038719d9a48cba3770ca71ea
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 5046bdf8a612b35a2c1a9e168054c1d5c65e7dd7
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/5046bdf8a612b35a2c1a9e168054c1d5c65e7dd7
    reference_type: commit
    reference_id: 5046bdf8a612b35a2c1a9e168054c1d5c65e7dd7
  - url: https://github.com/golang/go/tree/525dd853633f90d6038719d9a48cba3770ca71ea
    reference_type: commit
    reference_id: 525dd853633f90d6038719d9a48cba3770ca71ea
  - url: https://github.com/golang/go/tree/ad2cd043db66cd36e1f55359638729d2c8ff3d99
    reference_type: commit
    reference_id: ad2cd043db66cd36e1f55359638729d2c8ff3d99
