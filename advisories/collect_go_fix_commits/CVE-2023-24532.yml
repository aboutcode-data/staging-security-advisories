advisory_id: CVE-2023-24532
datasource_id: collect_go_fix_commits/CVE-2023-24532
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  639b67ed114151c0d786aa26e7faeab942400703:[release-branch.go1.19] crypto/internal/nistec: reduce P-256 scalar

  Unlike the rest of nistec, the P-256 assembly doesn't use complete
  addition formulas, meaning that p256PointAdd[Affine]Asm won't return the
  correct value if the two inputs are equal.

  This was (undocumentedly) ignored in the scalar multiplication loops
  because as long as the input point is not the identity and the scalar is
  lower than the order of the group, the addition inputs can't be the same.

  As part of the math/big rewrite, we went however from always reducing
  the scalar to only checking its length, under the incorrect assumption
  that the scalar multiplication loop didn't require reduction.

  Added a reduction, and while at it added it in P256OrdInverse, too, to
  enforce a universal reduction invariant on p256OrdElement values.

  Note that if the input point is the infinity, the code currently still
  relies on undefined behavior, but that's easily tested to behave
  acceptably, and will be addressed in a future CL.

  Updates #58647
  Fixes #58719
  Fixes CVE-2023-24532

  (Filed with the "safe APIs like complete addition formulas are good" dept.)

  Change-Id: I7b2c75238440e6852be2710fad66ff1fdc4e2b24
  Reviewed-on: https://go-review.googlesource.com/c/go/+/471255
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Reviewed-by: Roland Shoemaker <roland@golang.org>
  Run-TryBot: Filippo Valsorda <filippo@golang.org>
  Auto-Submit: Filippo Valsorda <filippo@golang.org>
  Reviewed-by: Damien Neil <dneil@google.com>
  (cherry picked from commit 203e59ad41bd288e1d92b6f617c2f55e70d3c8e3)
  Reviewed-on: https://go-review.googlesource.com/c/go/+/471696
  Auto-Submit: Dmitri Shuralyov <dmitshur@google.com>
  Reviewed-by: Dmitri Shuralyov <dmitshur@google.com>
  Run-TryBot: Roland Shoemaker <roland@golang.org>
  Reviewed-by: Filippo Valsorda <filippo@golang.org>
  602eeaab387f24a4b28c5eccbb50fa934f3bc3c4:[release-branch.go1.20] crypto/internal/nistec: reduce P-256 scalar

  Unlike the rest of nistec, the P-256 assembly doesn't use complete
  addition formulas, meaning that p256PointAdd[Affine]Asm won't return the
  correct value if the two inputs are equal.

  This was (undocumentedly) ignored in the scalar multiplication loops
  because as long as the input point is not the identity and the scalar is
  lower than the order of the group, the addition inputs can't be the same.

  As part of the math/big rewrite, we went however from always reducing
  the scalar to only checking its length, under the incorrect assumption
  that the scalar multiplication loop didn't require reduction.

  Added a reduction, and while at it added it in P256OrdInverse, too, to
  enforce a universal reduction invariant on p256OrdElement values.

  Note that if the input point is the infinity, the code currently still
  relies on undefined behavior, but that's easily tested to behave
  acceptably, and will be addressed in a future CL.

  Updates #58647
  Fixes #58720
  Fixes CVE-2023-24532

  (Filed with the "safe APIs like complete addition formulas are good" dept.)

  Change-Id: I7b2c75238440e6852be2710fad66ff1fdc4e2b24
  Reviewed-on: https://go-review.googlesource.com/c/go/+/471255
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Reviewed-by: Roland Shoemaker <roland@golang.org>
  Run-TryBot: Filippo Valsorda <filippo@golang.org>
  Auto-Submit: Filippo Valsorda <filippo@golang.org>
  Reviewed-by: Damien Neil <dneil@google.com>
  (cherry picked from commit 203e59ad41bd288e1d92b6f617c2f55e70d3c8e3)
  Reviewed-on: https://go-review.googlesource.com/c/go/+/471695
  Reviewed-by: Dmitri Shuralyov <dmitshur@google.com>
  Auto-Submit: Dmitri Shuralyov <dmitshur@google.com>
  Reviewed-by: Filippo Valsorda <filippo@golang.org>
  Run-TryBot: Roland Shoemaker <roland@golang.org>
  203e59ad41bd288e1d92b6f617c2f55e70d3c8e3:crypto/internal/nistec: reduce P-256 scalar

  Unlike the rest of nistec, the P-256 assembly doesn't use complete
  addition formulas, meaning that p256PointAdd[Affine]Asm won't return the
  correct value if the two inputs are equal.

  This was (undocumentedly) ignored in the scalar multiplication loops
  because as long as the input point is not the identity and the scalar is
  lower than the order of the group, the addition inputs can't be the same.

  As part of the math/big rewrite, we went however from always reducing
  the scalar to only checking its length, under the incorrect assumption
  that the scalar multiplication loop didn't require reduction.

  Added a reduction, and while at it added it in P256OrdInverse, too, to
  enforce a universal reduction invariant on p256OrdElement values.

  Note that if the input point is the infinity, the code currently still
  relies on undefined behavior, but that's easily tested to behave
  acceptably, and will be addressed in a future CL.

  Fixes #58647
  Fixes CVE-2023-24532

  (Filed with the "safe APIs like complete addition formulas are good" dept.)

  Change-Id: I7b2c75238440e6852be2710fad66ff1fdc4e2b24
  Reviewed-on: https://go-review.googlesource.com/c/go/+/471255
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Reviewed-by: Roland Shoemaker <roland@golang.org>
  Run-TryBot: Filippo Valsorda <filippo@golang.org>
  Auto-Submit: Filippo Valsorda <filippo@golang.org>
  Reviewed-by: Damien Neil <dneil@google.com>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 203e59ad41bd288e1d92b6f617c2f55e70d3c8e3
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 639b67ed114151c0d786aa26e7faeab942400703
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 602eeaab387f24a4b28c5eccbb50fa934f3bc3c4
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/203e59ad41bd288e1d92b6f617c2f55e70d3c8e3
    reference_type: commit
    reference_id: 203e59ad41bd288e1d92b6f617c2f55e70d3c8e3
  - url: https://github.com/golang/go/tree/602eeaab387f24a4b28c5eccbb50fa934f3bc3c4
    reference_type: commit
    reference_id: 602eeaab387f24a4b28c5eccbb50fa934f3bc3c4
  - url: https://github.com/golang/go/tree/639b67ed114151c0d786aa26e7faeab942400703
    reference_type: commit
    reference_id: 639b67ed114151c0d786aa26e7faeab942400703
