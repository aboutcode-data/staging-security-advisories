advisory_id: CVE-2022-2880
datasource_id: collect_go_fix_commits/CVE-2022-2880
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  9d2c73a9fd69e45876509bb3bdb2af99bf77da1e:[release-branch.go1.18] net/http/httputil: avoid query parameter smuggling

  Query parameter smuggling occurs when a proxy's interpretation
  of query parameters differs from that of a downstream server.
  Change ReverseProxy to avoid forwarding ignored query parameters.

  Remove unparsable query parameters from the outbound request

     * if req.Form != nil after calling ReverseProxy.Director; and
     * before calling ReverseProxy.Rewrite.

  This change preserves the existing behavior of forwarding the
  raw query untouched if a Director hook does not parse the query
  by calling Request.ParseForm (possibly indirectly).

  Fixes #55842
  For #54663
  For CVE-2022-2880

  Change-Id: If1621f6b0e73a49d79059dae9e6b256e0ff18ca9
  Reviewed-on: https://go-review.googlesource.com/c/go/+/432976
  Reviewed-by: Roland Shoemaker <roland@golang.org>
  Reviewed-by: Brad Fitzpatrick <bradfitz@golang.org>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Run-TryBot: Damien Neil <dneil@google.com>
  (cherry picked from commit 7c84234142149bd24a4096c6cab691d3593f3431)
  Reviewed-on: https://go-review.googlesource.com/c/go/+/433695
  Reviewed-by: Dmitri Shuralyov <dmitshur@golang.org>
  Reviewed-by: Dmitri Shuralyov <dmitshur@google.com>
  f6d844510d5f1e3b3098eba255d9b633d45eac3b:[release-branch.go1.19] net/http/httputil: avoid query parameter smuggling

  Query parameter smuggling occurs when a proxy's interpretation
  of query parameters differs from that of a downstream server.
  Change ReverseProxy to avoid forwarding ignored query parameters.

  Remove unparsable query parameters from the outbound request

     * if req.Form != nil after calling ReverseProxy.Director; and
     * before calling ReverseProxy.Rewrite.

  This change preserves the existing behavior of forwarding the
  raw query untouched if a Director hook does not parse the query
  by calling Request.ParseForm (possibly indirectly).

  Fixes #55843
  For #54663
  For CVE-2022-2880

  Change-Id: If1621f6b0e73a49d79059dae9e6b256e0ff18ca9
  Reviewed-on: https://go-review.googlesource.com/c/go/+/432976
  Reviewed-by: Roland Shoemaker <roland@golang.org>
  Reviewed-by: Brad Fitzpatrick <bradfitz@golang.org>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Run-TryBot: Damien Neil <dneil@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/433735
  Reviewed-by: Dmitri Shuralyov <dmitshur@golang.org>
  Reviewed-by: Dmitri Shuralyov <dmitshur@google.com>
  7c84234142149bd24a4096c6cab691d3593f3431:net/http/httputil: avoid query parameter smuggling

  Query parameter smuggling occurs when a proxy's interpretation
  of query parameters differs from that of a downstream server.
  Change ReverseProxy to avoid forwarding ignored query parameters.

  Remove unparsable query parameters from the outbound request

     * if req.Form != nil after calling ReverseProxy.Director; and
     * before calling ReverseProxy.Rewrite.

  This change preserves the existing behavior of forwarding the
  raw query untouched if a Director hook does not parse the query
  by calling Request.ParseForm (possibly indirectly).

  Fixes #54663
  Fixes CVE-2022-2880

  Change-Id: If1621f6b0e73a49d79059dae9e6b256e0ff18ca9
  Reviewed-on: https://go-review.googlesource.com/c/go/+/432976
  Reviewed-by: Roland Shoemaker <roland@golang.org>
  Reviewed-by: Brad Fitzpatrick <bradfitz@golang.org>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Run-TryBot: Damien Neil <dneil@google.com>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: f6d844510d5f1e3b3098eba255d9b633d45eac3b
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 7c84234142149bd24a4096c6cab691d3593f3431
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 9d2c73a9fd69e45876509bb3bdb2af99bf77da1e
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/7c84234142149bd24a4096c6cab691d3593f3431
    reference_type: commit
    reference_id: 7c84234142149bd24a4096c6cab691d3593f3431
  - url: https://github.com/golang/go/tree/9d2c73a9fd69e45876509bb3bdb2af99bf77da1e
    reference_type: commit
    reference_id: 9d2c73a9fd69e45876509bb3bdb2af99bf77da1e
  - url: https://github.com/golang/go/tree/f6d844510d5f1e3b3098eba255d9b633d45eac3b
    reference_type: commit
    reference_id: f6d844510d5f1e3b3098eba255d9b633d45eac3b
