advisory_id: CVE-2020-28367
datasource_id: collect_go_fix_commits/CVE-2020-28367
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  062e0e5ce6df339dc26732438ad771f73dbf2292:cmd/go, cmd/cgo: don't let bogus symbol set cgo_ldflag

  A hand-edited object file can have a symbol name that uses newline and
  other normally invalid characters. The cgo tool will generate Go files
  containing symbol names, unquoted. That can permit those symbol names
  to inject Go code into a cgo-generated file. If that Go code uses the
  //go:cgo_ldflag pragma, it can cause the C linker to run arbitrary
  code when building a package. If you build an imported package we
  permit arbitrary code at run time, but we don't want to permit it at
  package build time. This CL prevents this in two ways.

  In cgo, reject invalid symbols that contain non-printable or space
  characters, or that contain anything that looks like a Go comment.

  In the go tool, double check all //go:cgo_ldflag directives in
  generated code, to make sure they follow the existing LDFLAG restrictions.

  Thanks to Imre Rad / https://www.linkedin.com/in/imre-rad-2358749b for
  reporting this.

  Fixes CVE-2020-28367

  Change-Id: Ia1ad8f3791ea79612690fa7d26ac451d0f6df7c1
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/895832
  Reviewed-by: Than McIntosh <thanm@google.com>
  Reviewed-by: Cherry Zhang <cherryyz@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/269658
  Trust: Katie Hockman <katie@golang.org>
  Trust: Roland Shoemaker <roland@golang.org>
  Run-TryBot: Katie Hockman <katie@golang.org>
  TryBot-Result: Go Bot <gobot@golang.org>
  Reviewed-by: Roland Shoemaker <roland@golang.org>
  ff5addb6be2fb3001f0cb026c3e4931090a85664:[release-branch.go1.14-security] cmd/go: in cgoflags, permit -DX1, prohibit -Wp,-D,opt

  Restrict -D and -U to ASCII C identifiers, but do permit trailing digits.
  When using -Wp, prohibit commas in -D values.

  Thanks to Imre Rad (https://www.linkedin.com/in/imre-rad-2358749b) for reporting this.

  Fixes CVE-2020-28367

  Change-Id: Ibfc4dfdd6e6c258e131448e7682610c44eee9492
  Reviewed-on: https://go-review.googlesource.com/c/go/+/267277
  Trust: Ian Lance Taylor <iant@golang.org>
  Run-TryBot: Ian Lance Taylor <iant@golang.org>
  TryBot-Result: Go Bot <gobot@golang.org>
  Reviewed-by: Bryan C. Mills <bcmills@google.com>
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/899923
  Reviewed-by: Filippo Valsorda <valsorda@google.com>
  ec06b6d6be568ce1591d91a0ea4f14c190d06605:[release-branch.go1.15-security] cmd/go: in cgoflags, permit -DX1, prohibit -Wp,-D,opt

  Restrict -D and -U to ASCII C identifiers, but do permit trailing digits.
  When using -Wp, prohibit commas in -D values.

  Thanks to Imre Rad (https://www.linkedin.com/in/imre-rad-2358749b) for reporting this.

  Fixes CVE-2020-28367

  Change-Id: Ibfc4dfdd6e6c258e131448e7682610c44eee9492
  Reviewed-on: https://go-review.googlesource.com/c/go/+/267277
  Trust: Ian Lance Taylor <iant@golang.org>
  Run-TryBot: Ian Lance Taylor <iant@golang.org>
  TryBot-Result: Go Bot <gobot@golang.org>
  Reviewed-by: Bryan C. Mills <bcmills@google.com>
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/899924
  Reviewed-by: Filippo Valsorda <valsorda@google.com>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 062e0e5ce6df339dc26732438ad771f73dbf2292
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: ff5addb6be2fb3001f0cb026c3e4931090a85664
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: ec06b6d6be568ce1591d91a0ea4f14c190d06605
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/062e0e5ce6df339dc26732438ad771f73dbf2292
    reference_type: commit
    reference_id: 062e0e5ce6df339dc26732438ad771f73dbf2292
  - url: https://github.com/golang/go/tree/ec06b6d6be568ce1591d91a0ea4f14c190d06605
    reference_type: commit
    reference_id: ec06b6d6be568ce1591d91a0ea4f14c190d06605
  - url: https://github.com/golang/go/tree/ff5addb6be2fb3001f0cb026c3e4931090a85664
    reference_type: commit
    reference_id: ff5addb6be2fb3001f0cb026c3e4931090a85664
