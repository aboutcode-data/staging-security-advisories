advisory_id: CVE-2020-14039
datasource_id: collect_go_fix_commits/CVE-2020-14039
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  82175e699a2e2cd83d3aa34949e9b922d66d52f5:crypto/x509: respect VerifyOptions.KeyUsages on Windows

  When using the platform verifier on Windows (because Roots is nil) we
  were always enforcing server auth EKUs if DNSName was set, and none
  otherwise. If an application was setting KeyUsages, they were not being
  respected.

  Started correctly surfacing IncompatibleUsage errors from the system
  verifier, as those are the ones applications will see if they are
  affected by this change.

  Also refactored verify_test.go to make it easier to add tests for this,
  and replaced the EKULeaf chain with a new one that doesn't have a SHA-1
  signature.

  Thanks to Niall Newman for reporting this.

  Fixes #39360
  Fixes CVE-2020-14039

  Change-Id: If5c00d615f2944f7d57007891aae1307f9571c32
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/774414
  Reviewed-by: Katie Hockman <katiehockman@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/242597
  Run-TryBot: Katie Hockman <katie@golang.org>
  Reviewed-by: Filippo Valsorda <filippo@golang.org>
  TryBot-Result: Gobot Gobot <gobot@golang.org>
  9c0a6cec5b8413ae837e8eeb5743ea1de2d819fc:[release-branch.go1.14-security] crypto/x509: respect VerifyOptions.KeyUsages on Windows

  When using the platform verifier on Windows (because Roots is nil) we
  were always enforcing server auth EKUs if DNSName was set, and none
  otherwise. If an application was setting KeyUsages, they were not being
  respected.

  Started correctly surfacing IncompatibleUsage errors from the system
  verifier, as those are the ones applications will see if they are
  affected by this change.

  Also refactored verify_test.go to make it easier to add tests for this,
  and replaced the EKULeaf chain with a new one that doesn't have a SHA-1
  signature.

  Thanks to Niall Newman for reporting this.

  Fixes #39360
  Fixes CVE-2020-14039

  Change-Id: If5c00d615f2944f7d57007891aae1307f9571c32
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/774414
  Reviewed-by: Katie Hockman <katiehockman@google.com>
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/793511
  Reviewed-by: Filippo Valsorda <valsorda@google.com>
  4a4c8d3d971fa77e4346d2874220ff736047f13c:[release-branch.go1.13-security] crypto/x509: respect VerifyOptions.KeyUsages on Windows

  When using the platform verifier on Windows (because Roots is nil) we
  were always enforcing server auth EKUs if DNSName was set, and none
  otherwise. If an application was setting KeyUsages, they were not being
  respected.

  Started correctly surfacing IncompatibleUsage errors from the system
  verifier, as those are the ones applications will see if they are
  affected by this change.

  Also refactored verify_test.go to make it easier to add tests for this,
  and replaced the EKULeaf chain with a new one that doesn't have a SHA-1
  signature.

  Thanks to Niall Newman for reporting this.

  Fixes #39360
  Fixes CVE-2020-14039

  Change-Id: If5c00d615f2944f7d57007891aae1307f9571c32
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/774414
  Reviewed-by: Katie Hockman <katiehockman@google.com>
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/793509
  Reviewed-by: Filippo Valsorda <valsorda@google.com>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 4a4c8d3d971fa77e4346d2874220ff736047f13c
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 82175e699a2e2cd83d3aa34949e9b922d66d52f5
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 9c0a6cec5b8413ae837e8eeb5743ea1de2d819fc
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/4a4c8d3d971fa77e4346d2874220ff736047f13c
    reference_type: commit
    reference_id: 4a4c8d3d971fa77e4346d2874220ff736047f13c
  - url: https://github.com/golang/go/tree/82175e699a2e2cd83d3aa34949e9b922d66d52f5
    reference_type: commit
    reference_id: 82175e699a2e2cd83d3aa34949e9b922d66d52f5
  - url: https://github.com/golang/go/tree/9c0a6cec5b8413ae837e8eeb5743ea1de2d819fc
    reference_type: commit
    reference_id: 9c0a6cec5b8413ae837e8eeb5743ea1de2d819fc
