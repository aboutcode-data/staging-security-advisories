advisory_id: CVE-2018-6574
datasource_id: collect_go_fix_commits/CVE-2018-6574
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  1dcb5836ad2c60776561da2923c70576ba2eefc6:cmd/go: accept only limited compiler and linker flags in #cgo directives

  Both gcc and clang accept an option -fplugin=code.so to load
  a plugin from the ELF shared object file code.so.
  Obviously that plugin can then do anything it wants
  during the build. This is contrary to the goal of "go get"
  never running untrusted code during the build.
  (What happens if you choose to run the result of
  the build is your responsibility.)

  Disallow this behavior by only allowing a small set of
  known command-line flags in #cgo CFLAGS directives
  (and #cgo LDFLAGS, etc).

  The new restrictions can be adjusted by the environment
  variables CGO_CFLAGS_ALLOW, CGO_CFLAGS_DISALLOW,
  and so on. See the documentation.

  In addition to excluding cgo-defined flags, we also have to
  make sure that when we pass file names on the command
  line, they don't look like flags. So we now refuse to build
  packages containing suspicious file names like -x.go.

  A wrinkle in all this is that GNU binutils uniformly accept
  @foo on the command line to mean "if the file foo exists,
  then substitute its contents for @foo in the command line".
  So we must also reject @x.go, flags and flag arguments
  beginning with @, and so on.

  Fixes #23672, CVE-2018-6574.

  Change-Id: I59e7c1355155c335a5c5ae0d2cf8fa7aa313940a
  Reviewed-on: https://team-review.git.corp.google.com/209949
  Reviewed-by: Ian Lance Taylor <iant@google.com>
  867fb18b6d5bc73266b68c9a695558a04e060a8a:[release-branch.go1.9] cmd/go: accept only limited compiler and linker flags in #cgo directives

  Both gcc and clang accept an option -fplugin=code.so to load
  a plugin from the ELF shared object file code.so.
  Obviously that plugin can then do anything it wants
  during the build. This is contrary to the goal of "go get"
  never running untrusted code during the build.
  (What happens if you choose to run the result of
  the build is your responsibility.)

  Disallow this behavior by only allowing a small set of
  known command-line flags in #cgo CFLAGS directives
  (and #cgo LDFLAGS, etc).

  The new restrictions can be adjusted by the environment
  variables CGO_CFLAGS_ALLOW, CGO_CFLAGS_DISALLOW,
  and so on. See the documentation.

  In addition to excluding cgo-defined flags, we also have to
  make sure that when we pass file names on the command
  line, they don't look like flags. So we now refuse to build
  packages containing suspicious file names like -x.go.

  A wrinkle in all this is that GNU binutils uniformly accept
  @foo on the command line to mean "if the file foo exists,
  then substitute its contents for @foo in the command line".
  So we must also reject @x.go, flags and flag arguments
  beginning with @, and so on.

  Fixes #23673, CVE-2018-6574.

  Change-Id: I59e7c1355155c335a5c5ae0d2cf8fa7aa313940a
  Reviewed-on: https://team-review.git.corp.google.com/212507
  Reviewed-by: Ian Lance Taylor <iant@google.com>
  44821583bc16ff2508664fab94360bb856e9e9d6:[release-branch.go1.8] cmd/go: accept only limited compiler and linker flags in #cgo directives

  Both gcc and clang accept an option -fplugin=code.so to load
  a plugin from the ELF shared object file code.so.
  Obviously that plugin can then do anything it wants
  during the build. This is contrary to the goal of "go get"
  never running untrusted code during the build.
  (What happens if you choose to run the result of
  the build is your responsibility.)

  Disallow this behavior by only allowing a small set of
  known command-line flags in #cgo CFLAGS directives
  (and #cgo LDFLAGS, etc).

  The new restrictions can be adjusted by the environment
  variables CGO_CFLAGS_ALLOW, CGO_CFLAGS_DISALLOW,
  and so on. See the documentation.

  In addition to excluding cgo-defined flags, we also have to
  make sure that when we pass file names on the command
  line, they don't look like flags. So we now refuse to build
  packages containing suspicious file names like -x.go.

  A wrinkle in all this is that GNU binutils uniformly accept
  @foo on the command line to mean "if the file foo exists,
  then substitute its contents for @foo in the command line".
  So we must also reject @x.go, flags and flag arguments
  beginning with @, and so on.

  Fixes #23674, CVE-2018-6574.

  Change-Id: I59e7c1355155c335a5c5ae0d2cf8fa7aa313940a
  Reviewed-on: https://team-review.git.corp.google.com/212688
  Reviewed-by: Ian Lance Taylor <iant@google.com>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 1dcb5836ad2c60776561da2923c70576ba2eefc6
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 44821583bc16ff2508664fab94360bb856e9e9d6
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 867fb18b6d5bc73266b68c9a695558a04e060a8a
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/1dcb5836ad2c60776561da2923c70576ba2eefc6
    reference_type: commit
    reference_id: 1dcb5836ad2c60776561da2923c70576ba2eefc6
  - url: https://github.com/golang/go/tree/44821583bc16ff2508664fab94360bb856e9e9d6
    reference_type: commit
    reference_id: 44821583bc16ff2508664fab94360bb856e9e9d6
  - url: https://github.com/golang/go/tree/867fb18b6d5bc73266b68c9a695558a04e060a8a
    reference_type: commit
    reference_id: 867fb18b6d5bc73266b68c9a695558a04e060a8a
