advisory_id: CVE-2023-39319
datasource_id: collect_go_fix_commits/CVE-2023-39319
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  b2f8f6c8ef43f4192cb64978036b75044e6290df:html/template: properly handle special tags within the script context

  The HTML specification has incredibly complex rules for how to handle
  "<!--", "<script", and "</script" when they appear within literals in
  the script context. Rather than attempting to apply these restrictions
  (which require a significantly more complex state machine) we apply
  the workaround suggested in section 4.12.1.3 of the HTML specification [1].

  More precisely, when "<!--", "<script", and "</script" appear within
  literals (strings and regular expressions, ignoring comments since we
  already elide their content) we replace the "<" with "\x3C". This avoids
  the unintuitive behavior that using these tags within literals can cause,
  by simply preventing the rendered content from triggering it. This may
  break some correct usages of these tags, but on balance is more likely
  to prevent XSS attacks where users are unknowingly either closing or not
  closing the script blocks where they think they are.

  Thanks to Takeshi Kaneko (GMO Cybersecurity by Ierae, Inc.) for
  reporting this issue.

  Fixes #62197
  Fixes CVE-2023-39319

  [1] https://html.spec.whatwg.org/#restrictions-for-contents-of-script-elements

  Change-Id: Iab57b0532694827e3eddf57a7497ba1fab1746dc
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1976594
  Reviewed-by: Dmitri Shuralyov <dmitshur@google.com>
  Reviewed-by: Tatiana Bradley <tatianabradley@google.com>
  Reviewed-by: Damien Neil <dneil@google.com>
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/526157
  Reviewed-by: Dmitri Shuralyov <dmitshur@golang.org>
  LUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>
  Reviewed-by: Roland Shoemaker <roland@golang.org>
  2070531d2f53df88e312edace6c8dfc9686ab2f5:[release-branch.go1.20] html/template: properly handle special tags within the script context

  The HTML specification has incredibly complex rules for how to handle
  "<!--", "<script", and "</script" when they appear within literals in
  the script context. Rather than attempting to apply these restrictions
  (which require a significantly more complex state machine) we apply
  the workaround suggested in section 4.12.1.3 of the HTML specification [1].

  More precisely, when "<!--", "<script", and "</script" appear within
  literals (strings and regular expressions, ignoring comments since we
  already elide their content) we replace the "<" with "\x3C". This avoids
  the unintuitive behavior that using these tags within literals can cause,
  by simply preventing the rendered content from triggering it. This may
  break some correct usages of these tags, but on balance is more likely
  to prevent XSS attacks where users are unknowingly either closing or not
  closing the script blocks where they think they are.

  Thanks to Takeshi Kaneko (GMO Cybersecurity by Ierae, Inc.) for
  reporting this issue.

  Fixes #62197
  Fixes #62397
  Fixes CVE-2023-39319

  [1] https://html.spec.whatwg.org/#restrictions-for-contents-of-script-elements

  Change-Id: Iab57b0532694827e3eddf57a7497ba1fab1746dc
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1976594
  Reviewed-by: Dmitri Shuralyov <dmitshur@google.com>
  Reviewed-by: Tatiana Bradley <tatianabradley@google.com>
  Reviewed-by: Damien Neil <dneil@google.com>
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/2014621
  TryBot-Result: Security TryBots <security-trybots@go-security-trybots.iam.gserviceaccount.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/526099
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Run-TryBot: Cherry Mui <cherryyz@google.com>
  bbd043ff0d6d59f1a9232d31ecd5eacf6507bf6a:[release-branch.go1.21] html/template: properly handle special tags within the script context

  The HTML specification has incredibly complex rules for how to handle
  "<!--", "<script", and "</script" when they appear within literals in
  the script context. Rather than attempting to apply these restrictions
  (which require a significantly more complex state machine) we apply
  the workaround suggested in section 4.12.1.3 of the HTML specification [1].

  More precisely, when "<!--", "<script", and "</script" appear within
  literals (strings and regular expressions, ignoring comments since we
  already elide their content) we replace the "<" with "\x3C". This avoids
  the unintuitive behavior that using these tags within literals can cause,
  by simply preventing the rendered content from triggering it. This may
  break some correct usages of these tags, but on balance is more likely
  to prevent XSS attacks where users are unknowingly either closing or not
  closing the script blocks where they think they are.

  Thanks to Takeshi Kaneko (GMO Cybersecurity by Ierae, Inc.) for
  reporting this issue.

  Fixes #62197
  Fixes #62398
  Fixes CVE-2023-39319

  [1] https://html.spec.whatwg.org/#restrictions-for-contents-of-script-elements

  Change-Id: Iab57b0532694827e3eddf57a7497ba1fab1746dc
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1976594
  Reviewed-by: Dmitri Shuralyov <dmitshur@google.com>
  Reviewed-by: Tatiana Bradley <tatianabradley@google.com>
  Reviewed-by: Damien Neil <dneil@google.com>
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/2014619
  Reviewed-on: https://go-review.googlesource.com/c/go/+/526097
  Run-TryBot: Cherry Mui <cherryyz@google.com>
  TryBot-Result: Gopher Robot <gobot@golang.org>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: b2f8f6c8ef43f4192cb64978036b75044e6290df
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 2070531d2f53df88e312edace6c8dfc9686ab2f5
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: bbd043ff0d6d59f1a9232d31ecd5eacf6507bf6a
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/2070531d2f53df88e312edace6c8dfc9686ab2f5
    reference_type: commit
    reference_id: 2070531d2f53df88e312edace6c8dfc9686ab2f5
  - url: https://github.com/golang/go/tree/b2f8f6c8ef43f4192cb64978036b75044e6290df
    reference_type: commit
    reference_id: b2f8f6c8ef43f4192cb64978036b75044e6290df
  - url: https://github.com/golang/go/tree/bbd043ff0d6d59f1a9232d31ecd5eacf6507bf6a
    reference_type: commit
    reference_id: bbd043ff0d6d59f1a9232d31ecd5eacf6507bf6a
