advisory_id: CVE-2022-41724
datasource_id: collect_go_fix_commits/CVE-2022-41724
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  00b256e9e3c0fa02a278ec9dfc3e191e02ceaf80:[release-branch.go1.19] crypto/tls: replace all usages of BytesOrPanic

  Message marshalling makes use of BytesOrPanic a lot, under the
  assumption that it will never panic. This assumption was incorrect, and
  specifically crafted handshakes could trigger panics. Rather than just
  surgically replacing the usages of BytesOrPanic in paths that could
  panic, replace all usages of it with proper error returns in case there
  are other ways of triggering panics which we didn't find.

  In one specific case, the tree routed by expandLabel, we replace the
  usage of BytesOrPanic, but retain a panic. This function already
  explicitly panicked elsewhere, and returning an error from it becomes
  rather painful because it requires changing a large number of APIs.
  The marshalling is unlikely to ever panic, as the inputs are all either
  fixed length, or already limited to the sizes required. If it were to
  panic, it'd likely only be during development. A close inspection shows
  no paths for a user to cause a panic currently.

  This patches ends up being rather large, since it requires routing
  errors back through functions which previously had no error returns.
  Where possible I've tried to use helpers that reduce the verbosity
  of frequently repeated stanzas, and to make the diffs as minimal as
  possible.

  Thanks to Marten Seemann for reporting this issue.

  Updates #58001
  Fixes #58358
  Fixes CVE-2022-41724

  Change-Id: Ieb55867ef0a3e1e867b33f09421932510cb58851
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1679436
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  TryBot-Result: Security TryBots <security-trybots@go-security-trybots.iam.gserviceaccount.com>
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Damien Neil <dneil@google.com>
  (cherry picked from commit 0f3a44ad7b41cc89efdfad25278953e17d9c1e04)
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1728204
  Reviewed-by: Tatiana Bradley <tatianabradley@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/468117
  Auto-Submit: Michael Pratt <mpratt@google.com>
  Run-TryBot: Michael Pratt <mpratt@google.com>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Reviewed-by: Than McIntosh <thanm@google.com>
  5286ac4ed85a3771cc8a982041fe36dc53d7dc3b:[release-branch.go1.20] crypto/tls: replace all usages of BytesOrPanic

  Message marshalling makes use of BytesOrPanic a lot, under the
  assumption that it will never panic. This assumption was incorrect, and
  specifically crafted handshakes could trigger panics. Rather than just
  surgically replacing the usages of BytesOrPanic in paths that could
  panic, replace all usages of it with proper error returns in case there
  are other ways of triggering panics which we didn't find.

  In one specific case, the tree routed by expandLabel, we replace the
  usage of BytesOrPanic, but retain a panic. This function already
  explicitly panicked elsewhere, and returning an error from it becomes
  rather painful because it requires changing a large number of APIs.
  The marshalling is unlikely to ever panic, as the inputs are all either
  fixed length, or already limited to the sizes required. If it were to
  panic, it'd likely only be during development. A close inspection shows
  no paths for a user to cause a panic currently.

  This patches ends up being rather large, since it requires routing
  errors back through functions which previously had no error returns.
  Where possible I've tried to use helpers that reduce the verbosity
  of frequently repeated stanzas, and to make the diffs as minimal as
  possible.

  Thanks to Marten Seemann for reporting this issue.

  Updates #58001
  Fixes #58359
  Fixes CVE-2022-41724

  Change-Id: Ieb55867ef0a3e1e867b33f09421932510cb58851
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1679436
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  TryBot-Result: Security TryBots <security-trybots@go-security-trybots.iam.gserviceaccount.com>
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Damien Neil <dneil@google.com>
  (cherry picked from commit 1d4e6ca9454f6cf81d30c5361146fb5988f1b5f6)
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1728205
  Reviewed-by: Tatiana Bradley <tatianabradley@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/468121
  Reviewed-by: Than McIntosh <thanm@google.com>
  Auto-Submit: Michael Pratt <mpratt@google.com>
  TryBot-Bypass: Michael Pratt <mpratt@google.com>
  Run-TryBot: Michael Pratt <mpratt@google.com>
  66c58b946beaa38de35241c3f64ec358f5ad03f1:crypto/tls: replace all usages of BytesOrPanic

  Message marshalling makes use of BytesOrPanic a lot, under the
  assumption that it will never panic. This assumption was incorrect, and
  specifically crafted handshakes could trigger panics. Rather than just
  surgically replacing the usages of BytesOrPanic in paths that could
  panic, replace all usages of it with proper error returns in case there
  are other ways of triggering panics which we didn't find.

  In one specific case, the tree routed by expandLabel, we replace the
  usage of BytesOrPanic, but retain a panic. This function already
  explicitly panicked elsewhere, and returning an error from it becomes
  rather painful because it requires changing a large number of APIs.
  The marshalling is unlikely to ever panic, as the inputs are all either
  fixed length, or already limited to the sizes required. If it were to
  panic, it'd likely only be during development. A close inspection shows
  no paths for a user to cause a panic currently.

  This patches ends up being rather large, since it requires routing
  errors back through functions which previously had no error returns.
  Where possible I've tried to use helpers that reduce the verbosity
  of frequently repeated stanzas, and to make the diffs as minimal as
  possible.

  Thanks to Marten Seemann for reporting this issue.

  Fixes #58001
  Fixes CVE-2022-41724

  Change-Id: Ieb55867ef0a3e1e867b33f09421932510cb58851
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1679436
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  TryBot-Result: Security TryBots <security-trybots@go-security-trybots.iam.gserviceaccount.com>
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Damien Neil <dneil@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/468125
  Run-TryBot: Michael Pratt <mpratt@google.com>
  Reviewed-by: Than McIntosh <thanm@google.com>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Auto-Submit: Michael Pratt <mpratt@google.com>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 66c58b946beaa38de35241c3f64ec358f5ad03f1
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 00b256e9e3c0fa02a278ec9dfc3e191e02ceaf80
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 5286ac4ed85a3771cc8a982041fe36dc53d7dc3b
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/00b256e9e3c0fa02a278ec9dfc3e191e02ceaf80
    reference_type: commit
    reference_id: 00b256e9e3c0fa02a278ec9dfc3e191e02ceaf80
  - url: https://github.com/golang/go/tree/5286ac4ed85a3771cc8a982041fe36dc53d7dc3b
    reference_type: commit
    reference_id: 5286ac4ed85a3771cc8a982041fe36dc53d7dc3b
  - url: https://github.com/golang/go/tree/66c58b946beaa38de35241c3f64ec358f5ad03f1
    reference_type: commit
    reference_id: 66c58b946beaa38de35241c3f64ec358f5ad03f1
