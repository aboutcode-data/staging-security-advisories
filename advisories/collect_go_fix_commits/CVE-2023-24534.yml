advisory_id: CVE-2023-24534
datasource_id: collect_go_fix_commits/CVE-2023-24534
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  3991f6c41c7dfd167e889234c0cf1d840475e93c:[release-branch.go1.20] net/textproto: avoid overpredicting the number of MIME header keys

  A parsed MIME header is a map[string][]string. In the common case,
  a header contains many one-element []string slices. To avoid
  allocating a separate slice for each key, ReadMIMEHeader looks
  ahead in the input to predict the number of keys that will be
  parsed, and allocates a single []string of that length.
  The individual slices are then allocated out of the larger one.

  The prediction of the number of header keys was done by counting
  newlines in the input buffer, which does not take into account
  header continuation lines (where a header key/value spans multiple
  lines) or the end of the header block and the start of the body.
  This could lead to a substantial amount of overallocation, for
  example when the body consists of nothing but a large block of
  newlines.

  Fix header key count prediction to take into account the end of
  the headers (indicated by a blank line) and continuation lines
  (starting with whitespace).

  Thanks to Jakob Ackermann (@das7pad) for reporting this issue.

  Fixes CVE-2023-24534
  For #58975
  Fixes #59268

  Change-Id: I0591593e67b6fdba22a32dcc3334fad797727f5c
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802452
  Run-TryBot: Damien Neil <dneil@google.com>
  Reviewed-by: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802397
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  TryBot-Result: Security TryBots <security-trybots@go-security-trybots.iam.gserviceaccount.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/481988
  Run-TryBot: Michael Knyszek <mknyszek@google.com>
  TryBot-Bypass: Michael Knyszek <mknyszek@google.com>
  Auto-Submit: Michael Knyszek <mknyszek@google.com>
  Reviewed-by: Matthew Dempsky <mdempsky@google.com>
  66ae75ff86950ae55ca1add47fa95b5576717be0:net/textproto: avoid overpredicting the number of MIME header keys

  A parsed MIME header is a map[string][]string. In the common case,
  a header contains many one-element []string slices. To avoid
  allocating a separate slice for each key, ReadMIMEHeader looks
  ahead in the input to predict the number of keys that will be
  parsed, and allocates a single []string of that length.
  The individual slices are then allocated out of the larger one.

  The prediction of the number of header keys was done by counting
  newlines in the input buffer, which does not take into account
  header continuation lines (where a header key/value spans multiple
  lines) or the end of the header block and the start of the body.
  This could lead to a substantial amount of overallocation, for
  example when the body consists of nothing but a large block of
  newlines.

  Fix header key count prediction to take into account the end of
  the headers (indicated by a blank line) and continuation lines
  (starting with whitespace).

  Thanks to Jakob Ackermann (@das7pad) for reporting this issue.

  For #58975
  Fixes CVE-2023-24534

  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802452
  Run-TryBot: Damien Neil <dneil@google.com>
  Reviewed-by: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  Change-Id: Iacc1c2b5ea6509529845a972414199f988ede1e5
  Reviewed-on: https://go-review.googlesource.com/c/go/+/481994
  Reviewed-by: Matthew Dempsky <mdempsky@google.com>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Run-TryBot: Michael Knyszek <mknyszek@google.com>
  Auto-Submit: Michael Knyszek <mknyszek@google.com>
  d6759e7a059f4208f07aa781402841d7ddaaef96:[release-branch.go1.19] net/textproto: avoid overpredicting the number of MIME header keys

  A parsed MIME header is a map[string][]string. In the common case,
  a header contains many one-element []string slices. To avoid
  allocating a separate slice for each key, ReadMIMEHeader looks
  ahead in the input to predict the number of keys that will be
  parsed, and allocates a single []string of that length.
  The individual slices are then allocated out of the larger one.

  The prediction of the number of header keys was done by counting
  newlines in the input buffer, which does not take into account
  header continuation lines (where a header key/value spans multiple
  lines) or the end of the header block and the start of the body.
  This could lead to a substantial amount of overallocation, for
  example when the body consists of nothing but a large block of
  newlines.

  Fix header key count prediction to take into account the end of
  the headers (indicated by a blank line) and continuation lines
  (starting with whitespace).

  Thanks to Jakob Ackermann (@das7pad) for reporting this issue.

  Fixes CVE-2023-24534
  For #58975
  Fixes #59267

  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802452
  Run-TryBot: Damien Neil <dneil@google.com>
  Reviewed-by: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Julie Qiu <julieqiu@google.com>
  (cherry picked from commit f739f080a72fd5b06d35c8e244165159645e2ed6)
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1802393
  Reviewed-by: Damien Neil <dneil@google.com>
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  Change-Id: I675451438d619a9130360c56daf529559004903f
  Reviewed-on: https://go-review.googlesource.com/c/go/+/481982
  Run-TryBot: Michael Knyszek <mknyszek@google.com>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Reviewed-by: Matthew Dempsky <mdempsky@google.com>
  Auto-Submit: Michael Knyszek <mknyszek@google.com>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 66ae75ff86950ae55ca1add47fa95b5576717be0
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: d6759e7a059f4208f07aa781402841d7ddaaef96
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 3991f6c41c7dfd167e889234c0cf1d840475e93c
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/3991f6c41c7dfd167e889234c0cf1d840475e93c
    reference_type: commit
    reference_id: 3991f6c41c7dfd167e889234c0cf1d840475e93c
  - url: https://github.com/golang/go/tree/66ae75ff86950ae55ca1add47fa95b5576717be0
    reference_type: commit
    reference_id: 66ae75ff86950ae55ca1add47fa95b5576717be0
  - url: https://github.com/golang/go/tree/d6759e7a059f4208f07aa781402841d7ddaaef96
    reference_type: commit
    reference_id: d6759e7a059f4208f07aa781402841d7ddaaef96
