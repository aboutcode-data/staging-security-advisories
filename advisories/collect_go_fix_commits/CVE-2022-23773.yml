advisory_id: CVE-2022-23773
datasource_id: collect_go_fix_commits/CVE-2022-23773
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  de76489a1b1cfce6b1258040c15b18ed97847758:[release-branch.go1.16] cmd/go/internal/modfetch: do not short-circuit canonical versions

  Since at least CL 121857, the conversion logic in
  (*modfetch).codeRepo.Stat has had a short-circuit to use the version
  requested by the caller if it successfully resolves and is already
  canonical.

  However, we should not use that version if it refers to a branch
  instead of a tag, because branches (unlike tags) usually do not refer
  to a single, stable release: a branch named "v1.0.0" may be for the
  development of the v1.0.0 release, or for the development of patches
  based on v1.0.0, but only one commit (perhaps at the end of that
  branch — but possibly not even written yet!) can be that specific
  version.

  We already have some logic to prefer tags that are semver-equivalent
  to the version requested by the caller. That more general case
  suffices for exact equality too — so we can eliminate the
  special-case, fixing the bug and (happily!) also somewhat simplifying
  the code.

  Updates #35671
  Fixes #50686
  Fixes CVE-2022-23773

  Change-Id: I2fd290190b8a99a580deec7e26d15659b58a50b0
  Reviewed-on: https://go-review.googlesource.com/c/go/+/378400
  Trust: Bryan Mills <bcmills@google.com>
  Run-TryBot: Bryan Mills <bcmills@google.com>
  Reviewed-by: Russ Cox <rsc@golang.org>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  (cherry picked from commit fa4d9b8e2bc2612960c80474fca83a4c85a974eb)
  Reviewed-on: https://go-review.googlesource.com/c/go/+/382839
  fbcc30a2c9d076b27b4b411e2cec91ec13528081:[release-branch.go1.17] cmd/go/internal/modfetch: do not short-circuit canonical versions

  Since at least CL 121857, the conversion logic in
  (*modfetch).codeRepo.Stat has had a short-circuit to use the version
  requested by the caller if it successfully resolves and is already
  canonical.

  However, we should not use that version if it refers to a branch
  instead of a tag, because branches (unlike tags) usually do not refer
  to a single, stable release: a branch named "v1.0.0" may be for the
  development of the v1.0.0 release, or for the development of patches
  based on v1.0.0, but only one commit (perhaps at the end of that
  branch — but possibly not even written yet!) can be that specific
  version.

  We already have some logic to prefer tags that are semver-equivalent
  to the version requested by the caller. That more general case
  suffices for exact equality too — so we can eliminate the
  special-case, fixing the bug and (happily!) also somewhat simplifying
  the code.

  Updates #35671
  Fixes #50687
  Fixes CVE-2022-23773

  Change-Id: I2fd290190b8a99a580deec7e26d15659b58a50b0
  Reviewed-on: https://go-review.googlesource.com/c/go/+/378400
  Trust: Bryan Mills <bcmills@google.com>
  Run-TryBot: Bryan Mills <bcmills@google.com>
  Reviewed-by: Russ Cox <rsc@golang.org>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  (cherry picked from commit fa4d9b8e2bc2612960c80474fca83a4c85a974eb)
  Reviewed-on: https://go-review.googlesource.com/c/go/+/382835
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: fbcc30a2c9d076b27b4b411e2cec91ec13528081
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: de76489a1b1cfce6b1258040c15b18ed97847758
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/de76489a1b1cfce6b1258040c15b18ed97847758
    reference_type: commit
    reference_id: de76489a1b1cfce6b1258040c15b18ed97847758
  - url: https://github.com/golang/go/tree/fbcc30a2c9d076b27b4b411e2cec91ec13528081
    reference_type: commit
    reference_id: fbcc30a2c9d076b27b4b411e2cec91ec13528081
