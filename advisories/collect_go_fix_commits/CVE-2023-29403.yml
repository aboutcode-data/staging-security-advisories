advisory_id: CVE-2023-29403
datasource_id: collect_go_fix_commits/CVE-2023-29403
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  2496653d0a5c6c26b879bb5bdd135e1f7504e051:runtime: implement SUID/SGID protections

  On Unix platforms, the runtime previously did nothing special when a
  program was run with either the SUID or SGID bits set. This can be
  dangerous in certain cases, such as when dumping memory state, or
  assuming the status of standard i/o file descriptors.

  Taking cues from glibc, this change implements a set of protections when
  a binary is run with SUID or SGID bits set (or is SUID/SGID-like). On
  Linux, whether to enable these protections is determined by whether the
  AT_SECURE flag is passed in the auxiliary vector. On platforms which
  have the issetugid syscall (the BSDs, darwin, and Solaris/Illumos), that
  is used. On the remaining platforms (currently only AIX) we check
  !(getuid() == geteuid() && getgid == getegid()).

  Currently when we determine a binary is "tainted" (using the glibc
  terminology), we implement two specific protections:
    1. we check if the file descriptors 0, 1, and 2 are open, and if they
       are not, we open them, pointing at /dev/null (or fail).
    2. we force GOTRACKBACK=none, and generally prevent dumping of
       trackbacks and registers when a program panics/aborts.

  In the future we may add additional protections.

  This change requires implementing issetugid on the platforms which
  support it, and implementing getuid, geteuid, getgid, and getegid on
  AIX.

  Thanks to Vincent Dehors from Synacktiv for reporting this issue.

  Fixes #60272
  Fixes CVE-2023-29403

  Change-Id: I73fc93f2b7a8933c192ce3eabbf1db359db7d5fa
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1878434
  Reviewed-by: Damien Neil <dneil@google.com>
  Reviewed-by: Ian Lance Taylor <iant@google.com>
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Russ Cox <rsc@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/501223
  Run-TryBot: David Chase <drchase@google.com>
  Reviewed-by: Michael Knyszek <mknyszek@google.com>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  36144ba429ef2650940c72e7a0b932af3612d420:[release-branch.go1.20] runtime: implement SUID/SGID protections

  On Unix platforms, the runtime previously did nothing special when a
  program was run with either the SUID or SGID bits set. This can be
  dangerous in certain cases, such as when dumping memory state, or
  assuming the status of standard i/o file descriptors.

  Taking cues from glibc, this change implements a set of protections when
  a binary is run with SUID or SGID bits set (or is SUID/SGID-like). On
  Linux, whether to enable these protections is determined by whether the
  AT_SECURE flag is passed in the auxiliary vector. On platforms which
  have the issetugid syscall (the BSDs, darwin, and Solaris/Illumos), that
  is used. On the remaining platforms (currently only AIX) we check
  !(getuid() == geteuid() && getgid == getegid()).

  Currently when we determine a binary is "tainted" (using the glibc
  terminology), we implement two specific protections:
    1. we check if the file descriptors 0, 1, and 2 are open, and if they
       are not, we open them, pointing at /dev/null (or fail).
    2. we force GOTRACKBACK=none, and generally prevent dumping of
       trackbacks and registers when a program panics/aborts.

  In the future we may add additional protections.

  This change requires implementing issetugid on the platforms which
  support it, and implementing getuid, geteuid, getgid, and getegid on
  AIX.

  Thanks to Vincent Dehors from Synacktiv for reporting this issue.

  Updates #60272
  Fixes #60518
  Fixes CVE-2023-29403

  Change-Id: Icb620f3f8755791d51b02b5c07fb24f40e19cb80
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1878434
  Reviewed-by: Damien Neil <dneil@google.com>
  Reviewed-by: Ian Lance Taylor <iant@google.com>
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Russ Cox <rsc@google.com>
  (cherry picked from commit 87065663ea6d89cd54f65a515d8f2ed0ef285c19)
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1902232
  TryBot-Result: Security TryBots <security-trybots@go-security-trybots.iam.gserviceaccount.com>
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1904344
  Reviewed-by: Michael Knyszek <mknyszek@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/501227
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Run-TryBot: David Chase <drchase@google.com>
  Auto-Submit: Michael Knyszek <mknyszek@google.com>
  a7b1cd452ddc69a6606c2f35ac5786dc892e62cb:[release-branch.go1.19] runtime: implement SUID/SGID protections

  On Unix platforms, the runtime previously did nothing special when a
  program was run with either the SUID or SGID bits set. This can be
  dangerous in certain cases, such as when dumping memory state, or
  assuming the status of standard i/o file descriptors.

  Taking cues from glibc, this change implements a set of protections when
  a binary is run with SUID or SGID bits set (or is SUID/SGID-like). On
  Linux, whether to enable these protections is determined by whether the
  AT_SECURE flag is passed in the auxiliary vector. On platforms which
  have the issetugid syscall (the BSDs, darwin, and Solaris/Illumos), that
  is used. On the remaining platforms (currently only AIX) we check
  !(getuid() == geteuid() && getgid == getegid()).

  Currently when we determine a binary is "tainted" (using the glibc
  terminology), we implement two specific protections:
    1. we check if the file descriptors 0, 1, and 2 are open, and if they
       are not, we open them, pointing at /dev/null (or fail).
    2. we force GOTRACKBACK=none, and generally prevent dumping of
       trackbacks and registers when a program panics/aborts.

  In the future we may add additional protections.

  This change requires implementing issetugid on the platforms which
  support it, and implementing getuid, geteuid, getgid, and getegid on
  AIX.

  Thanks to Vincent Dehors from Synacktiv for reporting this issue.

  Updates #60272
  Fixes #60517
  Fixes CVE-2023-29403

  Change-Id: I057fa7153d29cf26515e7f49fed86e4f8bedd0f0
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1878434
  Reviewed-by: Damien Neil <dneil@google.com>
  Reviewed-by: Ian Lance Taylor <iant@google.com>
  Run-TryBot: Roland Shoemaker <bracewell@google.com>
  Reviewed-by: Russ Cox <rsc@google.com>
  (cherry picked from commit 87065663ea6d89cd54f65a515d8f2ed0ef285c19)
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1902231
  Reviewed-on: https://team-review.git.corp.google.com/c/golang/go-private/+/1904340
  Reviewed-by: Michael Knyszek <mknyszek@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/501228
  Auto-Submit: Michael Knyszek <mknyszek@google.com>
  TryBot-Result: Gopher Robot <gobot@golang.org>
  Run-TryBot: David Chase <drchase@google.com>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 36144ba429ef2650940c72e7a0b932af3612d420
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 2496653d0a5c6c26b879bb5bdd135e1f7504e051
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: a7b1cd452ddc69a6606c2f35ac5786dc892e62cb
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/2496653d0a5c6c26b879bb5bdd135e1f7504e051
    reference_type: commit
    reference_id: 2496653d0a5c6c26b879bb5bdd135e1f7504e051
  - url: https://github.com/golang/go/tree/36144ba429ef2650940c72e7a0b932af3612d420
    reference_type: commit
    reference_id: 36144ba429ef2650940c72e7a0b932af3612d420
  - url: https://github.com/golang/go/tree/a7b1cd452ddc69a6606c2f35ac5786dc892e62cb
    reference_type: commit
    reference_id: a7b1cd452ddc69a6606c2f35ac5786dc892e62cb
