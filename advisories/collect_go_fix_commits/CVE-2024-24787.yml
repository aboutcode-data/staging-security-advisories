advisory_id: CVE-2024-24787
datasource_id: collect_go_fix_commits/CVE-2024-24787
datasource_url: https://github.com/golang/go
aliases: []
summary: |
  348b23830d82aece5775eb9f7f3b3587cf5300c6:cmd/go: disallow -lto_library in LDFLAGS

  The darwin linker allows setting the LTO library with the -lto_library
  flag. This wasn't caught by our "safe linker flags" check because it
  was covered by the -lx flag used for linking libraries. This change
  adds a specific check for excluded flags which otherwise satisfy our
  existing checks.

  Loading a mallicious LTO library would allow an attacker to cause the
  linker to execute abritrary code when "go build" was called.

  Thanks to Juho Forsén of Mattermost for reporting this issue.

  Fixes #67119
  Fixes CVE-2024-24787

  Change-Id: I77ac8585efbdbdfd5f39c39ed623b9408a0f9eaf
  Reviewed-on: https://go-internal-review.googlesource.com/c/go/+/1380
  Reviewed-by: Russ Cox <rsc@google.com>
  Reviewed-by: Damien Neil <dneil@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/583815
  Reviewed-by: David Chase <drchase@google.com>
  LUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>
  fa0292d252c762ff3de92b87d13417c50704f3a0:[release-branch.go1.22] cmd/go: disallow -lto_library in LDFLAGS

  The darwin linker allows setting the LTO library with the -lto_library
  flag. This wasn't caught by our "safe linker flags" check because it
  was covered by the -lx flag used for linking libraries. This change
  adds a specific check for excluded flags which otherwise satisfy our
  existing checks.

  Loading a mallicious LTO library would allow an attacker to cause the
  linker to execute abritrary code when "go build" was called.

  Thanks to Juho Forsén of Mattermost for reporting this issue.

  Fixes #67119
  Fixes #67122
  Fixes CVE-2024-24787

  Change-Id: I77ac8585efbdbdfd5f39c39ed623b9408a0f9eaf
  Reviewed-on: https://go-internal-review.googlesource.com/c/go/+/1380
  Reviewed-by: Russ Cox <rsc@google.com>
  Reviewed-by: Damien Neil <dneil@google.com>
  (cherry picked from commit 9a79141fbbca1105e5c786f15e38741ca7843290)
  Reviewed-on: https://go-internal-review.googlesource.com/c/go/+/1420
  Reviewed-by: Tatiana Bradley <tatianabradley@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/583796
  Reviewed-by: David Chase <drchase@google.com>
  LUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>
  a79ea27e36a1c56ae48dc36ce48549c9787ca4b7:[release-branch.go1.21] cmd/go: disallow -lto_library in LDFLAGS

  The darwin linker allows setting the LTO library with the -lto_library
  flag. This wasn't caught by our "safe linker flags" check because it
  was covered by the -lx flag used for linking libraries. This change
  adds a specific check for excluded flags which otherwise satisfy our
  existing checks.

  Loading a mallicious LTO library would allow an attacker to cause the
  linker to execute abritrary code when "go build" was called.

  Thanks to Juho Forsén of Mattermost for reporting this issue.

  Fixes #67119
  Fixes #67121
  Fixes CVE-2024-24787

  Change-Id: I77ac8585efbdbdfd5f39c39ed623b9408a0f9eaf
  Reviewed-on: https://go-internal-review.googlesource.com/c/go/+/1380
  Reviewed-by: Russ Cox <rsc@google.com>
  Reviewed-by: Damien Neil <dneil@google.com>
  (cherry picked from commit 9a79141fbbca1105e5c786f15e38741ca7843290)
  Reviewed-on: https://go-internal-review.googlesource.com/c/go/+/1401
  Reviewed-by: Tatiana Bradley <tatianabradley@google.com>
  Reviewed-on: https://go-review.googlesource.com/c/go/+/583795
  Reviewed-by: David Chase <drchase@google.com>
  LUCI-TryBot-Result: Go LUCI <golang-scoped@luci-project-accounts.iam.gserviceaccount.com>
impacted_packages:
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: 348b23830d82aece5775eb9f7f3b3587cf5300c6
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: fa0292d252c762ff3de92b87d13417c50704f3a0
    introduced_in_commits: []
  - purl: pkg:github/golang/go
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/golang/go
        commit: a79ea27e36a1c56ae48dc36ce48549c9787ca4b7
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/golang/go/tree/348b23830d82aece5775eb9f7f3b3587cf5300c6
    reference_type: commit
    reference_id: 348b23830d82aece5775eb9f7f3b3587cf5300c6
  - url: https://github.com/golang/go/tree/a79ea27e36a1c56ae48dc36ce48549c9787ca4b7
    reference_type: commit
    reference_id: a79ea27e36a1c56ae48dc36ce48549c9787ca4b7
  - url: https://github.com/golang/go/tree/fa0292d252c762ff3de92b87d13417c50704f3a0
    reference_type: commit
    reference_id: fa0292d252c762ff3de92b87d13417c50704f3a0
