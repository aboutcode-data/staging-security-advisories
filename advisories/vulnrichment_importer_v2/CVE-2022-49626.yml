advisory_id: CVE-2022-49626
datasource_id: vulnrichment_importer_v2/CVE-2022-49626
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2022/49xxx/CVE-2022-49626.json
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  sfc: fix use after free when disabling sriov

  Use after free is detected by kfence when disabling sriov. What was read
  after being freed was vf->pci_dev: it was freed from pci_disable_sriov
  and later read in efx_ef10_sriov_free_vf_vports, called from
  efx_ef10_sriov_free_vf_vswitching.

  Set the pointer to NULL at release time to not trying to read it later.

  Reproducer and dmesg log (note that kfence doesn't detect it every time):
  $ echo 1 > /sys/class/net/enp65s0f0np0/device/sriov_numvfs
  $ echo 0 > /sys/class/net/enp65s0f0np0/device/sriov_numvfs

   BUG: KFENCE: use-after-free read in efx_ef10_sriov_free_vf_vswitching+0x82/0x170 [sfc]

   Use-after-free read at 0x00000000ff3c1ba5 (in kfence-#224):
    efx_ef10_sriov_free_vf_vswitching+0x82/0x170 [sfc]
    efx_ef10_pci_sriov_disable+0x38/0x70 [sfc]
    efx_pci_sriov_configure+0x24/0x40 [sfc]
    sriov_numvfs_store+0xfe/0x140
    kernfs_fop_write_iter+0x11c/0x1b0
    new_sync_write+0x11f/0x1b0
    vfs_write+0x1eb/0x280
    ksys_write+0x5f/0xe0
    do_syscall_64+0x5c/0x80
    entry_SYSCALL_64_after_hwframe+0x44/0xae

   kfence-#224: 0x00000000edb8ef95-0x00000000671f5ce1, size=2792, cache=kmalloc-4k

   allocated by task 6771 on cpu 10 at 3137.860196s:
    pci_alloc_dev+0x21/0x60
    pci_iov_add_virtfn+0x2a2/0x320
    sriov_enable+0x212/0x3e0
    efx_ef10_sriov_configure+0x67/0x80 [sfc]
    efx_pci_sriov_configure+0x24/0x40 [sfc]
    sriov_numvfs_store+0xba/0x140
    kernfs_fop_write_iter+0x11c/0x1b0
    new_sync_write+0x11f/0x1b0
    vfs_write+0x1eb/0x280
    ksys_write+0x5f/0xe0
    do_syscall_64+0x5c/0x80
    entry_SYSCALL_64_after_hwframe+0x44/0xae

   freed by task 6771 on cpu 12 at 3170.991309s:
    device_release+0x34/0x90
    kobject_cleanup+0x3a/0x130
    pci_iov_remove_virtfn+0xd9/0x120
    sriov_disable+0x30/0xe0
    efx_ef10_pci_sriov_disable+0x57/0x70 [sfc]
    efx_pci_sriov_configure+0x24/0x40 [sfc]
    sriov_numvfs_store+0xfe/0x140
    kernfs_fop_write_iter+0x11c/0x1b0
    new_sync_write+0x11f/0x1b0
    vfs_write+0x1eb/0x280
    ksys_write+0x5f/0xe0
    do_syscall_64+0x5c/0x80
    entry_SYSCALL_64_after_hwframe+0x44/0xae
impacted_packages: []
severities:
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url:
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:T/P:M/B:A/M:M/D:T/2025-02-27T18:15:26Z/
    published_at: None
    url:
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/3199e34912d84cdfb8a93a984c5ae5c73fb13e84
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/58d93e9d160c0de6d867c7eb4c2206671a351eb1
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9c854ae512b89229aeee93849e9bd4c115b37909
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/bcad880865bfb421885364b1f0c7351280fe2b97
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c2240500817b3b4b996cdf2a461a3a5679f49b94
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c9e75bb22a26e391f189f5a5133dd63dcb57fdaa
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e435c4aeeaa073091f7f3b7735af2ef5c97d63f2
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ebe41da5d47ac0fff877e57bd14c54dccf168827
    reference_type:
    reference_id:
