advisory_id: CVE-2022-48815
datasource_id: vulnrichment_importer_v2/CVE-2022-48815
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2022/48xxx/CVE-2022-48815.json
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  net: dsa: bcm_sf2: don't use devres for mdiobus

  As explained in commits:
  74b6d7d13307 ("net: dsa: realtek: register the MDIO bus under devres")
  5135e96a3dd2 ("net: dsa: don't allocate the slave_mii_bus using devres")

  mdiobus_free() will panic when called from devm_mdiobus_free() <-
  devres_release_all() <- __device_release_driver(), and that mdiobus was
  not previously unregistered.

  The Starfighter 2 is a platform device, so the initial set of
  constraints that I thought would cause this (I2C or SPI buses which call
  ->remove on ->shutdown) do not apply. But there is one more which
  applies here.

  If the DSA master itself is on a bus that calls ->remove from ->shutdown
  (like dpaa2-eth, which is on the fsl-mc bus), there is a device link
  between the switch and the DSA master, and device_links_unbind_consumers()
  will unbind the bcm_sf2 switch driver on shutdown.

  So the same treatment must be applied to all DSA switch drivers, which
  is: either use devres for both the mdiobus allocation and registration,
  or don't use devres at all.

  The bcm_sf2 driver has the code structure in place for orderly mdiobus
  removal, so just replace devm_mdiobus_alloc() with the non-devres
  variant, and add manual free where necessary, to ensure that we don't
  let devres free a still-registered bus.
impacted_packages: []
severities:
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-09-10T16:58:18Z/
    published_at: None
    url:
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/08e1a3554e99a1a5bd2835907381e2383ee85cae
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/08f1a20822349004bb9cc1b153ecb516e9f2889d
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/2770b795294ed312375c11ef1d0b810499c66b83
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/caabb5f64f5c32fceed93356bb688ef1ec6c5783
    reference_type:
    reference_id:
