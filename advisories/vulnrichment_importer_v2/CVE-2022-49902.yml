advisory_id: CVE-2022-49902
datasource_id: vulnrichment_importer_v2/CVE-2022-49902
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2022/49xxx/CVE-2022-49902.json
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  block: Fix possible memory leak for rq_wb on add_disk failure

  kmemleak reported memory leaks in device_add_disk():

  kmemleak: 3 new suspected memory leaks

  unreferenced object 0xffff88800f420800 (size 512):
    comm "modprobe", pid 4275, jiffies 4295639067 (age 223.512s)
    hex dump (first 32 bytes):
      04 00 00 00 08 00 00 00 01 00 00 00 00 00 00 00  ................
      00 e1 f5 05 00 00 00 00 00 00 00 00 00 00 00 00  ................
    backtrace:
      [<00000000d3662699>] kmalloc_trace+0x26/0x60
      [<00000000edc7aadc>] wbt_init+0x50/0x6f0
      [<0000000069601d16>] wbt_enable_default+0x157/0x1c0
      [<0000000028fc393f>] blk_register_queue+0x2a4/0x420
      [<000000007345a042>] device_add_disk+0x6fd/0xe40
      [<0000000060e6aab0>] nbd_dev_add+0x828/0xbf0 [nbd]
      ...

  It is because the memory allocated in wbt_enable_default() is not
  released in device_add_disk() error path.
  Normally, these memory are freed in:

  del_gendisk()
    rq_qos_exit()
      rqos->ops->exit(rqos);
        wbt_exit()

  So rq_qos_exit() is called to free the rq_wb memory for wbt_init().
  However in the error path of device_add_disk(), only
  blk_unregister_queue() is called and make rq_wb memory leaked.

  Add rq_qos_exit() to the error path to fix it.
impacted_packages: []
severities:
  - score: '5.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:H
    published_at: None
    url:
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2025-10-01T14:59:03Z/
    published_at: None
    url:
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/4e68c5da60cd79950bd56287ae80b39d6261f995
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/528677d3b4af985445bd4ac667485ded1ed11220
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/fa81cbafbf5764ad5053512152345fab37a1fe18
    reference_type:
    reference_id:
