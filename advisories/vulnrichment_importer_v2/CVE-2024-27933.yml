advisory_id: CVE-2024-27933
datasource_id: vulnrichment_importer_v2/CVE-2024-27933
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2024/27xxx/CVE-2024-27933.json
aliases: []
summary: |
  Deno is a JavaScript, TypeScript, and WebAssembly runtime. In version 1.39.0, use of raw file descriptors in `op_node_ipc_pipe()` leads to premature close of arbitrary file descriptors, allowing standard input to be re-opened as a different resource resulting in permission prompt bypass. Node child_process IPC relies on the JS side to pass the raw IPC file descriptor to `op_node_ipc_pipe()`, which returns a `IpcJsonStreamResource` ID associated with the file descriptor. On closing the resource, the raw file descriptor is closed together.

  Use of raw file descriptors in `op_node_ipc_pipe()` leads to premature close of arbitrary file descriptors. This allow standard input (fd 0) to be closed and re-opened for a different resource, which allows a silent permission prompt bypass. This is exploitable by an attacker controlling the code executed inside a Deno runtime to obtain arbitrary code execution on the host machine regardless of permissions.

  This bug is known to be exploitable. There is a working exploit that achieves arbitrary code execution by bypassing prompts from zero permissions, additionally abusing the fact that Cache API lacks filesystem permission checks. The attack can be conducted silently as stderr can also be closed, suppressing all prompt outputs.

  Version 1.39.1 fixes the bug.
impacted_packages: []
severities:
  - score: '8.3'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H
    published_at: None
    url:
  - score: Track*
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:P/A:N/T:T/P:M/B:A/M:M/D:R/2024-08-02T19:54:07Z/
    published_at: None
    url:
weaknesses:
  - CWE-863
references:
  - url: https://github.com/denoland/deno/blob/v1.39.0/runtime/permissions/prompter.rs#L214
    reference_type:
    reference_id:
  - url: https://github.com/denoland/deno/blob/v1.39.0/runtime/permissions/prompter.rs#L220
    reference_type:
    reference_id:
  - url: https://github.com/denoland/deno/blob/v1.39.0/runtime/permissions/prompter.rs#L225
    reference_type:
    reference_id:
  - url: https://github.com/denoland/deno/blob/v1.39.0/runtime/permissions/prompter.rs#L241
    reference_type:
    reference_id:
  - url: https://github.com/denoland/deno/blob/v1.39.0/runtime/permissions/prompter.rs#L256
    reference_type:
    reference_id:
  - url: https://github.com/denoland/deno/blob/v1.39.0/runtime/permissions/prompter.rs#L265
    reference_type:
    reference_id:
  - url: https://github.com/denoland/deno/blob/v1.39.0/runtime/permissions/prompter.rs#L99
    reference_type:
    reference_id:
  - url: https://github.com/denoland/deno/commit/55fac9f5ead6d30996400e8597c969b675c5a22b
    reference_type:
    reference_id:
  - url: https://github.com/denoland/deno/commit/5a91a065b882215dde209baf626247e54c21a392
    reference_type:
    reference_id:
  - url: https://github.com/denoland/deno/security/advisories/GHSA-6q4w-9x56-rmwq
    reference_type:
    reference_id:
