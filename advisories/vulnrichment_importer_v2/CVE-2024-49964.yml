advisory_id: CVE-2024-49964
datasource_id: vulnrichment_importer_v2/CVE-2024-49964
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2024/49xxx/CVE-2024-49964.json
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  mm/hugetlb: fix memfd_pin_folios free_huge_pages leak

  memfd_pin_folios followed by unpin_folios fails to restore free_huge_pages
  if the pages were not already faulted in, because the folio refcount for
  pages created by memfd_alloc_folio never goes to 0.  memfd_pin_folios
  needs another folio_put to undo the folio_try_get below:

  memfd_alloc_folio()
    alloc_hugetlb_folio_nodemask()
      dequeue_hugetlb_folio_nodemask()
        dequeue_hugetlb_folio_node_exact()
          folio_ref_unfreeze(folio, 1);    ; adds 1 refcount
    folio_try_get()                        ; adds 1 refcount
    hugetlb_add_to_page_cache()            ; adds 512 refcount (on x86)

  With the fix, after memfd_pin_folios + unpin_folios, the refcount for the
  (unfaulted) page is 512, which is correct, as the refcount for a faulted
  unpinned page is 513.
impacted_packages: []
severities:
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-10-22T13:34:43Z/
    published_at: None
    url:
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/59e081ff2e91bbf19b8c1ecb75b031f778858383
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c56b6f3d801d7ec8965993342bdd9e2972b6cb8e
    reference_type:
    reference_id:
