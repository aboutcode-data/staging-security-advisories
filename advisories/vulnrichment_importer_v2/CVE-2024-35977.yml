advisory_id: CVE-2024-35977
datasource_id: vulnrichment_importer_v2/CVE-2024-35977
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2024/35xxx/CVE-2024-35977.json
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  platform/chrome: cros_ec_uart: properly fix race condition

  The cros_ec_uart_probe() function calls devm_serdev_device_open() before
  it calls serdev_device_set_client_ops(). This can trigger a NULL pointer
  dereference:

      BUG: kernel NULL pointer dereference, address: 0000000000000000
      ...
      Call Trace:
       <TASK>
       ...
       ? ttyport_receive_buf

  A simplified version of crashing code is as follows:

      static inline size_t serdev_controller_receive_buf(struct serdev_controller *ctrl,
                                                        const u8 *data,
                                                        size_t count)
      {
              struct serdev_device *serdev = ctrl->serdev;

              if (!serdev || !serdev->ops->receive_buf) // CRASH!
                  return 0;

              return serdev->ops->receive_buf(serdev, data, count);
      }

  It assumes that if SERPORT_ACTIVE is set and serdev exists, serdev->ops
  will also exist. This conflicts with the existing cros_ec_uart_probe()
  logic, as it first calls devm_serdev_device_open() (which sets
  SERPORT_ACTIVE), and only later sets serdev->ops via
  serdev_device_set_client_ops().

  Commit 01f95d42b8f4 ("platform/chrome: cros_ec_uart: fix race
  condition") attempted to fix a similar race condition, but while doing
  so, made the window of error for this race condition to happen much
  wider.

  Attempt to fix the race condition again, making sure we fully setup
  before calling devm_serdev_device_open().
impacted_packages: []
severities:
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-09-10T15:40:22Z/
    published_at: None
    url:
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/5e700b384ec13f5bcac9855cb28fcc674f1d3593
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/9e9bb74a93b7daa32313ccaefd0edc529d40daf8
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/cfd758041d8b79aa8c3f811b6bd6105379f2f702
    reference_type:
    reference_id:
