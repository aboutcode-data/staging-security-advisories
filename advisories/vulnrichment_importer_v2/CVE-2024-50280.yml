advisory_id: CVE-2024-50280
datasource_id: vulnrichment_importer_v2/CVE-2024-50280
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2024/50xxx/CVE-2024-50280.json
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  dm cache: fix flushing uninitialized delayed_work on cache_ctr error

  An unexpected WARN_ON from flush_work() may occur when cache creation
  fails, caused by destroying the uninitialized delayed_work waker in the
  error path of cache_create(). For example, the warning appears on the
  superblock checksum error.

  Reproduce steps:

  dmsetup create cmeta --table "0 8192 linear /dev/sdc 0"
  dmsetup create cdata --table "0 65536 linear /dev/sdc 8192"
  dmsetup create corig --table "0 524288 linear /dev/sdc 262144"
  dd if=/dev/urandom of=/dev/mapper/cmeta bs=4k count=1 oflag=direct
  dmsetup create cache --table "0 524288 cache /dev/mapper/cmeta \
  /dev/mapper/cdata /dev/mapper/corig 128 2 metadata2 writethrough smq 0"

  Kernel logs:

  (snip)
  WARNING: CPU: 0 PID: 84 at kernel/workqueue.c:4178 __flush_work+0x5d4/0x890

  Fix by pulling out the cancel_delayed_work_sync() from the constructor's
  error path. This patch doesn't affect the use-after-free fix for
  concurrent dm_resume and dm_destroy (commit 6a459d8edbdb ("dm cache: Fix
  UAF in destroy()")) as cache_dtr is not changed.
impacted_packages: []
severities:
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url:
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:T/P:M/B:A/M:M/D:T/2024-12-11T14:25:27Z/
    published_at: None
    url:
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/135496c208ba26fd68cdef10b64ed7a91ac9a7ff
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/40fac0271c7aedf60d81ed8214e80851e5b26312
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5a754d3c771280f2d06bf8ab716d6a0d36ca256e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/8cc12dab635333c4ea28e72d7b947be7d0543c2c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/aee3ecda73ce13af7c3e556383342b57e6bd0718
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d154b333a5667b6c1b213a11a41ad7aaccd10c3d
    reference_type:
    reference_id:
