advisory_id: CVE-2024-42104
datasource_id: vulnrichment_importer_v2/CVE-2024-42104
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2024/42xxx/CVE-2024-42104.json
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  nilfs2: add missing check for inode numbers on directory entries

  Syzbot reported that mounting and unmounting a specific pattern of
  corrupted nilfs2 filesystem images causes a use-after-free of metadata
  file inodes, which triggers a kernel bug in lru_add_fn().

  As Jan Kara pointed out, this is because the link count of a metadata file
  gets corrupted to 0, and nilfs_evict_inode(), which is called from iput(),
  tries to delete that inode (ifile inode in this case).

  The inconsistency occurs because directories containing the inode numbers
  of these metadata files that should not be visible in the namespace are
  read without checking.

  Fix this issue by treating the inode numbers of these internal files as
  errors in the sanity check helper when reading directory folios/pages.

  Also thanks to Hillf Danton and Matthew Wilcox for their initial mm-layer
  analysis.
impacted_packages: []
severities:
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-09-10T16:17:52Z/
    published_at: None
    url:
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/07c176e7acc5579c133bb923ab21316d192d0a95
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/1b7d549ed2c1fa202c751b69423a0d3a6bd5a180
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/265fff1a01cdc083aeaf0d934c929db5cc64aebf
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/2f2fa9cf7c3537958a82fbe8c8595a5eb0861ad7
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/3ab40870edb883b9633dc5cd55f5a2a11afa618d
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b11e8fb93ea5eefb2e4e719497ea177a58ff6131
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/bb76c6c274683c8570ad788f79d4b875bde0e458
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c33c2b0d92aa1c2262d999b2598ad6fbd53bd479
    reference_type:
    reference_id:
