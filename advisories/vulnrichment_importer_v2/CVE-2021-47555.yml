advisory_id: CVE-2021-47555
datasource_id: vulnrichment_importer_v2/CVE-2021-47555
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2021/47xxx/CVE-2021-47555.json
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  net: vlan: fix underflow for the real_dev refcnt

  Inject error before dev_hold(real_dev) in register_vlan_dev(),
  and execute the following testcase:

  ip link add dev dummy1 type dummy
  ip link add name dummy1.100 link dummy1 type vlan id 100
  ip link del dev dummy1

  When the dummy netdevice is removed, we will get a WARNING as following:

  =======================================================================
  refcount_t: decrement hit 0; leaking memory.
  WARNING: CPU: 2 PID: 0 at lib/refcount.c:31 refcount_warn_saturate+0xbf/0x1e0

  and an endless loop of:

  =======================================================================
  unregister_netdevice: waiting for dummy1 to become free. Usage count = -1073741824

  That is because dev_put(real_dev) in vlan_dev_free() be called without
  dev_hold(real_dev) in register_vlan_dev(). It makes the refcnt of real_dev
  underflow.

  Move the dev_hold(real_dev) to vlan_dev_init() which is the call-back of
  ndo_init(). That makes dev_hold() and dev_put() for vlan's real_dev
  symmetrical.
impacted_packages: []
severities:
  - score: '4.4'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:L
    published_at: None
    url:
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-05-29T16:50:13Z/
    published_at: None
    url:
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/01d9cc2dea3fde3bad6d27f464eff463496e2b00
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5e44178864b38dd70b877985abd7d86fdb95f27d
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/6e800ee43218a56acc93676bbb3d93b74779e555
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f7fc72a508cf115c273a7a29350069def1041890
    reference_type:
    reference_id:
