advisory_id: CVE-2024-41006
datasource_id: vulnrichment_importer_v2/CVE-2024-41006
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2024/41xxx/CVE-2024-41006.json
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  netrom: Fix a memory leak in nr_heartbeat_expiry()

  syzbot reported a memory leak in nr_create() [0].

  Commit 409db27e3a2e ("netrom: Fix use-after-free of a listening socket.")
  added sock_hold() to the nr_heartbeat_expiry() function, where
  a) a socket has a SOCK_DESTROY flag or
  b) a listening socket has a SOCK_DEAD flag.

  But in the case "a," when the SOCK_DESTROY flag is set, the file descriptor
  has already been closed and the nr_release() function has been called.
  So it makes no sense to hold the reference count because no one will
  call another nr_destroy_socket() and put it as in the case "b."

  nr_connect
    nr_establish_data_link
      nr_start_heartbeat

  nr_release
    switch (nr->state)
    case NR_STATE_3
      nr->state = NR_STATE_2
      sock_set_flag(sk, SOCK_DESTROY);

                          nr_rx_frame
                            nr_process_rx_frame
                              switch (nr->state)
                              case NR_STATE_2
                                nr_state2_machine()
                                  nr_disconnect()
                                    nr_sk(sk)->state = NR_STATE_0
                                    sock_set_flag(sk, SOCK_DEAD)

                          nr_heartbeat_expiry
                            switch (nr->state)
                            case NR_STATE_0
                              if (sock_flag(sk, SOCK_DESTROY) ||
                                 (sk->sk_state == TCP_LISTEN
                                   && sock_flag(sk, SOCK_DEAD)))
                                 sock_hold()  // ( !!! )
                                 nr_destroy_socket()

  To fix the memory leak, let's call sock_hold() only for a listening socket.

  Found by InfoTeCS on behalf of Linux Verification Center
  (linuxtesting.org) with Syzkaller.

  [0]: https://syzkaller.appspot.com/bug?extid=d327a1f3b12e1e206c16
impacted_packages: []
severities:
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-09-10T17:00:58Z/
    published_at: None
    url:
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/0b9130247f3b6a1122478471ff0e014ea96bb735
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/280cf1173726a7059b628c610c71050d5c0b6937
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5391f9db2cab5ef1cb411be1ab7dbec728078fba
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/a02fd5d775cf9787ee7698c797e20f2fa13d2e2b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b6ebe4fed73eedeb73f4540f8edc4871945474c8
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d377f5a28332954b19e373d36823e59830ab1712
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d616876256b38ecf9a1a1c7d674192c5346bc69c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e07a9c2a850cdebf625e7a1b8171bd23a8554313
    reference_type:
    reference_id:
