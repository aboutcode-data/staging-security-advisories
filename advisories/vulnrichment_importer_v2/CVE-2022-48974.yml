advisory_id: CVE-2022-48974
datasource_id: vulnrichment_importer_v2/CVE-2022-48974
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2022/48xxx/CVE-2022-48974.json
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  netfilter: conntrack: fix using __this_cpu_add in preemptible

  Currently in nf_conntrack_hash_check_insert(), when it fails in
  nf_ct_ext_valid_pre/post(), NF_CT_STAT_INC() will be called in the
  preemptible context, a call trace can be triggered:

     BUG: using __this_cpu_add() in preemptible [00000000] code: conntrack/1636
     caller is nf_conntrack_hash_check_insert+0x45/0x430 [nf_conntrack]
     Call Trace:
      <TASK>
      dump_stack_lvl+0x33/0x46
      check_preemption_disabled+0xc3/0xf0
      nf_conntrack_hash_check_insert+0x45/0x430 [nf_conntrack]
      ctnetlink_create_conntrack+0x3cd/0x4e0 [nf_conntrack_netlink]
      ctnetlink_new_conntrack+0x1c0/0x450 [nf_conntrack_netlink]
      nfnetlink_rcv_msg+0x277/0x2f0 [nfnetlink]
      netlink_rcv_skb+0x50/0x100
      nfnetlink_rcv+0x65/0x144 [nfnetlink]
      netlink_unicast+0x1ae/0x290
      netlink_sendmsg+0x257/0x4f0
      sock_sendmsg+0x5f/0x70

  This patch is to fix it by changing to use NF_CT_STAT_INC_ATOMIC() for
  nf_ct_ext_valid_pre/post() check in nf_conntrack_hash_check_insert(),
  as well as nf_ct_ext_valid_post() in __nf_conntrack_confirm().

  Note that nf_ct_ext_valid_pre() check in __nf_conntrack_confirm() is
  safe to use NF_CT_STAT_INC(), as it's under local_bh_disable().
impacted_packages: []
severities:
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-10-22T13:18:44Z/
    published_at: None
    url:
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/9464d0b68f11a9bc768370c3260ec02b3550447b
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d9bf1138a5db419db13bd9fcd3a7178d6bb20f7c
    reference_type:
    reference_id:
