advisory_id: CVE-2024-35955
datasource_id: vulnrichment_importer_v2/CVE-2024-35955
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2024/35xxx/CVE-2024-35955.json
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  kprobes: Fix possible use-after-free issue on kprobe registration

  When unloading a module, its state is changing MODULE_STATE_LIVE ->
   MODULE_STATE_GOING -> MODULE_STATE_UNFORMED. Each change will take
  a time. `is_module_text_address()` and `__module_text_address()`
  works with MODULE_STATE_LIVE and MODULE_STATE_GOING.
  If we use `is_module_text_address()` and `__module_text_address()`
  separately, there is a chance that the first one is succeeded but the
  next one is failed because module->state becomes MODULE_STATE_UNFORMED
  between those operations.

  In `check_kprobe_address_safe()`, if the second `__module_text_address()`
  is failed, that is ignored because it expected a kernel_text address.
  But it may have failed simply because module->state has been changed
  to MODULE_STATE_UNFORMED. In this case, arm_kprobe() will try to modify
  non-exist module text address (use-after-free).

  To fix this problem, we should not use separated `is_module_text_address()`
  and `__module_text_address()`, but use only `__module_text_address()`
  once and do `try_module_get(module)` which is only available with
  MODULE_STATE_LIVE.
impacted_packages: []
severities:
  - score: '8.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url:
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:T/P:M/B:A/M:M/D:T/2024-05-20T17:42:32Z/
    published_at: None
    url:
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/2df2dd27066cdba8041e46a64362325626bdfb2e
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/325f3fb551f8cd672dbbfc4cf58b14f9ee3fc9e8
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/36b57c7d2f8b7de224980f1a284432846ad71ca0
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5062d1f4f07facbdade0f402d9a04a788f52e26d
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/62029bc9ff2c17a4e3a2478d83418ec575413808
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/93eb31e7c3399e326259f2caa17be1e821f5a412
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b5808d40093403334d939e2c3c417144d12a6f33
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d15023fb407337028a654237d8968fefdcf87c2f
    reference_type:
    reference_id:
