advisory_id: CVE-2024-58083
datasource_id: vulnrichment_importer_v2/CVE-2024-58083
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2024/58xxx/CVE-2024-58083.json
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  KVM: Explicitly verify target vCPU is online in kvm_get_vcpu()

  Explicitly verify the target vCPU is fully online _prior_ to clamping the
  index in kvm_get_vcpu().  If the index is "bad", the nospec clamping will
  generate '0', i.e. KVM will return vCPU0 instead of NULL.

  In practice, the bug is unlikely to cause problems, as it will only come
  into play if userspace or the guest is buggy or misbehaving, e.g. KVM may
  send interrupts to vCPU0 instead of dropping them on the floor.

  However, returning vCPU0 when it shouldn't exist per online_vcpus is
  problematic now that KVM uses an xarray for the vCPUs array, as KVM needs
  to insert into the xarray before publishing the vCPU to userspace (see
  commit c5b077549136 ("KVM: Convert the kvm->vcpus array to a xarray")),
  i.e. before vCPU creation is guaranteed to succeed.

  As a result, incorrectly providing access to vCPU0 will trigger a
  use-after-free if vCPU0 is dereferenced and kvm_vm_ioctl_create_vcpu()
  bails out of vCPU creation due to an error and frees vCPU0.  Commit
  afb2acb2e3a3 ("KVM: Fix vcpu_array[0] races") papered over that issue, but
  in doing so introduced an unsolvable teardown conundrum.  Preventing
  accesses to vCPU0 before it's fully online will allow reverting commit
  afb2acb2e3a3, without re-introducing the vcpu_array[0] UAF race.
impacted_packages: []
severities:
  - score: '7.8'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
    published_at: None
    url:
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:T/P:M/B:A/M:M/D:T/2025-03-27T17:00:02Z/
    published_at: None
    url:
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/09d50ccf0b2d739db4a485b08afe7520a4402a63
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/125da53b3c0c9d7f58353aea0076e9efd6498ba7
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/1e7381f3617d14b3c11da80ff5f8a93ab14cfc46
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/5cce2ed69b00e022b5cdf0c49c82986abd2941a8
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/7c4899239d0f70f88ac42665b3da51678d122480
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ca8da90ed1432ff3d000de4f1e2275d4e7d21b96
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/d817e510662fd1c9797952408d94806f97a5fffd
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f2f805ada63b536bc192458a7098388286568ad4
    reference_type:
    reference_id:
