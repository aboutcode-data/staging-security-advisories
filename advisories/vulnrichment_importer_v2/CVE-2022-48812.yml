advisory_id: CVE-2022-48812
datasource_id: vulnrichment_importer_v2/CVE-2022-48812
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2022/48xxx/CVE-2022-48812.json
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  net: dsa: lantiq_gswip: don't use devres for mdiobus

  As explained in commits:
  74b6d7d13307 ("net: dsa: realtek: register the MDIO bus under devres")
  5135e96a3dd2 ("net: dsa: don't allocate the slave_mii_bus using devres")

  mdiobus_free() will panic when called from devm_mdiobus_free() <-
  devres_release_all() <- __device_release_driver(), and that mdiobus was
  not previously unregistered.

  The GSWIP switch is a platform device, so the initial set of constraints
  that I thought would cause this (I2C or SPI buses which call ->remove on
  ->shutdown) do not apply. But there is one more which applies here.

  If the DSA master itself is on a bus that calls ->remove from ->shutdown
  (like dpaa2-eth, which is on the fsl-mc bus), there is a device link
  between the switch and the DSA master, and device_links_unbind_consumers()
  will unbind the GSWIP switch driver on shutdown.

  So the same treatment must be applied to all DSA switch drivers, which
  is: either use devres for both the mdiobus allocation and registration,
  or don't use devres at all.

  The gswip driver has the code structure in place for orderly mdiobus
  removal, so just replace devm_mdiobus_alloc() with the non-devres
  variant, and add manual free where necessary, to ensure that we don't
  let devres free a still-registered bus.
impacted_packages: []
severities:
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-09-10T16:58:28Z/
    published_at: None
    url:
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/0d120dfb5d67edc5bcd1804e167dba2b30809afd
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/2443ba2fe396bdde187a2fdfa6a57375643ae93c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/b5652bc50dde7b84e93dfb25479b64b817e377c1
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/e177d2e85ebcd3008c4b2abc293f4118e04eedef
    reference_type:
    reference_id:
