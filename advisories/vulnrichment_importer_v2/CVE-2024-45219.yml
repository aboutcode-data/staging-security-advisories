advisory_id: CVE-2024-45219
datasource_id: vulnrichment_importer_v2/CVE-2024-45219
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2024/45xxx/CVE-2024-45219.json
aliases: []
summary: "Account users in Apache CloudStack by default are allowed to upload and register templates\
  \ for deploying instances and volumes for attaching them as data disks to their existing instances.\
  \ Due to missing validation checks for KVM-compatible templates or volumes in CloudStack 4.0.0\
  \ through 4.18.2.3 and 4.19.0.0 through 4.19.1.1, an attacker that can upload or register\
  \ templates and volumes, can use them to deploy malicious instances or attach uploaded volumes\
  \ to their existing instances on KVM-based environments and exploit this to gain access to\
  \ the host filesystems that could result in the compromise of resource integrity and confidentiality,\
  \ data loss, denial of service, and availability of KVM-based infrastructure managed by CloudStack.\n\
  \n\nUsers are recommended to upgrade to Apache CloudStack 4.18.2.4 or 4.19.1.2, or later,\
  \ which addresses this issue. \n\nAdditionally, all user-uploaded or registered KVM-compatible\
  \ templates and volumes can be scanned and checked that they are flat files that should not\
  \ be using any additional or unnecessary features. For example, operators can run this on\
  \ their secondary storage(s) and inspect output. An empty output for the disk being validated\
  \ means it has no references to the host filesystems; on the other hand, if the output for\
  \ the disk being validated is not empty, it might indicate a compromised disk.\n\n\nfor file\
  \ in $(find /path/to/storage/ -type f -regex [a-f0-9\\-]*.*); do echo \"Retrieving file [$file]\
  \ info. If the output is not empty, that might indicate a compromised disk; check it carefully.\"\
  ; qemu-img info -U $file | grep file: ; printf \"\\n\\n\"; done\nThe command can also be run\
  \ for the file-based primary storages; however, bear in mind that (i) volumes created from\
  \ templates will have references for the templates at first and (ii) volumes can be consolidated\
  \ while migrating, losing their references to the templates. Therefore, the command execution\
  \ for the primary storages can show both false positives and false negatives.\n\nFor checking\
  \ the whole template/volume features of each disk, operators can run the following command:\n\
  \n\nfor file in $(find /path/to/storage/ -type f -regex [a-f0-9\\-]*.*); do echo \"Retrieving\
  \ file [$file] info.\"; qemu-img info -U $file; printf \"\\n\\n\"; done"
impacted_packages: []
severities:
  - score: '8.5'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:C/C:H/I:H/A:H
    published_at: None
    url:
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:T/P:M/B:A/M:M/D:T/2024-10-16T14:45:46Z/
    published_at: None
    url:
weaknesses:
  - CWE-20
references:
  - url: https://cloudstack.apache.org/blog/security-release-advisory-4.18.2.4-4.19.1.2
    reference_type:
    reference_id:
  - url: https://lists.apache.org/thread/ktsfjcnj22x4kg49ctock3d9tq7jnvlo
    reference_type:
    reference_id:
  - url: https://www.shapeblue.com/shapeblue-security-advisory-apache-cloudstack-security-releases-4-18-2-4-and-4-19-1-2/
    reference_type:
    reference_id:
