advisory_id: CVE-2022-49033
datasource_id: vulnrichment_importer_v2/CVE-2022-49033
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2022/49xxx/CVE-2022-49033.json
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  btrfs: qgroup: fix sleep from invalid context bug in btrfs_qgroup_inherit()

  Syzkaller reported BUG as follows:

    BUG: sleeping function called from invalid context at
         include/linux/sched/mm.h:274
    Call Trace:
     <TASK>
     dump_stack_lvl+0xcd/0x134
     __might_resched.cold+0x222/0x26b
     kmem_cache_alloc+0x2e7/0x3c0
     update_qgroup_limit_item+0xe1/0x390
     btrfs_qgroup_inherit+0x147b/0x1ee0
     create_subvol+0x4eb/0x1710
     btrfs_mksubvol+0xfe5/0x13f0
     __btrfs_ioctl_snap_create+0x2b0/0x430
     btrfs_ioctl_snap_create_v2+0x25a/0x520
     btrfs_ioctl+0x2a1c/0x5ce0
     __x64_sys_ioctl+0x193/0x200
     do_syscall_64+0x35/0x80

  Fix this by calling qgroup_dirty() on @dstqgroup, and update limit item in
  btrfs_run_qgroups() later outside of the spinlock context.
impacted_packages: []
severities:
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-10-22T13:10:58Z/
    published_at: None
    url:
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/01d7c41eac9129fba80d8aed0060caab4a7dbe09
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/044da1a371a0da579e805e89c96865f62d8f6f69
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/3c98e91be6aea4c7acf09da6eb0c107ea9186bb5
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/588ae4fdd8b11788a797776b10d6c44ae12bc133
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/89840b12c8fad7200eb6478525c13261512c01be
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/8eb912af525042a7365295eb62f6d5270c2a6462
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f4b930a1602b05e77fee31f9616599b25e910a86
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/f7e942b5bb35d8e3af54053d19a6bf04143a3955
    reference_type:
    reference_id:
