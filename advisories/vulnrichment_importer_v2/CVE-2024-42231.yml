advisory_id: CVE-2024-42231
datasource_id: vulnrichment_importer_v2/CVE-2024-42231
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2024/42xxx/CVE-2024-42231.json
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  btrfs: zoned: fix calc_available_free_space() for zoned mode

  calc_available_free_space() returns the total size of metadata (or
  system) block groups, which can be allocated from unallocated disk
  space. The logic is wrong on zoned mode in two places.

  First, the calculation of data_chunk_size is wrong. We always allocate
  one zone as one chunk, and no partial allocation of a zone. So, we
  should use zone_size (= data_sinfo->chunk_size) as it is.

  Second, the result "avail" may not be zone aligned. Since we always
  allocate one zone as one chunk on zoned mode, returning non-zone size
  aligned bytes will result in less pressure on the async metadata reclaim
  process.

  This is serious for the nearly full state with a large zone size device.
  Allowing over-commit too much will result in less async reclaim work and
  end up in ENOSPC. We can align down to the zone size to avoid that.
impacted_packages: []
severities:
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-09-10T16:14:20Z/
    published_at: None
    url:
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/64d2c847ba380e07b9072d65a50aa6469d2aa43f
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/8548903b1999bba02a2b894ad750ab8eb1f40307
    reference_type:
    reference_id:
