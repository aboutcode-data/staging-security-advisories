advisory_id: CVE-2024-38600
datasource_id: vulnrichment_importer_v2/CVE-2024-38600
datasource_url: https://github.com/cisagov/vulnrichment/blob/develop/2024/38xxx/CVE-2024-38600.json
aliases: []
summary: |
  In the Linux kernel, the following vulnerability has been resolved:

  ALSA: Fix deadlocks with kctl removals at disconnection

  In snd_card_disconnect(), we set card->shutdown flag at the beginning,
  call callbacks and do sync for card->power_ref_sleep waiters at the
  end.  The callback may delete a kctl element, and this can lead to a
  deadlock when the device was in the suspended state.  Namely:

  * A process waits for the power up at snd_power_ref_and_wait() in
    snd_ctl_info() or read/write() inside card->controls_rwsem.

  * The system gets disconnected meanwhile, and the driver tries to
    delete a kctl via snd_ctl_remove*(); it tries to take
    card->controls_rwsem again, but this is already locked by the
    above.  Since the sleeper isn't woken up, this deadlocks.

  An easy fix is to wake up sleepers before processing the driver
  disconnect callbacks but right after setting the card->shutdown flag.
  Then all sleepers will abort immediately, and the code flows again.

  So, basically this patch moves the wait_event() call at the right
  timing.  While we're at it, just to be sure, call wait_event_all()
  instead of wait_event(), although we don't use exclusive events on
  this queue for now.
impacted_packages: []
severities:
  - score: Track
    scoring_system: ssvc
    scoring_elements: SSVCv2/E:N/A:N/T:P/P:M/B:A/M:M/D:T/2024-09-10T17:13:24Z/
    published_at: None
    url:
weaknesses: []
references:
  - url: https://git.kernel.org/stable/c/2f103287ef7960854808930499d1181bd0145d68
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/6b55e879e7bd023a03888fc6c8339edf82f576f4
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/87988a534d8e12f2e6fc01fe63e6c1925dc5307c
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/88ce3fe255d58a93624b467af036dc3519f309c7
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/c2fb439f4f1425a961d20bec818fed2c2d9ef70a
    reference_type:
    reference_id:
  - url: https://git.kernel.org/stable/c/ff80185e7b7b547a0911fcfc8aefc61c3e8304d7
    reference_type:
    reference_id:
