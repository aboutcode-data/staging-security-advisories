advisory_id: CVE-2017-5485
datasource_id: collect_tcpdump_fix_commits/CVE-2017-5485
datasource_url: https://github.com/the-tcpdump-group/tcpdump
aliases: []
summary: |
  777edc563aacdaff66a0b829cecd2ccb09a10404:Further fix the fix to CVE-2017-5485.

  1) Take the length of the NSAP into account.  Otherwise, if, in our
  search of the hash table, we come across a byte string that's shorter
  than the string we're looking for, we'll search past the end of the
  string in the hash table.

  2) The first byte of the byte string in the table is the length of the
  NSAP, with the byte *after* that being the first byte of the NSAP, but
  the first byte of the byte string passed into lookup_nsap() is the first
  byte of the NSAP, with the length passed in as a separate argument.  Do
  the comparison correctly.

  This fixes a vulnerability discovered by Kamil Frankowicz.

  Add a test using the capture file supplied by the reporter(s).

  While we're at it, clean up the fix to lookup_bytestring():

  1) Get rid of an unused structure member and an unused #define.

  2) Get rid of an incorrect "+ 1" when calculating the size of the byte
  array to allocate - that was left over from the NSAP table, where the
  length was guaranteed to fit in 1 byte and we used the first byte of the
  array to hold the length of the rest of the array.
  c1c8f9a9bb5aebb8a5d746e1c6e7a3536bc4d2b1:Further fix the fix to CVE-2017-5485.

  1) Take the length of the NSAP into account.  Otherwise, if, in our
  search of the hash table, we come across a byte string that's shorter
  than the string we're looking for, we'll search past the end of the
  string in the hash table.

  2) The first byte of the byte string in the table is the length of the
  NSAP, with the byte *after* that being the first byte of the NSAP, but
  the first byte of the byte string passed into lookup_nsap() is the first
  byte of the NSAP, with the length passed in as a separate argument.  Do
  the comparison correctly.

  This fixes a vulnerability discovered by Kamil Frankowicz.

  Add a test using the capture file supplied by the reporter(s).

  While we're at it, clean up the fix to lookup_bytestring():

  1) Get rid of an unused structure member and an unused #define.

  2) Get rid of an incorrect "+ 1" when calculating the size of the byte
  array to allocate - that was left over from the NSAP table, where the
  length was guaranteed to fit in 1 byte and we used the first byte of the
  array to hold the length of the rest of the array.
  f152c1268f28fc84d15d364b742f500e12374b33:CVE-2017-5485/add the test case
  2817174698bcd5371ff7fbc9d50b5241dd0130bd:CVE-2017-5485/Fix lookup_nsap() to match what isonsap_string() expects.

  Change cddcb5632decb3fc631407b2ce0e526d17bb8ff9 changed isonsap_string()
  to take, as arguments, a pointer to the first octet of an NSAP and the
  length of the NSAP, rather than a pointer to a string of octets the
  first octet of which is the NSAP length and the subsequent octets are
  the octets of the NSAP.

  However, lookup_nsap() was not changed in a similar fashion, and
  isonsap_string() handed it a pointer to the first octet of the NSAP,
  which lookup_nsap() treated as the NSAP length.

  This should fix GitHub issue #563.
impacted_packages:
  - purl: pkg:github/the-tcpdump-group/tcpdump
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/the-tcpdump-group/tcpdump
        commit: 2817174698bcd5371ff7fbc9d50b5241dd0130bd
    introduced_in_commits: []
  - purl: pkg:github/the-tcpdump-group/tcpdump
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/the-tcpdump-group/tcpdump
        commit: 777edc563aacdaff66a0b829cecd2ccb09a10404
    introduced_in_commits: []
  - purl: pkg:github/the-tcpdump-group/tcpdump
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/the-tcpdump-group/tcpdump
        commit: c1c8f9a9bb5aebb8a5d746e1c6e7a3536bc4d2b1
    introduced_in_commits: []
  - purl: pkg:github/the-tcpdump-group/tcpdump
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/the-tcpdump-group/tcpdump
        commit: f152c1268f28fc84d15d364b742f500e12374b33
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/the-tcpdump-group/tcpdump/tree/2817174698bcd5371ff7fbc9d50b5241dd0130bd
    reference_type: commit
    reference_id: 2817174698bcd5371ff7fbc9d50b5241dd0130bd
  - url: https://github.com/the-tcpdump-group/tcpdump/tree/777edc563aacdaff66a0b829cecd2ccb09a10404
    reference_type: commit
    reference_id: 777edc563aacdaff66a0b829cecd2ccb09a10404
  - url: https://github.com/the-tcpdump-group/tcpdump/tree/c1c8f9a9bb5aebb8a5d746e1c6e7a3536bc4d2b1
    reference_type: commit
    reference_id: c1c8f9a9bb5aebb8a5d746e1c6e7a3536bc4d2b1
  - url: https://github.com/the-tcpdump-group/tcpdump/tree/f152c1268f28fc84d15d364b742f500e12374b33
    reference_type: commit
    reference_id: f152c1268f28fc84d15d364b742f500e12374b33
