advisory_id: CVE-2024-2397
datasource_id: collect_tcpdump_fix_commits/CVE-2024-2397
datasource_url: https://github.com/the-tcpdump-group/tcpdump
aliases: []
summary: |
  e9bff173f9833b5532f3b6dce8c049e955140169:ppp: use the buffer stack for the de-escaping buffer.

  This both saves the buffer for freeing later and saves the packet
  pointer and snapend to be restored when packet processing is complete,
  even if an exception is thrown with longjmp.

  This means that the hex/ASCII printing in pretty_print_packet()
  processes the packet data as captured or read from the savefile, rather
  than as modified by the PPP printer, so that the bounds checking is
  correct.

  That fixes CVE-2024-2397, which was caused by an exception being thrown
  by the hex/ASCII printer (which should only happen if those routines are
  called by a packet printer, not if they're called for the -X/-x/-A
  flag), which jumps back to the setjmp() that surrounds the packet
  printer.  Hilarity^Winfinite looping ensues.

  Also, restore ndo->ndo_packetp before calling the hex/ASCII printing
  routine, in case nd_pop_all_packet_info() didn't restore it.

  (cherry picked from commit b9811ef5bb1b7d45a90e042f81f3aaf233c8bcb2)
  b9811ef5bb1b7d45a90e042f81f3aaf233c8bcb2:ppp: use the buffer stack for the de-escaping buffer.

  This both saves the buffer for freeing later and saves the packet
  pointer and snapend to be restored when packet processing is complete,
  even if an exception is thrown with longjmp.

  This means that the hex/ASCII printing in pretty_print_packet()
  processes the packet data as captured or read from the savefile, rather
  than as modified by the PPP printer, so that the bounds checking is
  correct.

  That fixes CVE-2024-2397, which was caused by an exception being thrown
  by the hex/ASCII printer (which should only happen if those routines are
  called by a packet printer, not if they're called for the -X/-x/-A
  flag), which jumps back to the setjmp() that surrounds the packet
  printer.  Hilarity^Winfinite looping ensues.

  Also, restore ndo->ndo_packetp before calling the hex/ASCII printing
  routine, in case nd_pop_all_packet_info() didn't restore it.
impacted_packages:
  - purl: pkg:github/the-tcpdump-group/tcpdump
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/the-tcpdump-group/tcpdump
        commit: e9bff173f9833b5532f3b6dce8c049e955140169
    introduced_in_commits: []
  - purl: pkg:github/the-tcpdump-group/tcpdump
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/the-tcpdump-group/tcpdump
        commit: b9811ef5bb1b7d45a90e042f81f3aaf233c8bcb2
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/the-tcpdump-group/tcpdump/tree/b9811ef5bb1b7d45a90e042f81f3aaf233c8bcb2
    reference_type: commit
    reference_id: b9811ef5bb1b7d45a90e042f81f3aaf233c8bcb2
  - url: https://github.com/the-tcpdump-group/tcpdump/tree/e9bff173f9833b5532f3b6dce8c049e955140169
    reference_type: commit
    reference_id: e9bff173f9833b5532f3b6dce8c049e955140169
