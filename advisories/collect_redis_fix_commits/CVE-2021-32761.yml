advisory_id: CVE-2021-32761
datasource_id: collect_redis_fix_commits/CVE-2021-32761
datasource_url: https://github.com/redis/redis
aliases: []
summary: "449af2cd7a6646de0d4c0a3500fe72d8f18b7453:On 32 bit platform, the bit position of GETBIT/SETBIT/BITFIELD/BITCOUNT,BITPOS\
  \ may overflow (see CVE-2021-32761) (#9191)\n\nGETBIT, SETBIT may access wrong address because\
  \ of wrap.\nBITCOUNT and BITPOS may return wrapped results.\nBITFIELD may access the wrong\
  \ address but also allocate insufficient memory and segfault (see CVE-2021-32761).\n\nThis\
  \ commit uses `uint64_t` or `long long` instead of `size_t`.\nrelated https://github.com/redis/redis/pull/8096\n\
  \nAt 32bit platform:\n> setbit bit 4294967295 1\n(integer) 0\n> config set proto-max-bulk-len\
  \ 536870913\nOK\n> append bit \"\\xFF\"\n(integer) 536870913\n> getbit bit 4294967296\n(integer)\
  \ 0\n\nWhen the bit index is larger than 4294967295, size_t can't hold bit index. In the past,\
  \  `proto-max-bulk-len` is limit to 536870912, so there is no problem.\n\nAfter this commit,\
  \ bit position is stored in `uint64_t` or `long long`. So when `proto-max-bulk-len > 536870912`,\
  \ 32bit platforms can still be correct.\n\nFor 64bit platform, this problem still exists.\
  \ The major reason is bit pos 8 times of byte pos. When proto-max-bulk-len is very larger,\
  \ bit pos may overflow.\nBut at 64bit platform, we don't have so long string. So this bug\
  \ may never happen.\n\nAdditionally this commit add a test cost `512MB` memory which is tag\
  \ as `large-memory`. Make freebsd ci and valgrind ci ignore this test.\n* This test is disabled\
  \ in this version since bitops doesn't rely on\nproto-max-bulk-len. some of the overflows\
  \ can still occur so we do want\nthe fixes.\n\n(cherry picked from commit 71d452876ebf8456afaadd6b3c27988abadd1148)\n\
  (cherry picked from commit 2be8f1de1d452886fbf45030409707c52323da20)\n449af2cd7a6646de0d4c0a3500fe72d8f18b7453:On\
  \ 32 bit platform, the bit position of GETBIT/SETBIT/BITFIELD/BITCOUNT,BITPOS may overflow\
  \ (see CVE-2021-32761) (#9191)\n\nGETBIT, SETBIT may access wrong address because of wrap.\n\
  BITCOUNT and BITPOS may return wrapped results.\nBITFIELD may access the wrong address but\
  \ also allocate insufficient memory and segfault (see CVE-2021-32761).\n\nThis commit uses\
  \ `uint64_t` or `long long` instead of `size_t`.\nrelated https://github.com/redis/redis/pull/8096\n\
  \nAt 32bit platform:\n> setbit bit 4294967295 1\n(integer) 0\n> config set proto-max-bulk-len\
  \ 536870913\nOK\n> append bit \"\\xFF\"\n(integer) 536870913\n> getbit bit 4294967296\n(integer)\
  \ 0\n\nWhen the bit index is larger than 4294967295, size_t can't hold bit index. In the past,\
  \  `proto-max-bulk-len` is limit to 536870912, so there is no problem.\n\nAfter this commit,\
  \ bit position is stored in `uint64_t` or `long long`. So when `proto-max-bulk-len > 536870912`,\
  \ 32bit platforms can still be correct.\n\nFor 64bit platform, this problem still exists.\
  \ The major reason is bit pos 8 times of byte pos. When proto-max-bulk-len is very larger,\
  \ bit pos may overflow.\nBut at 64bit platform, we don't have so long string. So this bug\
  \ may never happen.\n\nAdditionally this commit add a test cost `512MB` memory which is tag\
  \ as `large-memory`. Make freebsd ci and valgrind ci ignore this test.\n* This test is disabled\
  \ in this version since bitops doesn't rely on\nproto-max-bulk-len. some of the overflows\
  \ can still occur so we do want\nthe fixes.\n\n(cherry picked from commit 71d452876ebf8456afaadd6b3c27988abadd1148)\n\
  (cherry picked from commit 2be8f1de1d452886fbf45030409707c52323da20)\n5f49f4fb40531e9157b801694c94eba9f5571da4:On\
  \ 32 bit platform, the bit position of GETBIT/SETBIT/BITFIELD/BITCOUNT,BITPOS may overflow\
  \ (see CVE-2021-32761) (#9191)\n\nGETBIT, SETBIT may access wrong address because of wrap.\n\
  BITCOUNT and BITPOS may return wrapped results.\nBITFIELD may access the wrong address but\
  \ also allocate insufficient memory and segfault (see CVE-2021-32761).\n\nThis commit uses\
  \ `uint64_t` or `long long` instead of `size_t`.\nrelated https://github.com/redis/redis/pull/8096\n\
  \nAt 32bit platform:\n> setbit bit 4294967295 1\n(integer) 0\n> config set proto-max-bulk-len\
  \ 536870913\nOK\n> append bit \"\\xFF\"\n(integer) 536870913\n> getbit bit 4294967296\n(integer)\
  \ 0\n\nWhen the bit index is larger than 4294967295, size_t can't hold bit index. In the past,\
  \  `proto-max-bulk-len` is limit to 536870912, so there is no problem.\n\nAfter this commit,\
  \ bit position is stored in `uint64_t` or `long long`. So when `proto-max-bulk-len > 536870912`,\
  \ 32bit platforms can still be correct.\n\nFor 64bit platform, this problem still exists.\
  \ The major reason is bit pos 8 times of byte pos. When proto-max-bulk-len is very larger,\
  \ bit pos may overflow.\nBut at 64bit platform, we don't have so long string. So this bug\
  \ may never happen.\n\nAdditionally this commit add a test cost `512MB` memory which is tag\
  \ as `large-memory`. Make freebsd ci and valgrind ci ignore this test.\n* This test is disabled\
  \ in this version since bitops doesn't rely on\nproto-max-bulk-len. some of the overflows\
  \ can still occur so we do want\nthe fixes.\n\n(cherry picked from commit 71d452876ebf8456afaadd6b3c27988abadd1148)\n\
  5f49f4fb40531e9157b801694c94eba9f5571da4:On 32 bit platform, the bit position of GETBIT/SETBIT/BITFIELD/BITCOUNT,BITPOS\
  \ may overflow (see CVE-2021-32761) (#9191)\n\nGETBIT, SETBIT may access wrong address because\
  \ of wrap.\nBITCOUNT and BITPOS may return wrapped results.\nBITFIELD may access the wrong\
  \ address but also allocate insufficient memory and segfault (see CVE-2021-32761).\n\nThis\
  \ commit uses `uint64_t` or `long long` instead of `size_t`.\nrelated https://github.com/redis/redis/pull/8096\n\
  \nAt 32bit platform:\n> setbit bit 4294967295 1\n(integer) 0\n> config set proto-max-bulk-len\
  \ 536870913\nOK\n> append bit \"\\xFF\"\n(integer) 536870913\n> getbit bit 4294967296\n(integer)\
  \ 0\n\nWhen the bit index is larger than 4294967295, size_t can't hold bit index. In the past,\
  \  `proto-max-bulk-len` is limit to 536870912, so there is no problem.\n\nAfter this commit,\
  \ bit position is stored in `uint64_t` or `long long`. So when `proto-max-bulk-len > 536870912`,\
  \ 32bit platforms can still be correct.\n\nFor 64bit platform, this problem still exists.\
  \ The major reason is bit pos 8 times of byte pos. When proto-max-bulk-len is very larger,\
  \ bit pos may overflow.\nBut at 64bit platform, we don't have so long string. So this bug\
  \ may never happen.\n\nAdditionally this commit add a test cost `512MB` memory which is tag\
  \ as `large-memory`. Make freebsd ci and valgrind ci ignore this test.\n* This test is disabled\
  \ in this version since bitops doesn't rely on\nproto-max-bulk-len. some of the overflows\
  \ can still occur so we do want\nthe fixes.\n\n(cherry picked from commit 71d452876ebf8456afaadd6b3c27988abadd1148)\n\
  835d15b5360e277e6f95529c4d8685946a977ddd:On 32 bit platform, the bit position of GETBIT/SETBIT/BITFIELD/BITCOUNT,BITPOS\
  \ may overflow (see CVE-2021-32761) (#9191)\n\nGETBIT, SETBIT may access wrong address because\
  \ of wrap.\nBITCOUNT and BITPOS may return wrapped results.\nBITFIELD may access the wrong\
  \ address but also allocate insufficient memory and segfault (see CVE-2021-32761).\n\nThis\
  \ commit uses `uint64_t` or `long long` instead of `size_t`.\nrelated https://github.com/redis/redis/pull/8096\n\
  \nAt 32bit platform:\n> setbit bit 4294967295 1\n(integer) 0\n> config set proto-max-bulk-len\
  \ 536870913\nOK\n> append bit \"\\xFF\"\n(integer) 536870913\n> getbit bit 4294967296\n(integer)\
  \ 0\n\nWhen the bit index is larger than 4294967295, size_t can't hold bit index. In the past,\
  \  `proto-max-bulk-len` is limit to 536870912, so there is no problem.\n\nAfter this commit,\
  \ bit position is stored in `uint64_t` or `long long`. So when `proto-max-bulk-len > 536870912`,\
  \ 32bit platforms can still be correct.\n\nFor 64bit platform, this problem still exists.\
  \ The major reason is bit pos 8 times of byte pos. When proto-max-bulk-len is very larger,\
  \ bit pos may overflow.\nBut at 64bit platform, we don't have so long string. So this bug\
  \ may never happen.\n\nAdditionally this commit add a test cost `512MB` memory which is tag\
  \ as `large-memory`. Make freebsd ci and valgrind ci ignore this test.\n\n(cherry picked from\
  \ commit 71d452876ebf8456afaadd6b3c27988abadd1148)\n835d15b5360e277e6f95529c4d8685946a977ddd:On\
  \ 32 bit platform, the bit position of GETBIT/SETBIT/BITFIELD/BITCOUNT,BITPOS may overflow\
  \ (see CVE-2021-32761) (#9191)\n\nGETBIT, SETBIT may access wrong address because of wrap.\n\
  BITCOUNT and BITPOS may return wrapped results.\nBITFIELD may access the wrong address but\
  \ also allocate insufficient memory and segfault (see CVE-2021-32761).\n\nThis commit uses\
  \ `uint64_t` or `long long` instead of `size_t`.\nrelated https://github.com/redis/redis/pull/8096\n\
  \nAt 32bit platform:\n> setbit bit 4294967295 1\n(integer) 0\n> config set proto-max-bulk-len\
  \ 536870913\nOK\n> append bit \"\\xFF\"\n(integer) 536870913\n> getbit bit 4294967296\n(integer)\
  \ 0\n\nWhen the bit index is larger than 4294967295, size_t can't hold bit index. In the past,\
  \  `proto-max-bulk-len` is limit to 536870912, so there is no problem.\n\nAfter this commit,\
  \ bit position is stored in `uint64_t` or `long long`. So when `proto-max-bulk-len > 536870912`,\
  \ 32bit platforms can still be correct.\n\nFor 64bit platform, this problem still exists.\
  \ The major reason is bit pos 8 times of byte pos. When proto-max-bulk-len is very larger,\
  \ bit pos may overflow.\nBut at 64bit platform, we don't have so long string. So this bug\
  \ may never happen.\n\nAdditionally this commit add a test cost `512MB` memory which is tag\
  \ as `large-memory`. Make freebsd ci and valgrind ci ignore this test.\n\n(cherry picked from\
  \ commit 71d452876ebf8456afaadd6b3c27988abadd1148)\n71d452876ebf8456afaadd6b3c27988abadd1148:On\
  \ 32 bit platform, the bit position of GETBIT/SETBIT/BITFIELD/BITCOUNT,BITPOS may overflow\
  \ (see CVE-2021-32761) (#9191)\n\nGETBIT, SETBIT may access wrong address because of wrap.\r\
  \nBITCOUNT and BITPOS may return wrapped results.\r\nBITFIELD may access the wrong address\
  \ but also allocate insufficient memory and segfault (see CVE-2021-32761).\r\n\r\nThis commit\
  \ uses `uint64_t` or `long long` instead of `size_t`.\r\nrelated https://github.com/redis/redis/pull/8096\r\
  \n\r\nAt 32bit platform:\r\n> setbit bit 4294967295 1\r\n(integer) 0\r\n> config set proto-max-bulk-len\
  \ 536870913\r\nOK\r\n> append bit \"\\xFF\"\r\n(integer) 536870913\r\n> getbit bit 4294967296\r\
  \n(integer) 0\r\n\r\nWhen the bit index is larger than 4294967295, size_t can't hold bit index.\
  \ In the past,  `proto-max-bulk-len` is limit to 536870912, so there is no problem.\r\n\r\n\
  After this commit, bit position is stored in `uint64_t` or `long long`. So when `proto-max-bulk-len\
  \ > 536870912`, 32bit platforms can still be correct.\r\n\r\nFor 64bit platform, this problem\
  \ still exists. The major reason is bit pos 8 times of byte pos. When proto-max-bulk-len is\
  \ very larger, bit pos may overflow.\r\nBut at 64bit platform, we don't have so long string.\
  \ So this bug may never happen.\r\n\r\nAdditionally this commit add a test cost `512MB` memory\
  \ which is tag as `large-memory`. Make freebsd ci and valgrind ci ignore this test.\n71d452876ebf8456afaadd6b3c27988abadd1148:On\
  \ 32 bit platform, the bit position of GETBIT/SETBIT/BITFIELD/BITCOUNT,BITPOS may overflow\
  \ (see CVE-2021-32761) (#9191)\n\nGETBIT, SETBIT may access wrong address because of wrap.\r\
  \nBITCOUNT and BITPOS may return wrapped results.\r\nBITFIELD may access the wrong address\
  \ but also allocate insufficient memory and segfault (see CVE-2021-32761).\r\n\r\nThis commit\
  \ uses `uint64_t` or `long long` instead of `size_t`.\r\nrelated https://github.com/redis/redis/pull/8096\r\
  \n\r\nAt 32bit platform:\r\n> setbit bit 4294967295 1\r\n(integer) 0\r\n> config set proto-max-bulk-len\
  \ 536870913\r\nOK\r\n> append bit \"\\xFF\"\r\n(integer) 536870913\r\n> getbit bit 4294967296\r\
  \n(integer) 0\r\n\r\nWhen the bit index is larger than 4294967295, size_t can't hold bit index.\
  \ In the past,  `proto-max-bulk-len` is limit to 536870912, so there is no problem.\r\n\r\n\
  After this commit, bit position is stored in `uint64_t` or `long long`. So when `proto-max-bulk-len\
  \ > 536870912`, 32bit platforms can still be correct.\r\n\r\nFor 64bit platform, this problem\
  \ still exists. The major reason is bit pos 8 times of byte pos. When proto-max-bulk-len is\
  \ very larger, bit pos may overflow.\r\nBut at 64bit platform, we don't have so long string.\
  \ So this bug may never happen.\r\n\r\nAdditionally this commit add a test cost `512MB` memory\
  \ which is tag as `large-memory`. Make freebsd ci and valgrind ci ignore this test."
impacted_packages:
  - purl: pkg:github/redis/redis
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/redis/redis
        commit: 449af2cd7a6646de0d4c0a3500fe72d8f18b7453
    introduced_in_commits: []
  - purl: pkg:github/redis/redis
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/redis/redis
        commit: 835d15b5360e277e6f95529c4d8685946a977ddd
    introduced_in_commits: []
  - purl: pkg:github/redis/redis
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/redis/redis
        commit: 5f49f4fb40531e9157b801694c94eba9f5571da4
    introduced_in_commits: []
  - purl: pkg:github/redis/redis
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/redis/redis
        commit: 71d452876ebf8456afaadd6b3c27988abadd1148
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/redis/redis/tree/449af2cd7a6646de0d4c0a3500fe72d8f18b7453
    reference_type: commit
    reference_id: 449af2cd7a6646de0d4c0a3500fe72d8f18b7453
  - url: https://github.com/redis/redis/tree/5f49f4fb40531e9157b801694c94eba9f5571da4
    reference_type: commit
    reference_id: 5f49f4fb40531e9157b801694c94eba9f5571da4
  - url: https://github.com/redis/redis/tree/71d452876ebf8456afaadd6b3c27988abadd1148
    reference_type: commit
    reference_id: 71d452876ebf8456afaadd6b3c27988abadd1148
  - url: https://github.com/redis/redis/tree/835d15b5360e277e6f95529c4d8685946a977ddd
    reference_type: commit
    reference_id: 835d15b5360e277e6f95529c4d8685946a977ddd
