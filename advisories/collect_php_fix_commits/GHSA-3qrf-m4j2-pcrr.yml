advisory_id: GHSA-3qrf-m4j2-pcrr
datasource_id: collect_php_fix_commits/GHSA-3qrf-m4j2-pcrr
datasource_url: https://github.com/php/php-src
aliases: []
summary: |
  0675edb9330c290bc1884609b71e65390984399a:Sanitize libxml2 globals before parsing

  Fixes GHSA-3qrf-m4j2-pcrr.

  To parse a document with libxml2, you first need to create a parsing context.
  The parsing context contains parsing options (e.g. XML_NOENT to substitute
  entities) that the application (in this case PHP) can set.
  Unfortunately, libxml2 also supports providing default set options.
  For example, if you call xmlSubstituteEntitiesDefault(1) then the XML_NOENT
  option will be added to the parsing options every time you create a parsing
  context **even if the application never requested XML_NOENT**.

  Third party extensions can override these globals, in particular the
  substitute entity global. This causes entity substitution to be
  unexpectedly active.

  Fix it by setting the parsing options to a sane known value.
  For API calls that depend on global state we introduce
  PHP_LIBXML_SANITIZE_GLOBALS() and PHP_LIBXML_RESTORE_GLOBALS().
  For other APIs that work directly with a context we introduce
  php_libxml_sanitize_parse_ctxt_options().
  8f14f036c3fa08bf010fbb0041d1a8c05721f6e9:Sanitize libxml2 globals before parsing

  Fixes GHSA-3qrf-m4j2-pcrr.

  To parse a document with libxml2, you first need to create a parsing context.
  The parsing context contains parsing options (e.g. XML_NOENT to substitute
  entities) that the application (in this case PHP) can set.
  Unfortunately, libxml2 also supports providing default set options.
  For example, if you call xmlSubstituteEntitiesDefault(1) then the XML_NOENT
  option will be added to the parsing options every time you create a parsing
  context **even if the application never requested XML_NOENT**.

  Third party extensions can override these globals, in particular the
  substitute entity global. This causes entity substitution to be
  unexpectedly active.

  Fix it by setting the parsing options to a sane known value.
  For API calls that depend on global state we introduce
  PHP_LIBXML_SANITIZE_GLOBALS() and PHP_LIBXML_RESTORE_GLOBALS().
  For other APIs that work directly with a context we introduce
  php_libxml_sanitize_parse_ctxt_options().

  (cherry picked from commit c283c3ab0ba45d21b2b8745c1f9c7cbfe771c975)
  c283c3ab0ba45d21b2b8745c1f9c7cbfe771c975:Sanitize libxml2 globals before parsing

  Fixes GHSA-3qrf-m4j2-pcrr.

  To parse a document with libxml2, you first need to create a parsing context.
  The parsing context contains parsing options (e.g. XML_NOENT to substitute
  entities) that the application (in this case PHP) can set.
  Unfortunately, libxml2 also supports providing default set options.
  For example, if you call xmlSubstituteEntitiesDefault(1) then the XML_NOENT
  option will be added to the parsing options every time you create a parsing
  context **even if the application never requested XML_NOENT**.

  Third party extensions can override these globals, in particular the
  substitute entity global. This causes entity substitution to be
  unexpectedly active.

  Fix it by setting the parsing options to a sane known value.
  For API calls that depend on global state we introduce
  PHP_LIBXML_SANITIZE_GLOBALS() and PHP_LIBXML_RESTORE_GLOBALS().
  For other APIs that work directly with a context we introduce
  php_libxml_sanitize_parse_ctxt_options().
impacted_packages:
  - purl: pkg:github/php/php-src
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/php/php-src
        commit: 0675edb9330c290bc1884609b71e65390984399a
    introduced_in_commits: []
  - purl: pkg:github/php/php-src
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/php/php-src
        commit: c283c3ab0ba45d21b2b8745c1f9c7cbfe771c975
    introduced_in_commits: []
  - purl: pkg:github/php/php-src
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/php/php-src
        commit: 8f14f036c3fa08bf010fbb0041d1a8c05721f6e9
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/php/php-src/tree/0675edb9330c290bc1884609b71e65390984399a
    reference_type: commit
    reference_id: 0675edb9330c290bc1884609b71e65390984399a
  - url: https://github.com/php/php-src/tree/8f14f036c3fa08bf010fbb0041d1a8c05721f6e9
    reference_type: commit
    reference_id: 8f14f036c3fa08bf010fbb0041d1a8c05721f6e9
  - url: https://github.com/php/php-src/tree/c283c3ab0ba45d21b2b8745c1f9c7cbfe771c975
    reference_type: commit
    reference_id: c283c3ab0ba45d21b2b8745c1f9c7cbfe771c975
