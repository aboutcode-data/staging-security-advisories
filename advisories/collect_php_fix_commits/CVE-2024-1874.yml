advisory_id: CVE-2024-1874
datasource_id: collect_php_fix_commits/CVE-2024-1874
datasource_url: https://github.com/php/php-src
aliases: []
summary: |
  c8b36406c0deae34beda28d908984f708db70289:Fix GHSA-9fcc-425m-g385: bypass CVE-2024-1874

  The old code checked for suffixes but didn't take into account trailing
  whitespace. Furthermore, there is peculiar behaviour with trailing dots
  too. This all happens because of the special path-handling code inside
  CreateProcessW.

  By studying Wine's code, we can see that CreateProcessInternalW calls
  get_file_name [1] in our case because we haven't provided an application
  name. That code gets the first whitespace-delimited string into app_name
  excluding the quotes. It's then passed to create_process_params [2]
  where there is the path handling code that transforms the command line
  argument to an image path [3]. Inside Wine, the extension check if
  performed after these transformations [4]. By doing the same thing in
  PHP we match the behaviour and can properly match the extension even in
  the given edge cases.

  [1] https://github.com/wine-mirror/wine/blob/166895ae3ad3890ad946a309d0fd85e89ea3630e/dlls/kernelbase/process.c#L542-L543
  [2] https://github.com/wine-mirror/wine/blob/166895ae3ad3890ad946a309d0fd85e89ea3630e/dlls/kernelbase/process.c#L565
  [3] https://github.com/wine-mirror/wine/blob/166895ae3ad3890ad946a309d0fd85e89ea3630e/dlls/kernelbase/process.c#L150-L151
  [4] https://github.com/wine-mirror/wine/blob/166895ae3ad3890ad946a309d0fd85e89ea3630e/dlls/kernelbase/process.c#L647-L654
  4b15f5d4ec750b31ec8911f5eb0915a45f96feca:Fix GHSA-9fcc-425m-g385: bypass CVE-2024-1874

  The old code checked for suffixes but didn't take into account trailing
  whitespace. Furthermore, there is peculiar behaviour with trailing dots
  too. This all happens because of the special path-handling code inside
  CreateProcessW.

  By studying Wine's code, we can see that CreateProcessInternalW calls
  get_file_name [1] in our case because we haven't provided an application
  name. That code gets the first whitespace-delimited string into app_name
  excluding the quotes. It's then passed to create_process_params [2]
  where there is the path handling code that transforms the command line
  argument to an image path [3]. Inside Wine, the extension check if
  performed after these transformations [4]. By doing the same thing in
  PHP we match the behaviour and can properly match the extension even in
  the given edge cases.

  [1] https://github.com/wine-mirror/wine/blob/166895ae3ad3890ad946a309d0fd85e89ea3630e/dlls/kernelbase/process.c#L542-L543
  [2] https://github.com/wine-mirror/wine/blob/166895ae3ad3890ad946a309d0fd85e89ea3630e/dlls/kernelbase/process.c#L565
  [3] https://github.com/wine-mirror/wine/blob/166895ae3ad3890ad946a309d0fd85e89ea3630e/dlls/kernelbase/process.c#L150-L151
  [4] https://github.com/wine-mirror/wine/blob/166895ae3ad3890ad946a309d0fd85e89ea3630e/dlls/kernelbase/process.c#L647-L654
  e6a82adace67fd018546bd2767262cfefc7daab0:Fix GHSA-9fcc-425m-g385: bypass CVE-2024-1874

  The old code checked for suffixes but didn't take into account trailing
  whitespace. Furthermore, there is peculiar behaviour with trailing dots
  too. This all happens because of the special path-handling code inside
  CreateProcessW.

  By studying Wine's code, we can see that CreateProcessInternalW calls
  get_file_name [1] in our case because we haven't provided an application
  name. That code gets the first whitespace-delimited string into app_name
  excluding the quotes. It's then passed to create_process_params [2]
  where there is the path handling code that transforms the command line
  argument to an image path [3]. Inside Wine, the extension check if
  performed after these transformations [4]. By doing the same thing in
  PHP we match the behaviour and can properly match the extension even in
  the given edge cases.

  [1] https://github.com/wine-mirror/wine/blob/166895ae3ad3890ad946a309d0fd85e89ea3630e/dlls/kernelbase/process.c#L542-L543
  [2] https://github.com/wine-mirror/wine/blob/166895ae3ad3890ad946a309d0fd85e89ea3630e/dlls/kernelbase/process.c#L565
  [3] https://github.com/wine-mirror/wine/blob/166895ae3ad3890ad946a309d0fd85e89ea3630e/dlls/kernelbase/process.c#L150-L151
  [4] https://github.com/wine-mirror/wine/blob/166895ae3ad3890ad946a309d0fd85e89ea3630e/dlls/kernelbase/process.c#L647-L654
  39c1a90f4a90c3f0191ba11ed3cd0366a810d2cf:Fix GHSA-9fcc-425m-g385: bypass CVE-2024-1874

  The old code checked for suffixes but didn't take into account trailing
  whitespace. Furthermore, there is peculiar behaviour with trailing dots
  too. This all happens because of the special path-handling code inside
  CreateProcessW.

  By studying Wine's code, we can see that CreateProcessInternalW calls
  get_file_name [1] in our case because we haven't provided an application
  name. That code gets the first whitespace-delimited string into app_name
  excluding the quotes. It's then passed to create_process_params [2]
  where there is the path handling code that transforms the command line
  argument to an image path [3]. Inside Wine, the extension check if
  performed after these transformations [4]. By doing the same thing in
  PHP we match the behaviour and can properly match the extension even in
  the given edge cases.

  [1] https://github.com/wine-mirror/wine/blob/166895ae3ad3890ad946a309d0fd85e89ea3630e/dlls/kernelbase/process.c#L542-L543
  [2] https://github.com/wine-mirror/wine/blob/166895ae3ad3890ad946a309d0fd85e89ea3630e/dlls/kernelbase/process.c#L565
  [3] https://github.com/wine-mirror/wine/blob/166895ae3ad3890ad946a309d0fd85e89ea3630e/dlls/kernelbase/process.c#L150-L151
  [4] https://github.com/wine-mirror/wine/blob/166895ae3ad3890ad946a309d0fd85e89ea3630e/dlls/kernelbase/process.c#L647-L654
impacted_packages:
  - purl: pkg:github/php/php-src
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/php/php-src
        commit: c8b36406c0deae34beda28d908984f708db70289
    introduced_in_commits: []
  - purl: pkg:github/php/php-src
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/php/php-src
        commit: 39c1a90f4a90c3f0191ba11ed3cd0366a810d2cf
    introduced_in_commits: []
  - purl: pkg:github/php/php-src
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/php/php-src
        commit: e6a82adace67fd018546bd2767262cfefc7daab0
    introduced_in_commits: []
  - purl: pkg:github/php/php-src
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/php/php-src
        commit: 4b15f5d4ec750b31ec8911f5eb0915a45f96feca
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/php/php-src/tree/39c1a90f4a90c3f0191ba11ed3cd0366a810d2cf
    reference_type: commit
    reference_id: 39c1a90f4a90c3f0191ba11ed3cd0366a810d2cf
  - url: https://github.com/php/php-src/tree/4b15f5d4ec750b31ec8911f5eb0915a45f96feca
    reference_type: commit
    reference_id: 4b15f5d4ec750b31ec8911f5eb0915a45f96feca
  - url: https://github.com/php/php-src/tree/c8b36406c0deae34beda28d908984f708db70289
    reference_type: commit
    reference_id: c8b36406c0deae34beda28d908984f708db70289
  - url: https://github.com/php/php-src/tree/e6a82adace67fd018546bd2767262cfefc7daab0
    reference_type: commit
    reference_id: e6a82adace67fd018546bd2767262cfefc7daab0
