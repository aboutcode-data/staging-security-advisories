advisory_id: CVE-2011-3389
datasource_id: collect_ruby_fix_commits/CVE-2011-3389
datasource_url: https://github.com/ruby/ruby
aliases: []
summary: |
  85fd9aadd13fdf685395cf605007e3fcdf40336f:* backport r34482 from trunk

  * ext/openssl/ossl_ssl.c: Add SSL constants and allow to unset SSL
    option to prevent BEAST attack. See [Bug #5353].

    In OpenSSL, OP_DONT_INSERT_EMPTY_FRAGMENTS is used to prevent
    TLS-CBC-IV vulunerability described at
    http://www.openssl.org/~bodo/tls-cbc.txt
    It's known issue of TLSv1/SSLv3 but it attracts lots of attention
    these days as BEAST attack. (CVE-2011-3389)

    Until now ossl sets OP_ALL at SSLContext allocation and call
    SSL_CTX_set_options at connection.  SSL_CTX_set_options updates the
    value by using |= so bits set by OP_ALL cannot be unset afterwards.
    This commit changes to call SSL_CTX_set_options only 1 time for each
    SSLContext. It sets the specified value if SSLContext#options= are
    called and sets OP_ALL if not.

    To help users to unset bits in OP_ALL, this commit also adds several
    constant to SSL such as
    OpenSSL::SSL::OP_DONT_INSERT_EMPTY_FRAGMENTS.  These constants were
    not exposed in Ruby because there's no way to unset bits in OP_ALL
    before.

    Following is an example to enable 0/n split for BEAST prevention.

      ctx.options = OP_ALL & ~OP_DONT_INSERT_EMPTY_FRAGMENTS

  * test/openssl/test_ssl.rb: Test above option exists.



  git-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_1_9_2@34525 b2dd03c8-39d4-4d8f-98ff-823fe69b080e
  0234bcfd19aa0a7b4152809c13554144b7322f41:* backport r34482 from trunk

  * ext/openssl/ossl_ssl.c: Add SSL constants and allow to unset SSL
    option to prevent BEAST attack. See [Bug #5353].

    In OpenSSL, OP_DONT_INSERT_EMPTY_FRAGMENTS is used to prevent
    TLS-CBC-IV vulunerability described at
    http://www.openssl.org/~bodo/tls-cbc.txt
    It's known issue of TLSv1/SSLv3 but it attracts lots of attention
    these days as BEAST attack. (CVE-2011-3389)

    Until now ossl sets OP_ALL at SSLContext allocation and call
    SSL_CTX_set_options at connection.  SSL_CTX_set_options updates the
    value by using |= so bits set by OP_ALL cannot be unset afterwards.
    This commit changes to call SSL_CTX_set_options only 1 time for each
    SSLContext. It sets the specified value if SSLContext#options= are
    called and sets OP_ALL if not.

    To help users to unset bits in OP_ALL, this commit also adds several
    constant to SSL such as
    OpenSSL::SSL::OP_DONT_INSERT_EMPTY_FRAGMENTS.  These constants were
    not exposed in Ruby because there's no way to unset bits in OP_ALL
    before.

    Following is an example to enable 0/n split for BEAST prevention.

      ctx.options = OP_ALL & ~OP_DONT_INSERT_EMPTY_FRAGMENTS

  * test/openssl/test_ssl.rb: Test above option exists.



  git-svn-id: svn+ssh://ci.ruby-lang.org/ruby/branches/ruby_1_9_3@34524 b2dd03c8-39d4-4d8f-98ff-823fe69b080e
  3ff2f9f3a32fbd87caab29f7fe163c63ab50e305:* ext/openssl/ossl_ssl.c: Add SSL constants and allow to unset SSL
    option to prevent BEAST attack. See [Bug #5353].

    In OpenSSL, OP_DONT_INSERT_EMPTY_FRAGMENTS is used to prevent
    TLS-CBC-IV vulunerability described at
    http://www.openssl.org/~bodo/tls-cbc.txt
    It's known issue of TLSv1/SSLv3 but it attracts lots of attention
    these days as BEAST attack. (CVE-2011-3389)

    Until now ossl sets OP_ALL at SSLContext allocation and call
    SSL_CTX_set_options at connection.  SSL_CTX_set_options updates the
    value by using |= so bits set by OP_ALL cannot be unset afterwards.

    This commit changes to call SSL_CTX_set_options only 1 time for each
    SSLContext. It sets the specified value if SSLContext#options= are
    called and sets OP_ALL if not.

    To help users to unset bits in OP_ALL, this commit also adds several
    constant to SSL such as
    OpenSSL::SSL::OP_DONT_INSERT_EMPTY_FRAGMENTS.  These constants were
    not exposed in Ruby because there's no way to unset bits in OP_ALL
    before.

    Following is an example to enable 0/n split for BEAST prevention.

      ctx.options = OP_ALL & ~OP_DONT_INSERT_EMPTY_FRAGMENTS

  * test/openssl/test_ssl.rb: Test above option exists.


  git-svn-id: svn+ssh://ci.ruby-lang.org/ruby/trunk@34482 b2dd03c8-39d4-4d8f-98ff-823fe69b080e
impacted_packages:
  - purl: pkg:github/ruby/ruby
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/ruby/ruby
        commit: 85fd9aadd13fdf685395cf605007e3fcdf40336f
    introduced_in_commits: []
  - purl: pkg:github/ruby/ruby
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/ruby/ruby
        commit: 3ff2f9f3a32fbd87caab29f7fe163c63ab50e305
    introduced_in_commits: []
  - purl: pkg:github/ruby/ruby
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/ruby/ruby
        commit: 0234bcfd19aa0a7b4152809c13554144b7322f41
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/ruby/ruby/tree/0234bcfd19aa0a7b4152809c13554144b7322f41
    reference_type: commit
    reference_id: 0234bcfd19aa0a7b4152809c13554144b7322f41
  - url: https://github.com/ruby/ruby/tree/3ff2f9f3a32fbd87caab29f7fe163c63ab50e305
    reference_type: commit
    reference_id: 3ff2f9f3a32fbd87caab29f7fe163c63ab50e305
  - url: https://github.com/ruby/ruby/tree/85fd9aadd13fdf685395cf605007e3fcdf40336f
    reference_type: commit
    reference_id: 85fd9aadd13fdf685395cf605007e3fcdf40336f
