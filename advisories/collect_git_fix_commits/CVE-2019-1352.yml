advisory_id: CVE-2019-1352
datasource_id: collect_git_fix_commits/CVE-2019-1352
datasource_url: https://github.com/git/git
aliases: []
summary: |
  873a466ea3f233d4fb11f894a311de06939a2a3e:clone: drop the protections where hooks aren't run

  As part of the security bug-fix releases v2.39.4, ..., v2.45.1, I
  introduced logic to safeguard `git clone` from running hooks that were
  installed _during_ the clone operation.

  The rationale was that Git's CVE-2024-32002, CVE-2021-21300,
  CVE-2019-1354, CVE-2019-1353, CVE-2019-1352, and CVE-2019-1349 should
  have been low-severity vulnerabilities but were elevated to
  critical/high severity by the attack vector that allows a weakness where
  files inside `.git/` can be inadvertently written during a `git clone`
  to escalate to a Remote Code Execution attack by virtue of installing a
  malicious `post-checkout` hook that Git will then run at the end of the
  operation without giving the user a chance to see what code is executed.

  Unfortunately, Git LFS uses a similar strategy to install its own
  `post-checkout` hook during a `git clone`; In fact, Git LFS is
  installing four separate hooks while running the `smudge` filter.

  While this pattern is probably in want of being improved by introducing
  better support in Git for Git LFS and other tools wishing to register
  hooks to be run at various stages of Git's commands, let's undo the
  clone protections to unbreak Git LFS-enabled clones.

  This reverts commit 8db1e8743c0 (clone: prevent hooks from running
  during a clone, 2024-03-28).

  Signed-off-by: Johannes Schindelin <johannes.schindelin@gmx.de>
  Signed-off-by: Junio C Hamano <gitster@pobox.com>
  7c3745fc6185495d5765628b4dfe1bd2c25a2981:path: safeguard `.git` against NTFS Alternate Streams Accesses

  Probably inspired by HFS' resource streams, NTFS supports "Alternate
  Data Streams": by appending `:<stream-name>` to the file name,
  information in addition to the file contents can be written and read,
  information that is copied together with the file (unless copied to a
  non-NTFS location).

  These Alternate Data Streams are typically used for things like marking
  an executable as having just been downloaded from the internet (and
  hence not necessarily being trustworthy).

  In addition to a stream name, a stream type can be appended, like so:
  `:<stream-name>:<stream-type>`. Unless specified, the default stream
  type is `$DATA` for files and `$INDEX_ALLOCATION` for directories. In
  other words, `.git::$INDEX_ALLOCATION` is a valid way to reference the
  `.git` directory!

  In our work in Git v2.2.1 to protect Git on NTFS drives under
  `core.protectNTFS`, we focused exclusively on NTFS short names, unaware
  of the fact that NTFS Alternate Data Streams offer a similar attack
  vector.

  Let's fix this.

  Seeing as it is better to be safe than sorry, we simply disallow paths
  referring to *any* NTFS Alternate Data Stream of `.git`, not just
  `::$INDEX_ALLOCATION`. This also simplifies the implementation.

  This closes CVE-2019-1352.

  Further reading about NTFS Alternate Data Streams:
  https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-fscc/c54dec26-1551-4d3a-a0ea-4fa40f848eb3

  Reported-by: Nicolas Joly <Nicolas.Joly@microsoft.com>
  Signed-off-by: Johannes Schindelin <johannes.schindelin@gmx.de>
impacted_packages:
  - purl: pkg:github/git/git
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/git/git
        commit: 873a466ea3f233d4fb11f894a311de06939a2a3e
    introduced_in_commits: []
  - purl: pkg:github/git/git
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/git/git
        commit: 7c3745fc6185495d5765628b4dfe1bd2c25a2981
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/git/git/tree/7c3745fc6185495d5765628b4dfe1bd2c25a2981
    reference_type: commit
    reference_id: 7c3745fc6185495d5765628b4dfe1bd2c25a2981
  - url: https://github.com/git/git/tree/873a466ea3f233d4fb11f894a311de06939a2a3e
    reference_type: commit
    reference_id: 873a466ea3f233d4fb11f894a311de06939a2a3e
