advisory_id: CVE-2024-32021
datasource_id: collect_git_fix_commits/CVE-2024-32021
datasource_url: https://github.com/git/git
aliases: []
summary: |
  9e65df5eab274bf74c7b570107aacd1303a1e703:Merge branch 'ownership-checks-in-local-clones'

  This topic addresses two CVEs:

  - CVE-2024-32020:

    Local clones may end up hardlinking files into the target repository's
    object database when source and target repository reside on the same
    disk. If the source repository is owned by a different user, then
    those hardlinked files may be rewritten at any point in time by the
    untrusted user.

  - CVE-2024-32021:

    When cloning a local source repository that contains symlinks via the
    filesystem, Git may create hardlinks to arbitrary user-readable files
    on the same filesystem as the target repository in the objects/
    directory.

  Signed-off-by: Johannes Schindelin <johannes.schindelin@gmx.de>
  d1bb66a546b4bb46005d17ba711caaad26f26c1e:builtin/clone: abort when hardlinked source and target file differ

  When performing local clones with hardlinks we refuse to copy source
  files which are symlinks as a mitigation for CVE-2022-39253. This check
  can be raced by an adversary though by changing the file to a symlink
  after we have checked it.

  Fix the issue by checking whether the hardlinked destination file
  matches the source file and abort in case it doesn't.

  This addresses CVE-2024-32021.

  Reported-by: Apple Product Security <product-security@apple.com>
  Suggested-by: Linus Torvalds <torvalds@linuxfoundation.org>
  Signed-off-by: Patrick Steinhardt <ps@pks.im>
  Signed-off-by: Johannes Schindelin <johannes.schindelin@gmx.de>
impacted_packages:
  - purl: pkg:github/git/git
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/git/git
        commit: d1bb66a546b4bb46005d17ba711caaad26f26c1e
    introduced_in_commits: []
  - purl: pkg:github/git/git
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/git/git
        commit: 9e65df5eab274bf74c7b570107aacd1303a1e703
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/git/git/tree/9e65df5eab274bf74c7b570107aacd1303a1e703
    reference_type: commit
    reference_id: 9e65df5eab274bf74c7b570107aacd1303a1e703
  - url: https://github.com/git/git/tree/d1bb66a546b4bb46005d17ba711caaad26f26c1e
    reference_type: commit
    reference_id: d1bb66a546b4bb46005d17ba711caaad26f26c1e
