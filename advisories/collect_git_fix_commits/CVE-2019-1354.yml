advisory_id: CVE-2019-1354
datasource_id: collect_git_fix_commits/CVE-2019-1354
datasource_url: https://github.com/git/git
aliases: []
summary: |
  873a466ea3f233d4fb11f894a311de06939a2a3e:clone: drop the protections where hooks aren't run

  As part of the security bug-fix releases v2.39.4, ..., v2.45.1, I
  introduced logic to safeguard `git clone` from running hooks that were
  installed _during_ the clone operation.

  The rationale was that Git's CVE-2024-32002, CVE-2021-21300,
  CVE-2019-1354, CVE-2019-1353, CVE-2019-1352, and CVE-2019-1349 should
  have been low-severity vulnerabilities but were elevated to
  critical/high severity by the attack vector that allows a weakness where
  files inside `.git/` can be inadvertently written during a `git clone`
  to escalate to a Remote Code Execution attack by virtue of installing a
  malicious `post-checkout` hook that Git will then run at the end of the
  operation without giving the user a chance to see what code is executed.

  Unfortunately, Git LFS uses a similar strategy to install its own
  `post-checkout` hook during a `git clone`; In fact, Git LFS is
  installing four separate hooks while running the `smudge` filter.

  While this pattern is probably in want of being improved by introducing
  better support in Git for Git LFS and other tools wishing to register
  hooks to be run at various stages of Git's commands, let's undo the
  clone protections to unbreak Git LFS-enabled clones.

  This reverts commit 8db1e8743c0 (clone: prevent hooks from running
  during a clone, 2024-03-28).

  Signed-off-by: Johannes Schindelin <johannes.schindelin@gmx.de>
  Signed-off-by: Junio C Hamano <gitster@pobox.com>
  bccc37fdc7ec66377af454417013f7612aef75e6:cygwin: disallow backslashes in file names

  The backslash character is not a valid part of a file name on Windows.
  If, in Windows, Git attempts to write a file that has a backslash
  character in the filename, it will be incorrectly interpreted as a
  directory separator.

  This caused CVE-2019-1354 in MinGW, as this behaviour can be manipulated
  to cause the checkout to write to files it ought not write to, such as
  adding code to the .git/hooks directory.  This was fixed by e1d911dd4c
  (mingw: disallow backslash characters in tree objects' file names,
  2019-09-12).  However, the vulnerability also exists in Cygwin: while
  Cygwin mostly provides a POSIX-like path system, it will still interpret
  a backslash as a directory separator.

  To avoid this vulnerability, CVE-2021-29468, extend the previous fix to
  also apply to Cygwin.

  Similarly, extend the test case added by the previous version of the
  commit.  The test suite doesn't have an easy way to say "run this test
  if in MinGW or Cygwin", so add a new test prerequisite that covers both.

  As well as checking behaviour in the presence of paths containing
  backslashes, the existing test also checks behaviour in the presence of
  paths that differ only by the presence of a trailing ".".  MinGW follows
  normal Windows application behaviour and treats them as the same path,
  but Cygwin more closely emulates *nix systems (at the expense of
  compatibility with native Windows applications) and will create and
  distinguish between such paths.  Gate the relevant bit of that test
  accordingly.

  Reported-by: RyotaK <security@ryotak.me>
  Helped-by: Johannes Schindelin <johannes.schindelin@gmx.de>
  Signed-off-by: Adam Dinwoodie <adam@dinwoodie.org>
  Signed-off-by: Junio C Hamano <gitster@pobox.com>
  e1d911dd4c7b76a5a8cec0f5c8de15981e34da83:mingw: disallow backslash characters in tree objects' file names

  The backslash character is not a valid part of a file name on Windows.
  Hence it is dangerous to allow writing files that were unpacked from
  tree objects, when the stored file name contains a backslash character:
  it will be misinterpreted as directory separator.

  This not only causes ambiguity when a tree contains a blob `a\b` and a
  tree `a` that contains a blob `b`, but it also can be used as part of an
  attack vector to side-step the careful protections against writing into
  the `.git/` directory during a clone of a maliciously-crafted
  repository.

  Let's prevent that, addressing CVE-2019-1354.

  Note: we guard against backslash characters in tree objects' file names
  _only_ on Windows (because on other platforms, even on those where NTFS
  volumes can be mounted, the backslash character is _not_ a directory
  separator), and _only_ when `core.protectNTFS = true` (because users
  might need to generate tree objects for other platforms, of course
  without touching the worktree, e.g. using `git update-index
  --cacheinfo`).

  Signed-off-by: Johannes Schindelin <johannes.schindelin@gmx.de>
impacted_packages:
  - purl: pkg:github/git/git
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/git/git
        commit: 873a466ea3f233d4fb11f894a311de06939a2a3e
    introduced_in_commits: []
  - purl: pkg:github/git/git
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/git/git
        commit: e1d911dd4c7b76a5a8cec0f5c8de15981e34da83
    introduced_in_commits: []
  - purl: pkg:github/git/git
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/git/git
        commit: bccc37fdc7ec66377af454417013f7612aef75e6
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/git/git/tree/873a466ea3f233d4fb11f894a311de06939a2a3e
    reference_type: commit
    reference_id: 873a466ea3f233d4fb11f894a311de06939a2a3e
  - url: https://github.com/git/git/tree/bccc37fdc7ec66377af454417013f7612aef75e6
    reference_type: commit
    reference_id: bccc37fdc7ec66377af454417013f7612aef75e6
  - url: https://github.com/git/git/tree/e1d911dd4c7b76a5a8cec0f5c8de15981e34da83
    reference_type: commit
    reference_id: e1d911dd4c7b76a5a8cec0f5c8de15981e34da83
