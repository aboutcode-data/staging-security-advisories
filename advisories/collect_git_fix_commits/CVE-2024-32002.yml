advisory_id: CVE-2024-32002
datasource_id: collect_git_fix_commits/CVE-2024-32002
datasource_url: https://github.com/git/git
aliases: []
summary: |
  873a466ea3f233d4fb11f894a311de06939a2a3e:clone: drop the protections where hooks aren't run

  As part of the security bug-fix releases v2.39.4, ..., v2.45.1, I
  introduced logic to safeguard `git clone` from running hooks that were
  installed _during_ the clone operation.

  The rationale was that Git's CVE-2024-32002, CVE-2021-21300,
  CVE-2019-1354, CVE-2019-1353, CVE-2019-1352, and CVE-2019-1349 should
  have been low-severity vulnerabilities but were elevated to
  critical/high severity by the attack vector that allows a weakness where
  files inside `.git/` can be inadvertently written during a `git clone`
  to escalate to a Remote Code Execution attack by virtue of installing a
  malicious `post-checkout` hook that Git will then run at the end of the
  operation without giving the user a chance to see what code is executed.

  Unfortunately, Git LFS uses a similar strategy to install its own
  `post-checkout` hook during a `git clone`; In fact, Git LFS is
  installing four separate hooks while running the `smudge` filter.

  While this pattern is probably in want of being improved by introducing
  better support in Git for Git LFS and other tools wishing to register
  hooks to be run at various stages of Git's commands, let's undo the
  clone protections to unbreak Git LFS-enabled clones.

  This reverts commit 8db1e8743c0 (clone: prevent hooks from running
  during a clone, 2024-03-28).

  Signed-off-by: Johannes Schindelin <johannes.schindelin@gmx.de>
  Signed-off-by: Junio C Hamano <gitster@pobox.com>
  97065761333fd62db1912d81b489db938d8c991d:submodules: submodule paths must not contain symlinks

  When creating a submodule path, we must be careful not to follow
  symbolic links. Otherwise we may follow a symbolic link pointing to
  a gitdir (which are valid symbolic links!) e.g. while cloning.

  On case-insensitive filesystems, however, we blindly replace a directory
  that has been created as part of the `clone` operation with a symlink
  when the path to the latter differs only in case from the former's path.

  Let's simply avoid this situation by expecting not ever having to
  overwrite any existing file/directory/symlink upon cloning. That way, we
  won't even replace a directory that we just created.

  This addresses CVE-2024-32002.

  Reported-by: Filip Hejsek <filip.hejsek@gmail.com>
  Signed-off-by: Johannes Schindelin <johannes.schindelin@gmx.de>
impacted_packages:
  - purl: pkg:github/git/git
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/git/git
        commit: 873a466ea3f233d4fb11f894a311de06939a2a3e
    introduced_in_commits: []
  - purl: pkg:github/git/git
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/git/git
        commit: 97065761333fd62db1912d81b489db938d8c991d
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/git/git/tree/873a466ea3f233d4fb11f894a311de06939a2a3e
    reference_type: commit
    reference_id: 873a466ea3f233d4fb11f894a311de06939a2a3e
  - url: https://github.com/git/git/tree/97065761333fd62db1912d81b489db938d8c991d
    reference_type: commit
    reference_id: 97065761333fd62db1912d81b489db938d8c991d
