advisory_id: CVE-2022-41953
datasource_id: collect_git_fix_commits/CVE-2022-41953
datasource_url: https://github.com/git/git
aliases: []
summary: "1925c292e84eb9cee40bfa2582900afa9a310154:gitk: override $PATH search only on Windows\n\
  \nCommit 4cbe9e0e2 was written to address problems that result from Tcl's\ndocumented behavior\
  \ on Windows where the current working directory and a\nnumber of Windows system directories\
  \ are automatically prepended to\n$PATH when searching for executables [1].  This basic Windows\
  \ behavior\nhas resulted in more than one CVE against git for Windows:\nCVE-2023-23618, CVE-2022-41953\
  \ are listed on the git for Windows github\nwebsite for the Tcl components of git (gitk, git-gui).\n\
  \n4cbe9e0e2 is intended to restrict the search to looking only in\ndirectories given in $PATH\
  \ and in the given order, which is exactly the\nTcl behavior documented to exist on non-Windows\
  \ platforms [1]. Thus,\nthis change could have been written to affect only Windows, leaving\n\
  other platforms alone.\n\nHowever, 4cbe9e0e2 implements the override for all platforms. This\n\
  includes specialized code for Cygwin, copied from git-gui prior to\ncommit 7145c654 on https://github.com/j6t/git-gui,\
  \ so targets a\nlong retired Cygwin port of the Windows Tcl/Tk using Windows pathnames.\n\
  Since 2012, Cygwin uses a Unix/X11 port requiring Unix pathnames,\nmeaning 4cbe9e0e2 is incompatible.\
  \  4cbe9e0e2 also induces an infinite\nrecursion as _which now invokes the exec wrapper that\
  \ invokes _which.\nThis is part of git v2.49.0, so gitk on Cygwin is broken in that\nrelease.\n\
  \nRather than fix the unnecessary override code for Cygwin, let's just\nlimit the override\
  \ of exec/open to Windows, leaving all other platforms\nusing their native exec/open as they\
  \ did prior to 4cbe9e0e2. This patch\nwraps the override code in an \"if {[is_Windows]} {\
  \ ... }\" block while\nremoving the non-Windows code added in 4cbe9e0e2.\n\n[1] see https://www.tcl-lang.org/man/tcl8.6/TclCmd/exec.htm\n\
  \nSigned-off-by: Mark Levedahl <mlevedahl@gmail.com>\nSigned-off-by: Johannes Sixt <j6t@kdbg.org>\n\
  4cbe9e0e21fca682d78980a03184071e9fe1c955:gitk(Windows): avoid inadvertently calling executables\
  \ in the worktree\n\nJust like CVE-2022-41953 for Git GUI, there exists a vulnerability of\n\
  `gitk` where it looks for `taskkill.exe` in the current directory before\nsearching `PATH`.\n\
  \nNote that the many `exec git` calls are unaffected, due to an obscure\nquirk in Tcl's `exec`\
  \ function. Typically, `git.exe` lives next to\n`wish.exe` (i.e. the program that is run to\
  \ execute `gitk` or Git GUI)\nin Git for Windows, and that is the saving grace for `git.exe\
  \ because\n`exec` searches the directory where `wish.exe` lives even before the\ncurrent directory,\
  \ according to\nhttps://www.tcl-lang.org/man/tcl/TclCmd/exec.htm#M24:\n\n\tIf a directory\
  \ name was not specified as part of the application\n\tname, the following directories are\
  \ automatically searched in\n\torder when attempting to locate the application:\n\n\t    The\
  \ directory from which the Tcl executable was loaded.\n\n\t    The current directory.\n\n\t\
  \    The Windows 32-bit system directory.\n\n\t    The Windows home directory.\n\n\t    The\
  \ directories listed in the path.\n\nThe same is not true, however, for `taskkill.exe`: it\
  \ lives in the\nWindows system directory (never mind the 32-bit, Tcl's documentation is\n\
  outdated on that point, it really means `C:\\Windows\\system32`).\n\nSigned-off-by: Johannes\
  \ Schindelin <johannes.schindelin@gmx.de>\n1e5a89c1b4da13b89b0b66ad59d098ced832c3f0:Merge\
  \ branch 'js/windows-rce'\n\nFix a Remote Code Execution vulnerability on Windows. This is\
  \ caused by\nthe fact that Tcl on Windows always includes the current directory when\nlooking\
  \ for an executable. Therefore malicious repositories can ship\nwith an aspell.exe in their\
  \ top-level directory which is executed by Git\nGUI without giving the user a chance to inspect\
  \ it first, i.e. running\nuntrusted code.\n\nThis merge fixes CVE-2022-41953.\n\n* js/windows-rce:\n\
  \  Work around Tcl's default `PATH` lookup\n  Move the `_which` function (almost) to the top\n\
  \  Move is_<platform> functions to the beginning\n  is_Cygwin: avoid `exec`ing anything\n\
  \  windows: ignore empty `PATH` elements\naae9560a355d4ab91385e49eae62fade2ddd27ef:Work around\
  \ Tcl's default `PATH` lookup\n\nAs per https://www.tcl.tk/man/tcl8.6/TclCmd/exec.html#M23,\
  \ Tcl's `exec`\nfunction goes out of its way to imitate the highly dangerous path lookup\n\
  of `cmd.exe`, but _of course_ only on Windows:\n\n\tIf a directory name was not specified\
  \ as part of the application\n\tname, the following directories are automatically searched\
  \ in\n\torder when attempting to locate the application:\n\n\t    The directory from which\
  \ the Tcl executable was loaded.\n\n\t    The current directory.\n\n\t    The Windows 32-bit\
  \ system directory.\n\n\t    The Windows home directory.\n\n\t    The directories listed in\
  \ the path.\n\nThe dangerous part is the second item, of course: `exec` _prefers_\nexecutables\
  \ in the current directory to those that are actually in the\n`PATH`.\n\nIt is almost as if\
  \ people wanted to Windows users vulnerable,\nspecifically.\n\nTo avoid that, Git GUI already\
  \ has the `_which` function that does not\nimitate that dangerous practice when looking up\
  \ executables in the\nsearch path.\n\nHowever, Git GUI currently fails to use that function\
  \ e.g. when trying to\nexecute `aspell` for spell checking.\n\nThat is not only dangerous\
  \ but combined with Tcl's unfortunate default\nbehavior and with the fact that Git GUI tries\
  \ to spell-check a\nrepository just after cloning, leads to a critical Remote Code Execution\n\
  vulnerability.\n\nLet's override both `exec` and `open` to always use `_which` instead of\n\
  letting Tcl perform the path lookup, to prevent this attack vector.\n\nThis addresses CVE-2022-41953.\n\
  \nFor more details, see\nhttps://github.com/git-for-windows/git/security/advisories/GHSA-v4px-mx59-w99c\n\
  \nSigned-off-by: Johannes Schindelin <johannes.schindelin@gmx.de>\nSigned-off-by: Pratyush\
  \ Yadav <me@yadavpratyush.com>\nfd477a1d3bab580c2fcdc435f551dca3094286ae:Move the `_which`\
  \ function (almost) to the top\n\nWe are about to make use of the `_which` function to address\n\
  CVE-2022-41953 by overriding Tcl/Tk's unsafe PATH lookup on Windows.\n\nIn preparation for\
  \ that, let's move it close to the top of the file to\nmake sure that even early `exec` calls\
  \ that happen during the start-up\nof Git GUI benefit from the fix.\n\nThis commit is best\
  \ viewed with `--color-moved`.\n\nSigned-off-by: Johannes Schindelin <johannes.schindelin@gmx.de>\n\
  Signed-off-by: Pratyush Yadav <me@yadavpratyush.com>"
impacted_packages:
  - purl: pkg:github/git/git
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/git/git
        commit: 4cbe9e0e21fca682d78980a03184071e9fe1c955
    introduced_in_commits: []
  - purl: pkg:github/git/git
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/git/git
        commit: aae9560a355d4ab91385e49eae62fade2ddd27ef
    introduced_in_commits: []
  - purl: pkg:github/git/git
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/git/git
        commit: '1925c292e84eb9cee40bfa2582900afa9a310154'
    introduced_in_commits: []
  - purl: pkg:github/git/git
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/git/git
        commit: fd477a1d3bab580c2fcdc435f551dca3094286ae
    introduced_in_commits: []
  - purl: pkg:github/git/git
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/git/git
        commit: 1e5a89c1b4da13b89b0b66ad59d098ced832c3f0
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/git/git/tree/1925c292e84eb9cee40bfa2582900afa9a310154
    reference_type: commit
    reference_id: '1925c292e84eb9cee40bfa2582900afa9a310154'
  - url: https://github.com/git/git/tree/1e5a89c1b4da13b89b0b66ad59d098ced832c3f0
    reference_type: commit
    reference_id: 1e5a89c1b4da13b89b0b66ad59d098ced832c3f0
  - url: https://github.com/git/git/tree/4cbe9e0e21fca682d78980a03184071e9fe1c955
    reference_type: commit
    reference_id: 4cbe9e0e21fca682d78980a03184071e9fe1c955
  - url: https://github.com/git/git/tree/aae9560a355d4ab91385e49eae62fade2ddd27ef
    reference_type: commit
    reference_id: aae9560a355d4ab91385e49eae62fade2ddd27ef
  - url: https://github.com/git/git/tree/fd477a1d3bab580c2fcdc435f551dca3094286ae
    reference_type: commit
    reference_id: fd477a1d3bab580c2fcdc435f551dca3094286ae
