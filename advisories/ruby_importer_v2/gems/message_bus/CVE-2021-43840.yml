advisory_id: gems/message_bus/CVE-2021-43840
datasource_id: ruby_importer_v2/gems/message_bus/CVE-2021-43840
datasource_url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/message_bus/CVE-2021-43840.yml
aliases:
  - CVE-2021-43840
  - GHSA-xmgj-5fh3-xjmm
summary: |
  Path traversal when MessageBus::Diagnostics is enabled
  ### Impact

  Users who deployed message bus with diagnostics features enabled (default off) were
  vulnerable to a path traversal bug, which could lead to disclosure of secret
  information on a machine if an unintended user were to gain access to the diagnostic
  route. The impact is also greater if there is no proxy for your web application as
  the number of steps up the directories is not bounded. For deployments which uses a
  proxy, the impact varies. For example, If a request goes through a proxy like Nginx
  with `merge_slashes` enabled, the number of steps up the directories that can be
  read is limited to 3 levels.

  ### Workarounds

  Disable MessageBus::Diagnostics in production like environments.
impacted_packages:
  - purl: pkg:gem/message_bus
    affected_versions:
    fixed_versions: vers:gem/>=3.3.7
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '4.2'
    scoring_system: cvssv3
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://github.com/discourse/message_bus/security/advisories/GHSA-xmgj-5fh3-xjmm
    reference_type:
    reference_id:
