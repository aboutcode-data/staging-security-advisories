advisory_id: gems/actionview/CVE-2020-5267
datasource_id: ruby_importer_v2/gems/actionview/CVE-2020-5267
datasource_url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/actionview/CVE-2020-5267.yml
aliases:
  - CVE-2020-5267
  - GHSA-65cv-r6x7-79hv
summary: |
  Possible XSS vulnerability in ActionView
  There is a possible XSS vulnerability in ActionView's JavaScript literal
  escape helpers.  Views that use the `j` or `escape_javascript` methods
  may be susceptible to XSS attacks.

  Versions Affected:  All.
  Not affected:       None.
  Fixed Versions:     6.0.2.2, 5.2.4.2

  Impact
  ------
  There is a possible XSS vulnerability in the `j` and `escape_javascript`
  methods in ActionView.  These methods are used for escaping JavaScript string
  literals.  Impacted code will look something like this:

  ```erb
  <script>let a = `<%= j unknown_input %>`</script>
  ```

  or

  ```erb
  <script>let a = `<%= escape_javascript unknown_input %>`</script>
  ```

  Releases
  --------
  The 6.0.2.2 and 5.2.4.2 releases are available at the normal locations.

  Workarounds
  -----------
  For those that can't upgrade, the following monkey patch may be used:

  ```ruby
  ActionView::Helpers::JavaScriptHelper::JS_ESCAPE_MAP.merge!(
    {
      "`" => "\\`",
      "$" => "\\$"
    }
  )

  module ActionView::Helpers::JavaScriptHelper
    alias :old_ej :escape_javascript
    alias :old_j :j

    def escape_javascript(javascript)
      javascript = javascript.to_s
      if javascript.empty?
        result = ""
      else
        result = javascript.gsub(/(\\|<\/|\r\n|\342\200\250|\342\200\251|[\n\r"']|[`]|[$])/u, JS_ESCAPE_MAP)
      end
      javascript.html_safe? ? result.html_safe : result
    end

    alias :j :escape_javascript
  end
  ```
impacted_packages:
  - purl: pkg:gem/actionview
    affected_versions:
    fixed_versions: vers:gem/>=6.0.2.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '4.0'
    scoring_system: cvssv3
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://groups.google.com/forum/#!topic/rubyonrails-security/55reWMM_Pg8
    reference_type:
    reference_id:
