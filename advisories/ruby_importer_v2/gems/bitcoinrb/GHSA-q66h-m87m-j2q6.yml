advisory_id: gems/bitcoinrb/GHSA-q66h-m87m-j2q6
datasource_id: ruby_importer_v2/gems/bitcoinrb/GHSA-q66h-m87m-j2q6
datasource_url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/bitcoinrb/GHSA-q66h-m87m-j2q6.yml
aliases:
  - GHSA-q66h-m87m-j2q6
summary: |
  Bitcoinrb Vulnerable to Command injection via RPC
  ### Summary: Remote Code Execution

  Unsafe handling of request parameters in the RPC HTTP server
  results in command injection.

  ### Details

  In lib/bitcoin/rpc/http_server.rb line 30-39, the JSON body of a
  POST request is parsed into `command` and `args` variables. These
  values are then passed to `send`, which is used to call an arbitrary
  class method. However, there is no validation that the provided
  `command` value  is one of the expected RPC methods.
  This means that an attacker could supply a `command` value such
  as `system`, and then pass arbitrary system commands into the
  `args` parameter and achieve remote code execution.

  ### Remediation

   **Mitigating Factors:**

  - The RPC server is part of the experimental SPV node feature,
     which is not documented and has very few users.
  - The SPV-related features may be removed in future releases.

  **Resolution:**

  - Added whitelist validation to allow only RPC methods defined
    in `RequestHandler`.

  - Fixed in version 1.12.0.
impacted_packages:
  - purl: pkg:gem/bitcoinrb
    affected_versions:
    fixed_versions: vers:gem/>=1.12.0
    fixed_in_commits: []
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/chaintope/bitcoinrb/security/advisories/GHSA-q66h-m87m-j2q6
    reference_type:
    reference_id:
