advisory_id: gems/actionpack/CVE-2022-23633
datasource_id: ruby_importer_v2/gems/actionpack/CVE-2022-23633
datasource_url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/actionpack/CVE-2022-23633.yml
aliases:
  - CVE-2022-23633
  - GHSA-wh98-p28r-vrc9
summary: |
  Possible exposure of information vulnerability in Action Pack
  ## Impact

  Under certain circumstances response bodies will not be closed, for example a
  bug in a webserver (https://github.com/puma/puma/pull/2812) or a bug in a Rack
  middleware. In the event a response is not notified of a `close`,
  `ActionDispatch::Executor` will not know to reset thread local state for the
  next request. This can lead to data being leaked to subsequent requests,
  especially when interacting with `ActiveSupport::CurrentAttributes`.

  Upgrading to the FIXED versions of Rails will ensure mitigation if this issue
  even in the context of a buggy webserver or middleware implementation.

  ## Patches

  This has been fixed in Rails 7.0.2.2, 6.1.4.6, 6.0.4.6, and 5.2.6.2.

  ## Workarounds

  Upgrading is highly recommended, but to work around this problem the following
  middleware can be used:

  ```
  class GuardedExecutor < ActionDispatch::Executor
    def call(env)
      ensure_completed!
      super
    end

    private

      def ensure_completed!
        @executor.new.complete! if @executor.active?
      end
  end

  # Ensure the guard is inserted before ActionDispatch::Executor
  Rails.application.configure do
    config.middleware.swap ActionDispatch::Executor, GuardedExecutor, executor
  end
  ```
impacted_packages:
  - purl: pkg:gem/actionpack
    affected_versions: vers:gem/>=5.0.0
    fixed_versions:
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/actionpack
    affected_versions:
    fixed_versions: vers:gem/>=7.0.2.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.4'
    scoring_system: cvssv3
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://groups.google.com/g/ruby-security-ann/c/FkTM-_7zSNA/m/K2RiMJBlBAAJ
    reference_type:
    reference_id:
