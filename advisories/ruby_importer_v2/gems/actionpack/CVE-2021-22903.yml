advisory_id: gems/actionpack/CVE-2021-22903
datasource_id: ruby_importer_v2/gems/actionpack/CVE-2021-22903
datasource_url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/actionpack/CVE-2021-22903.yml
aliases:
  - CVE-2021-22903
  - GHSA-5hq2-xf89-9jxq
summary: |
  Possible Open Redirect Vulnerability in Action Pack
  There is a possible Open Redirect Vulnerability in Action Pack. This
  vulnerability has been assigned the CVE identifier CVE-2021-22903.

  Versions Affected:  >= v6.1.0.rc2
  Not affected:       < v6.1.0.rc2
  Fixed Versions:     6.1.3.2

  Impact
  ------
  This is similar to CVE-2021-22881: Specially crafted Host headers in
  combination with certain "allowed host" formats can cause the Host
  Authorization middleware in Action Pack to redirect users to a malicious
  website.

  Since rails/rails@9bc7ea5, strings in config.hosts that do not have a leading
  dot are converted to regular expressions without proper escaping. This causes,
  for example, config.hosts << "sub.example.com" to permit a request with a Host
  header value of sub-example.com.

  Workarounds
  -----------
  The following monkey patch put in an initializer can be used as a workaround:

  ```ruby
  class ActionDispatch::HostAuthorization::Permissions
    def sanitize_string(host)
      if host.start_with?(".")
        /\A(.+\.)?#{Regexp.escape(host[1..-1])}\z/i
      else
        /\A#{Regexp.escape host}\z/i
      end
    end
  end
  ```
impacted_packages:
  - purl: pkg:gem/actionpack
    affected_versions: vers:gem/>=6.1.0.rc2
    fixed_versions:
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/actionpack
    affected_versions:
    fixed_versions: vers:gem/>=6.1.3.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '6.1'
    scoring_system: cvssv3
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://groups.google.com/g/rubyonrails-security/c/8TxqXEtgSF0
    reference_type:
    reference_id:
