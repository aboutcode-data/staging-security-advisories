advisory_id: gems/actionpack/CVE-2021-22904
datasource_id: ruby_importer_v2/gems/actionpack/CVE-2021-22904
datasource_url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/actionpack/CVE-2021-22904.yml
aliases:
  - CVE-2021-22904
  - GHSA-7wjx-3g7j-8584
summary: |
  Possible DoS Vulnerability in Action Controller Token Authentication
  There is a possible DoS vulnerability in the Token Authentication logic in
  Action Controller.  This vulnerability has been assigned the CVE identifier
  CVE-2021-22904.

  Versions Affected:  >= 4.0.0
  Not affected:       < 4.0.0
  Fixed Versions:     6.1.3.2, 6.0.3.7, 5.2.4.6, 5.2.6

  Impact
  ------
  Impacted code uses `authenticate_or_request_with_http_token` or
  `authenticate_with_http_token` for request authentication.  Impacted code will
  look something like this:

  ```
  class PostsController < ApplicationController
    before_action :authenticate

    private

    def authenticate
      authenticate_or_request_with_http_token do |token, options|
        # ...
      end
    end
  end
  ```

  All users running an affected release should either upgrade or use one of the
  workarounds immediately.

  Releases
  --------
  The fixed releases are available at the normal locations.

  Workarounds
  -----------
  The following monkey patch placed in an initializer can be used to work around
  the issue:

  ```ruby
  module ActionController::HttpAuthentication::Token
    AUTHN_PAIR_DELIMITERS = /(?:,|;|\t)/
  end
  ```
impacted_packages:
  - purl: pkg:gem/actionpack
    affected_versions: vers:gem/>=4.0.0
    fixed_versions:
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/actionpack
    affected_versions:
    fixed_versions: vers:gem/>=5.2.4.6|<5.2.5
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/actionpack
    affected_versions:
    fixed_versions: vers:gem/>=5.2.6|<5.3
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/actionpack
    affected_versions:
    fixed_versions: vers:gem/>=6.1.3.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.5'
    scoring_system: cvssv3
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://groups.google.com/g/rubyonrails-security/c/Pf1TjkOBdyQ
    reference_type:
    reference_id:
