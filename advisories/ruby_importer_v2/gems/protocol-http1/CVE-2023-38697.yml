advisory_id: gems/protocol-http1/CVE-2023-38697
datasource_id: ruby_importer_v2/gems/protocol-http1/CVE-2023-38697
datasource_url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/protocol-http1/CVE-2023-38697.yml
aliases:
  - CVE-2023-38697
  - GHSA-6jwc-qr2q-7xwj
summary: |
  protocol-http1 HTTP Request/Response Smuggling vulnerability
  ### Impact

  [RFC 9112 Section 7.1](https://www.rfc-editor.org/rfc/rfc9112#name-chunked-transfer-coding)
  defined the format of chunk size, chunk data and chunk
  extension (detailed ABNF is in Appendix section).

  In summary:

  - The value of Content-Length header should be a string of 0-9 digits.
  - The chunk size should be a string of hex digits and should split
     from chunk data using CRLF.
  - The chunk extension shouldn't contain any invisible character.

  However, we found that Falcon has following behaviors while
  disobey the corresponding RFCs.

  - Falcon accepts Content-Length header values that have "+" prefix.
  - Falcon accepts Content-Length header values that written in
    hexadecimal with "0x" prefix.
  - Falcon accepts "0x" and "+" prefixed chunk size.
  - Falcon accepts LF in chunk extension.

  This behavior can lead to desync when forwarding through multiple
  HTTP parsers, potentially results in HTTP request smuggling and
  firewall bypassing. Note that while these issues were reproduced
  in Falcon (the server), the issue is with `protocol-http1` which
  implements the HTTP/1 protocol parser. We have not yet been advised
  of any real world exploit or practical attack.

  ### Patches

  Fixed in `protocol-http1` v0.15.1+.

  ### Workarounds

  No.

  ### References

  https://github.com/socketry/protocol-http1/pull/20
impacted_packages:
  - purl: pkg:gem/protocol-http1
    affected_versions:
    fixed_versions: vers:gem/>=0.15.1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '5.8'
    scoring_system: cvssv3
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://github.com/socketry/protocol-http1/security/advisories/GHSA-6jwc-qr2q-7xwj
    reference_type:
    reference_id:
