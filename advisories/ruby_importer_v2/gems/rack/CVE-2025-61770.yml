advisory_id: gems/rack/CVE-2025-61770
datasource_id: ruby_importer_v2/gems/rack/CVE-2025-61770
datasource_url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/rack/CVE-2025-61770.yml
aliases:
  - CVE-2025-61770
  - GHSA-p543-xpfm-54cp
summary: |
  Rack's unbounded multipart preamble buffering enables DoS (memory exhaustion)
  ## Summary

  `Rack::Multipart::Parser` buffers the entire multipart **preamble**
  (bytes before the first boundary) in memory without any size limit.
  A client can send a large preamble followed by a valid boundary,
  causing significant memory use and potential process termination
  due to out-of-memory (OOM) conditions.

  ## Details

  While searching for the first boundary, the parser appends incoming
  data into a shared buffer (`@sbuf.concat(content)`) and scans for
  the boundary pattern:

  ```ruby
  @sbuf.scan_until(@body_regex)
  ```

  If the boundary is not yet found, the parser continues buffering
  data indefinitely. There is no trimming or size cap on the preamble,
  allowing attackers to send arbitrary amounts of data before the
  first boundary.

  ## Impact

  Remote attackers can trigger large transient memory spikes by
  including a long preamble in multipart/form-data requests. The
  impact scales with allowed request sizes and concurrency, potentially
  causing worker crashes or severe slowdown due to garbage collection.

  ## Mitigation

  * **Upgrade:** Use a patched version of Rack that enforces a preamble
  size limit (e.g., 16 KiB) or discards preamble data entirely per
  [RFC 2046 ยง 5.1.1](https://www.rfc-editor.org/rfc/rfc2046.html#section-5.1.1).

  * **Workarounds:**
    * Limit total request body size at the proxy or web server level.
    * Monitor memory and set per-process limits to prevent OOM conditions.
impacted_packages:
  - purl: pkg:gem/rack
    affected_versions:
    fixed_versions: vers:gem/>=2.2.19|<2.3
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/rack
    affected_versions:
    fixed_versions: vers:gem/>=3.1.17|<3.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/rack
    affected_versions:
    fixed_versions: vers:gem/>=3.2.2
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.5'
    scoring_system: cvssv3
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://github.com/rack/rack/security/advisories/GHSA-p543-xpfm-54cp
    reference_type:
    reference_id:
