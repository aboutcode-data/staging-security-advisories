advisory_id: gems/rack/CVE-2020-8184
datasource_id: ruby_importer_v2/gems/rack/CVE-2020-8184
datasource_url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/rack/CVE-2020-8184.yml
aliases:
  - CVE-2020-8184
  - GHSA-j6w9-fv6q-3q52
summary: |
  Percent-encoded cookies can be used to overwrite existing prefixed cookie names
  It is possible to forge a secure or host-only cookie prefix in Rack using
  an arbitrary cookie write by using URL encoding (percent-encoding) on the
  name of the cookie. This could result in an application that is dependent on
  this prefix to determine if a cookie is safe to process being manipulated
  into processing an insecure or cross-origin request.
  This vulnerability has been assigned the CVE identifier CVE-2020-8184.

  Versions Affected:  rack < 2.2.3, rack < 2.1.4
  Not affected:       Applications which do not rely on __Host- and __Secure- prefixes to determine if a cookie is safe to process
  Fixed Versions:     rack >= 2.2.3, rack >= 2.1.4

  Impact
  ------

  An attacker may be able to trick a vulnerable application into processing an
  insecure (non-SSL) or cross-origin request if they can gain the ability to write
  arbitrary cookies that are sent to the application.

  Workarounds
  -----------

  If your application is impacted but you cannot upgrade to the released versions or apply
  the provided patch, this issue can be temporarily addressed by adding the following workaround:

  ```
  module Rack
    module Utils
      module_function def parse_cookies_header(header)
        return {} unless header
        header.split(/[;] */n).each_with_object({}) do |cookie, cookies|
          next if cookie.empty?
          key, value = cookie.split('=', 2)
          cookies[key] = (unescape(value) rescue value) unless cookies.key?(key)
        end
      end
    end
  end
  ```
impacted_packages:
  - purl: pkg:gem/rack
    affected_versions:
    fixed_versions: vers:gem/>=2.1.4|<2.2
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/rack
    affected_versions:
    fixed_versions: vers:gem/>=2.2.3
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.5'
    scoring_system: cvssv3
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://groups.google.com/g/rubyonrails-security/c/OWtmozPH9Ak
    reference_type:
    reference_id:
