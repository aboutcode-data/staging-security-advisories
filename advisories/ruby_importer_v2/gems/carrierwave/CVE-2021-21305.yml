advisory_id: gems/carrierwave/CVE-2021-21305
datasource_id: ruby_importer_v2/gems/carrierwave/CVE-2021-21305
datasource_url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/carrierwave/CVE-2021-21305.yml
aliases:
  - CVE-2021-21305
  - GHSA-cf3w-g86h-35x4
summary: |
  Code Injection vulnerability in CarrierWave::RMagick
  ### Impact
  [CarrierWave::RMagick](https://github.com/carrierwaveuploader/carrierwave/blob/master/lib/carrierwave/processing/rmagick.rb)
  has a Code Injection vulnerability. Its `#manipulate!` method inappropriately evals the content of mutation
  option(`:read`/`:write`), allowing attackers to craft a string that can be executed as a Ruby code.
  If an application developer supplies untrusted inputs to the option, it will lead to remote code execution(RCE).

  (But supplying untrusted input to the option itself is dangerous even in absence of this vulnerability, since is prone to
  DoS vulnerability - attackers can try to consume massive amounts of memory by resizing to a very large dimension)

  ### Proof of Concept
  ```ruby
  class MyUploader < CarrierWave::Uploader::Base
    include CarrierWave::RMagick
  end

  MyUploader.new.manipulate!({ read: { density: "1 }; p 'Hacked'; {" }}) # => shows "Hacked"
  ```

  ### Patches
  Upgrade to [2.1.1](https://rubygems.org/gems/carrierwave/versions/2.1.1) or
  [1.3.2](https://rubygems.org/gems/carrierwave/versions/1.3.2).

  ### Workarounds
  Stop supplying untrusted input to `#manipulate!`'s mutation option.
impacted_packages:
  - purl: pkg:gem/carrierwave
    affected_versions:
    fixed_versions: vers:gem/>=1.3.2|<1.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/carrierwave
    affected_versions:
    fixed_versions: vers:gem/>=2.1.1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.4'
    scoring_system: cvssv3
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://github.com/carrierwaveuploader/carrierwave/security/advisories/GHSA-cf3w-g86h-35x4
    reference_type:
    reference_id:
