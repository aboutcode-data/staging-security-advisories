advisory_id: gems/secure_headers/CVE-2020-5217
datasource_id: ruby_importer_v2/gems/secure_headers/CVE-2020-5217
datasource_url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/secure_headers/CVE-2020-5217.yml
aliases:
  - CVE-2020-5217
  - GHSA-xq52-rv6w-397c
summary: |
  secure_headers directive injection using semicolon
  If user-supplied input was passed into append/override_content_security_policy_directives,
  a semicolon could be injected leading to directive injection.

  This could be used to e.g. override a script-src directive. Duplicate directives are ignored
  and the first one wins. The directives in secure_headers are sorted alphabetically so they
  pretty much all come before script-src. A previously undefined directive would receive a value
  even if SecureHeaders::OPT_OUT was supplied.

  The fixed versions will silently convert the semicolons to spaces and emit a deprecation warning
  when this happens. This will result in innocuous browser console messages if being
  exploited/accidentally used. In future releases, we will raise application errors resulting in
  500s.

  > Duplicate script-src directives detected. All but the first instance will be ignored.

  See https://www.w3.org/TR/CSP3/#parse-serialized-policy

  > Note: In this case, the user agent SHOULD notify developers that a duplicate directive was
  > ignored. A console warning might be appropriate, for example.

  # Workarounds

  If you are passing user input into the above methods, you could filter out the input:

  ```
  override_content_security_policy_directives(:frame_src, [user_input.gsub(";", " ")])
  ```
impacted_packages:
  - purl: pkg:gem/secure_headers
    affected_versions:
    fixed_versions: vers:gem/>=3.8|<4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/secure_headers
    affected_versions:
    fixed_versions: vers:gem/>=5.1|<6
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/secure_headers
    affected_versions:
    fixed_versions: vers:gem/>=6.2.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '4.4'
    scoring_system: cvssv3
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://github.com/twitter/secure_headers/security/advisories/GHSA-xq52-rv6w-397c
    reference_type:
    reference_id:
