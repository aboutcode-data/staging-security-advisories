advisory_id: gems/avo/CVE-2023-34102
datasource_id: ruby_importer_v2/gems/avo/CVE-2023-34102
datasource_url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/avo/CVE-2023-34102.yml
aliases:
  - CVE-2023-34102
  - GHSA-86h2-2g4g-29qx
summary: |
  avo possible unsafe reflection / partial DoS vulnerability
  ### Summary

  The polymorphic field type stores the classes to operate on when updating
  a record with user input, and does not validate them in the back end.
  This can lead to unexpected behavior, remote code execution, or
  application crashes when viewing a manipulated record.

  ### Details

  After reviewing the polymorphic field implementation and performing
  some black box approaches, we identified a potential security issue
  related to the use of safe_constantize / constantize. This Rails
  functionality is capable of searching for classes within the Rails
  context and returning the class for further use. Because Avo does
  not validate user input when updating or creating a new polymorphic
  resource, it is possible to create database entries with completely
  different or invalid class names than the preselected ones. Avo
  assumes that the class specified by the user request is a valid one
  and attempts to work with it, which may result in dangerous behavior
  and code execution.

  ### Impact

  The final exploitation of this vulnerability requires more time than
  is provided in this assessment, but initial testing of the post request
  shows the potential critical risk. The classes could be instantiated
  at any point in the code and this could also lead to code execution.

  ### Recommendation

  Avo should be configured to never trust user-supplied input, especially
  when defining classes for records. In this particular case, Avo can
  evaluate the options list given for the polymorphic field and only allow
  strings from that list. With this white-list approach, an attacker
  cannot supply unintended classes.
impacted_packages:
  - purl: pkg:gem/avo
    affected_versions:
    fixed_versions: vers:gem/>=2.33.3
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '8.3'
    scoring_system: cvssv3
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://github.com/avo-hq/avo/security/advisories/GHSA-86h2-2g4g-29qx
    reference_type:
    reference_id:
