advisory_id: gems/solidus_auth_devise/CVE-2021-41274
datasource_id: ruby_importer_v2/gems/solidus_auth_devise/CVE-2021-41274
datasource_url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/solidus_auth_devise/CVE-2021-41274.yml
aliases:
  - CVE-2021-41274
  - GHSA-xm34-v85h-9pg2
summary: |
  Authentication Bypass by CSRF Weakness
  ### Impact
  CSRF vulnerability that allows user account takeover.

  All applications using any version of the frontend component of `solidus_auth_devise`
  are affected if `protect_from_forgery` method is both:
  - Executed whether as:
    - A `before_action` callback (the default)
    - A `prepend_before_action` (option `prepend: true` given) before the
      `:load_object` hook in `Spree::UserController` (most likely order to find).
  - Configured to use `:null_session` or `:reset_session` strategies
    (`:null_session` is the default in case the no strategy is given, but
    `rails --new` generated skeleton use `:exception`).

  That means that applications that haven't been configured differently from
  what it's generated with Rails aren't affected.

  ### Patches
  Users should promptly update to `solidus_auth_devise` version `2.5.4`.

  ### Workarounds
  A couple of options:

  - If possible, change your strategy to `:exception`:
    ```ruby
    class ApplicationController < ActionController::Base

       protect_from_forgery with: :exception
    end
    ```

  - Add the following to `config/application.rb` to at least run the `:exception`
    strategy on the affected controller:
    ```ruby
    config.after_initialize do
      Spree::UsersController.protect_from_forgery
    with: :exception
    end
    ```

  - We've also released new Solidus versions monkey patching `solidus_auth_devise`
    with the quick fix. Those versions are `v3.1.3`, `v.3.0.3` & `v2.11.12`. See
    [GHSA-5629-8855-gf4g](https://github.com/solidusio/solidus/security/advisories/GHSA-5629-8855-gf4g)
    for details.

  ### References
  - [CSRF on the Rails guides](https://guides.rubyonrails.org/security.html#cross-site-request-forgery-csrf)
  - [Solidus security](https://solidus.io/security/)
impacted_packages:
  - purl: pkg:gem/solidus_auth_devise
    affected_versions: vers:gem/>=1.0.0
    fixed_versions:
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/solidus_auth_devise
    affected_versions:
    fixed_versions: vers:gem/>=2.5.4
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '9.3'
    scoring_system: cvssv3
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://github.com/solidusio/solidus_auth_devise/security/advisories/GHSA-xm34-v85h-9pg2
    reference_type:
    reference_id:
