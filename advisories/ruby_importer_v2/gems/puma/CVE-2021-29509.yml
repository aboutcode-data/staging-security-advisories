advisory_id: gems/puma/CVE-2021-29509
datasource_id: ruby_importer_v2/gems/puma/CVE-2021-29509
datasource_url: https://github.com/rubysec/ruby-advisory-db/blob/master/gems/puma/CVE-2021-29509.yml
aliases:
  - CVE-2021-29509
  - GHSA-q28m-8xjw-8vr5
summary: |
  Keepalive Connections Causing Denial Of Service in puma
  ### Impact

  The fix for CVE-2019-16770 was incomplete. The original fix only protected
  existing connections that had already been accepted from having their
  requests starved by greedy persistent-connections saturating all threads in
  the same process. However, new connections may still be starved by greedy
  persistent-connections saturating all threads in all processes in the
  cluster.

  A puma server which received more concurrent keep-alive connections than the
  server had threads in its threadpool would service only a subset of
  connections, denying service to the unserved connections.

  ### Patches

  This problem has been fixed in puma 4.3.8 and 5.3.1.

  ### Workarounds

  Setting queue_requests false also fixes the issue. This is not advised when
  using puma without a reverse proxy, such as nginx or apache, because you will
  open yourself to slow client attacks (e.g. [slowloris][1]).

  The fix is very small. [A git patch is available here][2] for those using
  [unsupported versions][3] of Puma.

  [1]: https://en.wikipedia.org/wiki/Slowloris_(computer_security)
  [2]: https://gist.github.com/nateberkopec/4b3ea5676c0d70cbb37c82d54be25837
  [3]: https://github.com/puma/puma/security/policy#supported-versions
impacted_packages:
  - purl: pkg:gem/puma
    affected_versions:
    fixed_versions: vers:gem/>=4.3.8|<4.4
    fixed_in_commits: []
    introduced_in_commits: []
  - purl: pkg:gem/puma
    affected_versions:
    fixed_versions: vers:gem/>=5.3.1
    fixed_in_commits: []
    introduced_in_commits: []
severities:
  - score: '7.5'
    scoring_system: cvssv3
    scoring_elements:
    published_at: None
    url:
weaknesses: []
references:
  - url: https://github.com/puma/puma/security/advisories/GHSA-q28m-8xjw-8vr5
    reference_type:
    reference_id:
