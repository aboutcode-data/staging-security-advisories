advisory_id: CVE-2013-2212
datasource_id: collect_xen_project_fix_commits/CVE-2013-2212
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  2fff2e22813d5c04effa335f9ab2d5254db065f6:x86/vmx: Add force-ept command line option

  Add a "force-ept" command line option to allow EPT to be enabled when
  VMX feature VM_ENTRY_LOAD_GUEST_PAT is not present.

  Due to CVE-2013-2212, this feature is required by default as a
  prerequisite for using EPT. If you are not using PCI Passthrough, or
  trust the guest administrator who would be using passthrough, then the
  requirement can be relaxed. This option is particularly useful for
  nested virtualization, to allow the L1 hypervisor to use EPT even if
  the L0 hypervisor does not provide VM_ENTRY_LOAD_GUEST_PAT.

  Signed-off-by: Aravindh Puthiyaparambil <aravindp@cisco.com>
  Acked-by: Kevin Tian <kevin.tian@intel.com>
  684b40eb41c3d5eba55ad94b36fa3702c7720fe1:VMX: fix cr0.cd handling

  This patch solves XSA-60 security hole:
  1. For guest w/o VT-d, and for guest with VT-d but snooped, Xen need
  do nothing, since hardware snoop mechanism has ensured cache coherency.

  2. For guest with VT-d but non-snooped, cache coherency can not be
  guaranteed by h/w snoop, therefore it need emulate UC type to guest:
  2.1). if it works w/ Intel EPT, set guest IA32_PAT fields as UC so that
  guest memory type are all UC.
  2.2). if it works w/ shadow, drop all shadows so that any new ones would
  be created on demand w/ UC.

  This patch also fix a bug of shadow cr0.cd setting. Current shadow has a
  small window between cache flush and TLB invalidation, resulting in possilbe
  cache pollution. This patch pause vcpus so that no vcpus context involved
  into the window.

  This is CVE-2013-2212 / XSA-60.

  Signed-off-by: Liu Jinsong <jinsong.liu@intel.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jun Nakajima <jun.nakajima@intel.com>
  Acked-by: Keir Fraser <keir@xen.org>
  master commit: 62652c00efa55fb45374bcc92f7d96fc411aebb2
  master date: 2013-11-06 10:12:36 +0100
  8829f8e3a6aff06f800c32841418afe98f0825bb:VMX: remove the problematic set_uc_mode logic

  XSA-60 security hole comes from the problematic vmx_set_uc_mode.
  This patch remove vmx_set_uc_mode logic, which will be replaced by
  PAT approach at later patch.

  This is CVE-2013-2212 / XSA-60.

  Signed-off-by: Liu Jinsong <jinsong.liu@intel.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  Acked-by: Jun Nakajima <jun.nakajima@intel.com>
  master commit: 1c84d046735102e02d2df454ab07f14ac51f235d
  master date: 2013-11-06 10:12:00 +0100
  649e7ae0df99ffb5bccc17b4cb139c46ce2359a2:VMX: disable EPT when !cpu_has_vmx_pat

  Recently Oracle developers found a Xen security issue as DOS affecting,
  named as XSA-60. Please refer http://xenbits.xen.org/xsa/advisory-60.html
  Basically it involves how to handle guest cr0.cd setting, which under
  some environment it consumes much time resulting in DOS-like behavior.

  This is a preparing patch for fixing XSA-60. Later patch will fix XSA-60
  via PAT under Intel EPT case, which depends on cpu_has_vmx_pat.

  This is CVE-2013-2212 / XSA-60.

  Signed-off-by: Liu Jinsong <jinsong.liu@intel.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  Acked-by: Jun Nakajima <jun.nakajima@intel.com>
  master commit: c13b0d65ddedd74508edef5cd66defffe30468fc
  master date: 2013-11-06 10:11:18 +0100
  0fffcffeb594741d5027c8c0d05900b951f997b2:VMX: fix cr0.cd handling

  This patch solves XSA-60 security hole:
  1. For guest w/o VT-d, and for guest with VT-d but snooped, Xen need
  do nothing, since hardware snoop mechanism has ensured cache coherency.

  2. For guest with VT-d but non-snooped, cache coherency can not be
  guaranteed by h/w snoop, therefore it need emulate UC type to guest:
  2.1). if it works w/ Intel EPT, set guest IA32_PAT fields as UC so that
  guest memory type are all UC.
  2.2). if it works w/ shadow, drop all shadows so that any new ones would
  be created on demand w/ UC.

  This patch also fix a bug of shadow cr0.cd setting. Current shadow has a
  small window between cache flush and TLB invalidation, resulting in possilbe
  cache pollution. This patch pause vcpus so that no vcpus context involved
  into the window.

  This is CVE-2013-2212 / XSA-60.

  Signed-off-by: Liu Jinsong <jinsong.liu@intel.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jun Nakajima <jun.nakajima@intel.com>
  Acked-by: Keir Fraser <keir@xen.org>
  master commit: 62652c00efa55fb45374bcc92f7d96fc411aebb2
  master date: 2013-11-06 10:12:36 +0100
  644e6c5c7106d276fb750daf6e07de0034b2e76a:VMX: remove the problematic set_uc_mode logic

  XSA-60 security hole comes from the problematic vmx_set_uc_mode.
  This patch remove vmx_set_uc_mode logic, which will be replaced by
  PAT approach at later patch.

  This is CVE-2013-2212 / XSA-60.

  Signed-off-by: Liu Jinsong <jinsong.liu@intel.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  Acked-by: Jun Nakajima <jun.nakajima@intel.com>
  master commit: 1c84d046735102e02d2df454ab07f14ac51f235d
  master date: 2013-11-06 10:12:00 +0100
  f1e0df14412ccc6933a68eda66ac5b7d89186b62:VMX: disable EPT when !cpu_has_vmx_pat

  Recently Oracle developers found a Xen security issue as DOS affecting,
  named as XSA-60. Please refer http://xenbits.xen.org/xsa/advisory-60.html
  Basically it involves how to handle guest cr0.cd setting, which under
  some environment it consumes much time resulting in DOS-like behavior.

  This is a preparing patch for fixing XSA-60. Later patch will fix XSA-60
  via PAT under Intel EPT case, which depends on cpu_has_vmx_pat.

  This is CVE-2013-2212 / XSA-60.

  Signed-off-by: Liu Jinsong <jinsong.liu@intel.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  Acked-by: Jun Nakajima <jun.nakajima@intel.com>
  master commit: c13b0d65ddedd74508edef5cd66defffe30468fc
  master date: 2013-11-06 10:11:18 +0100
  064275dcfb6002dc4327ba94b6bd758806735538:VMX: fix cr0.cd handling

  This patch solves XSA-60 security hole:
  1. For guest w/o VT-d, and for guest with VT-d but snooped, Xen need
  do nothing, since hardware snoop mechanism has ensured cache coherency.

  2. For guest with VT-d but non-snooped, cache coherency can not be
  guaranteed by h/w snoop, therefore it need emulate UC type to guest:
  2.1). if it works w/ Intel EPT, set guest IA32_PAT fields as UC so that
  guest memory type are all UC.
  2.2). if it works w/ shadow, drop all shadows so that any new ones would
  be created on demand w/ UC.

  This patch also fix a bug of shadow cr0.cd setting. Current shadow has a
  small window between cache flush and TLB invalidation, resulting in possilbe
  cache pollution. This patch pause vcpus so that no vcpus context involved
  into the window.

  This is CVE-2013-2212 / XSA-60.

  Signed-off-by: Liu Jinsong <jinsong.liu@intel.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jun Nakajima <jun.nakajima@intel.com>
  Acked-by: Keir Fraser <keir@xen.org>
  master commit: 62652c00efa55fb45374bcc92f7d96fc411aebb2
  master date: 2013-11-06 10:12:36 +0100
  e81d0ac25464825b3828cff5dc9e8285612992c4:VMX: remove the problematic set_uc_mode logic

  XSA-60 security hole comes from the problematic vmx_set_uc_mode.
  This patch remove vmx_set_uc_mode logic, which will be replaced by
  PAT approach at later patch.

  This is CVE-2013-2212 / XSA-60.

  Signed-off-by: Liu Jinsong <jinsong.liu@intel.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  Acked-by: Jun Nakajima <jun.nakajima@intel.com>
  master commit: 1c84d046735102e02d2df454ab07f14ac51f235d
  master date: 2013-11-06 10:12:00 +0100
  72380ecbcd9f870db1c60e698c9df71bdea6d819:VMX: disable EPT when !cpu_has_vmx_pat

  Recently Oracle developers found a Xen security issue as DOS affecting,
  named as XSA-60. Please refer http://xenbits.xen.org/xsa/advisory-60.html
  Basically it involves how to handle guest cr0.cd setting, which under
  some environment it consumes much time resulting in DOS-like behavior.

  This is a preparing patch for fixing XSA-60. Later patch will fix XSA-60
  via PAT under Intel EPT case, which depends on cpu_has_vmx_pat.

  This is CVE-2013-2212 / XSA-60.

  Signed-off-by: Liu Jinsong <jinsong.liu@intel.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  Acked-by: Jun Nakajima <jun.nakajima@intel.com>
  master commit: c13b0d65ddedd74508edef5cd66defffe30468fc
  master date: 2013-11-06 10:11:18 +0100
  86d60e855fe118df0dbdf67b67b1a0ec8fdb9f0d:VMX: flush cache when vmentry back to UC guest

  This patch flush cache when vmentry back to UC guest, to prevent
  cache polluted by hypervisor access guest memory during UC mode.

  The elegant way to do this is, simply add wbinvd just before vmentry.
  However, currently wbinvd before vmentry will mysteriously trigger
  lapic timer interrupt storm, hung booting stage for 10s ~ 60s. We still
  didn't dig out the root cause of interrupt storm, so currently this
  patch add flag indicating hypervisor access UC guest memory to prevent
  interrupt storm -- though it still leaves aspects un-addressed, i.e.
  speculative reads, and multi-vCPU issues, etc.

  Whenever the interrupt storm got root caused and fixed, the protection
  flag can be removed -- that would be final clean and elegant approach
  dealing with cache flushing before vmentry.

  This is CVE-2013-2212 / XSA-60.

  Suggested-by: Jan Beulich <jbeulich@suse.com>
  Suggested-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Signed-off-by: Liu Jinsong <jinsong.liu@intel.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Acked-by: Jun Nakajima <jun.nakajima@intel.com>
  62652c00efa55fb45374bcc92f7d96fc411aebb2:VMX: fix cr0.cd handling

  This patch solves XSA-60 security hole:
  1. For guest w/o VT-d, and for guest with VT-d but snooped, Xen need
  do nothing, since hardware snoop mechanism has ensured cache coherency.

  2. For guest with VT-d but non-snooped, cache coherency can not be
  guaranteed by h/w snoop, therefore it need emulate UC type to guest:
  2.1). if it works w/ Intel EPT, set guest IA32_PAT fields as UC so that
  guest memory type are all UC.
  2.2). if it works w/ shadow, drop all shadows so that any new ones would
  be created on demand w/ UC.

  This patch also fix a bug of shadow cr0.cd setting. Current shadow has a
  small window between cache flush and TLB invalidation, resulting in possilbe
  cache pollution. This patch pause vcpus so that no vcpus context involved
  into the window.

  This is CVE-2013-2212 / XSA-60.

  Signed-off-by: Liu Jinsong <jinsong.liu@intel.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jun Nakajima <jun.nakajima@intel.com>
  Acked-by: Keir Fraser <keir@xen.org>
  1c84d046735102e02d2df454ab07f14ac51f235d:VMX: remove the problematic set_uc_mode logic

  XSA-60 security hole comes from the problematic vmx_set_uc_mode.
  This patch remove vmx_set_uc_mode logic, which will be replaced by
  PAT approach at later patch.

  This is CVE-2013-2212 / XSA-60.

  Signed-off-by: Liu Jinsong <jinsong.liu@intel.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  Acked-by: Jun Nakajima <jun.nakajima@intel.com>
  c13b0d65ddedd74508edef5cd66defffe30468fc:VMX: disable EPT when !cpu_has_vmx_pat

  Recently Oracle developers found a Xen security issue as DOS affecting,
  named as XSA-60. Please refer http://xenbits.xen.org/xsa/advisory-60.html
  Basically it involves how to handle guest cr0.cd setting, which under
  some environment it consumes much time resulting in DOS-like behavior.

  This is a preparing patch for fixing XSA-60. Later patch will fix XSA-60
  via PAT under Intel EPT case, which depends on cpu_has_vmx_pat.

  This is CVE-2013-2212 / XSA-60.

  Signed-off-by: Liu Jinsong <jinsong.liu@intel.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  Acked-by: Jun Nakajima <jun.nakajima@intel.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 62652c00efa55fb45374bcc92f7d96fc411aebb2
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: f1e0df14412ccc6933a68eda66ac5b7d89186b62
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 0fffcffeb594741d5027c8c0d05900b951f997b2
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 2fff2e22813d5c04effa335f9ab2d5254db065f6
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 684b40eb41c3d5eba55ad94b36fa3702c7720fe1
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 86d60e855fe118df0dbdf67b67b1a0ec8fdb9f0d
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 8829f8e3a6aff06f800c32841418afe98f0825bb
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 064275dcfb6002dc4327ba94b6bd758806735538
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 1c84d046735102e02d2df454ab07f14ac51f235d
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: c13b0d65ddedd74508edef5cd66defffe30468fc
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 72380ecbcd9f870db1c60e698c9df71bdea6d819
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: e81d0ac25464825b3828cff5dc9e8285612992c4
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 644e6c5c7106d276fb750daf6e07de0034b2e76a
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 649e7ae0df99ffb5bccc17b4cb139c46ce2359a2
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/064275dcfb6002dc4327ba94b6bd758806735538
    reference_type: commit
    reference_id: 064275dcfb6002dc4327ba94b6bd758806735538
  - url: https://github.com/xen-project/xen/tree/0fffcffeb594741d5027c8c0d05900b951f997b2
    reference_type: commit
    reference_id: 0fffcffeb594741d5027c8c0d05900b951f997b2
  - url: https://github.com/xen-project/xen/tree/1c84d046735102e02d2df454ab07f14ac51f235d
    reference_type: commit
    reference_id: 1c84d046735102e02d2df454ab07f14ac51f235d
  - url: https://github.com/xen-project/xen/tree/2fff2e22813d5c04effa335f9ab2d5254db065f6
    reference_type: commit
    reference_id: 2fff2e22813d5c04effa335f9ab2d5254db065f6
  - url: https://github.com/xen-project/xen/tree/62652c00efa55fb45374bcc92f7d96fc411aebb2
    reference_type: commit
    reference_id: 62652c00efa55fb45374bcc92f7d96fc411aebb2
  - url: https://github.com/xen-project/xen/tree/644e6c5c7106d276fb750daf6e07de0034b2e76a
    reference_type: commit
    reference_id: 644e6c5c7106d276fb750daf6e07de0034b2e76a
  - url: https://github.com/xen-project/xen/tree/649e7ae0df99ffb5bccc17b4cb139c46ce2359a2
    reference_type: commit
    reference_id: 649e7ae0df99ffb5bccc17b4cb139c46ce2359a2
  - url: https://github.com/xen-project/xen/tree/684b40eb41c3d5eba55ad94b36fa3702c7720fe1
    reference_type: commit
    reference_id: 684b40eb41c3d5eba55ad94b36fa3702c7720fe1
  - url: https://github.com/xen-project/xen/tree/72380ecbcd9f870db1c60e698c9df71bdea6d819
    reference_type: commit
    reference_id: 72380ecbcd9f870db1c60e698c9df71bdea6d819
  - url: https://github.com/xen-project/xen/tree/86d60e855fe118df0dbdf67b67b1a0ec8fdb9f0d
    reference_type: commit
    reference_id: 86d60e855fe118df0dbdf67b67b1a0ec8fdb9f0d
  - url: https://github.com/xen-project/xen/tree/8829f8e3a6aff06f800c32841418afe98f0825bb
    reference_type: commit
    reference_id: 8829f8e3a6aff06f800c32841418afe98f0825bb
  - url: https://github.com/xen-project/xen/tree/c13b0d65ddedd74508edef5cd66defffe30468fc
    reference_type: commit
    reference_id: c13b0d65ddedd74508edef5cd66defffe30468fc
  - url: https://github.com/xen-project/xen/tree/e81d0ac25464825b3828cff5dc9e8285612992c4
    reference_type: commit
    reference_id: e81d0ac25464825b3828cff5dc9e8285612992c4
  - url: https://github.com/xen-project/xen/tree/f1e0df14412ccc6933a68eda66ac5b7d89186b62
    reference_type: commit
    reference_id: f1e0df14412ccc6933a68eda66ac5b7d89186b62
