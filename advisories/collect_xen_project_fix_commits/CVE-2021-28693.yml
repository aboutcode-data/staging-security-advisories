advisory_id: CVE-2021-28693
datasource_id: collect_xen_project_fix_commits/CVE-2021-28693
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  aa8866c1e0a92342166c2786ed4ae2455eb7ce61:xen/arm: Boot modules should always be scrubbed if bootscrub={on, idle}

  The function to initialize the pages (see init_heap_pages()) will request
  scrub when the admin request idle bootscrub (default) and state ==
  SYS_STATE_active. When bootscrub=on, Xen will scrub any free pages in
  heap_init_late().

  Currently, the boot modules (e.g. kernels, initramfs) will be discarded/
  freed after heap_init_late() is called and system_state switched to
  SYS_STATE_active. This means the pages associated with the boot modules
  will not get scrubbed before getting re-purposed.

  If the memory is assigned to an untrusted domU, it may be able to
  retrieve secrets from the modules.

  This is part of XSA-372 / CVE-2021-28693.

  Fixes: 1774e9b1df27 ("xen/arm: introduce create_domUs")
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Tested-by: Stefano Stabellini <sstabellini@kernel.org>
  (cherry picked from commit fd5dc41ceaed9cfcfa011cdfd50f264c89277a90)
  2c395704e6fedcb1d2dee71c59ce37259aaad3b9:xen/arm: Create dom0less domUs earlier

  In a follow-up patch we will need to unallocate the boot modules
  before heap_init_late() is called.

  The modules will contain the domUs kernel and initramfs. Therefore Xen
  will need to create extra domUs (used by dom0less) before heap_init_late().

  This has two consequences on dom0less:
      1) Domains will not be unpaused as soon as they are created but
      once all have been created. However, Xen doesn't guarantee an order
      to unpause, so this is not something one could rely on.

      2) The memory allocated for a domU will not be scrubbed anymore when an
      admin select bootscrub=on. This is not something we advertised, but if
      this is a concern we can introduce either force scrub for all domUs or
      a per-domain flag in the DT. The behavior for bootscrub=off and
      bootscrub=idle (default) has not changed.

  This is part of XSA-372 / CVE-2021-28693.

  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Tested-by: Stefano Stabellini <sstabellini@kernel.org>
  (cherry picked from commit 371347c5b64da699d9f5a0edda5dc496fd2b7a5c)
  def4352113d21acf4d49579c4ed3b86c6f2c922e:xen/arm: Boot modules should always be scrubbed if bootscrub={on, idle}

  The function to initialize the pages (see init_heap_pages()) will request
  scrub when the admin request idle bootscrub (default) and state ==
  SYS_STATE_active. When bootscrub=on, Xen will scrub any free pages in
  heap_init_late().

  Currently, the boot modules (e.g. kernels, initramfs) will be discarded/
  freed after heap_init_late() is called and system_state switched to
  SYS_STATE_active. This means the pages associated with the boot modules
  will not get scrubbed before getting re-purposed.

  If the memory is assigned to an untrusted domU, it may be able to
  retrieve secrets from the modules.

  This is part of XSA-372 / CVE-2021-28693.

  Fixes: 1774e9b1df27 ("xen/arm: introduce create_domUs")
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Tested-by: Stefano Stabellini <sstabellini@kernel.org>
  (cherry picked from commit fd5dc41ceaed9cfcfa011cdfd50f264c89277a90)
  95197d46f5e291b0bf12cf617e602bbc67fd633f:xen/arm: Create dom0less domUs earlier

  In a follow-up patch we will need to unallocate the boot modules
  before heap_init_late() is called.

  The modules will contain the domUs kernel and initramfs. Therefore Xen
  will need to create extra domUs (used by dom0less) before heap_init_late().

  This has two consequences on dom0less:
      1) Domains will not be unpaused as soon as they are created but
      once all have been created. However, Xen doesn't guarantee an order
      to unpause, so this is not something one could rely on.

      2) The memory allocated for a domU will not be scrubbed anymore when an
      admin select bootscrub=on. This is not something we advertised, but if
      this is a concern we can introduce either force scrub for all domUs or
      a per-domain flag in the DT. The behavior for bootscrub=off and
      bootscrub=idle (default) has not changed.

  This is part of XSA-372 / CVE-2021-28693.

  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Tested-by: Stefano Stabellini <sstabellini@kernel.org>
  (cherry picked from commit 371347c5b64da699d9f5a0edda5dc496fd2b7a5c)
  7053c8ea5dc88e0a3b6579d3bb61a242fcd5c499:xen/arm: Boot modules should always be scrubbed if bootscrub={on, idle}

  The function to initialize the pages (see init_heap_pages()) will request
  scrub when the admin request idle bootscrub (default) and state ==
  SYS_STATE_active. When bootscrub=on, Xen will scrub any free pages in
  heap_init_late().

  Currently, the boot modules (e.g. kernels, initramfs) will be discarded/
  freed after heap_init_late() is called and system_state switched to
  SYS_STATE_active. This means the pages associated with the boot modules
  will not get scrubbed before getting re-purposed.

  If the memory is assigned to an untrusted domU, it may be able to
  retrieve secrets from the modules.

  This is part of XSA-372 / CVE-2021-28693.

  Fixes: 1774e9b1df27 ("xen/arm: introduce create_domUs")
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Tested-by: Stefano Stabellini <sstabellini@kernel.org>
  (cherry picked from commit fd5dc41ceaed9cfcfa011cdfd50f264c89277a90)
  5caa690ea7e9dffa65a496424353c96af10f0308:xen/arm: Create dom0less domUs earlier

  In a follow-up patch we will need to unallocate the boot modules
  before heap_init_late() is called.

  The modules will contain the domUs kernel and initramfs. Therefore Xen
  will need to create extra domUs (used by dom0less) before heap_init_late().

  This has two consequences on dom0less:
      1) Domains will not be unpaused as soon as they are created but
      once all have been created. However, Xen doesn't guarantee an order
      to unpause, so this is not something one could rely on.

      2) The memory allocated for a domU will not be scrubbed anymore when an
      admin select bootscrub=on. This is not something we advertised, but if
      this is a concern we can introduce either force scrub for all domUs or
      a per-domain flag in the DT. The behavior for bootscrub=off and
      bootscrub=idle (default) has not changed.

  This is part of XSA-372 / CVE-2021-28693.

  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Tested-by: Stefano Stabellini <sstabellini@kernel.org>
  (cherry picked from commit 371347c5b64da699d9f5a0edda5dc496fd2b7a5c)
  70441846070ca5540e78b4a2d73a01458539ae90:xen/arm: Boot modules should always be scrubbed if bootscrub={on, idle}

  The function to initialize the pages (see init_heap_pages()) will request
  scrub when the admin request idle bootscrub (default) and state ==
  SYS_STATE_active. When bootscrub=on, Xen will scrub any free pages in
  heap_init_late().

  Currently, the boot modules (e.g. kernels, initramfs) will be discarded/
  freed after heap_init_late() is called and system_state switched to
  SYS_STATE_active. This means the pages associated with the boot modules
  will not get scrubbed before getting re-purposed.

  If the memory is assigned to an untrusted domU, it may be able to
  retrieve secrets from the modules.

  This is part of XSA-372 / CVE-2021-28693.

  Fixes: 1774e9b1df27 ("xen/arm: introduce create_domUs")
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Tested-by: Stefano Stabellini <sstabellini@kernel.org>
  (cherry picked from commit fd5dc41ceaed9cfcfa011cdfd50f264c89277a90)
  0a64b182db36b3b1c6f11c3b41d9b27fbbb8a5c6:xen/arm: Create dom0less domUs earlier

  In a follow-up patch we will need to unallocate the boot modules
  before heap_init_late() is called.

  The modules will contain the domUs kernel and initramfs. Therefore Xen
  will need to create extra domUs (used by dom0less) before heap_init_late().

  This has two consequences on dom0less:
      1) Domains will not be unpaused as soon as they are created but
      once all have been created. However, Xen doesn't guarantee an order
      to unpause, so this is not something one could rely on.

      2) The memory allocated for a domU will not be scrubbed anymore when an
      admin select bootscrub=on. This is not something we advertised, but if
      this is a concern we can introduce either force scrub for all domUs or
      a per-domain flag in the DT. The behavior for bootscrub=off and
      bootscrub=idle (default) has not changed.

  This is part of XSA-372 / CVE-2021-28693.

  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Tested-by: Stefano Stabellini <sstabellini@kernel.org>
  (cherry picked from commit 371347c5b64da699d9f5a0edda5dc496fd2b7a5c)
  fd5dc41ceaed9cfcfa011cdfd50f264c89277a90:xen/arm: Boot modules should always be scrubbed if bootscrub={on, idle}

  The function to initialize the pages (see init_heap_pages()) will request
  scrub when the admin request idle bootscrub (default) and state ==
  SYS_STATE_active. When bootscrub=on, Xen will scrub any free pages in
  heap_init_late().

  Currently, the boot modules (e.g. kernels, initramfs) will be discarded/
  freed after heap_init_late() is called and system_state switched to
  SYS_STATE_active. This means the pages associated with the boot modules
  will not get scrubbed before getting re-purposed.

  If the memory is assigned to an untrusted domU, it may be able to
  retrieve secrets from the modules.

  This is part of XSA-372 / CVE-2021-28693.

  Fixes: 1774e9b1df27 ("xen/arm: introduce create_domUs")
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Tested-by: Stefano Stabellini <sstabellini@kernel.org>
  371347c5b64da699d9f5a0edda5dc496fd2b7a5c:xen/arm: Create dom0less domUs earlier

  In a follow-up patch we will need to unallocate the boot modules
  before heap_init_late() is called.

  The modules will contain the domUs kernel and initramfs. Therefore Xen
  will need to create extra domUs (used by dom0less) before heap_init_late().

  This has two consequences on dom0less:
      1) Domains will not be unpaused as soon as they are created but
      once all have been created. However, Xen doesn't guarantee an order
      to unpause, so this is not something one could rely on.

      2) The memory allocated for a domU will not be scrubbed anymore when an
      admin select bootscrub=on. This is not something we advertised, but if
      this is a concern we can introduce either force scrub for all domUs or
      a per-domain flag in the DT. The behavior for bootscrub=off and
      bootscrub=idle (default) has not changed.

  This is part of XSA-372 / CVE-2021-28693.

  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Tested-by: Stefano Stabellini <sstabellini@kernel.org>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 70441846070ca5540e78b4a2d73a01458539ae90
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 5caa690ea7e9dffa65a496424353c96af10f0308
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 0a64b182db36b3b1c6f11c3b41d9b27fbbb8a5c6
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 95197d46f5e291b0bf12cf617e602bbc67fd633f
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: fd5dc41ceaed9cfcfa011cdfd50f264c89277a90
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: def4352113d21acf4d49579c4ed3b86c6f2c922e
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: aa8866c1e0a92342166c2786ed4ae2455eb7ce61
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 371347c5b64da699d9f5a0edda5dc496fd2b7a5c
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 2c395704e6fedcb1d2dee71c59ce37259aaad3b9
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 7053c8ea5dc88e0a3b6579d3bb61a242fcd5c499
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/0a64b182db36b3b1c6f11c3b41d9b27fbbb8a5c6
    reference_type: commit
    reference_id: 0a64b182db36b3b1c6f11c3b41d9b27fbbb8a5c6
  - url: https://github.com/xen-project/xen/tree/2c395704e6fedcb1d2dee71c59ce37259aaad3b9
    reference_type: commit
    reference_id: 2c395704e6fedcb1d2dee71c59ce37259aaad3b9
  - url: https://github.com/xen-project/xen/tree/371347c5b64da699d9f5a0edda5dc496fd2b7a5c
    reference_type: commit
    reference_id: 371347c5b64da699d9f5a0edda5dc496fd2b7a5c
  - url: https://github.com/xen-project/xen/tree/5caa690ea7e9dffa65a496424353c96af10f0308
    reference_type: commit
    reference_id: 5caa690ea7e9dffa65a496424353c96af10f0308
  - url: https://github.com/xen-project/xen/tree/70441846070ca5540e78b4a2d73a01458539ae90
    reference_type: commit
    reference_id: 70441846070ca5540e78b4a2d73a01458539ae90
  - url: https://github.com/xen-project/xen/tree/7053c8ea5dc88e0a3b6579d3bb61a242fcd5c499
    reference_type: commit
    reference_id: 7053c8ea5dc88e0a3b6579d3bb61a242fcd5c499
  - url: https://github.com/xen-project/xen/tree/95197d46f5e291b0bf12cf617e602bbc67fd633f
    reference_type: commit
    reference_id: 95197d46f5e291b0bf12cf617e602bbc67fd633f
  - url: https://github.com/xen-project/xen/tree/aa8866c1e0a92342166c2786ed4ae2455eb7ce61
    reference_type: commit
    reference_id: aa8866c1e0a92342166c2786ed4ae2455eb7ce61
  - url: https://github.com/xen-project/xen/tree/def4352113d21acf4d49579c4ed3b86c6f2c922e
    reference_type: commit
    reference_id: def4352113d21acf4d49579c4ed3b86c6f2c922e
  - url: https://github.com/xen-project/xen/tree/fd5dc41ceaed9cfcfa011cdfd50f264c89277a90
    reference_type: commit
    reference_id: fd5dc41ceaed9cfcfa011cdfd50f264c89277a90
