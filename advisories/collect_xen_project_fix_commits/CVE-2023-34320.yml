advisory_id: CVE-2023-34320
datasource_id: collect_xen_project_fix_commits/CVE-2023-34320
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  bd3ddaf6ee7fa312bd077305819105f84a34008d:xen/arm: Add Cortex-A77 erratum 1508412 handling

  Cortex-A77 cores (r0p0, r1p0) could deadlock on a sequence of a
  store-exclusive or read of PAR_EL1 and a load with device or non-cacheable
  memory attributes.
  A workaround is available, but it depends on a firmware counterpart.

  The proposed workaround from the errata document is to modify the software
  running at EL1 and above to include a DMB SY before and after accessing
  PAR_EL1.

  In conjunction to the above, the firmware needs to use a specific write
  sequence to several IMPLEMENTATION DEFINED registers to have the hardware
  insert a DMB SY after all load-exclusive and store-exclusive instructions.

  Apply the workaround to Xen where PAR_EL1 is read, implementing an helper
  function to do that.
  Since Xen can be interrupted by irqs in any moment, add a barrier on
  entry/exit when we are running on the affected cores.

  A guest without the workaround can deadlock the system, so warn the users
  of Xen with the above type of cores to use only trusted guests, by
  printing a message on Xen startup.

  This is XSA-436 / CVE-2023-34320.

  Signed-off-by: Luca Fancellu <luca.fancellu@arm.com>
  Reviewed-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
  87eaa43b30f8ffb600f8e6f765d5c7e4bcb241b9:xen/arm: Add Cortex-A77 erratum 1508412 handling

  Cortex-A77 cores (r0p0, r1p0) could deadlock on a sequence of a
  store-exclusive or read of PAR_EL1 and a load with device or non-cacheable
  memory attributes.
  A workaround is available, but it depends on a firmware counterpart.

  The proposed workaround from the errata document is to modify the software
  running at EL1 and above to include a DMB SY before and after accessing
  PAR_EL1.

  In conjunction to the above, the firmware needs to use a specific write
  sequence to several IMPLEMENTATION DEFINED registers to have the hardware
  insert a DMB SY after all load-exclusive and store-exclusive instructions.

  Apply the workaround to Xen where PAR_EL1 is read, implementing an helper
  function to do that.
  Since Xen can be interrupted by irqs in any moment, add a barrier on
  entry/exit when we are running on the affected cores.

  A guest without the workaround can deadlock the system, so warn the users
  of Xen with the above type of cores to use only trusted guests, by
  printing a message on Xen startup.

  This is XSA-436 / CVE-2023-34320.

  Signed-off-by: Luca Fancellu <luca.fancellu@arm.com>
  [stefano: add XSA-436 to commit message]
  Signed-off-by: Stefano Stabellini <stefano.stabellini@amd.com>
  Reviewed-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
  3e357970c90172526d58e964f8ceaf32b2c69655:xen/arm: Add Cortex-A77 erratum 1508412 handling

  Cortex-A77 cores (r0p0, r1p0) could deadlock on a sequence of a
  store-exclusive or read of PAR_EL1 and a load with device or non-cacheable
  memory attributes.
  A workaround is available, but it depends on a firmware counterpart.

  The proposed workaround from the errata document is to modify the software
  running at EL1 and above to include a DMB SY before and after accessing
  PAR_EL1.

  In conjunction to the above, the firmware needs to use a specific write
  sequence to several IMPLEMENTATION DEFINED registers to have the hardware
  insert a DMB SY after all load-exclusive and store-exclusive instructions.

  Apply the workaround to Xen where PAR_EL1 is read, implementing an helper
  function to do that.
  Since Xen can be interrupted by irqs in any moment, add a barrier on
  entry/exit when we are running on the affected cores.

  A guest without the workaround can deadlock the system, so warn the users
  of Xen with the above type of cores to use only trusted guests, by
  printing a message on Xen startup.

  This is XSA-436 / CVE-2023-34320.

  Signed-off-by: Luca Fancellu <luca.fancellu@arm.com>
  [stefano: add XSA-436 to commit message]
  Signed-off-by: Stefano Stabellini <stefano.stabellini@amd.com>
  Reviewed-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
  3d0aa6f23d54a4d3c608010c58c1147a1500d865:xen/arm: Add Cortex-A77 erratum 1508412 handling

  Cortex-A77 cores (r0p0, r1p0) could deadlock on a sequence of a
  store-exclusive or read of PAR_EL1 and a load with device or non-cacheable
  memory attributes.
  A workaround is available, but it depends on a firmware counterpart.

  The proposed workaround from the errata document is to modify the software
  running at EL1 and above to include a DMB SY before and after accessing
  PAR_EL1.

  In conjunction to the above, the firmware needs to use a specific write
  sequence to several IMPLEMENTATION DEFINED registers to have the hardware
  insert a DMB SY after all load-exclusive and store-exclusive instructions.

  Apply the workaround to Xen where PAR_EL1 is read, implementing an helper
  function to do that.
  Since Xen can be interrupted by irqs in any moment, add a barrier on
  entry/exit when we are running on the affected cores.

  A guest without the workaround can deadlock the system, so warn the users
  of Xen with the above type of cores to use only trusted guests, by
  printing a message on Xen startup.

  This is XSA-436 / CVE-2023-34320.

  Signed-off-by: Luca Fancellu <luca.fancellu@arm.com>
  [stefano: add XSA-436 to commit message]
  Signed-off-by: Stefano Stabellini <stefano.stabellini@amd.com>
  Reviewed-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: bd3ddaf6ee7fa312bd077305819105f84a34008d
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 87eaa43b30f8ffb600f8e6f765d5c7e4bcb241b9
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 3e357970c90172526d58e964f8ceaf32b2c69655
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 3d0aa6f23d54a4d3c608010c58c1147a1500d865
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/3d0aa6f23d54a4d3c608010c58c1147a1500d865
    reference_type: commit
    reference_id: 3d0aa6f23d54a4d3c608010c58c1147a1500d865
  - url: https://github.com/xen-project/xen/tree/3e357970c90172526d58e964f8ceaf32b2c69655
    reference_type: commit
    reference_id: 3e357970c90172526d58e964f8ceaf32b2c69655
  - url: https://github.com/xen-project/xen/tree/87eaa43b30f8ffb600f8e6f765d5c7e4bcb241b9
    reference_type: commit
    reference_id: 87eaa43b30f8ffb600f8e6f765d5c7e4bcb241b9
  - url: https://github.com/xen-project/xen/tree/bd3ddaf6ee7fa312bd077305819105f84a34008d
    reference_type: commit
    reference_id: bd3ddaf6ee7fa312bd077305819105f84a34008d
