advisory_id: CVE-2012-0218
datasource_id: collect_xen_project_fix_commits/CVE-2012-0218
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  087ade3adfa5390f3ae068cf36e6a6f85130706e:x86-64: fix #GP generation in assembly code

  When guest use of sysenter (64-bit PV guest) or syscall (32-bit PV
  guest) gets converted into a GP fault (due to no callback having got
  registered), we must
  - honor the GP fault handler's request the keep enabled or mask event
    delivery
  - not allow TBF_EXCEPTION to remain set past the generation of the
    (guest) exception in the vCPU's trap_bounce.flags, as that would
    otherwise allow for the next exception occurring in guest mode,
    should it happen to get handled in Xen itself, to nevertheless get
    bounced to the guest kernel.

  Also, just like compat mode syscall handling already did, native mode
  sysenter handling should, when converting to #GP, subtract 2 from the
  RIP present in the frame so that the guest's GP fault handler would
  see the fault pointing to the offending instruction instead of past it.

  Finally, since those exception generating code blocks needed to be
  modified anyway, convert them to make use of UNLIKELY_{START,END}().

  [ This bug is security vulnerability, XSA-8 / CVE-2012-0218. ]

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Acked-by: Keir Fraser <keir@xen.org>
  Committed-by: Jan Beulich <jbeulich@suse.com>

  xen-unstable changeset:   25200:80f4113be500 25204:569d6f05e1ef
  Committed-by: Ian Jackson <ian.jackson@eu.citrix.com>
  c7c2c622562502c6c7e9bfe38c342d4f25746f1f:x86-64: fix #GP generation in assembly code

  When guest use of sysenter (64-bit PV guest) or syscall (32-bit PV
  guest) gets converted into a GP fault (due to no callback having got
  registered), we must
  - honor the GP fault handler's request the keep enabled or mask event
    delivery
  - not allow TBF_EXCEPTION to remain set past the generation of the
    (guest) exception in the vCPU's trap_bounce.flags, as that would
    otherwise allow for the next exception occurring in guest mode,
    should it happen to get handled in Xen itself, to nevertheless get
    bounced to the guest kernel.

  Also, just like compat mode syscall handling already did, native mode
  sysenter handling should, when converting to #GP, subtract 2 from the
  RIP present in the frame so that the guest's GP fault handler would
  see the fault pointing to the offending instruction instead of past it.

  Finally, since those exception generating code blocks needed to be
  modified anyway, convert them to make use of UNLIKELY_{START,END}().

  [ This bug is security vulnerability, XSA-8 / CVE-2012-0218. ]

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Acked-by: Keir Fraser <keir@xen.org>
  Committed-by: Jan Beulich <jbeulich@suse.com>

  xen-unstable changeset:   25200:80f4113be500 25204:569d6f05e1ef
  Committed-by: Ian Jackson <ian.jackson@eu.citrix.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: c7c2c622562502c6c7e9bfe38c342d4f25746f1f
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 087ade3adfa5390f3ae068cf36e6a6f85130706e
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/087ade3adfa5390f3ae068cf36e6a6f85130706e
    reference_type: commit
    reference_id: 087ade3adfa5390f3ae068cf36e6a6f85130706e
  - url: https://github.com/xen-project/xen/tree/c7c2c622562502c6c7e9bfe38c342d4f25746f1f
    reference_type: commit
    reference_id: c7c2c622562502c6c7e9bfe38c342d4f25746f1f
