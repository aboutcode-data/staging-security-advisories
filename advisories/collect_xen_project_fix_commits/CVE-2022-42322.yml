advisory_id: CVE-2022-42322
datasource_id: collect_xen_project_fix_commits/CVE-2022-42322
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  a8922c661c2e2436c0d60da3ab9b12b47f308a92:tools/xenstore: remove nodes owned by destroyed domain

  In case a domain is removed from Xenstore, remove all nodes owned by
  it per default.

  This tackles the problem that nodes might be created by a domain
  outside its home path in Xenstore, leading to Xenstore hogging more
  and more memory. Domain quota don't work in this case if the guest is
  rebooting in between.

  Since XSA-322 ownership of such stale nodes is transferred to dom0,
  which is helping against unintended access, but not against OOM of
  Xenstore.

  As a fallback for weird cases add a Xenstore start parameter for
  keeping today's way to handle stale nodes, adding the risk of Xenstore
  hitting an OOM situation.

  This is part of XSA-419 / CVE-2022-42322.

  Fixes: 496306324d8d ("tools/xenstore: revoke access rights for removed domains")
  Signed-off-by: Juergen Gross <jgross@suse.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
  (cherry picked from commit 755d3f9debf8879448211fffb018f556136f6a79)
  e5bdcec53ad9c247d90d22cca6fb0b66e35cb81c:tools/xenstore: remove nodes owned by destroyed domain

  In case a domain is removed from Xenstore, remove all nodes owned by
  it per default.

  This tackles the problem that nodes might be created by a domain
  outside its home path in Xenstore, leading to Xenstore hogging more
  and more memory. Domain quota don't work in this case if the guest is
  rebooting in between.

  Since XSA-322 ownership of such stale nodes is transferred to dom0,
  which is helping against unintended access, but not against OOM of
  Xenstore.

  As a fallback for weird cases add a Xenstore start parameter for
  keeping today's way to handle stale nodes, adding the risk of Xenstore
  hitting an OOM situation.

  This is part of XSA-419 / CVE-2022-42322.

  Fixes: 496306324d8d ("tools/xenstore: revoke access rights for removed domains")
  Signed-off-by: Juergen Gross <jgross@suse.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
  (cherry picked from commit 755d3f9debf8879448211fffb018f556136f6a79)
  da87661d058c4a6cf2ea6439771b9834f1c06223:tools/xenstore: remove nodes owned by destroyed domain

  In case a domain is removed from Xenstore, remove all nodes owned by
  it per default.

  This tackles the problem that nodes might be created by a domain
  outside its home path in Xenstore, leading to Xenstore hogging more
  and more memory. Domain quota don't work in this case if the guest is
  rebooting in between.

  Since XSA-322 ownership of such stale nodes is transferred to dom0,
  which is helping against unintended access, but not against OOM of
  Xenstore.

  As a fallback for weird cases add a Xenstore start parameter for
  keeping today's way to handle stale nodes, adding the risk of Xenstore
  hitting an OOM situation.

  This is part of XSA-419 / CVE-2022-42322.

  Fixes: 496306324d8d ("tools/xenstore: revoke access rights for removed domains")
  Signed-off-by: Juergen Gross <jgross@suse.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
  (cherry picked from commit 755d3f9debf8879448211fffb018f556136f6a79)
  825332daeac9fc3ac1e482e805ac4a3bc1e1ab34:tools/xenstore: remove nodes owned by destroyed domain

  In case a domain is removed from Xenstore, remove all nodes owned by
  it per default.

  This tackles the problem that nodes might be created by a domain
  outside its home path in Xenstore, leading to Xenstore hogging more
  and more memory. Domain quota don't work in this case if the guest is
  rebooting in between.

  Since XSA-322 ownership of such stale nodes is transferred to dom0,
  which is helping against unintended access, but not against OOM of
  Xenstore.

  As a fallback for weird cases add a Xenstore start parameter for
  keeping today's way to handle stale nodes, adding the risk of Xenstore
  hitting an OOM situation.

  This is part of XSA-419 / CVE-2022-42322.

  Fixes: 496306324d8d ("tools/xenstore: revoke access rights for removed domains")
  Signed-off-by: Juergen Gross <jgross@suse.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
  (cherry picked from commit 755d3f9debf8879448211fffb018f556136f6a79)
  755d3f9debf8879448211fffb018f556136f6a79:tools/xenstore: remove nodes owned by destroyed domain

  In case a domain is removed from Xenstore, remove all nodes owned by
  it per default.

  This tackles the problem that nodes might be created by a domain
  outside its home path in Xenstore, leading to Xenstore hogging more
  and more memory. Domain quota don't work in this case if the guest is
  rebooting in between.

  Since XSA-322 ownership of such stale nodes is transferred to dom0,
  which is helping against unintended access, but not against OOM of
  Xenstore.

  As a fallback for weird cases add a Xenstore start parameter for
  keeping today's way to handle stale nodes, adding the risk of Xenstore
  hitting an OOM situation.

  This is part of XSA-419 / CVE-2022-42322.

  Fixes: 496306324d8d ("tools/xenstore: revoke access rights for removed domains")
  Signed-off-by: Juergen Gross <jgross@suse.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 755d3f9debf8879448211fffb018f556136f6a79
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: e5bdcec53ad9c247d90d22cca6fb0b66e35cb81c
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: a8922c661c2e2436c0d60da3ab9b12b47f308a92
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 825332daeac9fc3ac1e482e805ac4a3bc1e1ab34
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: da87661d058c4a6cf2ea6439771b9834f1c06223
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/755d3f9debf8879448211fffb018f556136f6a79
    reference_type: commit
    reference_id: 755d3f9debf8879448211fffb018f556136f6a79
  - url: https://github.com/xen-project/xen/tree/825332daeac9fc3ac1e482e805ac4a3bc1e1ab34
    reference_type: commit
    reference_id: 825332daeac9fc3ac1e482e805ac4a3bc1e1ab34
  - url: https://github.com/xen-project/xen/tree/a8922c661c2e2436c0d60da3ab9b12b47f308a92
    reference_type: commit
    reference_id: a8922c661c2e2436c0d60da3ab9b12b47f308a92
  - url: https://github.com/xen-project/xen/tree/da87661d058c4a6cf2ea6439771b9834f1c06223
    reference_type: commit
    reference_id: da87661d058c4a6cf2ea6439771b9834f1c06223
  - url: https://github.com/xen-project/xen/tree/e5bdcec53ad9c247d90d22cca6fb0b66e35cb81c
    reference_type: commit
    reference_id: e5bdcec53ad9c247d90d22cca6fb0b66e35cb81c
