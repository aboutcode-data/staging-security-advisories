advisory_id: CVE-2023-20588
datasource_id: collect_xen_project_fix_commits/CVE-2023-20588
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  d7b78041dc819efde0350f27754a61cb01a93496:x86/spec-ctrl: Mitigate the Zen1 DIV leakage

  In the Zen1 microarchitecure, there is one divider in the pipeline which
  services uops from both threads.  In the case of #DE, the latched result from
  the previous DIV to execute will be forwarded speculatively.

  This is an interesting covert channel that allows two threads to communicate
  without any system calls.  In also allows userspace to obtain the result of
  the most recent DIV instruction executed (even speculatively) in the core,
  which can be from a higher privilege context.

  Scrub the result from the divider by executing a non-faulting divide.  This
  needs performing on the exit-to-guest paths, and ist_exit-to-Xen.

  Alternatives in IST context is believed safe now that it's done in NMI
  context.

  This is XSA-439 / CVE-2023-20588.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit b5926c6ecf05c28ee99c6248c42d691ccbf0c315)
  de751c3d906d17b2e25ee429f81b17a689c7c6c0:x86/spec-ctrl: Mitigate the Zen1 DIV leakage

  In the Zen1 microarchitecure, there is one divider in the pipeline which
  services uops from both threads.  In the case of #DE, the latched result from
  the previous DIV to execute will be forwarded speculatively.

  This is an interesting covert channel that allows two threads to communicate
  without any system calls.  In also allows userspace to obtain the result of
  the most recent DIV instruction executed (even speculatively) in the core,
  which can be from a higher privilege context.

  Scrub the result from the divider by executing a non-faulting divide.  This
  needs performing on the exit-to-guest paths, and ist_exit-to-Xen.

  Alternatives in IST context is believed safe now that it's done in NMI
  context.

  This is XSA-439 / CVE-2023-20588.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit b5926c6ecf05c28ee99c6248c42d691ccbf0c315)
  9ac2f49f5fa3a5159409241d4f74fb0d721dd4c5:x86/spec-ctrl: Mitigate the Zen1 DIV leakage

  In the Zen1 microarchitecure, there is one divider in the pipeline which
  services uops from both threads.  In the case of #DE, the latched result from
  the previous DIV to execute will be forwarded speculatively.

  This is an interesting covert channel that allows two threads to communicate
  without any system calls.  In also allows userspace to obtain the result of
  the most recent DIV instruction executed (even speculatively) in the core,
  which can be from a higher privilege context.

  Scrub the result from the divider by executing a non-faulting divide.  This
  needs performing on the exit-to-guest paths, and ist_exit-to-Xen.

  Alternatives in IST context is believed safe now that it's done in NMI
  context.

  This is XSA-439 / CVE-2023-20588.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit b5926c6ecf05c28ee99c6248c42d691ccbf0c315)
  b5926c6ecf05c28ee99c6248c42d691ccbf0c315:x86/spec-ctrl: Mitigate the Zen1 DIV leakage

  In the Zen1 microarchitecure, there is one divider in the pipeline which
  services uops from both threads.  In the case of #DE, the latched result from
  the previous DIV to execute will be forwarded speculatively.

  This is an interesting covert channel that allows two threads to communicate
  without any system calls.  In also allows userspace to obtain the result of
  the most recent DIV instruction executed (even speculatively) in the core,
  which can be from a higher privilege context.

  Scrub the result from the divider by executing a non-faulting divide.  This
  needs performing on the exit-to-guest paths, and ist_exit-to-Xen.

  Alternatives in IST context is believed safe now that it's done in NMI
  context.

  This is XSA-439 / CVE-2023-20588.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: d7b78041dc819efde0350f27754a61cb01a93496
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: b5926c6ecf05c28ee99c6248c42d691ccbf0c315
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 9ac2f49f5fa3a5159409241d4f74fb0d721dd4c5
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: de751c3d906d17b2e25ee429f81b17a689c7c6c0
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/9ac2f49f5fa3a5159409241d4f74fb0d721dd4c5
    reference_type: commit
    reference_id: 9ac2f49f5fa3a5159409241d4f74fb0d721dd4c5
  - url: https://github.com/xen-project/xen/tree/b5926c6ecf05c28ee99c6248c42d691ccbf0c315
    reference_type: commit
    reference_id: b5926c6ecf05c28ee99c6248c42d691ccbf0c315
  - url: https://github.com/xen-project/xen/tree/d7b78041dc819efde0350f27754a61cb01a93496
    reference_type: commit
    reference_id: d7b78041dc819efde0350f27754a61cb01a93496
  - url: https://github.com/xen-project/xen/tree/de751c3d906d17b2e25ee429f81b17a689c7c6c0
    reference_type: commit
    reference_id: de751c3d906d17b2e25ee429f81b17a689c7c6c0
