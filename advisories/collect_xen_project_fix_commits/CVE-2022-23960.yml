advisory_id: CVE-2022-23960
datasource_id: collect_xen_project_fix_commits/CVE-2022-23960
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  dab616cd3d4856a7a4d4f3a429a82dbdbf1aeeb9:xen/arm: Allow to discover and use SMCCC_ARCH_WORKAROUND_3

  Allow guest to discover whether or not SMCCC_ARCH_WORKAROUND_3 is
  supported and create a fastpath in the code to handle guests request to
  do the workaround.

  The function SMCCC_ARCH_WORKAROUND_3 will be called by the guest for
  flushing the branch history. So we want the handling to be as fast as
  possible.

  As the mitigation is applied on every guest exit, we can check for the
  call before saving all context and return very early.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Reviewed-by: Julien Grall <julien@xen.org>
  (cherry picked from commit c0a56ea0fd92ecb471936b7355ddbecbaea3707c)
  789523a2aac88e3668f9c4ad892fa47b5f6bf1a7:xen/arm: Add Spectre BHB handling

  This commit is adding Spectre BHB handling to Xen on Arm.
  The commit is introducing new alternative code to be executed during
  exception entry:
  - SMCC workaround 3 call
  - loop workaround (with 8, 24 or 32 iterations)
  - use of new clearbhb instruction

  Cpuerrata is modified by this patch to apply the required workaround for
  CPU affected by Spectre BHB when CONFIG_ARM64_HARDEN_BRANCH_PREDICTOR is
  enabled.

  To do this the system previously used to apply smcc workaround 1 is
  reused and new alternative code to be copied in the exception handler is
  introduced.

  To define the type of workaround required by a processor, 4 new cpu
  capabilities are introduced (for each number of loop and for smcc
  workaround 3).

  When a processor is affected, enable_spectre_bhb_workaround is called
  and if the processor does not have CSV2 set to 3 or ECBHB feature (which
  would mean that the processor is doing what is required in hardware),
  the proper code is enabled at exception entry.

  In the case where workaround 3 is not supported by the firmware, we
  enable workaround 1 when possible as it will also mitigate Spectre BHB
  on systems without CSV2.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Signed-off-by: Rahul Singh <rahul.singh@arm.com>
  Acked-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 62c91eb66a2904eefb1d1d9642e3697a1e3c3a3c)
  8aa3833db97e8fe1143c5ece110b9321ce1494ea:xen/arm: Add ECBHB and CLEARBHB ID fields

  Introduce ID coprocessor register ID_AA64ISAR2_EL1.
  Add definitions in cpufeature and sysregs of ECBHB field in mmfr1 and
  CLEARBHB in isar2 ID coprocessor registers.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Acked-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 4b68d12d98b8790d8002fcc2c25a9d713374a4d7)
  3d963874461b3001e33f3ff90e285670f04d16c4:xen/arm: move errata CSV2 check earlier

  CSV2 availability check is done after printing to the user that
  workaround 1 will be used. Move the check before to prevent saying to the
  user that workaround 1 is used when it is not because it is not needed.
  This will also allow to reuse install_bp_hardening_vec function for
  other use cases.

  Code previously returning "true", now returns "0" to conform to
  enable_smccc_arch_workaround_1 returning an int and surrounding code
  doing a "return 0" if workaround is not needed.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Reviewed-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 599616d70eb886b9ad0ef9d6b51693ce790504ba)
  8d18b03c95850239a1a9ebaeb565936c7c9ae070:xen/arm: Introduce new Arm processors

  Add some new processor identifiers in processor.h and sync Xen
  definitions with status of Linux 5.17 (declared in
  arch/arm64/include/asm/cputype.h).

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Acked-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 35d1b85a6b43483f6bd007d48757434e54743e98)
  65110f49535d15b6dddf4a8f34308231eae761da:xen/arm: Allow to discover and use SMCCC_ARCH_WORKAROUND_3

  Allow guest to discover whether or not SMCCC_ARCH_WORKAROUND_3 is
  supported and create a fastpath in the code to handle guests request to
  do the workaround.

  The function SMCCC_ARCH_WORKAROUND_3 will be called by the guest for
  flushing the branch history. So we want the handling to be as fast as
  possible.

  As the mitigation is applied on every guest exit, we can check for the
  call before saving all context and return very early.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Reviewed-by: Julien Grall <julien@xen.org>
  (cherry picked from commit c0a56ea0fd92ecb471936b7355ddbecbaea3707c)
  eed4a84a83f828611210499fd0e995f6c8e73a10:xen/arm: Add Spectre BHB handling

  This commit is adding Spectre BHB handling to Xen on Arm.
  The commit is introducing new alternative code to be executed during
  exception entry:
  - SMCC workaround 3 call
  - loop workaround (with 8, 24 or 32 iterations)
  - use of new clearbhb instruction

  Cpuerrata is modified by this patch to apply the required workaround for
  CPU affected by Spectre BHB when CONFIG_ARM64_HARDEN_BRANCH_PREDICTOR is
  enabled.

  To do this the system previously used to apply smcc workaround 1 is
  reused and new alternative code to be copied in the exception handler is
  introduced.

  To define the type of workaround required by a processor, 4 new cpu
  capabilities are introduced (for each number of loop and for smcc
  workaround 3).

  When a processor is affected, enable_spectre_bhb_workaround is called
  and if the processor does not have CSV2 set to 3 or ECBHB feature (which
  would mean that the processor is doing what is required in hardware),
  the proper code is enabled at exception entry.

  In the case where workaround 3 is not supported by the firmware, we
  enable workaround 1 when possible as it will also mitigate Spectre BHB
  on systems without CSV2.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Signed-off-by: Rahul Singh <rahul.singh@arm.com>
  Acked-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 62c91eb66a2904eefb1d1d9642e3697a1e3c3a3c)
  7259e87984a00c6a481b89e1b3da8392750bcc36:xen/arm: Add ECBHB and CLEARBHB ID fields

  Introduce ID coprocessor register ID_AA64ISAR2_EL1.
  Add definitions in cpufeature and sysregs of ECBHB field in mmfr1 and
  CLEARBHB in isar2 ID coprocessor registers.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Acked-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 4b68d12d98b8790d8002fcc2c25a9d713374a4d7)
  9a4a4abb595e6600ab3b652676a998f5bbc580d5:xen/arm: move errata CSV2 check earlier

  CSV2 availability check is done after printing to the user that
  workaround 1 will be used. Move the check before to prevent saying to the
  user that workaround 1 is used when it is not because it is not needed.
  This will also allow to reuse install_bp_hardening_vec function for
  other use cases.

  Code previously returning "true", now returns "0" to conform to
  enable_smccc_arch_workaround_1 returning an int and surrounding code
  doing a "return 0" if workaround is not needed.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Reviewed-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 599616d70eb886b9ad0ef9d6b51693ce790504ba)
  5f097af94ec78e170d599a05c6e528cda259891f:xen/arm: Introduce new Arm processors

  Add some new processor identifiers in processor.h and sync Xen
  definitions with status of Linux 5.17 (declared in
  arch/arm64/include/asm/cputype.h).

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Acked-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 35d1b85a6b43483f6bd007d48757434e54743e98)
  7cebd77c80ce87f84c63a6043a5ad7115ccab9d5:xen/arm: Allow to discover and use SMCCC_ARCH_WORKAROUND_3

  Allow guest to discover whether or not SMCCC_ARCH_WORKAROUND_3 is
  supported and create a fastpath in the code to handle guests request to
  do the workaround.

  The function SMCCC_ARCH_WORKAROUND_3 will be called by the guest for
  flushing the branch history. So we want the handling to be as fast as
  possible.

  As the mitigation is applied on every guest exit, we can check for the
  call before saving all context and return very early.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Reviewed-by: Julien Grall <julien@xen.org>
  (cherry picked from commit c0a56ea0fd92ecb471936b7355ddbecbaea3707c)
  fc56dd212e4574c5fd77f830d077036b330dc1b5:xen/arm: Add Spectre BHB handling

  This commit is adding Spectre BHB handling to Xen on Arm.
  The commit is introducing new alternative code to be executed during
  exception entry:
  - SMCC workaround 3 call
  - loop workaround (with 8, 24 or 32 iterations)
  - use of new clearbhb instruction

  Cpuerrata is modified by this patch to apply the required workaround for
  CPU affected by Spectre BHB when CONFIG_ARM64_HARDEN_BRANCH_PREDICTOR is
  enabled.

  To do this the system previously used to apply smcc workaround 1 is
  reused and new alternative code to be copied in the exception handler is
  introduced.

  To define the type of workaround required by a processor, 4 new cpu
  capabilities are introduced (for each number of loop and for smcc
  workaround 3).

  When a processor is affected, enable_spectre_bhb_workaround is called
  and if the processor does not have CSV2 set to 3 or ECBHB feature (which
  would mean that the processor is doing what is required in hardware),
  the proper code is enabled at exception entry.

  In the case where workaround 3 is not supported by the firmware, we
  enable workaround 1 when possible as it will also mitigate Spectre BHB
  on systems without CSV2.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Signed-off-by: Rahul Singh <rahul.singh@arm.com>
  Acked-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 62c91eb66a2904eefb1d1d9642e3697a1e3c3a3c)
  ee4b53ae1b95966fd9a491668f0eca73028925e1:xen/arm: Add ECBHB and CLEARBHB ID fields

  Introduce ID coprocessor register ID_AA64ISAR2_EL1.
  Add definitions in cpufeature and sysregs of ECBHB field in mmfr1 and
  CLEARBHB in isar2 ID coprocessor registers.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Acked-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 4b68d12d98b8790d8002fcc2c25a9d713374a4d7)
  6da7a845fb476ef7395185ec08a58c76ebd8c442:xen/arm: move errata CSV2 check earlier

  CSV2 availability check is done after printing to the user that
  workaround 1 will be used. Move the check before to prevent saying to the
  user that workaround 1 is used when it is not because it is not needed.
  This will also allow to reuse install_bp_hardening_vec function for
  other use cases.

  Code previously returning "true", now returns "0" to conform to
  enable_smccc_arch_workaround_1 returning an int and surrounding code
  doing a "return 0" if workaround is not needed.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Reviewed-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 599616d70eb886b9ad0ef9d6b51693ce790504ba)
  021466aa73caaa0c5983f02203678e649dd4d22c:xen/arm: Introduce new Arm processors

  Add some new processor identifiers in processor.h and sync Xen
  definitions with status of Linux 5.17 (declared in
  arch/arm64/include/asm/cputype.h).

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Acked-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 35d1b85a6b43483f6bd007d48757434e54743e98)
  fbabb62dd9e57180400f145a8756624c82de888f:xen/arm: Allow to discover and use SMCCC_ARCH_WORKAROUND_3

  Allow guest to discover whether or not SMCCC_ARCH_WORKAROUND_3 is
  supported and create a fastpath in the code to handle guests request to
  do the workaround.

  The function SMCCC_ARCH_WORKAROUND_3 will be called by the guest for
  flushing the branch history. So we want the handling to be as fast as
  possible.

  As the mitigation is applied on every guest exit, we can check for the
  call before saving all context and return very early.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Reviewed-by: Julien Grall <julien@xen.org>
  (cherry picked from commit c0a56ea0fd92ecb471936b7355ddbecbaea3707c)
  47125f5fb2073abb9d5d3f65824cd066e7ec62f1:xen/arm: Add Spectre BHB handling

  This commit is adding Spectre BHB handling to Xen on Arm.
  The commit is introducing new alternative code to be executed during
  exception entry:
  - SMCC workaround 3 call
  - loop workaround (with 8, 24 or 32 iterations)
  - use of new clearbhb instruction

  Cpuerrata is modified by this patch to apply the required workaround for
  CPU affected by Spectre BHB when CONFIG_ARM64_HARDEN_BRANCH_PREDICTOR is
  enabled.

  To do this the system previously used to apply smcc workaround 1 is
  reused and new alternative code to be copied in the exception handler is
  introduced.

  To define the type of workaround required by a processor, 4 new cpu
  capabilities are introduced (for each number of loop and for smcc
  workaround 3).

  When a processor is affected, enable_spectre_bhb_workaround is called
  and if the processor does not have CSV2 set to 3 or ECBHB feature (which
  would mean that the processor is doing what is required in hardware),
  the proper code is enabled at exception entry.

  In the case where workaround 3 is not supported by the firmware, we
  enable workaround 1 when possible as it will also mitigate Spectre BHB
  on systems without CSV2.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Signed-off-by: Rahul Singh <rahul.singh@arm.com>
  Acked-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 62c91eb66a2904eefb1d1d9642e3697a1e3c3a3c)
  d99df7d50d366c7a8dc71f5bdc3454f469b00a00:xen/arm: Add ECBHB and CLEARBHB ID fields

  Introduce ID coprocessor register ID_AA64ISAR2_EL1.
  Add definitions in cpufeature and sysregs of ECBHB field in mmfr1 and
  CLEARBHB in isar2 ID coprocessor registers.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Acked-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 4b68d12d98b8790d8002fcc2c25a9d713374a4d7)
  03db21387b8653d663e8da89c964d611ba509130:xen/arm: move errata CSV2 check earlier

  CSV2 availability check is done after printing to the user that
  workaround 1 will be used. Move the check before to prevent saying to the
  user that workaround 1 is used when it is not because it is not needed.
  This will also allow to reuse install_bp_hardening_vec function for
  other use cases.

  Code previously returning "true", now returns "0" to conform to
  enable_smccc_arch_workaround_1 returning an int and surrounding code
  doing a "return 0" if workaround is not needed.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Reviewed-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 599616d70eb886b9ad0ef9d6b51693ce790504ba)
  9a8804a92fed77f77afe9fc525c6891bb60f68d3:xen/arm: Introduce new Arm processors

  Add some new processor identifiers in processor.h and sync Xen
  definitions with status of Linux 5.17 (declared in
  arch/arm64/include/asm/cputype.h).

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Acked-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 35d1b85a6b43483f6bd007d48757434e54743e98)
  21f5a7b22687aa1e384782c8a1c04148f288ad9f:xen/arm: Allow to discover and use SMCCC_ARCH_WORKAROUND_3

  Allow guest to discover whether or not SMCCC_ARCH_WORKAROUND_3 is
  supported and create a fastpath in the code to handle guests request to
  do the workaround.

  The function SMCCC_ARCH_WORKAROUND_3 will be called by the guest for
  flushing the branch history. So we want the handling to be as fast as
  possible.

  As the mitigation is applied on every guest exit, we can check for the
  call before saving all context and return very early.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Reviewed-by: Julien Grall <julien@xen.org>
  (cherry picked from commit c0a56ea0fd92ecb471936b7355ddbecbaea3707c)
  d340fad8be324e1760ea29d7c25658a8aec83306:xen/arm: Add Spectre BHB handling

  This commit is adding Spectre BHB handling to Xen on Arm.
  The commit is introducing new alternative code to be executed during
  exception entry:
  - SMCC workaround 3 call
  - loop workaround (with 8, 24 or 32 iterations)
  - use of new clearbhb instruction

  Cpuerrata is modified by this patch to apply the required workaround for
  CPU affected by Spectre BHB when CONFIG_ARM64_HARDEN_BRANCH_PREDICTOR is
  enabled.

  To do this the system previously used to apply smcc workaround 1 is
  reused and new alternative code to be copied in the exception handler is
  introduced.

  To define the type of workaround required by a processor, 4 new cpu
  capabilities are introduced (for each number of loop and for smcc
  workaround 3).

  When a processor is affected, enable_spectre_bhb_workaround is called
  and if the processor does not have CSV2 set to 3 or ECBHB feature (which
  would mean that the processor is doing what is required in hardware),
  the proper code is enabled at exception entry.

  In the case where workaround 3 is not supported by the firmware, we
  enable workaround 1 when possible as it will also mitigate Spectre BHB
  on systems without CSV2.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Signed-off-by: Rahul Singh <rahul.singh@arm.com>
  Acked-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 62c91eb66a2904eefb1d1d9642e3697a1e3c3a3c)
  2e519fd8c1e3e7ae5370a6638615d2a52169db28:xen/arm: Add ECBHB and CLEARBHB ID fields

  Introduce ID coprocessor register ID_AA64ISAR2_EL1.
  Add definitions in cpufeature and sysregs of ECBHB field in mmfr1 and
  CLEARBHB in isar2 ID coprocessor registers.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Acked-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 4b68d12d98b8790d8002fcc2c25a9d713374a4d7)
  35164a1704fe13e1f83dbd4b5b79838f07d564c6:xen/arm: move errata CSV2 check earlier

  CSV2 availability check is done after printing to the user that
  workaround 1 will be used. Move the check before to prevent saying to the
  user that workaround 1 is used when it is not because it is not needed.
  This will also allow to reuse install_bp_hardening_vec function for
  other use cases.

  Code previously returning "true", now returns "0" to conform to
  enable_smccc_arch_workaround_1 returning an int and surrounding code
  doing a "return 0" if workaround is not needed.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Reviewed-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 599616d70eb886b9ad0ef9d6b51693ce790504ba)
  f1346b2cfdbeb468b50be7b6f7aa38ce3c1acf2a:xen/arm: Introduce new Arm processors

  Add some new processor identifiers in processor.h and sync Xen
  definitions with status of Linux 5.17 (declared in
  arch/arm64/include/asm/cputype.h).

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Acked-by: Julien Grall <julien@xen.org>
  (cherry picked from commit 35d1b85a6b43483f6bd007d48757434e54743e98)
  c0a56ea0fd92ecb471936b7355ddbecbaea3707c:xen/arm: Allow to discover and use SMCCC_ARCH_WORKAROUND_3

  Allow guest to discover whether or not SMCCC_ARCH_WORKAROUND_3 is
  supported and create a fastpath in the code to handle guests request to
  do the workaround.

  The function SMCCC_ARCH_WORKAROUND_3 will be called by the guest for
  flushing the branch history. So we want the handling to be as fast as
  possible.

  As the mitigation is applied on every guest exit, we can check for the
  call before saving all context and return very early.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Reviewed-by: Julien Grall <julien@xen.org>
  62c91eb66a2904eefb1d1d9642e3697a1e3c3a3c:xen/arm: Add Spectre BHB handling

  This commit is adding Spectre BHB handling to Xen on Arm.
  The commit is introducing new alternative code to be executed during
  exception entry:
  - SMCC workaround 3 call
  - loop workaround (with 8, 24 or 32 iterations)
  - use of new clearbhb instruction

  Cpuerrata is modified by this patch to apply the required workaround for
  CPU affected by Spectre BHB when CONFIG_ARM64_HARDEN_BRANCH_PREDICTOR is
  enabled.

  To do this the system previously used to apply smcc workaround 1 is
  reused and new alternative code to be copied in the exception handler is
  introduced.

  To define the type of workaround required by a processor, 4 new cpu
  capabilities are introduced (for each number of loop and for smcc
  workaround 3).

  When a processor is affected, enable_spectre_bhb_workaround is called
  and if the processor does not have CSV2 set to 3 or ECBHB feature (which
  would mean that the processor is doing what is required in hardware),
  the proper code is enabled at exception entry.

  In the case where workaround 3 is not supported by the firmware, we
  enable workaround 1 when possible as it will also mitigate Spectre BHB
  on systems without CSV2.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Signed-off-by: Rahul Singh <rahul.singh@arm.com>
  Acked-by: Julien Grall <julien@xen.org>
  4b68d12d98b8790d8002fcc2c25a9d713374a4d7:xen/arm: Add ECBHB and CLEARBHB ID fields

  Introduce ID coprocessor register ID_AA64ISAR2_EL1.
  Add definitions in cpufeature and sysregs of ECBHB field in mmfr1 and
  CLEARBHB in isar2 ID coprocessor registers.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Acked-by: Julien Grall <julien@xen.org>
  599616d70eb886b9ad0ef9d6b51693ce790504ba:xen/arm: move errata CSV2 check earlier

  CSV2 availability check is done after printing to the user that
  workaround 1 will be used. Move the check before to prevent saying to the
  user that workaround 1 is used when it is not because it is not needed.
  This will also allow to reuse install_bp_hardening_vec function for
  other use cases.

  Code previously returning "true", now returns "0" to conform to
  enable_smccc_arch_workaround_1 returning an int and surrounding code
  doing a "return 0" if workaround is not needed.

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Reviewed-by: Julien Grall <julien@xen.org>
  35d1b85a6b43483f6bd007d48757434e54743e98:xen/arm: Introduce new Arm processors

  Add some new processor identifiers in processor.h and sync Xen
  definitions with status of Linux 5.17 (declared in
  arch/arm64/include/asm/cputype.h).

  This is part of XSA-398 / CVE-2022-23960.

  Signed-off-by: Bertrand Marquis <bertrand.marquis@arm.com>
  Acked-by: Julien Grall <julien@xen.org>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: d340fad8be324e1760ea29d7c25658a8aec83306
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 03db21387b8653d663e8da89c964d611ba509130
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 21f5a7b22687aa1e384782c8a1c04148f288ad9f
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 47125f5fb2073abb9d5d3f65824cd066e7ec62f1
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: fc56dd212e4574c5fd77f830d077036b330dc1b5
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 5f097af94ec78e170d599a05c6e528cda259891f
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 789523a2aac88e3668f9c4ad892fa47b5f6bf1a7
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 35d1b85a6b43483f6bd007d48757434e54743e98
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 6da7a845fb476ef7395185ec08a58c76ebd8c442
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 2e519fd8c1e3e7ae5370a6638615d2a52169db28
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 8aa3833db97e8fe1143c5ece110b9321ce1494ea
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 35164a1704fe13e1f83dbd4b5b79838f07d564c6
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: eed4a84a83f828611210499fd0e995f6c8e73a10
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: d99df7d50d366c7a8dc71f5bdc3454f469b00a00
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: dab616cd3d4856a7a4d4f3a429a82dbdbf1aeeb9
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 3d963874461b3001e33f3ff90e285670f04d16c4
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 62c91eb66a2904eefb1d1d9642e3697a1e3c3a3c
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 021466aa73caaa0c5983f02203678e649dd4d22c
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 599616d70eb886b9ad0ef9d6b51693ce790504ba
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: c0a56ea0fd92ecb471936b7355ddbecbaea3707c
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 7cebd77c80ce87f84c63a6043a5ad7115ccab9d5
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 7259e87984a00c6a481b89e1b3da8392750bcc36
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: fbabb62dd9e57180400f145a8756624c82de888f
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: f1346b2cfdbeb468b50be7b6f7aa38ce3c1acf2a
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 8d18b03c95850239a1a9ebaeb565936c7c9ae070
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 4b68d12d98b8790d8002fcc2c25a9d713374a4d7
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 9a8804a92fed77f77afe9fc525c6891bb60f68d3
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 65110f49535d15b6dddf4a8f34308231eae761da
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: ee4b53ae1b95966fd9a491668f0eca73028925e1
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 9a4a4abb595e6600ab3b652676a998f5bbc580d5
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/021466aa73caaa0c5983f02203678e649dd4d22c
    reference_type: commit
    reference_id: 021466aa73caaa0c5983f02203678e649dd4d22c
  - url: https://github.com/xen-project/xen/tree/03db21387b8653d663e8da89c964d611ba509130
    reference_type: commit
    reference_id: 03db21387b8653d663e8da89c964d611ba509130
  - url: https://github.com/xen-project/xen/tree/21f5a7b22687aa1e384782c8a1c04148f288ad9f
    reference_type: commit
    reference_id: 21f5a7b22687aa1e384782c8a1c04148f288ad9f
  - url: https://github.com/xen-project/xen/tree/2e519fd8c1e3e7ae5370a6638615d2a52169db28
    reference_type: commit
    reference_id: 2e519fd8c1e3e7ae5370a6638615d2a52169db28
  - url: https://github.com/xen-project/xen/tree/35164a1704fe13e1f83dbd4b5b79838f07d564c6
    reference_type: commit
    reference_id: 35164a1704fe13e1f83dbd4b5b79838f07d564c6
  - url: https://github.com/xen-project/xen/tree/35d1b85a6b43483f6bd007d48757434e54743e98
    reference_type: commit
    reference_id: 35d1b85a6b43483f6bd007d48757434e54743e98
  - url: https://github.com/xen-project/xen/tree/3d963874461b3001e33f3ff90e285670f04d16c4
    reference_type: commit
    reference_id: 3d963874461b3001e33f3ff90e285670f04d16c4
  - url: https://github.com/xen-project/xen/tree/47125f5fb2073abb9d5d3f65824cd066e7ec62f1
    reference_type: commit
    reference_id: 47125f5fb2073abb9d5d3f65824cd066e7ec62f1
  - url: https://github.com/xen-project/xen/tree/4b68d12d98b8790d8002fcc2c25a9d713374a4d7
    reference_type: commit
    reference_id: 4b68d12d98b8790d8002fcc2c25a9d713374a4d7
  - url: https://github.com/xen-project/xen/tree/599616d70eb886b9ad0ef9d6b51693ce790504ba
    reference_type: commit
    reference_id: 599616d70eb886b9ad0ef9d6b51693ce790504ba
  - url: https://github.com/xen-project/xen/tree/5f097af94ec78e170d599a05c6e528cda259891f
    reference_type: commit
    reference_id: 5f097af94ec78e170d599a05c6e528cda259891f
  - url: https://github.com/xen-project/xen/tree/62c91eb66a2904eefb1d1d9642e3697a1e3c3a3c
    reference_type: commit
    reference_id: 62c91eb66a2904eefb1d1d9642e3697a1e3c3a3c
  - url: https://github.com/xen-project/xen/tree/65110f49535d15b6dddf4a8f34308231eae761da
    reference_type: commit
    reference_id: 65110f49535d15b6dddf4a8f34308231eae761da
  - url: https://github.com/xen-project/xen/tree/6da7a845fb476ef7395185ec08a58c76ebd8c442
    reference_type: commit
    reference_id: 6da7a845fb476ef7395185ec08a58c76ebd8c442
  - url: https://github.com/xen-project/xen/tree/7259e87984a00c6a481b89e1b3da8392750bcc36
    reference_type: commit
    reference_id: 7259e87984a00c6a481b89e1b3da8392750bcc36
  - url: https://github.com/xen-project/xen/tree/789523a2aac88e3668f9c4ad892fa47b5f6bf1a7
    reference_type: commit
    reference_id: 789523a2aac88e3668f9c4ad892fa47b5f6bf1a7
  - url: https://github.com/xen-project/xen/tree/7cebd77c80ce87f84c63a6043a5ad7115ccab9d5
    reference_type: commit
    reference_id: 7cebd77c80ce87f84c63a6043a5ad7115ccab9d5
  - url: https://github.com/xen-project/xen/tree/8aa3833db97e8fe1143c5ece110b9321ce1494ea
    reference_type: commit
    reference_id: 8aa3833db97e8fe1143c5ece110b9321ce1494ea
  - url: https://github.com/xen-project/xen/tree/8d18b03c95850239a1a9ebaeb565936c7c9ae070
    reference_type: commit
    reference_id: 8d18b03c95850239a1a9ebaeb565936c7c9ae070
  - url: https://github.com/xen-project/xen/tree/9a4a4abb595e6600ab3b652676a998f5bbc580d5
    reference_type: commit
    reference_id: 9a4a4abb595e6600ab3b652676a998f5bbc580d5
  - url: https://github.com/xen-project/xen/tree/9a8804a92fed77f77afe9fc525c6891bb60f68d3
    reference_type: commit
    reference_id: 9a8804a92fed77f77afe9fc525c6891bb60f68d3
  - url: https://github.com/xen-project/xen/tree/c0a56ea0fd92ecb471936b7355ddbecbaea3707c
    reference_type: commit
    reference_id: c0a56ea0fd92ecb471936b7355ddbecbaea3707c
  - url: https://github.com/xen-project/xen/tree/d340fad8be324e1760ea29d7c25658a8aec83306
    reference_type: commit
    reference_id: d340fad8be324e1760ea29d7c25658a8aec83306
  - url: https://github.com/xen-project/xen/tree/d99df7d50d366c7a8dc71f5bdc3454f469b00a00
    reference_type: commit
    reference_id: d99df7d50d366c7a8dc71f5bdc3454f469b00a00
  - url: https://github.com/xen-project/xen/tree/dab616cd3d4856a7a4d4f3a429a82dbdbf1aeeb9
    reference_type: commit
    reference_id: dab616cd3d4856a7a4d4f3a429a82dbdbf1aeeb9
  - url: https://github.com/xen-project/xen/tree/ee4b53ae1b95966fd9a491668f0eca73028925e1
    reference_type: commit
    reference_id: ee4b53ae1b95966fd9a491668f0eca73028925e1
  - url: https://github.com/xen-project/xen/tree/eed4a84a83f828611210499fd0e995f6c8e73a10
    reference_type: commit
    reference_id: eed4a84a83f828611210499fd0e995f6c8e73a10
  - url: https://github.com/xen-project/xen/tree/f1346b2cfdbeb468b50be7b6f7aa38ce3c1acf2a
    reference_type: commit
    reference_id: f1346b2cfdbeb468b50be7b6f7aa38ce3c1acf2a
  - url: https://github.com/xen-project/xen/tree/fbabb62dd9e57180400f145a8756624c82de888f
    reference_type: commit
    reference_id: fbabb62dd9e57180400f145a8756624c82de888f
  - url: https://github.com/xen-project/xen/tree/fc56dd212e4574c5fd77f830d077036b330dc1b5
    reference_type: commit
    reference_id: fc56dd212e4574c5fd77f830d077036b330dc1b5
