advisory_id: CVE-2016-9378
datasource_id: collect_xen_project_fix_commits/CVE-2016-9378
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  387b8aef1824af3d6d99652f971042b43f62c064:x86/svm: fix injection of software interrupts

  The non-NextRip logic in c/s 36ebf14eb "x86/emulate: support for emulating
  software event injection" was based on an older version of the AMD software
  manual.  The manual was later corrected, following findings from that series.

  I took the original wording of "not supported without NextRIP" to mean that
  X86_EVENTTYPE_SW_INTERRUPT was not eligible for use.  It turns out that this
  is not the case, and the new wording is clearer on the matter.

  Despite testing the original patch series on non-NRip hardware, the
  swint-emulation XTF test case focuses on the debug vectors; it never ended up
  executing an `int $n` instruction for a vector which wasn't also an exception.

  During a vmentry, the use of X86_EVENTTYPE_HW_EXCEPTION comes with a vector
  check to ensure that it is only used with exception vectors.  Xen's use of
  X86_EVENTTYPE_HW_EXCEPTION for `int $n` injection has always been buggy on AMD
  hardware.

  Fix this by always using X86_EVENTTYPE_SW_INTERRUPT.

  Print and decode the eventinj information in svm_vmcb_dump(), as it has
  several invalid combinations which cause vmentry failures.

  This is CVE-2016-9378 / part of XSA-196.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  master commit: 920edccd41db6cb0145545afa1850edf5e7d098e
  master date: 2016-11-22 13:51:16 +0100
  a4902cabfb3ac60db0e2bdaada05f550d985f0f3:x86/svm: fix injection of software interrupts

  The non-NextRip logic in c/s 36ebf14eb "x86/emulate: support for emulating
  software event injection" was based on an older version of the AMD software
  manual.  The manual was later corrected, following findings from that series.

  I took the original wording of "not supported without NextRIP" to mean that
  X86_EVENTTYPE_SW_INTERRUPT was not eligible for use.  It turns out that this
  is not the case, and the new wording is clearer on the matter.

  Despite testing the original patch series on non-NRip hardware, the
  swint-emulation XTF test case focuses on the debug vectors; it never ended up
  executing an `int $n` instruction for a vector which wasn't also an exception.

  During a vmentry, the use of X86_EVENTTYPE_HW_EXCEPTION comes with a vector
  check to ensure that it is only used with exception vectors.  Xen's use of
  X86_EVENTTYPE_HW_EXCEPTION for `int $n` injection has always been buggy on AMD
  hardware.

  Fix this by always using X86_EVENTTYPE_SW_INTERRUPT.

  Print and decode the eventinj information in svm_vmcb_dump(), as it has
  several invalid combinations which cause vmentry failures.

  This is CVE-2016-9378 / part of XSA-196.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  master commit: 920edccd41db6cb0145545afa1850edf5e7d098e
  master date: 2016-11-22 13:51:16 +0100
  a6b0650d858402bdb35a177db299c8f749affa3a:x86/svm: fix injection of software interrupts

  The non-NextRip logic in c/s 36ebf14eb "x86/emulate: support for emulating
  software event injection" was based on an older version of the AMD software
  manual.  The manual was later corrected, following findings from that series.

  I took the original wording of "not supported without NextRIP" to mean that
  X86_EVENTTYPE_SW_INTERRUPT was not eligible for use.  It turns out that this
  is not the case, and the new wording is clearer on the matter.

  Despite testing the original patch series on non-NRip hardware, the
  swint-emulation XTF test case focuses on the debug vectors; it never ended up
  executing an `int $n` instruction for a vector which wasn't also an exception.

  During a vmentry, the use of X86_EVENTTYPE_HW_EXCEPTION comes with a vector
  check to ensure that it is only used with exception vectors.  Xen's use of
  X86_EVENTTYPE_HW_EXCEPTION for `int $n` injection has always been buggy on AMD
  hardware.

  Fix this by always using X86_EVENTTYPE_SW_INTERRUPT.

  Print and decode the eventinj information in svm_vmcb_dump(), as it has
  several invalid combinations which cause vmentry failures.

  This is CVE-2016-9378 / part of XSA-196.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  master commit: 920edccd41db6cb0145545afa1850edf5e7d098e
  master date: 2016-11-22 13:51:16 +0100
  920edccd41db6cb0145545afa1850edf5e7d098e:x86/svm: fix injection of software interrupts

  The non-NextRip logic in c/s 36ebf14eb "x86/emulate: support for emulating
  software event injection" was based on an older version of the AMD software
  manual.  The manual was later corrected, following findings from that series.

  I took the original wording of "not supported without NextRIP" to mean that
  X86_EVENTTYPE_SW_INTERRUPT was not eligible for use.  It turns out that this
  is not the case, and the new wording is clearer on the matter.

  Despite testing the original patch series on non-NRip hardware, the
  swint-emulation XTF test case focuses on the debug vectors; it never ended up
  executing an `int $n` instruction for a vector which wasn't also an exception.

  During a vmentry, the use of X86_EVENTTYPE_HW_EXCEPTION comes with a vector
  check to ensure that it is only used with exception vectors.  Xen's use of
  X86_EVENTTYPE_HW_EXCEPTION for `int $n` injection has always been buggy on AMD
  hardware.

  Fix this by always using X86_EVENTTYPE_SW_INTERRUPT.

  Print and decode the eventinj information in svm_vmcb_dump(), as it has
  several invalid combinations which cause vmentry failures.

  This is CVE-2016-9378 / part of XSA-196.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 920edccd41db6cb0145545afa1850edf5e7d098e
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 387b8aef1824af3d6d99652f971042b43f62c064
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: a4902cabfb3ac60db0e2bdaada05f550d985f0f3
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: a6b0650d858402bdb35a177db299c8f749affa3a
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/387b8aef1824af3d6d99652f971042b43f62c064
    reference_type: commit
    reference_id: 387b8aef1824af3d6d99652f971042b43f62c064
  - url: https://github.com/xen-project/xen/tree/920edccd41db6cb0145545afa1850edf5e7d098e
    reference_type: commit
    reference_id: 920edccd41db6cb0145545afa1850edf5e7d098e
  - url: https://github.com/xen-project/xen/tree/a4902cabfb3ac60db0e2bdaada05f550d985f0f3
    reference_type: commit
    reference_id: a4902cabfb3ac60db0e2bdaada05f550d985f0f3
  - url: https://github.com/xen-project/xen/tree/a6b0650d858402bdb35a177db299c8f749affa3a
    reference_type: commit
    reference_id: a6b0650d858402bdb35a177db299c8f749affa3a
