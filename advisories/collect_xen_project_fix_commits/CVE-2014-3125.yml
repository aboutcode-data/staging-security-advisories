advisory_id: CVE-2014-3125
datasource_id: collect_xen_project_fix_commits/CVE-2014-3125
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  9a9e59e4080122a45de347a74f0b366731b95a09:xen/arm: Correctly save/restore CNTKCTL_EL1

  CNTKCTL_EL1 is used by the guest to control access to the timer from
  userspace.  It therefore needs to be save/restored by Xen as part of
  the VCPU state.

  By default Linux on ARM64 exposes the timer to userspace.  Furthermore on
  ARM64, Linux provides helpers in a VDSO (gettimeofday/__do_get_tspec)
  that use the timer counter.  Conversely, during CPU bring up, Xen will
  set CNTKCTL_EL1 to 0 (i.e disallow timer access to the userspace).  As
  a result, currently, if dom0 has 1 VCPU which is migrated to another
  PCPU, init might crash.

  Alternatively, a guest (malicious or not) might decide to disable
  access to the timer from userspace.  If the register is not
  save/restored, when a DOM0 VCPU runs again, a similar crash would
  result.

  Also, drop CNTKCTL_EL1 initialization in init_timer_interrupt.  Xen
  should let the guest deal with this register.

  This is XSA-91 / CVE-2014-3125.

  Reported-by: Chen Baozi <baozich@gmail.com>
  Signed-off-by: Julien Grall <julien.grall@linaro.org>
  Signed-off-by: Ian Jackson <ian.jackson@eu.citrix.com>
  Acked-by: Ian Campbell <ian.campbell@citrix.com>
  893256ffae0cf3be34a33a15efe2f2058b4b4fb7:xen/arm: Correctly save/restore CNTKCTL_EL1

  CNTKCTL_EL1 is used by the guest to control access to the timer from
  userspace.  It therefore needs to be save/restored by Xen as part of
  the VCPU state.

  By default Linux on ARM64 exposes the timer to userspace.  Furthermore on
  ARM64, Linux provides helpers in a VDSO (gettimeofday/__do_get_tspec)
  that use the timer counter.  Conversely, during CPU bring up, Xen will
  set CNTKCTL_EL1 to 0 (i.e disallow timer access to the userspace).  As
  a result, currently, if dom0 has 1 VCPU which is migrated to another
  PCPU, init might crash.

  Alternatively, a guest (malicious or not) might decide to disable
  access to the timer from userspace.  If the register is not
  save/restored, when a DOM0 VCPU runs again, a similar crash would
  result.

  Also, drop CNTKCTL_EL1 initialization in init_timer_interrupt.  Xen
  should let the guest deal with this register.

  This is XSA-91 / CVE-2014-3125.

  Reported-by: Chen Baozi <baozich@gmail.com>
  Signed-off-by: Julien Grall <julien.grall@linaro.org>
  Signed-off-by: Ian Jackson <ian.jackson@eu.citrix.com>
  Acked-by: Ian Campbell <ian.campbell@citrix.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 9a9e59e4080122a45de347a74f0b366731b95a09
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 893256ffae0cf3be34a33a15efe2f2058b4b4fb7
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/893256ffae0cf3be34a33a15efe2f2058b4b4fb7
    reference_type: commit
    reference_id: 893256ffae0cf3be34a33a15efe2f2058b4b4fb7
  - url: https://github.com/xen-project/xen/tree/9a9e59e4080122a45de347a74f0b366731b95a09
    reference_type: commit
    reference_id: 9a9e59e4080122a45de347a74f0b366731b95a09
