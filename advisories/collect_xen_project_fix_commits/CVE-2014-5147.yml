advisory_id: CVE-2014-5147
datasource_id: collect_xen_project_fix_commits/CVE-2014-5147
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  650ed2cef3284bfa6918924bc6a7ac8662ce2807:xen: arm: Allow traps from 32 bit userspace on 64 bit hypervisors again

  This removes the unconditional #undef injected in response to such
  traps which was added by the fixes to CVE-2014-5147 / XSA-102 in
  c0020e099702 "xen: arm: Handle traps from 32-bit userspace on 64-bit
  kernel as undef", we now handle such traps correctly.

  Signed-off-by: Ian Campbell <ian.campbell@citrix.com>
  Reviewed-by: Julien Grall <julien.grall@linaro.org>
  61460b58192786b206d96cf8d3cb188c364266a6:xen: arm: Handle traps from 32-bit userspace on 64-bit kernel as undef

  We are not setup to handle these properly. This turns a host crash
  into a trap to the guest kernel which will likely result in killing
  the offending process.

  This is part of CVE-2014-5147 / XSA-102.

  Signed-off-by: Ian Campbell <ian.campbell@citrix.com>
  Acked-by: Julien Grall <julien.grall@linaro.org>
  master commit: c0020e0997024eb741d60de9a480bf2878f891af
  master date: 2014-08-12 15:37:25 +0200
  935d51859a92b1fb88f1fa1bf596782bdf4a80ca:xen: arm: Correctly handle exception injection from userspace on 64-bit.

  Firstly we must be prepared to propagate traps from 32-bit userspace even for
  64-bit guests, so wrap the existing inject_undef??_exception into
  inject_undef_exception and use that when injecting an undef exception. The
  various other exception cases (aborts etc) already do this.

  Secondly when injecting the trap we must pick the correct exception vector
  depending on whether the source of the trap was 32-bit EL0, 64-bit EL0 or EL1.

  This is part of CVE-2014-5147 / XSA-102.

  Signed-off-by: Ian Campbell <ian.campbell@citrix.com>
  Acked-by: Julien Grall <julien.grall@linaro.org>
  master commit: a98669781769e821413dfef4ef99b93171375610
  master date: 2014-08-12 15:36:15 +0200
  99a9f497cb070ba7168d45442ad8ea3604d95dcb:xen: arm: handle AArch32 userspace when dumping 64-bit guest state.

  A 64-bit guest can still be in 32-bit mode when running userspace,
  handle this case by dumping the correct 32-bit state.

  Note that on ARM it is not possible to change mode without the help
  of the next exception level, hence there is no way a 64-bit guest can
  be running in 32-bit kernel modes.

  This is part of CVE-2014-5147 / XSA-102.

  Signed-off-by: Ian Campbell <ian.campbell@citrix.com>
  Acked-by: Julien Grall <julien.grall@linaro.org>
  master commit: fc0cafeab30fe93963457fafbad7a01c7f55ea5f
  master date: 2014-08-12 15:32:27 +0200
  c0020e0997024eb741d60de9a480bf2878f891af:xen: arm: Handle traps from 32-bit userspace on 64-bit kernel as undef

  We are not setup to handle these properly. This turns a host crash
  into a trap to the guest kernel which will likely result in killing
  the offending process.

  This is part of CVE-2014-5147 / XSA-102.

  Signed-off-by: Ian Campbell <ian.campbell@citrix.com>
  Acked-by: Julien Grall <julien.grall@linaro.org>
  a98669781769e821413dfef4ef99b93171375610:xen: arm: Correctly handle exception injection from userspace on 64-bit.

  Firstly we must be prepared to propagate traps from 32-bit userspace even for
  64-bit guests, so wrap the existing inject_undef??_exception into
  inject_undef_exception and use that when injecting an undef exception. The
  various other exception cases (aborts etc) already do this.

  Secondly when injecting the trap we must pick the correct exception vector
  depending on whether the source of the trap was 32-bit EL0, 64-bit EL0 or EL1.

  This is part of CVE-2014-5147 / XSA-102.

  Signed-off-by: Ian Campbell <ian.campbell@citrix.com>
  Acked-by: Julien Grall <julien.grall@linaro.org>
  fc0cafeab30fe93963457fafbad7a01c7f55ea5f:xen: arm: handle AArch32 userspace when dumping 64-bit guest state.

  A 64-bit guest can still be in 32-bit mode when running userspace,
  handle this case by dumping the correct 32-bit state.

  Note that on ARM it is not possible to change mode without the help
  of the next exception level, hence there is no way a 64-bit guest can
  be running in 32-bit kernel modes.

  This is part of CVE-2014-5147 / XSA-102.

  Signed-off-by: Ian Campbell <ian.campbell@citrix.com>
  Acked-by: Julien Grall <julien.grall@linaro.org>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 99a9f497cb070ba7168d45442ad8ea3604d95dcb
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: a98669781769e821413dfef4ef99b93171375610
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 650ed2cef3284bfa6918924bc6a7ac8662ce2807
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 61460b58192786b206d96cf8d3cb188c364266a6
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: fc0cafeab30fe93963457fafbad7a01c7f55ea5f
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 935d51859a92b1fb88f1fa1bf596782bdf4a80ca
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: c0020e0997024eb741d60de9a480bf2878f891af
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/61460b58192786b206d96cf8d3cb188c364266a6
    reference_type: commit
    reference_id: 61460b58192786b206d96cf8d3cb188c364266a6
  - url: https://github.com/xen-project/xen/tree/650ed2cef3284bfa6918924bc6a7ac8662ce2807
    reference_type: commit
    reference_id: 650ed2cef3284bfa6918924bc6a7ac8662ce2807
  - url: https://github.com/xen-project/xen/tree/935d51859a92b1fb88f1fa1bf596782bdf4a80ca
    reference_type: commit
    reference_id: 935d51859a92b1fb88f1fa1bf596782bdf4a80ca
  - url: https://github.com/xen-project/xen/tree/99a9f497cb070ba7168d45442ad8ea3604d95dcb
    reference_type: commit
    reference_id: 99a9f497cb070ba7168d45442ad8ea3604d95dcb
  - url: https://github.com/xen-project/xen/tree/a98669781769e821413dfef4ef99b93171375610
    reference_type: commit
    reference_id: a98669781769e821413dfef4ef99b93171375610
  - url: https://github.com/xen-project/xen/tree/c0020e0997024eb741d60de9a480bf2878f891af
    reference_type: commit
    reference_id: c0020e0997024eb741d60de9a480bf2878f891af
  - url: https://github.com/xen-project/xen/tree/fc0cafeab30fe93963457fafbad7a01c7f55ea5f
    reference_type: commit
    reference_id: fc0cafeab30fe93963457fafbad7a01c7f55ea5f
