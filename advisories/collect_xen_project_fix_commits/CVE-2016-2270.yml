advisory_id: CVE-2016-2270
datasource_id: collect_xen_project_fix_commits/CVE-2016-2270
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  6f41b482b9491e7867fb7eedaf0e849575321413:x86: enforce consistent cachability of MMIO mappings

  We've been told by Intel that inconsistent cachability between
  multiple mappings of the same page can affect system stability only
  when the affected page is an MMIO one. Since the stale data issue is
  of no relevance to the hypervisor (since all guest memory accesses go
  through proper accessors and validation), handling of RAM pages
  remains unchanged here. Any MMIO mapped by domains however needs to be
  done consistently (all cachable mappings or all uncachable ones), in
  order to avoid Machine Check exceptions. Since converting existing
  cachable mappings to uncachable (at the time an uncachable mapping
  gets established) would in the PV case require tracking all mappings,
  allow MMIO to only get mapped uncachable (UC, UC-, or WC).

  This also implies that in the PV case we mustn't use the L1 PTE update
  fast path when cachability flags get altered.

  Since in the HVM case at least for now we want to continue honoring
  pinned cachability attributes for pages not mapped by the hypervisor,
  special case handling of r/o MMIO pages (forcing UC) gets added there.
  Arguably the counterpart change to p2m-pt.c may not be necessary, since
  UC- (which already gets enforced there) is probably strict enough.

  Note that the shadow code changes include fixing the write protection
  of r/o MMIO ranges: shadow_l1e_remove_flags() and its siblings, other
  than l1e_remove_flags() and alike, return the new PTE (and hence
  ignoring their return values makes them no-ops).

  This is CVE-2016-2270 / XSA-154.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Acked-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: c61a6f74f80eb36ed83a82f713db3143159b9009
  master date: 2016-02-17 16:16:53 +0100
  ff87c9a0ce27008f3bce99a343e1cdb2dbb9cb8a:x86: enforce consistent cachability of MMIO mappings

  We've been told by Intel that inconsistent cachability between
  multiple mappings of the same page can affect system stability only
  when the affected page is an MMIO one. Since the stale data issue is
  of no relevance to the hypervisor (since all guest memory accesses go
  through proper accessors and validation), handling of RAM pages
  remains unchanged here. Any MMIO mapped by domains however needs to be
  done consistently (all cachable mappings or all uncachable ones), in
  order to avoid Machine Check exceptions. Since converting existing
  cachable mappings to uncachable (at the time an uncachable mapping
  gets established) would in the PV case require tracking all mappings,
  allow MMIO to only get mapped uncachable (UC, UC-, or WC).

  This also implies that in the PV case we mustn't use the L1 PTE update
  fast path when cachability flags get altered.

  Since in the HVM case at least for now we want to continue honoring
  pinned cachability attributes for pages not mapped by the hypervisor,
  special case handling of r/o MMIO pages (forcing UC) gets added there.
  Arguably the counterpart change to p2m-pt.c may not be necessary, since
  UC- (which already gets enforced there) is probably strict enough.

  Note that the shadow code changes include fixing the write protection
  of r/o MMIO ranges: shadow_l1e_remove_flags() and its siblings, other
  than l1e_remove_flags() and alike, return the new PTE (and hence
  ignoring their return values makes them no-ops).

  This is CVE-2016-2270 / XSA-154.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Acked-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: c61a6f74f80eb36ed83a82f713db3143159b9009
  master date: 2016-02-17 16:16:53 +0100
  96b4955c51d37ee261b873d8ccb68a21e8f6a904:x86: enforce consistent cachability of MMIO mappings

  We've been told by Intel that inconsistent cachability between
  multiple mappings of the same page can affect system stability only
  when the affected page is an MMIO one. Since the stale data issue is
  of no relevance to the hypervisor (since all guest memory accesses go
  through proper accessors and validation), handling of RAM pages
  remains unchanged here. Any MMIO mapped by domains however needs to be
  done consistently (all cachable mappings or all uncachable ones), in
  order to avoid Machine Check exceptions. Since converting existing
  cachable mappings to uncachable (at the time an uncachable mapping
  gets established) would in the PV case require tracking all mappings,
  allow MMIO to only get mapped uncachable (UC, UC-, or WC).

  This also implies that in the PV case we mustn't use the L1 PTE update
  fast path when cachability flags get altered.

  Since in the HVM case at least for now we want to continue honoring
  pinned cachability attributes for pages not mapped by the hypervisor,
  special case handling of r/o MMIO pages (forcing UC) gets added there.
  Arguably the counterpart change to p2m-pt.c may not be necessary, since
  UC- (which already gets enforced there) is probably strict enough.

  Note that the shadow code changes include fixing the write protection
  of r/o MMIO ranges: shadow_l1e_remove_flags() and its siblings, other
  than l1e_remove_flags() and alike, return the new PTE (and hence
  ignoring their return values makes them no-ops).

  This is CVE-2016-2270 / XSA-154.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Acked-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: c61a6f74f80eb36ed83a82f713db3143159b9009
  master date: 2016-02-17 16:16:53 +0100
  6d03c9e4f2eeeaefb1b9e6eee248bfc9a434de48:x86: enforce consistent cachability of MMIO mappings

  We've been told by Intel that inconsistent cachability between
  multiple mappings of the same page can affect system stability only
  when the affected page is an MMIO one. Since the stale data issue is
  of no relevance to the hypervisor (since all guest memory accesses go
  through proper accessors and validation), handling of RAM pages
  remains unchanged here. Any MMIO mapped by domains however needs to be
  done consistently (all cachable mappings or all uncachable ones), in
  order to avoid Machine Check exceptions. Since converting existing
  cachable mappings to uncachable (at the time an uncachable mapping
  gets established) would in the PV case require tracking all mappings,
  allow MMIO to only get mapped uncachable (UC, UC-, or WC).

  This also implies that in the PV case we mustn't use the L1 PTE update
  fast path when cachability flags get altered.

  Since in the HVM case at least for now we want to continue honoring
  pinned cachability attributes for pages not mapped by the hypervisor,
  special case handling of r/o MMIO pages (forcing UC) gets added there.
  Arguably the counterpart change to p2m-pt.c may not be necessary, since
  UC- (which already gets enforced there) is probably strict enough.

  Note that the shadow code changes include fixing the write protection
  of r/o MMIO ranges: shadow_l1e_remove_flags() and its siblings, other
  than l1e_remove_flags() and alike, return the new PTE (and hence
  ignoring their return values makes them no-ops).

  This is CVE-2016-2270 / XSA-154.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Acked-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: c61a6f74f80eb36ed83a82f713db3143159b9009
  master date: 2016-02-17 16:16:53 +0100
  c61a6f74f80eb36ed83a82f713db3143159b9009:x86: enforce consistent cachability of MMIO mappings

  We've been told by Intel that inconsistent cachability between
  multiple mappings of the same page can affect system stability only
  when the affected page is an MMIO one. Since the stale data issue is
  of no relevance to the hypervisor (since all guest memory accesses go
  through proper accessors and validation), handling of RAM pages
  remains unchanged here. Any MMIO mapped by domains however needs to be
  done consistently (all cachable mappings or all uncachable ones), in
  order to avoid Machine Check exceptions. Since converting existing
  cachable mappings to uncachable (at the time an uncachable mapping
  gets established) would in the PV case require tracking all mappings,
  allow MMIO to only get mapped uncachable (UC, UC-, or WC).

  This also implies that in the PV case we mustn't use the L1 PTE update
  fast path when cachability flags get altered.

  Since in the HVM case at least for now we want to continue honoring
  pinned cachability attributes for pages not mapped by the hypervisor,
  special case handling of r/o MMIO pages (forcing UC) gets added there.
  Arguably the counterpart change to p2m-pt.c may not be necessary, since
  UC- (which already gets enforced there) is probably strict enough.

  Note that the shadow code changes include fixing the write protection
  of r/o MMIO ranges: shadow_l1e_remove_flags() and its siblings, other
  than l1e_remove_flags() and alike, return the new PTE (and hence
  ignoring their return values makes them no-ops).

  This is CVE-2016-2270 / XSA-154.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Acked-by: Andrew Cooper <andrew.cooper3@citrix.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: ff87c9a0ce27008f3bce99a343e1cdb2dbb9cb8a
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 96b4955c51d37ee261b873d8ccb68a21e8f6a904
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 6f41b482b9491e7867fb7eedaf0e849575321413
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 6d03c9e4f2eeeaefb1b9e6eee248bfc9a434de48
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: c61a6f74f80eb36ed83a82f713db3143159b9009
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/6d03c9e4f2eeeaefb1b9e6eee248bfc9a434de48
    reference_type: commit
    reference_id: 6d03c9e4f2eeeaefb1b9e6eee248bfc9a434de48
  - url: https://github.com/xen-project/xen/tree/6f41b482b9491e7867fb7eedaf0e849575321413
    reference_type: commit
    reference_id: 6f41b482b9491e7867fb7eedaf0e849575321413
  - url: https://github.com/xen-project/xen/tree/96b4955c51d37ee261b873d8ccb68a21e8f6a904
    reference_type: commit
    reference_id: 96b4955c51d37ee261b873d8ccb68a21e8f6a904
  - url: https://github.com/xen-project/xen/tree/c61a6f74f80eb36ed83a82f713db3143159b9009
    reference_type: commit
    reference_id: c61a6f74f80eb36ed83a82f713db3143159b9009
  - url: https://github.com/xen-project/xen/tree/ff87c9a0ce27008f3bce99a343e1cdb2dbb9cb8a
    reference_type: commit
    reference_id: ff87c9a0ce27008f3bce99a343e1cdb2dbb9cb8a
