advisory_id: CVE-2017-5715
datasource_id: collect_xen_project_fix_commits/CVE-2017-5715
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  2e34343fb2c8b62e8e98b21a569beea508f501f6:xen/arm: Relax ARM_SMCCC_ARCH_WORKAROUND_1 discovery

  A recent update to the ARM SMCCC_ARCH_WORKAROUND_1 specification (see [1])
  allows firmware to return a non zero, positive value, to describe that
  although the mitigation is implemented at the higher exception level,
  the CPU on which the call is made is not affected.

  Relax the check on the return value from ARM_WORKAROUND_1 so that we
  only error out if the returned value is negative.

  [1] https://developer.arm.com/support/security-update/downloads
  "Firmware interfaces for mitigating CVE-2017-5715 System Software on Arm
  Systems"

  Signed-off-by: Julien Grall <julien.grall@arm.com>
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  (cherry picked from commit 6b270fae7ad462687550a875f714bff18d764416)
  9746779afb665fc3ba18e0bffc090474e33fe043:xen/arm: smccc: Add macros SMCCC_VERSION, SMCCC_VERSION_{MINOR, MAJOR}

  Add macros SMCCC_VERSION, SMCCC_VERSION_{MINOR, MAJOR} to easily convert
  between a 32-bit value and a version number. The encoding is based on
  2.2.2 in "Firmware interfaces for mitigation CVE-2017-5715" (ARM DEN 0070A).

  Also re-use them to define ARM_SMCCC_VERSION_1_0 and ARM_SMCCC_VERSION_1_1.

  Signed-off-by: Julien Grall <julien.grall@arm.com>
  Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
  Acked-by: Stefano Stabellini <sstabellini@kernel.org>
  Signed-off-by: Stefano Stabellini <sstabellini@kernel.org>
  (cherry picked from commit 479fab92d356e5a09f5db4596017419cf4023a9f)
  df71252060147447d00e36eb37806e8b75a1b4c7:xen/arm: vsmc: Implement SMCCC_ARCH_WORKAROUND_1 BP hardening support

  SMCCC 1.1 offers firmware-based CPU workarounds. In particular,
  SMCCC_ARCH_WORKAROUND_1 provides BP hardening for variant 2 of XSA-254
  (CVE-2017-5715).

  If the hypervisor has some mitigation for this issue, report that we
  deal with it using SMCCC_ARCH_WORKAROUND_1, as we apply the hypervisor
  workaround on every guest exit.

  Signed-off-by: Julien Grall <julien.grall@arm.com>
  Reviewed-by: Volodymyr Babchuk <volodymyr.babchuk@epam.com>
  Acked-by: Stefano Stabellini <sstabellini@kernel.org>
  Reviewed-by: Andre Przywara <andre.przywara@arm.com>
  Signed-off-by: Stefano Stabellini <sstabellini@kernel.org>
  (cherry picked from commit 52c5d8d3c1657cd8dc1675f8205ca0ecc08b6a51)
  7f9ebebcec5077714830aa09df0bf25f77ca692e:xen/arm: vsmc: Implement SMCCC 1.1

  The new SMC Calling Convention (v1.1) allows for a reduced overhead when
  calling into the firmware, and provides a new feature discovery
  mechanism. See "Firmware interfaces for mitigating CVE-2017-5715"
  ARM DEN 00070A.

  Signed-off-by: Julien Grall <julien.grall@arm.com>
  Reviewed-by: Volodymyr Babchuk <volodymyr.babchuk@epam.com>
  Acked-by: Stefano Stabellini <sstabellini@kernel.org>
  Signed-off-by: Stefano Stabellini <sstabellini@kernel.org>
  (cherry picked from commit 3af378feac5bb504387dd6bc232b9c64a8a376d9)
  6b270fae7ad462687550a875f714bff18d764416:xen/arm: Relax ARM_SMCCC_ARCH_WORKAROUND_1 discovery

  A recent update to the ARM SMCCC_ARCH_WORKAROUND_1 specification (see [1])
  allows firmware to return a non zero, positive value, to describe that
  although the mitigation is implemented at the higher exception level,
  the CPU on which the call is made is not affected.

  Relax the check on the return value from ARM_WORKAROUND_1 so that we
  only error out if the returned value is negative.

  [1] https://developer.arm.com/support/security-update/downloads
  "Firmware interfaces for mitigating CVE-2017-5715 System Software on Arm
  Systems"

  Signed-off-by: Julien Grall <julien.grall@arm.com>
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  479fab92d356e5a09f5db4596017419cf4023a9f:xen/arm: smccc: Add macros SMCCC_VERSION, SMCCC_VERSION_{MINOR, MAJOR}

  Add macros SMCCC_VERSION, SMCCC_VERSION_{MINOR, MAJOR} to easily convert
  between a 32-bit value and a version number. The encoding is based on
  2.2.2 in "Firmware interfaces for mitigation CVE-2017-5715" (ARM DEN 0070A).

  Also re-use them to define ARM_SMCCC_VERSION_1_0 and ARM_SMCCC_VERSION_1_1.

  Signed-off-by: Julien Grall <julien.grall@arm.com>
  Reviewed-by: Volodymyr Babchuk <volodymyr_babchuk@epam.com>
  Acked-by: Stefano Stabellini <sstabellini@kernel.org>
  52c5d8d3c1657cd8dc1675f8205ca0ecc08b6a51:xen/arm: vsmc: Implement SMCCC_ARCH_WORKAROUND_1 BP hardening support

  SMCCC 1.1 offers firmware-based CPU workarounds. In particular,
  SMCCC_ARCH_WORKAROUND_1 provides BP hardening for variant 2 of XSA-254
  (CVE-2017-5715).

  If the hypervisor has some mitigation for this issue, report that we
  deal with it using SMCCC_ARCH_WORKAROUND_1, as we apply the hypervisor
  workaround on every guest exit.

  Signed-off-by: Julien Grall <julien.grall@arm.com>
  Reviewed-by: Volodymyr Babchuk <volodymyr.babchuk@epam.com>
  Acked-by: Stefano Stabellini <sstabellini@kernel.org>
  Reviewed-by: Andre Przywara <andre.przywara@arm.com>
  3af378feac5bb504387dd6bc232b9c64a8a376d9:xen/arm: vsmc: Implement SMCCC 1.1

  The new SMC Calling Convention (v1.1) allows for a reduced overhead when
  calling into the firmware, and provides a new feature discovery
  mechanism. See "Firmware interfaces for mitigating CVE-2017-5715"
  ARM DEN 00070A.

  Signed-off-by: Julien Grall <julien.grall@arm.com>
  Reviewed-by: Volodymyr Babchuk <volodymyr.babchuk@epam.com>
  Acked-by: Stefano Stabellini <sstabellini@kernel.org>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 7f9ebebcec5077714830aa09df0bf25f77ca692e
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 52c5d8d3c1657cd8dc1675f8205ca0ecc08b6a51
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 479fab92d356e5a09f5db4596017419cf4023a9f
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 3af378feac5bb504387dd6bc232b9c64a8a376d9
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 6b270fae7ad462687550a875f714bff18d764416
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: df71252060147447d00e36eb37806e8b75a1b4c7
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 2e34343fb2c8b62e8e98b21a569beea508f501f6
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 9746779afb665fc3ba18e0bffc090474e33fe043
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/2e34343fb2c8b62e8e98b21a569beea508f501f6
    reference_type: commit
    reference_id: 2e34343fb2c8b62e8e98b21a569beea508f501f6
  - url: https://github.com/xen-project/xen/tree/3af378feac5bb504387dd6bc232b9c64a8a376d9
    reference_type: commit
    reference_id: 3af378feac5bb504387dd6bc232b9c64a8a376d9
  - url: https://github.com/xen-project/xen/tree/479fab92d356e5a09f5db4596017419cf4023a9f
    reference_type: commit
    reference_id: 479fab92d356e5a09f5db4596017419cf4023a9f
  - url: https://github.com/xen-project/xen/tree/52c5d8d3c1657cd8dc1675f8205ca0ecc08b6a51
    reference_type: commit
    reference_id: 52c5d8d3c1657cd8dc1675f8205ca0ecc08b6a51
  - url: https://github.com/xen-project/xen/tree/6b270fae7ad462687550a875f714bff18d764416
    reference_type: commit
    reference_id: 6b270fae7ad462687550a875f714bff18d764416
  - url: https://github.com/xen-project/xen/tree/7f9ebebcec5077714830aa09df0bf25f77ca692e
    reference_type: commit
    reference_id: 7f9ebebcec5077714830aa09df0bf25f77ca692e
  - url: https://github.com/xen-project/xen/tree/9746779afb665fc3ba18e0bffc090474e33fe043
    reference_type: commit
    reference_id: 9746779afb665fc3ba18e0bffc090474e33fe043
  - url: https://github.com/xen-project/xen/tree/df71252060147447d00e36eb37806e8b75a1b4c7
    reference_type: commit
    reference_id: df71252060147447d00e36eb37806e8b75a1b4c7
