advisory_id: CVE-2013-1432
datasource_id: collect_xen_project_fix_commits/CVE-2013-1432
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  4552269c2bb3d34a3f3102f72c0edc82c70138ad:x86: fix page refcount handling in page table pin error path

  In the original patch 7 of the series addressing XSA-45 I mistakenly
  took the addition of the call to get_page_light() in alloc_page_type()
  to cover two decrements that would happen: One for the PGT_partial bit
  that is getting set along with the call, and the other for the page
  reference the caller hold (and would be dropping on its error path).
  But of course the additional page reference is tied to the PGT_partial
  bit, and hence any caller of a function that may leave
  ->arch.old_guest_table non-NULL for error cleanup purposes has to make
  sure a respective page reference gets retained.

  Similar issues were then also spotted elsewhere: In effect all callers
  of get_page_type_preemptible() need to deal with errors in similar
  ways. To make sure error handling can work this way without leaking
  page references, a respective assertion gets added to that function.

  This is CVE-2013-1432 / XSA-58.

  Reported-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Tested-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  master commit: 9b167bd2f394f821ae3252d74a15704a4bf91f6d
  master date: 2013-06-26 15:32:58 +0200
  63a1ea8506d520881e4f7426b39774dce4be1ff9:x86: fix page refcount handling in page table pin error path

  In the original patch 7 of the series addressing XSA-45 I mistakenly
  took the addition of the call to get_page_light() in alloc_page_type()
  to cover two decrements that would happen: One for the PGT_partial bit
  that is getting set along with the call, and the other for the page
  reference the caller hold (and would be dropping on its error path).
  But of course the additional page reference is tied to the PGT_partial
  bit, and hence any caller of a function that may leave
  ->arch.old_guest_table non-NULL for error cleanup purposes has to make
  sure a respective page reference gets retained.

  Similar issues were then also spotted elsewhere: In effect all callers
  of get_page_type_preemptible() need to deal with errors in similar
  ways. To make sure error handling can work this way without leaking
  page references, a respective assertion gets added to that function.

  This is CVE-2013-1432 / XSA-58.

  Reported-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Tested-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  master commit: 9b167bd2f394f821ae3252d74a15704a4bf91f6d
  master date: 2013-06-26 15:32:58 +0200
  9b167bd2f394f821ae3252d74a15704a4bf91f6d:x86: fix page refcount handling in page table pin error path

  In the original patch 7 of the series addressing XSA-45 I mistakenly
  took the addition of the call to get_page_light() in alloc_page_type()
  to cover two decrements that would happen: One for the PGT_partial bit
  that is getting set along with the call, and the other for the page
  reference the caller hold (and would be dropping on its error path).
  But of course the additional page reference is tied to the PGT_partial
  bit, and hence any caller of a function that may leave
  ->arch.old_guest_table non-NULL for error cleanup purposes has to make
  sure a respective page reference gets retained.

  Similar issues were then also spotted elsewhere: In effect all callers
  of get_page_type_preemptible() need to deal with errors in similar
  ways. To make sure error handling can work this way without leaking
  page references, a respective assertion gets added to that function.

  This is CVE-2013-1432 / XSA-58.

  Reported-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Tested-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 9b167bd2f394f821ae3252d74a15704a4bf91f6d
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 4552269c2bb3d34a3f3102f72c0edc82c70138ad
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 63a1ea8506d520881e4f7426b39774dce4be1ff9
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/4552269c2bb3d34a3f3102f72c0edc82c70138ad
    reference_type: commit
    reference_id: 4552269c2bb3d34a3f3102f72c0edc82c70138ad
  - url: https://github.com/xen-project/xen/tree/63a1ea8506d520881e4f7426b39774dce4be1ff9
    reference_type: commit
    reference_id: 63a1ea8506d520881e4f7426b39774dce4be1ff9
  - url: https://github.com/xen-project/xen/tree/9b167bd2f394f821ae3252d74a15704a4bf91f6d
    reference_type: commit
    reference_id: 9b167bd2f394f821ae3252d74a15704a4bf91f6d
