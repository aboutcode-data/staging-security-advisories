advisory_id: CVE-2013-4356
datasource_id: collect_xen_project_fix_commits/CVE-2013-4356
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  0155524aa6bf4ea4947c865dee4b13dd3dec6427:x86/mm/shadow: Fix initialization of PV shadow L4 tables.

  Shadowed PV L4 tables must have the same Xen mappings as their
  unshadowed equivalent.  This is done by copying the Xen entries
  verbatim from the idle pagetable, and then using guest_l4_slot()
  in the SHADOW_FOREACH_L4E() iterator to avoid touching those entries.

  adc5afbf1c70ef55c260fb93e4b8ce5ccb918706 (x86: support up to 16Tb)
  changed the definition of ROOT_PAGETABLE_XEN_SLOTS to extend right to
  the top of the address space, which causes the shadow code to
  copy Xen mappings into guest-kernel-address slots too.

  In the common case, all those slots are zero in the idle pagetable,
  and no harm is done.  But if any slot above #271 is non-zero, Xen will
  crash when that slot is later cleared (it attempts to drop
  shadow-pagetable refcounts on its own L4 pagetables).

  Fix by using the new ROOT_PAGETABLE_PV_XEN_SLOTS when appropriate.
  Monitor pagetables need the full Xen mappings, so they keep using the
  old name (with its new semantics).

  This is CVE-2013-4356 / XSA-64.

  Signed-off-by: Tim Deegan <tim@xen.org>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  master commit: f46befdd825c8a459c5eb21adb7d5b0dc6e30ad5
  master date: 2013-09-30 14:18:25 +0200
  f46befdd825c8a459c5eb21adb7d5b0dc6e30ad5:x86/mm/shadow: Fix initialization of PV shadow L4 tables.

  Shadowed PV L4 tables must have the same Xen mappings as their
  unshadowed equivalent.  This is done by copying the Xen entries
  verbatim from the idle pagetable, and then using guest_l4_slot()
  in the SHADOW_FOREACH_L4E() iterator to avoid touching those entries.

  adc5afbf1c70ef55c260fb93e4b8ce5ccb918706 (x86: support up to 16Tb)
  changed the definition of ROOT_PAGETABLE_XEN_SLOTS to extend right to
  the top of the address space, which causes the shadow code to
  copy Xen mappings into guest-kernel-address slots too.

  In the common case, all those slots are zero in the idle pagetable,
  and no harm is done.  But if any slot above #271 is non-zero, Xen will
  crash when that slot is later cleared (it attempts to drop
  shadow-pagetable refcounts on its own L4 pagetables).

  Fix by using the new ROOT_PAGETABLE_PV_XEN_SLOTS when appropriate.
  Monitor pagetables need the full Xen mappings, so they keep using the
  old name (with its new semantics).

  This is CVE-2013-4356 / XSA-64.

  Signed-off-by: Tim Deegan <tim@xen.org>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 0155524aa6bf4ea4947c865dee4b13dd3dec6427
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: f46befdd825c8a459c5eb21adb7d5b0dc6e30ad5
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/0155524aa6bf4ea4947c865dee4b13dd3dec6427
    reference_type: commit
    reference_id: 0155524aa6bf4ea4947c865dee4b13dd3dec6427
  - url: https://github.com/xen-project/xen/tree/f46befdd825c8a459c5eb21adb7d5b0dc6e30ad5
    reference_type: commit
    reference_id: f46befdd825c8a459c5eb21adb7d5b0dc6e30ad5
