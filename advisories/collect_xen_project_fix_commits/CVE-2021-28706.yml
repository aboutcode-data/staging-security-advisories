advisory_id: CVE-2021-28706
datasource_id: collect_xen_project_fix_commits/CVE-2021-28706
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  8e657cfe0aec6c2bf548cae98a97d2485304d4c6:xen/page_alloc: Harden assign_pages()

  domain_tot_pages() and d->max_pages are 32-bit values. While the order
  should always be quite small, it would still be possible to overflow
  if domain_tot_pages() is near to (2^32 - 1).

  As this code may be called by a guest via XENMEM_increase_reservation
  and XENMEM_populate_physmap, we want to make sure the guest is not going
  to be able to allocate more than it is allowed.

  Rework the allocation check to avoid any possible overflow. While the
  check domain_tot_pages() < d->max_pages should technically not be
  necessary, it is probably best to have it to catch any possible
  inconsistencies in the future.

  This is CVE-2021-28706 / part of XSA-385.

  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
  master commit: 143501861d48e1bfef495849fd68584baac05849
  master date: 2021-11-22 11:11:05 +0000
  0b28069aa7c26288376040e6ee9ca145245db39e:xen/page_alloc: Harden assign_pages()

  domain_tot_pages() and d->max_pages are 32-bit values. While the order
  should always be quite small, it would still be possible to overflow
  if domain_tot_pages() is near to (2^32 - 1).

  As this code may be called by a guest via XENMEM_increase_reservation
  and XENMEM_populate_physmap, we want to make sure the guest is not going
  to be able to allocate more than it is allowed.

  Rework the allocation check to avoid any possible overflow. While the
  check domain_tot_pages() < d->max_pages should technically not be
  necessary, it is probably best to have it to catch any possible
  inconsistencies in the future.

  This is CVE-2021-28706 / part of XSA-385.

  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
  master commit: 143501861d48e1bfef495849fd68584baac05849
  master date: 2021-11-22 11:11:05 +0000
  497bd4aadf0c1a3fa2876352e25999c5803c512d:xen/page_alloc: Harden assign_pages()

  domain_tot_pages() and d->max_pages are 32-bit values. While the order
  should always be quite small, it would still be possible to overflow
  if domain_tot_pages() is near to (2^32 - 1).

  As this code may be called by a guest via XENMEM_increase_reservation
  and XENMEM_populate_physmap, we want to make sure the guest is not going
  to be able to allocate more than it is allowed.

  Rework the allocation check to avoid any possible overflow. While the
  check domain_tot_pages() < d->max_pages should technically not be
  necessary, it is probably best to have it to catch any possible
  inconsistencies in the future.

  This is CVE-2021-28706 / part of XSA-385.

  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
  master commit: 143501861d48e1bfef495849fd68584baac05849
  master date: 2021-11-22 11:11:05 +0000
  d02631a21530918501f7e11320667dde7829cbb5:xen/page_alloc: Harden assign_pages()

  domain_tot_pages() and d->max_pages are 32-bit values. While the order
  should always be quite small, it would still be possible to overflow
  if domain_tot_pages() is near to (2^32 - 1).

  As this code may be called by a guest via XENMEM_increase_reservation
  and XENMEM_populate_physmap, we want to make sure the guest is not going
  to be able to allocate more than it is allowed.

  Rework the allocation check to avoid any possible overflow. While the
  check domain_tot_pages() < d->max_pages should technically not be
  necessary, it is probably best to have it to catch any possible
  inconsistencies in the future.

  This is CVE-2021-28706 / part of XSA-385.

  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
  master commit: 143501861d48e1bfef495849fd68584baac05849
  master date: 2021-11-22 11:11:05 +0000
  143501861d48e1bfef495849fd68584baac05849:xen/page_alloc: Harden assign_pages()

  domain_tot_pages() and d->max_pages are 32-bit values. While the order
  should always be quite small, it would still be possible to overflow
  if domain_tot_pages() is near to (2^32 - 1).

  As this code may be called by a guest via XENMEM_increase_reservation
  and XENMEM_populate_physmap, we want to make sure the guest is not going
  to be able to allocate more than it is allowed.

  Rework the allocation check to avoid any possible overflow. While the
  check domain_tot_pages() < d->max_pages should technically not be
  necessary, it is probably best to have it to catch any possible
  inconsistencies in the future.

  This is CVE-2021-28706 / part of XSA-385.

  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 8e657cfe0aec6c2bf548cae98a97d2485304d4c6
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 497bd4aadf0c1a3fa2876352e25999c5803c512d
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: d02631a21530918501f7e11320667dde7829cbb5
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 0b28069aa7c26288376040e6ee9ca145245db39e
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 143501861d48e1bfef495849fd68584baac05849
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/0b28069aa7c26288376040e6ee9ca145245db39e
    reference_type: commit
    reference_id: 0b28069aa7c26288376040e6ee9ca145245db39e
  - url: https://github.com/xen-project/xen/tree/143501861d48e1bfef495849fd68584baac05849
    reference_type: commit
    reference_id: 143501861d48e1bfef495849fd68584baac05849
  - url: https://github.com/xen-project/xen/tree/497bd4aadf0c1a3fa2876352e25999c5803c512d
    reference_type: commit
    reference_id: 497bd4aadf0c1a3fa2876352e25999c5803c512d
  - url: https://github.com/xen-project/xen/tree/8e657cfe0aec6c2bf548cae98a97d2485304d4c6
    reference_type: commit
    reference_id: 8e657cfe0aec6c2bf548cae98a97d2485304d4c6
  - url: https://github.com/xen-project/xen/tree/d02631a21530918501f7e11320667dde7829cbb5
    reference_type: commit
    reference_id: d02631a21530918501f7e11320667dde7829cbb5
