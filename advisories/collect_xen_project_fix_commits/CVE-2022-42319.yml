advisory_id: CVE-2022-42319
datasource_id: collect_xen_project_fix_commits/CVE-2022-42319
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  2fdf8740b9f47e424952869406261962db428b97:tools/xenstore: don't use conn->in as context for temporary allocations

  Using the struct buffered data pointer of the current processed request
  for temporary data allocations has a major drawback: the used area (and
  with that the temporary data) is freed only after the response of the
  request has been written to the ring page or has been read via the
  socket. This can happen much later in case a guest isn't reading its
  responses fast enough.

  As the temporary data can be safely freed after creating the response,
  add a temporary context for that purpose and use that for allocating
  the temporary memory, as it was already the case before commit
  cc0612464896 ("xenstore: add small default data buffer to internal
  struct").

  Some sub-functions need to gain the "const" attribute for the talloc
  context.

  This is XSA-416 / CVE-2022-42319.

  Fixes: cc0612464896 ("xenstore: add small default data buffer to internal struct")
  Signed-off-by: Juergen Gross <jgross@suse.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
  (cherry picked from commit 2a587de219cc0765330fbf9fac6827bfaf29e29b)
  55e23bf410bf20d27ef5555a73eab2a8a2602b39:tools/xenstore: don't use conn->in as context for temporary allocations

  Using the struct buffered data pointer of the current processed request
  for temporary data allocations has a major drawback: the used area (and
  with that the temporary data) is freed only after the response of the
  request has been written to the ring page or has been read via the
  socket. This can happen much later in case a guest isn't reading its
  responses fast enough.

  As the temporary data can be safely freed after creating the response,
  add a temporary context for that purpose and use that for allocating
  the temporary memory, as it was already the case before commit
  cc0612464896 ("xenstore: add small default data buffer to internal
  struct").

  Some sub-functions need to gain the "const" attribute for the talloc
  context.

  This is XSA-416 / CVE-2022-42319.

  Fixes: cc0612464896 ("xenstore: add small default data buffer to internal struct")
  Signed-off-by: Juergen Gross <jgross@suse.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
  (cherry picked from commit 2a587de219cc0765330fbf9fac6827bfaf29e29b)
  607e186fe094f8d1c78572cd3b1f7a43730203c1:tools/xenstore: don't use conn->in as context for temporary allocations

  Using the struct buffered data pointer of the current processed request
  for temporary data allocations has a major drawback: the used area (and
  with that the temporary data) is freed only after the response of the
  request has been written to the ring page or has been read via the
  socket. This can happen much later in case a guest isn't reading its
  responses fast enough.

  As the temporary data can be safely freed after creating the response,
  add a temporary context for that purpose and use that for allocating
  the temporary memory, as it was already the case before commit
  cc0612464896 ("xenstore: add small default data buffer to internal
  struct").

  Some sub-functions need to gain the "const" attribute for the talloc
  context.

  This is XSA-416 / CVE-2022-42319.

  Fixes: cc0612464896 ("xenstore: add small default data buffer to internal struct")
  Signed-off-by: Juergen Gross <jgross@suse.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
  (cherry picked from commit 2a587de219cc0765330fbf9fac6827bfaf29e29b)
  c758765e464e166b5495c76466facc79584bbe1e:tools/xenstore: don't use conn->in as context for temporary allocations

  Using the struct buffered data pointer of the current processed request
  for temporary data allocations has a major drawback: the used area (and
  with that the temporary data) is freed only after the response of the
  request has been written to the ring page or has been read via the
  socket. This can happen much later in case a guest isn't reading its
  responses fast enough.

  As the temporary data can be safely freed after creating the response,
  add a temporary context for that purpose and use that for allocating
  the temporary memory, as it was already the case before commit
  cc0612464896 ("xenstore: add small default data buffer to internal
  struct").

  Some sub-functions need to gain the "const" attribute for the talloc
  context.

  This is XSA-416 / CVE-2022-42319.

  Fixes: cc0612464896 ("xenstore: add small default data buffer to internal struct")
  Signed-off-by: Juergen Gross <jgross@suse.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
  (cherry picked from commit 2a587de219cc0765330fbf9fac6827bfaf29e29b)
  2a587de219cc0765330fbf9fac6827bfaf29e29b:tools/xenstore: don't use conn->in as context for temporary allocations

  Using the struct buffered data pointer of the current processed request
  for temporary data allocations has a major drawback: the used area (and
  with that the temporary data) is freed only after the response of the
  request has been written to the ring page or has been read via the
  socket. This can happen much later in case a guest isn't reading its
  responses fast enough.

  As the temporary data can be safely freed after creating the response,
  add a temporary context for that purpose and use that for allocating
  the temporary memory, as it was already the case before commit
  cc0612464896 ("xenstore: add small default data buffer to internal
  struct").

  Some sub-functions need to gain the "const" attribute for the talloc
  context.

  This is XSA-416 / CVE-2022-42319.

  Fixes: cc0612464896 ("xenstore: add small default data buffer to internal struct")
  Signed-off-by: Juergen Gross <jgross@suse.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: c758765e464e166b5495c76466facc79584bbe1e
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 2a587de219cc0765330fbf9fac6827bfaf29e29b
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 2fdf8740b9f47e424952869406261962db428b97
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 55e23bf410bf20d27ef5555a73eab2a8a2602b39
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 607e186fe094f8d1c78572cd3b1f7a43730203c1
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/2a587de219cc0765330fbf9fac6827bfaf29e29b
    reference_type: commit
    reference_id: 2a587de219cc0765330fbf9fac6827bfaf29e29b
  - url: https://github.com/xen-project/xen/tree/2fdf8740b9f47e424952869406261962db428b97
    reference_type: commit
    reference_id: 2fdf8740b9f47e424952869406261962db428b97
  - url: https://github.com/xen-project/xen/tree/55e23bf410bf20d27ef5555a73eab2a8a2602b39
    reference_type: commit
    reference_id: 55e23bf410bf20d27ef5555a73eab2a8a2602b39
  - url: https://github.com/xen-project/xen/tree/607e186fe094f8d1c78572cd3b1f7a43730203c1
    reference_type: commit
    reference_id: 607e186fe094f8d1c78572cd3b1f7a43730203c1
  - url: https://github.com/xen-project/xen/tree/c758765e464e166b5495c76466facc79584bbe1e
    reference_type: commit
    reference_id: c758765e464e166b5495c76466facc79584bbe1e
