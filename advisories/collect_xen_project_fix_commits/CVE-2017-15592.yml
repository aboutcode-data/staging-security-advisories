advisory_id: CVE-2017-15592
datasource_id: collect_xen_project_fix_commits/CVE-2017-15592
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  41f6dd05d10fd1b4281c1722e2d8f29e378abe9a:x86/shadow: correct SH_LINEAR mapping detection in sh_guess_wrmap()

  The fix for XSA-243 / CVE-2017-15592 (c/s bf2b4eadcf379) introduced a change
  in behaviour for sh_guest_wrmap(), where it had to cope with no shadow linear
  mapping being present.

  As the name suggests, guest_vtable is a mapping of the guests pagetable, not
  Xen's pagetable, meaning that it isn't the pagetable we need to check for the
  shadow linear slot in.

  The practical upshot is that a shadow HVM vcpu which switches into 4-level
  paging mode, with an L4 pagetable that contains a mapping which aliases Xen's
  SH_LINEAR_PT_VIRT_START will fool the safety check for whether a SHADOW_LINEAR
  mapping is present.  As the check passes (when it should have failed), Xen
  subsequently falls over the missing mapping with a pagefault such as:

      (XEN) Pagetable walk from ffff8140a0503880:
      (XEN)  L4[0x102] = 000000046c218063 ffffffffffffffff
      (XEN)  L3[0x102] = 000000046c218063 ffffffffffffffff
      (XEN)  L2[0x102] = 000000046c218063 ffffffffffffffff
      (XEN)  L1[0x103] = 0000000000000000 ffffffffffffffff

  This is part of XSA-243.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  9b0c2a223132a07f06f0be8e85da390defe998f5:x86/shadow: correct SH_LINEAR mapping detection in sh_guess_wrmap()

  The fix for XSA-243 / CVE-2017-15592 (c/s bf2b4eadcf379) introduced a change
  in behaviour for sh_guest_wrmap(), where it had to cope with no shadow linear
  mapping being present.

  As the name suggests, guest_vtable is a mapping of the guests pagetable, not
  Xen's pagetable, meaning that it isn't the pagetable we need to check for the
  shadow linear slot in.

  The practical upshot is that a shadow HVM vcpu which switches into 4-level
  paging mode, with an L4 pagetable that contains a mapping which aliases Xen's
  SH_LINEAR_PT_VIRT_START will fool the safety check for whether a SHADOW_LINEAR
  mapping is present.  As the check passes (when it should have failed), Xen
  subsequently falls over the missing mapping with a pagefault such as:

      (XEN) Pagetable walk from ffff8140a0503880:
      (XEN)  L4[0x102] = 000000046c218063 ffffffffffffffff
      (XEN)  L3[0x102] = 000000046c218063 ffffffffffffffff
      (XEN)  L2[0x102] = 000000046c218063 ffffffffffffffff
      (XEN)  L1[0x103] = 0000000000000000 ffffffffffffffff

  This is part of XSA-243.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  259a5c3000d840f244dbb30f2b47b95f2dc0f80f:x86/shadow: correct SH_LINEAR mapping detection in sh_guess_wrmap()

  The fix for XSA-243 / CVE-2017-15592 (c/s bf2b4eadcf379) introduced a change
  in behaviour for sh_guest_wrmap(), where it had to cope with no shadow linear
  mapping being present.

  As the name suggests, guest_vtable is a mapping of the guests pagetable, not
  Xen's pagetable, meaning that it isn't the pagetable we need to check for the
  shadow linear slot in.

  The practical upshot is that a shadow HVM vcpu which switches into 4-level
  paging mode, with an L4 pagetable that contains a mapping which aliases Xen's
  SH_LINEAR_PT_VIRT_START will fool the safety check for whether a SHADOW_LINEAR
  mapping is present.  As the check passes (when it should have failed), Xen
  subsequently falls over the missing mapping with a pagefault such as:

      (XEN) Pagetable walk from ffff8140a0503880:
      (XEN)  L4[0x102] = 000000046c218063 ffffffffffffffff
      (XEN)  L3[0x102] = 000000046c218063 ffffffffffffffff
      (XEN)  L2[0x102] = 000000046c218063 ffffffffffffffff
      (XEN)  L1[0x103] = 0000000000000000 ffffffffffffffff

  This is part of XSA-243.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  master commit: d20daf4294adbdb9316850566013edb98db7bfbc
  master date: 2017-11-16 10:38:14 +0100
  9ba6783e47db71379c5120039b878f605bdf31f3:x86/shadow: correct SH_LINEAR mapping detection in sh_guess_wrmap()

  The fix for XSA-243 / CVE-2017-15592 (c/s bf2b4eadcf379) introduced a change
  in behaviour for sh_guest_wrmap(), where it had to cope with no shadow linear
  mapping being present.

  As the name suggests, guest_vtable is a mapping of the guests pagetable, not
  Xen's pagetable, meaning that it isn't the pagetable we need to check for the
  shadow linear slot in.

  The practical upshot is that a shadow HVM vcpu which switches into 4-level
  paging mode, with an L4 pagetable that contains a mapping which aliases Xen's
  SH_LINEAR_PT_VIRT_START will fool the safety check for whether a SHADOW_LINEAR
  mapping is present.  As the check passes (when it should have failed), Xen
  subsequently falls over the missing mapping with a pagefault such as:

      (XEN) Pagetable walk from ffff8140a0503880:
      (XEN)  L4[0x102] = 000000046c218063 ffffffffffffffff
      (XEN)  L3[0x102] = 000000046c218063 ffffffffffffffff
      (XEN)  L2[0x102] = 000000046c218063 ffffffffffffffff
      (XEN)  L1[0x103] = 0000000000000000 ffffffffffffffff

  This is part of XSA-243.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  master commit: d20daf4294adbdb9316850566013edb98db7bfbc
  master date: 2017-11-16 10:38:14 +0100
  d6ce860bbdf9dbdc88e4f2692e16776a622b2949:x86/shadow: correct SH_LINEAR mapping detection in sh_guess_wrmap()

  The fix for XSA-243 / CVE-2017-15592 (c/s bf2b4eadcf379) introduced a change
  in behaviour for sh_guest_wrmap(), where it had to cope with no shadow linear
  mapping being present.

  As the name suggests, guest_vtable is a mapping of the guests pagetable, not
  Xen's pagetable, meaning that it isn't the pagetable we need to check for the
  shadow linear slot in.

  The practical upshot is that a shadow HVM vcpu which switches into 4-level
  paging mode, with an L4 pagetable that contains a mapping which aliases Xen's
  SH_LINEAR_PT_VIRT_START will fool the safety check for whether a SHADOW_LINEAR
  mapping is present.  As the check passes (when it should have failed), Xen
  subsequently falls over the missing mapping with a pagefault such as:

      (XEN) Pagetable walk from ffff8140a0503880:
      (XEN)  L4[0x102] = 000000046c218063 ffffffffffffffff
      (XEN)  L3[0x102] = 000000046c218063 ffffffffffffffff
      (XEN)  L2[0x102] = 000000046c218063 ffffffffffffffff
      (XEN)  L1[0x103] = 0000000000000000 ffffffffffffffff

  This is part of XSA-243.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  master commit: d20daf4294adbdb9316850566013edb98db7bfbc
  master date: 2017-11-16 10:38:14 +0100
  d20daf4294adbdb9316850566013edb98db7bfbc:x86/shadow: correct SH_LINEAR mapping detection in sh_guess_wrmap()

  The fix for XSA-243 / CVE-2017-15592 (c/s bf2b4eadcf379) introduced a change
  in behaviour for sh_guest_wrmap(), where it had to cope with no shadow linear
  mapping being present.

  As the name suggests, guest_vtable is a mapping of the guests pagetable, not
  Xen's pagetable, meaning that it isn't the pagetable we need to check for the
  shadow linear slot in.

  The practical upshot is that a shadow HVM vcpu which switches into 4-level
  paging mode, with an L4 pagetable that contains a mapping which aliases Xen's
  SH_LINEAR_PT_VIRT_START will fool the safety check for whether a SHADOW_LINEAR
  mapping is present.  As the check passes (when it should have failed), Xen
  subsequently falls over the missing mapping with a pagefault such as:

      (XEN) Pagetable walk from ffff8140a0503880:
      (XEN)  L4[0x102] = 000000046c218063 ffffffffffffffff
      (XEN)  L3[0x102] = 000000046c218063 ffffffffffffffff
      (XEN)  L2[0x102] = 000000046c218063 ffffffffffffffff
      (XEN)  L1[0x103] = 0000000000000000 ffffffffffffffff

  This is part of XSA-243.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 259a5c3000d840f244dbb30f2b47b95f2dc0f80f
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 9ba6783e47db71379c5120039b878f605bdf31f3
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: d20daf4294adbdb9316850566013edb98db7bfbc
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 41f6dd05d10fd1b4281c1722e2d8f29e378abe9a
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 9b0c2a223132a07f06f0be8e85da390defe998f5
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: d6ce860bbdf9dbdc88e4f2692e16776a622b2949
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/259a5c3000d840f244dbb30f2b47b95f2dc0f80f
    reference_type: commit
    reference_id: 259a5c3000d840f244dbb30f2b47b95f2dc0f80f
  - url: https://github.com/xen-project/xen/tree/41f6dd05d10fd1b4281c1722e2d8f29e378abe9a
    reference_type: commit
    reference_id: 41f6dd05d10fd1b4281c1722e2d8f29e378abe9a
  - url: https://github.com/xen-project/xen/tree/9b0c2a223132a07f06f0be8e85da390defe998f5
    reference_type: commit
    reference_id: 9b0c2a223132a07f06f0be8e85da390defe998f5
  - url: https://github.com/xen-project/xen/tree/9ba6783e47db71379c5120039b878f605bdf31f3
    reference_type: commit
    reference_id: 9ba6783e47db71379c5120039b878f605bdf31f3
  - url: https://github.com/xen-project/xen/tree/d20daf4294adbdb9316850566013edb98db7bfbc
    reference_type: commit
    reference_id: d20daf4294adbdb9316850566013edb98db7bfbc
  - url: https://github.com/xen-project/xen/tree/d6ce860bbdf9dbdc88e4f2692e16776a622b2949
    reference_type: commit
    reference_id: d6ce860bbdf9dbdc88e4f2692e16776a622b2949
