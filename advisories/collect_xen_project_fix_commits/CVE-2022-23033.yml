advisory_id: CVE-2022-23033
datasource_id: collect_xen_project_fix_commits/CVE-2022-23033
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  98c733b435f938c6d1be33c9f8975ba046fe198b:xen/arm: p2m: Always clear the P2M entry when the mapping is removed

  Commit 2148a125b73b ("xen/arm: Track page accessed between batch of
  Set/Way operations") allowed an entry to be invalid from the CPU PoV
  (lpae_is_valid()) but valid for Xen (p2m_is_valid()). This is useful
  to track which page is accessed and only perform an action on them
  (e.g. clean & invalidate the cache after a set/way instruction).

  Unfortunately, __p2m_set_entry() is only zeroing the P2M entry when
  lpae_is_valid() returns true. This means the entry will not be zeroed
  if the entry was valid from Xen PoV but invalid from the CPU PoV for
  tracking purpose.

  As a consequence, this will allow a domain to continue to access the
  page after it was removed.

  Resolve the issue by always zeroing the entry if it the LPAE bit is
  set or the entry is about to be removed.

  This is CVE-2022-23033 / XSA-393.

  Reported-by: Dmytro Firsov <Dmytro_Firsov@epam.com>
  Fixes: 2148a125b73b ("xen/arm: Track page accessed between batch of Set/Way operations")
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  master commit: a428b913a002eb2b7425b48029c20a52eeee1b5a
  master date: 2022-01-25 13:25:01 +0100
  2d601a5ca15e02820d08232ad64add8b8374b81c:xen/arm: p2m: Always clear the P2M entry when the mapping is removed

  Commit 2148a125b73b ("xen/arm: Track page accessed between batch of
  Set/Way operations") allowed an entry to be invalid from the CPU PoV
  (lpae_is_valid()) but valid for Xen (p2m_is_valid()). This is useful
  to track which page is accessed and only perform an action on them
  (e.g. clean & invalidate the cache after a set/way instruction).

  Unfortunately, __p2m_set_entry() is only zeroing the P2M entry when
  lpae_is_valid() returns true. This means the entry will not be zeroed
  if the entry was valid from Xen PoV but invalid from the CPU PoV for
  tracking purpose.

  As a consequence, this will allow a domain to continue to access the
  page after it was removed.

  Resolve the issue by always zeroing the entry if it the LPAE bit is
  set or the entry is about to be removed.

  This is CVE-2022-23033 / XSA-393.

  Reported-by: Dmytro Firsov <Dmytro_Firsov@epam.com>
  Fixes: 2148a125b73b ("xen/arm: Track page accessed between batch of Set/Way operations")
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  master commit: a428b913a002eb2b7425b48029c20a52eeee1b5a
  master date: 2022-01-25 13:25:01 +0100
  861e27398c1da53e1c483c5dde12ad019ced6786:xen/arm: p2m: Always clear the P2M entry when the mapping is removed

  Commit 2148a125b73b ("xen/arm: Track page accessed between batch of
  Set/Way operations") allowed an entry to be invalid from the CPU PoV
  (lpae_is_valid()) but valid for Xen (p2m_is_valid()). This is useful
  to track which page is accessed and only perform an action on them
  (e.g. clean & invalidate the cache after a set/way instruction).

  Unfortunately, __p2m_set_entry() is only zeroing the P2M entry when
  lpae_is_valid() returns true. This means the entry will not be zeroed
  if the entry was valid from Xen PoV but invalid from the CPU PoV for
  tracking purpose.

  As a consequence, this will allow a domain to continue to access the
  page after it was removed.

  Resolve the issue by always zeroing the entry if it the LPAE bit is
  set or the entry is about to be removed.

  This is CVE-2022-23033 / XSA-393.

  Reported-by: Dmytro Firsov <Dmytro_Firsov@epam.com>
  Fixes: 2148a125b73b ("xen/arm: Track page accessed between batch of Set/Way operations")
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  master commit: a428b913a002eb2b7425b48029c20a52eeee1b5a
  master date: 2022-01-25 13:25:01 +0100
  53220c4f9db70331284424ff5ff5f286dd3fbc16:xen/arm: p2m: Always clear the P2M entry when the mapping is removed

  Commit 2148a125b73b ("xen/arm: Track page accessed between batch of
  Set/Way operations") allowed an entry to be invalid from the CPU PoV
  (lpae_is_valid()) but valid for Xen (p2m_is_valid()). This is useful
  to track which page is accessed and only perform an action on them
  (e.g. clean & invalidate the cache after a set/way instruction).

  Unfortunately, __p2m_set_entry() is only zeroing the P2M entry when
  lpae_is_valid() returns true. This means the entry will not be zeroed
  if the entry was valid from Xen PoV but invalid from the CPU PoV for
  tracking purpose.

  As a consequence, this will allow a domain to continue to access the
  page after it was removed.

  Resolve the issue by always zeroing the entry if it the LPAE bit is
  set or the entry is about to be removed.

  This is CVE-2022-23033 / XSA-393.

  Reported-by: Dmytro Firsov <Dmytro_Firsov@epam.com>
  Fixes: 2148a125b73b ("xen/arm: Track page accessed between batch of Set/Way operations")
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  master commit: a428b913a002eb2b7425b48029c20a52eeee1b5a
  master date: 2022-01-25 13:25:01 +0100
  acdb6744460c6264785c031a37d99b8557c56195:xen/arm: p2m: Always clear the P2M entry when the mapping is removed

  Commit 2148a125b73b ("xen/arm: Track page accessed between batch of
  Set/Way operations") allowed an entry to be invalid from the CPU PoV
  (lpae_is_valid()) but valid for Xen (p2m_is_valid()). This is useful
  to track which page is accessed and only perform an action on them
  (e.g. clean & invalidate the cache after a set/way instruction).

  Unfortunately, __p2m_set_entry() is only zeroing the P2M entry when
  lpae_is_valid() returns true. This means the entry will not be zeroed
  if the entry was valid from Xen PoV but invalid from the CPU PoV for
  tracking purpose.

  As a consequence, this will allow a domain to continue to access the
  page after it was removed.

  Resolve the issue by always zeroing the entry if it the LPAE bit is
  set or the entry is about to be removed.

  This is CVE-2022-23033 / XSA-393.

  Reported-by: Dmytro Firsov <Dmytro_Firsov@epam.com>
  Fixes: 2148a125b73b ("xen/arm: Track page accessed between batch of Set/Way operations")
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  master commit: a428b913a002eb2b7425b48029c20a52eeee1b5a
  master date: 2022-01-25 13:25:01 +0100
  a428b913a002eb2b7425b48029c20a52eeee1b5a:xen/arm: p2m: Always clear the P2M entry when the mapping is removed

  Commit 2148a125b73b ("xen/arm: Track page accessed between batch of
  Set/Way operations") allowed an entry to be invalid from the CPU PoV
  (lpae_is_valid()) but valid for Xen (p2m_is_valid()). This is useful
  to track which page is accessed and only perform an action on them
  (e.g. clean & invalidate the cache after a set/way instruction).

  Unfortunately, __p2m_set_entry() is only zeroing the P2M entry when
  lpae_is_valid() returns true. This means the entry will not be zeroed
  if the entry was valid from Xen PoV but invalid from the CPU PoV for
  tracking purpose.

  As a consequence, this will allow a domain to continue to access the
  page after it was removed.

  Resolve the issue by always zeroing the entry if it the LPAE bit is
  set or the entry is about to be removed.

  This is CVE-2022-23033 / XSA-393.

  Reported-by: Dmytro Firsov <Dmytro_Firsov@epam.com>
  Fixes: 2148a125b73b ("xen/arm: Track page accessed between batch of Set/Way operations")
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Signed-off-by: Julien Grall <jgrall@amazon.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 98c733b435f938c6d1be33c9f8975ba046fe198b
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: acdb6744460c6264785c031a37d99b8557c56195
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 2d601a5ca15e02820d08232ad64add8b8374b81c
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 861e27398c1da53e1c483c5dde12ad019ced6786
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: a428b913a002eb2b7425b48029c20a52eeee1b5a
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 53220c4f9db70331284424ff5ff5f286dd3fbc16
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/2d601a5ca15e02820d08232ad64add8b8374b81c
    reference_type: commit
    reference_id: 2d601a5ca15e02820d08232ad64add8b8374b81c
  - url: https://github.com/xen-project/xen/tree/53220c4f9db70331284424ff5ff5f286dd3fbc16
    reference_type: commit
    reference_id: 53220c4f9db70331284424ff5ff5f286dd3fbc16
  - url: https://github.com/xen-project/xen/tree/861e27398c1da53e1c483c5dde12ad019ced6786
    reference_type: commit
    reference_id: 861e27398c1da53e1c483c5dde12ad019ced6786
  - url: https://github.com/xen-project/xen/tree/98c733b435f938c6d1be33c9f8975ba046fe198b
    reference_type: commit
    reference_id: 98c733b435f938c6d1be33c9f8975ba046fe198b
  - url: https://github.com/xen-project/xen/tree/a428b913a002eb2b7425b48029c20a52eeee1b5a
    reference_type: commit
    reference_id: a428b913a002eb2b7425b48029c20a52eeee1b5a
  - url: https://github.com/xen-project/xen/tree/acdb6744460c6264785c031a37d99b8557c56195
    reference_type: commit
    reference_id: acdb6744460c6264785c031a37d99b8557c56195
