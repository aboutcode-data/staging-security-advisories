advisory_id: CVE-2022-23824
datasource_id: collect_xen_project_fix_commits/CVE-2022-23824
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  2b27967fb89d7904a1571a2fb963b1c9cac548db:x86/spec-ctrl: Mitigate IBPB not flushing the RSB/RAS

  Introduce spec_ctrl_new_guest_context() to encapsulate all logic pertaining to
  using MSR_PRED_CMD for a new guest context, even if it only has one user
  presently.

  Introduce X86_BUG_IBPB_NO_RET, and use it extend spec_ctrl_new_guest_context()
  with a manual fixup for hardware which mis-implements IBPB.

  This is part of XSA-422 / CVE-2022-23824.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jan Beulich <jbeulich@suse.com>
  24496558e650535bdbd22cc04731e82276cd1b3f:x86/spec-ctrl: Enumeration for IBPB_RET

  The IBPB_RET bit indicates that the CPU's implementation of MSR_PRED_CMD.IBPB
  does flush the RSB/RAS too.

  This is part of XSA-422 / CVE-2022-23824.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jan Beulich <jbeulich@suse.com>
  1151d260d7a0186978b80b708fcb712eb1470f49:x86/spec-ctrl: Mitigate IBPB not flushing the RSB/RAS

  Introduce spec_ctrl_new_guest_context() to encapsulate all logic pertaining to
  using MSR_PRED_CMD for a new guest context, even if it only has one user
  presently.

  Introduce X86_BUG_IBPB_NO_RET, and use it extend spec_ctrl_new_guest_context()
  with a manual fixup for hardware which mis-implements IBPB.

  This is part of XSA-422 / CVE-2022-23824.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit 2b27967fb89d7904a1571a2fb963b1c9cac548db)
  c0de5d3b482d5ac84998ee44201796bc49be61ac:x86/spec-ctrl: Enumeration for IBPB_RET

  The IBPB_RET bit indicates that the CPU's implementation of MSR_PRED_CMD.IBPB
  does flush the RSB/RAS too.

  This is part of XSA-422 / CVE-2022-23824.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit 24496558e650535bdbd22cc04731e82276cd1b3f)
  46040a5fe68831530b8ffdea7d264e52ae316c87:x86/spec-ctrl: Mitigate IBPB not flushing the RSB/RAS

  Introduce spec_ctrl_new_guest_context() to encapsulate all logic pertaining to
  using MSR_PRED_CMD for a new guest context, even if it only has one user
  presently.

  Introduce X86_BUG_IBPB_NO_RET, and use it extend spec_ctrl_new_guest_context()
  with a manual fixup for hardware which mis-implements IBPB.

  This is part of XSA-422 / CVE-2022-23824.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit 2b27967fb89d7904a1571a2fb963b1c9cac548db)
  013a27047ca63834236bfd38ba4d3a8b9d828781:x86/spec-ctrl: Enumeration for IBPB_RET

  The IBPB_RET bit indicates that the CPU's implementation of MSR_PRED_CMD.IBPB
  does flush the RSB/RAS too.

  This is part of XSA-422 / CVE-2022-23824.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit 24496558e650535bdbd22cc04731e82276cd1b3f)
  32445f23fea6a533fc1d7ade5871246d75210bf1:x86/spec-ctrl: Mitigate IBPB not flushing the RSB/RAS

  Introduce spec_ctrl_new_guest_context() to encapsulate all logic pertaining to
  using MSR_PRED_CMD for a new guest context, even if it only has one user
  presently.

  Introduce X86_BUG_IBPB_NO_RET, and use it extend spec_ctrl_new_guest_context()
  with a manual fixup for hardware which mis-implements IBPB.

  This is part of XSA-422 / CVE-2022-23824.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit 2b27967fb89d7904a1571a2fb963b1c9cac548db)
  07be0fe497349ed423c5201bdc410b6281ebf04f:x86/spec-ctrl: Enumeration for IBPB_RET

  The IBPB_RET bit indicates that the CPU's implementation of MSR_PRED_CMD.IBPB
  does flush the RSB/RAS too.

  This is part of XSA-422 / CVE-2022-23824.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit 24496558e650535bdbd22cc04731e82276cd1b3f)
  c1e196ab490b47ce42037c2fef8184a19d96922b:x86/spec-ctrl: Mitigate IBPB not flushing the RSB/RAS

  Introduce spec_ctrl_new_guest_context() to encapsulate all logic pertaining to
  using MSR_PRED_CMD for a new guest context, even if it only has one user
  presently.

  Introduce X86_BUG_IBPB_NO_RET, and use it extend spec_ctrl_new_guest_context()
  with a manual fixup for hardware which mis-implements IBPB.

  This is part of XSA-422 / CVE-2022-23824.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit 2b27967fb89d7904a1571a2fb963b1c9cac548db)
  b1a1df345aaf359f305d6d041e571929c9252645:x86/spec-ctrl: Enumeration for IBPB_RET

  The IBPB_RET bit indicates that the CPU's implementation of MSR_PRED_CMD.IBPB
  does flush the RSB/RAS too.

  This is part of XSA-422 / CVE-2022-23824.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit 24496558e650535bdbd22cc04731e82276cd1b3f)
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 013a27047ca63834236bfd38ba4d3a8b9d828781
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 46040a5fe68831530b8ffdea7d264e52ae316c87
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: c0de5d3b482d5ac84998ee44201796bc49be61ac
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 1151d260d7a0186978b80b708fcb712eb1470f49
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 32445f23fea6a533fc1d7ade5871246d75210bf1
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: b1a1df345aaf359f305d6d041e571929c9252645
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 24496558e650535bdbd22cc04731e82276cd1b3f
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: c1e196ab490b47ce42037c2fef8184a19d96922b
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 2b27967fb89d7904a1571a2fb963b1c9cac548db
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 07be0fe497349ed423c5201bdc410b6281ebf04f
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/013a27047ca63834236bfd38ba4d3a8b9d828781
    reference_type: commit
    reference_id: 013a27047ca63834236bfd38ba4d3a8b9d828781
  - url: https://github.com/xen-project/xen/tree/07be0fe497349ed423c5201bdc410b6281ebf04f
    reference_type: commit
    reference_id: 07be0fe497349ed423c5201bdc410b6281ebf04f
  - url: https://github.com/xen-project/xen/tree/1151d260d7a0186978b80b708fcb712eb1470f49
    reference_type: commit
    reference_id: 1151d260d7a0186978b80b708fcb712eb1470f49
  - url: https://github.com/xen-project/xen/tree/24496558e650535bdbd22cc04731e82276cd1b3f
    reference_type: commit
    reference_id: 24496558e650535bdbd22cc04731e82276cd1b3f
  - url: https://github.com/xen-project/xen/tree/2b27967fb89d7904a1571a2fb963b1c9cac548db
    reference_type: commit
    reference_id: 2b27967fb89d7904a1571a2fb963b1c9cac548db
  - url: https://github.com/xen-project/xen/tree/32445f23fea6a533fc1d7ade5871246d75210bf1
    reference_type: commit
    reference_id: 32445f23fea6a533fc1d7ade5871246d75210bf1
  - url: https://github.com/xen-project/xen/tree/46040a5fe68831530b8ffdea7d264e52ae316c87
    reference_type: commit
    reference_id: 46040a5fe68831530b8ffdea7d264e52ae316c87
  - url: https://github.com/xen-project/xen/tree/b1a1df345aaf359f305d6d041e571929c9252645
    reference_type: commit
    reference_id: b1a1df345aaf359f305d6d041e571929c9252645
  - url: https://github.com/xen-project/xen/tree/c0de5d3b482d5ac84998ee44201796bc49be61ac
    reference_type: commit
    reference_id: c0de5d3b482d5ac84998ee44201796bc49be61ac
  - url: https://github.com/xen-project/xen/tree/c1e196ab490b47ce42037c2fef8184a19d96922b
    reference_type: commit
    reference_id: c1e196ab490b47ce42037c2fef8184a19d96922b
