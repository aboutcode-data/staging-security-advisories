advisory_id: CVE-2024-31143
datasource_id: collect_xen_project_fix_commits/CVE-2024-31143
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  9fe713202e4ef4ff0264d6ecfaea26bc4e50705b:x86/IRQ: avoid double unlock in map_domain_pirq()

  Forever since its introduction the main loop in the function dealing
  with multi-vector MSI had error exit points ("break") with different
  properties: In one case no IRQ descriptor lock is being held.
  Nevertheless the subsequent error cleanup path assumed such a lock would
  uniformly need releasing. Identify the case by setting "desc" to NULL,
  thus allowing the unlock to be skipped as necessary.

  This is CVE-2024-31143 / XSA-458.

  Coverity ID: 1605298
  Fixes: d1b6d0a02489 ("x86: enable multi-vector MSI")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
  master commit: 57338346f29cea7b183403561bdc5f407163b846
  master date: 2024-07-16 14:09:14 +0200
  8f653989ecdc6e152ee39e974be82a659453f4f8:x86/IRQ: avoid double unlock in map_domain_pirq()

  Forever since its introduction the main loop in the function dealing
  with multi-vector MSI had error exit points ("break") with different
  properties: In one case no IRQ descriptor lock is being held.
  Nevertheless the subsequent error cleanup path assumed such a lock would
  uniformly need releasing. Identify the case by setting "desc" to NULL,
  thus allowing the unlock to be skipped as necessary.

  This is CVE-2024-31143 / XSA-458.

  Coverity ID: 1605298
  Fixes: d1b6d0a02489 ("x86: enable multi-vector MSI")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
  master commit: 57338346f29cea7b183403561bdc5f407163b846
  master date: 2024-07-16 14:09:14 +0200
  d46a1ce3175dc45e97a8c9b89b0d0ff46145ae64:x86/IRQ: avoid double unlock in map_domain_pirq()

  Forever since its introduction the main loop in the function dealing
  with multi-vector MSI had error exit points ("break") with different
  properties: In one case no IRQ descriptor lock is being held.
  Nevertheless the subsequent error cleanup path assumed such a lock would
  uniformly need releasing. Identify the case by setting "desc" to NULL,
  thus allowing the unlock to be skipped as necessary.

  This is CVE-2024-31143 / XSA-458.

  Coverity ID: 1605298
  Fixes: d1b6d0a02489 ("x86: enable multi-vector MSI")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
  master commit: 57338346f29cea7b183403561bdc5f407163b846
  master date: 2024-07-16 14:09:14 +0200
  57338346f29cea7b183403561bdc5f407163b846:x86/IRQ: avoid double unlock in map_domain_pirq()

  Forever since its introduction the main loop in the function dealing
  with multi-vector MSI had error exit points ("break") with different
  properties: In one case no IRQ descriptor lock is being held.
  Nevertheless the subsequent error cleanup path assumed such a lock would
  uniformly need releasing. Identify the case by setting "desc" to NULL,
  thus allowing the unlock to be skipped as necessary.

  This is CVE-2024-31143 / XSA-458.

  Coverity ID: 1605298
  Fixes: d1b6d0a02489 ("x86: enable multi-vector MSI")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 9fe713202e4ef4ff0264d6ecfaea26bc4e50705b
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 8f653989ecdc6e152ee39e974be82a659453f4f8
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: d46a1ce3175dc45e97a8c9b89b0d0ff46145ae64
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 57338346f29cea7b183403561bdc5f407163b846
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/57338346f29cea7b183403561bdc5f407163b846
    reference_type: commit
    reference_id: 57338346f29cea7b183403561bdc5f407163b846
  - url: https://github.com/xen-project/xen/tree/8f653989ecdc6e152ee39e974be82a659453f4f8
    reference_type: commit
    reference_id: 8f653989ecdc6e152ee39e974be82a659453f4f8
  - url: https://github.com/xen-project/xen/tree/9fe713202e4ef4ff0264d6ecfaea26bc4e50705b
    reference_type: commit
    reference_id: 9fe713202e4ef4ff0264d6ecfaea26bc4e50705b
  - url: https://github.com/xen-project/xen/tree/d46a1ce3175dc45e97a8c9b89b0d0ff46145ae64
    reference_type: commit
    reference_id: d46a1ce3175dc45e97a8c9b89b0d0ff46145ae64
