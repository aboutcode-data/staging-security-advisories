advisory_id: CVE-2020-29567
datasource_id: collect_xen_project_fix_commits/CVE-2020-29567
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  d785e076b36111899ef9ee2340f2da9375afc9f5:x86/irq: fix infinite loop in irq_move_cleanup_interrupt

  If Xen enters irq_move_cleanup_interrupt with a dynamic vector below
  IRQ_MOVE_CLEANUP_VECTOR pending in IRR (0x20 or 0x21) that's also
  designated for a cleanup it will enter a loop where
  irq_move_cleanup_interrupt continuously sends a cleanup IPI (vector
  0x22) to itself while waiting for the vector with lower priority to be
  injected - which will never happen because IRQ_MOVE_CLEANUP_VECTOR
  takes precedence and it's always injected first.

  Fix this by making sure vectors below IRQ_MOVE_CLEANUP_VECTOR are
  marked as used and thus not available for APs. Also add some logic to
  assert and prevent irq_move_cleanup_interrupt from entering such an
  infinite loop, albeit that should never happen given the current code.

  This is XSA-356 / CVE-2020-29567.

  Fixes: 3fba06ba9f8 ('x86/IRQ: re-use legacy vector ranges on APs')
  Signed-off-by: Roger Pau Monné <roger.pau@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  master commit: ca85682e8c16361fdf3814c9b25a2ec3ff4f8bed
  master date: 2020-12-15 13:42:16 +0100
  ca85682e8c16361fdf3814c9b25a2ec3ff4f8bed:x86/irq: fix infinite loop in irq_move_cleanup_interrupt

  If Xen enters irq_move_cleanup_interrupt with a dynamic vector below
  IRQ_MOVE_CLEANUP_VECTOR pending in IRR (0x20 or 0x21) that's also
  designated for a cleanup it will enter a loop where
  irq_move_cleanup_interrupt continuously sends a cleanup IPI (vector
  0x22) to itself while waiting for the vector with lower priority to be
  injected - which will never happen because IRQ_MOVE_CLEANUP_VECTOR
  takes precedence and it's always injected first.

  Fix this by making sure vectors below IRQ_MOVE_CLEANUP_VECTOR are
  marked as used and thus not available for APs. Also add some logic to
  assert and prevent irq_move_cleanup_interrupt from entering such an
  infinite loop, albeit that should never happen given the current code.

  This is XSA-356 / CVE-2020-29567.

  Fixes: 3fba06ba9f8 ('x86/IRQ: re-use legacy vector ranges on APs')
  Signed-off-by: Roger Pau Monné <roger.pau@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: ca85682e8c16361fdf3814c9b25a2ec3ff4f8bed
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: d785e076b36111899ef9ee2340f2da9375afc9f5
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/ca85682e8c16361fdf3814c9b25a2ec3ff4f8bed
    reference_type: commit
    reference_id: ca85682e8c16361fdf3814c9b25a2ec3ff4f8bed
  - url: https://github.com/xen-project/xen/tree/d785e076b36111899ef9ee2340f2da9375afc9f5
    reference_type: commit
    reference_id: d785e076b36111899ef9ee2340f2da9375afc9f5
