advisory_id: CVE-2025-27465
datasource_id: collect_xen_project_fix_commits/CVE-2025-27465
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  90b79a5f7b8abe87b0a79898424697eab318d26d:x86/emul: Fix extable registration in invoke_stub()

  For exception recovery in the stubs, the registered address for fixup is the
  return address of the CALL entering the stub.

  In invoke_stub(), the '.Lret%=:' label is the wrong side of the 'post'
  parameter.  The 'post' parameter is non-empty in cases where the arithmetic
  flags of the operation need recovering.

  Split the line to separate 'pre' and 'post', making it more obvious that the
  return address label was in the wrong position.

  However, in the case that an exception did occur, we want to skip 'post' as
  it's logically part of the operation which had already failed.  Therefore, add
  a new skip label and use that for the exception recovery path.

  This is XSA-470 / CVE-2025-27465

  Fixes: 79903e50dba9 ("x86emul: catch exceptions occurring in stubs")
  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit b9f83119750ffa0e2e925d74e6e5f38925094883)
  438bb1285f470e2f385c0ea917ac9787d56aa8d3:x86/emul: Fix extable registration in invoke_stub()

  For exception recovery in the stubs, the registered address for fixup is the
  return address of the CALL entering the stub.

  In invoke_stub(), the '.Lret%=:' label is the wrong side of the 'post'
  parameter.  The 'post' parameter is non-empty in cases where the arithmetic
  flags of the operation need recovering.

  Split the line to separate 'pre' and 'post', making it more obvious that the
  return address label was in the wrong position.

  However, in the case that an exception did occur, we want to skip 'post' as
  it's logically part of the operation which had already failed.  Therefore, add
  a new skip label and use that for the exception recovery path.

  This is XSA-470 / CVE-2025-27465

  Fixes: 79903e50dba9 ("x86emul: catch exceptions occurring in stubs")
  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit b9f83119750ffa0e2e925d74e6e5f38925094883)
  f830240555e9522958e1ebedca1413d5d8f33345:x86/emul: Fix extable registration in invoke_stub()

  For exception recovery in the stubs, the registered address for fixup is the
  return address of the CALL entering the stub.

  In invoke_stub(), the '.Lret%=:' label is the wrong side of the 'post'
  parameter.  The 'post' parameter is non-empty in cases where the arithmetic
  flags of the operation need recovering.

  Split the line to separate 'pre' and 'post', making it more obvious that the
  return address label was in the wrong position.

  However, in the case that an exception did occur, we want to skip 'post' as
  it's logically part of the operation which had already failed.  Therefore, add
  a new skip label and use that for the exception recovery path.

  This is XSA-470 / CVE-2025-27465

  Fixes: 79903e50dba9 ("x86emul: catch exceptions occurring in stubs")
  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit b9f83119750ffa0e2e925d74e6e5f38925094883)
  9e1309b0f037a6b573496c3c4a16d87ea3cae1dc:x86/emul: Fix extable registration in invoke_stub()

  For exception recovery in the stubs, the registered address for fixup is the
  return address of the CALL entering the stub.

  In invoke_stub(), the '.Lret%=:' label is the wrong side of the 'post'
  parameter.  The 'post' parameter is non-empty in cases where the arithmetic
  flags of the operation need recovering.

  Split the line to separate 'pre' and 'post', making it more obvious that the
  return address label was in the wrong position.

  However, in the case that an exception did occur, we want to skip 'post' as
  it's logically part of the operation which had already failed.  Therefore, add
  a new skip label and use that for the exception recovery path.

  This is XSA-470 / CVE-2025-27465

  Fixes: 79903e50dba9 ("x86emul: catch exceptions occurring in stubs")
  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit b9f83119750ffa0e2e925d74e6e5f38925094883)
  b9f83119750ffa0e2e925d74e6e5f38925094883:x86/emul: Fix extable registration in invoke_stub()

  For exception recovery in the stubs, the registered address for fixup is the
  return address of the CALL entering the stub.

  In invoke_stub(), the '.Lret%=:' label is the wrong side of the 'post'
  parameter.  The 'post' parameter is non-empty in cases where the arithmetic
  flags of the operation need recovering.

  Split the line to separate 'pre' and 'post', making it more obvious that the
  return address label was in the wrong position.

  However, in the case that an exception did occur, we want to skip 'post' as
  it's logically part of the operation which had already failed.  Therefore, add
  a new skip label and use that for the exception recovery path.

  This is XSA-470 / CVE-2025-27465

  Fixes: 79903e50dba9 ("x86emul: catch exceptions occurring in stubs")
  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 90b79a5f7b8abe87b0a79898424697eab318d26d
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 9e1309b0f037a6b573496c3c4a16d87ea3cae1dc
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: b9f83119750ffa0e2e925d74e6e5f38925094883
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 438bb1285f470e2f385c0ea917ac9787d56aa8d3
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: f830240555e9522958e1ebedca1413d5d8f33345
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/438bb1285f470e2f385c0ea917ac9787d56aa8d3
    reference_type: commit
    reference_id: 438bb1285f470e2f385c0ea917ac9787d56aa8d3
  - url: https://github.com/xen-project/xen/tree/90b79a5f7b8abe87b0a79898424697eab318d26d
    reference_type: commit
    reference_id: 90b79a5f7b8abe87b0a79898424697eab318d26d
  - url: https://github.com/xen-project/xen/tree/9e1309b0f037a6b573496c3c4a16d87ea3cae1dc
    reference_type: commit
    reference_id: 9e1309b0f037a6b573496c3c4a16d87ea3cae1dc
  - url: https://github.com/xen-project/xen/tree/b9f83119750ffa0e2e925d74e6e5f38925094883
    reference_type: commit
    reference_id: b9f83119750ffa0e2e925d74e6e5f38925094883
  - url: https://github.com/xen-project/xen/tree/f830240555e9522958e1ebedca1413d5d8f33345
    reference_type: commit
    reference_id: f830240555e9522958e1ebedca1413d5d8f33345
