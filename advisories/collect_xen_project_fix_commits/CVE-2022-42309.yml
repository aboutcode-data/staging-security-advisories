advisory_id: CVE-2022-42309
datasource_id: collect_xen_project_fix_commits/CVE-2022-42309
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  149ebf0e0228ece2ec704f6ac2ec35f68e94a23f:tools/xenstore: create_node: Don't defer work to undo any changes on failure

  XSA-115 extended destroy_node() to update the node accounting for the
  connection. The implementation is assuming the connection is the parent
  of the node, however all the nodes are allocated using a separate context
  (see process_message()). This will result to crash (or corrupt) xenstored
  as the pointer is wrongly used.

  In case of an error, any changes to the database or update to the
  accounting will now be reverted in create_node() by calling directly
  destroy_node(). This has the nice advantage to remove the loop to unset
  the destructors in case of success.

  Take the opportunity to free the nodes right now as they are not
  going to be reachable (the function returns NULL) and are just wasting
  resources.

  This is XSA-414 / CVE-2022-42309.

  Fixes: 0bfb2101f243 ("tools/xenstore: fix node accounting after failed node creation")
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Juergen Gross <jgross@suse.com>
  (cherry picked from commit 1cd3cc7ea27cda7640a8d895e09617b61c265697)
  d0dd461bfc8dd25b94dcf72bc5f79a4b362e7f03:tools/xenstore: create_node: Don't defer work to undo any changes on failure

  XSA-115 extended destroy_node() to update the node accounting for the
  connection. The implementation is assuming the connection is the parent
  of the node, however all the nodes are allocated using a separate context
  (see process_message()). This will result to crash (or corrupt) xenstored
  as the pointer is wrongly used.

  In case of an error, any changes to the database or update to the
  accounting will now be reverted in create_node() by calling directly
  destroy_node(). This has the nice advantage to remove the loop to unset
  the destructors in case of success.

  Take the opportunity to free the nodes right now as they are not
  going to be reachable (the function returns NULL) and are just wasting
  resources.

  This is XSA-414 / CVE-2022-42309.

  Fixes: 0bfb2101f243 ("tools/xenstore: fix node accounting after failed node creation")
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Juergen Gross <jgross@suse.com>
  (cherry picked from commit 1cd3cc7ea27cda7640a8d895e09617b61c265697)
  ee03d9b56e6141422b4ef2444f93cf2e88e6a26c:tools/xenstore: create_node: Don't defer work to undo any changes on failure

  XSA-115 extended destroy_node() to update the node accounting for the
  connection. The implementation is assuming the connection is the parent
  of the node, however all the nodes are allocated using a separate context
  (see process_message()). This will result to crash (or corrupt) xenstored
  as the pointer is wrongly used.

  In case of an error, any changes to the database or update to the
  accounting will now be reverted in create_node() by calling directly
  destroy_node(). This has the nice advantage to remove the loop to unset
  the destructors in case of success.

  Take the opportunity to free the nodes right now as they are not
  going to be reachable (the function returns NULL) and are just wasting
  resources.

  This is XSA-414 / CVE-2022-42309.

  Fixes: 0bfb2101f243 ("tools/xenstore: fix node accounting after failed node creation")
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Juergen Gross <jgross@suse.com>
  (cherry picked from commit 1cd3cc7ea27cda7640a8d895e09617b61c265697)
  28ea39a4eb476f9105e1021bef1367c075feaa0b:tools/xenstore: create_node: Don't defer work to undo any changes on failure

  XSA-115 extended destroy_node() to update the node accounting for the
  connection. The implementation is assuming the connection is the parent
  of the node, however all the nodes are allocated using a separate context
  (see process_message()). This will result to crash (or corrupt) xenstored
  as the pointer is wrongly used.

  In case of an error, any changes to the database or update to the
  accounting will now be reverted in create_node() by calling directly
  destroy_node(). This has the nice advantage to remove the loop to unset
  the destructors in case of success.

  Take the opportunity to free the nodes right now as they are not
  going to be reachable (the function returns NULL) and are just wasting
  resources.

  This is XSA-414 / CVE-2022-42309.

  Fixes: 0bfb2101f243 ("tools/xenstore: fix node accounting after failed node creation")
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Juergen Gross <jgross@suse.com>
  (cherry picked from commit 1cd3cc7ea27cda7640a8d895e09617b61c265697)
  1cd3cc7ea27cda7640a8d895e09617b61c265697:tools/xenstore: create_node: Don't defer work to undo any changes on failure

  XSA-115 extended destroy_node() to update the node accounting for the
  connection. The implementation is assuming the connection is the parent
  of the node, however all the nodes are allocated using a separate context
  (see process_message()). This will result to crash (or corrupt) xenstored
  as the pointer is wrongly used.

  In case of an error, any changes to the database or update to the
  accounting will now be reverted in create_node() by calling directly
  destroy_node(). This has the nice advantage to remove the loop to unset
  the destructors in case of success.

  Take the opportunity to free the nodes right now as they are not
  going to be reachable (the function returns NULL) and are just wasting
  resources.

  This is XSA-414 / CVE-2022-42309.

  Fixes: 0bfb2101f243 ("tools/xenstore: fix node accounting after failed node creation")
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Juergen Gross <jgross@suse.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: d0dd461bfc8dd25b94dcf72bc5f79a4b362e7f03
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 149ebf0e0228ece2ec704f6ac2ec35f68e94a23f
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 1cd3cc7ea27cda7640a8d895e09617b61c265697
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 28ea39a4eb476f9105e1021bef1367c075feaa0b
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: ee03d9b56e6141422b4ef2444f93cf2e88e6a26c
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/149ebf0e0228ece2ec704f6ac2ec35f68e94a23f
    reference_type: commit
    reference_id: 149ebf0e0228ece2ec704f6ac2ec35f68e94a23f
  - url: https://github.com/xen-project/xen/tree/1cd3cc7ea27cda7640a8d895e09617b61c265697
    reference_type: commit
    reference_id: 1cd3cc7ea27cda7640a8d895e09617b61c265697
  - url: https://github.com/xen-project/xen/tree/28ea39a4eb476f9105e1021bef1367c075feaa0b
    reference_type: commit
    reference_id: 28ea39a4eb476f9105e1021bef1367c075feaa0b
  - url: https://github.com/xen-project/xen/tree/d0dd461bfc8dd25b94dcf72bc5f79a4b362e7f03
    reference_type: commit
    reference_id: d0dd461bfc8dd25b94dcf72bc5f79a4b362e7f03
  - url: https://github.com/xen-project/xen/tree/ee03d9b56e6141422b4ef2444f93cf2e88e6a26c
    reference_type: commit
    reference_id: ee03d9b56e6141422b4ef2444f93cf2e88e6a26c
