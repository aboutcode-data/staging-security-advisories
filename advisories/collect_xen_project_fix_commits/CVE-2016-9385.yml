advisory_id: CVE-2016-9385
datasource_id: collect_xen_project_fix_commits/CVE-2016-9385
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  1827d5252cf9764d4d5774059905aa21a8c69c80:x86/PV: writes of %fs and %gs base MSRs require canonical addresses

  Commit c42494acb2 ("x86: fix FS/GS base handling when using the
  fsgsbase feature") replaced the use of wrmsr_safe() on these paths
  without recognizing that wr{f,g}sbase() use just wrmsrl() and that the
  WR{F,G}SBASE instructions also raise #GP for non-canonical input.

  Similarly arch_set_info_guest() needs to prevent non-canonical
  addresses from getting stored into state later to be loaded by context
  switch code. For consistency also check stack pointers and LDT base.
  DR0..3, otoh, already get properly checked in set_debugreg() (albeit
  we discard the error there).

  The SHADOW_GS_BASE check isn't strictly necessary, but I think we
  better avoid trying the WRMSR if we know it's going to fail.

  This is CVE-2016-9385 / XSA-193.

  Reported-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: f3fa3abf3e61fb1f25ce721e14ac324dda67311f
  master date: 2016-11-22 13:46:28 +0100
  274a1f6dab3e9f4ac339831211c6f779bc33e777:x86/PV: writes of %fs and %gs base MSRs require canonical addresses

  Commit c42494acb2 ("x86: fix FS/GS base handling when using the
  fsgsbase feature") replaced the use of wrmsr_safe() on these paths
  without recognizing that wr{f,g}sbase() use just wrmsrl() and that the
  WR{F,G}SBASE instructions also raise #GP for non-canonical input.

  Similarly arch_set_info_guest() needs to prevent non-canonical
  addresses from getting stored into state later to be loaded by context
  switch code. For consistency also check stack pointers and LDT base.
  DR0..3, otoh, already get properly checked in set_debugreg() (albeit
  we discard the error there).

  The SHADOW_GS_BASE check isn't strictly necessary, but I think we
  better avoid trying the WRMSR if we know it's going to fail.

  This is CVE-2016-9385 / XSA-193.

  Reported-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: f3fa3abf3e61fb1f25ce721e14ac324dda67311f
  master date: 2016-11-22 13:46:28 +0100
  fcab9d3c6a539fc2928963f53d5a2cb6511d1b4b:x86/PV: writes of %fs and %gs base MSRs require canonical addresses

  Commit c42494acb2 ("x86: fix FS/GS base handling when using the
  fsgsbase feature") replaced the use of wrmsr_safe() on these paths
  without recognizing that wr{f,g}sbase() use just wrmsrl() and that the
  WR{F,G}SBASE instructions also raise #GP for non-canonical input.

  Similarly arch_set_info_guest() needs to prevent non-canonical
  addresses from getting stored into state later to be loaded by context
  switch code. For consistency also check stack pointers and LDT base.
  DR0..3, otoh, already get properly checked in set_debugreg() (albeit
  we discard the error there).

  The SHADOW_GS_BASE check isn't strictly necessary, but I think we
  better avoid trying the WRMSR if we know it's going to fail.

  This is CVE-2016-9385 / XSA-193.

  Reported-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: f3fa3abf3e61fb1f25ce721e14ac324dda67311f
  master date: 2016-11-22 13:46:28 +0100
  2cd9fa043e176c777a0e7430a4b82283d85746fc:x86/PV: writes of %fs and %gs base MSRs require canonical addresses

  Commit c42494acb2 ("x86: fix FS/GS base handling when using the
  fsgsbase feature") replaced the use of wrmsr_safe() on these paths
  without recognizing that wr{f,g}sbase() use just wrmsrl() and that the
  WR{F,G}SBASE instructions also raise #GP for non-canonical input.

  Similarly arch_set_info_guest() needs to prevent non-canonical
  addresses from getting stored into state later to be loaded by context
  switch code. For consistency also check stack pointers and LDT base.
  DR0..3, otoh, already get properly checked in set_debugreg() (albeit
  we discard the error there).

  The SHADOW_GS_BASE check isn't strictly necessary, but I think we
  better avoid trying the WRMSR if we know it's going to fail.

  This is CVE-2016-9385 / XSA-193.

  Reported-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: f3fa3abf3e61fb1f25ce721e14ac324dda67311f
  master date: 2016-11-22 13:46:28 +0100
  f3fa3abf3e61fb1f25ce721e14ac324dda67311f:x86/PV: writes of %fs and %gs base MSRs require canonical addresses

  Commit c42494acb2 ("x86: fix FS/GS base handling when using the
  fsgsbase feature") replaced the use of wrmsr_safe() on these paths
  without recognizing that wr{f,g}sbase() use just wrmsrl() and that the
  WR{F,G}SBASE instructions also raise #GP for non-canonical input.

  Similarly arch_set_info_guest() needs to prevent non-canonical
  addresses from getting stored into state later to be loaded by context
  switch code. For consistency also check stack pointers and LDT base.
  DR0..3, otoh, already get properly checked in set_debugreg() (albeit
  we discard the error there).

  The SHADOW_GS_BASE check isn't strictly necessary, but I think we
  better avoid trying the WRMSR if we know it's going to fail.

  This is CVE-2016-9385 / XSA-193.

  Reported-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 274a1f6dab3e9f4ac339831211c6f779bc33e777
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 1827d5252cf9764d4d5774059905aa21a8c69c80
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: f3fa3abf3e61fb1f25ce721e14ac324dda67311f
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 2cd9fa043e176c777a0e7430a4b82283d85746fc
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: fcab9d3c6a539fc2928963f53d5a2cb6511d1b4b
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/1827d5252cf9764d4d5774059905aa21a8c69c80
    reference_type: commit
    reference_id: 1827d5252cf9764d4d5774059905aa21a8c69c80
  - url: https://github.com/xen-project/xen/tree/274a1f6dab3e9f4ac339831211c6f779bc33e777
    reference_type: commit
    reference_id: 274a1f6dab3e9f4ac339831211c6f779bc33e777
  - url: https://github.com/xen-project/xen/tree/2cd9fa043e176c777a0e7430a4b82283d85746fc
    reference_type: commit
    reference_id: 2cd9fa043e176c777a0e7430a4b82283d85746fc
  - url: https://github.com/xen-project/xen/tree/f3fa3abf3e61fb1f25ce721e14ac324dda67311f
    reference_type: commit
    reference_id: f3fa3abf3e61fb1f25ce721e14ac324dda67311f
  - url: https://github.com/xen-project/xen/tree/fcab9d3c6a539fc2928963f53d5a2cb6511d1b4b
    reference_type: commit
    reference_id: fcab9d3c6a539fc2928963f53d5a2cb6511d1b4b
