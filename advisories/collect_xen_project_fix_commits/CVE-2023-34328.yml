advisory_id: CVE-2023-34328
datasource_id: collect_xen_project_fix_commits/CVE-2023-34328
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  dc9d9aa62ddeb14abd5672690d30789829f58f7e:x86/pv: Correct the auditing of guest breakpoint addresses

  The use of access_ok() is buggy, because it permits access to the compat
  translation area.  64bit PV guests don't use the XLAT area, but on AMD
  hardware, the DBEXT feature allows a breakpoint to match up to a 4G aligned
  region, allowing the breakpoint to reach outside of the XLAT area.

  Prior to c/s cda16c1bb223 ("x86: mirror compat argument translation area for
  32-bit PV"), the live GDT was within 4G of the XLAT area.

  All together, this allowed a malicious 64bit PV guest on AMD hardware to place
  a breakpoint over the live GDT, and trigger a #DB livelock (CVE-2015-8104).

  Introduce breakpoint_addr_ok() and explain why __addr_ok() happens to be an
  appropriate check in this case.

  For Xen 4.14 and later, this is a latent bug because the XLAT area has moved
  to be on its own with nothing interesting adjacent.  For Xen 4.13 and older on
  AMD hardware, this fixes a PV-trigger-able DoS.

  This is part of XSA-444 / CVE-2023-34328.

  Fixes: 65e355490817 ("x86/PV: support data breakpoint extension registers")
  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  4a4daf6bddbe8a741329df5cc8768f7dec664aed:x86/pv: Correct the auditing of guest breakpoint addresses

  The use of access_ok() is buggy, because it permits access to the compat
  translation area.  64bit PV guests don't use the XLAT area, but on AMD
  hardware, the DBEXT feature allows a breakpoint to match up to a 4G aligned
  region, allowing the breakpoint to reach outside of the XLAT area.

  Prior to c/s cda16c1bb223 ("x86: mirror compat argument translation area for
  32-bit PV"), the live GDT was within 4G of the XLAT area.

  All together, this allowed a malicious 64bit PV guest on AMD hardware to place
  a breakpoint over the live GDT, and trigger a #DB livelock (CVE-2015-8104).

  Introduce breakpoint_addr_ok() and explain why __addr_ok() happens to be an
  appropriate check in this case.

  For Xen 4.14 and later, this is a latent bug because the XLAT area has moved
  to be on its own with nothing interesting adjacent.  For Xen 4.13 and older on
  AMD hardware, this fixes a PV-trigger-able DoS.

  This is part of XSA-444 / CVE-2023-34328.

  Fixes: 65e355490817 ("x86/PV: support data breakpoint extension registers")
  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit dc9d9aa62ddeb14abd5672690d30789829f58f7e)
  29efce0f8f10e381417a61f2f9988b40d4f6bcf0:x86/pv: Correct the auditing of guest breakpoint addresses

  The use of access_ok() is buggy, because it permits access to the compat
  translation area.  64bit PV guests don't use the XLAT area, but on AMD
  hardware, the DBEXT feature allows a breakpoint to match up to a 4G aligned
  region, allowing the breakpoint to reach outside of the XLAT area.

  Prior to c/s cda16c1bb223 ("x86: mirror compat argument translation area for
  32-bit PV"), the live GDT was within 4G of the XLAT area.

  All together, this allowed a malicious 64bit PV guest on AMD hardware to place
  a breakpoint over the live GDT, and trigger a #DB livelock (CVE-2015-8104).

  Introduce breakpoint_addr_ok() and explain why __addr_ok() happens to be an
  appropriate check in this case.

  For Xen 4.14 and later, this is a latent bug because the XLAT area has moved
  to be on its own with nothing interesting adjacent.  For Xen 4.13 and older on
  AMD hardware, this fixes a PV-trigger-able DoS.

  This is part of XSA-444 / CVE-2023-34328.

  Fixes: 65e355490817 ("x86/PV: support data breakpoint extension registers")
  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit dc9d9aa62ddeb14abd5672690d30789829f58f7e)
  0b56bed864ca9b572473957f0254aefa797216f2:x86/pv: Correct the auditing of guest breakpoint addresses

  The use of access_ok() is buggy, because it permits access to the compat
  translation area.  64bit PV guests don't use the XLAT area, but on AMD
  hardware, the DBEXT feature allows a breakpoint to match up to a 4G aligned
  region, allowing the breakpoint to reach outside of the XLAT area.

  Prior to c/s cda16c1bb223 ("x86: mirror compat argument translation area for
  32-bit PV"), the live GDT was within 4G of the XLAT area.

  All together, this allowed a malicious 64bit PV guest on AMD hardware to place
  a breakpoint over the live GDT, and trigger a #DB livelock (CVE-2015-8104).

  Introduce breakpoint_addr_ok() and explain why __addr_ok() happens to be an
  appropriate check in this case.

  For Xen 4.14 and later, this is a latent bug because the XLAT area has moved
  to be on its own with nothing interesting adjacent.  For Xen 4.13 and older on
  AMD hardware, this fixes a PV-trigger-able DoS.

  This is part of XSA-444 / CVE-2023-34328.

  Fixes: 65e355490817 ("x86/PV: support data breakpoint extension registers")
  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit dc9d9aa62ddeb14abd5672690d30789829f58f7e)
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 0b56bed864ca9b572473957f0254aefa797216f2
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 4a4daf6bddbe8a741329df5cc8768f7dec664aed
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: dc9d9aa62ddeb14abd5672690d30789829f58f7e
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 29efce0f8f10e381417a61f2f9988b40d4f6bcf0
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/0b56bed864ca9b572473957f0254aefa797216f2
    reference_type: commit
    reference_id: 0b56bed864ca9b572473957f0254aefa797216f2
  - url: https://github.com/xen-project/xen/tree/29efce0f8f10e381417a61f2f9988b40d4f6bcf0
    reference_type: commit
    reference_id: 29efce0f8f10e381417a61f2f9988b40d4f6bcf0
  - url: https://github.com/xen-project/xen/tree/4a4daf6bddbe8a741329df5cc8768f7dec664aed
    reference_type: commit
    reference_id: 4a4daf6bddbe8a741329df5cc8768f7dec664aed
  - url: https://github.com/xen-project/xen/tree/dc9d9aa62ddeb14abd5672690d30789829f58f7e
    reference_type: commit
    reference_id: dc9d9aa62ddeb14abd5672690d30789829f58f7e
