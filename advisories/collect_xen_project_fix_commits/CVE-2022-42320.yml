advisory_id: CVE-2022-42320
datasource_id: collect_xen_project_fix_commits/CVE-2022-42320
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  e6655e8f25e4ebf3d3cabac2430c8d5ba33a15a5:tools/xenstore: fix checking node permissions

  Today chk_domain_generation() is being used to check whether a node
  permission entry is still valid or whether it is referring to a domain
  no longer existing. This is done by comparing the node's and the
  domain's generation count.

  In case no struct domain is existing for a checked domain, but the
  domain itself is valid, chk_domain_generation() assumes it is being
  called due to the first node created for a new domain and it will
  return success.

  This might be wrong in case the checked permission is related to an
  old domain, which has just been replaced with a new domain using the
  same domid.

  Fix that by letting chk_domain_generation() fail in case a struct
  domain isn't found. In order to cover the case of the first node for
  a new domain try to allocate the needed struct domain explicitly when
  processing the related SET_PERMS command. In case a referenced domain
  isn't existing, flag the related permission to be ignored right away.

  This is XSA-417 / CVE-2022-42320.

  Signed-off-by: Juergen Gross <jgross@suse.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
  (cherry picked from commit ab128218225d3542596ca3a02aee80d55494bef8)
  2761f00a40665e97e1851880089fc888b378efc7:tools/xenstore: fix checking node permissions

  Today chk_domain_generation() is being used to check whether a node
  permission entry is still valid or whether it is referring to a domain
  no longer existing. This is done by comparing the node's and the
  domain's generation count.

  In case no struct domain is existing for a checked domain, but the
  domain itself is valid, chk_domain_generation() assumes it is being
  called due to the first node created for a new domain and it will
  return success.

  This might be wrong in case the checked permission is related to an
  old domain, which has just been replaced with a new domain using the
  same domid.

  Fix that by letting chk_domain_generation() fail in case a struct
  domain isn't found. In order to cover the case of the first node for
  a new domain try to allocate the needed struct domain explicitly when
  processing the related SET_PERMS command. In case a referenced domain
  isn't existing, flag the related permission to be ignored right away.

  This is XSA-417 / CVE-2022-42320.

  Signed-off-by: Juergen Gross <jgross@suse.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
  (cherry picked from commit ab128218225d3542596ca3a02aee80d55494bef8)
  8012324cb9e676bd342a5adfda1700525f195e2e:tools/xenstore: fix checking node permissions

  Today chk_domain_generation() is being used to check whether a node
  permission entry is still valid or whether it is referring to a domain
  no longer existing. This is done by comparing the node's and the
  domain's generation count.

  In case no struct domain is existing for a checked domain, but the
  domain itself is valid, chk_domain_generation() assumes it is being
  called due to the first node created for a new domain and it will
  return success.

  This might be wrong in case the checked permission is related to an
  old domain, which has just been replaced with a new domain using the
  same domid.

  Fix that by letting chk_domain_generation() fail in case a struct
  domain isn't found. In order to cover the case of the first node for
  a new domain try to allocate the needed struct domain explicitly when
  processing the related SET_PERMS command. In case a referenced domain
  isn't existing, flag the related permission to be ignored right away.

  This is XSA-417 / CVE-2022-42320.

  Signed-off-by: Juergen Gross <jgross@suse.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
  (cherry picked from commit ab128218225d3542596ca3a02aee80d55494bef8)
  036fa8717b316a10b67ea8cf4d5dd200ac2b29af:tools/xenstore: fix checking node permissions

  Today chk_domain_generation() is being used to check whether a node
  permission entry is still valid or whether it is referring to a domain
  no longer existing. This is done by comparing the node's and the
  domain's generation count.

  In case no struct domain is existing for a checked domain, but the
  domain itself is valid, chk_domain_generation() assumes it is being
  called due to the first node created for a new domain and it will
  return success.

  This might be wrong in case the checked permission is related to an
  old domain, which has just been replaced with a new domain using the
  same domid.

  Fix that by letting chk_domain_generation() fail in case a struct
  domain isn't found. In order to cover the case of the first node for
  a new domain try to allocate the needed struct domain explicitly when
  processing the related SET_PERMS command. In case a referenced domain
  isn't existing, flag the related permission to be ignored right away.

  This is XSA-417 / CVE-2022-42320.

  Signed-off-by: Juergen Gross <jgross@suse.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
  (cherry picked from commit ab128218225d3542596ca3a02aee80d55494bef8)
  ab128218225d3542596ca3a02aee80d55494bef8:tools/xenstore: fix checking node permissions

  Today chk_domain_generation() is being used to check whether a node
  permission entry is still valid or whether it is referring to a domain
  no longer existing. This is done by comparing the node's and the
  domain's generation count.

  In case no struct domain is existing for a checked domain, but the
  domain itself is valid, chk_domain_generation() assumes it is being
  called due to the first node created for a new domain and it will
  return success.

  This might be wrong in case the checked permission is related to an
  old domain, which has just been replaced with a new domain using the
  same domid.

  Fix that by letting chk_domain_generation() fail in case a struct
  domain isn't found. In order to cover the case of the first node for
  a new domain try to allocate the needed struct domain explicitly when
  processing the related SET_PERMS command. In case a referenced domain
  isn't existing, flag the related permission to be ignored right away.

  This is XSA-417 / CVE-2022-42320.

  Signed-off-by: Juergen Gross <jgross@suse.com>
  Reviewed-by: Julien Grall <jgrall@amazon.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 8012324cb9e676bd342a5adfda1700525f195e2e
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 2761f00a40665e97e1851880089fc888b378efc7
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: e6655e8f25e4ebf3d3cabac2430c8d5ba33a15a5
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 036fa8717b316a10b67ea8cf4d5dd200ac2b29af
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: ab128218225d3542596ca3a02aee80d55494bef8
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/036fa8717b316a10b67ea8cf4d5dd200ac2b29af
    reference_type: commit
    reference_id: 036fa8717b316a10b67ea8cf4d5dd200ac2b29af
  - url: https://github.com/xen-project/xen/tree/2761f00a40665e97e1851880089fc888b378efc7
    reference_type: commit
    reference_id: 2761f00a40665e97e1851880089fc888b378efc7
  - url: https://github.com/xen-project/xen/tree/8012324cb9e676bd342a5adfda1700525f195e2e
    reference_type: commit
    reference_id: 8012324cb9e676bd342a5adfda1700525f195e2e
  - url: https://github.com/xen-project/xen/tree/ab128218225d3542596ca3a02aee80d55494bef8
    reference_type: commit
    reference_id: ab128218225d3542596ca3a02aee80d55494bef8
  - url: https://github.com/xen-project/xen/tree/e6655e8f25e4ebf3d3cabac2430c8d5ba33a15a5
    reference_type: commit
    reference_id: e6655e8f25e4ebf3d3cabac2430c8d5ba33a15a5
