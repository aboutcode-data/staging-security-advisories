advisory_id: CVE-2021-28700
datasource_id: collect_xen_project_fix_commits/CVE-2021-28700
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  35ba323378d05509f2e0dc049520e140be183003:xen/arm: Restrict the amount of memory that dom0less domU and dom0 can allocate

  Currently, both dom0less domUs and dom0 can allocate an "unlimited"
  amount of memory because d->max_pages is set to ~0U.

  In particular, the former are meant to be unprivileged. Therefore the
  memory they could allocate should be bounded. As the domain are not yet
  officially aware of Xen (we don't expose advertise it in the DT, yet
  the hypercalls are accessible), they should not need to allocate more
  than the initial amount. So cap set d->max_pages directly the amount of
  memory we are meant to allocate.

  Take the opportunity to also restrict the memory for dom0 as the
  domain is direct mapped (e.g. MFN == GFN) and therefore cannot
  allocate outside of the pre-allocated region.

  This is CVE-2021-28700 / XSA-383.

  Reported-by: Julien Grall <jgrall@amazon.com>
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Tested-by: Stefano Stabellini <sstabellini@kernel.org>
  master commit: c08d68cd2aacbc7cb56e73ada241bfe4639bbc68
  master date: 2021-08-25 14:19:31 +0200
  bdb84809402266816449120101fe14a0732d373c:xen/arm: Restrict the amount of memory that dom0less domU and dom0 can allocate

  Currently, both dom0less domUs and dom0 can allocate an "unlimited"
  amount of memory because d->max_pages is set to ~0U.

  In particular, the former are meant to be unprivileged. Therefore the
  memory they could allocate should be bounded. As the domain are not yet
  officially aware of Xen (we don't expose advertise it in the DT, yet
  the hypercalls are accessible), they should not need to allocate more
  than the initial amount. So cap set d->max_pages directly the amount of
  memory we are meant to allocate.

  Take the opportunity to also restrict the memory for dom0 as the
  domain is direct mapped (e.g. MFN == GFN) and therefore cannot
  allocate outside of the pre-allocated region.

  This is CVE-2021-28700 / XSA-383.

  Reported-by: Julien Grall <jgrall@amazon.com>
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Tested-by: Stefano Stabellini <sstabellini@kernel.org>
  master commit: c08d68cd2aacbc7cb56e73ada241bfe4639bbc68
  master date: 2021-08-25 14:19:31 +0200
  c439f5e97b0229851ba76249ccb224695a1baa29:xen/arm: Restrict the amount of memory that dom0less domU and dom0 can allocate

  Currently, both dom0less domUs and dom0 can allocate an "unlimited"
  amount of memory because d->max_pages is set to ~0U.

  In particular, the former are meant to be unprivileged. Therefore the
  memory they could allocate should be bounded. As the domain are not yet
  officially aware of Xen (we don't expose advertise it in the DT, yet
  the hypercalls are accessible), they should not need to allocate more
  than the initial amount. So cap set d->max_pages directly the amount of
  memory we are meant to allocate.

  Take the opportunity to also restrict the memory for dom0 as the
  domain is direct mapped (e.g. MFN == GFN) and therefore cannot
  allocate outside of the pre-allocated region.

  This is CVE-2021-28700 / XSA-383.

  Reported-by: Julien Grall <jgrall@amazon.com>
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Tested-by: Stefano Stabellini <sstabellini@kernel.org>
  master commit: c08d68cd2aacbc7cb56e73ada241bfe4639bbc68
  master date: 2021-08-25 14:19:31 +0200
  9bc2a681274b94639902d7c021d300384662a29a:xen/arm: Restrict the amount of memory that dom0less domU and dom0 can allocate

  Currently, both dom0less domUs and dom0 can allocate an "unlimited"
  amount of memory because d->max_pages is set to ~0U.

  In particular, the former are meant to be unprivileged. Therefore the
  memory they could allocate should be bounded. As the domain are not yet
  officially aware of Xen (we don't expose advertise it in the DT, yet
  the hypercalls are accessible), they should not need to allocate more
  than the initial amount. So cap set d->max_pages directly the amount of
  memory we are meant to allocate.

  Take the opportunity to also restrict the memory for dom0 as the
  domain is direct mapped (e.g. MFN == GFN) and therefore cannot
  allocate outside of the pre-allocated region.

  This is CVE-2021-28700 / XSA-383.

  Reported-by: Julien Grall <jgrall@amazon.com>
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Tested-by: Stefano Stabellini <sstabellini@kernel.org>
  master commit: c08d68cd2aacbc7cb56e73ada241bfe4639bbc68
  master date: 2021-08-25 14:19:31 +0200
  c08d68cd2aacbc7cb56e73ada241bfe4639bbc68:xen/arm: Restrict the amount of memory that dom0less domU and dom0 can allocate

  Currently, both dom0less domUs and dom0 can allocate an "unlimited"
  amount of memory because d->max_pages is set to ~0U.

  In particular, the former are meant to be unprivileged. Therefore the
  memory they could allocate should be bounded. As the domain are not yet
  officially aware of Xen (we don't expose advertise it in the DT, yet
  the hypercalls are accessible), they should not need to allocate more
  than the initial amount. So cap set d->max_pages directly the amount of
  memory we are meant to allocate.

  Take the opportunity to also restrict the memory for dom0 as the
  domain is direct mapped (e.g. MFN == GFN) and therefore cannot
  allocate outside of the pre-allocated region.

  This is CVE-2021-28700 / XSA-383.

  Reported-by: Julien Grall <jgrall@amazon.com>
  Signed-off-by: Julien Grall <jgrall@amazon.com>
  Reviewed-by: Stefano Stabellini <sstabellini@kernel.org>
  Tested-by: Stefano Stabellini <sstabellini@kernel.org>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 9bc2a681274b94639902d7c021d300384662a29a
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: bdb84809402266816449120101fe14a0732d373c
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: c439f5e97b0229851ba76249ccb224695a1baa29
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 35ba323378d05509f2e0dc049520e140be183003
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: c08d68cd2aacbc7cb56e73ada241bfe4639bbc68
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/35ba323378d05509f2e0dc049520e140be183003
    reference_type: commit
    reference_id: 35ba323378d05509f2e0dc049520e140be183003
  - url: https://github.com/xen-project/xen/tree/9bc2a681274b94639902d7c021d300384662a29a
    reference_type: commit
    reference_id: 9bc2a681274b94639902d7c021d300384662a29a
  - url: https://github.com/xen-project/xen/tree/bdb84809402266816449120101fe14a0732d373c
    reference_type: commit
    reference_id: bdb84809402266816449120101fe14a0732d373c
  - url: https://github.com/xen-project/xen/tree/c08d68cd2aacbc7cb56e73ada241bfe4639bbc68
    reference_type: commit
    reference_id: c08d68cd2aacbc7cb56e73ada241bfe4639bbc68
  - url: https://github.com/xen-project/xen/tree/c439f5e97b0229851ba76249ccb224695a1baa29
    reference_type: commit
    reference_id: c439f5e97b0229851ba76249ccb224695a1baa29
