advisory_id: CVE-2022-33745
datasource_id: collect_xen_project_fix_commits/CVE-2022-33745
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  c946524a65f3f7b795c48d304953be6d7672cfb6:x86/mm: correct TLB flush condition in _get_page_type()

  When this logic was moved, it was moved across the point where nx is
  updated to hold the new type for the page. IOW originally it was
  equivalent to using x (and perhaps x would better have been used), but
  now it isn't anymore. Switch to using x, which then brings things in
  line again with the slightly earlier comment there (now) talking about
  transitions _from_ writable.

  I have to confess though that I cannot make a direct connection between
  the reported observed behavior of guests leaving several pages around
  with pending general references and the change here. Repeated testing,
  nevertheless, confirms the reported issue is no longer there.

  This is CVE-2022-33745 / XSA-408.

  Reported-by: Charles Arnold <carnold@suse.com>
  Fixes: 8cc5036bc385 ("x86/pv: Fix ABAC cmpxchg() race in _get_page_type()")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: a9949efb288fd6e21bbaf9d5826207c7c41cda27
  master date: 2022-07-26 14:54:34 +0200
  ef571a5a11e70365106db15144236d7bb5117abe:x86/mm: correct TLB flush condition in _get_page_type()

  When this logic was moved, it was moved across the point where nx is
  updated to hold the new type for the page. IOW originally it was
  equivalent to using x (and perhaps x would better have been used), but
  now it isn't anymore. Switch to using x, which then brings things in
  line again with the slightly earlier comment there (now) talking about
  transitions _from_ writable.

  I have to confess though that I cannot make a direct connection between
  the reported observed behavior of guests leaving several pages around
  with pending general references and the change here. Repeated testing,
  nevertheless, confirms the reported issue is no longer there.

  This is CVE-2022-33745 / XSA-408.

  Reported-by: Charles Arnold <carnold@suse.com>
  Fixes: 8cc5036bc385 ("x86/pv: Fix ABAC cmpxchg() race in _get_page_type()")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: a9949efb288fd6e21bbaf9d5826207c7c41cda27
  master date: 2022-07-26 14:54:34 +0200
  3859f3ee7e37323ae5e0014c07ba8d3a4d7890b2:x86/mm: correct TLB flush condition in _get_page_type()

  When this logic was moved, it was moved across the point where nx is
  updated to hold the new type for the page. IOW originally it was
  equivalent to using x (and perhaps x would better have been used), but
  now it isn't anymore. Switch to using x, which then brings things in
  line again with the slightly earlier comment there (now) talking about
  transitions _from_ writable.

  I have to confess though that I cannot make a direct connection between
  the reported observed behavior of guests leaving several pages around
  with pending general references and the change here. Repeated testing,
  nevertheless, confirms the reported issue is no longer there.

  This is CVE-2022-33745 / XSA-408.

  Reported-by: Charles Arnold <carnold@suse.com>
  Fixes: 8cc5036bc385 ("x86/pv: Fix ABAC cmpxchg() race in _get_page_type()")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: a9949efb288fd6e21bbaf9d5826207c7c41cda27
  master date: 2022-07-26 14:54:34 +0200
  221f6a97b59e008f11eb310ad0c9b802f3bea233:x86/mm: correct TLB flush condition in _get_page_type()

  When this logic was moved, it was moved across the point where nx is
  updated to hold the new type for the page. IOW originally it was
  equivalent to using x (and perhaps x would better have been used), but
  now it isn't anymore. Switch to using x, which then brings things in
  line again with the slightly earlier comment there (now) talking about
  transitions _from_ writable.

  I have to confess though that I cannot make a direct connection between
  the reported observed behavior of guests leaving several pages around
  with pending general references and the change here. Repeated testing,
  nevertheless, confirms the reported issue is no longer there.

  This is CVE-2022-33745 / XSA-408.

  Reported-by: Charles Arnold <carnold@suse.com>
  Fixes: 8cc5036bc385 ("x86/pv: Fix ABAC cmpxchg() race in _get_page_type()")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: a9949efb288fd6e21bbaf9d5826207c7c41cda27
  master date: 2022-07-26 14:54:34 +0200
  a9949efb288fd6e21bbaf9d5826207c7c41cda27:x86/mm: correct TLB flush condition in _get_page_type()

  When this logic was moved, it was moved across the point where nx is
  updated to hold the new type for the page. IOW originally it was
  equivalent to using x (and perhaps x would better have been used), but
  now it isn't anymore. Switch to using x, which then brings things in
  line again with the slightly earlier comment there (now) talking about
  transitions _from_ writable.

  I have to confess though that I cannot make a direct connection between
  the reported observed behavior of guests leaving several pages around
  with pending general references and the change here. Repeated testing,
  nevertheless, confirms the reported issue is no longer there.

  This is CVE-2022-33745 / XSA-408.

  Reported-by: Charles Arnold <carnold@suse.com>
  Fixes: 8cc5036bc385 ("x86/pv: Fix ABAC cmpxchg() race in _get_page_type()")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 3859f3ee7e37323ae5e0014c07ba8d3a4d7890b2
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: ef571a5a11e70365106db15144236d7bb5117abe
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: a9949efb288fd6e21bbaf9d5826207c7c41cda27
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: c946524a65f3f7b795c48d304953be6d7672cfb6
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 221f6a97b59e008f11eb310ad0c9b802f3bea233
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/221f6a97b59e008f11eb310ad0c9b802f3bea233
    reference_type: commit
    reference_id: 221f6a97b59e008f11eb310ad0c9b802f3bea233
  - url: https://github.com/xen-project/xen/tree/3859f3ee7e37323ae5e0014c07ba8d3a4d7890b2
    reference_type: commit
    reference_id: 3859f3ee7e37323ae5e0014c07ba8d3a4d7890b2
  - url: https://github.com/xen-project/xen/tree/a9949efb288fd6e21bbaf9d5826207c7c41cda27
    reference_type: commit
    reference_id: a9949efb288fd6e21bbaf9d5826207c7c41cda27
  - url: https://github.com/xen-project/xen/tree/c946524a65f3f7b795c48d304953be6d7672cfb6
    reference_type: commit
    reference_id: c946524a65f3f7b795c48d304953be6d7672cfb6
  - url: https://github.com/xen-project/xen/tree/ef571a5a11e70365106db15144236d7bb5117abe
    reference_type: commit
    reference_id: ef571a5a11e70365106db15144236d7bb5117abe
