advisory_id: CVE-2011-1898
datasource_id: collect_xen_project_fix_commits/CVE-2011-1898
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  9cf1318a32bca00d024fc4ff64f7c317bda56b5d:x86/iommu: make code addressing CVE-2011-1898 no VT-d specific

  The variable untrusted_msi indicates whether the system is vulnerable to
  CVE-2011-1898 due to the absence of interrupt remapping support.
  Although AMD iommus with interrupt remapping disabled are also affected,
  this case is not handled yet. Given that the issue is not VT-d specific,
  and to accommodate future use of the flag for covering also the AMD iommu
  case, move the definition of the flag out of the VT-d specific code to the
  common x86 iommu code.

  Also, since the current implementation assumes that only PV guests are prone
  to this attack, take the opportunity to define untrusted_msi only when PV is
  enabled.

  No functional change intended.

  Signed-off-by: Xenia Ragiadakou <burzalodowa@gmail.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Kevin Tian <kevin.tian@intel.com>
  9cf1318a32bca00d024fc4ff64f7c317bda56b5d:x86/iommu: make code addressing CVE-2011-1898 no VT-d specific

  The variable untrusted_msi indicates whether the system is vulnerable to
  CVE-2011-1898 due to the absence of interrupt remapping support.
  Although AMD iommus with interrupt remapping disabled are also affected,
  this case is not handled yet. Given that the issue is not VT-d specific,
  and to accommodate future use of the flag for covering also the AMD iommu
  case, move the definition of the flag out of the VT-d specific code to the
  common x86 iommu code.

  Also, since the current implementation assumes that only PV guests are prone
  to this attack, take the opportunity to define untrusted_msi only when PV is
  enabled.

  No functional change intended.

  Signed-off-by: Xenia Ragiadakou <burzalodowa@gmail.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Kevin Tian <kevin.tian@intel.com>
  eda571666d75d81efd5ef5efbb08d17c032fbbcb:x86, vtd: [CVE-2011-1898] Protect against malicious MSIs from untrusted devices.

  In the absence of VT-d interrupt remapping support, a device can send
  arbitrary APIC messages to host CPUs. One class of attack that results
  is to confuse the hypervisor by delivering asynchronous interrupts to
  vectors that are expected to handle only synchronous
  traps/exceptions.

  We block this class of attack by:
  (1) setting APIC.TPR=0x10, to block all interrupts below vector
  0x20. This blocks delivery to all architectural exception vectors.
  (2) checking APIC.ISR[vec] for vectors 0x80 (fast syscall) and 0x82
  (hypercall). In these cases we BUG if we detect we are handling a
  hardware interrupt -- turning a potentially more severe infiltration
  into a straightforward system crash (i.e, DoS).

  Thanks to Invisible Things Lab <http://www.invisiblethingslab.com>
  for discovery and detailed investigation of this attack.

  Signed-off-by: Keir Fraser <keir@xen.org>
  xen-unstable changeset:   23337:cc91832a02c7
  xen-unstable date:        Thu May 12 16:39:31 2011 +0100
  a4067e5f2eb9b13ef20dabf8b07b44ed1d0918a0:x86, vtd: [CVE-2011-1898] Protect against malicious MSIs from untrusted devices.

  In the absence of VT-d interrupt remapping support, a device can send
  arbitrary APIC messages to host CPUs. One class of attack that results
  is to confuse the hypervisor by delivering asynchronous interrupts to
  vectors that are expected to handle only synchronous
  traps/exceptions.

  We block this class of attack by:
  (1) setting APIC.TPR=0x10, to block all interrupts below vector
  0x20. This blocks delivery to all architectural exception vectors.
  (2) checking APIC.ISR[vec] for vectors 0x80 (fast syscall) and 0x82
  (hypercall). In these cases we BUG if we detect we are handling a
  hardware interrupt -- turning a potentially more severe infiltration
  into a straightforward system crash (i.e, DoS).

  Thanks to Invisible Things Lab <http://www.invisiblethingslab.com>
  for discovery and detailed investigation of this attack.

  Signed-off-by: Keir Fraser <keir@xen.org>
  xen-unstable changeset:   23337:cc91832a02c7
  xen-unstable date:        Thu May 12 16:39:31 2011 +0100
  cce9aba653e4be7dce83e0887e9a547a7440d0a5:vt-d: [CVE-2011-1898] Ensure that "iommu=required" enables interrupt remapping.

  Ensure that when Xen boots with "iommu=required" it will also insist
  that interrupt remapping is supported and enabled.  It arranges that
  booting with that option on vulnerable hardware will fail, rather than
  appearing to succeed but actually being vulnerable to guests.

  From: Allen Kay <allen.m.kay@intel.com>
  Signed-off-by: Keir Fraser <keir@xen.org>
  10fbbbcab8030eaa5771e3f69a08cd6e1e489085:x86, vtd: [CVE-2011-1898] Protect against malicious MSIs from untrusted devices.

  In the absence of VT-d interrupt remapping support, a device can send
  arbitrary APIC messages to host CPUs. One class of attack that results
  is to confuse the hypervisor by delivering asynchronous interrupts to
  vectors that are expected to handle only synchronous
  traps/exceptions.

  We block this class of attack by:
  (1) setting APIC.TPR=0x10, to block all interrupts below vector
  0x20. This blocks delivery to all architectural exception vectors.
  (2) checking APIC.ISR[vec] for vectors 0x80 (fast syscall) and 0x82
  (hypercall). In these cases we BUG if we detect we are handling a
  hardware interrupt -- turning a potentially more severe infiltration
  into a straightforward system crash (i.e, DoS).

  Thanks to Invisible Things Lab <http://www.invisiblethingslab.com>
  for discovery and detailed investigation of this attack.

  Signed-off-by: Keir Fraser <keir@xen.org>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 10fbbbcab8030eaa5771e3f69a08cd6e1e489085
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 9cf1318a32bca00d024fc4ff64f7c317bda56b5d
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: eda571666d75d81efd5ef5efbb08d17c032fbbcb
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: a4067e5f2eb9b13ef20dabf8b07b44ed1d0918a0
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: cce9aba653e4be7dce83e0887e9a547a7440d0a5
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/10fbbbcab8030eaa5771e3f69a08cd6e1e489085
    reference_type: commit
    reference_id: 10fbbbcab8030eaa5771e3f69a08cd6e1e489085
  - url: https://github.com/xen-project/xen/tree/9cf1318a32bca00d024fc4ff64f7c317bda56b5d
    reference_type: commit
    reference_id: 9cf1318a32bca00d024fc4ff64f7c317bda56b5d
  - url: https://github.com/xen-project/xen/tree/a4067e5f2eb9b13ef20dabf8b07b44ed1d0918a0
    reference_type: commit
    reference_id: a4067e5f2eb9b13ef20dabf8b07b44ed1d0918a0
  - url: https://github.com/xen-project/xen/tree/cce9aba653e4be7dce83e0887e9a547a7440d0a5
    reference_type: commit
    reference_id: cce9aba653e4be7dce83e0887e9a547a7440d0a5
  - url: https://github.com/xen-project/xen/tree/eda571666d75d81efd5ef5efbb08d17c032fbbcb
    reference_type: commit
    reference_id: eda571666d75d81efd5ef5efbb08d17c032fbbcb
