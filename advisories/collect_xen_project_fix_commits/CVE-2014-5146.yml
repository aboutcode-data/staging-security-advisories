advisory_id: CVE-2014-5146
datasource_id: collect_xen_project_fix_commits/CVE-2014-5146
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  c844974caf1501b6527533ab2a3d27ea8920ab90:x86/paging: make log-dirty operations preemptible

  Both the freeing and the inspection of the bitmap get done in (nested)
  loops which - besides having a rather high iteration count in general,
  albeit that would be covered by XSA-77 - have the number of non-trivial
  iterations they need to perform (indirectly) controllable by both the
  guest they are for and any domain controlling the guest (including the
  one running qemu for it).

  Note that the tying of the continuations to the invoking domain (which
  previously [wrongly] used the invoking vCPU instead) implies that the
  tools requesting such operations have to make sure they don't issue
  multiple similar operations in parallel.

  Note further that this breaks supervisor-mode kernel assumptions in
  hypercall_create_continuation() (where regs->eip gets rewound to the
  current hypercall stub beginning), but otoh
  hypercall_cancel_continuation() doesn't work in that mode either.
  Perhaps time to rip out all the remains of that feature?

  This is part of CVE-2014-5146 / XSA-97.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  Tested-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: 070493dfd2788e061b53f074b7ba97507fbcbf65
  master date: 2014-10-06 11:22:04 +0200
  425e9039b6532a8c5884e7fe4b6676f6cd493770:x86/paging: make log-dirty operations preemptible

  Both the freeing and the inspection of the bitmap get done in (nested)
  loops which - besides having a rather high iteration count in general,
  albeit that would be covered by XSA-77 - have the number of non-trivial
  iterations they need to perform (indirectly) controllable by both the
  guest they are for and any domain controlling the guest (including the
  one running qemu for it).

  Note that the tying of the continuations to the invoking domain (which
  previously [wrongly] used the invoking vCPU instead) implies that the
  tools requesting such operations have to make sure they don't issue
  multiple similar operations in parallel.

  Note further that this breaks supervisor-mode kernel assumptions in
  hypercall_create_continuation() (where regs->eip gets rewound to the
  current hypercall stub beginning), but otoh
  hypercall_cancel_continuation() doesn't work in that mode either.
  Perhaps time to rip out all the remains of that feature?

  This is part of CVE-2014-5146 / XSA-97.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  Tested-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: 070493dfd2788e061b53f074b7ba97507fbcbf65
  master date: 2014-10-06 11:22:04 +0200
  c8ed54edda001163a5ff7610424dd2ef4244e8d6:x86/paging: make log-dirty operations preemptible

  Both the freeing and the inspection of the bitmap get done in (nested)
  loops which - besides having a rather high iteration count in general,
  albeit that would be covered by XSA-77 - have the number of non-trivial
  iterations they need to perform (indirectly) controllable by both the
  guest they are for and any domain controlling the guest (including the
  one running qemu for it).

  Note that the tying of the continuations to the invoking domain (which
  previously [wrongly] used the invoking vCPU instead) implies that the
  tools requesting such operations have to make sure they don't issue
  multiple similar operations in parallel.

  Note further that this breaks supervisor-mode kernel assumptions in
  hypercall_create_continuation() (where regs->eip gets rewound to the
  current hypercall stub beginning), but otoh
  hypercall_cancel_continuation() doesn't work in that mode either.
  Perhaps time to rip out all the remains of that feature?

  This is part of CVE-2014-5146 / XSA-97.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  Tested-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: 070493dfd2788e061b53f074b7ba97507fbcbf65
  master date: 2014-10-06 11:22:04 +0200
  070493dfd2788e061b53f074b7ba97507fbcbf65:x86/paging: make log-dirty operations preemptible

  Both the freeing and the inspection of the bitmap get done in (nested)
  loops which - besides having a rather high iteration count in general,
  albeit that would be covered by XSA-77 - have the number of non-trivial
  iterations they need to perform (indirectly) controllable by both the
  guest they are for and any domain controlling the guest (including the
  one running qemu for it).

  Note that the tying of the continuations to the invoking domain (which
  previously [wrongly] used the invoking vCPU instead) implies that the
  tools requesting such operations have to make sure they don't issue
  multiple similar operations in parallel.

  Note further that this breaks supervisor-mode kernel assumptions in
  hypercall_create_continuation() (where regs->eip gets rewound to the
  current hypercall stub beginning), but otoh
  hypercall_cancel_continuation() doesn't work in that mode either.
  Perhaps time to rip out all the remains of that feature?

  This is part of CVE-2014-5146 / XSA-97.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  Tested-by: Andrew Cooper <andrew.cooper3@citrix.com>
  6fbd99d7cc46a91566839e85bffb9bff406adbae:x86/paging: make log-dirty operations preemptible

  Both the freeing and the inspection of the bitmap get done in (nested)
  loops which - besides having a rather high iteration count in general,
  albeit that would be covered by XSA-77 - have the number of non-trivial
  iterations they need to perform (indirectly) controllable by both the
  guest they are for and any domain controlling the guest (including the
  one running qemu for it).

  This is CVE-2014-5146 / XSA-97.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  master commit: 95e6d82224689fdfd967a093a4d69efc24c17e91
  master date: 2014-08-12 15:30:11 +0200
  b497ecca359466294d169b07a62b98eef7dc0a36:x86/paging: make log-dirty operations preemptible

  Both the freeing and the inspection of the bitmap get done in (nested)
  loops which - besides having a rather high iteration count in general,
  albeit that would be covered by XSA-77 - have the number of non-trivial
  iterations they need to perform (indirectly) controllable by both the
  guest they are for and any domain controlling the guest (including the
  one running qemu for it).

  This is CVE-2014-5146 / XSA-97.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  master commit: 95e6d82224689fdfd967a093a4d69efc24c17e91
  master date: 2014-08-12 15:30:11 +0200
  89f167e04ed89109c06092b8edf46c1519cab5f3:x86/paging: make log-dirty operations preemptible

  Both the freeing and the inspection of the bitmap get done in (nested)
  loops which - besides having a rather high iteration count in general,
  albeit that would be covered by XSA-77 - have the number of non-trivial
  iterations they need to perform (indirectly) controllable by both the
  guest they are for and any domain controlling the guest (including the
  one running qemu for it).

  This is CVE-2014-5146 / XSA-97.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
  master commit: 95e6d82224689fdfd967a093a4d69efc24c17e91
  master date: 2014-08-12 15:30:11 +0200
  95e6d82224689fdfd967a093a4d69efc24c17e91:x86/paging: make log-dirty operations preemptible

  Both the freeing and the inspection of the bitmap get done in (nested)
  loops which - besides having a rather high iteration count in general,
  albeit that would be covered by XSA-77 - have the number of non-trivial
  iterations they need to perform (indirectly) controllable by both the
  guest they are for and any domain controlling the guest (including the
  one running qemu for it).

  This is CVE-2014-5146 / XSA-97.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Tim Deegan <tim@xen.org>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 070493dfd2788e061b53f074b7ba97507fbcbf65
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 6fbd99d7cc46a91566839e85bffb9bff406adbae
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: b497ecca359466294d169b07a62b98eef7dc0a36
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: c844974caf1501b6527533ab2a3d27ea8920ab90
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 89f167e04ed89109c06092b8edf46c1519cab5f3
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: c8ed54edda001163a5ff7610424dd2ef4244e8d6
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 95e6d82224689fdfd967a093a4d69efc24c17e91
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 425e9039b6532a8c5884e7fe4b6676f6cd493770
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/070493dfd2788e061b53f074b7ba97507fbcbf65
    reference_type: commit
    reference_id: 070493dfd2788e061b53f074b7ba97507fbcbf65
  - url: https://github.com/xen-project/xen/tree/425e9039b6532a8c5884e7fe4b6676f6cd493770
    reference_type: commit
    reference_id: 425e9039b6532a8c5884e7fe4b6676f6cd493770
  - url: https://github.com/xen-project/xen/tree/6fbd99d7cc46a91566839e85bffb9bff406adbae
    reference_type: commit
    reference_id: 6fbd99d7cc46a91566839e85bffb9bff406adbae
  - url: https://github.com/xen-project/xen/tree/89f167e04ed89109c06092b8edf46c1519cab5f3
    reference_type: commit
    reference_id: 89f167e04ed89109c06092b8edf46c1519cab5f3
  - url: https://github.com/xen-project/xen/tree/95e6d82224689fdfd967a093a4d69efc24c17e91
    reference_type: commit
    reference_id: 95e6d82224689fdfd967a093a4d69efc24c17e91
  - url: https://github.com/xen-project/xen/tree/b497ecca359466294d169b07a62b98eef7dc0a36
    reference_type: commit
    reference_id: b497ecca359466294d169b07a62b98eef7dc0a36
  - url: https://github.com/xen-project/xen/tree/c844974caf1501b6527533ab2a3d27ea8920ab90
    reference_type: commit
    reference_id: c844974caf1501b6527533ab2a3d27ea8920ab90
  - url: https://github.com/xen-project/xen/tree/c8ed54edda001163a5ff7610424dd2ef4244e8d6
    reference_type: commit
    reference_id: c8ed54edda001163a5ff7610424dd2ef4244e8d6
