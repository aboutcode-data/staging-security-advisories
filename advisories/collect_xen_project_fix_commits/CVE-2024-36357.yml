advisory_id: CVE-2024-36357
datasource_id: collect_xen_project_fix_commits/CVE-2024-36357
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  14bcad65932ce4d5651885de2bade58e8792715a:x86/spec-ctrl: Mitigate Transitive Scheduler Attacks

  TSA affects AMD Fam19h CPUs (Zen3 and 4 microarchitectures).

  Three new CPUID bits have been defined.  Two (TSA_SQ_NO and TSA_L1_NO)
  indicate that the system is unaffected, and must be synthesised by Xen on
  unaffected parts to date.

  A third new bit indicates that VERW now has a flushing side effect.  Xen must
  synthesise this bit on affected systems based on microcode version.  As with
  other VERW-based flushing features, VERW_CLEAR needs OR-ing across a resource
  pool, and guests which have seen it can safely migrate in.

  This is part of XSA-471 / CVE-2024-36350 / CVE-2024-36357.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit 578b34adb1cc149dfeeb2491f84eed43fcd1ee2f)
  1fe13584d28a92f1ecf21ad127401e89db7c9b47:x86/idle: Rearrange VERW and MONITOR in mwait_idle_with_hints()

  In order to mitigate TSA, Xen will need to issue VERW before going idle.

  On AMD CPUs, the VERW scrubbing side effects cancel an active MONITOR, causing
  the MWAIT to exit without entering an idle state.  Therefore the VERW must be
  ahead of MONITOR.

  Split spec_ctrl_enter_idle() in two and allow the VERW aspect to be handled
  separately.  While adjusting, update a stale comment concerning MSBDS; more
  issues have been mitigated using VERW since it was written.

  By moving VERW earlier, it is ahead of the determination of whether to go
  idle.  We can't move the check on softirq_pending (for correctness reasons),
  but we can duplicate it earlier as a best effort attempt to skip the
  speculative overhead.

  This is part of XSA-471 / CVE-2024-36350 / CVE-2024-36357.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit 01429bbb0a6152281d2fdf26cd122ecdd1234d53)
  7a7171a236f973c81d89ecdf9b2e068f6e59df46:x86/ucode: Digests for TSA microcode

  AMD are releasing microcode for TSA, so extend the known-provenance list with
  their hashes.  These were produced before the remediation of the microcode
  signature issues (the entrysign vulnerability), so can be OS-loaded on
  out-of-date firmware.

  Include an off-by-default check for the sorted-ness of patch_digests[].  It's
  not worth running generally under SELF_TESTS, but is useful when editing the
  digest list.

  This is part of XSA-471 / CVE-2024-36350 / CVE-2024-36357.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit a8708ea8bd4eefa7b4d0d04c5b775d264bdae14c)
  578b34adb1cc149dfeeb2491f84eed43fcd1ee2f:x86/spec-ctrl: Mitigate Transitive Scheduler Attacks

  TSA affects AMD Fam19h CPUs (Zen3 and 4 microarchitectures).

  Three new CPUID bits have been defined.  Two (TSA_SQ_NO and TSA_L1_NO)
  indicate that the system is unaffected, and must be synthesised by Xen on
  unaffected parts to date.

  A third new bit indicates that VERW now has a flushing side effect.  Xen
  must synthesise this bit on affected systems based on microcode version.
  As with other VERW-based flushing features, VERW_CLEAR needs OR-ing across
  a resource pool, and guests which have seen it can safely migrate in.

  This is part of XSA-471 / CVE-2024-36350 / CVE-2024-36357.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  01429bbb0a6152281d2fdf26cd122ecdd1234d53:x86/idle: Rearrange VERW and MONITOR in mwait_idle_with_hints()

  In order to mitigate TSA, Xen will need to issue VERW before going idle.

  On AMD CPUs, the VERW scrubbing side effects cancel an active MONITOR, causing
  the MWAIT to exit without entering an idle state.  Therefore the VERW must be
  ahead of MONITOR.

  Split spec_ctrl_enter_idle() in two and allow the VERW aspect to be handled
  separately.  While adjusting, update a stale comment concerning MSBDS; more
  issues have been mitigated using VERW since it was written.

  By moving VERW earlier, it is ahead of the determination of whether to go
  idle.  We can't move the check on softirq_pending (for correctness reasons),
  but we can duplicate it earlier as a best effort attempt to skip the
  speculative overhead.

  This is part of XSA-471 / CVE-2024-36350 / CVE-2024-36357.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  a8708ea8bd4eefa7b4d0d04c5b775d264bdae14c:x86/ucode: Digests for TSA microcode

  AMD are releasing microcode for TSA, so extend the known-provenance list with
  their hashes.  These were produced before the remediation of the microcode
  signature issues (the entrysign vulnerability), so can be OS-loaded on
  out-of-date firmware.

  Include an off-by-default check for the sorted-ness of patch_digests[].  It's
  not worth running generally under SELF_TESTS, but is useful when editing the
  digest list.

  This is part of XSA-471 / CVE-2024-36350 / CVE-2024-36357.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jan Beulich <jbeulich@suse.com>
  13d3020ca1c2dac52609655de326c04b8fc22a22:x86/spec-ctrl: Mitigate Transitive Scheduler Attacks

  TSA affects AMD Fam19h CPUs (Zen3 and 4 microarchitectures).

  Three new CPUID bits have been defined.  Two (TSA_SQ_NO and TSA_L1_NO)
  indicate that the system is unaffected, and must be synthesised by Xen on
  unaffected parts to date.

  A third new bit indicates that VERW now has a flushing side effect.  Xen must
  synthesise this bit on affected systems based on microcode version.  As with
  other VERW-based flushing features, VERW_CLEAR needs OR-ing across a resource
  pool, and guests which have seen it can safely migrate in.

  This is part of XSA-471 / CVE-2024-36350 / CVE-2024-36357.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit 578b34adb1cc149dfeeb2491f84eed43fcd1ee2f)
  5e9a7f0afad6e5761d8c08862939d409ce1bd758:x86/spec-ctrl: Mitigate Transitive Scheduler Attacks

  TSA affects AMD Fam19h CPUs (Zen3 and 4 microarchitectures).

  Three new CPUID bits have been defined.  Two (TSA_SQ_NO and TSA_L1_NO)
  indicate that the system is unaffected, and must be synthesised by Xen on
  unaffected parts to date.

  A third new bit indicates that VERW now has a flushing side effect.  Xen
  must synthesise this bit on affected systems based on microcode version.
  As with other VERW-based flushing features, VERW_CLEAR needs OR-ing across
  a resource pool, and guests which have seen it can safely migrate in.

  This is part of XSA-471 / CVE-2024-36350 / CVE-2024-36357.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit 578b34adb1cc149dfeeb2491f84eed43fcd1ee2f)
  138d403e0737da0c96d0d76d3ccf34748765d77b:x86/spec-ctrl: Mitigate Transitive Scheduler Attacks

  TSA affects AMD Fam19h CPUs (Zen3 and 4 microarchitectures).

  Three new CPUID bits have been defined.  Two (TSA_SQ_NO and TSA_L1_NO)
  indicate that the system is unaffected, and must be synthesised by Xen on
  unaffected parts to date.

  A third new bit indicates that VERW now has a flushing side effect.  Xen
  must synthesise this bit on affected systems based on microcode version.
  As with other VERW-based flushing features, VERW_CLEAR needs OR-ing across
  a resource pool, and guests which have seen it can safely migrate in.

  This is part of XSA-471 / CVE-2024-36350 / CVE-2024-36357.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit 578b34adb1cc149dfeeb2491f84eed43fcd1ee2f)
  05b991100e55da9f6cbc59e2b11c5c5258e6c906:x86/idle: Rearrange VERW and MONITOR in mwait_idle_with_hints()

  In order to mitigate TSA, Xen will need to issue VERW before going idle.

  On AMD CPUs, the VERW scrubbing side effects cancel an active MONITOR, causing
  the MWAIT to exit without entering an idle state.  Therefore the VERW must be
  ahead of MONITOR.

  Split spec_ctrl_enter_idle() in two and allow the VERW aspect to be handled
  separately.  While adjusting, update a stale comment concerning MSBDS; more
  issues have been mitigated using VERW since it was written.

  By moving VERW earlier, it is ahead of the determination of whether to go
  idle.  We can't move the check on softirq_pending (for correctness reasons),
  but we can duplicate it earlier as a best effort attempt to skip the
  speculative overhead.

  This is part of XSA-471 / CVE-2024-36350 / CVE-2024-36357.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit 01429bbb0a6152281d2fdf26cd122ecdd1234d53)
  be1e30b45d4a9217ca0e55f07f9807f211162f45:x86/ucode: Digests for TSA microcode

  AMD are releasing microcode for TSA, so extend the known-provenance list with
  their hashes.  These were produced before the remediation of the microcode
  signature issues (the entrysign vulnerability), so can be OS-loaded on
  out-of-date firmware.

  Include an off-by-default check for the sorted-ness of patch_digests[].  It's
  not worth running generally under SELF_TESTS, but is useful when editing the
  digest list.

  This is part of XSA-471 / CVE-2024-36350 / CVE-2024-36357.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit a8708ea8bd4eefa7b4d0d04c5b775d264bdae14c)
  4f8a624a3fd63f3819411d2caca12d1efcadd279:x86/idle: Rearrange VERW and MONITOR in mwait_idle_with_hints()

  In order to mitigate TSA, Xen will need to issue VERW before going idle.

  On AMD CPUs, the VERW scrubbing side effects cancel an active MONITOR, causing
  the MWAIT to exit without entering an idle state.  Therefore the VERW must be
  ahead of MONITOR.

  Split spec_ctrl_enter_idle() in two and allow the VERW aspect to be handled
  separately.  While adjusting, update a stale comment concerning MSBDS; more
  issues have been mitigated using VERW since it was written.

  By moving VERW earlier, it is ahead of the determination of whether to go
  idle.  We can't move the check on softirq_pending (for correctness reasons),
  but we can duplicate it earlier as a best effort attempt to skip the
  speculative overhead.

  This is part of XSA-471 / CVE-2024-36350 / CVE-2024-36357.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit 01429bbb0a6152281d2fdf26cd122ecdd1234d53)
  0ce518bf52027a52a8da5cb7fb0464a502c3cfa5:x86/ucode: Digests for TSA microcode

  AMD are releasing microcode for TSA, so extend the known-provenance list with
  their hashes.  These were produced before the remediation of the microcode
  signature issues (the entrysign vulnerability), so can be OS-loaded on
  out-of-date firmware.

  Include an off-by-default check for the sorted-ness of patch_digests[].  It's
  not worth running generally under SELF_TESTS, but is useful when editing the
  digest list.

  This is part of XSA-471 / CVE-2024-36350 / CVE-2024-36357.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit a8708ea8bd4eefa7b4d0d04c5b775d264bdae14c)
  d8cab42238afacdb72b4291bebb95444ba465c00:x86/idle: Rearrange VERW and MONITOR in mwait_idle_with_hints()

  In order to mitigate TSA, Xen will need to issue VERW before going idle.

  On AMD CPUs, the VERW scrubbing side effects cancel an active MONITOR, causing
  the MWAIT to exit without entering an idle state.  Therefore the VERW must be
  ahead of MONITOR.

  Split spec_ctrl_enter_idle() in two and allow the VERW aspect to be handled
  separately.  While adjusting, update a stale comment concerning MSBDS; more
  issues have been mitigated using VERW since it was written.

  By moving VERW earlier, it is ahead of the determination of whether to go
  idle.  We can't move the check on softirq_pending (for correctness reasons),
  but we can duplicate it earlier as a best effort attempt to skip the
  speculative overhead.

  This is part of XSA-471 / CVE-2024-36350 / CVE-2024-36357.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit 01429bbb0a6152281d2fdf26cd122ecdd1234d53)
  41b62f8a96f6df6b70666c24cf8648f31299692a:x86/ucode: Digests for TSA microcode

  AMD are releasing microcode for TSA, so extend the known-provenance list with
  their hashes.  These were produced before the remediation of the microcode
  signature issues (the entrysign vulnerability), so can be OS-loaded on
  out-of-date firmware.

  Include an off-by-default check for the sorted-ness of patch_digests[].  It's
  not worth running generally under SELF_TESTS, but is useful when editing the
  digest list.

  This is part of XSA-471 / CVE-2024-36350 / CVE-2024-36357.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Acked-by: Jan Beulich <jbeulich@suse.com>
  (cherry picked from commit a8708ea8bd4eefa7b4d0d04c5b775d264bdae14c)
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 138d403e0737da0c96d0d76d3ccf34748765d77b
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 7a7171a236f973c81d89ecdf9b2e068f6e59df46
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 05b991100e55da9f6cbc59e2b11c5c5258e6c906
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: be1e30b45d4a9217ca0e55f07f9807f211162f45
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: d8cab42238afacdb72b4291bebb95444ba465c00
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 578b34adb1cc149dfeeb2491f84eed43fcd1ee2f
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 13d3020ca1c2dac52609655de326c04b8fc22a22
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 4f8a624a3fd63f3819411d2caca12d1efcadd279
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 1fe13584d28a92f1ecf21ad127401e89db7c9b47
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 01429bbb0a6152281d2fdf26cd122ecdd1234d53
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 41b62f8a96f6df6b70666c24cf8648f31299692a
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: a8708ea8bd4eefa7b4d0d04c5b775d264bdae14c
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 0ce518bf52027a52a8da5cb7fb0464a502c3cfa5
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 14bcad65932ce4d5651885de2bade58e8792715a
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 5e9a7f0afad6e5761d8c08862939d409ce1bd758
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/01429bbb0a6152281d2fdf26cd122ecdd1234d53
    reference_type: commit
    reference_id: 01429bbb0a6152281d2fdf26cd122ecdd1234d53
  - url: https://github.com/xen-project/xen/tree/05b991100e55da9f6cbc59e2b11c5c5258e6c906
    reference_type: commit
    reference_id: 05b991100e55da9f6cbc59e2b11c5c5258e6c906
  - url: https://github.com/xen-project/xen/tree/0ce518bf52027a52a8da5cb7fb0464a502c3cfa5
    reference_type: commit
    reference_id: 0ce518bf52027a52a8da5cb7fb0464a502c3cfa5
  - url: https://github.com/xen-project/xen/tree/138d403e0737da0c96d0d76d3ccf34748765d77b
    reference_type: commit
    reference_id: 138d403e0737da0c96d0d76d3ccf34748765d77b
  - url: https://github.com/xen-project/xen/tree/13d3020ca1c2dac52609655de326c04b8fc22a22
    reference_type: commit
    reference_id: 13d3020ca1c2dac52609655de326c04b8fc22a22
  - url: https://github.com/xen-project/xen/tree/14bcad65932ce4d5651885de2bade58e8792715a
    reference_type: commit
    reference_id: 14bcad65932ce4d5651885de2bade58e8792715a
  - url: https://github.com/xen-project/xen/tree/1fe13584d28a92f1ecf21ad127401e89db7c9b47
    reference_type: commit
    reference_id: 1fe13584d28a92f1ecf21ad127401e89db7c9b47
  - url: https://github.com/xen-project/xen/tree/41b62f8a96f6df6b70666c24cf8648f31299692a
    reference_type: commit
    reference_id: 41b62f8a96f6df6b70666c24cf8648f31299692a
  - url: https://github.com/xen-project/xen/tree/4f8a624a3fd63f3819411d2caca12d1efcadd279
    reference_type: commit
    reference_id: 4f8a624a3fd63f3819411d2caca12d1efcadd279
  - url: https://github.com/xen-project/xen/tree/578b34adb1cc149dfeeb2491f84eed43fcd1ee2f
    reference_type: commit
    reference_id: 578b34adb1cc149dfeeb2491f84eed43fcd1ee2f
  - url: https://github.com/xen-project/xen/tree/5e9a7f0afad6e5761d8c08862939d409ce1bd758
    reference_type: commit
    reference_id: 5e9a7f0afad6e5761d8c08862939d409ce1bd758
  - url: https://github.com/xen-project/xen/tree/7a7171a236f973c81d89ecdf9b2e068f6e59df46
    reference_type: commit
    reference_id: 7a7171a236f973c81d89ecdf9b2e068f6e59df46
  - url: https://github.com/xen-project/xen/tree/a8708ea8bd4eefa7b4d0d04c5b775d264bdae14c
    reference_type: commit
    reference_id: a8708ea8bd4eefa7b4d0d04c5b775d264bdae14c
  - url: https://github.com/xen-project/xen/tree/be1e30b45d4a9217ca0e55f07f9807f211162f45
    reference_type: commit
    reference_id: be1e30b45d4a9217ca0e55f07f9807f211162f45
  - url: https://github.com/xen-project/xen/tree/d8cab42238afacdb72b4291bebb95444ba465c00
    reference_type: commit
    reference_id: d8cab42238afacdb72b4291bebb95444ba465c00
