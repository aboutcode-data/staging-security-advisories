advisory_id: CVE-2022-42324
datasource_id: collect_xen_project_fix_commits/CVE-2022-42324
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  29506319c6cefb370bafc20689b67a4a3523197e:tools/ocaml: Ensure packet size is never negative

  Integers in Ocaml have 63 or 31 bits of signed precision.

  On 64-bit builds of Ocaml, this is fine because a C uint32_t always fits
  within a 63-bit signed integer.

  In 32-bit builds of Ocaml, this goes wrong.  The C uint32_t is truncated
  first (loses the top bit), then has a unsigned/signed mismatch.

  A "negative" value (i.e. a packet on the ring of between 1G and 2G in size)
  will trigger an exception later in Bytes.make in xb.ml, and because the packet
  is not removed from the ring, the exception re-triggers on every subsequent
  query, creating a livelock.

  Fix both the source of the exception in Xb, and as defence in depth, mark the
  domain as bad for any Invalid_argument exceptions to avoid the risk of
  livelock.

  This is XSA-420 / CVE-2022-42324.

  Signed-off-by: Edwin Török <edvin.torok@citrix.com>
  Acked-by: Christian Lindig <christian.lindig@citrix.com>
  (cherry picked from commit ae34df4d82636f4c82700b447ea2c93b9f82b3f3)
  ecbfb3bd49526adf48f739445502aaff8e69e442:tools/ocaml: Ensure packet size is never negative

  Integers in Ocaml have 63 or 31 bits of signed precision.

  On 64-bit builds of Ocaml, this is fine because a C uint32_t always fits
  within a 63-bit signed integer.

  In 32-bit builds of Ocaml, this goes wrong.  The C uint32_t is truncated
  first (loses the top bit), then has a unsigned/signed mismatch.

  A "negative" value (i.e. a packet on the ring of between 1G and 2G in size)
  will trigger an exception later in Bytes.make in xb.ml, and because the packet
  is not removed from the ring, the exception re-triggers on every subsequent
  query, creating a livelock.

  Fix both the source of the exception in Xb, and as defence in depth, mark the
  domain as bad for any Invalid_argument exceptions to avoid the risk of
  livelock.

  This is XSA-420 / CVE-2022-42324.

  Signed-off-by: Edwin Török <edvin.torok@citrix.com>
  Acked-by: Christian Lindig <christian.lindig@citrix.com>
  (cherry picked from commit ae34df4d82636f4c82700b447ea2c93b9f82b3f3)
  d3649d33e1eae49d3925ef34a7ccf39cae8852e6:tools/ocaml: Ensure packet size is never negative

  Integers in Ocaml have 63 or 31 bits of signed precision.

  On 64-bit builds of Ocaml, this is fine because a C uint32_t always fits
  within a 63-bit signed integer.

  In 32-bit builds of Ocaml, this goes wrong.  The C uint32_t is truncated
  first (loses the top bit), then has a unsigned/signed mismatch.

  A "negative" value (i.e. a packet on the ring of between 1G and 2G in size)
  will trigger an exception later in Bytes.make in xb.ml, and because the packet
  is not removed from the ring, the exception re-triggers on every subsequent
  query, creating a livelock.

  Fix both the source of the exception in Xb, and as defence in depth, mark the
  domain as bad for any Invalid_argument exceptions to avoid the risk of
  livelock.

  This is XSA-420 / CVE-2022-42324.

  Signed-off-by: Edwin Török <edvin.torok@citrix.com>
  Acked-by: Christian Lindig <christian.lindig@citrix.com>
  (cherry picked from commit ae34df4d82636f4c82700b447ea2c93b9f82b3f3)
  635390415f4a9c0621330f0b40f8c7e914c4523f:tools/ocaml: Ensure packet size is never negative

  Integers in Ocaml have 63 or 31 bits of signed precision.

  On 64-bit builds of Ocaml, this is fine because a C uint32_t always fits
  within a 63-bit signed integer.

  In 32-bit builds of Ocaml, this goes wrong.  The C uint32_t is truncated
  first (loses the top bit), then has a unsigned/signed mismatch.

  A "negative" value (i.e. a packet on the ring of between 1G and 2G in size)
  will trigger an exception later in Bytes.make in xb.ml, and because the packet
  is not removed from the ring, the exception re-triggers on every subsequent
  query, creating a livelock.

  Fix both the source of the exception in Xb, and as defence in depth, mark the
  domain as bad for any Invalid_argument exceptions to avoid the risk of
  livelock.

  This is XSA-420 / CVE-2022-42324.

  Signed-off-by: Edwin Török <edvin.torok@citrix.com>
  Acked-by: Christian Lindig <christian.lindig@citrix.com>
  (cherry picked from commit ae34df4d82636f4c82700b447ea2c93b9f82b3f3)
  ae34df4d82636f4c82700b447ea2c93b9f82b3f3:tools/ocaml: Ensure packet size is never negative

  Integers in Ocaml have 63 or 31 bits of signed precision.

  On 64-bit builds of Ocaml, this is fine because a C uint32_t always fits
  within a 63-bit signed integer.

  In 32-bit builds of Ocaml, this goes wrong.  The C uint32_t is truncated
  first (loses the top bit), then has a unsigned/signed mismatch.

  A "negative" value (i.e. a packet on the ring of between 1G and 2G in size)
  will trigger an exception later in Bytes.make in xb.ml, and because the packet
  is not removed from the ring, the exception re-triggers on every subsequent
  query, creating a livelock.

  Fix both the source of the exception in Xb, and as defence in depth, mark the
  domain as bad for any Invalid_argument exceptions to avoid the risk of
  livelock.

  This is XSA-420 / CVE-2022-42324.

  Signed-off-by: Edwin Török <edvin.torok@citrix.com>
  Acked-by: Christian Lindig <christian.lindig@citrix.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 635390415f4a9c0621330f0b40f8c7e914c4523f
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 29506319c6cefb370bafc20689b67a4a3523197e
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: ae34df4d82636f4c82700b447ea2c93b9f82b3f3
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: ecbfb3bd49526adf48f739445502aaff8e69e442
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: d3649d33e1eae49d3925ef34a7ccf39cae8852e6
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/29506319c6cefb370bafc20689b67a4a3523197e
    reference_type: commit
    reference_id: 29506319c6cefb370bafc20689b67a4a3523197e
  - url: https://github.com/xen-project/xen/tree/635390415f4a9c0621330f0b40f8c7e914c4523f
    reference_type: commit
    reference_id: 635390415f4a9c0621330f0b40f8c7e914c4523f
  - url: https://github.com/xen-project/xen/tree/ae34df4d82636f4c82700b447ea2c93b9f82b3f3
    reference_type: commit
    reference_id: ae34df4d82636f4c82700b447ea2c93b9f82b3f3
  - url: https://github.com/xen-project/xen/tree/d3649d33e1eae49d3925ef34a7ccf39cae8852e6
    reference_type: commit
    reference_id: d3649d33e1eae49d3925ef34a7ccf39cae8852e6
  - url: https://github.com/xen-project/xen/tree/ecbfb3bd49526adf48f739445502aaff8e69e442
    reference_type: commit
    reference_id: ecbfb3bd49526adf48f739445502aaff8e69e442
