advisory_id: CVE-2022-26360
datasource_id: collect_xen_project_fix_commits/CVE-2022-26360
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  1a250caadb837748e4a797019fc3cb0f790c9bab:AMD/IOMMU: re-assign devices directly

  Devices with unity map ranges, due to it being unspecified how/when
  these memory ranges may get accessed, may not be left disconnected from
  their unity mappings (as long as it's not certain that the device has
  been fully quiesced). Hence rather than tearing down the old root page
  table pointer and then establishing the new one, re-assignment needs to
  be done in a single step.

  This is CVE-2022-26360 / part of XSA-400.

  Reported-by: Roger Pau Monné <roger.pau@citrix.com>

  Similarly quarantining scratch-page mode relies on page tables to be
  continuously wired up.

  To avoid complicating things more than necessary, treat all devices
  mostly equally, i.e. regardless of their association with any unity map
  ranges.  The main difference is when it comes to updating DTEs, which need
  to be atomic when there are unity mappings. Yet atomicity can only be
  achieved with CMPXCHG16B, availability of which we can't take for given.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Paul Durrant <paul@xen.org>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
  master commit: 1fa6e9aa36233fe9c29a204fcb2697e985b8345f
  master date: 2022-04-05 14:18:04 +0200
  73e25ecaef14d4df521235b6dbe5ceaaa3f02e8a:AMD/IOMMU: re-assign devices directly

  Devices with unity map ranges, due to it being unspecified how/when
  these memory ranges may get accessed, may not be left disconnected from
  their unity mappings (as long as it's not certain that the device has
  been fully quiesced). Hence rather than tearing down the old root page
  table pointer and then establishing the new one, re-assignment needs to
  be done in a single step.

  This is CVE-2022-26360 / part of XSA-400.

  Reported-by: Roger Pau Monné <roger.pau@citrix.com>

  Similarly quarantining scratch-page mode relies on page tables to be
  continuously wired up.

  To avoid complicating things more than necessary, treat all devices
  mostly equally, i.e. regardless of their association with any unity map
  ranges.  The main difference is when it comes to updating DTEs, which need
  to be atomic when there are unity mappings. Yet atomicity can only be
  achieved with CMPXCHG16B, availability of which we can't take for given.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Paul Durrant <paul@xen.org>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
  master commit: 1fa6e9aa36233fe9c29a204fcb2697e985b8345f
  master date: 2022-04-05 14:18:04 +0200
  037d360f578eb71c522af6550085e3df56d4fd30:AMD/IOMMU: re-assign devices directly

  Devices with unity map ranges, due to it being unspecified how/when
  these memory ranges may get accessed, may not be left disconnected from
  their unity mappings (as long as it's not certain that the device has
  been fully quiesced). Hence rather than tearing down the old root page
  table pointer and then establishing the new one, re-assignment needs to
  be done in a single step.

  This is CVE-2022-26360 / part of XSA-400.

  Reported-by: Roger Pau Monné <roger.pau@citrix.com>

  Similarly quarantining scratch-page mode relies on page tables to be
  continuously wired up.

  To avoid complicating things more than necessary, treat all devices
  mostly equally, i.e. regardless of their association with any unity map
  ranges.  The main difference is when it comes to updating DTEs, which need
  to be atomic when there are unity mappings. Yet atomicity can only be
  achieved with CMPXCHG16B, availability of which we can't take for given.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Paul Durrant <paul@xen.org>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
  master commit: 1fa6e9aa36233fe9c29a204fcb2697e985b8345f
  master date: 2022-04-05 14:18:04 +0200
  754cabadc9eba62241d2bcde6df9cd65208f51f2:AMD/IOMMU: re-assign devices directly

  Devices with unity map ranges, due to it being unspecified how/when
  these memory ranges may get accessed, may not be left disconnected from
  their unity mappings (as long as it's not certain that the device has
  been fully quiesced). Hence rather than tearing down the old root page
  table pointer and then establishing the new one, re-assignment needs to
  be done in a single step.

  This is CVE-2022-26360 / part of XSA-400.

  Reported-by: Roger Pau Monné <roger.pau@citrix.com>

  Similarly quarantining scratch-page mode relies on page tables to be
  continuously wired up.

  To avoid complicating things more than necessary, treat all devices
  mostly equally, i.e. regardless of their association with any unity map
  ranges.  The main difference is when it comes to updating DTEs, which need
  to be atomic when there are unity mappings. Yet atomicity can only be
  achieved with CMPXCHG16B, availability of which we can't take for given.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Paul Durrant <paul@xen.org>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
  master commit: 1fa6e9aa36233fe9c29a204fcb2697e985b8345f
  master date: 2022-04-05 14:18:04 +0200
  81717050857b002ccd30f5476d179e3173707047:AMD/IOMMU: re-assign devices directly

  Devices with unity map ranges, due to it being unspecified how/when
  these memory ranges may get accessed, may not be left disconnected from
  their unity mappings (as long as it's not certain that the device has
  been fully quiesced). Hence rather than tearing down the old root page
  table pointer and then establishing the new one, re-assignment needs to
  be done in a single step.

  This is CVE-2022-26360 / part of XSA-400.

  Reported-by: Roger Pau Monné <roger.pau@citrix.com>

  Similarly quarantining scratch-page mode relies on page tables to be
  continuously wired up.

  To avoid complicating things more than necessary, treat all devices
  mostly equally, i.e. regardless of their association with any unity map
  ranges.  The main difference is when it comes to updating DTEs, which need
  to be atomic when there are unity mappings. Yet atomicity can only be
  achieved with CMPXCHG16B, availability of which we can't take for given.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Paul Durrant <paul@xen.org>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
  master commit: 1fa6e9aa36233fe9c29a204fcb2697e985b8345f
  master date: 2022-04-05 14:18:04 +0200
  1fa6e9aa36233fe9c29a204fcb2697e985b8345f:AMD/IOMMU: re-assign devices directly

  Devices with unity map ranges, due to it being unspecified how/when
  these memory ranges may get accessed, may not be left disconnected from
  their unity mappings (as long as it's not certain that the device has
  been fully quiesced). Hence rather than tearing down the old root page
  table pointer and then establishing the new one, re-assignment needs to
  be done in a single step.

  This is CVE-2022-26360 / part of XSA-400.

  Reported-by: Roger Pau Monné <roger.pau@citrix.com>

  Similarly quarantining scratch-page mode relies on page tables to be
  continuously wired up.

  To avoid complicating things more than necessary, treat all devices
  mostly equally, i.e. regardless of their association with any unity map
  ranges.  The main difference is when it comes to updating DTEs, which need
  to be atomic when there are unity mappings. Yet atomicity can only be
  achieved with CMPXCHG16B, availability of which we can't take for given.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Paul Durrant <paul@xen.org>
  Reviewed-by: Roger Pau Monné <roger.pau@citrix.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 037d360f578eb71c522af6550085e3df56d4fd30
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 73e25ecaef14d4df521235b6dbe5ceaaa3f02e8a
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 754cabadc9eba62241d2bcde6df9cd65208f51f2
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 1a250caadb837748e4a797019fc3cb0f790c9bab
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 1fa6e9aa36233fe9c29a204fcb2697e985b8345f
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 81717050857b002ccd30f5476d179e3173707047
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/037d360f578eb71c522af6550085e3df56d4fd30
    reference_type: commit
    reference_id: 037d360f578eb71c522af6550085e3df56d4fd30
  - url: https://github.com/xen-project/xen/tree/1a250caadb837748e4a797019fc3cb0f790c9bab
    reference_type: commit
    reference_id: 1a250caadb837748e4a797019fc3cb0f790c9bab
  - url: https://github.com/xen-project/xen/tree/1fa6e9aa36233fe9c29a204fcb2697e985b8345f
    reference_type: commit
    reference_id: 1fa6e9aa36233fe9c29a204fcb2697e985b8345f
  - url: https://github.com/xen-project/xen/tree/73e25ecaef14d4df521235b6dbe5ceaaa3f02e8a
    reference_type: commit
    reference_id: 73e25ecaef14d4df521235b6dbe5ceaaa3f02e8a
  - url: https://github.com/xen-project/xen/tree/754cabadc9eba62241d2bcde6df9cd65208f51f2
    reference_type: commit
    reference_id: 754cabadc9eba62241d2bcde6df9cd65208f51f2
  - url: https://github.com/xen-project/xen/tree/81717050857b002ccd30f5476d179e3173707047
    reference_type: commit
    reference_id: 81717050857b002ccd30f5476d179e3173707047
