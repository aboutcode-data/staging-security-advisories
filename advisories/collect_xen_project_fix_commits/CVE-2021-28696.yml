advisory_id: CVE-2021-28696
datasource_id: collect_xen_project_fix_commits/CVE-2021-28696
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  ba79e525c1c7982e93d5f889cd66c783ecdf499a:AMD/IOMMU: re-arrange/complete re-assignment handling

  Prior to the assignment step having completed successfully, devices
  should not get associated with their new owner. Hand the device to DomIO
  (perhaps temporarily), until after the de-assignment step has completed.

  De-assignment of a device (from other than Dom0) as well as failure of
  reassign_device() during assignment should result in unity mappings
  getting torn down. This in turn requires switching to a refcounted
  mapping approach, as was already used by VT-d for its RMRRs, to prevent
  unmapping a region used by multiple devices.

  This is CVE-2021-28696 / part of XSA-378.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Paul Durrant <paul@xen.org>
  master commit: 899272539cbe1acda736a850015416fff653a1b6
  master date: 2021-08-25 14:16:26 +0200
  52ee570d15cd949472c9e7e2832f39d24254208d:AMD/IOMMU: re-arrange/complete re-assignment handling

  Prior to the assignment step having completed successfully, devices
  should not get associated with their new owner. Hand the device to DomIO
  (perhaps temporarily), until after the de-assignment step has completed.

  De-assignment of a device (from other than Dom0) as well as failure of
  reassign_device() during assignment should result in unity mappings
  getting torn down. This in turn requires switching to a refcounted
  mapping approach, as was already used by VT-d for its RMRRs, to prevent
  unmapping a region used by multiple devices.

  This is CVE-2021-28696 / part of XSA-378.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Paul Durrant <paul@xen.org>
  master commit: 899272539cbe1acda736a850015416fff653a1b6
  master date: 2021-08-25 14:16:26 +0200
  2357043846efeaa7a8b14791413103bb693dca52:AMD/IOMMU: re-arrange/complete re-assignment handling

  Prior to the assignment step having completed successfully, devices
  should not get associated with their new owner. Hand the device to DomIO
  (perhaps temporarily), until after the de-assignment step has completed.

  De-assignment of a device (from other than Dom0) as well as failure of
  reassign_device() during assignment should result in unity mappings
  getting torn down. This in turn requires switching to a refcounted
  mapping approach, as was already used by VT-d for its RMRRs, to prevent
  unmapping a region used by multiple devices.

  This is CVE-2021-28696 / part of XSA-378.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Paul Durrant <paul@xen.org>
  master commit: 899272539cbe1acda736a850015416fff653a1b6
  master date: 2021-08-25 14:16:26 +0200
  19587584f2f780547a8216b1b9d5cdf3dde29131:AMD/IOMMU: re-arrange/complete re-assignment handling

  Prior to the assignment step having completed successfully, devices
  should not get associated with their new owner. Hand the device to DomIO
  (perhaps temporarily), until after the de-assignment step has completed.

  De-assignment of a device (from other than Dom0) as well as failure of
  reassign_device() during assignment should result in unity mappings
  getting torn down. This in turn requires switching to a refcounted
  mapping approach, as was already used by VT-d for its RMRRs, to prevent
  unmapping a region used by multiple devices.

  This is CVE-2021-28696 / part of XSA-378.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Paul Durrant <paul@xen.org>
  master commit: 899272539cbe1acda736a850015416fff653a1b6
  master date: 2021-08-25 14:16:26 +0200
  d39756f0539cfe85742687e8134fdf1181139390:AMD/IOMMU: re-arrange/complete re-assignment handling

  Prior to the assignment step having completed successfully, devices
  should not get associated with their new owner. Hand the device to DomIO
  (perhaps temporarily), until after the de-assignment step has completed.

  De-assignment of a device (from other than Dom0) as well as failure of
  reassign_device() during assignment should result in unity mappings
  getting torn down. This in turn requires switching to a refcounted
  mapping approach, as was already used by VT-d for its RMRRs, to prevent
  unmapping a region used by multiple devices.

  This is CVE-2021-28696 / part of XSA-378.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Paul Durrant <paul@xen.org>
  master commit: 899272539cbe1acda736a850015416fff653a1b6
  master date: 2021-08-25 14:16:26 +0200
  899272539cbe1acda736a850015416fff653a1b6:AMD/IOMMU: re-arrange/complete re-assignment handling

  Prior to the assignment step having completed successfully, devices
  should not get associated with their new owner. Hand the device to DomIO
  (perhaps temporarily), until after the de-assignment step has completed.

  De-assignment of a device (from other than Dom0) as well as failure of
  reassign_device() during assignment should result in unity mappings
  getting torn down. This in turn requires switching to a refcounted
  mapping approach, as was already used by VT-d for its RMRRs, to prevent
  unmapping a region used by multiple devices.

  This is CVE-2021-28696 / part of XSA-378.

  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Paul Durrant <paul@xen.org>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 899272539cbe1acda736a850015416fff653a1b6
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: d39756f0539cfe85742687e8134fdf1181139390
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 2357043846efeaa7a8b14791413103bb693dca52
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 52ee570d15cd949472c9e7e2832f39d24254208d
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: '19587584f2f780547a8216b1b9d5cdf3dde29131'
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: ba79e525c1c7982e93d5f889cd66c783ecdf499a
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/19587584f2f780547a8216b1b9d5cdf3dde29131
    reference_type: commit
    reference_id: '19587584f2f780547a8216b1b9d5cdf3dde29131'
  - url: https://github.com/xen-project/xen/tree/2357043846efeaa7a8b14791413103bb693dca52
    reference_type: commit
    reference_id: 2357043846efeaa7a8b14791413103bb693dca52
  - url: https://github.com/xen-project/xen/tree/52ee570d15cd949472c9e7e2832f39d24254208d
    reference_type: commit
    reference_id: 52ee570d15cd949472c9e7e2832f39d24254208d
  - url: https://github.com/xen-project/xen/tree/899272539cbe1acda736a850015416fff653a1b6
    reference_type: commit
    reference_id: 899272539cbe1acda736a850015416fff653a1b6
  - url: https://github.com/xen-project/xen/tree/ba79e525c1c7982e93d5f889cd66c783ecdf499a
    reference_type: commit
    reference_id: ba79e525c1c7982e93d5f889cd66c783ecdf499a
  - url: https://github.com/xen-project/xen/tree/d39756f0539cfe85742687e8134fdf1181139390
    reference_type: commit
    reference_id: d39756f0539cfe85742687e8134fdf1181139390
