advisory_id: CVE-2015-7970
datasource_id: collect_xen_project_fix_commits/CVE-2015-7970
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  2d330c121eff67f4828dc8536180986e0dfdf14b:x86/PoD: Eager sweep for zeroed pages

  Based on the contents of a guests physical address space,
  p2m_pod_emergency_sweep() could degrade into a linear memcmp() from 0 to
  max_gfn, which runs non-preemptibly.

  As p2m_pod_emergency_sweep() runs behind the scenes in a number of contexts,
  making it preemptible is not feasible.

  Instead, a different approach is taken.  Recently-populated pages are eagerly
  checked for reclaimation, which amortises the p2m_pod_emergency_sweep()
  operation across each p2m_pod_demand_populate() operation.

  Note that in the case that a 2M superpage can't be reclaimed as a superpage,
  it is shattered if 4K pages of zeros can be reclaimed.  This is unfortunate
  but matches the previous behaviour, and is required to avoid regressions
  (domain crash from PoD exhaustion) with VMs configured close to the limit.

  This is CVE-2015-7970 / XSA-150.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: George Dunlap <george.dunlap@citrix.com>
  master commit: 101ce53266866144e724ed593173bc4098b300b9
  master date: 2015-10-29 13:36:25 +0100
  3638ff0e711e1a2bcb1ad8f3706d5ea079a54e79:x86/PoD: Eager sweep for zeroed pages

  Based on the contents of a guests physical address space,
  p2m_pod_emergency_sweep() could degrade into a linear memcmp() from 0 to
  max_gfn, which runs non-preemptibly.

  As p2m_pod_emergency_sweep() runs behind the scenes in a number of contexts,
  making it preemptible is not feasible.

  Instead, a different approach is taken.  Recently-populated pages are eagerly
  checked for reclaimation, which amortises the p2m_pod_emergency_sweep()
  operation across each p2m_pod_demand_populate() operation.

  Note that in the case that a 2M superpage can't be reclaimed as a superpage,
  it is shattered if 4K pages of zeros can be reclaimed.  This is unfortunate
  but matches the previous behaviour, and is required to avoid regressions
  (domain crash from PoD exhaustion) with VMs configured close to the limit.

  This is CVE-2015-7970 / XSA-150.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: George Dunlap <george.dunlap@citrix.com>
  master commit: 101ce53266866144e724ed593173bc4098b300b9
  master date: 2015-10-29 13:36:25 +0100
  0b12f70dfc28b76f7fcfe96116c0760b374ac574:x86/PoD: Eager sweep for zeroed pages

  Based on the contents of a guests physical address space,
  p2m_pod_emergency_sweep() could degrade into a linear memcmp() from 0 to
  max_gfn, which runs non-preemptibly.

  As p2m_pod_emergency_sweep() runs behind the scenes in a number of contexts,
  making it preemptible is not feasible.

  Instead, a different approach is taken.  Recently-populated pages are eagerly
  checked for reclaimation, which amortises the p2m_pod_emergency_sweep()
  operation across each p2m_pod_demand_populate() operation.

  Note that in the case that a 2M superpage can't be reclaimed as a superpage,
  it is shattered if 4K pages of zeros can be reclaimed.  This is unfortunate
  but matches the previous behaviour, and is required to avoid regressions
  (domain crash from PoD exhaustion) with VMs configured close to the limit.

  This is CVE-2015-7970 / XSA-150.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: George Dunlap <george.dunlap@citrix.com>
  master commit: 101ce53266866144e724ed593173bc4098b300b9
  master date: 2015-10-29 13:36:25 +0100
  4a32fbd95af6503ea1314ff2aa9a0b0a473d46c0:x86/PoD: Eager sweep for zeroed pages

  Based on the contents of a guests physical address space,
  p2m_pod_emergency_sweep() could degrade into a linear memcmp() from 0 to
  max_gfn, which runs non-preemptibly.

  As p2m_pod_emergency_sweep() runs behind the scenes in a number of contexts,
  making it preemptible is not feasible.

  Instead, a different approach is taken.  Recently-populated pages are eagerly
  checked for reclaimation, which amortises the p2m_pod_emergency_sweep()
  operation across each p2m_pod_demand_populate() operation.

  Note that in the case that a 2M superpage can't be reclaimed as a superpage,
  it is shattered if 4K pages of zeros can be reclaimed.  This is unfortunate
  but matches the previous behaviour, and is required to avoid regressions
  (domain crash from PoD exhaustion) with VMs configured close to the limit.

  This is CVE-2015-7970 / XSA-150.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: George Dunlap <george.dunlap@citrix.com>
  master commit: 101ce53266866144e724ed593173bc4098b300b9
  master date: 2015-10-29 13:36:25 +0100
  101ce53266866144e724ed593173bc4098b300b9:x86/PoD: Eager sweep for zeroed pages

  Based on the contents of a guests physical address space,
  p2m_pod_emergency_sweep() could degrade into a linear memcmp() from 0 to
  max_gfn, which runs non-preemptibly.

  As p2m_pod_emergency_sweep() runs behind the scenes in a number of contexts,
  making it preemptible is not feasible.

  Instead, a different approach is taken.  Recently-populated pages are eagerly
  checked for reclaimation, which amortises the p2m_pod_emergency_sweep()
  operation across each p2m_pod_demand_populate() operation.

  Note that in the case that a 2M superpage can't be reclaimed as a superpage,
  it is shattered if 4K pages of zeros can be reclaimed.  This is unfortunate
  but matches the previous behaviour, and is required to avoid regressions
  (domain crash from PoD exhaustion) with VMs configured close to the limit.

  This is CVE-2015-7970 / XSA-150.

  Signed-off-by: Andrew Cooper <andrew.cooper3@citrix.com>
  Reviewed-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: George Dunlap <george.dunlap@citrix.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 0b12f70dfc28b76f7fcfe96116c0760b374ac574
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 2d330c121eff67f4828dc8536180986e0dfdf14b
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 3638ff0e711e1a2bcb1ad8f3706d5ea079a54e79
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 4a32fbd95af6503ea1314ff2aa9a0b0a473d46c0
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 101ce53266866144e724ed593173bc4098b300b9
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/0b12f70dfc28b76f7fcfe96116c0760b374ac574
    reference_type: commit
    reference_id: 0b12f70dfc28b76f7fcfe96116c0760b374ac574
  - url: https://github.com/xen-project/xen/tree/101ce53266866144e724ed593173bc4098b300b9
    reference_type: commit
    reference_id: 101ce53266866144e724ed593173bc4098b300b9
  - url: https://github.com/xen-project/xen/tree/2d330c121eff67f4828dc8536180986e0dfdf14b
    reference_type: commit
    reference_id: 2d330c121eff67f4828dc8536180986e0dfdf14b
  - url: https://github.com/xen-project/xen/tree/3638ff0e711e1a2bcb1ad8f3706d5ea079a54e79
    reference_type: commit
    reference_id: 3638ff0e711e1a2bcb1ad8f3706d5ea079a54e79
  - url: https://github.com/xen-project/xen/tree/4a32fbd95af6503ea1314ff2aa9a0b0a473d46c0
    reference_type: commit
    reference_id: 4a32fbd95af6503ea1314ff2aa9a0b0a473d46c0
