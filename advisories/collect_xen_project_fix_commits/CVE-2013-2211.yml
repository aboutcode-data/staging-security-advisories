advisory_id: CVE-2013-2211
datasource_id: collect_xen_project_fix_commits/CVE-2013-2211
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: "8e49bda945b85050a3583d8a6f3831b5f14cca16:libxl: Restrict permissions on PV console\
  \ device xenstore nodes\n\nMatthew Daley has observed that the PV console protocol places\
  \ sensitive host\nstate into a guest writeable xenstore locations, this includes:\n\n - The\
  \ pty used to communicate between the console backend daemon and its\n   client, allowing\
  \ the guest administrator to read and write arbitrary host\n   files.\n - The output file,\
  \ allowing the guest administrator to write arbitrary host\n   files or to target arbitrary\
  \ qemu chardevs which include sockets, udp, ptr,\n   pipes etc (see -chardev in qemu(1) for\
  \ a more complete list).\n - The maximum buffer size, allowing the guest administrator to\
  \ consume more\n   resources than the host administrator has configured.\n - The backend to\
  \ use (qemu vs xenconsoled), potentially allowing the guest\n   administrator to confuse host\
  \ software.\n\nSo we arrange to make the sensitive keys in the xenstore frontend directory\n\
  read only for the guest. This is safe since the xenstore permissions model,\nunlike POSIX\
  \ directory permissions, does not allow the guest to remove and\nrecreate a node if it has\
  \ write access to the containing directory.\n\nThere are a few associated wrinkles:\n\n -\
  \ The primary PV console is \"special\". It's xenstore node is not under the\n   usual /devices/\
  \ subtree and it does not use the customary xenstore state\n   machine protocol. Unfortunately\
  \ its directory is used for other things,\n   including the vnc-port node, which we do not\
  \ want the guest to be able to\n   write to. Rather than trying to track down all the possible\
  \ secondary uses\n   of this directory just make it r/o to the guest. All newly created\n\
  \   subdirectories inherit these permissions and so are now safe by default.\n\n - The other\
  \ serial consoles do use the customary xenstore state machine and\n   therefore need write\
  \ access to at least the \"protocol\" and \"state\" nodes,\n   however they may also want\
  \ to use arbitrary \"feature-foo\" nodes (although\n   I'm not aware of any) and therefore\
  \ we cannot simply lock down the entire\n   frontend directory. Instead we add support to\
  \ libxl__device_generic_add for\n   frontend keys which are explicitly read only and use that\
  \ to lock down the\n   sensitive keys.\n\n - Minios' console frontend wants to write the \"\
  type\" node, which it has no\n   business doing since this is a host/toolstack level decision.\
  \ This fails\n   now that the node has become read only to the PV guest. Since the toolstack\n\
  \   already writes this node just remove the attempt to set it.\n\nThis is CVE-2013-2211 /\
  \ XSA-57\n\nSigned-off-by: Ian Campbell <ian.campbell@citrix.com>\n\nConflicts (4.2 backport):\n\
  \ttools/libxl/libxl.c (no vtpm, free front_ro on error in\n\t                     libxl__device_console_add)\n\
  \nConflicts (4.1 backport):\n\textras/mini-os/console/xenbus.c\n\ttools/libxl/libxl.c\n\t\
  tools/libxl/libxl_device.c\n\ttools/libxl/libxl_internal.h\n\ttools/libxl/libxl_pci.c\n\t\
  tools/libxl/libxl_xshelp.c\n\n  - minios code was in xencons_ring.c\n  - many places need\
  \ &gc not just gc\n  - libxl__xs_writev path is not const\n  - varios minor context fixups\n\
  85fac79f83f96e5a626d9d0509c1533c6320ea5c:libxl: Restrict permissions on PV console device\
  \ xenstore nodes\n\nMatthew Daley has observed that the PV console protocol places sensitive\
  \ host\nstate into a guest writeable xenstore locations, this includes:\n\n - The pty used\
  \ to communicate between the console backend daemon and its\n   client, allowing the guest\
  \ administrator to read and write arbitrary host\n   files.\n - The output file, allowing\
  \ the guest administrator to write arbitrary host\n   files or to target arbitrary qemu chardevs\
  \ which include sockets, udp, ptr,\n   pipes etc (see -chardev in qemu(1) for a more complete\
  \ list).\n - The maximum buffer size, allowing the guest administrator to consume more\n \
  \  resources than the host administrator has configured.\n - The backend to use (qemu vs xenconsoled),\
  \ potentially allowing the guest\n   administrator to confuse host software.\n\nSo we arrange\
  \ to make the sensitive keys in the xenstore frontend directory\nread only for the guest.\
  \ This is safe since the xenstore permissions model,\nunlike POSIX directory permissions,\
  \ does not allow the guest to remove and\nrecreate a node if it has write access to the containing\
  \ directory.\n\nThere are a few associated wrinkles:\n\n - The primary PV console is \"special\"\
  . It's xenstore node is not under the\n   usual /devices/ subtree and it does not use the\
  \ customary xenstore state\n   machine protocol. Unfortunately its directory is used for other\
  \ things,\n   including the vnc-port node, which we do not want the guest to be able to\n\
  \   write to. Rather than trying to track down all the possible secondary uses\n   of this\
  \ directory just make it r/o to the guest. All newly created\n   subdirectories inherit these\
  \ permissions and so are now safe by default.\n\n - The other serial consoles do use the customary\
  \ xenstore state machine and\n   therefore need write access to at least the \"protocol\"\
  \ and \"state\" nodes,\n   however they may also want to use arbitrary \"feature-foo\" nodes\
  \ (although\n   I'm not aware of any) and therefore we cannot simply lock down the entire\n\
  \   frontend directory. Instead we add support to libxl__device_generic_add for\n   frontend\
  \ keys which are explicitly read only and use that to lock down the\n   sensitive keys.\n\n\
  \ - Minios' console frontend wants to write the \"type\" node, which it has no\n   business\
  \ doing since this is a host/toolstack level decision. This fails\n   now that the node has\
  \ become read only to the PV guest. Since the toolstack\n   already writes this node just\
  \ remove the attempt to set it.\n\nThis is CVE-2013-2211 / XSA-57\n\nSigned-off-by: Ian Campbell\
  \ <ian.campbell@citrix.com>\n\nConflicts:\n\ttools/libxl/libxl.c (no vtpm, free front_ro on\
  \ error in\n\t                     libxl__device_console_add)"
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 85fac79f83f96e5a626d9d0509c1533c6320ea5c
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 8e49bda945b85050a3583d8a6f3831b5f14cca16
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/85fac79f83f96e5a626d9d0509c1533c6320ea5c
    reference_type: commit
    reference_id: 85fac79f83f96e5a626d9d0509c1533c6320ea5c
  - url: https://github.com/xen-project/xen/tree/8e49bda945b85050a3583d8a6f3831b5f14cca16
    reference_type: commit
    reference_id: 8e49bda945b85050a3583d8a6f3831b5f14cca16
