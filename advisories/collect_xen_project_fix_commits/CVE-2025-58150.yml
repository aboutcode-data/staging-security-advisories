advisory_id: CVE-2025-58150
datasource_id: collect_xen_project_fix_commits/CVE-2025-58150
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  a2bca552d7eb42b19c152e0dbbccb3d15788508d:x86/shadow: don't overrun trace_emul_write_val

  Guests can do wider-than-PTE-size writes on page tables. The tracing
  helper variable, however, only offers space for a single PTE (and it is
  being switched to the more correct type right here). Therefore bound
  incoming write sizes to the amount of space available.

  To not leave dead code (which is a Misra concern), drop the now unused
  guest_pa_t as well.

  Also move and adjust GUEST_PTE_SIZE: Derive it rather than using hard-
  coded numbers, and put it in the sole source file where it's actually
  needed. This then also addresses a Misra rule 20.9 ("All identifiers
  used in the controlling expression of #if or #elif preprocessing
  directives shall be #define'd before evaluation") violation:
  GUEST_PAGING_LEVELS is #define'd only in multi.c.

  This is XSA-477 / CVE-2025-58150.

  Fixes: 9a86ac1aa3d2 ("xentrace 5/7: Additional tracing for the shadow code")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: a6626b613a843c6d4c3c453e45f84046f2d10302
  master date: 2026-01-27 13:55:01 +0100
  f196c2f4dcf5711aa159c32b8053af60bade588c:x86/shadow: don't overrun trace_emul_write_val

  Guests can do wider-than-PTE-size writes on page tables. The tracing
  helper variable, however, only offers space for a single PTE (and it is
  being switched to the more correct type right here). Therefore bound
  incoming write sizes to the amount of space available.

  To not leave dead code (which is a Misra concern), drop the now unused
  guest_pa_t as well.

  Also move and adjust GUEST_PTE_SIZE: Derive it rather than using hard-
  coded numbers, and put it in the sole source file where it's actually
  needed. This then also addresses a Misra rule 20.9 ("All identifiers
  used in the controlling expression of #if or #elif preprocessing
  directives shall be #define'd before evaluation") violation:
  GUEST_PAGING_LEVELS is #define'd only in multi.c.

  This is XSA-477 / CVE-2025-58150.

  Fixes: 9a86ac1aa3d2 ("xentrace 5/7: Additional tracing for the shadow code")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: a6626b613a843c6d4c3c453e45f84046f2d10302
  master date: 2026-01-27 13:55:01 +0100
  a9d58e5e40cfbcc3004ae69777e38aab78c96b84:x86/shadow: don't overrun trace_emul_write_val

  Guests can do wider-than-PTE-size writes on page tables. The tracing
  helper variable, however, only offers space for a single PTE (and it is
  being switched to the more correct type right here). Therefore bound
  incoming write sizes to the amount of space available.

  To not leave dead code (which is a Misra concern), drop the now unused
  guest_pa_t as well.

  Also move and adjust GUEST_PTE_SIZE: Derive it rather than using hard-
  coded numbers, and put it in the sole source file where it's actually
  needed. This then also addresses a Misra rule 20.9 ("All identifiers
  used in the controlling expression of #if or #elif preprocessing
  directives shall be #define'd before evaluation") violation:
  GUEST_PAGING_LEVELS is #define'd only in multi.c.

  This is XSA-477 / CVE-2025-58150.

  Fixes: 9a86ac1aa3d2 ("xentrace 5/7: Additional tracing for the shadow code")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: a6626b613a843c6d4c3c453e45f84046f2d10302
  master date: 2026-01-27 13:55:01 +0100
  f63a5ba705b929ba1fb2e7b7d106c610e0353b87:x86/shadow: don't overrun trace_emul_write_val

  Guests can do wider-than-PTE-size writes on page tables. The tracing
  helper variable, however, only offers space for a single PTE (and it is
  being switched to the more correct type right here). Therefore bound
  incoming write sizes to the amount of space available.

  To not leave dead code (which is a Misra concern), drop the now unused
  guest_pa_t as well.

  Also move and adjust GUEST_PTE_SIZE: Derive it rather than using hard-
  coded numbers, and put it in the sole source file where it's actually
  needed. This then also addresses a Misra rule 20.9 ("All identifiers
  used in the controlling expression of #if or #elif preprocessing
  directives shall be #define'd before evaluation") violation:
  GUEST_PAGING_LEVELS is #define'd only in multi.c.

  This is XSA-477 / CVE-2025-58150.

  Fixes: 9a86ac1aa3d2 ("xentrace 5/7: Additional tracing for the shadow code")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: a6626b613a843c6d4c3c453e45f84046f2d10302
  master date: 2026-01-27 13:55:01 +0100
  41b9ae5d7e5c5f5e14fd3c362e033188815f6deb:x86/shadow: don't overrun trace_emul_write_val

  Guests can do wider-than-PTE-size writes on page tables. The tracing
  helper variable, however, only offers space for a single PTE (and it is
  being switched to the more correct type right here). Therefore bound
  incoming write sizes to the amount of space available.

  To not leave dead code (which is a Misra concern), drop the now unused
  guest_pa_t as well.

  Also move and adjust GUEST_PTE_SIZE: Derive it rather than using hard-
  coded numbers, and put it in the sole source file where it's actually
  needed. This then also addresses a Misra rule 20.9 ("All identifiers
  used in the controlling expression of #if or #elif preprocessing
  directives shall be #define'd before evaluation") violation:
  GUEST_PAGING_LEVELS is #define'd only in multi.c.

  This is XSA-477 / CVE-2025-58150.

  Fixes: 9a86ac1aa3d2 ("xentrace 5/7: Additional tracing for the shadow code")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: a6626b613a843c6d4c3c453e45f84046f2d10302
  master date: 2026-01-27 13:55:01 +0100
  a6626b613a843c6d4c3c453e45f84046f2d10302:x86/shadow: don't overrun trace_emul_write_val

  Guests can do wider-than-PTE-size writes on page tables. The tracing
  helper variable, however, only offers space for a single PTE (and it is
  being switched to the more correct type right here). Therefore bound
  incoming write sizes to the amount of space available.

  To not leave dead code (which is a Misra concern), drop the now unused
  guest_pa_t as well.

  Also move and adjust GUEST_PTE_SIZE: Derive it rather than using hard-
  coded numbers, and put it in the sole source file where it's actually
  needed. This then also addresses a Misra rule 20.9 ("All identifiers
  used in the controlling expression of #if or #elif preprocessing
  directives shall be #define'd before evaluation") violation:
  GUEST_PAGING_LEVELS is #define'd only in multi.c.

  This is XSA-477 / CVE-2025-58150.

  Fixes: 9a86ac1aa3d2 ("xentrace 5/7: Additional tracing for the shadow code")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: f196c2f4dcf5711aa159c32b8053af60bade588c
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: a2bca552d7eb42b19c152e0dbbccb3d15788508d
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: a6626b613a843c6d4c3c453e45f84046f2d10302
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 41b9ae5d7e5c5f5e14fd3c362e033188815f6deb
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: f63a5ba705b929ba1fb2e7b7d106c610e0353b87
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: a9d58e5e40cfbcc3004ae69777e38aab78c96b84
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/41b9ae5d7e5c5f5e14fd3c362e033188815f6deb
    reference_type: commit
    reference_id: 41b9ae5d7e5c5f5e14fd3c362e033188815f6deb
  - url: https://github.com/xen-project/xen/tree/a2bca552d7eb42b19c152e0dbbccb3d15788508d
    reference_type: commit
    reference_id: a2bca552d7eb42b19c152e0dbbccb3d15788508d
  - url: https://github.com/xen-project/xen/tree/a6626b613a843c6d4c3c453e45f84046f2d10302
    reference_type: commit
    reference_id: a6626b613a843c6d4c3c453e45f84046f2d10302
  - url: https://github.com/xen-project/xen/tree/a9d58e5e40cfbcc3004ae69777e38aab78c96b84
    reference_type: commit
    reference_id: a9d58e5e40cfbcc3004ae69777e38aab78c96b84
  - url: https://github.com/xen-project/xen/tree/f196c2f4dcf5711aa159c32b8053af60bade588c
    reference_type: commit
    reference_id: f196c2f4dcf5711aa159c32b8053af60bade588c
  - url: https://github.com/xen-project/xen/tree/f63a5ba705b929ba1fb2e7b7d106c610e0353b87
    reference_type: commit
    reference_id: f63a5ba705b929ba1fb2e7b7d106c610e0353b87
