advisory_id: CVE-2023-46841
datasource_id: collect_xen_project_fix_commits/CVE-2023-46841
datasource_url: https://github.com/xen-project/xen
aliases: []
summary: |
  2484803074fc1f93942912a82e4906f9e441bf4e:x86: account for shadow stack in exception-from-stub recovery

  Dealing with exceptions raised from within emulation stubs involves
  discarding return address (replaced by exception related information).
  Such discarding of course also requires removing the corresponding entry
  from the shadow stack.

  Also amend the comment in fixup_exception_return(), to further clarify
  why use of ptr[1] can't be an out-of-bounds access.

  This is CVE-2023-46841 / XSA-451.

  Fixes: 209fb9919b50 ("x86/extable: Adjust extable handling to be shadow stack compatible")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: 91f5f7a9154919a765c3933521760acffeddbf28
  master date: 2024-02-27 13:49:22 +0100
  ffd75b161de76e43fd54d751ab70d2fdf6e2e87d:x86: account for shadow stack in exception-from-stub recovery

  Dealing with exceptions raised from within emulation stubs involves
  discarding return address (replaced by exception related information).
  Such discarding of course also requires removing the corresponding entry
  from the shadow stack.

  Also amend the comment in fixup_exception_return(), to further clarify
  why use of ptr[1] can't be an out-of-bounds access.

  This is CVE-2023-46841 / XSA-451.

  Fixes: 209fb9919b50 ("x86/extable: Adjust extable handling to be shadow stack compatible")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: 91f5f7a9154919a765c3933521760acffeddbf28
  master date: 2024-02-27 13:49:22 +0100
  49f77602373b58b7bbdb40cea2b49d2f88d4003d:x86: account for shadow stack in exception-from-stub recovery

  Dealing with exceptions raised from within emulation stubs involves
  discarding return address (replaced by exception related information).
  Such discarding of course also requires removing the corresponding entry
  from the shadow stack.

  Also amend the comment in fixup_exception_return(), to further clarify
  why use of ptr[1] can't be an out-of-bounds access.

  This is CVE-2023-46841 / XSA-451.

  Fixes: 209fb9919b50 ("x86/extable: Adjust extable handling to be shadow stack compatible")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: 91f5f7a9154919a765c3933521760acffeddbf28
  master date: 2024-02-27 13:49:22 +0100
  58bb8115104c9fca749ee4cfcd3579ac1ed644db:x86: account for shadow stack in exception-from-stub recovery

  Dealing with exceptions raised from within emulation stubs involves
  discarding return address (replaced by exception related information).
  Such discarding of course also requires removing the corresponding entry
  from the shadow stack.

  Also amend the comment in fixup_exception_return(), to further clarify
  why use of ptr[1] can't be an out-of-bounds access.

  While touching do_invalid_op() also add a missing fall-through
  annotation.

  This is CVE-2023-46841 / XSA-451.

  Fixes: 209fb9919b50 ("x86/extable: Adjust extable handling to be shadow stack compatible")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
  master commit: 91f5f7a9154919a765c3933521760acffeddbf28
  master date: 2024-02-27 13:49:22 +0100
  91f5f7a9154919a765c3933521760acffeddbf28:x86: account for shadow stack in exception-from-stub recovery

  Dealing with exceptions raised from within emulation stubs involves
  discarding return address (replaced by exception related information).
  Such discarding of course also requires removing the corresponding entry
  from the shadow stack.

  Also amend the comment in fixup_exception_return(), to further clarify
  why use of ptr[1] can't be an out-of-bounds access.

  While touching do_invalid_op() also add a missing fall-through
  annotation.

  This is CVE-2023-46841 / XSA-451.

  Fixes: 209fb9919b50 ("x86/extable: Adjust extable handling to be shadow stack compatible")
  Signed-off-by: Jan Beulich <jbeulich@suse.com>
  Reviewed-by: Andrew Cooper <andrew.cooper3@citrix.com>
impacted_packages:
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 58bb8115104c9fca749ee4cfcd3579ac1ed644db
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 49f77602373b58b7bbdb40cea2b49d2f88d4003d
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 91f5f7a9154919a765c3933521760acffeddbf28
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: 2484803074fc1f93942912a82e4906f9e441bf4e
    introduced_in_commits: []
  - purl: pkg:github/xen-project/xen
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/xen-project/xen
        commit: ffd75b161de76e43fd54d751ab70d2fdf6e2e87d
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/xen-project/xen/tree/2484803074fc1f93942912a82e4906f9e441bf4e
    reference_type: commit
    reference_id: 2484803074fc1f93942912a82e4906f9e441bf4e
  - url: https://github.com/xen-project/xen/tree/49f77602373b58b7bbdb40cea2b49d2f88d4003d
    reference_type: commit
    reference_id: 49f77602373b58b7bbdb40cea2b49d2f88d4003d
  - url: https://github.com/xen-project/xen/tree/58bb8115104c9fca749ee4cfcd3579ac1ed644db
    reference_type: commit
    reference_id: 58bb8115104c9fca749ee4cfcd3579ac1ed644db
  - url: https://github.com/xen-project/xen/tree/91f5f7a9154919a765c3933521760acffeddbf28
    reference_type: commit
    reference_id: 91f5f7a9154919a765c3933521760acffeddbf28
  - url: https://github.com/xen-project/xen/tree/ffd75b161de76e43fd54d751ab70d2fdf6e2e87d
    reference_type: commit
    reference_id: ffd75b161de76e43fd54d751ab70d2fdf6e2e87d
