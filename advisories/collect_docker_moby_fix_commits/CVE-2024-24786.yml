advisory_id: CVE-2024-24786
datasource_id: collect_docker_moby_fix_commits/CVE-2024-24786
datasource_url: https://github.com/moby/moby
aliases: []
summary: |
  3d56d734dba666b4532387109442b607706732d9:vendor: google.golang.org/protobuf v1.33.0, github.com/golang/protobuf v1.5.4

  full diffs:

  - https://github.com/protocolbuffers/protobuf-go/compare/v1.31.0...v1.33.0
  - https://github.com/golang/protobuf/compare/v1.5.3...v1.5.4

  From the Go security announcement list;

  > Version v1.33.0 of the google.golang.org/protobuf module fixes a bug in
  > the google.golang.org/protobuf/encoding/protojson package which could cause
  > the Unmarshal function to enter an infinite loop when handling some invalid
  > inputs.
  >
  > This condition could only occur when unmarshaling into a message which contains
  > a google.protobuf.Any value, or when the UnmarshalOptions.UnmarshalUnknown
  > option is set. Unmarshal now correctly returns an error when handling these
  > inputs.
  >
  > This is CVE-2024-24786.

  In a follow-up post;

  > A small correction: This vulnerability applies when the UnmarshalOptions.DiscardUnknown
  > option is set (as well as when unmarshaling into any message which contains a
  > google.protobuf.Any). There is no UnmarshalUnknown option.
  >
  > In addition, version 1.33.0 of google.golang.org/protobuf inadvertently
  > introduced an incompatibility with the older github.com/golang/protobuf
  > module. (https://github.com/golang/protobuf/issues/1596) Users of the older
  > module should update to github.com/golang/protobuf@v1.5.4.

  govulncheck results in our code:

      govulncheck ./...
      Scanning your code and 1221 packages across 204 dependent modules for known vulnerabilities...

      === Symbol Results ===

      Vulnerability #1: GO-2024-2611
          Infinite loop in JSON unmarshaling in google.golang.org/protobuf
        More info: https://pkg.go.dev/vuln/GO-2024-2611
        Module: google.golang.org/protobuf
          Found in: google.golang.org/protobuf@v1.31.0
          Fixed in: google.golang.org/protobuf@v1.33.0
          Example traces found:
            #1: daemon/logger/gcplogs/gcplogging.go:154:18: gcplogs.New calls logging.Client.Ping, which eventually calls json.Decoder.Peek
            #2: daemon/logger/gcplogs/gcplogging.go:154:18: gcplogs.New calls logging.Client.Ping, which eventually calls json.Decoder.Read
            #3: daemon/logger/gcplogs/gcplogging.go:154:18: gcplogs.New calls logging.Client.Ping, which eventually calls protojson.Unmarshal

      Your code is affected by 1 vulnerability from 1 module.
      This scan found no other vulnerabilities in packages you import or modules you
      require.

  Signed-off-by: Sebastiaan van Stijn <github@gone.nl>
  (cherry picked from commit 1ca89d7eae84346a7241f9d7033a7f591ff3a1fa)
  Signed-off-by: Austin Vazquez <macedonv@amazon.com>
  1ca89d7eae84346a7241f9d7033a7f591ff3a1fa:vendor: google.golang.org/protobuf v1.33.0, github.com/golang/protobuf v1.5.4

  full diffs:

  - https://github.com/protocolbuffers/protobuf-go/compare/v1.31.0...v1.33.0
  - https://github.com/golang/protobuf/compare/v1.5.3...v1.5.4

  From the Go security announcement list;

  > Version v1.33.0 of the google.golang.org/protobuf module fixes a bug in
  > the google.golang.org/protobuf/encoding/protojson package which could cause
  > the Unmarshal function to enter an infinite loop when handling some invalid
  > inputs.
  >
  > This condition could only occur when unmarshaling into a message which contains
  > a google.protobuf.Any value, or when the UnmarshalOptions.UnmarshalUnknown
  > option is set. Unmarshal now correctly returns an error when handling these
  > inputs.
  >
  > This is CVE-2024-24786.

  In a follow-up post;

  > A small correction: This vulnerability applies when the UnmarshalOptions.DiscardUnknown
  > option is set (as well as when unmarshaling into any message which contains a
  > google.protobuf.Any). There is no UnmarshalUnknown option.
  >
  > In addition, version 1.33.0 of google.golang.org/protobuf inadvertently
  > introduced an incompatibility with the older github.com/golang/protobuf
  > module. (https://github.com/golang/protobuf/issues/1596) Users of the older
  > module should update to github.com/golang/protobuf@v1.5.4.

  govulncheck results in our code:

      govulncheck ./...
      Scanning your code and 1221 packages across 204 dependent modules for known vulnerabilities...

      === Symbol Results ===

      Vulnerability #1: GO-2024-2611
          Infinite loop in JSON unmarshaling in google.golang.org/protobuf
        More info: https://pkg.go.dev/vuln/GO-2024-2611
        Module: google.golang.org/protobuf
          Found in: google.golang.org/protobuf@v1.31.0
          Fixed in: google.golang.org/protobuf@v1.33.0
          Example traces found:
            #1: daemon/logger/gcplogs/gcplogging.go:154:18: gcplogs.New calls logging.Client.Ping, which eventually calls json.Decoder.Peek
            #2: daemon/logger/gcplogs/gcplogging.go:154:18: gcplogs.New calls logging.Client.Ping, which eventually calls json.Decoder.Read
            #3: daemon/logger/gcplogs/gcplogging.go:154:18: gcplogs.New calls logging.Client.Ping, which eventually calls protojson.Unmarshal

      Your code is affected by 1 vulnerability from 1 module.
      This scan found no other vulnerabilities in packages you import or modules you
      require.

  Signed-off-by: Sebastiaan van Stijn <github@gone.nl>
impacted_packages:
  - purl: pkg:github/moby/moby
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/moby/moby
        commit: 1ca89d7eae84346a7241f9d7033a7f591ff3a1fa
    introduced_in_commits: []
  - purl: pkg:github/moby/moby
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/moby/moby
        commit: 3d56d734dba666b4532387109442b607706732d9
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/moby/moby/tree/1ca89d7eae84346a7241f9d7033a7f591ff3a1fa
    reference_type: commit
    reference_id: 1ca89d7eae84346a7241f9d7033a7f591ff3a1fa
  - url: https://github.com/moby/moby/tree/3d56d734dba666b4532387109442b607706732d9
    reference_type: commit
    reference_id: 3d56d734dba666b4532387109442b607706732d9
