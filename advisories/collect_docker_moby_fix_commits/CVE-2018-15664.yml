advisory_id: CVE-2018-15664
datasource_id: collect_docker_moby_fix_commits/CVE-2018-15664
datasource_url: https://github.com/moby/moby
aliases: []
summary: |
  ceb773e1ff8cbbc634349abb121e9ece56a8081e:Merge pull request #275 from tiborvass/19.03-revert-chroot-tar-untar

  [19.03] Revert Pass root to chroot to for chroot Tar/Untar (CVE-2018-15664)
  72797601723f6a8847027a1abbd1a3cea2667718:Merge pull request #253 from thaJeztah/18.09_backport_root_dir_on_copy

  [18.09 backport] Pass root to chroot to for chroot Tar/Untar (CVE-2018-15664)
  36324c3bbdc5bf40535e237d958090351ed43d32:Merge pull request #254 from thaJeztah/19.03_backport_root_dir_on_copy

  [19.03 backport] Pass root to chroot to for chroot Tar/Untar (CVE-2018-15664)
  364f9bce16e8c95c79fc68d23867e871f20cb452:Merge pull request #39292 from cpuguy83/root_dir_on_copy

  Pass root to chroot to for chroot Tar/Untar (CVE-2018-15664)
  9781cceb09063ac91190b32bea68b76618312950:Pass root to chroot to for chroot Untar

  This is useful for preventing CVE-2018-15664 where a malicious container
  process can take advantage of a race on symlink resolution/sanitization.

  Before this change chrootarchive would chroot to the destination
  directory which is attacker controlled. With this patch we always chroot
  to the container's root which is not attacker controlled.

  Signed-off-by: Brian Goff <cpuguy83@gmail.com>
  (cherry picked from commit d089b639372a8f9301747ea56eaf0a42df24016a)
  Signed-off-by: Sebastiaan van Stijn <github@gone.nl>
  155939994f453559676656bc4b05635e83ebef56:Pass root to chroot to for chroot Untar

  This is useful for preventing CVE-2018-15664 where a malicious container
  process can take advantage of a race on symlink resolution/sanitization.

  Before this change chrootarchive would chroot to the destination
  directory which is attacker controlled. With this patch we always chroot
  to the container's root which is not attacker controlled.

  Signed-off-by: Brian Goff <cpuguy83@gmail.com>
  (cherry picked from commit d089b639372a8f9301747ea56eaf0a42df24016a)
  Signed-off-by: Sebastiaan van Stijn <github@gone.nl>
  d089b639372a8f9301747ea56eaf0a42df24016a:Pass root to chroot to for chroot Untar

  This is useful for preventing CVE-2018-15664 where a malicious container
  process can take advantage of a race on symlink resolution/sanitization.

  Before this change chrootarchive would chroot to the destination
  directory which is attacker controlled. With this patch we always chroot
  to the container's root which is not attacker controlled.

  Signed-off-by: Brian Goff <cpuguy83@gmail.com>
impacted_packages:
  - purl: pkg:github/moby/moby
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/moby/moby
        commit: 36324c3bbdc5bf40535e237d958090351ed43d32
    introduced_in_commits: []
  - purl: pkg:github/moby/moby
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/moby/moby
        commit: 155939994f453559676656bc4b05635e83ebef56
    introduced_in_commits: []
  - purl: pkg:github/moby/moby
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/moby/moby
        commit: 72797601723f6a8847027a1abbd1a3cea2667718
    introduced_in_commits: []
  - purl: pkg:github/moby/moby
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/moby/moby
        commit: 364f9bce16e8c95c79fc68d23867e871f20cb452
    introduced_in_commits: []
  - purl: pkg:github/moby/moby
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/moby/moby
        commit: 9781cceb09063ac91190b32bea68b76618312950
    introduced_in_commits: []
  - purl: pkg:github/moby/moby
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/moby/moby
        commit: ceb773e1ff8cbbc634349abb121e9ece56a8081e
    introduced_in_commits: []
  - purl: pkg:github/moby/moby
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/moby/moby
        commit: d089b639372a8f9301747ea56eaf0a42df24016a
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/moby/moby/tree/155939994f453559676656bc4b05635e83ebef56
    reference_type: commit
    reference_id: 155939994f453559676656bc4b05635e83ebef56
  - url: https://github.com/moby/moby/tree/36324c3bbdc5bf40535e237d958090351ed43d32
    reference_type: commit
    reference_id: 36324c3bbdc5bf40535e237d958090351ed43d32
  - url: https://github.com/moby/moby/tree/364f9bce16e8c95c79fc68d23867e871f20cb452
    reference_type: commit
    reference_id: 364f9bce16e8c95c79fc68d23867e871f20cb452
  - url: https://github.com/moby/moby/tree/72797601723f6a8847027a1abbd1a3cea2667718
    reference_type: commit
    reference_id: 72797601723f6a8847027a1abbd1a3cea2667718
  - url: https://github.com/moby/moby/tree/9781cceb09063ac91190b32bea68b76618312950
    reference_type: commit
    reference_id: 9781cceb09063ac91190b32bea68b76618312950
  - url: https://github.com/moby/moby/tree/ceb773e1ff8cbbc634349abb121e9ece56a8081e
    reference_type: commit
    reference_id: ceb773e1ff8cbbc634349abb121e9ece56a8081e
  - url: https://github.com/moby/moby/tree/d089b639372a8f9301747ea56eaf0a42df24016a
    reference_type: commit
    reference_id: d089b639372a8f9301747ea56eaf0a42df24016a
