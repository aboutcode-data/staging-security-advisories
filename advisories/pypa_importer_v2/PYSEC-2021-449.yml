advisory_id: PYSEC-2021-449
datasource_id: pypa_importer_v2/PYSEC-2021-449
datasource_url: https://github.com/pypa/advisory-database/blob/main/vulns/tensorflow-cpu/PYSEC-2021-449.yaml
aliases:
  - CVE-2021-29521
  - GHSA-hr84-fqvp-48mm
summary: TensorFlow is an end-to-end open source platform for machine learning. Specifying a
  negative dense shape in `tf.raw_ops.SparseCountSparseOutput` results in a segmentation fault
  being thrown out from the standard library as `std::vector` invariants are broken. This is
  because the implementation(https://github.com/tensorflow/tensorflow/blob/8f7b60ee8c0206a2c99802e3a4d1bb55d2bc0624/tensorflow/core/kernels/count_ops.cc#L199-L213)
  assumes the first element of the dense shape is always positive and uses it to initialize
  a `BatchedMap<T>` (i.e., `std::vector<absl::flat_hash_map<int64,T>>`(https://github.com/tensorflow/tensorflow/blob/8f7b60ee8c0206a2c99802e3a4d1bb55d2bc0624/tensorflow/core/kernels/count_ops.cc#L27))
  data structure. If the `shape` tensor has more than one element, `num_batches` is the first
  value in `shape`. Ensuring that the `dense_shape` argument is a valid tensor shape (that is,
  all elements are non-negative) solves this issue. The fix will be included in TensorFlow 2.5.0.
  We will also cherrypick this commit on TensorFlow 2.4.2 and TensorFlow 2.3.3.
impacted_packages:
  - purl: pkg:pypi/tensorflow-cpu
    affected_versions: vers:pypi/2.3.0|2.3.1|2.3.2|2.4.0|2.4.1
    fixed_versions: vers:pypi/2.3.3|2.4.2
    fixed_in_commits:
      - vcs_url: https://github.com/tensorflow/tensorflow
        commit: c57c0b9f3a4f8684f3489dd9a9ec627ad8b599f5
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/tensorflow/tensorflow/commit/c57c0b9f3a4f8684f3489dd9a9ec627ad8b599f5
    reference_type:
    reference_id:
  - url: https://github.com/tensorflow/tensorflow/security/advisories/GHSA-hr84-fqvp-48mm
    reference_type:
    reference_id:
