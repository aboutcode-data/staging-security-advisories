advisory_id: CVE-2023-40217
datasource_id: collect_python_cpython_fix_commits/CVE-2023-40217
datasource_url: https://github.com/python/cpython
aliases: []
summary: "0df2eb5b267fb56d93faf561024548a8816a0269:[3.8] gh-108310: Fix TestPreHandshakeClose\
  \ tests in test_ssl (#110718)\n\nThe new class is part of the fix for CVE-2023-40217:\r\n\
  https://github.com/python/cpython/commit/b4bcc06a9cfe13d96d5270809d963f8ba278f89b\r\nbut it's\
  \ not in the lists of tests so they're not\r\nexecuted. The new tests also need `SHORT_TIMEOUT`\r\
  \nconstant not available in test.support in 3.8.\r\n\r\nCo-authored-by: Łukasz Langa <lukasz@langa.pl>\n\
  256586ab8776e4526ca594b4866b9a3492e628f1:[3.12] gh-108310: Fix CVE-2023-40217: Check for &\
  \ avoid the ssl pre-close flaw (#108316)\n\nInstances of `ssl.SSLSocket` were vulnerable to\
  \ a bypass of the TLS handshake\r\nand included protections (like certificate verification)\
  \ and treating sent\r\nunencrypted data as if it were post-handshake TLS encrypted data.\r\
  \n\r\nThe vulnerability is caused when a socket is connected, data is sent by the\r\nmalicious\
  \ peer and stored in a buffer, and then the malicious peer closes the\r\nsocket within a small\
  \ timing window before the other peers’ TLS handshake can\r\nbegin. After this sequence of\
  \ events the closed socket will not immediately\r\nattempt a TLS handshake due to not being\
  \ connected but will also allow the\r\nbuffered data to be read as if a successful TLS handshake\
  \ had occurred.\r\n\r\nCo-authored-by: Gregory P. Smith [Google LLC] <greg@krypto.org>\n264b1dacc67346efa0933d1e63f622676e0ed96b:[3.9]\
  \ gh-108310: Fix CVE-2023-40217: Check for & avoid the ssl pre-close flaw (#108320)\n\ngh-108310:\
  \ Fix CVE-2023-40217: Check for & avoid the ssl pre-close flaw\r\n\r\nInstances of `ssl.SSLSocket`\
  \ were vulnerable to a bypass of the TLS handshake\r\nand included protections (like certificate\
  \ verification) and treating sent\r\nunencrypted data as if it were post-handshake TLS encrypted\
  \ data.\r\n\r\nThe vulnerability is caused when a socket is connected, data is sent by the\r\
  \nmalicious peer and stored in a buffer, and then the malicious peer closes the\r\nsocket\
  \ within a small timing window before the other peers’ TLS handshake can\r\nbegin. After this\
  \ sequence of events the closed socket will not immediately\r\nattempt a TLS handshake due\
  \ to not being connected but will also allow the\r\nbuffered data to be read as if a successful\
  \ TLS handshake had occurred.\r\n\r\nCo-authored-by: Gregory P. Smith [Google LLC] <greg@krypto.org>\n\
  264b1dacc67346efa0933d1e63f622676e0ed96b:[3.9] gh-108310: Fix CVE-2023-40217: Check for &\
  \ avoid the ssl pre-close flaw (#108320)\n\ngh-108310: Fix CVE-2023-40217: Check for & avoid\
  \ the ssl pre-close flaw\r\n\r\nInstances of `ssl.SSLSocket` were vulnerable to a bypass of\
  \ the TLS handshake\r\nand included protections (like certificate verification) and treating\
  \ sent\r\nunencrypted data as if it were post-handshake TLS encrypted data.\r\n\r\nThe vulnerability\
  \ is caused when a socket is connected, data is sent by the\r\nmalicious peer and stored in\
  \ a buffer, and then the malicious peer closes the\r\nsocket within a small timing window\
  \ before the other peers’ TLS handshake can\r\nbegin. After this sequence of events the closed\
  \ socket will not immediately\r\nattempt a TLS handshake due to not being connected but will\
  \ also allow the\r\nbuffered data to be read as if a successful TLS handshake had occurred.\r\
  \n\r\nCo-authored-by: Gregory P. Smith [Google LLC] <greg@krypto.org>\nb4bcc06a9cfe13d96d5270809d963f8ba278f89b:[3.8]\
  \ gh-108310: Fix CVE-2023-40217: Check for & avoid the ssl pre-close flaw (#108321)\n\ngh-108310:\
  \ Fix CVE-2023-40217: Check for & avoid the ssl pre-close flaw\r\n\r\nInstances of `ssl.SSLSocket`\
  \ were vulnerable to a bypass of the TLS handshake\r\nand included protections (like certificate\
  \ verification) and treating sent\r\nunencrypted data as if it were post-handshake TLS encrypted\
  \ data.\r\n\r\nThe vulnerability is caused when a socket is connected, data is sent by the\r\
  \nmalicious peer and stored in a buffer, and then the malicious peer closes the\r\nsocket\
  \ within a small timing window before the other peers’ TLS handshake can\r\nbegin. After this\
  \ sequence of events the closed socket will not immediately\r\nattempt a TLS handshake due\
  \ to not being connected but will also allow the\r\nbuffered data to be read as if a successful\
  \ TLS handshake had occurred.\r\n\r\nCo-authored-by: Gregory P. Smith [Google LLC] <greg@krypto.org>\n\
  b4bcc06a9cfe13d96d5270809d963f8ba278f89b:[3.8] gh-108310: Fix CVE-2023-40217: Check for &\
  \ avoid the ssl pre-close flaw (#108321)\n\ngh-108310: Fix CVE-2023-40217: Check for & avoid\
  \ the ssl pre-close flaw\r\n\r\nInstances of `ssl.SSLSocket` were vulnerable to a bypass of\
  \ the TLS handshake\r\nand included protections (like certificate verification) and treating\
  \ sent\r\nunencrypted data as if it were post-handshake TLS encrypted data.\r\n\r\nThe vulnerability\
  \ is caused when a socket is connected, data is sent by the\r\nmalicious peer and stored in\
  \ a buffer, and then the malicious peer closes the\r\nsocket within a small timing window\
  \ before the other peers’ TLS handshake can\r\nbegin. After this sequence of events the closed\
  \ socket will not immediately\r\nattempt a TLS handshake due to not being connected but will\
  \ also allow the\r\nbuffered data to be read as if a successful TLS handshake had occurred.\r\
  \n\r\nCo-authored-by: Gregory P. Smith [Google LLC] <greg@krypto.org>\n37d7180cb647f0bed0c1caab0037f3bc82e2af96:[3.10]\
  \ gh-108310: Fix CVE-2023-40217: Check for & avoid the ssl pre-close flaw (#108318)\n\ngh-108310:\
  \ Fix CVE-2023-40217: Check for & avoid the ssl pre-close flaw\r\n\r\nInstances of `ssl.SSLSocket`\
  \ were vulnerable to a bypass of the TLS handshake\r\nand included protections (like certificate\
  \ verification) and treating sent\r\nunencrypted data as if it were post-handshake TLS encrypted\
  \ data.\r\n\r\nThe vulnerability is caused when a socket is connected, data is sent by the\r\
  \nmalicious peer and stored in a buffer, and then the malicious peer closes the\r\nsocket\
  \ within a small timing window before the other peers’ TLS handshake can\r\nbegin. After this\
  \ sequence of events the closed socket will not immediately\r\nattempt a TLS handshake due\
  \ to not being connected but will also allow the\r\nbuffered data to be read as if a successful\
  \ TLS handshake had occurred.\r\n\r\nCo-authored-by: Gregory P. Smith [Google LLC] <greg@krypto.org>\n\
  37d7180cb647f0bed0c1caab0037f3bc82e2af96:[3.10] gh-108310: Fix CVE-2023-40217: Check for &\
  \ avoid the ssl pre-close flaw (#108318)\n\ngh-108310: Fix CVE-2023-40217: Check for & avoid\
  \ the ssl pre-close flaw\r\n\r\nInstances of `ssl.SSLSocket` were vulnerable to a bypass of\
  \ the TLS handshake\r\nand included protections (like certificate verification) and treating\
  \ sent\r\nunencrypted data as if it were post-handshake TLS encrypted data.\r\n\r\nThe vulnerability\
  \ is caused when a socket is connected, data is sent by the\r\nmalicious peer and stored in\
  \ a buffer, and then the malicious peer closes the\r\nsocket within a small timing window\
  \ before the other peers’ TLS handshake can\r\nbegin. After this sequence of events the closed\
  \ socket will not immediately\r\nattempt a TLS handshake due to not being connected but will\
  \ also allow the\r\nbuffered data to be read as if a successful TLS handshake had occurred.\r\
  \n\r\nCo-authored-by: Gregory P. Smith [Google LLC] <greg@krypto.org>\n75a875e0df0530b75b1470d797942f90f4a718d3:[3.11]\
  \ gh-108310: Fix CVE-2023-40217: Check for & avoid the ssl pre-close flaw (#108317)\n\ngh-108310:\
  \ Fix CVE-2023-40217: Check for & avoid the ssl pre-close flaw\r\n\r\nInstances of `ssl.SSLSocket`\
  \ were vulnerable to a bypass of the TLS handshake\r\nand included protections (like certificate\
  \ verification) and treating sent\r\nunencrypted data as if it were post-handshake TLS encrypted\
  \ data.\r\n\r\nThe vulnerability is caused when a socket is connected, data is sent by the\r\
  \nmalicious peer and stored in a buffer, and then the malicious peer closes the\r\nsocket\
  \ within a small timing window before the other peers’ TLS handshake can\r\nbegin. After this\
  \ sequence of events the closed socket will not immediately\r\nattempt a TLS handshake due\
  \ to not being connected but will also allow the\r\nbuffered data to be read as if a successful\
  \ TLS handshake had occurred.\r\n\r\nCo-authored-by: Gregory P. Smith [Google LLC] <greg@krypto.org>\n\
  75a875e0df0530b75b1470d797942f90f4a718d3:[3.11] gh-108310: Fix CVE-2023-40217: Check for &\
  \ avoid the ssl pre-close flaw (#108317)\n\ngh-108310: Fix CVE-2023-40217: Check for & avoid\
  \ the ssl pre-close flaw\r\n\r\nInstances of `ssl.SSLSocket` were vulnerable to a bypass of\
  \ the TLS handshake\r\nand included protections (like certificate verification) and treating\
  \ sent\r\nunencrypted data as if it were post-handshake TLS encrypted data.\r\n\r\nThe vulnerability\
  \ is caused when a socket is connected, data is sent by the\r\nmalicious peer and stored in\
  \ a buffer, and then the malicious peer closes the\r\nsocket within a small timing window\
  \ before the other peers’ TLS handshake can\r\nbegin. After this sequence of events the closed\
  \ socket will not immediately\r\nattempt a TLS handshake due to not being connected but will\
  \ also allow the\r\nbuffered data to be read as if a successful TLS handshake had occurred.\r\
  \n\r\nCo-authored-by: Gregory P. Smith [Google LLC] <greg@krypto.org>\n0cb0c238d520a8718e313b52cffc356a5a7561bf:gh-108310:\
  \ Fix CVE-2023-40217: Check for & avoid the ssl pre-close flaw (#108315)\n\nInstances of `ssl.SSLSocket`\
  \ were vulnerable to a bypass of the TLS handshake\r\nand included protections (like certificate\
  \ verification) and treating sent\r\nunencrypted data as if it were post-handshake TLS encrypted\
  \ data.\r\n\r\nThe vulnerability is caused when a socket is connected, data is sent by the\r\
  \nmalicious peer and stored in a buffer, and then the malicious peer closes the\r\nsocket\
  \ within a small timing window before the other peers’ TLS handshake can\r\nbegin. After this\
  \ sequence of events the closed socket will not immediately\r\nattempt a TLS handshake due\
  \ to not being connected but will also allow the\r\nbuffered data to be read as if a successful\
  \ TLS handshake had occurred.\r\n\r\nCo-authored-by: Gregory P. Smith [Google LLC] <greg@krypto.org>"
impacted_packages:
  - purl: pkg:github/python/cpython
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/python/cpython
        commit: 0cb0c238d520a8718e313b52cffc356a5a7561bf
    introduced_in_commits: []
  - purl: pkg:github/python/cpython
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/python/cpython
        commit: 37d7180cb647f0bed0c1caab0037f3bc82e2af96
    introduced_in_commits: []
  - purl: pkg:github/python/cpython
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/python/cpython
        commit: 256586ab8776e4526ca594b4866b9a3492e628f1
    introduced_in_commits: []
  - purl: pkg:github/python/cpython
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/python/cpython
        commit: 75a875e0df0530b75b1470d797942f90f4a718d3
    introduced_in_commits: []
  - purl: pkg:github/python/cpython
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/python/cpython
        commit: 0df2eb5b267fb56d93faf561024548a8816a0269
    introduced_in_commits: []
  - purl: pkg:github/python/cpython
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/python/cpython
        commit: 264b1dacc67346efa0933d1e63f622676e0ed96b
    introduced_in_commits: []
  - purl: pkg:github/python/cpython
    affected_versions:
    fixed_versions:
    fixed_in_commits:
      - vcs_url: https://github.com/python/cpython
        commit: b4bcc06a9cfe13d96d5270809d963f8ba278f89b
    introduced_in_commits: []
severities: []
weaknesses: []
references:
  - url: https://github.com/python/cpython/tree/0cb0c238d520a8718e313b52cffc356a5a7561bf
    reference_type: commit
    reference_id: 0cb0c238d520a8718e313b52cffc356a5a7561bf
  - url: https://github.com/python/cpython/tree/0df2eb5b267fb56d93faf561024548a8816a0269
    reference_type: commit
    reference_id: 0df2eb5b267fb56d93faf561024548a8816a0269
  - url: https://github.com/python/cpython/tree/256586ab8776e4526ca594b4866b9a3492e628f1
    reference_type: commit
    reference_id: 256586ab8776e4526ca594b4866b9a3492e628f1
  - url: https://github.com/python/cpython/tree/264b1dacc67346efa0933d1e63f622676e0ed96b
    reference_type: commit
    reference_id: 264b1dacc67346efa0933d1e63f622676e0ed96b
  - url: https://github.com/python/cpython/tree/37d7180cb647f0bed0c1caab0037f3bc82e2af96
    reference_type: commit
    reference_id: 37d7180cb647f0bed0c1caab0037f3bc82e2af96
  - url: https://github.com/python/cpython/tree/75a875e0df0530b75b1470d797942f90f4a718d3
    reference_type: commit
    reference_id: 75a875e0df0530b75b1470d797942f90f4a718d3
  - url: https://github.com/python/cpython/tree/b4bcc06a9cfe13d96d5270809d963f8ba278f89b
    reference_type: commit
    reference_id: b4bcc06a9cfe13d96d5270809d963f8ba278f89b
